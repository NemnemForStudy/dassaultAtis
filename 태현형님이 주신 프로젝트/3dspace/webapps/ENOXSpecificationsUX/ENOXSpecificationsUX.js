define("DS/ENOXSpecificationsUX/data/Connector3DSpace",["UWA/Core","UWA/Promise","DS/ENOXAttachmentsUX/data/Constants","DS/DocumentManagement/DocumentManagement","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(t,e,o,n,r,a,i){"use strict";return function(){var r={options:{},init:function(t,e){if(r.controller=t,r.options=e||{},!(r.options&&r.options.fetchSecurityContext&&r.options.platformUrls&&r.options.platformUrls["3DSpace"]&&r.options.platformUrls.platformId))throw new Error("Connector Options incomplete");r.ready=!0,r.controller.connectorReady(r.options)},loadAttachments:function(a){if(!this.ready)throw new Error("Connector not ready");if(a)if(a.noParent&&t.is(a.objectIds,"array"))n.getDocuments(a.objectIds,{tenant:r.options.platformUrls.platformId,securityContext:r.options.fetchSecurityContext(),tenantUrl:r.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision",onComplete:function(t){var e=r.controller.ctrl.options.parentObject;if(a.objectIds==e.objectIds){if(t.success){if(!Array.isArray(t.data))return;r.controller.addAttachmentsToUI(t.data)}r.controller.finishLoadingAttachments()}},onFailure:function(t){r.controller.finishLoadingAttachments(),t.error&&r.controller.showNotification("error",i.get("FAILED_TO_LOAD_SPECIFICATIONS"),t.error)}});else{var s=e.deferred(),l=e.deferred();t.Promise.all([s.promise,l.promise]).then(function(){r.controller.finishLoadingAttachments()});var c={relInfo:{parentId:a.parentId,parentRelName:a.relationName||o.SPECIFICATION_DOCUMENT,parentDirection:"from"},tenant:r.options.platformUrls.platformId,securityContext:r.options.fetchSecurityContext(),tenantUrl:r.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision",onComplete:function(t,e){var n=r.controller.ctrl.options.parentObject;if(e.relInfo.parentId==n.parentId&&e.relInfo.parentRelName==(n.relationName||o.SPECIFICATION_DOCUMENT)){if(!Array.isArray(t.data))return;t.data.forEach(function(t){t.relName=c.relInfo.parentRelName}),r.controller.addAttachmentsToUI(t.data),s.resolve()}},onFailure:function(t){console.error(t),t.error&&r.controller.showNotification("error",i.get("FAILED_TO_LOAD_SPECIFICATIONS"),t.error),s.resolve()}};n.getDocumentsFromParent(c);var d={relInfo:{parentId:a.parentId,parentRelName:o.REL_PLMDOCCONNECTION,parentDirection:"from"},tenant:r.options.platformUrls.platformId,securityContext:r.options.fetchSecurityContext(),tenantUrl:r.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision",onComplete:function(t,e){var n=r.controller.ctrl.options.parentObject;if(e.relInfo.parentId==n.parentId&&e.relInfo.parentRelName==o.REL_PLMDOCCONNECTION){if(!Array.isArray(t.data))return;t.data.forEach(function(t){t.relName=o.REL_PLMDOCCONNECTION});for(var a=[],i=0;i<t.data.length;i++){var s=t.data[i];r.controller.PLMDMTDocumentTypes.includes(s.type)||a.push(t.data[i])}t.data=a,r.controller.addAttachmentsToUI(t.data),l.resolve()}},onFailure:function(t){console.error(t),t.error&&r.controller.showNotification("error",i.get("FAILED_TO_LOAD_SPECIFICATIONS"),t.error),l.resolve()}};n.getDocumentsFromParent(d)}},uploadAttachments:function(t,e,n){require(["DS/DocumentCreateNew/CreateNew","DS/Windows/ImmersiveFrame"],function(a,s){var l=new s;l.inject(widget.body),new a({tenantUrl:r.options.platformUrls["3DSpace"],securityContext:r.options.fetchSecurityContext(),tenant:r.options.platformUrls.platformId,immersiveFrame:l,parentObject:e,parentRelName:e.relationName||o.SPECIFICATION_DOCUMENT,connector:r,supportedTypes:n,credentialsPrefName:r.options.credentialsPrefName||o.PAD_CURRENT_SECURITY_CONTEXT,onUploadStart:function(){l.destroy()},onCancel:function(){l.destroy()},onError:function(t){r.controller.showNotification("error",i.get("UPLOAD_FAILED"),t.subtitle,t.message||""),l.destroy()}}).create(t)})},attachAttachments:function(e,s){if(e.length>0){for(var l=r.controller.attachments.getRoots(),c=0;c<l.length;c++){var d=l[c];if(e.includes(d.options.data.id)){r.controller.showNotification("error",i.get("TYPE_ATTACH_FAILED",{type:d.options.data.dataelements.typeNLS}),i.get("X_IS_ALREADY_ATTACHED",{title:d.options.data.dataelements.title||d.options.data.dataelements.secondaryTitle||d.options.data.dataelements.name}));var p=e.indexOf(d.options.data.id);p>-1&&e.splice(p,1)}}n.getDocuments(e,{tenant:r.options.platformUrls.platformId,securityContext:r.options.fetchSecurityContext(),tenantUrl:r.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision",onComplete:function(e){if(e.success)for(var n=0;n<e.data.length;n++){var l=e.data[n];e.data[n].relName=o.SPECIFICATION_DOCUMENT;var c=!0;if(s&&s.parentId&&l.id==s.parentId){r.controller.showNotification("error",i.get("TYPE_ATTACH_FAILED",{type:l.dataelements.typeNLS}),i.get("CANNOT_ATTACH_X_TO_ITSELF",{title:l.dataelements.title||l.dataelements.secondaryTitle||l.dataelements.name})),c=!1;break}if(c)if(!r.controller.options.supportedTypes.includedTypes.includes("*")&&!r.controller.options.supportedTypes.includedTypes.includes(l.type)||r.controller.options.supportedTypes.excludedTypes.includes(l.type))r.controller.showNotification("error",i.get("DOCUMENT_NOT_ALLOWED",{type:l.dataelements.typeNLS}),i.get("X_CANNOT_BE_ATTACHED",{type:l.type}));else if(s.noParent){var d={onFailure:function(e){console.error(e),t.is(e,"string")&&r.controller.showNotification("error",i.get("FAILED_TO_ATTACH_ATTACHMENT"),e)},onSuccess:function(t){r.controller.addAttachmentsToUI([t]),r.controller.showNotification("success",i.get("DOCUMENT_ATTACHED",{type:t.dataelements.typeNLS}),i.get("X_ATTACHED_SUCCESSFULLY",{title:t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name}))}};r.controller.events.publish({event:"attach-document-requested",data:{document:l,parentObject:s,callback:d}})}else a(l,s)}},onFailure:function(e){if(e.error)if((e.error.match(/\n/g)||[]).length>2){for(var o=e.error.split("\n"),n=[],a=2;a<o.length;a++)n.push(o[a]);n=n.join("<br/>"),r.controller.showNotification("error",o[0],o[1],n,void 0,!0)}else r.controller.showNotification("error",i.get("DOCUMENT_ATTACH_FAILED"),e.error);else t.is(e,"string")?r.controller.showNotification("error",i.get("DOCUMENT_ATTACH_FAILED"),e):r.controller.showNotification("error",i.get("DOCUMENT_ATTACH_FAILED"))}})}},detachAttachments:function(t,e){if(e.noParent){var o={onSuccess:function(e){t.forEach(function(t){e.forEach(function(e){t.options.data.id==e&&(r.controller.attachments.removeRoot(t),r.controller.showNotification("success",i.get("DOCUMENT_DETACHED",{type:t.options.data.dataelements.typeNLS}),i.get("X_DETACHED_SUCCESSFULLY",{title:t.options.data.dataelements.title||t.options.data.dataelements.secondaryTitle||t.options.data.dataelements.name})))})})}};r.controller.events.publish({event:"detach-attachments-requested",data:{ids:r.controller.helper.restrict(t,"options.data.id"),parentObject:e,callback:o}})}else for(var n=0;n<t.length;n++){s(t[n],e)}},getUpdatedAttachment:function(e,a){n.getDocuments([e.id],{tenant:r.options.platformUrls.platformId,securityContext:r.options.fetchSecurityContext(),tenantUrl:r.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision",onComplete:function(t){if(t.success){if(!Array.isArray(t.data))return;t.data.forEach(function(t){t.relName=e.relName||o.SPECIFICATION_DOCUMENT}),a(t.data)}},onFailure:function(e){e.error?r.controller.showNotification("error",i.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e.error):t.is(e,"string")?r.controller.showNotification("error",i.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e):r.controller.showNotification("error",i.get("FAILED_TO_GET_UPDATED_ATTACHMENT"))}})},getUpdatedAttachments:function(e,o,a){n.getDocuments(e.map(function(t){return t.id}),{tenant:r.options.platformUrls.platformId,securityContext:r.options.fetchSecurityContext(),tenantUrl:r.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision",onComplete:function(t){if(t.success){if(!Array.isArray(t.data))return;o(t.data)}},onFailure:function(e){t.is(a,"function")?a(e):e.error?r.controller.showNotification("error",i.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e.error):t.is(e,"string")?r.controller.showNotification("error",i.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e):r.controller.showNotification("error",i.get("FAILED_TO_GET_UPDATED_ATTACHMENT"))}})},ready:!1,uploadAttachment:function(e,o,a){if(r.ready){var s={customDocumentObject:e.custom_attributes?{dataelements:e.custom_attributes}:void 0,tenant:r.options.platformUrls.platformId,securityContext:a,tenantUrl:r.options.platformUrls["3DSpace"],additionalHeaders:t.is(r.options.getWorkUnderHeaders,"function")?r.options.getWorkUnderHeaders():{},onFailure:function(t){if(t.error)if((t.error.match(/\n/g)||[]).length>2){for(var n=t.error.split("\n"),a=[],s=2;s<n.length;s++)a.push(n[s]);a=a.join("<br/>"),r.controller.showNotification("error",n[0],n[1],a,void 0,!0)}else r.controller.showNotification("error",i.get("UPLOAD_FAILED"),t.error);else r.controller.showNotification("error",i.get("UPLOAD_FAILED"),t.error?t.error:i.get("X_UPLOAD_FAILED",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}));r.controller.events.publish({event:"upload-attachment-failure",data:{document:e,parentObject:o}}),r.controller.jobs.finishJob(l)},onProgress:function(t){r.controller.events.publish({event:"upload-attachment-progress",data:{document:e,parentObject:o}}),l.update(t)},onComplete:function(t){t.data&&(t.data[0].dataelements.isDocumentType="TRUE");var n=t.data;n.forEach(function(t){t.delayLoadThumbnails=!0,e.relInfo&&(t.relName=e.relInfo.parentRelName)});var a=function(t){r.controller.addAttachmentsToUI(t),1==t.length?r.controller.showNotification("success",i.get("DOCUMENT_ATTACHED",{type:t[0].dataelements.typeNLS}),i.get("X_ATTACHED_SUCCESSFULLY",{title:t[0].dataelements.title||t[0].dataelements.secondaryTitle||t[0].dataelements.name})):t.length>1&&r.controller.showNotification("success",i.get("DOCUMENTS_ATTACHED"),i.get("X_DOCUMENTS_ATTACHED_SUCCESSFULLY",{num:t.length}))},s={event:"upload-attachment-complete",data:{documents:n,parentObject:o}};o.noParent&&(s.data.callback=a),r.controller.events.publish(s),r.controller.jobs.finishJob(l),o.noParent||a(n)}},l={title:i.get("UPLOADING_X",{title:e.title}),ui:!0,process:function(){n.createDocument(e,s)}};r.controller.jobs.addJob(l)}}};function a(e,a){if(r.ready){var s={relInfo:{parentId:a.parentId,parentRelName:a.relationName||o.SPECIFICATION_DOCUMENT,parentDirection:"from"},tenant:r.options.platformUrls.platformId,securityContext:r.options.fetchSecurityContext(),tenantUrl:r.options.platformUrls["3DSpace"],additionalHeaders:t.is(r.options.getWorkUnderHeaders,"function")?r.options.getWorkUnderHeaders():{},onFailure:function(t){if(t.error)if((t.error.match(/\n/g)||[]).length>2){for(var o=t.error.split("\n"),n=[],s=2;s<o.length;s++)n.push(o[s]);n=n.join("<br/>"),r.controller.showNotification("error",o[0],o[1],n,void 0,!0)}else r.controller.showNotification("error",i.get("TYPE_ATTACH_FAILED",{type:e.dataelements.typeNLS}),t.error);else r.controller.showNotification("error",i.get("TYPE_ATTACH_FAILED",{type:e.dataelements.typeNLS}),i.get("X_ATTACH_FAILED",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}));r.controller.events.publish({event:"attach-attachment-failure",data:{document:e,parentObject:a}}),r.controller.jobs.finishJob(l)},onProgress:function(t){r.controller.events.publish({event:"attach-attachment-progress",data:{document:e,parentObject:a}}),l.update(t)},onComplete:function(t){r.controller.events.publish({event:"attach-attachment-complete",data:{document:e,parentObject:a}}),r.controller.jobs.finishJob(l),e.relName=s.relInfo.parentRelName,r.controller.addAttachmentsToUI([e]),r.controller.showNotification("success",i.get("DOCUMENT_ATTACHED",{type:e.dataelements.typeNLS}),i.get("X_ATTACHED_SUCCESSFULLY",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}))}},l={title:i.get("ATTACHING_X",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}),ui:!1,process:function(){n.connectDocumentToParent(e.id,s)}};r.controller.jobs.addJob(l)}}function s(e,a){if(r.ready){var s={relInfo:{parentId:a.parentId,parentRelName:e.options.data.relName||o.SPECIFICATION_DOCUMENT,parentDirection:"from"},tenant:r.options.platformUrls.platformId,securityContext:r.options.fetchSecurityContext(),tenantUrl:r.options.platformUrls["3DSpace"],additionalHeaders:t.is(r.options.getWorkUnderHeaders,"function")?r.options.getWorkUnderHeaders():{},onFailure:function(o){if(r.controller.events.publish({event:"detach-attachment-failure",data:{id:r.controller.helper.restrict(e,"options.data.id"),parentObject:a}}),r.controller.jobs.finishJob(l),o.error)if((o.error.match(/\n/g)||[]).length>2){for(var n=o.error.split("\n"),s=[],c=2;c<n.length;c++)s.push(n[c]);s=s.join("<br/>"),r.controller.showNotification("error",n[0],n[1],s,void 0,!0)}else r.controller.showNotification("error",i.get("FAILED_TO_DETACH_ATTACHMENT",{type:e.options.data.dataelements.typeNLS}),o.error);else t.is(o,"string")?r.controller.showNotification("error",i.get("FAILED_TO_DETACH_ATTACHMENT",{type:e.options.data.dataelements.typeNLS}),o):r.controller.showNotification("error",i.get("FAILED_TO_DETACH_ATTACHMENT",{type:e.options.data.dataelements.typeNLS}))},onProgress:function(t){r.controller.events.publish({event:"detach-attachment-progress",data:{id:r.controller.helper.restrict(e,"options.data.id"),parentObject:a}}),l.update(t)},onComplete:function(t){r.controller.jobs.finishJob(l),t.success&&r.controller.attachments.getRoots().forEach(function(e){t.data.forEach(function(t){e.options.data.id==t.id&&(r.controller.events.publish({event:"detach-attachment-complete",data:{id:r.controller.helper.restrict(e,"options.data.id"),parentObject:a}}),r.controller.attachments.removeRoot(e),r.controller.showNotification("success",i.get("DOCUMENT_DETACHED",{type:e.options.data.dataelements.typeNLS}),i.get("X_DETACHED_SUCCESSFULLY",{title:e.options.data.dataelements.title||e.options.data.dataelements.secondaryTitle||e.options.data.dataelements.name})))})})}},l={title:i.get("DETACHING_X",{title:e.options.data.dataelements.title||e.options.data.dataelements.secondaryTitle||e.options.data.dataelements.name}),ui:!1,process:function(){n.disconnectDocumentFromParent(e.options.data.id,s)}};r.controller.jobs.addJob(l)}}return r}}),define("DS/ENOXSpecificationsUX/SpecificationsPane",["UWA/Core","DS/ENOXAttachmentsUX/data/Controller","DS/ENOXSpecificationsUX/data/Connector3DSpace","DS/ENOXAttachmentsUX/views/Topbar","DS/ENOXAttachmentsUX/views/UploadPane","DS/ENOXAttachmentsUX/views/GridPane","DS/ENOXAttachmentsUX/views/TilePane","DS/ENOXAttachmentsUX/views/ProgressPane","text!DS/ENOXAttachmentsUX/assets/config.json","DS/ENOXAttachmentsUX/data/DnDManager","DS/CoreEvents/ModelEvents","DS/UIKIT/Mask","DS/ENOXAttachmentsUX/utils/Overlay","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX","css!DS/ENOXAttachmentsUX/ENOXAttachmentsUX.css"],function(t,e,o,n,r,a,i,s,l,c,d,p,m,f,h){"use strict";return(l=JSON.parse(l)).actionbar.forEach(function(t){t.text=f.get(t.nls),t.title=f.get(t.nls),t.content&&t.content.options&&t.content.options.items&&t.content.options.items.forEach(function(t){t.text=f.get(t.nls),t.description=f.get(t.nls)})}),l.headers.forEach(function(t){t.text=f.get(t.nls)}),l.contextMenu.forEach(function(t){t.text=f.get(t.nls),t.title=f.get(t.nls)}),t.Controls.Abstract.extend({name:"enox-attachments",options:{className:""},_options:{},modelEvents:void 0,init:function(e){this.modelEvents=e.events||new d,this.config=t.clone(l),this._parent(e),this._options=e,this.buildSkeleton()},buildSkeleton:function(){this.elements.container=t.createElement("div",{class:this.getClassNames()}),this.options.parentObject?this.startLoading():this.showNoParentSelected(),this.elements.content=t.createElement("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.container),this.options.attachmentsType="specifications",new e(this),new n(this),this.buildContentPanes(),new s(this),new c(this),this._options.delayInitialize?console.log("Waiting for initialize to be called"):this.initialize()},buildContentPanes:function(){this.elements.panes=t.createElement("div",{class:this.getClassNames("-panes")}),this.elements.panes.inject(this.elements.content),new r(this),new a(this),new i(this)},setParentObject:function(t){this.options.parentObject=t,this.finishLoading(),this.options.parentObject?this.startLoading():this.showNoParentSelected(),this.controller.clearAll(),this.controller.loadAttachments()},setConnectorOptions:function(e){t.merge(this.options.connectorOptions,e)},setSupportedTypes:function(e){t.merge(this.options.supportedTypes,e),t.merge(this.options.searchOptions,this.options.supportedTypes)},initialize:function(){this.controller.initialize(this,this._options.connector||new o)},attachSpecifications:function(t){this.controller.attachAttachments(t)},startLoading:function(){p.mask(this.elements.container)},finishLoading:function(){p.unmask(this.elements.container),m.unoverlay(this.elements.container)},showNoParentSelected:function(){m.overlay(this.elements.container,f.get("NOPARENTOBJECT"))},destroy:function(){this.controller.destroy(),this._parent()},onRemoved:function(){this.destroy()},setSelection:function(t){this.controller.attachments.processDescendants({processNode:function(e){t.includes(e.nodeModel.options.data.id)?e.nodeModel.select():e.nodeModel.unselect()},onlyVisibleNodes:!1})},getSelection:function(){return this.controller.helper.restrict(this.controller.attachments.getSelectedNodes(),"options.data.id")}})});