define("DS/DELWKOModelPlugins/DELWKOViewPreferencesUI",["UWA/Core","DS/Utilities/Utils","DS/DELPPWResourceServices/ResourceUtils","DS/DELPPWModelServices/BehaviorUtil","DS/DELPPWModelServices/ModelUtils","DS/DELPPWViewPlugins/TreeViewPlugin/RootsStoreUI","DS/DELPPWViewPlugins/MoreAttributesWizard","DS/CoreEvents/Events","DS/DELPPWWebServices/WebserviceUtils","DS/DocumentManagement/DocumentManagement"],function(e,n,t,i,r,o,a,s,u,c){"use strict";return function(l,d,g,f,m){var p,C,I,P,y,h,v,b,D,L,R,M,T,S=g.getComponent("Element"),w=g.getComponent("Dialog"),E=g.getComponent("Button"),x=g.getComponent("WUXTab"),A=g.getComponent("TreeListView"),V=g.getComponent("TreeNodeModel"),O=g.getComponent("Editor"),F=g.getComponent("Toggle");return y=function(n){C=new S("div",{class:"ViewPreferencesUI-Content"}),(p=new w({domId:"ViewPreferencesUI-Dialog",immersiveFrame:d.getImmersiveFrame(),modalFlag:!0,visibleFlag:!1,resizableFlag:!0,snappableFlag:!1,title:t.getNLSValue("ViewPreferencesUI.Header"),content:C,buttons:{Ok:new E({domId:"ViewPreferencesUI-Dialog-Ok",className:"ok primary",label:t.getNLSValue("ViewPreferencesUI.Ok"),emphasize:"primary",onClick:function(){var t=M();p.close(),e.is(n,"function")&&n(t)}}),Cancel:new E({domId:"ViewPreferencesUI-Dialog-Cancel",className:"cancel",label:t.getNLSValue("ViewPreferencesUI.Cancel"),onClick:function(){p.close()}}),Apply:new E({domId:"ViewPreferencesUI-Dialog-Apply",className:"moreAttr",label:t.getNLSValue("ViewPreferencesUI.MoreAttributes"),onClick:R})}})).close=function(){this.destroy(),C=null,P=null,I=null}},D=function(n,t){var i,r=[];return n.selectedAttributes.forEach(function(e){e.attrIsSelected&&!e.attrIsInXML?t.Config.Columns.Column.push({dataIndex:e.dataIndex,dicoType:e.attrNature,display:"true",minWidth:"50"}):!e.attrIsSelected&&e.attrIsInXML&&r.push(e.dataIndex)}),i=(i=(i='<?xml version="1.0" encoding="UTF-8"?>\n')+'<Config name="'+t.Config.name+'" xmlns="DS_DELPPWConfiguration" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="DS_DELPPWConfiguration ../xsd/ColumnConfig.xsd" Title="'+t.Config.Title+'" Description="'+t.Config.Description+'">\n')+'<Label dataIndex="'+t.Config.Label.dataIndex+'" dicoType="'+t.Config.Label.dicoType+'"/>\n',i+="<Columns>\n",t.Config.Columns.Column.forEach(function(n){r.includes(n.dataIndex)||(i=i+'<Column dataIndex="'+n.dataIndex+'"  ',e.is(n.dicoType)&&(i=i+'dicoType="'+n.dicoType+'" '),e.is(n.displayType)&&(i=i+'displayType="'+n.displayType+'" '),e.is(n.display)&&(i=i+'display="'+n.display+'" '),i+="/>\n")}),i+="</Columns>\n",i+="</Config>\n\n"},L=function(e,n,t,i){var o,a,s,l,d,g=!1,f=u.get3DSpaceUrl().slice(0,-1),m=u.getSecurityContext(),p=widget.getPreference("custoParametersSet"),C=r.getWidgetTrigram()+"ParametersViewColumnConfig";o=D(e,t),a=new File([new Blob([o],{type:"text/xml"})],i,{type:"text/xml"}),p.options.forEach(function(e){e.value.contains(C)&&(g=!0,s=e.value.split("/")[1])}),g?(d={id:s,fileInfo:{file:a}},l={tenantUrl:f,additionalHeaders:{SecurityContext:m},onComplete:function(){widget.setValue("custoParametersSet",C+"/"+s),location.reload()},onFailure:function(){n.destroy(),n=null}},c.getDocuments([s],{tenantUrl:f,additionalHeaders:{SecurityContext:m},onComplete:function(e){var n,t=e.data[0].relateddata.files,r=!1;t.forEach(function(e){i===e.dataelements.title&&(r=!0,n=e.id)}),r?c.deleteFile(s,n,{tenantUrl:f,onComplete:function(){c.addFileToDocument(d,l)}}):c.addFileToDocument(d,l)}})):c.createDocument({fileInfo:{file:a}},{tenantUrl:f,additionalHeaders:{SecurityContext:m},csrf:{name:"ENO_CSRF_TOKEN",value:u.getCSRFToken("3DSpace")},onComplete:function(e){c.modifyDocument({id:e.data[0].id,title:C+"/"+e.data[0].id},{tenantUrl:f,onComplete:function(){widget.setValue("custoParametersSet",C+"/"+e.data[0].id),location.reload()},onFailure:function(){n.destroy(),n=null}})},onFailure:function(){}})},R=function(){var n,i,r,o,c={modelEvents:s,settingManager:null},l=d.getImmersiveFrame().elements.container.getSize(),g=new S("div",{class:"MoreWizardContainer-Content",styles:{height:l.height-60,width:l.width-20}}),f=[],m=[];switch(T[P._properties.value.value[0]]){case"MANUFACTURING":i=u.getXMLValues("MANUFACTURING.columnConfigPath"),r="ManufacturingViewColumnConfig.xml",o=["CreateAssembly","CreateMaterial","Provide","CreateKit","Installation","Transform","Fasten","DELFmiFunctionIdentifiedInstance"];break;case"MBOM":i=u.getXMLValues("MBOM.columnConfigPath"),r="ProcessColumnConfig.xml",o=["CreateAssembly","CreateMaterial","Provide","CreateKit","Installation","Transform","Fasten","DELFmiFunctionIdentifiedInstance"];break;case"RESOURCE":i=u.getXMLValues("RESOURCE.columnConfigPath"),r="ResourceViewColumnConfig.xml",o=["Worker","ResourceArea","Transport","Conveyor","Machine","Robot","Storage","Sensor","IndustrialMachine","NCMachine","ToolDevice","Inspect","UserDefined","Organizational","ResourceManufacturingSetup","ControlDevice"];break;case"EBOM":i=u.getXMLValues("EBOM.columnConfigPath"),r="ProductPartColumnConfig.xml",o=["VPMInstance","VPMReference"];break;case"ROUTINGS":i=u.getXMLValues("ROUTINGS.columnConfigPath"),r="RoutingsViewColumnConfig.xml",o=["DELLmiWorkOrderReference"];break;case"FORMULA":i=u.getXMLValues("FORMULA.columnConfigPath"),r="FormulaViewColumnConfig.xml",o=["CreateAssembly","CreateMaterial","Provide","DELFmiFunctionIdentifiedInstance","ProcessContinuousCreateMaterial","ProcessContinuousProvide","ContinuousByProduct","DiscreteByProduct"];break;case"RECIPE":i=u.getXMLValues("RECIPE.columnConfigPath"),r="RecipeViewColumnConfig.xml",o=["DELLmiHeaderWorkPlanReference","DELLmiWorkPlanSystemInstance","DELWkiSignOffInstance","DELWkiDataCollectInstance","DELWkiInstructionInstance","DELWkiAlertInstance","DELLmiGeneralOperationInstance","DELLmiHeaderOperationInstance","DELLmiWorkPlanSystemReference","DELWkiSignOffReference","DELWkiDataCollectReference","DELWkiInstructionReference","DELWkiAlertReference","DELLmiGeneralOperationReference","DELLmiHeaderOperationReference"];break;default:return""}i.Config.Columns.Column.forEach(function(n){var t=null;e.is(n.dataIndex[0])&&e.is(n.dataIndex[1])&&(t=n.dataIndex,e.is(n.displayType)?(f.push(t),m.push(t)):m.push(t))}),n=new w({domId:"MoreWizard-Dialog",immersiveFrame:d.getImmersiveFrame(),modalFlag:!0,visibleFlag:!1,resizableFlag:!0,snappableFlag:!1,title:t.getNLSValue("ViewPreferencesUI.MoreAttributesWizardTitle"),content:g,buttons:{}}),c.modelEvents.subscribe({event:"MGA/MoreAttributesWizard/selectedAttributes"},function(e){L(e,n,i,r)}),n.close=function(){this.destroy(),n=null},new a({container:g,dialog:n,settingManager:c.settingManager,modelEvents:c.modelEvents,selectedTypes:o,selectedExtensions:["XCADExtension","XP_VPMReference_Ext","EnterpriseExtension","TlgCast","XP_VPMRepReference_Ext","XP_VPMReference_Ext"],selectedAttributes:[],preSelectedAttributes:m,unSelectableAttributes:f})},h=function(){e.is(C)&&(P=new x({reorderFlag:!0,showComboBoxFlag:!0,pinFlag:!1,multiSelFlag:!1,editableFlag:!0,touchMode:!0,displayStyle:["strip"]})).inject(C)},v=function(i){var r,o,a,s={showVerticalLines:!0,isSortable:!1,isDraggable:!0,isEditable:!0,apiVersion:2,height:"auto",defaultCellHeight:40,performances:{resizeDebounceTimeout:200},selection:{cells:!1,canMultiSelect:!1,columnHeaders:!1},resize:{columns:!0,rows:!1},enableActiveUI:!0,enableKeyboardNavigation:!0,shouldDisplayTooltip:function(n){var i,r={longHelp:""};if(!n.isHeader)switch(n.dataIndex){case"colName":case"width":case"minWidth":r.longHelp=n.cellModel.options.value;break;case"colVisibility":i=n.cellModel.options.value,e.is(i.display,"boolean")&&(i.display?r.longHelp=t.getNLSValue("ViewPreferencesUI.ToolTip.ColumnVisible"):r.longHelp=t.getNLSValue("ViewPreferencesUI.ToolTip.ColumnHidden"))}return r},onDropCellDefault:function(e,n){var t,i,r,o,a;if(e.preventDefault(),t=this.unserializeDragAndDropEvent(e)){if(i=t.data["dswebux/x-tree.treenodemodel+number"],r=t.data["dswebux/x-tree.treenodemodel+json"],n.nodeModel._getID()===i)return;r&&r.forEach(function(e,t){if(o=new V(e),n.cellView){if(a=n.nodeModel,n.manager.getDocument().options.shouldAcceptDrop({parentTreeNodeModel:a,draggedTreeNodeModel:o,dropPosition:n.dropPosition})){if(n.manager.getDocument().prepareUpdate(),n.manager.getDocument().getXSO().get().forEach(function(e){e.remove()}),n.manager.getDocument().pushUpdate(),-1!==n.virtualRowID){switch(n.dropPosition){case"top":a.getParent().insertBefore(o,a);break;default:case"middle":a.getParent().addChild(o,n.virtualRowID);break;case"bottom":a.getParent().addChild(o,a.getParent().getChildren().indexOf(a)+1)}return!1}return!0}return!1}})}}},u=function(e){var n,t=e.cellView.getContent(),i=e.cellModel.getCellContent();if(!e.isHeader)return n=new O({value:i}),t.setContent(n),n},c=n.debounce(function(e){e.nodeModel.options.grid[e.dataIndex]=e.value},100,!0),l=n.debounce(function(e){e.nodeModel.options.grid[e.dataIndex].display=e.cellView.getOption("toggle").checkFlag},100,!0);for(s.columns=[{dataIndex:"tree",isHidden:!0},{text:"",dataIndex:"colPosition",isEditable:!1,width:"5%",isColumnMovable:!1,onCellRequest:function(e){var n=e.cellView.getContent();if(!e.isHeader)return n.setContent(e.nodeModel.getLabel()),e.nodeModel.getLabel()}},{text:"HeaderName",dataIndex:"colName",isEditable:!1,width:"auto",isColumnMovable:!1},{text:"IsVisible",dataIndex:"colVisibility",isEditable:!1,width:"20%",isColumnMovable:!1,onCellRequest:function(n){var t,i=n.cellView.getContent(),r=n.cellModel.getCellContent();if(!n.isHeader)return t=new F({type:"switch",label:""}),"string"===e.typeOf(r)&&(r=e.Json.decode(r)),!0===r.display&&(t.checkFlag=!0),!0===r.mandatory&&(t.disabled=!0),i.setContent(t),i.title="",n.cellView.setOption("toggle",t),t},setValue:l},{text:"Width",dataIndex:"width",isEditable:!1,width:"20%",isColumnMovable:!1,onCellRequest:u,setValue:c},{text:"MinWidth",dataIndex:"minWidth",isEditable:!1,width:"20%",isColumnMovable:!1,onCellRequest:u,setValue:c}],o=(r=new A(s)).getDocument(),a=0;a<i.length;a++)o.addRoot(new V({label:a.toString(),grid:e.merge({colName:f.getColumnDisplayValue(i[a])},i[a])}));return r},b=function(n,r,a){var s;e.is(P)&&(I={},T=n,n.forEach(function(n){var i,o=r[n],s=v(o),u=new S("div",{class:n+"-Content ViewPreferencesUI-TabContent"});I[n]=s,u.setContent(s),(i=P.add({label:t.getNLSValue("ViewPreferencesUI."+n+".TabTitle"),content:u,index:P.getPageCount(),icon:"table",isSelected:0===P.getPageCount()})).button.elements.container.addClassName(n+"-TabButton"),e.is(a[n])&&i.button.elements.iconPlaceholder.setContent(a[n])}),i.useRootStorage()&&(s=new o(p,l,g,m),P.add({id:"store-view-block",index:P.getPageCount(),icon:t.getIconURLFromKey("StoreViews"),label:t.getNLSValue("ViewPreferencesUI.StoreView.TabTitle"),content:s.getContent()})))},M=function(){var n,t,i,r,o={};for(t in I)if(I.hasOwnProperty(t))for(o[t]=[],r=I[t].getRoots(),n=0;n<r.length;n++)i=r[n].options.grid,e.is(i.colName)&&delete i.colName,o[t].push(i);return o},{name:"ViewPreferencesUI",buildView:function(n,t){return e.is(p)&&p.close(),y(t),h(),b(n.views,n.viewPreferences,n.viewIcons),p}}}}),define("DS/DELWKOModelPlugins/DELWKODatabasePlugin",["UWA/Core","UWA/Promise","DS/DELWKOModelServices/DELWKOCollectionUtils","DS/DELWKONavigationServices/DELWKONavigateUtil","DS/DELWKODicoServices/DELWKODicoUtils","DS/DELPPWModelServices/ModelUtils","DS/DELPPWModelServices/BehaviorUtil","DS/DELPPWNavigationServices/SwitchDBModeManager","DS/DELPPWResourceServices/ResourceUtils","DS/DELPPWIRPCModel/Model/ReferenceModel"],function(e,n,t,i,r,o,a,s,u,c){"use strict";return function(c){var l,d=[];return l=function e(n,i){var r,o,a;if(i.id!==n.id){for(r=t.getParentInstancesFromCollection(i.id),a=0;a<r.length;a++)if(o=r[a],e(n,t.getAggregatingReferenceModelFromInstance(o)))return!0;return!1}return!0},{onStart:function(){var n=this;t.setReferenceCollectionEvents({onAdd:function(e,n,t){c.getMediator().notify("addReference",[e,n,t])},onChange:function(e,n,t){c.getMediator().notify("changeReference",[e,n,t])},"onChange:sortIndex":function(e,n,t){c.getMediator().notify("changeSortIndex",[e,n,t])},onRemove:function(e,i,r){var o,a=n.getInstancesFromCollection(e.id),s=n.getParentInstancesFromCollection(e.id);for(o=0;o<s.length;o++)n.removeInstance(s[o]);for(o=0;o<a.length;o++)n.removeInstance(a[o]);t.getImpactedConnections(e.id).forEach(function(e){n.removeConnection(e.id)}),c.getMediator().notify("removeReference",[e,i,r])}}),t.setConnectionsCollectionEvents({onAdd:function(e,n,t){c.getMediator().notify("addConnection",[e,n,t])},onChange:function(e,n,t){c.getMediator().notify("changeConnection",[e,n,t])},onRemove:function(e,n,t){c.getMediator().notify("removeConnection",[e,n,t])}}),t.setInstanceCollectionEvents({onAdd:function(e,n,t){c.getMediator().notify("addInstance",[e,n,t])},onChange:function(e,n,t){c.getMediator().notify("changeInstance",[e,n,t])},onRemove:function(t,i,r){var o,a=CollectionUtils.getImpactedConnections(null,t.id);if(e.is(a))for(o=0;o<a.length;o++)n.removeConnection(a[o].id);c.getMediator().notify("removeInstance",[t,i,r])}}),d.push(c.addExternalListener("reset",n.resetAll))},onStop:function(){var e,n;for(t.removeCollectionEvents(),e=0,n=d.length;e<n;e++)c.removeExternalListener(d[e]);d=[]},findSomeConnection:function(e,n){return t.findSomeConnection(e,n)},findConnections:function(e){return t.findConnections(e)},getAllChildrenFromCollection:function(e){var n={referencesPID:[e],instancesPID:[]};return t.expandOnBackbone(e,n),n},getInstancesFromCollection:function(e){return t.getInstancesFromCollection(e)},getParentInstancesFromCollection:function(e){return t.getParentInstancesFromCollection(e)},getReference:function(e){return t.getReferenceFromCollection(e)},getAllReferences:function(){return t.getAllReferences()},getReferencesFromArray:function(e){return t.getReferencesArrayFromCollection(e)},getReferenceModelFromInstance:function(e){return t.getReferenceModelFromInstance(e)},getAggregatingReferenceModelFromInstance:function(e){return t.getAggregatingReferenceModelFromInstance(e)},getReferenceModel:function(n){var t=null,i=this.getReference(n),r=null,o=null;return e.is(i)||(t=this.getInstance(n),e.is(t)?i=this.getReferenceModelFromInstance(t):c.getLogger().debug("Failed to get reference model. No instance or reference model found for PID: "+n)),a.isMdlAccessTestEnabled()&&(e.is(t)&&(c.getLogger().debug("Manipulated instance is: "),r=t.pick("PID","PLM_ExternalID","V_TreeOrder","isAggregatedBy","isInstanceOf"),c.getLogger().debug(JSON.stringify(r,null,4))),e.is(i)&&(c.getLogger().debug("Manipulated reference is: "),o=i.pick("PID","type","V_Name","V_description"),c.getLogger().debug(JSON.stringify(o,null,4)))),i},getReferenceIdFromInstance:function(n){var t,i=null;return t=this.getInstance(n),e.is(t)?i=t.get("isInstanceOf"):c.getLogger().debug("Failed to get reference Id. No instance model found for PID: "+n),i},isReference:function(e){return t.isReference(e)},isInstance:function(e){return t.isInstance(e)},getInstance:function(e){return t.getInstanceFromCollection(e)},getConnection:function(e){return t.getConnectionFromCollection(e)},createReference:function(e,n){return t.createRef(e,n)},createWorkOrderFromProcess:function(e,n){return t.createWorkOrderFromProcess(e,n)},addReference:function(e,n){return t.addRef(e,n)},fetchRefList:function(e,n){return t.fetchRefList(e,n)},fetchAttributes:function(e,n){t.fetch(e,n)},fetchReferences:function(e,n){t.fetchReferences(e,n)},fetchRoot:function(e,n){i.fetchRoot(e,n)},fetchMultiplePromise:function(e,n){return i.fetchMultiplePromise(e,n)},getProductScopedLinksFromIndex:function(e,n,t){i.getProductScopedLinksFromIndex(e,n,t)},navigateScopesFromIndex:function(e,n,t){i.navigateScopesFromIndex(e,n,t)},navigateScopesFromDB:function(e,n,t){t.onComplete=n,i.getProductScopedLinksFromDB(e,t)},navigateOnIndex:function(e,n,t){i.navigateOnIndex.navigateOnIndex(e,n,t)},getReferenceFromInstance:function(e,n,t){i.navigateOnIndex.getReferenceFromInstance(e,n,t)},updateReference:function(n,i){return i.isFacet=!!e.is(c.getConfig().isFacet)&&c.getConfig().isFacet,t.updateRef(n,i)},updateReferences:function(e,n){return t.updateRefs(e,n)},deleteReference:function(e,n){return t.deleteRef(e,n)},removeReference:function(e,n){t.removeRef(e,n)},createInstance:function(e,n){return t.createInst(e,n)},addInstance:function(e,n){return t.addInst(e,n)},fetchInstance:function(e,n){return t.fetchInst(e,n)},updateInstance:function(e,n){return t.updateInst(e,n)},updateInstances:function(e,n){return t.updateInsts(e,n)},deleteInstance:function(e,n){return t.deleteInst(e,n)},removeInstance:function(e,n){t.removeInstance(e,n)},removeConnection:function(e,n){t.removeConnection(e,n)},createConnection:function(e,n){return t.createConn(e,n)},addConnection:function(e,n){return t.addConn(e,n)},updateConnection:function(e,n){return t.updateConn(e,n)},deleteConnection:function(e,n){return t.deleteConn(e,n)},needToQueryForConnections:function(e){return t.needToQueryForConnections(null,e)},needToQueryForChildren:function(e){return t.needToQueryForChildren(e)},findMissingLinkedObjects:function(n,t,r){i.findMissingLinkedObjects(n,function(n){e.is(t,"function")&&t.call(null,n)},r)},getImpacted:function(n,i,r){var o,a,s,u,c,l,d=[],g=[],f=[],m=[],p=this.getInstance(n),C={};if(r=r||{},e.is(r.relationTypes)?C.relationTypes=r.relationTypes:(e.is(r.excludeRelationTypes)&&(C.excludeRelationTypes=r.excludeRelationTypes),e.is(r.excludeTimeConstraintType)&&(C.excludeTimeConstraintType=r.excludeTimeConstraintType)),e.is(p)?(a=this.getReferenceModelFromInstance(p),s=e.is(r.onlyInstanceRelations)&&r.onlyInstanceRelations?null:a.id,f=t.getImpactedConnections(s,p.id,C),m=[a.id,p.id]):(C.isRefRefOnly=!0,f=t.getImpactedConnections(n,null,C),m=[n]),d=f,e.is(i)&&!0===i){for(o=0;o<f.length;o++)u=f[o].get("from"),c=f[o].get("to"),l=e.is(u,"array")?u[u.length-1]:u,m.indexOf(l)>-1?g.push(c):g.push(u);d=g}return d},getConnectionsByModel:function(n,t,o){var a,s=e.is(n)?n.get("PPRTYPE"):e.is(t)?t.get("PPRTYPE"):null;o=o||{},a={forceDBMode:!!e.is(o.forceDBMode)&&o.forceDBMode,relationTypes:"array"===e.typeOf(o.relationTypes)?o.relationTypes:r.getAllConfiguredRelations(s,"read"),isRefRefOnly:!!e.is(o.isRefRefOnly)&&o.isRefRefOnly,silentMode:!!e.is(o.silentMode)&&o.silentMode,onComplete:e.is(o.onComplete)?o.onComplete:null,onFailure:e.is(o.onFailure)?o.onFailure:null},i.getConnectionsByModel(n,t,a)},getAltSubContextProductPromise:function(e,n){return i.getAltSubContextProductPromise(e,n)},getMultipleAltSubContextProductsPromise:function(e){return i.getMultipleAltSubContextProductsPromise(e)},getAlternateEnggItemPromise:function(e){return i.getAlternateEnggItemPromise(e)},getEngAlternatesFromBLPromise:function(e){return i.getEngAlternatesFromBLPromise(e).then(function(e){const{altSubInfosResult:t,someErrorOccured:i}=e;return i&&c.getLogger().warn("DELWKODatabasePlugin",u.getNLSValue("AltSub.BL.SomeError")),n.resolve(t)})},getAlternateEnggItemInfoPromise:function(n,t){var r=c.getService("ConfigService"),o=null;return e.is(r)&&(o=r.getUserId()),i.getAlternateEnggItemInfoPromise(n,t,o)},getMfgItemsFromDesignAlternatesPromise:function(e,n,t){return i.getMfgItemsFromDesignAlternatesPromise(e,n,t)},fetchInstancesAndTheirReferences:function(e,n){return i.fetchInstancesAndTheirReferences(e,n)},addToCollections:function(e){t.addToCollections(e)},parseServerObjects:function(n,i){var r,o,a=i.stackedObjects?i.stackedObjects:{stackedReferences:[],stackedInstances:[],stackedConnections:[],deletedObjects:[]},s={referencePIDs:[],instancePIDs:[]},u=!e.is(i.silentOpt,"boolean")||i.silentOpt,c=this.getConnectionParser();e.is(n.instancesAndReferences)&&n.instancesAndReferences.forEach(function(e){r=e.attributesValue,Object.prototype.hasOwnProperty.call(r,"isInstanceOf")?(s.instancePIDs.push(r.PID),a.stackedInstances.push(r)):(s.referencePIDs.push(r.PID),a.stackedReferences.push(r))}),e.is(n.deletedObjects)&&n.deletedObjects.forEach(function(e){a.deletedObjects.push(e)}),e.is(n.connections)&&n.connections.forEach(function(e){c.parse(e,a)}),o=e.merge(a,{silentMode:u,onComplete:function(){e.is(i.onComplete)&&i.onComplete(s)}}),t.addToCollections(o)},getConnections:function(n){e.is(n)&&e.is(n.connections,"array")&&Object.keys(n.connections).length>0&&n.connections.forEach(function(e){"DELAsmProcessCanUseCnx"===e.get("type")&&c.getMediator().notify("addLinkedObject",[e])})},getDocuments:function(n){var t,i,r=[];if(e.is(n)&&e.is(n.documents,"object")&&Object.keys(n.documents).length>0&&(i=c.getPlugins("DocumentPlugin"),e.is(i)&&(i=i.instance,e.is(n.documents,"object")))){for(t in n.documents)Object.prototype.hasOwnProperty.call(n.documents,t)&&(r=r.concat(n.documents[t]));i.getDocumentInfo(r,{onComplete:function(r){var o,a=[];for(o=0;o<r.data.length;o++)i.addDocument(r.data[o],{silent:!0});for(t in n.documents)Object.prototype.hasOwnProperty.call(n.documents,t)&&e.is(n.documents[t])&&n.documents[t].length>0&&(a.push(t),n.documents[t].forEach(function(e){i.addDocumentConnection(t,e,{silent:!0})}));c.getMediator().notify("addDocumentConnections",[a])}})}},getConnectionsFromServer:function(n,t,r){var o=r||{},a=this,s={noTimeout:!0};c.getMediator().notify("startProgress",s),i.getConnectionsFromServer(n,function(n){e.is(t,"function")&&t.call(null,n),a.getDocuments(n),c.getMediator().notify("stopProgress",s)},o)},getDescendantsFromServer:function(n,t,r){var o=r||{},a=this;o.excludeBOTypes=["DELLmiProdSystemIOPort"],o.excludeRelationTypes=["DELLmiExecTimeConstraintRelation"],i.getDescendantsFromServer(n,function(n){var i=e.is(o.context)?o.context:null;e.is(t,"function")&&t.call(i,n),a.getDocuments(n),a.getConnections(n)},o)},getInverseConnectionsFromServer:function(e,n){i.getInverseConnectionsFromServer(e,n)},resetAll:function(){t.reset(),c.getMediator().notify("refreshAll")},resetCollections:function(e){t.reset(e)},setSelectPredicate:function(e,n){i.setSelectPredicate(e,n)},getConnectionParser:function(){return i.getConnectionParser()},getNavigateOnIndex:function(){return o.getNavigateOnIndex()},isNavigateOnDemand:function(){return o.isNavigateOnDemand()},isAuthoringMode:function(){var e=!0;return o.getNavigateOnDatabasePreference()||(e=s.isDbMode()),e},isInstancePossible:function(n,t){var i,r,a,s=!0;return e.is(t,"string")?r=t:(i=t,r=t.get("type")),-1===this.getValidChildTypes(n).indexOf(r)?s=!1:n&&i&&(l(i,n)?s=!1:"RESOURCE"!==(a=i.get("PPRTYPE"))&&"PRODUCT"!==a||(s=o.isMGALicenseAvailable())),s},getValidChildTypes:function(n){var t,i,o,a=this,s=[],u=0,c=0;return e.is(n)&&(t=n.get("type"),s=r.getValidChildTypes(t),this.isOperation(n)&&(i=n.get("PID"),this.getInstancesFromCollection(i).every(function(e){return a.isOperation(e)?(u++,o="WORKINSTRUCTION"):a.isWorkInstruction(e)&&(c++,o="OPERATION"),!0}),(u>0||c>0||this.needToQueryForChildren(n))&&(s=s.filter(function(e){return!(r.getPPRType(e)===o)})))),s},getPPRType:function(n){var t,i=n;return e.is(n,"string")?i=this.getReferenceModel(n):e.is(n)&&n.isInstance()&&(i=this.getReference(n.get("isInstanceOf"))),e.is(i)&&(t=i.get("PPRTYPE"),e.is(t)||(t=r.getPPRType(i.get("type")))),t},isSystem:function(n){return!(!e.is(n)||"SYSTEM"!==this.getPPRType(n))},isOperation:function(n){return!(!e.is(n)||"OPERATION"!==this.getPPRType(n))},isWorkInstruction:function(n){return!(!e.is(n)||"WORKINSTRUCTION"!==this.getPPRType(n))},isProcess:function(n){return!(!e.is(n)||"PROCESS"!==this.getPPRType(n))},isResource:function(n){return!(!e.is(n)||"RESOURCE"!==this.getPPRType(n))},getWhereUsedReferences:function(e,n){i.getWhereUsedReferences(e,n)},getFilteredInstancesFromCollection:function(e,n){return t.getFilteredInstancesFromCollection(e,n)},removeFilterFromCollection:function(e,n){t.removeFilterFromCollection(e,n)},getExecuteByBlockPromise:function(e){return o.getExecuteByBlockPromise(e)},transformToRIROccurrencePath:function(e){return t.transformToRIROccurrencePath(e)},transformRIRToAbsolutePath:function(e){return t.transformRIRToAbsolutePath(e)},isValidPID:function(n){var t=!1;return e.is(n,"string")&&n.length>0&&(t=!0),t},getLastElement:function(n){var t=null;return e.is(n,"array")&&(t=n.length>0?n[n.length-1]:null),t},getLastElementInstanceInfoPID:function(n,t){var i,r=null,o=null;return i=this.getLastElement(n),this.isValidPID(i)&&(r=this.getInstance(i),e.is(r)&&(o=r.get(t),this.isValidPID(o)||(o=null))),o},arrayCompare:function(n,t){var i,r;if(!e.is(n,"array")||!e.is(t,"array"))return!1;if(n.length!==t.length)return!1;for(i=0,r=n.length;i<r;i++)if(n[i]instanceof Array&&t[i]instanceof Array){if(!this.arrayCompare(n[i],t[i]))return!1}else if(n[i]!==t[i])return!1;return!0},groupingBy:function(e,n,t){var i=new Map;return e.forEach(function(e){var r=n(e),o=t(e);i.has(r)?i.set(r,i.get(r).concat(o)):i.set(r,[].concat(o))}),i},hasConnection:function(e){return t.hasConnection(e)},traverseInstanceModels:function(e,n){t.traverseInstanceModels(e,n)},syncMaturity:function(e,n,i,r,o){t.syncMaturity(e,n,i,r,o)},getCurrentStates:function(e,n,i){t.getCurrentStates(e,n,i)},getSequencingMode:function(e,n){t.getSequencingMode(e,n)},setSequencingMode:function(e,n,i){t.setSequencingMode(e,n,i)},manageLinearProductFlowsOnCreateInstance:function(e){t.manageLinearProductFlowsOnCreateInstance(e)},manageLinearProductFlowsOnCreateInstancePID:function(e){t.manageLinearProductFlowsOnCreateInstance(t.getInstanceFromCollection(e))},manageLinearProductFlowsOnDeleteInstance:function(e){t.manageLinearProductFlowsOnDeleteInstance(e)},manageLinearProductFlowsOnDeleteInstancePID:function(e){t.manageLinearProductFlowsOnDeleteInstance(t.getInstanceFromCollection(e))},detachExtn:function(e,n){t.detachExtn(e,n)}}}}),define("DS/DELWKOModelPlugins/DELWKOAttributePlugin",["UWA/Core","DS/DELWKODicoServices/DELWKODicoUtils","DS/DELPPWModelServices/CollectionUtils","DS/DELPPWResourceServices/ResourceUtils","DS/DELPPWModelServices/ModelUtils"],function(e,n,t,i,r){"use strict";return function(){var o,a,s,u,c,l,d,g,f,m,p,C,I,P,y,h,v,b,D,L,R,M,T,S,w,E,x,A,V,O,F,N,U,W,k=/(\d+)\/(\d+)\/(\d+)@\d+:\d+:\d+:\w+/;return o=function(n){var t="";return e.is(n)&&(t=e.is(n.Type)?n.Type:""),t},U=function(e){var n,t,i,r,o,a,s,u,c,l;return e?(n=e.split("@"),t=e,n.length>1&&(r=(i=n[0].split("/"))[0],o=i[1]-1,a=i[2],u=(s=n[1].split(":"))[0],c=s[1],l=s[2],(t=new Date).setUTCHours(u),t.setUTCMinutes(c),t.setUTCSeconds(l),t.setUTCFullYear(r),t.setUTCDate(1),t.setUTCMonth(o),t.setUTCDate(a)),t):null},W=function(n){var t,i="";return"NULL"===n?i="":(k.test(n)&&(n=U(n).toUTCString()),t=e.is(n,"number")?n:Date.parse(n),isNaN(t)||(i=new Date(t))),i},a=function(e){return"Boolean"===o(e)},s=function(e){return"Double"===o(e)},u=function(e){return"Integer"===o(e)},c=function(e){return"Date"===o(e)},l=function(e){return"String"===o(e)},d=function(n,t,i){var r=!1;return e.is(n)&&(r=e.is(n.Protection)&&1!==n.Protection&&2!==n.Protection,i||(r|=!0===n.isReadOnly||e.is(n.UIAccess)&&"ReadOnly"===n.UIAccess)),e.is(t)&&(r|=!0===t.readOnly||!1===t.visible),r},g=function(n){var t=!0;return e.is(n)&&(t=n.visible),t},m=function(n){return e.is(n)&&e.is(n.MultiValuated)&&"Yes"===n.MultiValuated},f=function(e){return c(e)&&m(e)},p=function(n){return e.is(n.MultiLine)&&"Yes"===n.MultiLine},C=function(n,t){var i=!1;return i=e.is(n)&&e.is(n.HasRangeDefined)&&"Yes"===n.HasRangeDefined,e.is(t)&&Array.isArray(t.authorizedValues)&&(i=i||t.authorizedValues.length>0),i},I=function(n){return e.is(n.Magnitude)&&""!==n.Magnitude&&!C(n)},P=function(n,t,i){var r;if(e.is(t)&&Array.isArray(t.authorizedValues)&&t.authorizedValues.length>0){for(r=0;r<t.authorizedValues.length;r++)if(t.authorizedValues[r].NLS===i)return r;return 1}for(r=0;r<n.AuthorizedValues.length;r++)if(y(n,r)===i)return r},y=function(e,n){return c(e)?O(1e3*e.AuthorizedValues[n].NLS):e.AuthorizedValues[n].NLS},h=function(e,n){return n<0?null:e.AuthorizedValues[n].Name},v=function(n,t){var i,r=[];if(e.is(t)&&Array.isArray(t.authorizedValues)&&t.authorizedValues.length>0){for(i=0;i<t.authorizedValues.length;i++)r.push(t.authorizedValues[i].NLS);return r}for(i=0;i<n.AuthorizedValues.length;i++)r.push(y(n,i));return r},b=function(n,t,i){var r;if(e.is(t)&&Array.isArray(t.authorizedValues)&&t.authorizedValues.length>0){for(r=0;r<t.authorizedValues.length;r++)if(t.authorizedValues[r]===i)return u(n)?r+1:t.authorizedValues[r];return 1}for(r=0;r<n.AuthorizedValues.length;r++)if(y(n,r)===i)return u(n)?Number.isInteger(parseInt(n.AuthorizedValues[r].Name))?n.AuthorizedValues[r].Name:(r+1).toString():n.AuthorizedValues[r].Name;return i},D=function(n,t){var i=[];return Array.isArray(t)?(C(n)&&e.is(n.AuthorizedValues,"array")&&t.forEach(function(t){n.AuthorizedValues.some(function(n){return!(!e.is(n.Name,"string")||t!==n.Name||(i.push(n.NLS),0))})}),i):i},L=function(n){return e.is(n.DefaultValue)?n.DefaultValue:""},R=function(e){return I(e)?e.Magnitude:""},M=function(e){return e.FullName},T=function(n){return e.is(n.MaxLength)?n.MaxLength:0},S=function(e){var n;return u(e)?"^[-+]?([0-9]+)$":s(e)?"^([+-]?([1-9][0-9]*)|(0))([.,][0-9]+)?":(n=T(e))<=0?null:"^.{0,"+n+"}$"},w=function(n){var t="";return e.is(n)&&(t=e.is(n.NLS)?n.NLS:n.Name),t},E=function(n,t){return!!e.is(n)&&Object.prototype.hasOwnProperty.call(n._attributes,t)},x=function(n){return"array"!==e.typeOf(n)&&(n=e.is(n)&&n.length>0&&"NULL"!==n&&"null"!==n?n.split(r.getPrefSeparator()):[]),n},A=function(n){var t,i,o=[];if(Array.isArray(n))for(t=0;t<n.length;t++)i=F(n[t]),e.is(i)&&o.push(i);else if(e.is(n)&&n.length>0&&"NULL"!==n&&"null"!==n)for(n=n.split(r.getPrefSeparator()),t=0;t<n.length;t++)i=F(n[t]),e.is(i)&&o.push(i);return o},V=function(n,t,i){var o="",a=x(n),s=widget.lang,u=r.getPrefSeparator(),c=e.is(t,"string")&&"Double"===t,l=e.is(t,"string")&&"Integer"===t,d=!e.is(i,"boolean")||i,g=l?1:2;return e.is(a,"array")&&a.forEach(function(e,n){var t=null;n>0&&(o+=u),(l||c)&&d?(t=l?parseInt(e):parseFloat(e),isNaN(t)||(t=t.toLocaleString(s,{minimumSignificantDigits:g,maximumSignificantDigits:21}),o+=t)):o+=e}),o},O=function(e,n,t){var i=widget.lang,r=W(e);return isNaN(r)||""===r?"":!0===n?r.toLocaleString(i,t):r.toLocaleDateString(i,t)},F=function(e){return W(e)},N=function(t,i){var r,o,a=!1;return e.is(t)&&(r="string"===e.typeOf(t)?t:t.get("type"),o=n.getTypeExtnInfo(r),Array.isArray(o)&&o.length>0&&-1!==i.indexOf(".")&&-1!==o.indexOf(i.split(".")[0])&&(a=!0)),a},{getNodeAndColumnInfos:function(i,r){var o,a,s,u,c,l,d,g,f,m={};if(u=this.getAttributeInfoFromColumn(r),i&&(a="instance"===u.objType?i.getInstancePID():i.getReferencePID()),m.attributeName=u.attributeName,m.dataIndex=u.dataIndex,m.instOrRef=u.objType,"instance"===u.objType?m.objectToBeModified=t.getInstanceFromCollection(a):m.objectToBeModified=t.getReferenceFromCollection(a),e.is(m.objectToBeModified)&&e.is(r)&&e.is(r.dicoType,"array")&&r.dicoType.length>0)for(d=r.dicoType.length,g=r.dicoType,f=0;f<d;f++)if(l=g[f]+"."+u.dataIndex,e.is(m.objectToBeModified.get(l))){u.attributeName=u.dataIndex=l;break}return m.attributeName=u.attributeName,m.dataIndex=u.dataIndex,m.instOrRef=u.objType,m.attributeInfo=n.getAttributeInfo(u.attributeName),e.is(m.attributeInfo)||(e.is(m.objectToBeModified)?(s=m.objectToBeModified.get("type"),o=e.is(s,"string")?m.objectToBeModified.get("type")+"."+u.dataIndex:u.dataIndex):o=u.dataIndex,m.attributeInfo=n.getAttributeInfo(o),e.is(m.attributeInfo)||(m.attributeInfo={})),e.is(m.objectToBeModified)?(m.attributeDef={},c=n.getTypeMaskInfo(m.objectToBeModified.get("type")),e.is(c)&&e.is(Object.prototype.hasOwnProperty.call(c,u.dataIndex))&&(m.attributeDef=c[u.dataIndex])):m.attributeDef={},m.attributeNLSTitle=w(m.attributeInfo),m},getAttributeInfoFromColumn:function(n){var t,i={};return e.is(n)&&e.is(n.dataIndex)&&("tree"===n.dataIndex?(i.dataIndex=n.label,i.objType=n.labelIsOnRef?"reference":"instance",i.attributeName=e.is(n.dicoType)?n.dicoType+"."+i.dataIndex:i.dataIndex):e.is(n.dicoType,"array")&&n.dicoType.length>0?(t=n.dataIndex.split("."),i.objType=t[t.length-1],i.dataIndex=t[0]):1===(t=n.dataIndex.split(".")).length?(i.dataIndex=t[0],i.attributeName=e.is(n.text)?n.text:e.is(n.dicoType)?n.dicoType+"."+i.dataIndex:i.dataIndex):(i.objType=t[t.length-1],2===t.length?(i.dataIndex=t[0],i.attributeName=e.is(n.dicoType)?n.dicoType+"."+i.dataIndex:i.dataIndex):3===t.length&&(i.dataIndex=t[0]+"."+t[1],i.attributeName=i.dataIndex))),i},getColumnDisplayValue:function(t){var r=this.getAttributeInfoFromColumn(t),o=n.getAttributeInfo(r.attributeName);return e.is(o)?"PLMEntity.description"===o.FullName?i.getNLSValue("description"):this.getNLS(o):e.is(r.attributeName)?"MANAGESTEPOPERATIONSUI"===t.displayType?r.attributeName:i.getNLSValue("Column."+r.attributeName):i.getNLSValue("Column."+r.dataIndex)},getObjectAndAttributeInfos:function(t){var i,r=this,o=[],a=function(t){var i=n.getAttributeInfo(t.name,null),a={attributeName:t.name,dataIndex:t.name.indexOf(".")>-1?t.name.split(".")[1]:t.name,attributeNLSTitle:r.getNLS(i),attributeInfo:i,readOnly:!(!e.is(t.readOnly)||!0!==t.readOnly)};o.push(a)};if("array"!==e.typeOf(t))a(t);else for(i=0;i<t.length;i++)a(t[i]);return o},isBoolean:function(e){return a(e)},isDouble:function(e){return s(e)},isInteger:function(e){return u(e)},isDate:function(e){return c(e)},isString:function(e){return l(e)},getFormattedDate:function(e,n,t){return O(e,n,t)},getDate:function(e){return F(e)},isReadOnly:function(e,n,t){return d(e,n,t)},isVisible:function(e){return g(e)},isMultiValuated:function(e){return m(e)},isMultiDate:function(e){return f(e)},isMultiLine:function(e){return p(e)},hasRangeDefined:function(e,n){return C(e,n)},hasMagnitude:function(e){return I(e)},getAuthorizedValueIndex:function(e,n,t){return P(e,n,t)},getAuthorizedValueNLS:function(e,n){return y(e,n)},getAuthorizedValueDB:function(e,n){return h(e,n)},getAuthorizedValuesNLSList:function(e,n){return v(e,n)},getAuthorizedValue:function(e,n,t){return b(e,n,t)},getAuthorizedNLSvalues:function(e,n,t){return D(e,n)},getDefaultValue:function(e){return L(e)},getMagnitude:function(e){return R(e)},getFullName:function(e){return M(e)},getMaxLength:function(e){return T(e)},getPattern:function(e){return S(e)},getNLS:function(e){return w(e)},getType:function(e){return o(e)},doesAttributeExist:function(e,n){return E(e,n)},getValueAsArray:function(e,n){return x(e)},getValueAsDateArray:function(e){return A(e)},getValueAsString:function(e,n,t){return V(e,n,t)},getNLSForUnit:function(n){var t="";return e.is(n)&&I(n)&&e.is(n.ManipulationUnit,"string")&&(t=0!==n.ManipulationUnit.length?i.getNLSForUnit(n.Magnitude,n.ManipulationUnit):i.getNLSForUnit(n.Magnitude)),t},getMagnitudeValue:function(n,t,i){return I(t)&&(n=e.is(n,"array")?V(n,o(t),i):"NULL"===n?"":n),n},convertDateToStandard:function(n){var t,i,r,o,a,s,u,c=widget.lang;return n?(t=e.is(n,"date")?e.clone(n):new Date,i=n.getUTCFullYear(),(r=n.getUTCMonth()+1)<10&&(r="0"+r),(o=n.getUTCDate())<10&&(o="0"+o),(a=n.getUTCHours())<10&&(a="0"+a),(s=n.getUTCMinutes())<10&&(s="0"+s),(u=n.getUTCSeconds())<10&&(u="0"+u),t.setYear(i),t.setMonth(n.getMonth()),t.setDate(o),t.setHours(a),t.setMinutes(s),t.setSeconds(u),{value:n.toLocaleString(c),valueDB:i+"/"+r+"/"+o+"@"+a+":"+s+":"+u+":GMT"}):{value:"",valueDB:""}},getConnectionTypeWithMBOM:function(e){var n;return t.connections._models.forEach(function(t){t.id.contains(e)&&(n=t.id.split("|")[0])}),n},getDimensions:function(){return i.getDimensions()},getDimension:function(e){return i.getDimension(e)},addAttributeInfo:function(e,t){return n.addAttributeInfo(e,t)},isAttrApplicableForType:function(e,n){return N(e,n)}}}}),define("DS/DELWKOModelPlugins/DELWKODicoPlugin",["UWA/Core","DS/DELWKODicoServices/DELWKODicoUtils"],function(e,n){"use strict";return function(t){var i={},r={};return{getAttributeProperties:function(){return i},getMagnitudePreferences:function(){return r},getAttributeInfo:function(e,t){return n.getAttributeInfo(e,t)},getTypeInfo:function(e){return n.getTypeInfo(e)},getTypeMaskInfo:function(e){return n.getTypeMaskInfo(e)},getPPRType:function(e){return n.getPPRType(e)},getTypeHierarchy:function(e){return n.getTypeHierarchy(e)},getParentTypes:function(e){return n.getParentTypes(e)},getReadOnlyTypes:function(){return n.getReadOnlyTypes()},isAKindOf:function(e,t){return n.isAKindOf(e,t)},getConfiguredRelations:function(e,t,i){return n.getConfiguredRelations(e,t,i)},getConfiguredCustomRelations:function(e,t,i){return n.getConfiguredCustomRelations(e,t,i)},isRelationTypeConfigured:function(e,t,i,r){var o;return o=n.getPossibleRelations(t,i,r),Array.isArray(o)&&o.indexOf(e)>-1},getPossibleRelations:function(e,t,i){return n.getPossibleRelations(e,t,i)},getPossibleRelationTypes:function(i,r,o,a){var s,u,c=i.get("type"),l=r.get("type");if(c&&l)return s=n.getPossibleRelations(c,l,"write"),e.is(a)&&e.is(o)&&o.get("isAggregatedBy")===a.get("isAggregatedBy")||((u=s.indexOf("DELLmiMaterialPathCnxCust"))>-1&&s.splice(u,1),(u=s.indexOf("DELLmiMaterialPathCnxCust_inverse"))>-1&&s.splice(u,1),(u=s.indexOf("DELLmiTimeConstraintCnx"))>-1&&s.splice(u,1),(u=s.indexOf("DELLmiTimeConstraintCnx_inverse"))>-1&&s.splice(u,1)),s;t.getLogger().debug(" No PPRTypes on models")},isReferencesHasReadOnlyType:function(n,t){let i=!1,r=null,o=t||{};const a=this,s=function(e){let n=r.has(e);return n||(n=a.getParentTypes(e).some(function(e){return r.has(e)})),n};if(Array.isArray(o.excludeReferenceTypes)&&o.excludeReferenceTypes.length>0?(r=new Set(this.getReadOnlyTypes()),o.excludeReferenceTypes.forEach(function(e){r.delete(e)})):r=this.getReadOnlyTypes(),e.is(n,"string"))i=s(n);else if(e.is(n,"object")){const e=n.get("type");i=s(e)}else Array.isArray(n)&&(i=n.some(function(n){if(e.is(n)){const e=n.get("type");return s(e)}return!1}));return i},isLinkPossible:function(e,n,t,i){var r=this.getPossibleRelationTypes(e,n,t,i),o=this.getPossibleRelationTypes(n,e,i,t);return r.length>0||o.length>0},isEntityInstance:function(e){return n.isEntityInstance(e)},isReparentPossible:function(e){var t=n.getAcceptedPPRTypesForActions();return null===t||t.REPARENT.PPRType.includes(e)},isReorderPossible:function(e){var t=n.getAcceptedPPRTypesForActions();return null===t||t.REORDER.PPRType.includes(e)},getAcceptedBaseTypesForActions:function(){return n.getAcceptedBaseTypesForActions()}}}}),define("DS/DELWKOModelPlugins/DELWKOTreeViewPlugin",["UWA/Core","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWResourceServices/ResourceUtils","DS/DELWKOModelPlugins/DELWKOViewPreferencesUI","DS/DELPPWViewPlugins/TreeViewPlugin/LayoutPreferencesUI","DS/CoreEvents/Events"],function(e,n,t,i,r,o){"use strict";return function(a){var s,u,c,l,d,g,f,m,p,C,I,P,y,h,v,b,D,L,R,M={"revision.reference":{command:"HistoryHdr"},"current.reference":{command:"MaturityHdr"},"owner.reference":{command:"ActionBar_ChangeOwner"},"organization.reference":{command:"ActionBar_ChangeOwner"},"project.reference":{command:"ActionBar_ChangeOwner"},"EnterpriseExtension.V_PartNumber.reference":{command:"SetThePartNumber",defaultValue:t.getNLSValue("Column.EnterpriseExtension.V_PartNumber.DefaultValue")}},T={Type:"referenceType.group",Reference:"referenceID.group"},S={"referenceType.group":"type.reference","referenceID.group":"PID.reference"},w={},E=new Set,x=new Set,A=[],V="",O=Object.create(null);return y=function(e){var n=-1;return I.some(function(t,i){var r=!1;return t.viewID===e&&(n=i,r=!0),r}),n},d=function(e){return(""!==s.getConfigurationPID()?s.getConfigurationPID()+"_":"")+e+"_ColumnPreferences"},g=function(e){return s.getPreference(d(e))},f=function(e,n){return s.setPreference(d(e),n)},m=function(){var n,t=null;return n=s.getPreference("widgetLayoutValues"),e.is(n)&&(t=e.Json.decode(n)),t},p=function(n){s.setPreference("widgetLayoutValues",e.Json.encode(n))},C=function(t,i){var r,o,s,u,c=n.getXMLValues(i),l=g(t);if(l=e.is(l)?l:[],c=e.is(c)?e.clone(c.Config.Columns.Column):[],c=e.is(c,"array")?c:[c],u=a.getPlugins("CfgColumnsPlugin"),e.is(u)){for(u=u.instance,r=l.length-1;r>=0;r--){for(s=!1,o=c.length-1;o>=0;o--)if(c[o].dataIndex===l[r].dataIndex){e.is(c[o].mandatory,"boolean")&&(l[r].colVisibility.mandatory=c[o].mandatory,c[o].mandatory&&(l[r].colVisibility.display=c[o].mandatory)),s=!0,c.splice(o,1);break}s||l.splice(r,1)}const n=u.getConfigColDataIndexSet();c.filter(function(t){let i=!0;return e.owns(t,"displayType")&&"CFG"===t.displayType&&(n.has(t.dataIndex)||(i=!1)),i}).forEach(function(n){l.push({colVisibility:{display:!e.is(n.display)||n.display,mandatory:!!e.is(n.mandatory)&&n.mandatory},dataIndex:n.dataIndex,dicoType:n.dicoType,width:e.is(n.width)?n.width:"auto",minWidth:e.is(n.minWidth)?n.minWidth:"100"})}),f(t,l)}return l},P=function(){var n,r,o,s,u,c={views:[],viewPreferences:{},viewIcons:{}};r=a.getPlugins("AttributePlugin"),n=a.getPlugins("UXComponentsPlugin"),o=a.getPlugins("RootsPlugin"),e.is(r)&&e.is(n)&&e.is(o)?(r=r.instance,n=n.instance,o=o.instance,u=n.getComponent("WUXFrameWindowsManager").getFrameWindow(a.getConfig().appContext),s=new i(a,u,n,r,o),I.forEach(function(e){var n=g(e.viewID);c.views.push(e.viewID),c.viewPreferences[e.viewID]=n,e.viewIcon&&(c.viewIcons[e.viewID]=t.getIconElem(e.viewIcon))}),s.buildView(c,function(n){var t,i;for(t in n)e.owns(n,t)&&(i=n[t],f(t,i));a.getMediator().notify("TreeViewPrefModified")}).show()):a.getLogger().debug("Attribute Plugin or UXComponents Plugin or Roots Plugin is not available.")},h=function(){var n,t,i,o={viewsInDockingZones:l,viewsInFreeZone:c};t=a.getPlugins("UXComponentsPlugin"),e.is(t)&&(t=t.instance,i=m(),(n=new r(u,t,a.getConfig().appContext,i,o)).showDialog(function(){var e=n.decipherPreferencesFromButtonStates();p(e),a.getMediator().notify("widgetLayoutChanged")}))},v=function(e){return M[e]},b=function(n){return n&&e.is(w[n])?w[n]:[]},D=function(n,t){n&&t&&(e.is(w[n])||(w[n]=[]),w[n].push(t))},R=function(){var e,n=!1;for(e in w)if(Array.isArray(w[e])&&w[e].length>0){n=!0;break}return n},L=function(e){e&&(w[e]=[])},{name:"TreeViewPlugin",onStart:function(n){I=[],l={},c={},s=a.getService("ConfigService"),e.is(s)||a.getLogger().debug("TreeViewPlugin initialization failed as ConfigService is not available"),u=a.getService("LayoutService"),e.is(u)||a.getLogger().debug("TreeViewPlugin initialization failed as LayoutService is not available"),A.push(a.addExternalListener("EditViewPreferencesCmd",P)),A.push(a.addExternalListener("LayoutPreferences",h)),n()},onStop:function(){var e,n;for(I=null,l=null,c=null,e=0,n=A.length;e<n;e++)a.removeExternalListener(A[e]);A=[],E.clear()},registerViewforColumnPref:function(n){var t=!1;return e.is(n)&&(e.is(n.viewID)||e.is(n.columnConfigName))?-1===y(n.viewID)?(I.push(n),C(n.viewID,n.columnConfigName),t=!0):a.getLogger().debug(n.viewID+" Module has already registered for Column Preferences"):a.getLogger().debug(" viewID or columnConfigName has not been defined, so cannot register for  Column Preferences"),t},syncViewColumnPreferences:function(n){var t,i,r;if(e.is(n))return(t=y(n))>-1?(i=I[t],C(i.viewID,i.columnConfigName),r=this.getViewColumnPreferences(i.viewID)):a.getLogger().debug(n+" Module has already registered for Column Preferences"),r;a.getLogger().debug(" viewID has not been defined, so cannot sync Column Preferences")},getViewColumnPreferences:function(t,i){var r,o,s,u,c,l,d,f=a.getPlugins("AttributePlugin"),m=a.getPlugins("ResourcePlugin");if(e.is(f)&&e.is(m)){if(f=f.instance,m=m.instance,e.is(t)){if((r=y(t))>-1)o=g(t),c=I[r].columnConfigName,u=n.getXMLValues(c),s=e.is(u)?u.Config.Columns.Column:[],s=e.is(s,"array")?s:[s],o.forEach(function(n,t){s.some(function(i){var r=!1;return i.dataIndex===n.dataIndex&&(o[t]=e.merge({isHidden:!n.colVisibility.display,width:n.width,minWidth:n.minWidth},i),r=!0),r})}),u.Config.Columns.Column=o;else{if(!e.is(i))return void a.getLogger().debug(t+" Module has not registered for Column Preferences");u=n.getXMLValues(i)}return e.is(u)&&(l=u.Config.Label,e.is(l)&&(d=f.getAttributeInfoFromColumn({dataIndex:l.dataIndex}),O[t]={attributeName:d.attributeName,labelIsOnRef:"reference"===d.objType,dicoType:l.dicoType})),e.is(u)?u.Config:void 0}a.getLogger().debug(" viewID has not been defined, so cannot retrieve Column Preferences")}else a.getLogger().debug("AttributePlugin or ResourcePlugin not available")},unRegisterViewforColumnPref:function(n){var t,i=!1;return e.is(n)?(t=y(n))>-1?(I.splice(t,1),i=!0):a.getLogger().debug(n+" Cannot unregister as Module is not registered for Column Preferences"):a.getLogger().debug(" viewID has not been defined, so cannot unRegister for  Column Preferences"),i},getLabelInfo:function(e){return O[e]},getViewLabelMap:function(){return O},registerViewforWidgetLayout:function(n){var t;e.is(n)&&(e.is(n.viewID)||e.is(n.viewType))?(t=n.viewID,e.is(n.dockArea)?e.is(l[t])?l[t].views.push(n.viewType):l[t]={views:[n.viewType],dockArea:n.dockArea}:e.is(c[t])?c[t].views.push(n.viewType):c[t]={views:[n.viewType]}):a.getLogger().debug("viewID or viewType has not been defined, so cannot register for Layout Preferences")},unregisterViewforWidgetLayout:function(n,t){var i,r,o,s=!1;return e.is(c[n])?i=c:e.is(l[n])&&(i=l),e.is(i)&&-1!==(o=(r=i[n]).views.indexOf(t))&&(r.views.splice(o,1),0===r.views.length&&delete i[n],s=!0),s||a.getLogger().debug('Cannot unregister as Module "'+n+'" or "'+t+'" is not registered for Layout Preferences'),s},setCurrentView:function(n,t){e.is(t)&&(e.is(n)||e.is(t.currentView))?e.is(c[n])?c[n].currentView=t.currentView:c[n]={currentView:t.currentView}:a.getLogger().debug("moduleId or currentView has not been defined, so cannot setup Module Current View")},updateViewPreferences:function(n,t,i){var r,o=g(n);Array.isArray(o)&&e.is(t)&&e.is(i)&&(r=o.detect(function(e){return e.dataIndex===t},this),e.is(r)&&(Object.keys(i).forEach(function(e){switch(e){case"visibility":r.colVisibility.display=i.visibility;break;default:a.getLogger().debug("Invalid option! No parameters to manage for the selected column!")}}),f(n,o)))},getCurrentView:function(){return c},setActiveView:function(e){V=e},getActiveView:function(){return V},getURLColumnInfo:function(e){return v(e)},executeCommand_V2:function(n,t){var i,r,s,u=a.getConfig().appContext,c=a.getPlugins("UXComponentsPlugin").instance.getComponent("WUXCommandsManager"),l=c.getCommand(n,u);s=function(e){var n;return{displayName:(n=a.getPlugins("DatabasePlugin").instance.getReference(e.getReferencePID())).get("V_Name"),id:n.get("PID"),revision:n.get("revision"),type:n.get("type")}},i=(t||{}).node,e.is(l)?e.is(i)?(r=s(i),!0===i.fromXEN&&e.is(i.getParent()._treeDocument)&&o.publish({event:"FacetCommandManager/executeCommand",data:{commandName:n,targetNode:r}})):e.is(r)?l.execute(r):l.execute(t):(l=c.getCommandCheckHeader(n,u),e.is(l)&&!1===l.getState()&&(l.options.node={referencePID:i.getReferencePID(),instancePID:i.getInstancePID(),absPath:i.getAbsolutePath()},l.toggleState()))},executeCommand:function(n,t){var i,r,s,u=a.getConfig().appContext,c=a.getPlugins("UXComponentsPlugin").instance.getComponent("WUXCommandsManager"),l=c.getCommand(n,u);s=function(e){var n;return{displayName:(n=a.getPlugins("DatabasePlugin").instance.getReference(e.getReferencePID())).get("V_Name"),id:n.get("PID"),revision:n.get("revision"),type:n.get("type")}},i=(t||{}).node,e.is(l)?(e.is(i)&&(r=s(i)),!0===i.fromXEN&&e.is(i.getParent()._treeDocument)?o.publish({event:"FacetCommandManager/executeCommand",data:{commandName:n,targetNode:r}}):l.execute(r)):(l=c.getCommandCheckHeader(n,u),e.is(l)&&!1===l.getState()&&(l.options.node={referencePID:i.getReferencePID(),instancePID:i.getInstancePID(),absPath:i.getAbsolutePath()},l.toggleState()))},addColumnForGrouping:function(e,n){D(e,n)},getColumnsForGrouping:function(e){return b(e)},isGroupingExist:function(){return R()},getGroupingAdditonalColumns:function(){return T},resetColumnsForGrouping:function(e){L(e)},getCollectionSpecificDataIndex:function(e){return S[e]},registerModuleForRecursiveGrouping:function(e){E.add(e)},doesModuleHaveRecursiveGrouping:function(e){return E.has(e)},unRegisterModuleForRecursiveGrouping:function(e){E.delete(e)},registerModuleColumnsAsImmutable:function(e){x.add(e)},areModuleColumnsImmutable:function(e){return x.has(e)}}}});