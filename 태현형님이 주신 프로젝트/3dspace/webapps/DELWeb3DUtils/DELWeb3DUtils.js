define("DS/DELWeb3DUtils/DELWeb3DUtils",["DS/Logger/Logger","UWA/Class/Promise","DS/WebappsUtils/WebappsUtils","DS/WebUAUtils/WebUAUtils","DS/DELWebComponentManager/DELWebComponentManager","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSettingsMgt","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/PlatformAPI/PlatformAPI","DS/PADServices/utils/DictionaryAccess","DS/PADUtils/PADUtilsServices","text!DS/DELWeb3DUtils/assets/json/Webservices.json","i18n!DS/DELWeb3DUtils/assets/nls/Messages"],function(e,t,r,n,i,a,o,s,c,l,u,d,p,f,g){"use strict";return function(m,h){var S,D=[],y=JSON.parse(f);l.setNotificationManager(c);const b=e.getLogger("DELWeb3DUtils"),U=function(){return"true"===sessionStorage.getItem("DS/DELWeb3DUtils/DELWeb3DUtils.logPerformance")},A=function(e,t){b.error(t),b.debug(e.toString())},v={initialize:function(){return new UWA.Promise((e,t)=>{a.getPlatformServices({onComplete:function(t){D=t,e()},onFailure:function(e){t(e)}}),U()&&function(){var e;e=["measure"],(S=new PerformanceObserver(function(e){e.getEntries().forEach(function(e){b.debug("Performance ",e.name+" : "," duration:",e.duration)})})).observe({entryTypes:e})}()})},getPlatformId:function(){return"undefined"!=typeof widget&&null!==widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},getUserLogin:function(){var e=u.getUser();return e&&e.login?e.login:""},getWidgetId:function(){return"undefined"!=typeof widget?widget.id:-1},getAppId:function(){if("undefined"!=typeof widget)return widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):widget.getValue("appId")},getSharedAppId:function(){return"undefined"!=typeof widget?widget.getValue("x3dSharedId")?widget.getValue("x3dSharedId"):this.getAppId():-1},inAppsSearch:function(e){var t,r=require("UWA/Utils/InterCom"),n=require("DS/Utilities/Utils"),i={mode:"furtive",default_with_precond:!0,widget_id:this.getWidgetId(),app_socket_id:"delsearchutils_"+this.getWidgetId(),idcard_activated:!1,advanced_search:{showByDefault:!1},tenant:this.getPlatformId()},a=Object.assign(i,e,{default_search_criteria:e.fts_value}),o=new r.Socket(a.app_socket_id,{dispacthRetryInterval:0}),s=[],c=function(e){s=e.selected_objects,t=e.selected_command},l=n.debounce(function(){switch(t){case"in_app_ok":e.callback.call(null,s);break;case"in_app_apply":e.apply?e.apply.call(null,s):e.callback.call(null,s);break;default:e.cancel&&e.cancel.call(null)}o.removeListener("onCloseTransient",l),o.removeListener("InContextSearch_Response",c),o.dispatchEvent("UnregisterContext",{widget_id:a.widget_id})},200);!0===e.debug_mode&&o.setDebugMode(!0),UWA.is(e.parent_window)?o.subscribeServer("SearchComServer",window):o.subscribeServer("SearchComServer"),o.dispatchEvent("RegisterContext",a),UWA.is(e.context_name)&&(a.context_title=e.context_name),o.dispatchEvent("InContextSearch",a),o.addListener("InContextSearch_Response",c),o.addListener("onCloseTransient",l)},getTenantInfo:function(e){var t={};if(D&&D.length>0)for(let r=0;r<D.length;r++)if(D[r].platformId===e){t=D[r];break}return t},get3DSpaceUrl:function(){return this.getPlatformURL("3DSpace")},getPlatformURL:function(e){var t=this.getPlatformId();return this.getTenantInfo(t)[e]},getSecurityContextPromise:function(){var e=require("DS/WAFData/WAFData");return new t((t,r)=>{e.authenticatedRequest(this.get3DSpaceUrl()+"/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces",{method:"GET",headers:{Accept:"application/json"},onComplete:function(e){UWA.is(e,"string")&&(e=JSON.parse(e)),e&&e.preferredcredentials&&e.preferredcredentials.role&&e.preferredcredentials.organization&&e.preferredcredentials.collabspace?t(`ctx::${e.preferredcredentials.role.name}.${e.preferredcredentials.organization.name}.${e.preferredcredentials.collabspace.name}`):r("Unable to fetch security context")},onTimeout:function(e){r(e)},onFailure:function(e){r(e)}})})},executeRequestPromise:function(e,r){var n=require("DS/WAFData/WAFData"),i=r||{},a={Accept:"application/json, text/plain, application/octet-stream","Content-Type":"application/json"},o=function(e,r){return new t((t,i)=>{n.authenticatedRequest(e.toString(),{method:r.method?r.method:"GET",type:r.dataType?r.dataType:"json",data:r.payload?UWA.Json.encode(r.payload):"",headers:r.headers,timeout:r&&r.timeout?r.timeout:widget.getValue("webTimeout"),proxy:r&&r.proxy?r.proxy:"none",onComplete:function(e){t(e)},onTimeout:function(e){!0!==r.suppressNotif&&v.displayNotification({level:"warning",message:g.get("Warn.Timeout.Message"),sticky:!1}),i(e)},onFailure:function(e){i(e)}})})};return new t((t,r)=>{var n=new URL(e+"");n.searchParams.set("tenant",this.getPlatformId()),i.headers=i.headers||{},UWA.merge(i.headers,a),widget.getValue("xPref_CREDENTIAL")?(UWA.merge(i.headers,{securityContext:`ctx::${widget.getValue("xPref_CREDENTIAL")}`}),o(n.toString(),i).then(t).fail(r)):this.getSecurityContextPromise().then(function(e){return UWA.merge(i.headers,{securityContext:e}),o(n.toString(),i)}).then(t).fail(r)})},retrieveAuthorizedObjects:function(e){return new t((t,r)=>{UWA.is(e)?o.retrieveAuthorizedObjects({displayNotif:!0,X3DContentId:e,callback:function(e){e&&UWA.is(e.authorized_objects,"array")&&e.authorized_objects.length>0?t(e.authorized_objects):r(e.unauthorized_objects)},version:"2.0"}):r("Invalid input")})},getSetting:function(e){return s.getSetting.apply(s,arguments)},setObjectOnCompass:function(e){p.setObject_on_compass(e)},openApp:function(e){p.open_app(e)},getAssetsUrl:function(e,t){return r.getWebappsAssetUrl(e,t)},getHelpFullPath:function(e,t){return n.getHelpFullPath(e,t)},getAttributeForIds:function(e,r,n){var a,o,s=function(e,r,n){return new t((t,a)=>{i.getComponent("Utils").executeRequestPromise(v.get3DSpaceUrl()+"/cvservlet/fetch/v2",{method:"POST",payload:function(e,t,r){return{label:i.getComponent("Utils").getAppId()+"-"+Date.now(),physicalid:e,locale:"en",select_predicate:t,select_file:r}}(e,r,n)}).then(function(e){e&&UWA.is(e.error)?a(e.error.errorMessage):t(e)}).fail(function(e){a(e)})})},c=[],l=[];return UWA.is(e,"array")&&UWA.is(r,"array")?new UWA.Promise(function(i,u){if(e.length>1e4)for(a=0,o=e.length;a<o;a+=1e4)c=e.slice(a,a+1e4),l.push(s(c,r,n));else l.push(s(e,r,n));t.all(l).then(function(e){var t={};e.forEach(e=>{Object.assign(t,function(e){var t="string"==typeof e?JSON.parse(e).results:e.results,r={};return UWA.is(t,"array")&&t.forEach(e=>{var t=null,n={};UWA.is(e.attributes,"array")&&(e.attributes.forEach(e=>{"resourceid"===e.name?t=e.value:n[e.name]?(UWA.is(n[e.name],"array")||(n[e.name]=[n[e.name]]),n[e.name].push(e.value)):n[e.name]=e.value}),r[t]=n)}),r}(e))}),i(t)}).fail(u)}):UWA.Promise.reject("Invalid Input Provided")},displayNotification:function(e){c.addNotif(e)},getValue:function e(t,r){var n;if("object"==typeof t)if(Object.prototype.hasOwnProperty.call(t,r))n=t[r];else for(let i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&(n=e(t[i],r),UWA.is(n)))return n;return n},processInChunk:function(e,t=1,r=0,n){if(Array.isArray(e)){let i=e.slice();if(i.length>t)for(let e=0,a=i.length;e<a;e+=t){let e=i.splice(0,t);n&&setTimeout(n.bind(null,e,0===i.length),r)}else n&&n(i,!0)}},markStart:function(e){U()&&performance.mark(e+"Start")},markEnd:function(e,t){U()&&(performance.mark(e+"End"),performance.measure(t+" : ",e+"Start",e+"End"))},getLocalStorageValue:function(e){return localStorage.getItem(e)},getContextScope:function(e){var t=y.getContextScope,r=t.payload;return r&&(r.refid=e),v.executeRequestPromise(`${v.get3DSpaceUrl()}${t.url}`,{method:t.method,payload:r}).fail(function(e){A(e,"Error occurred while fetching context scope for process id ")})},getCapableResource:function(e){var t,r;return(t=y.fetchCapableResource,r=t.payload,r.input_physical_ids.push(e),v.executeRequestPromise(`${v.get3DSpaceUrl()}${t.url}`,{method:t.method,payload:r})).then(function(t){let r,n,i=[];return t&&t.result&&(r=t.result.find(t=>t.input_object&&t.input_object.physicalid===e))&&r.outputs&&r.outputs.resourceArea_pathSR&&(i=(n=r.outputs.resourceArea_pathSR.find(t=>t.owner&&t.owner.physicalid===e)).elements),i})},getInstallPredecessors:function(e,t){var r=y.getMfgItemInstallDependencies,n=r.payload;return n.assemblyid=e,n.installinstids.push(t),v.executeRequestPromise(`${v.get3DSpaceUrl()}${r.url}`,{method:r.method,payload:n}).then(function(e){return e&&e[t]&&e[t].predecessors?e[t].predecessors:[]}).fail(function(e){A(e,"Error occurred while fetching predecessors for mfg ")})},getFilterSpec:async function(e){let t,r=y.getFilterSpec,n=r.payload;return n.buildId=e,t=await v.executeRequestPromise(`${v.get3DSpaceUrl()}${r.url}`,{method:r.method,payload:n})},getProgressiveExpand:async function(e){let t=y.getProgressiveExpand;return await v.executeRequestPromise(`${v.get3DSpaceUrl()}${t.url}`,{method:t.method,payload:e})},isOnPremise:function(){return"OnPremise"===this.getPlatformId()},destroy:function(){D=[],S&&S.disconnect()}};return Object.assign(v,d)}});