define("DS/DELWebViewerProxyManager/ProxyManager",["DS/DELWebViewerPerformaceLogger/PerformaceLogger","DS/DELWebViewerUtils/Utils","DS/DELWebViewerUtils/DELWebViewerSettingsMgt"],function(e,t,n){"use strict";return function(r,i,o,u){var a=u.getOption("logger"),s=r.getInstance("BuildUpBehavior"),l=r.getInstance("WorkInstructionBehavior"),d=function(e,t,n){var r={};return r.input=e||{},n?r.error={errorMessage:n}:r.output=t?UWA.is(t,"array")?t:[t]:[],r},c=u.getOption("mappingKeys");return{addRoots:function(e){return a.debug("ProxyManager::addRoots method invoked with parameters : ",e),new UWA.Promise(function(t,n){var r=[];e.objects.forEach(function(e){r.push(new UWA.Promise(function(t){var n=i.subscribe("onRootAdded",function(r){r&&r.idPath&&UWA.Array.equals(r.idPath,e.path)&&(i.unSubscribe(n),t())})}))}),UWA.Promise.all(r).then(function(n){t(d(e,n))}).fail(function(t){n(d(e,null,t))}),i.addRoots({objects:e.objects},e.dispatch,e.displayNotif)})},setProcess:function(e){var n=this,r=e?Object.assign({},e):{},l=o.getInstance("BuildUpBehaviorModelService"),g=[],f=!!e.defaultShow,h=function(){return(e=UWA.Promise.resolve(),Array.isArray(r.installPath)&&r.installPath.length>0&&(e=l.getInstallContext(r).then(function(e){let t={};e&&(e.predecessors&&(t.predecessors=e.predecessors.slice()),e.noDependecy&&(t.noDependecy=e.noDependecy.slice()),Object.assign(r,t))})),e).then(function(){let e,t=r.installPath||[],n=t.length>0?t:[r.mfgId];return n.length>0?(g.push(n),r.resourceId&&g.push([r.resourceId]),r.predecessors&&r.predecessors.length>0&&r.predecessors.forEach(function(e){g.push(e)}),e=g):e=UWA.Promise.reject(u.getNLSValue("Error.InvalidInput.Message")),e}).then(()=>UWA.Promise.all([function(){let e=r.noDependecy;e&&e.length>0&&i.setGraphicProperties({graphicProperties:e.map(e=>({path:e,[c.GRAPHICPROPERTIES.VISIBILITY]:!1,[c.GRAPHICPROPERTIES.VISIBILITYFREE]:!0}))},c.SCENEGRAPHKEYS.GLOBAL).then(function(){i.render()})}(),new UWA.Promise(function(e,t){f?e():i.setGraphicProperties({graphicProperties:g.map(e=>({path:e,visibility:!1}))},c.SCENEGRAPHKEYS.SETPROCESS).then(function(){i.render(),e()}).fail(t)}),function(){var e=[];return g.forEach(t=>{i.isRegistered(t)||e.push({path:t})}),e.length>0?n.addRoots({objects:e}):UWA.Promise.resolve()}()]));var e},p=function(){o.getDataManager().set("process",r)},P=function(){return new UWA.Promise(function(n,i){u.getOption("viewerType")<=0?i(d(e,null,u.getNLSValue("Error.InvalidViewerType.Message"))):(t.isCloud()&&!0===u.getOption("dynamicBuildUp")&&(a.warn("Only Published Content is available on cloud, using published build up instead"),u.setOption("dynamicBuildUp",!1)),a.debug("ProxyManager::setProcess method invoked with parameters : ",e),a.info(`********** SetProcess Started (process-${JSON.stringify(r)}) **************`),r.processId?(p(),UWA.Promise.all([h(),new UWA.Promise(function(e,t){l.getContent(r).then(function(){return s.getBuildUpSettings({processId:r.processId})}).then(e).fail(t)})]).then(function(){p(),a.info(`********** SetProcess Completed (process-${JSON.stringify(r)} **************`),n(d(e))}).fail(function(t){a.error("setProcess failed due to -",t),i(d(e,null,t))})):i(d(e,null,u.getNLSValue("Error.InvalidInput.Message"))))})};return P()},empty:function(){return new UWA.Promise(function(e,t){i.removeRoots({pids:[]}).then(function(){r.reset(),i.resetGraphicProperties(),i.resetCameraOrientation(),i.render(),e(d())}).fail(function(e){a.error("empty failed due to -",e),t(d(null,null,e))})})},refresh:function(){var e;return 1!==u.getOption("viewerType")&&2!==u.getOption("viewerType")||(e=o.getDataManager().get("process")),r.reset(),i.refresh(),e?this.setProcess(e):UWA.Promise.resolve(d())},removeRoots:function(e){return a.debug("ProxyManager::removeRoots method invoked with parameters : ",e),new UWA.Promise(function(t,n){i.removeRoots(e).then(function(n){t(d(e,n))}).fail(function(t){a.error("removeRoots failed due to -",t),n(d(e,null,t))})})},setOperation:function(e){return a.debug("ProxyManager::setOperation event invoked with parameters : ",e),new UWA.Promise(function(t,n){s?(l&&i.getMode()===c.VIEWERMODES.WORKINSTRUCTIONS&&l.clean(),s.applyBuildUp(e).then(function(n){a.info("setOperation completed for given operation -",e),t(d(e,n))}).fail(function(t){a.error("setOperation failed due to -",t),n(d(e,null,t))})):n(u.getNLSValue("Error.BuildUpCntrlNotInit.Message"))})},removeBuildUp:function(){return a.warn("removeBuildUp is deprecated, please use remove operation instead"),new UWA.Promise(function(e){s.removeBuildUp(),e()})},removeOperation:async function(){s&&s.removeBuildUp(),l&&await l.reset()},setMode:function(e){return a.debug("ProxyManager::setMode method invoked with parameters : ",e),new UWA.Promise(function(t,n){var r,o=i.getMode()===c.VIEWERMODES.WORKINSTRUCTIONS,g=u.getOption("eventCollection").getViewerCtrlEventHnd();if(UWA.is(e,"object")&&e.mode){switch(e.mode){case c.VIEWERMODES.WORKINSTRUCTIONS:!o&&function(){let e=!1;return s&&(e=s.isBuildUpApplied()),e}()&&(l?l.show():(a.error("WorkInstruction Behavior is not available, check whether proper viewer type is provided during initialization"),r=u.getNLSValue("Error.WorkInstModeNotActive.Message")));break;case c.VIEWERMODES.BUILDUP:o&&l&&l.reset(),s&&s.applyCurrentBuildUp();break;default:r=u.getNLSValue("Error.InvalidViewerMode.Message")}r?n(d(e,null,r)):(u.setOption(c.OPTIONS.VIEWERMODE,e.mode),g.publish(g.events.onSetModeComplete,{mode:e.mode}),t(d(e)))}else n(d(e,null,u.getNLSValue("Error.InvalidInput.Message")))})},getViewerModes:function(){return c.VIEWERMODES},selectNode:function(e){return e=e||{},a.debug("ProxyManager::selectNode event invoked with parameters : ",e),new UWA.Promise(function(t,n){i.selectNode(UWA.merge(e,{select:!0})).then(function(n){t(d(e,n))}).fail(function(t){a.error("Select Node failed due to : ",t),n(d(e,null,t))})})},unSelectNode:function(e){return e=e||{},a.debug("ProxyManager::unSelectNode event invoked with parameters : ",e),new UWA.Promise(function(t,n){i.selectNode(UWA.merge(e,{select:!1})).then(function(n){t(d(e,n))}).fail(function(t){a.error("ProxyManager:: Unselect Node failed due to : ",t),n(d(e,null,t))})})},highlightNode:function(e){return e=e||{},a.debug("ProxyManager::highlightNode API invoked with parameters : ",e),new UWA.Promise(function(t,n){i.highlightNode(UWA.merge(e,{highlight:!0})).then(function(n){t(d(e,n))}).fail(function(t){a.error("Highlight Node failed due to : ",t),n(d(e,null,t))})})},unHighlightNode:function(e){return e=e||{},a.debug("ProxyManager::unHighlightNode API invoked with parameters : ",e),new UWA.Promise(function(t,n){i.highlightNode(UWA.merge(e,{highlight:!1})).then(function(n){t(d(e,n))}).fail(function(t){a.error("Unhighlight Node failed due to : ",t),n(d(e,null,t))})})},preHighlightNode:function(e){return e=e||{},a.debug("ProxyManager::preHighlightNode API invoked with parameters : ",e),new UWA.Promise(function(t,n){i.preHighlightNode(UWA.merge(e,{highlight:!0})).then(function(n){t(d(e,n))}).fail(function(t){a.error("PreHighlight Node failed due to : ",t),n(d(e,null,t))})})},unPreHighlightNode:function(e){return e=e||{},a.debug("ProxyManager::unPreHighlightNode API invoked with parameters : ",e),new UWA.Promise(function(t,n){i.preHighlightNode(UWA.merge(e,{highlight:!1})).then(function(n){t(d(e,n))}).fail(function(t){a.error("UnPreHighlight Node failed due to : ",t),n(d(e,null,t))})})},setGraphicProperties:function(t){return a.debug("ProxyManager::setGraphicProperties method invoked with parameters :",t),new UWA.Promise(function(n,r){e.markStart("DELWebViewerSetGraphicProperties"),i.setGraphicProperties(t,c.SCENEGRAPHKEYS.SETGRAPHICPROPERTIES).then(function(r){i.render(),e.markEnd("DELWebViewerSetGraphicProperties","Time taken to setGraphicProperties "),n(d(t,r))}).fail(function(e){a.error("setGraphicProperties failed due to : ",e),r(d(t,null,e))})})},removeGraphicProperties:function(e){return a.debug("ProxyManager::removeGraphicProperties method invoked with parameters : ",e),new UWA.Promise(function(t,n){i.removeGraphicProperties(e,c.SCENEGRAPHKEYS.SETGRAPHICPROPERTIES).then(function(n){i.render(),t(d(e,n))}).fail(function(t){a.error("removeGraphicProperties failed due to : ",t),n(d(e,null,t))})})},resetGraphicProperties:function(e){return new UWA.Promise(function(t){i.resetGraphicProperties(),(e=!UWA.is(e,"boolean")||e)&&i.render(),t(d({render:e}))})},getGraphicPropertiesEnum:function(){return i.getGraphicPropertiesEnum()},setReframe:function(e){return a.debug("ProxyManager::setReframe method invoked with parameters : ",e),new UWA.Promise(function(t,n){i.setReframe(e).then(function(n){t(d(e,n))}).fail(function(t){a.error("setReframe failed due to : ",t),n(d(e,null,t))})})},highlightLinkedViews:function(e){return a.debug("ProxyManager::highlightLinkedViews method invoked with parameters : ",e),new UWA.Promise(function(t,n){l?l.highlightLinkedViews(e).then(function(n){t(d(e,n))}).fail(function(t){n(d(e,null,t))}):(a.error("highlightLinkedViews failed due to WorkInstruction behavior not found"),n(d(e,null,u.getNLSValue("Error.WorkInstModeNotActive.Message"))))})},setViewPoint:function(e){return a.debug("ProxyManager::setViewPoint event received with parameters :",e),new UWA.Promise(function(t,n){i.setViewPoint(e).then(function(n){t(d(e,n))}).fail(function(t){a.error("setViewPoint failed due to ",t),n(d(e,null,t))})})},getCurrentView:function(){return a.debug("ProxyManager::getCurrentView method invoked"),new UWA.Promise(function(e,t){l?l.getCurrentView().then(function(t){e(d(null,t))}).fail(function(e){a.error("getCurrentView failed due to -",e),t(d(null,null,e))}):(a.error("getCurrentView failed due to WorkInstruction behavior not found"),t(d(null,null,u.getNLSValue("Error.WorkInstModeNotActive.Message"))))})},getViewPoint:function(){return a.debug("ProxyManager::getViewPoint event received with parameters :"),new UWA.Promise(function(e,t){i.getViewPoint().then(function(t){e(d(null,t))}).fail(function(e){a.error("getViewPoint failed due to -",e),t(d(null,null,e))})})},setCurrentView:function(e){return a.debug("ProxyManager::setCurrentView method invoked with parameters : ",e),new UWA.Promise(function(t,n){l?l.setCurrentView(e).then(function(n){t(d(e,n))}).fail(function(t){a.error("setCurrentView failed due to -",t),n(d(e,null,t))}):(a.error("setCurrentView failed due to WorkInstruction behavior not found"),n(d(e,null,u.getNLSValue("Error.WorkInstModeNotActive.Message"))))})},getBoundingBox:function(e){return a.debug("ProxyManager::getBoundingBox event received with parameters :",e),new UWA.Promise(function(t,n){i.getBoundingBox(e).then(function(n){t(d(e,n))}).fail(function(t){a.error("getBoundingBox failed due to -",t),n(d(e,null,t))})})},getPartPosition:function(e){return a.debug("ProxyManager::getPartPosition event received with parameters :",u),new UWA.Promise(function(t,n){s?s.getPartPosition(e).then(function(n){t(d(e,n))}).fail(function(t){a.error("getPartPosition failed due to -",t),n(d(e,null,t))}):n(d(e,null,u.getNLSValue("Error.BuildUpCntrlNotInit.Message")))})},displayOrientationViewer:function(e){return a.debug("ProxyManager::displayOrientationViewer event received with parameters :",e),new UWA.Promise(function(t,n){i.displayOrientationViewer(e).then(function(n){t(d({toShow:e,data:n}))}).fail(function(t){a.error("displayOrientationViewer failed due to -",t),n(d({toShow:e},null,t))})})},search:function(e){a.debug("ProxyManager::search method invoked with parameters :",e),i.search(e)},updateOptions:function(e){if(a.debug("ProxyManager::updateOptions method invoked with parameters :",e),u.setOptions(e),e&&e.viewerOptions&&e.viewerOptions.delviewer&&e.viewerOptions.delviewer.run_options){let t=e.viewerOptions.delviewer.run_options;for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.setSetting(e,t[e].value)}},notifyRootVisibilityChange:function(e,t){i.getContext().getController().notifyRootVisibilityChange(e,t)},destroy:function(){a=s=l=d=c=null}}}});