/*!  Copyright 2021 Dassault Systemes. All rights reserved. */
define("DS/DMUwebR3Mux/DMUwebR3Mlist",["UWA/Core","UWA/Class","DS/Utilities/Dom","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/Controls/TooltipModel","DS/Controls/ProgressBar","DS/CollectionView/CollectionViewStatusBar","i18n!DS/DMUwebR3Mux/assets/nls/DMUwebR3Mux.json","css!DS/DMUwebR3Mux/assets/css/DMUwebR3Mux"],function(e,t,n,i,a,o,r,l,s,d){"use strict";let c=window.WUXManagedFontIcons.Font3DS;var u,p,f,g,m=function(e,t,n,i){return u=n.options.grid.analysisStateNbKO,p=i.options.grid.analysisStateNbKO,f=n.options.grid.analysisStateDisp,g=i.options.grid.analysisStateDisp,f===g?u===p?0:u<p?-1:1:f<g?-1:1};return t.extend({init:function(t){let u,p,f,g={},h={},v=t.onSelect,y=t.onUnselect,w=t.onFiltersModified,S=t.onInfo,b=t.cbDnD,M=t.columns,I=t.parent,x=t.getFilterValues,D=t.getIsrTypes,_=t.onRelations,C=t.allowRelations,E=t.onMaturityState,P=t.onAnalysisState,R=t.getFeatureStateInfo,O=t.allowMaturityState,V=t.onValidationState,j=t.allowValidationState,k={show:!1,total:[],completed:[],failed:[]},T=["private","inwork","frozen","released","obsolete","default","exists","inprogress","failed","passed","donenoko","startedwithko","startednoko","donewithko","notcomputed"],F=[{type:s.STATUS.NB_ITEMS},{position:"far",type:s.STATUS.NB_SELECTED_ROWS}];function U(e){return{id:e.options.grid.id,parents:e.getParents().map(function(e){return e.options.grid.id})}}function A(t,n){let i=e.createElement("div",{class:"r3mtweaker "+n});return i.value=t,i.getStringFromValue=function(e){return e||""},i.computeContentSize=function(){let e=15;for(let t=i.childNodes.length-1;t>=0;--t)e+=i.childNodes[t].getDimensions().width;return e},i}function N(e){if(p)return e&&e.nodeModel&&e.cellView?p.getCellDefaultTooltip(e,-1!==(e.nodeModel.options.grid.description||"").search("\n")):p.getCellDefaultTooltip(e)}function L(e){if(!p)return;if(!e||!e.nodeModel||!e.cellView)return p.getCellDefaultTooltip(e);let t=p.getCellDefaultTooltip(e);return{getAllInformationCB:function(){return e.nodeModel.options.grid.validStateWarning?{model:{shortHelp:e.nodeModel.options.grid.validStateWarning},updateModel:!1}:t.getAllInformationCB()}}}function W(e,t,n,i,a,o,s,d){let c;if(n){let o,r=h[a]&&T.indexOf(t)>-1,u=0;if("r3mCellAnalysisState_itfQueryRunning"===t?(o="r3mCellAnalysisState_itfQueryRunning",u=e&&e.nodeModel&&e.nodeModel.options.grid?e.nodeModel.options.grid.analysisStateProgress:0):o="r3mR2VCellState_itfQueryRunning"===t?"r3mR2VCellState_itfQueryRunning":"r3mCellState_"+t+i+(r?"":"_NoColor"),p._reusableCellContentManager.isRegistered(o)||p.registerReusableCellContent({id:o,buildContent:s.bind(null,n,i,r,t,d)}),u>0&&"r3mCellAnalysisState_itfQueryRunning"===t){let e=A("","r3mstatus");new l({value:u}).inject(e),c=e}else c=p.reuseCellContent(o)}e.cellView._setReusableContent(c),e.cellView.tooltipInfos=new r(o?L(e):p.getCellDefaultTooltip(e))}function B(t,n,i,a,o){let r=A(t,"r3mstatus");return e.createElement("span",{html:t,class:i?"r3mstatuscolored r3m"+a:""}).inject(r),o&&(r.style.textAlign="start",r.style.paddingLeft="5px"),r}function q(t){var n=e.createElement("div",{class:"spinner spinning",styles:{display:"flex","justify-content":"center",transform:"translate3d(0,0,0)"}}).inject(t);e.createElement("span",{class:"spinner-bar"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(n)}function z(t,n,i,a){let o=A(t,"r3mstatus");if("startedwithko"===a||"donewithko"===a){let r=e.createElement("span",{class:i?"r3mstatuscolored r3m"+a:""}).inject(o);e.createElement("span",{html:t+" "}).inject(r),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-attention"}).inject(r),e.createElement("span",{html:" "+n}).inject(r)}else if("computed"===a){let i=e.createElement("span",{class:"r3mstatuscolored r3m"+a}).inject(o);e.createElement("span",{html:t+" "}).inject(i),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-interference-metric"}).inject(i),e.createElement("span",{html:" "+n}).inject(i)}else a.contains("r3mCellAnalysisState_itfQueryRunning")?q(o):e.createElement("span",{html:t,class:i?"r3mstatuscolored r3m"+a:""}).inject(o);return o}function X(e){if(!(p&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;t&&void 0===t.title&&"r2vsurvey"===t.serviceId?(p._reusableCellContentManager.isRegistered("r3mR2VCellState_itfQueryRunning")||p.registerReusableCellContent({id:"r3mR2VCellState_itfQueryRunning",buildContent:function(e){let t=A(e,"r3mR2V_Running");return q(t),t}.bind(null,"r3mR2VCellState_itfQueryRunning")}),W(e,"r3mR2VCellState_itfQueryRunning","r3mR2VCellState_itfQueryRunning",0,t.id,!1,B,!0),R({serviceId:t.serviceId,objectId:t.id,validatedObjId:e.nodeModel._parentNode._parentNode.options.grid.id,text:e.nodeModel._parentNode._options.grid.id})):W(e,t.title,t.title,0,t.id,!1,B,!0)}function J(e){if(!(p&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid,n=(t.maturity||"").split(".");W(e,n=n[n.length-1].toLowerCase().replace("_",""),t.maturityDisp,0,t.id,!1,B,!1)}function K(e){if(!(p&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;W(e,(t.validState||"").toLowerCase(),t.validStateDisp,0,t.id,!0,B,!1)}function Q(e){if(!(p&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid,n=D();t.analysisState=t.analysisState?t.analysisState:"";let i="running"===t.analysisState||"unknown"===t.analysisState?"r3mCellAnalysisState_itfQueryRunning":t.analysisState;i=i||"",W(e,-1===n.indexOf(t.type)?"":i,t.analysisStateDisp,t.analysisStateNbKO,t.id,!0,z,!1),"unknown"===t.analysisState&&n.indexOf(t.type)>-1&&P([t.id])}function H(t){if(!(p&&t&&t.nodeModel&&t.cellView))return;let n,i=t.nodeModel.options.grid,a=i.id,o=i.validStateWarning,l=(a&&h[a]&&i.validState||"").toLowerCase(),s=D(),d="r3mCellState_validstatewarning";if(!(s.indexOf(i.type)>-1)||p.layout.getColumnVisibleFlag("analysisStateDisp")){if(s.indexOf(i.type)>-1?d=d+(l="inprogress"===l||"failed"===l&&("computed"===i.analysisState||"notcomputed"===i.analysisState||"startednoko"===i.analysisState)?"minorWarning":"majorWarning")+i.analysisState:d+=l="inprogress"===l?"minorWarning":l,o)p._reusableCellContentManager.isRegistered(d)||p.registerReusableCellContent({id:d,buildContent:function(t,n){let i=A(t,"r3mwarning");var a,o;return(a="attention",o="minorWarning"===n?"r3miconcolor":"r3mwarningcolor",e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-"+a+" "+o})).inject(i),e.createElement("span",{html:t,class:"r3mwarningtext"}).inject(i),i}.bind(null,o,l)}),n=p.reuseCellContent(d);else if(!o&&s.indexOf(i.type)>-1&&"running"===i.analysisState){if(i.analysisStateProgress>0&&("running"===i.analysisState||"unknown"===i.analysisState))return;p._reusableCellContentManager.isRegistered("r3mCellState_itfQueryRunning")||p.registerReusableCellContent({id:"r3mCellState_itfQueryRunning",buildContent:function(e){let t=A(e,"r3mwarning");return q(t),t}.bind(null,"r3mCellState_itfQueryRunning")}),n=p.reuseCellContent("r3mCellState_itfQueryRunning")}t.cellView._setReusableContent(n),t.cellView.tooltipInfos=new r(L(t))}}function G(e){if(!p||!e||!e.nodeModel)return;let t=p.layout.getDataIndexFromColumnIndex(e.columnID);return Boolean(e.nodeModel.options.grid[t])}function Z(e){if(!p||!e||!e.nodeModel)return;let t=p.layout.getDataIndexFromColumnIndex(e.columnID),n=e.nodeModel.options.grid[t];return n?{icon:e.nodeModel.options.grid[t+"Img"]?"":"topbar-user",label:n}:void 0}function Y(e){v(e.map(U))}function $(e){y(e.map(U))}function ee(){setTimeout(function(){p.reapplySortModel();var t=JSON.parse(localStorage.getItem("r3mGridFilters"));t&&t.filterModel&&!e.equals(t.filterModel,{})&&(u.setFilterModel({}),u.setFilterModel(t.filterModel))},10)}function te(){var e=p.getNodesXSO().get();e&&0!==e.length&&p.ensureNodeModelVisible(e[0],!1)}this.updateValidations=function(e,t,n){u.withTransactionUpdate(function(){Object.keys(e).forEach(function(e){var t=n?function e(t,n){let i,a=this[n],o={label:a.title,grid:a},r=g[n];return a.icon&&(o.icons=[{iconPath:a.icon}]),t.search({match:function(e){e.nodeModel.options.grid.id===a.id&&(i=e.nodeModel)}}),r.forEach(t=>{t.updateOptions(o),Object.keys(a.children||{}).forEach(e.bind(a.children,t))}),i}.call(this,u,e):function e(t,n){let i,o=this[n],r={label:o.title,grid:o},l=g[n];o.icon&&(r.icons=[{iconPath:o.icon}]);let s=D();return-1===k.total.indexOf(o.id)&&s.indexOf(o.type)>-1&&k.total.push(o.id),(t.getChildren()||[]).some(e=>{if(e.options.grid.id===o.id)return i=e}),i||(i=new a(r),t.addChild(i),l?l.push(i):l=g[n]=[i]),o.noSort&&(i.sortChildren=function(e){e.isRecursive&&this.getChildren().forEach(function(t){t.sortChildren(e)})}),l.forEach(t=>{t.updateOptions(r),Object.keys(o.children||{}).forEach(e.bind(o.children,t))}),i}.call(this,u,e);h[e]||(h[e]=t)},e)}),t||ee()},this.updateStatusBar=function(e,t){"success"===t&&-1!==k.completed.indexOf(e)||"failure"===t&&-1!==k.failed.indexOf(e)||("success"===t&&-1===k.completed.indexOf(e)?k.completed.push(e):"failure"===t&&-1===k.failed.indexOf(e)&&k.failed.push(e),function(){let e=k.total.length;if(e>0){var t=e>0?(k.completed.length+k.failed.length)/e*100:100;if(e-(k.completed.length+k.failed.length)<=0&&(k.completed.length=k.failed.length=0,t=100),k.show){const e=F.findIndex(e=>"progressId"===e.id);-1===e&&100!==t?(F.push({type:s.STATUS.CUSTOM,id:"progressId",position:"center",dataElements:{typeRepresentation:"progress",value:t,tooltip:d.gridAnalysisFilterStatus}}),p.buildStatusBar(F)):-1!==e&&100===t?(F=F.filter(e=>"progressId"!==e.id),k.show=!1,p.buildStatusBar(F)):p.elements.statusBar.getNodeModelByID("progressId").updateOptions({grid:{data:t}})}}}())},this.checkFilterAndFetchValue=function(){if(!p||!u)return;let e=JSON.parse(localStorage.getItem("r3mGridFilters"));if(-1!==p.sortModel.findIndex(e=>"analysisStateDisp"===e.dataIndex||"validStateWarning"===e.dataIndex)||e&&e.filterModel&&(e.filterModel.hasOwnProperty("analysisStateDisp")||e.filterModel.hasOwnProperty("validStateWarning"))){let e=D();u.getAllDescendants().forEach(function(t){let n=t.options.grid;e.indexOf(n.type)>-1&&"unknown"===n.analysisState&&(k.show=!0,P([n.id],!1))})}},this.setInfoState=function(e){let t=p.getToolbar().array3[0].tweaker.elements.container,n=t.hasClassName("r3mInfoColor");n&&!e?t.removeClassName("r3mInfoColor"):!n&&e&&t.addClassName("r3mInfoColor")},this.getSelectedRows=function(){return p.getNodesXSO().get().map(U)},this.onTenantModified=function(e){let t={tree:"title",name:"name",typeDisp:"type",maturityDisp:"maturity",validStateDisp:"validState",description:"description",owner:"owner",originator:"originator",organization:"organization",dateModif:"dateModif",dateCreat:"dateCreat",collabSpace:"collabSpace"};f.forEach(n=>{n.text=e[t[n.dataIndex]]})},this.removeValidation=function(e){u.withTransactionUpdate(function(){e.forEach(function(e){h[e]&&u.removeRoot(h[e]);let t=g[e]&&g[e].indexOf(h[e]);t>-1&&g[e].splice(t,1),!g[e].length&&delete g[e],delete h[e]}),ee()})},this.removeAll=function(){p.getNodesXSO().empty(),u.empty(),g={},h={}},function(){function t(e,t){var n=e.getSize(),i=t.getSize(),a=(i.width-n.width)/2,o=(i.height-n.height)/2;e.setStyles({left:a<0?0:a,top:o<0?0:o})}function a(){let e=this.showCustomViewsDialog();function i(){Object.keys(e.buttons).forEach(function(t){e.buttons[t].removeEventListener("click",a)}),e.removeEventListener("close",i),n.removeResizeListener(I)}t(e.elements.container,I),Object.keys(e.buttons).forEach(function(t){e.buttons[t].addEventListener("click",i)}),e.addEventListener("close",i),n.addResizeListener(I,function(){t(e.elements.container,I)})}f=[{dataIndex:"tree",text:M.title,onCellRequest:X,groupableFlag:!1},{dataIndex:"name",text:M.name,width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"typeDisp",text:M.type,width:150,visibleFlag:!1,groupableFlag:!1,alignment:"center"},{dataIndex:"maturityDisp",text:M.maturity,onCellRequest:J,width:90,groupableFlag:!1},{dataIndex:"validStateDisp",text:M.validState,onCellRequest:K,width:100,groupableFlag:!1},{dataIndex:"validStateWarning",icon:{iconName:"attention",fontIconFamily:c},onCellRequest:H,width:60,minWidth:30,groupableFlag:!1},{dataIndex:"analysisStateDisp",text:M.analysisState,onCellRequest:Q,width:150,compareFunction:m,visibleFlag:!1,groupableFlag:!1},{dataIndex:"description",text:M.description,getCellTooltip:N,width:300,groupableFlag:!1},{dataIndex:"owner",text:M.owner,typeRepresentation:"user",hasCellValue:G,getCellValue:Z,width:150,groupableFlag:!1},{dataIndex:"originator",text:M.originator,typeRepresentation:"user",hasCellValue:G,getCellValue:Z,width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"organization",text:M.organization,width:100,visibleFlag:!1,groupableFlag:!1},{dataIndex:"dateModif",text:M.dateModif,typeRepresentation:"datetime",width:150,groupableFlag:!1},{dataIndex:"dateCreat",text:M.dateCreat,typeRepresentation:"datetime",width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"collabSpace",text:M.collabSpace,visibleFlag:!1,groupableFlag:!1}],u=new i({shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!1}});var r=e.createElement("div",{class:"r3mListPlaceHolder"});e.createElement("p",{html:d.placeHolderFst,styles:{"text-align":"center"}}).inject(r);var l=e.createElement("div",{styles:{"font-weight":"normal","text-align":"center"}}).inject(r);e.createElement("span",{html:d.placeHolderSnd+" "}).inject(l),e.createElement("span",{class:"fonticon fonticon-list-filter"}).inject(l);var s={identifier:"r3mDataGridView",treeDocument:u,defaultColumnDef:{width:"auto",height:"auto",editableFlag:!1},columns:f,rowSelection:"multiple",cellSelection:{defaultValue:"none"},rowGroupingEnabledFlag:!1,sortModel:[{dataIndex:"tree",sort:"asc"}],rowDragEnabledFlag:!0,allowUnsafeHTMLContent:!1,cellDragEnabledFlag:!0,activateAllCellsRenderedEventFlag:!0,placeholder:r,recId:"r3mValidationList",onContextualEvent:function(e){if(e){var t=[],n=e.cellInfos;if(e.collectionView&&n)if(-1===n.rowID&&-1!==n.columnID){let n=p.layout.getDataIndexFromColumnIndex(e.cellInfos.columnID);"tree"===n&&(n="label");var i=["typeDisp","maturityDisp","validStateDisp","analysisStateDisp","validStateWarning","owner"].indexOf(n)>-1?"set":"stringRegexp";if(u.getFilterManager().getFilters().hasOwnProperty(n)){var o=u.getFilterManager().getFilters()[n];o&&o.defaultFilterModel&&(o.defaultFilterModel=[])}else u.getFilterManager().setPropertyFilterModel(n,{filterId:i});(t=e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!1,sizeColumnToFit:!0,columnsManagement:!1})).push({type:"PushItem",title:d.mnuExpandAllRows,icon:{iconName:"flow-tree-expand-down",fontIconFamily:c},action:{callback:function(){u.withTransactionUpdate(function(){Object.values(h).forEach(function(e){e.expandAll()})})}}}),t.push({type:"PushItem",title:d.mnuCollapseAllRows,icon:{iconName:"flow-tree-expand-up",fontIconFamily:c},action:{callback:function(){u.withTransactionUpdate(function(){Object.values(h).forEach(function(e){e.collapseAll()})})}}}),t.push({type:"SeparatorItem",title:""}),"label"!==n&&t.push({type:"PushItem",title:d.mnuHideCol,action:{callback:function(){p.layout.setColumnVisibleFlag(p.layout.getDataIndexFromColumnIndex(e.cellInfos.columnID),!1,{isUserInteraction:!0})}}}),t.push({type:"SeparatorItem",title:""}),t.push({type:"PushItem",title:d.mnuCustomView,action:{callback:a.bind(e.collectionView)}})}else if(-1!==n.columnID&&-1!==n.rowID){var r=p.getNodesXSO().get();r.some(function(e){return e.canBeExpanded()&&(!e.isExpanded()||e.getAllDescendants().some(function(e){return e.canBeExpanded()&&!e.isExpanded()}))})&&t.push({type:"PushItem",title:d.mnuExpandAll,icon:{iconName:"flow-tree-expand-down",fontIconFamily:c},action:{callback:function(){u.withTransactionUpdate(function(){p.getNodesXSO().get().forEach(function(e){e.expandAll()})})}}}),r.some(function(e){return e.canBeExpanded()&&(e.isExpanded()||e.getAllDescendants().some(function(e){return e.canBeExpanded()&&e.isExpanded()}))})&&t.push({type:"PushItem",title:d.mnuCollapseAll,icon:{iconName:"flow-tree-expand-up",fontIconFamily:c},action:{callback:function(){u.withTransactionUpdate(function(){p.getNodesXSO().get().forEach(function(e){e.collapseAll()})})}}}),t.length&&t.push({type:"SeparatorItem"});let e=C(),n=O(),i=j();(e&&e.length||n&&n.length||i&&i.length)&&t.push({type:"PushItem",title:d.mnuRelations,icon:{iconName:"object-related",family:c},action:{callback:_}}),n&&n.length&&t.push({type:"PushItem",title:d.mnuMaturity,icon:{iconName:"collaborative-lifecycle-management",family:c},action:{callback:E}}),i&&i.length&&t.push({type:"PushItem",title:d.mnuValidation,icon:{iconName:"check",family:c},action:{callback:V}})}return t}}};Object.keys(b).forEach(function(e){s[e]=b[e]}),b=null,(p=new o(s)).getContent().addClassName(s.identifier),window.__karma__&&(p.layout.addCellCoordinates=!0);var g=p.getNodesXSO();g.options.getElementID=void 0,g.onPostAdd(Y),g.onPostRemove($),p.addEventListener("DSpointerhit",function(e,t){e&&e.multipleHitCount>1&&t&&t.columnID>=0&&t&&t.rowID>=0&&S()}),u.getFilterManager().subscribe("filterModelChange",function(){setTimeout(function(){let t=e.clone(u.getFilterManager().filterModel,!0);t=Object.keys(t).reduce((e,n)=>(t[n].filterModel&&Object.keys(t[n].filterModel).length>0&&(e[n]=t[n]),e),{}),localStorage.setItem("r3mGridFilters",JSON.stringify({filterModel:t})),te()},10)}),u.getModelEvents().subscribe({event:"sortChildren"},function(){setTimeout(function(){te()},10)});var v=e.createElement("div",{class:"r3mPanel wux-windows-window-maincontent wux-element-contentbox"}).inject(I),y=e.createElement("div",{class:"wux-windows-window-header wux-element-contentbox"}).inject(v);p.setToolbar({entries:[{id:"listFilter",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"list-filter",fontIconFamily:c},position:"near",value:function(){require(["DS/Controls/Button","DS/Windows/Dialog","DS/Controls/Toggle","DS/Controls/ButtonGroup"],function(i,a,o,r){let l,s,c=e.createElement("div"),u=x(),p=e.createElement("div").inject(c);e.createElement("span",{class:"fonticon fonticon-3ds-who"}).inject(p),e.createElement("label",{text:d.pnlOwner,class:"r3mFilterOwner",styles:{"margin-left":"2px"}}).inject(p),p=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(c);var f=new r({type:"radio"}).inject(p);f.addChild(new o({label:d.pnlMe,value:0,type:"radio",checkFlag:0===u.owner})),f.addChild(new o({label:d.pnlOrga,value:1,type:"radio",checkFlag:1===u.owner})),f.addChild(new o({label:d.pnlAll,value:2,type:"radio",checkFlag:2===u.owner})),p=e.createElement("div").inject(c),e.createElement("span",{class:"fonticon fonticon-3ds-what"}).inject(p),e.createElement("label",{text:d.pnlMaturity,class:"r3mFilterMaturity",styles:{"margin-left":"2px","margin-top":"10px"}}).inject(p),p=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(c);var g=new o({label:d.pnlReleased,value:"idReleased",type:"checkbox",checkFlag:1===u.released}).inject(p),m=new o({label:d.pnlObsolete,value:"idObsolete",type:"checkbox",checkFlag:1===u.obsolete}).inject(p);p=e.createElement("div").inject(c),e.createElement("span",{class:"fonticon fonticon-3ds-what"}).inject(p),e.createElement("label",{text:d.pnlType,class:"r3mFilterType",styles:{"margin-left":"2px","margin-top":"10px"}}).inject(p),p=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(c);var h=new o({label:d.pnlRvw,value:"idRvw",type:"checkbox",checkFlag:1===u.rvw}).inject(p),v=new o({label:d.pnlIsr,value:"idIsr",type:"checkbox",checkFlag:1===u.isr}).inject(p),y=new o({label:d.pnlMsr,value:"idMsr",type:"checkbox",checkFlag:1===u.msr}).inject(p),S=new o({label:d.pnlMkp,value:"idMkp",type:"checkbox",checkFlag:1===u.mkp}).inject(p);function b(e){return Array.isArray(e.value)?e.value[0]:e.checkFlag?1:0}function M(){n.removeResizeListener(I),l.destroy()}var D=new i({emphasize:"primary",label:d.pnlOK,onClick:function(){M(),k.total.length=k.completed.length=k.failed.length=0,w({rvw:b(h),isr:b(v),mkp:b(S),msr:b(y),owner:b(f),released:b(g),obsolete:b(m)})}}),_=new i({label:d.pnlCancel,onClick:M});l=e.createElement("div",{class:"wux-windows-modalDialog",styles:{}}).inject(I),(s=new a({title:d.pnlTitle,ensureHeightDefinitionOnHierarchy:!0,content:c,resizableFlag:!0,height:345,position:{of:I,constraint:I},buttons:{Cancel:_,Ok:D}})).elements.container.inject(l),s.addEventListener("close",M),t(s.elements.container,I),n.addResizeListener(I,function(){t(s.elements.container,I)})})}}},{id:"sidePanel",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"info",fontIconFamily:c},position:"far",value:S}}]}).inject(y);var D=e.createElement("div",{class:"wux-windows-window-content wux-element-contentbox"}).inject(v);p.inject(D),n.addEventOnElement(v,v,"dimensionsChanged",function(){var e=window.getComputedStyle(D),t=e?e.getPropertyValue("padding-top"):"";t=""===t?0:parseInt(t,10);var n=e?e.getPropertyValue("padding-bottom"):"";n=""===n?0:parseInt(n,10);var i=y.offsetHeight+t+n;D.setStyle("height",i?"calc(100% - "+i+"px)":"100%")}),p.buildStatusBar(F)}()}})}),define("DS/DMUwebR3Mapp/DMUwebR3MappMain",[],function(){"use strict";var e;return Object.freeze({getApp:function(t){if(e)return e;var n,i=t.widget,a=document.createElement("div");a.classList.add("appMain"),a.style.width="auto",a.style.height="100%",require(["UWA/Core","i18n!DS/DMUwebR3Mctrl/assets/nls/DMUwebR3Mctrl.json","css!DS/DMUwebR3Mux/assets/css/DMUwebR3Mux"],function(e,t){var n=e.createElement("div",{class:"r3mWelcome"}),a=e.createElement("div",{class:"spinner spinner-lg spinning fade in",styles:{display:"flex","justify-content":"center"}}).inject(n);e.createElement("span",{class:"spinner-bar"}).inject(a),e.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(a),e.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(a),e.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(a),e.createElement("div",{class:"r3mWelcomeText",html:t.validationLoad}).inject(n),i.setBody(n)});var o,r=function(e){return o||(o=new Promise(function(t){e.perfoMark("requireCtrl"),require(["DS/DMUwebR3Mctrl/DMUwebR3Mctrl"],function(o){e.perfoMeasure("requireCtrl"),e.perfoMark("buildUX");var r=o.getCtrl({id:1,parent:a});r.buildUX().then(function(){e.perfoMeasure("buildUX"),n=r,i.dispatchEvent("onWidgetAndAppReady"),t()})})}))};return i.addEvent("onLoad",function(){window.top.performance.measure(i.id+"_R3M_onWidgetLoad",i.id+"_R3M_onWidgetLoad"),window.top.performance.mark(i.id+"_R3M_requireWidgetUtils"),require(["DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils"],function(e){window.top.performance.measure(i.id+"_R3M_requireWidgetUtils",i.id+"_R3M_requireWidgetUtils"),window.top.performance.mark(i.id+"_R3M_initServicesSecurityContext"),e.init({widget:i,onCompletedPlatformServices:function(t){e.perfoMeasure("initServicesSecurityContext","initServices"),t&&!0===t.success||window.console.error("TODO!!!"),r(e).then(()=>i.setBody(a))},onCompletedSecurityContext:function(){e.perfoMeasure("initServicesSecurityContext"),n?n.refresh():r(e).then(function(){n.refresh()})}})})}),i.addEvent("onDestroy",function(){n&&n.destroy(),n=null}),i.setMetas({helpPath:"DMUwebR3Mapp/assets/help"}),e=Object.freeze({})}})}),define("DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils",["DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","i18n!DS/DMUwebR3Mutils/assets/nls/DMUwebR3Mutils.json"].concat([]),function(e,t,n){"use strict";var i,a,o,r,l,s,d=[];function c(){return i&&i.lang||"en"}function u(){if(!i)throw new Error("App init not done");return o||(o=i.getValue("x3dPlatformId")),o}function p(){if(!i)throw new Error("App init not done");return r||(r=i.getValue("xPref_CREDENTIAL")),"ctx::"+r}function f(e){var t,n=u();if(!Array.isArray(a))throw new Error("Platform services not initialize yet");return a.some(function(i){if(i&&i.platformId===n)return t=i[e]}),t}function g(){return f("3DSpace")}function m(t){let n=g();if(!n)return void t.onCompleted(!1);let a=new Promise(function(e){require(["DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences"].concat([]),function(t){t.addCredentialPreferenceToWidget({usePreferredCredentials:!0},2).then(function(){p();let t=i.getPreferences(),n=[];t.length>1&&"xPref_CREDENTIAL"===t[0].name&&(n.push(t[1]),n.push(t[0]),i.setPreferences(n)),e(!0)})},e.bind(null,!1))}),o=new Promise(function(t){n+="/resources/modeler/pno/person?current=true&select=preferredcredentials",e.authenticatedRequest(n,{method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":c()},onComplete:function(e){e&&e.preferredcredentials?(l=e.preferredcredentials.organization,t(Boolean(l))):t(!1)},onFailure:function(){t(!1)}})});Promise.all([a,o]).then(function(e){t.onCompleted(e[0]&&e[1])})}return Object.freeze({init:function(e){return i?Promise.resolve():new Promise(function(t){i=e.widget,s=i.id+"_R3M_",u(),p(),i.setPreferences([]),require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(r){r.getPlatformServices({onComplete:function(l){r.getAppInfo({appId:i.getValue("x3dAppId"),onComplete:function(r){if(a=l,r.tenantAware){a=[];for(var s=0;s<r.platforms.length;++s)for(var d=0;d<l.length;++d)if(l[d].platformId===r.platforms[s].id){a.push(l[d]);break}}if(a&&a.length){var c=u();a.some(function(e){return e.platformId===c})||(o=c="",a.length&&(i.setValue("x3dPlatformId",a[0].platformId),c=u())),c&&a.length>1&&i.addPreference({name:"x3dPlatformId",type:"list",label:n.x3dPlatformId,options:a.map(function(e){return{label:e.displayName,value:e.platformId}}),defaultValue:c}),e.onCompletedPlatformServices({success:Boolean(c)||"tenant"}),m({onCompleted:()=>{e.onCompletedSecurityContext(),t()}})}else e.onCompletedPlatformServices({success:"platformServices"})},onFailure:function(){e.onCompletedPlatformServices({success:"getAppInfo"}),t()}})},onFailure:function(){e.onCompletedPlatformServices({success:"getPlatformServices"}),t()}})}),i.addEvent("endEdit",()=>{let e=i.getValue("x3dPlatformId"),t=e!==o;if(o=e,r=i.getValue("xPref_CREDENTIAL"),t){let e=new Promise(e=>{setTimeout(()=>m({onCompleted:e}),0)});d.forEach(t=>t(e))}})})},getWidget:function(){return i},getWidgetId:function(){return i.id},getWidgetAppId:function(){return i.getValue("x3dAppId")},getLang:c,getUserLogin:function(){var e=t.getUser();return e?e.login:""},getUserOrganizationName:function(){return l?l.name:""},getPlatformId:u,getPlatformIdServices:function(){return JSON.parse(JSON.stringify(a.filter(e=>e.platformId===o)))},get3DSpaceUrl:g,get3DSearchUrl:function(){return f("3DSearch")},get3DSwymUrl:function(){return f("3DSwym")},getR2VPlatformUrl:function(){return f("r2vsurvey")},getSecurityContext:p,onTenantModified:function(e){d.push(e)},perfoMark:function(e){window.top.performance.mark(s+e)},perfoMeasure:function(e,t){window.top.performance.measure(s+(t||e),s+e)}})}),define("DS/DMUwebR3Mutils/DMUwebR3McancelablePromise",[],function(){"use strict";return function(e){let t=!1,n=()=>{t=!0};const i=new Promise((i,a)=>{n=(()=>{t||i("Promise cancelled")}),t?n():e(i,a)});return i.then(e=>(t=!0,e)),i.catch(e=>(t=!0,e)),{promise:i,cancel:n}}}),define("DS/DMUwebR3Mutils/DMUwebR3MserverRequests",["DS/WAFData/WAFData","DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/DMUwebR3Mutils/DMUwebR3McancelablePromise","UWA/Core","i18n!DS/DMUwebR3Mutils/assets/nls/DMUwebR3Mutils.json"].concat([]),function(e,t,n,i,a,o){"use strict";let r,l,s,d,c,u=["ds6w:label","ds6w:identifier","ds6w:type","ds6w:status","ds6wg:dmuvalidationvalidation.v_validationstate","bo.SIMItfSimulation.V_ValidationState","ds6wg:simitfsimulation.v_itf_executionstatus","ds6w:description","ds6w:responsible","ds6w:responsibleuid","ds6w:originator","originator","ds6w:organizationResponsible","ds6w:modified","ds6w:created","ds6w:project"],p=["ds6w:label","ds6w:identifier","ds6w:type","ds6w:status","ds6wg:dmuvalidationcheck.v_validation_checkstate","bo.SIMItfSimulation.V_ValidationState","ds6w:description","ds6w:responsible","ds6w:responsibleuid","ds6w:originator","originator","ds6w:organizationResponsible","ds6w:modified","ds6w:created","ds6w:project"],f=["icon"],g=200,m={"ds6w:label":"title","ds6w:identifier":"name","ds6w:type":"type","ds6w:status":"maturity","ds6wg:dmuvalidationvalidation.v_validationstate":"validState","ds6wg:dmuvalidationcheck.v_validation_checkstate":"validState","bo.SIMItfSimulation.V_ValidationState":"validState","ds6wg:simitfsimulation.v_itf_executionstatus":"executionstate","ds6w:description":"description","ds6w:responsible":"owner","ds6w:responsibleuid":"ownerid","ds6w:originator":"originator",originator:"originatorid","ds6w:organizationResponsible":"organization","ds6w:modified":"dateModif","ds6w:created":"dateCreat","ds6w:project":"collabSpace",type_icon_url:"icon",resourceid:"id",physicalid:"id"},h=1,v=0,y=[];function w(e){return e+"-"+t.getUserLogin()+"-"+Date.now()}function S(e){return new Promise(function(i){n.getNlsOfPropertiesValues(JSON.stringify(e),{tenantId:t.getPlatformId(),lang:t.getLang(),apiVersion:"R2019x",onComplete:function(t){Object.keys(t).forEach(function(e){l[e]=Object.assign(l[e]||{},t[e])}),Object.keys(e).forEach(function(t){e[t].forEach(e=>{l[t][e]||(l[t][e]=e)})}),e["ds6w:status"]&&Object.keys(l["ds6w:status"]).forEach(e=>{e.search(".DEFAULT")>-1&&(l["ds6w:status"][e]="")}),i()},onFailure:function(){i()}})})}function b(e){if(e){if(d.hasOwnProperty(e))return d[e];var n=t.get3DSwymUrl();return d[e]=n?n+"/api/user/getpicture/login/"+e+"/format/mini":""}}function M(e,t){var n={};return Object.keys(e).forEach(function(i){var a=m[i];n[a]=e[i],l[i]&&(l[i].hasOwnProperty([e[i]])?n[a+"Disp"]=l[i][e[i]]:(t[i]||(t[i]={values:[],objects:[]}),-1===t[i].values.indexOf(e[i])&&t[i].values.push(e[i]),t[i].objects.push(n)))}),n.ownerImg=b(n.ownerid),n.originatorImg=b(n.originatorid),n}function I(e,t){return e.map(function(e){return M(e,t)})}function x(e,t){if(t)return t.validState="2"===e?"Passed":"3"===e?"Failed":"InProgress",t.validStateDisp=o["validState"+t.validState],t}function D(n){var i={Accept:"application/json","Content-Type":"application/json"};return n.securityContext&&(i.SecurityContext=n.securityContext),e.authenticatedRequest(n.url+"?tenant="+t.getPlatformId()+(n.securityContext?"&SecurityContext="+n.securityContext:""),{method:n.method,type:"json",headers:i,data:JSON.stringify(n.data),timeout:n.timeout,onComplete:n.onComplete,onFailure:n.onFailure,onTimeout:n.onTimeout||n.onFailure})}function _(n){if(n){var i=a.clone(n.config,!1);i.onComplete=n.onSuccess,i.onFailure=n.onFailure,i.method=i.verb,i.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang(),SecurityContext:t.getSecurityContext()},"object"==typeof i.data&&(i.data=JSON.stringify(i.data));var o=[];o.push("securityContext"),o.push(t.getSecurityContext()),o.push("tenant"),o.push(t.getPlatformId()),e.authenticatedRequest(t.get3DSpaceUrl()+"/"+n.url,i)}}function C(e){return{input_physical_ids:e,label:w("R3MwebMkp"),primitives:[{navigate_from_rel:{id:1,filter:{rel_type:["Markup"]}}},{navigate_from_rel:{id:2,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{context:[{id:1}],issue:[{id:2}]},fileAttributes:f,attributes:p,version:3}}function E(e){return new Promise(function(n){D({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:e,onComplete:function(e){n(e)},onFailure:function(){n({})}})})}function P(e){let n=Object.keys(e);return n.length?new Promise(e=>{D({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:function(e){return{input_physical_ids:e,label:w("R3MwebTic"),primitives:[{navigate_from_rel:{id:1,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{issue:[{id:1}]},fileAttributes:f,attributes:p,version:3}}(n),onComplete:e,onFailure:function(){e()}})}):Promise.resolve()}const R=e=>new Promise(t=>{"DMUValidationValidation"===e.input_object["ds6w:type"]||"Markup"===e.input_object["ds6w:type"]?_({url:"resources/validation/service/getAll",config:{verb:"POST",data:{sValidationId:e.input_object.physicalid}},onSuccess:function(e){var n=JSON.parse(e);t(n)},onFailure:function(){t()}}):"DMUMarkupRepReference"===e.input_object["ds6w:type"]?_({url:"resources/markup/service/getMarkup",config:{verb:"POST",data:{sMarkupId:e.input_object.physicalid}},onSuccess:function(n){var i=JSON.parse(n);_({url:"/cvservlet/fetch/v2",config:{verb:"POST",data:{physicalid:i.MarkupContext.contextId,label:"M3DFetchForWelcomePanel"+Date.now(),select_predicate:u,select_file:f}},onSuccess:function(n){var a=JSON.parse(n),o=[],r={physicalid:i.MarkupContext.contextId};a.results[0].attributes.forEach(function(e){r[e.name]=e.value}),o.push(r),e.outputs.context=o,t(e)},onFailure:function(){t()}})},onFailure:function(){t()}}):t()});function O(e){return new Promise(function(n){D({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:e,onComplete:function(e){var t={},i={},a=[],o=[],r=[],s={};e.result.forEach(function(e){var n=e.input_object.physicalid;t[n]={},["context","highlight","check","issue","ca"].forEach(function(a){e.outputs[a]&&(t[n][a]=I(e.outputs[a],i))}),(t[n].highlight||[]).forEach(e=>{s[e.id]=e}),(t[n].check||[]).forEach(e=>x(e.validState,e)),(e.outputs.checked||[]).forEach(function(e){let a=e.owner.physicalid;(t[n].check||[]).some(t=>{if(!t.children)return t.id===a?(t.children=I(e.elements,i),!0):void 0})}),e.outputs.validatedPath&&(t[n].validatedPath=[],e.outputs.validatedPath.forEach(function(e){if(!e.elements.length)return;let i=e.elements[0]["ds6w:type"],r="VPMInstance"===i||"VPMRepInstance"===i;t[n].validatedPath[e.app_index||e.sr_id]=e.elements.map(function(e,t){return r&&(0===t&&-1===a.indexOf(e.physicalid)&&a.push(e.physicalid),-1===o.indexOf(e.physicalid)&&o.push(e.physicalid)),e.pid=e.physicalid,e.type=e["ds6w:type"],e}),t[n].validatedPath[e.app_index||e.sr_id].instancePath=r}),t[n].validatedPath=t[n].validatedPath.filter(function(e){return e&&e.length}),t[n].validatedPath.length&&r.push(t[n])),e.outputs.prd&&(t[n].context=(t[n].context||[]).concat(I(e.outputs.prd,i)))});const d=[];e.result.map(e=>{void 0===e.outputs.context&&d.push(R(e))});const c=[];e.result.map(e=>{void 0===e.outputs.context&&"DMUMarkupRepReference"===e.input_object["ds6w:type"]&&c.push(R(e))}),Promise.all([0===c.length?Promise.resolve():Promise.all(c)]).then(function(e){var c;e[0]&&e[0].forEach(function(e){t[e.input_object.physicalid].context=I(e.outputs.context,i)}),Promise.all([a.length?E((c=a,{input_physical_ids:c,label:w("R3MwebValidFrom"),primitives:[{navigate_from_rel:{id:1}}],patterns:{root:[{id:1}]},fileAttributes:f,attributes:p,version:3})):Promise.resolve(),o.length?E(function(e){return{input_physical_ids:e,label:w("R3MwebValidTo"),primitives:[{navigate_to_rel:{id:1}}],patterns:{ref:[{id:1}]},fileAttributes:f,attributes:p,version:3}}(o)):Promise.resolve(),P(s),0===d.length?Promise.resolve():Promise.all(d)]).then(function(e){var n={},a={},o={};(e[0]&&e[0].result||[]).forEach(function(e){n[e.input_object.physicalid]={pid:e.outputs.root[0].physicalid,type:e.outputs.root[0]["ds6w:type"]},o[e.outputs.root[0].physicalid]||(o[e.outputs.root[0].physicalid]=e.outputs.root[0])}),(e[1]&&e[1].result||[]).forEach(function(e){a[e.input_object.physicalid]={pid:e.outputs.ref[0].physicalid,type:e.outputs.ref[0]["ds6w:type"]},o[e.outputs.ref[0].physicalid]||(o[e.outputs.ref[0].physicalid]=e.outputs.ref[0])}),r.forEach(function(e){e.validated=[],e.validatedPath.forEach(function(t,r){let l;if(t.instancePath){l=M(o[a[t[t.length-1].pid].pid],i);var s=[n[t[0].pid]];t.forEach(function(e){s.push(e),s.push(a[e.pid])}),l.validatedPath=s}else(l=M(t[t.length-1],i)).validatedPath=t;e.validated[r]=l,l.pid=l.id,l.id=String(h++)}),delete e.validatedPath}),(e[2]&&e[2].result||[]).forEach(e=>{let t=e.input_object.physicalid;["issue","ca"].forEach(n=>{e.outputs[n]&&(s[t][n]=I(e.outputs[n],i))})}),(e[3]||[]).forEach(e=>{void 0!==e&&void 0!==e.children&&e.children.forEach(n=>{n&&"DMUValidationContext"===n.type&&void 0===t[e.id].context&&(t[e.id].context=[{id:n.contextId,serviceId:n.serviceID}],t[e.id].validated=[{id:n.contextId,serviceId:n.serviceID}])})})}).then(function(){Object.keys(i).length?new Promise(function(){var e={};Object.keys(i).forEach(function(t){e[t]=i[t].values}),S(e).then(function(){Object.keys(i).forEach(function(e){i[e].objects.forEach(function(t){var n=m[e];t[n+"Disp"]=l[e][t[n]]})}),n(t)})}):n(t)})})},onFailure:function(){n({})}})})}function V(e){var n;D({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:(n=e.ctxIDs,{input_physical_ids:n,label:w("R3MPIMwebItfCtx"),primitives:[{navigate_to_sr:{id:1,filter:{semantics:["6"],role:["198"]},mode:"last"}},{navigate_to_rel:{id:2}}],patterns:{ms:[{id:1}]},attributes:["ds6w:type","bo.PLMPIMMetricReference.V_Itf_Type","bo.PLMPIMMetricReference.V_Itf_Analysis","bo.SIMItfContextOfInterference.V_Context_Validity_Status"],fileAttributes:[],version:3}),onProgress:e.onProgress,onComplete:e.onComplete,onFailure:e.onFailure})}var j,k,T,F=(j=[],k=0,T=function(e,t){k--,F(),t(e)},function(e){var t,n;e&&j.push(e),j.length&&k<5&&(k++,t=j.shift(),(n=a.clone(t,!1)).onComplete=function(e){T(e,t.onComplete)},n.onFailure=function(e){T(e,t.onFailure)},n.onTimeout=function(e){T(e,t.onTimeout||t.onFailure)},V(n))});function U(e,n,i){var a,o={simPid:e,nbTotalItf:0,nbOK:0,nbKO:0};D({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:(a=e,{input_physical_ids:a,label:w("R3MPIMwebIsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Result_Category_Ref"]}}},{navigate_to_rel:{id:2}}],patterns:{itfCtxt:[{id:1},{id:2}]},fileAttributes:[],attributes:["ds6wg:simitfsimulation.v_itf_executionstatus"],version:3}),onComplete:function(t){let a=t.result[0];if(!a||0===Object.keys(a.outputs).length)return a.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"]&&(o.ExecStatus=a.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"]),void n({status:"success",output:[o]});let r=(a.outputs.itfCtxt||[]).map(function(e){return e.physicalid}),l=[];o.ExecStatus=a.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"],0===r.length&&n({status:"success",output:[o]}),o.nbTotalItf=r.length;var s=Math.floor((r.length-1)/500)+1,d=0,c=[],u=!1;for(;d<s&&!u;)F({ctxIDs:r.slice(500*d,500*(d+1)),onComplete:function(t){var a,s=[];t.result.forEach(function(e){if(s.push(e.input_object.physicalid),e.input_object&&"1"!==e.input_object["bo.SIMItfContextOfInterference.V_Context_Validity_Status"])o.nbTotalItf--;else if(e.outputs&&e.outputs.ms&&1===e.outputs.ms.length){if(l.indexOf(e.outputs.ms[0].physicalid)>-1)return void o.nbTotalItf--;l.push(e.outputs.ms[0].physicalid);let t=e.outputs.ms[0];"5"===t["bo.PLMPIMMetricReference.V_Itf_Type"]||"6"===t["bo.PLMPIMMetricReference.V_Itf_Type"]?o.nbTotalItf--:"1"===t["bo.PLMPIMMetricReference.V_Itf_Analysis"]?o.nbOK++:"2"===t["bo.PLMPIMMetricReference.V_Itf_Analysis"]&&o.nbKO++}}),a={itfIDs:s},u&&n({status:"failure",simIds:[e]}),c.push.apply(c,a.itfIDs),c.length===r.length?n({status:"success",output:[o]}):i(e,r.length,c.length)},onFailure:function(){n({status:"failure",simIds:[e]}),u=!0}}),d++},onFailure:function(){n({status:"failure",simIds:[e]})}})}function A(e){return new Promise(function(n){D({url:t.get3DSpaceUrl()+"/resources/dictionary/getTypeInfo",method:"POST",data:[e],onComplete:function(t){Object.keys(t).forEach(function(t){-1===s[e].indexOf(t)&&s[e].push(t)}),n()},onFailure:n})})}function N(){return c?Promise.resolve():(d={},r={},l={"ds6w:type":{},"ds6w:status":{},"ds6wg:dmuvalidationvalidation.v_validationstate":{}},s={DMUValidationValidation:["DMUValidationValidation"],SIMItfSimulation:["SIMItfSimulation"],Markup:["Markup"],DMUMarkupRepReference:["DMUMarkupRepReference"],DesignSight:["DesignSight"]},Promise.all([A("DMUValidationValidation"),A("SIMItfSimulation"),new Promise(function(e){n.getResourcesInfo(u.join(","),{tenantId:t.getPlatformId(),lang:t.getLang(),apiVersion:"R2019x",onComplete:function(t){(t||[]).forEach(function(e){r[m[e.curi]]=e.label}),r.validState=o.validState,r.analysisState=o.analysisState,e(r)},onFailure:function(){u.forEach(function(e){r[m[e]]=e}),e(r)}})}),S({"ds6w:type":["SIMItfSimulation","DMUValidationValidation","Markup","DMUMarkupRepReference","VPMReference","Requirement","DMUValidationExposedPresentation","Member List","Drawing","ENOStrRefinementSpecification"],"ds6w:status":["VPLM_SMB_Evaluation.PRIVATE","VPLM_SMB_Evaluation.IN_WORK","VPLM_SMB_Evaluation.FROZEN","VPLM_SMB_Evaluation.RELEASED","VPLM_SMB_Evaluation.OBSOLETE","VPLM_SMB_Definition.PRIVATE","VPLM_SMB_Definition.IN_WORK","VPLM_SMB_Definition.FROZEN","VPLM_SMB_Definition.RELEASED","VPLM_SMB_Definition.OBSOLETE"]})]).then(function(){c=!0}))}t.onTenantModified(()=>{c=!1,N().then(()=>y.forEach(e=>e()))});var L=Object.create({}),W=Object.getPrototypeOf(L);return Object.defineProperty(W,"_NB_SEARCH_RESULTS",{get:()=>g,set:e=>{g=e}}),W.getColumnsNls=function(){return N().then(function(){return r})},W.getRvwTypes=function(){return[].concat(s.DMUValidationValidation)},W.getIsrTypes=function(){return[].concat(s.SIMItfSimulation)},W.getMkpTypes=function(){return[].concat(s.Markup)},W.getNewMkpTypes=function(){return[].concat(s.DMUMarkupRepReference)},W.getMsrTypes=function(){return[].concat(s.DesignSight)},W.getMaturityNlsValue=(e=>l["ds6w:status"][e]||""),W.getValidStateNlsValue=(e=>o["validState"+e]),W.getAnalysisStateNlsValue=(e=>o["analysisState"+e]),W.updateCheckStateValue=x,W.search=function(e,n){let a=[],r=new i(function(i){if(v++,!(e.rvw||e.isr||e.mkp||e.msr))return n({},0),void i();!function r(l,s,d){var c={query:function(e){var n="(";return n+=e.mkp?'flattenedtaxonomies:"types/Markup"':"",e.mkp&&n.length>1&&(n+=" OR "),n+=e.mkp?'flattenedtaxonomies:"types/DMUMarkupRepReference"':"",e.isr&&n.length>1&&(n+=" OR "),n+=e.isr?'flattenedtaxonomies:"types/SIMItfSimulation"':"",e.rvw&&n.length>1&&(n+=" OR "),n+=e.rvw?'flattenedtaxonomies:"types/DMUValidationValidation"':"",e.msr&&n.length>1&&(n+=" OR "),n+=e.msr?'flattenedtaxonomies:"types/DesignSight"':"",n+=")",e.released||(n=n.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.RELEASED OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.RELEASED)")),e.obsolete||(n=n.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.OBSOLETE OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.OBSOLETE)")),0===e.owner?n+=' AND [ds6w:responsibleuid]:"'+t.getUserLogin()+'"':1===e.owner&&(n+=' AND [ds6w:organizationResponsible]:"'+t.getUserOrganizationName()+'"'),n}(l),locale:t.getLang(),tenant:t.getPlatformId(),nresults:g,label:w("R3MwebSearch_"+v),select_predicate:u,select_file:f,with_synthesis:!1,with_synthesis_attribute:!1,with_nls:!0,login:{"3dspace":{SecurityContext:t.getSecurityContext()}},source:["3dspace"]};c[0===s?"start":"next_start"]=s,a.push(D({url:t.get3DSearchUrl()+"/search",method:"POST",data:c,onComplete:function(t){var a={};(t.results||[]).forEach(function(e){if(e&&e.attributes){var t={};e.attributes.forEach(function(e){var n=(e.name||"bug").split("/"),i=n[n.length-1];m[i]&&("ds6w:type"===i?(t.type=e.value,t.typeDisp=e.dispValue):"ds6w:status"===i?(t.maturity=e.value,t.maturityDisp=e.dispValue||e.value):"ds6wg:dmuvalidationvalidation.v_validationstate"===i?(t.validState=e.value,t.validStateDisp=o["validState"+e.value]):"bo.SIMItfSimulation.V_ValidationState"===i?(t.validState=e.value,t.validStateDisp=o["validState"+e.value]):"ds6wg:simitfsimulation.v_itf_executionstatus"===i?t.executionState=e.value:t[m[i]]=e.dispValue||e.value)}),t.analysisState="unknown",t.analysisStateDisp="",t.analysisStateNbKO=0,t.analysisStateProgress=0,t.ownerImg=b(t.ownerid),t.originatorImg=b(t.originatorid),t.id&&(a[t.id]=t)}}),n(a,d),t.infos.nresults?r(e,t.infos.next_start,++d):i()},onFailure:function(){i()}}))}(e,0,0)});return r.promise.then(e=>(e&&a.forEach(e=>e.cancel()),e)),r},W.evalAnalysisStatus=function(e,t,n){U(e.id,t,n)},W.getFeatureStateInfo=function(n){return new Promise(function(i){(function(n){return new Promise((i,a)=>{e.authenticatedRequest(t.getR2VPlatformUrl(n.serviceId)+"/enovia/resources/r2v/v1/modeler/featurestate/fetch",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},data:JSON.stringify({ids:[n.objectId]}),timeout:6e4,onComplete:function(e){let t=JSON.parse(e);i(t)},onFailure:a,onTimeout:a})})})(n).then(e=>{i(e)})})},W.onTenantModified=function(e){y.push(e)},W.navigate=function(e){var t,n=[e.rvwIds.length?O((t=e.rvwIds,{input_physical_ids:t,label:w("R3MwebRvw"),primitives:[{navigate_to_rel:{id:1,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"]}}},{navigate_to_sr:{id:2,filter:{semantics:["1"],role:["78"]}}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["110"]},mode:"path"}},{navigate_to_sr:{id:4,filter:{semantics:["5"],role:["151"]},mode:"path"}},{navigate_to_rel:{id:5,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"],bo_type:["DMUValidationCheck"]}}},{navigate_to_rel:{id:6,filter:{rel_type:["VPLMrel/PLMPort/V_Owner"],bo_type:["DMUValidationExposedPresentation"]}}},{navigate_from_rel:{id:7,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{context:[{id:1},{id:2}],validatedPath:[{id:1},{id:3}],check:[{id:5}],checked:[{id:1},{id:4}],highlight:[{id:6}],issue:[{id:7}]},fileAttributes:f,attributes:p,version:3})):Promise.resolve({}),e.isrIds.length?O(function(e){return{input_physical_ids:e,label:w("R3MwebIsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Model_Category_Ref"]}}},{navigate_to_rel:{id:2}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["79"]},mode:"last"}},{navigate_to_sr:{id:4,filter:{semantics:["4"],role:["170"]},mode:"last"}},{navigate_from_rel:{id:5,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{prd:[{id:1},{id:2},{id:3}],context:[{id:1},{id:2},{id:4}],issue:[{id:5}]},fileAttributes:f,attributes:p,version:3}}(e.isrIds)):Promise.resolve({}),e.mkpIds.length?O(C(e.mkpIds)):Promise.resolve({}),e.newMkpIds.length?O(C(e.newMkpIds)):Promise.resolve({}),e.msrIds.length?O(function(e){return{input_physical_ids:e,label:w("R3MwebMsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Model_Category_Ref"]}}},{navigate_to_rel:{id:2}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["79"]},mode:"last"}},{navigate_to_sr:{id:4,filter:{semantics:["4"],role:["170"]},mode:"last"}},{navigate_from_rel:{id:5,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{prd:[{id:1},{id:2},{id:3}],context:[{id:1},{id:2},{id:4}],issue:[{id:5}]},fileAttributes:f,attributes:p,version:3}}(e.msrIds)):Promise.resolve({})];return Promise.all(n)},L}),define("DS/DMUwebR3Mctrl/DMUwebR3Mctrl",["UWA/Class","UWA/Core","UWA/Utils/InterCom","DS/DMUwebR3Mux/DMUwebR3Mlist","DS/ENOXTriptych/js/ENOXTriptych","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils","DS/DMUwebR3Mutils/DMUwebR3MserverRequests","DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils","DS/CoreEvents/ModelEvents","DS/PlatformAPI/PlatformAPI","i18n!DS/DMUwebR3Mctrl/assets/nls/DMUwebR3Mctrl.json","css!DS/DMUwebR3Mux/assets/css/DMUwebR3Mux"],function(e,t,n,i,a,o,r,l,s,d,c,u,p){"use strict";function f(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var g=e.extend({init:function(e){let g,m,h,v,y,w,S,b,M,I=new c,x=e.parent,D={},_={},C=f(),E=0,P=[],R={all:[],pending:[],completed:[],timeout:[],running:[]},O=Object.freeze({rvw:1,isr:1,msr:1,mkp:0,owner:0,released:0,obsolete:0});function V(e){if(D[e])return[e];let t=[];return Object.keys(D).forEach(n=>{(function e(t,n){if(n){if(n[t])return 1;if(n.children)return n.children&&n.children[t]?1:Object.keys(n.children).some(i=>e(t,n.children[i]))}})(e,D[n])&&t.push(n)}),t}function j(e){var t=Object.keys(D).length;d.getWidget().setTitle(e?"":0===t?p.noValidObj:p["validObj"+(1===t?"":"s")]+t)}function k(e){if(void 0===e.validState)return;if(e.validStateWarning="",s.getIsrTypes().indexOf(e.type)>-1)"InProgress"===e.validState?"donenoko"!==e.analysisState&&"donewithko"!==e.analysisState||(e.validStateWarning=p.itfwarningAnalyzed):"Failed"===e.validState?"notcomputed"===e.analysisState?e.validStateWarning=p.itfwarningNotComputed:"startednoko"===e.analysisState?e.validStateWarning=p.itfwarningNotAnalyzed:"donenoko"===e.analysisState?e.validStateWarning=p.itfwarningNotReported:"computed"===e.analysisState&&(e.validStateWarning=p.itfwarningComputed):"Passed"===e.validState&&("notcomputed"===e.analysisState?e.validStateWarning=p.itfwarningNotComputed:"startednoko"===e.analysisState||"startedwithko"===e.analysisState?e.validStateWarning=p.itfwarningNotAnalyzed:"donewithko"===e.analysisState?e.validStateWarning=p.itfwarningReported:"computed"===e.analysisState&&(e.validStateWarning=p.itfwarningComputed));else{let t=e.children&&e.children[e.id+"_check"];if(!(t=t&&t.children?Object.keys(t.children).map(e=>_[e]).filter(e=>e):null)||!t.length)return;"InProgress"!==e.validState||t.some(t=>t.validState===e.validState)?"Failed"!==e.validState||t.some(t=>t.validState===e.validState)?"Passed"!==e.validState||t.every(e=>"Passed"===e.validState)||(e.validStateWarning=p.warningpassed):e.validStateWarning=p.warningfailed:e.validStateWarning=p.warninginprogress}}function T(e,t,n){if(!e||!t)return;let i,a=n||t.issue&&t.issue.length&&t.ca&&t.ca.length;return["issue","ca"].forEach(n=>{if(!t[n]||!t[n].length)return;i=!0;let o=e.children||(e.children={});if(a){let i=e.id+"_"+n;o[i]={id:i,title:p[n+(t[n].length>1?"s":"")],children:{}},o=o[i].children}t[n].forEach(e=>{o[e.id]=e}),delete t[n]}),!n&&a&&(e.noSort=!0),i}function F(e){var t,n=[],i=[],a=[],o=[],r=[],l=s.getRvwTypes(),d=s.getIsrTypes(),c=s.getMkpTypes(),u=s.getMsrTypes(),f=s.getNewMkpTypes();Object.keys(e).forEach(function(e){t=this[e].type,l.indexOf(t)>-1?n.push(e):d.indexOf(t)>-1?i.push(e):c.indexOf(t)>-1?a.push(e):f.indexOf(t)>-1?o.push(e):u.indexOf(t)>-1&&r.push(e)},e);var g={rvwIds:n,isrIds:i,mkpIds:a,newMkpIds:o,msrIds:r};s.navigate(g).then(function(e){var t={};[0,1,2,3,4].forEach(function(e){Object.keys(this[e]).forEach(function(e){let n=D[e];if(!n)return void window.console.log("id: "+e+" not in validated objects list");let i=["validated","check","highlight","issue","ca"].some(t=>this[e][t]&&this[e][t].length);["context","validated","check","highlight"].forEach(function(t){if(!this[t]||!this[t].length)return;let a=n.children||(n.children={});if(i){let n=e+"_"+t;a[n]={id:n,title:p[t+(this[t].length>1?"s":"")],children:{}},"validated"===t&&(a[n].validatedPath=this.validatedPath),"highlight"===t&&this[t].forEach(e=>T(e,e,!1)),a=a[n].children}this[t].forEach(function(e){a[e.id]=D[e.id]||e}),delete this[t]},this[e]),T(n,this[e],!0),function e(t){t&&t.id&&(_[t.id]||(_[t.id]=t),Object.keys(t.children||{}).forEach(n=>e(t.children[n])))}(n),k(n),i&&(n.noSort=!0),t[e]=n},this[e])},e),m.updateValidations(t)})}function U(){w&&w.dialog&&w.dialog.destroy(),w=null,S&&S.clean(),S=null,P&&P.forEach(e=>e.cancel()),P=[],d.perfoMark("refreshGrid_"+ ++E);const e=t.createElement("div",{class:"r3mLoadingValidations mask wux-datagridview-emptycontentmessage"}).inject(x),n=t.createElement("div",{class:"spinner spinner-lg spinning fade in",styles:{display:"flex","justify-content":"center"}}).inject(e);t.createElement("span",{class:"spinner-bar"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(n),t.createElement("div",{class:"r3mWelcomeText",html:p.validationLoad,styles:{}}).inject(e),j(!0),D={},_={};const i=s.search(b,function(e,t){D=Object.assign(D,e),_=Object.assign(_,e),0===t&&m.removeAll(),m.updateValidations(e),m.checkFilterAndFetchValue(),F(e),j()});i.promise.finally(function(){e.destroy(),d.perfoMeasure("refreshGrid_"+this)}.bind(E)),P.push(i)}function A(e,t){function n(e,t){return e.some(function(e){return t.length===e.length&&e.every(function(e,n){return e===t[n]})})}m.getSelectedRows().forEach(function(i){if(!i||!i.id||!_[i.id])return void window.console.error("Unidentified object");let a;(a=i.id.search("_")>-1?Object.values(_[i.id].children):[_[i.id]]).forEach(function(i){var a;i.validatedPath&&i.validatedPath.length>2?(a=i.validatedPath.map(function(e){return t[e.pid]||(t[e.pid]={type:e.type}),e.pid}),n(e,a)||e.push(a)):(t[i.pid||i.id]||(t[i.pid||i.id]={type:i.type}),a=[i.pid||i.id],n(e,a)||e.push(a))})})}function N(e,t,n){t.forEach(function(t){e.push({envId:d.getPlatformId(),serviceId:"3DSpace",contextId:d.getSecurityContext(),objectId:t[t.length-1],objectType:n[t[t.length-1]].type,path:t.length>2?t.map(function(e){return{resourceid:e,type:n[e].type}}):void 0})})}function L(e,t){var n={protocol:"3DXContent",version:"1.0",source:d.getWidgetAppId(),data:{items:[]}};return N(n.data.items,e,t),n}function W(e){var t,i=[],a={};if(A(i,a),t=i.map(function(e){var t=e[e.length-1],n=a[t].type,i={getID:function(){return t},tenant:d.getPlatformId(),type:n};return e.length>2&&(i.getRelationID=function(){return e[e.length-2]}),l.getModelFromSelectedNode(i)}),g.getRightOpen()&&h.initDatas(t),!e){var o={version:"1.1",paths:i,attributes:a,tenant:d.getPlatformId()},r={uid:f(),originUid:C,timestamp:Date.now(),appid:d.getWidgetAppId(),originWidgetId:d.getWidgetId()};u.publish("DS/PADUtils/PADCommandProxy/select",{data:o,metadata:r}),v||(y=d.getWidgetAppId()+"_CompassSocket_"+d.getWidgetId(),(v=new n.Socket(y)).subscribeServer("com.ds.compass",window.parent)),i.length?v.dispatchEvent("onSetX3DContent",L(i,a),y):v.dispatchEvent("onResetX3DContent",{},y)}}function B(){W()}function q(){W()}function z(e){var t;["rvw","isr","mkp","msr","owner","released","obsolete"].forEach(function(n){e[n]!==b[n]&&(t=!0,b[n]=e[n])}),t&&(U(),localStorage.setItem("R3MwebPrefs",JSON.stringify(b)))}function X(){var e=g.getRightOpen();I.publish({event:e?"triptych-hide-panel":"triptych-show-panel",data:"right"}),m.setInfoState(!e),e||W(!0)}function J(){var e=[],t={};return A(e,t),e.filter(e=>!(e&&1===e.length&&t[e[0]]&&"DMUValidationCheck"===t[e[0]].type))}function K(){require(["DS/TransientWidget/TransientWidget"].concat([]),function(e){var t=[],n={};A(t,n),e.showWidget("ENORIPE_AP","",{X3DContentId:JSON.stringify(L(t,n))},{mode:"panel",width:700,height:800})})}function Q(){let e=m.getSelectedRows();if(!e.length)return;let t=[];return e.forEach(e=>{let n=D[e.id],i=n&&-1!==s.getRvwTypes().concat(s.getIsrTypes()).indexOf(n.type)&&n.id;i&&t.push({physicalid:i,tenant:d.getPlatformId()})}),t}function H(){require(["DS/MaturityWidget/MaturityWidget"].concat([]),function(e){w&&w.dialog&&w.dialog.destroy(),(w=new e({externalSettings:d.getPlatformIdServices()})).addEvent("onMaturityCanceled",()=>{w=null}),w.addEvent("onMaturityTransitionEnd",e=>{if(!e||!e.data)return;let t={},n=[];e.data.forEach(e=>{let i=D[e.physicalid];if(!i)return;i.maturityDisp=s.getMaturityNlsValue(i.maturity="VPLM_SMB_Evaluation."+e.tostate);let a=e.tostate.toLowerCase();"released"===a&&!b.released||"obsolete"===a&&!b.obsolete?n.push(e.physicalid):t[e.physicalid]=i}),m.updateValidations(t),m.removeValidation(n)}),w.executeCmd(Q(),{context:{getSecurityContext:()=>({SecurityContext:d.getSecurityContext()})}},()=>{})})}function G(e){s.getFeatureStateInfo(e).then(t=>{let n=D[e.validatedObjId];if(n.children[e.text]&&n.children[e.text].children){let i=n.children[e.text].children[e.objectId];if(i){i.dateCreat=t.result[0].grid["ds6w:created"],i.dateModif=t.result[0].grid["ds6w:modified"],i.icon=t.result[0].icon,i.ownerid=t.result[0].grid.owner,i.owner=t.result[0].grid["ds6w:responsible"],i.title=t.result[0]["ds6w:label"],i.type=t.result[0].type;let e={};e[i.id]=i,m.updateValidations(e,!1,!0)}}})}function Z(e){function t(e,t,n,i){e.analysisState=t,e.analysisStateDisp=s.getAnalysisStateNlsValue(t),e.analysisStateNbKO=n;let a={};k(e),a[e.id]=e,m.updateValidations(a,i)}let n=D[e[0]];if(n&&0===n.executionState)return void t(n,"notcomputed",0);function i(e){let t=R.pending.indexOf(e);if(t>-1&&R.pending.splice(t,1),-1===(t=R.completed.indexOf(e))&&R.completed.push(e),(t=R.running.indexOf(e))>-1&&R.running.splice(t,1),R.pending.length>0){let e=R.running.length;R.pending.forEach(function(t){(0===R.running.length||R.running.length>0&&R.running.indexOf(t))&&(Z([t]),e+=1)})}}function a(e,t,n){let i=D[e];if(i){i.analysisStateProgress=Math.ceil(n/t*100);let e={};e[i.id]=i,m.updateValidations(e,!1)}}function o(e){let n="error",a=0;if("timeout"===e.status)i(e.simIds[0]);else if("failure"!==e.status&&Array.isArray(e.output))e.output.forEach(function(e){let i=e.nbTotalItf,o=e.nbOK,r=e.nbKO,l=e.nbTotalItf-(e.nbKO+e.nbOK),s=e.simPid;"0"===e.ExecStatus?n="notcomputed":o===i?n="donenoko":l&&r?(n="startedwithko",a=r):l&&0===r&&o?n="startednoko":l&&0===r&&0===o?(n="computed",a=i):i===r+o?(n="donewithko",a=r):n="startednoko",D[s]&&D[s].analysisState!==n&&(t(D[s],n,a),m.updateStatusBar(D[s].id,"success"))}),i(e.output[0].simPid);else{let o=e.simIds?e.simIds[0]:"";D[o]&&D[o].analysisState!==n&&(t(D[o],n,a),m.updateStatusBar(D[o].id,"failure")),i(e.simIds[0])}}let r=e[0];for(-1===R.all.indexOf(r)&&R.all.push(r),-1===R.pending.indexOf(r)&&R.pending.push(r);R.running.length<4&&-1===R.running.indexOf(r);){let e=D[r];if(!e)return;let n=s.getIsrTypes(),i=e.type;n.indexOf(i)>-1&&("unknown"===e.analysisState&&t(e,"running",0,!0),-1===R.running.indexOf(r)&&(R.running.push(r),s.evalAnalysisStatus(e,o,a)))}}function Y(){let e=m.getSelectedRows();if(1!==e.length)return;let t=[];return e.forEach(e=>{let n=D[e.id],i=n&&(-1!==s.getRvwTypes().indexOf(n.type)||-1!==s.getIsrTypes().indexOf(n.type))&&n.id;if(!i)return;let a=n.validState;a="Failed"===a?"failed":"Passed"===a?"passed":"inProgress";let o=-1!==s.getIsrTypes().indexOf(n.type);t.push({title:n.title,physicalid:i,status:a,isrType:o})}),t}function $(e,t){let n=D[e];return n.validState="passed"===t?"Passed":"failed"===t?"Failed":"InProgress",n.validStateDisp=s.getValidStateNlsValue(n.validState),k(n),n}function ee(){require(["DS/CATWebUXCVS/CATWebUXCVSComponent"].concat([]),function(e){S&&S.clean(),S=null;let t=Y();t&&1===t.length&&(t=t[0],S=new e({title:t.title,physicalId:t.physicalid,current:t.status,isrType:t.isrType,parent:x,platformSettings:d.getPlatformIdServices(),tenant:d.getPlatformId(),securityContext:{getSecurityContext:()=>({SecurityContext:d.getSecurityContext()})},onChangeValidationStateCompleted:function(e){if(S&&S.clean(),S=null,!e)return;let n=$(t.physicalid,e.sValidationState);n&&m.updateValidations({[t.physicalid]:n})},onChangeValidationStateClose:function(){S&&S.clean(),S=null},onChangeValidationStateFailure:function(){S&&S.clean(),S=null}}))})}b=t.extend(t.clone(O,!0),JSON.parse(localStorage.getItem("R3MwebPrefs")||"{}")),j(),d.onTenantModified(e=>{M||(M=!0,m.removeAll(),e.then(()=>{M=!1,U()}))}),s.onTenantModified(()=>{s.getColumnsNls().then(m.onTenantModified)}),d.getWidget().addEvent("onRefresh",()=>!M&&U()),this.buildUX=function(){return g?Promise.resolve():new Promise(function(e){var n=t.createElement("div",{class:"r3mMainView",styles:{width:"100%",height:"100%"}}),l=t.createElement("div",{class:"r3mRightView"});function c(e){e.stopPropagation()}function u(e,t){if(!m||!t)return!1;var n={protocol:"3DXContent",version:"1.1",data:{items:[]},source:d.getWidgetAppId(),widgetId:d.getWidgetId()},i=[],a={};return A(i,a),N(n.data.items,i,a),e.dataTransfer.setData("Text",JSON.stringify(n)),!1}l.style.height="100%",(g=new a).init({withtransition:!0,container:this,right:{withClose:!1},modelEvents:I},null,n,l),s.getColumnsNls().then(t=>{(m=new i({parent:n,onSelect:B,onUnselect:q,getFilterValues:function(){return Object.assign({},b)},getIsrTypes:function(){return s.getIsrTypes()},getFeatureStateInfo:G,onFiltersModified:z,onInfo:X,allowRelations:J,onRelations:K,allowMaturityState:Q,onMaturityState:H,onAnalysisState:Z,allowValidationState:Y,onValidationState:ee,columns:t,cbDnD:{onDragStartCell:u,onDragOverCell:c,onDragEnterBlank:c,onDragOverBlank:c,onDragStartRowHeader:u,onDragOverRowHeader:c}}))&&m.checkFilterAndFetchValue(),(h=new o({className:"r3mProperties",setEditButton:!0,readOnly:!1,setCloseButton:!0,typeOfDisplay:r.ALL,displayType:r.STANDARD,selectionType:r.NO_SELECTION,multiselection:r.MULTISEL_STD,collapseTabs:!1,actions:[{name:"closeSidePanel",text:p.closeSidePanel,icon:"close",handler:function(){I.publish({event:"triptych-hide-panel"}),m.setInfoState(!1)}}]}).inject(l)).initDatas([]);let a=require("DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils"),d={requestUtils:{get3DSpaceUrl:a.get3DSpaceUrl,getPlatformId:a.getPlatformId,getSecurityContext:a.getSecurityContext,getLang:a.getLang},onFacetModification:function(e){let t=[];Object.keys(e||{}).forEach(function(e){let n=_[e];n&&Object.keys(this[e]||{}).forEach(function(i){let a;"sValidationState"===i?(a=!0,$(e,this[i])):"iCheckState"===i?(a=!0,s.updateCheckStateValue(this[i],n)):"title"!==i&&"description"!==i||(a=!0,n[i]=this[i]),a&&-1===t.indexOf(e)&&t.push(e)},this[e])},e);let n={};t.forEach(e=>{V(e).forEach(e=>{n[e]||(n[e]=D[e])})}),m.updateValidations(n)}};h.addFacets([{position:1,require:"DS/PIMwebPropertiesTabs/PIMwebIsrPropContextTab",supportMerge:!0,options:d,facet:{name:"interference_context",text:p.context,icon:"6w-what"}},{position:2,require:"DS/PIMwebPropertiesTabs/PIMwebIsrPropSpecTab",supportMerge:!0,options:d,facet:{name:"interference_specification",text:p.specifications,icon:"6w-how"}},{position:1,require:"DS/DMUReviewFacets/DMUwebR3MinfoRvwCheckTab",supportMerge:!0,options:d,facet:{name:"review_check",text:p.checks,icon:"check-review"}},{position:2,require:"DS/DMUReviewFacets/DMUwebR3MinfoRvwHighlightTab",supportMerge:!0,options:d,facet:{name:"review_highlight",text:p.highlights,icon:"highlight-review"}}]),e()})}.bind(this))}.bind(x),this.refresh=U,this.destroy=function(){window.console.error("TODO!!")}}}),m=[],h=function(e){return e&&e.id?(m.some(function(n){return n.id===e.id&&(t=n.enveloppe)}),t):null;var t};return Object.freeze({giveCtrl:function(e){return h(e)},getCtrl:function(e){if(!e||!e.id)return null;var t=h(e);if(!t){var n=new g({parent:e.parent}),i={buildUX:function(){return n?n.buildUX.apply(null,arguments):null},refresh:function(){return n?n.refresh.apply(null,arguments):null},destroy:function(){n&&(n.destroy.apply(null,arguments),n=null,m.some(function(e,t){if(e.enveloppe===i)return m.splice(t,1),i=null,!0}))}};Object.freeze(i),m.push({id:e.id,enveloppe:i}),t=i}return t}})});