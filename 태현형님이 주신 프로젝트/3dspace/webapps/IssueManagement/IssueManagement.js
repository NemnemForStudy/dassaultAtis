define("DS/IssueManagement/commands/ExportCSV",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;require(["DS/IssueManagement/export/ExportCSV"],function(t){t.exportation().finally(function(){e.end()})})}})}),define("DS/IssueManagement/commands/ExportPPTX",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;require(["DS/IssueManagement/export/ExportPPTX"],function(t){t.exportation().finally(function(){e.end()})})}})}),define("DS/IssueManagement/export/Print",["UWA/Class/Promise","UWA/Core","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o,a,r){"use strict";var l="DS/IssueManagement/export/Print",c="Issue",d=200;return{exportation:function(e){if(!t.is(e,"object")||!t.is(e.context))throw new Error("Invalid input parameters: context is undefined");s.start(l+" exportation");var n=e.context,i=this._createHTMLTextTable(n);return this._print(i).then(function(){s.end(l+" exportation")})},_printWindow:void 0,_createHTMLTextTable:function(e){s.start(l+" _createHTMLTextTable");var i="",d="";"datagrid"==e.list.summaryview?(i=e.getTreeListView().columns.slice(),d=e.getTreeListView().getTreeDocument().getRoots()):(i=e.getTreeListView().getManager().getColumns().slice(),d=e.getTreeListView().getManager().getRoots());for(var u=[],m=[],p=0;p<i.length;p++){var h=i[p];n.get("ISU_LISTVIEW")?h.text&&!0!==h.isHidden&&this._isExportable(h)&&u.push(h):h.text&&"ContextualMenuColumn"!=h.dataIndex&&1==h.visibleFlag&&this._isExportable(h)&&u.push(h)}for(var g=0;g<d.length;g++){var f=d[g];f.isVisible()&&f.isRoot()&&m.push(f)}var v=t.createElement("div",{class:"issue-list-print"}),b=t.createElement("div",{class:"issue-list-print-summary"});b.inject(v);var I=t.createElement("div",{class:"issue-list-print-summary-sub-ctn issue-list-print-summary-total-ctn"});I.inject(b),t.createElement("div",{class:"issue-list-print-summary-label issue-list-print-summary-total-label",html:a.export.printTotalLabel}).inject(I),t.createElement("div",{class:"issue-list-print-summary-value issue-list-print-summary-total-value",html:m.length}).inject(I);for(var y={Create:0,Assign:0,Active:0,Review:0,Closed:0},w=0;w<m.length;w++)y[m[w].options.state]++;Object.keys(y).forEach(function(e){var n=o.getIconByState(e,c,""),i=t.createElement("div",{class:"issue-list-print-summary-sub-ctn"});i.inject(b);var s=t.createElement("div",{class:"issue-list-print-summary-label"});s.inject(i),t.createElement("span",{class:"issue-list-print-summary-label-nls",html:r.maturity[e.toLowerCase()]}).inject(s),t.createElement("img",{class:"issue-list-print-summary-icon",src:n}).inject(s),t.createElement("div",{class:"issue-list-print-summary-value",html:y[e].toString()}).inject(i)});var S=(new Date).toLocaleString(n.get("widget").lang),C=t.createElement("div",{class:"issue-list-print-summary-sub-ctn issue-list-print-summary-date-ctn"});C.inject(b),t.createElement("div",{class:"issue-list-print-summary-value issue-list-print-summary-date-value",html:S}).inject(C);var E=t.createElement("div",{class:"issue-list-print-table"});E.inject(v);var _=t.createElement("table");_.inject(E);var T=t.createElement("tr",{class:"table-header-row"});T.inject(_),t.createElement("tr",{class:"table-spacer-row"}).inject(_),u.forEach(function(e){var n="";switch(e.dataIndex){case"ds6w:reportedAgainst":n="wux-ui-3ds wux-ui-3ds-location";break;case"ds6w:resolvedBy":n="fonticon fonticon-docs";break;case"ds6w:resolvedItems":n="wux-ui-3ds wux-ui-3ds-markup-review";break;case"ds6w:contexts":n="wux-ui-3ds wux-ui-3ds-3d-object";break;case"default":default:n=""}var i=t.createElement("th",{class:"table-headercol",html:e.text});(i.setStyle("max-width",e.width),n.length)&&(i.innerHTML="",t.createElement("span",{class:"issue-list-cell-header-icon "+n,title:a.columns[e.dataIndex+"Column"]}).inject(i));i.inject(T)});for(var D=0;D<m.length;D++){var M=m[D],A=t.createElement("tr",{class:"table-root-row"});A.inject(_);for(var x=0;x<u.length;x++){var N=u[x],O=t.createElement("th",{class:"table-root-col"}),P=t.createElement("div",{});if("tree"===N.dataIndex){var k=o.getIconByState(M.options.state,M.options.type,M.options.iconurl);t.createElement("img",{class:"tree-icon",src:k}).inject(P);var L=t.createElement("span",{class:"tree-title"});L.innerHTML=t.String.escapeHTML(M.options.title),L.inject(P)}else if(-1!==["ds6w:description"].indexOf(N.dataIndex))P.innerHTML=t.String.escapeHTML(M.options.grid[N.dataIndex]);else if(-1!==["Approvals"].indexOf(N.dataIndex)){var R=M.options.grid[N.dataIndex]?a.approvals.approvalOn:a.approvals.approvalOff;P.innerHTML=t.String.escapeHTML(R)}else P.innerHTML=M.options.grid[N.dataIndex];P.inject(O),O.setStyle("max-width",N.width),-1!==["ds6w:reportedAgainst","ds6w:resolvedBy","ds6w:resolvedItems","ds6w:context"].indexOf(N.dataIndex)&&O.setStyle("text-align","center"),O.inject(A)}}return s.end(l+" _createHTMLTextTable"),v},_isPrintWindowOpened:function(){return void 0!==this._printWindow&&null!==this._printWindow&&!1===this._printWindow.closed},_print:function(t){var n=this;return s.start(l+" _print"),new e(function(e,i){n._isPrintWindowOpened()&&n._printWindow.close(),n._printWindow=window.open("/","PrintWindow","width=1024, height=768"),void 0===n._printWindow&&(e(),s.end(l+" _print")),setTimeout(()=>{n._onPrintWindowLoaded(t,e,i)},1300)})},_onPrintWindowLoaded:function(n,i,o){var a=this;a._printWindow.document.write("<html><head></head><body></body></html>"),a._printWindow.document.close();var r=[],c=function(t){return new e(function(e){t.addEventListener("load",function(){e()},!1)})};for(var u in document.styleSheets)if(document.styleSheets.hasOwnProperty(u)){var m=t.createElement("link",{rel:"stylesheet",type:"text/css",media:"all",href:document.styleSheets[u].href});null!==document.styleSheets[u].href&&r.push(c(m)),a._printWindow.document.head.appendChild(m)}e.all(r).then(function(){a._printWindow.document.body.innerHTML=n.outerHTML;var e=a._printWindow.document.querySelectorAll("img");s.end(l+" _print");var t=setInterval(function(){for(var n=!0,s=0;s<e.length;s++)!0!==e[s].complete&&(n=!1);!0===n&&(clearInterval(t),i(),setTimeout(function(){a._printWindow.focus(),a._printWindow.print(),a._printWindow.close()},0))},d)},function(e){o(e),s.end(l+" _print")})},_isExportable:function(e){return!t.is(e.export,"object")||!1!==e.export.value}}}),define("DS/IssueManagement/components/footer/Status",["UWA/Class/View","UWA/Core","DS/UIKIT/Tooltip","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Controls/Loader","DS/IssueComponents/helper/Helper","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l){"use strict";var c="Issue",d=1e3;return e.extend({name:"DS/IssueManagement/components/footer/Status",tagName:"div",className:"status-container",_logger:null,isVisible:!0,_pin:null,setup:function(e){r.start(this.name+" setup"),this._parent(e),this.isVisible=!0,this.loading.init(),r.end(this.name+" setup")},render:function(){return r.start(this.name+" render"),this.helper().inject(this.container),this.info().inject(this.container),this.loading.container.inject(this.container),r.end(this.name+" render"),this},refresh:function(){this.destroy(),this.render()},destroy:function(){this.container.empty()},loading:{container:t.createElement("div",{class:"im-status-loader"}),clickCallback:null,isVisible:!1,_loader:new s({text:"Loading...",fadeDuration:500,showButtonFlag:!1}),init:function(){this._loader.inject(this.container)},start:function(e){this._loader.height=18,this._loader._loaderCounter=0,this._loader.elements.progressBar.infiniteFlag=!0,this._loader.elements.progressBar._applyInfiniteFlag(),t.is(e,"object")&&this.container.toggleClassName("is-clickable",e.isClickable),this._loader.on(),this.isVisible=!0},update:function(e){this._loader.text=e},stop:function(e){this._loader.text=e,this._loader._loaderCounter=0,this._loader.elements.progressBar.infiniteFlag=!1,this._loader.elements.progressBar.value=100,this._loader.elements.progressBar._applyInfiniteFlag()},hide:function(e){var n=this;n.isVisible&&(n._loader.text=e,setTimeout(function(){new t.Fx(n._loader.elements.container,{duration:d,transition:"linear",events:{onStart:function(){},onComplete:function(){t.is(n._loader,"object")&&n._loader.off(),n.isVisible=!1}}}).start({opacity:[1,0]})},0),n.container.toggleClassName("is-clickable",!1))},setClickListener:function(e){t.is(this.clickCallback,"function")&&this.container.removeEventListener("click",this.clickCallback),this.clickCallback=e,this.container.addEventListener("click",this.clickCallback)}},helper:function(){var e=a.get("widget")||window.widget,i=t.createElement("span",{class:"issue-status-left-helper fonticon fonticon-help-circled"}),s=new n({className:"helper-tooltip",position:"top",target:i,body:l.tooltips.helper});return i.addEventListener("click",function(){s.hide(),o.show(e.body)}),i},info:function(){var e=this,i=t.createElement("span",{class:"issue-status-right fonticon fonticon-info"});return new n({className:"im-status-tooltip",trigger:"touch",target:i,events:{onShow:function(){r.start(e.name+" render status");for(var n=a.get("component"),i=n.getSelectedNodes(),s=n.getTreeDocument().getRoots(!1).length,o=0,d=0;d<i.length;d++)i[d].options.baseType===c&&(o+=1);var u=t.createElement("div",{class:"im-status-msg"});t.createElement("div",{class:"im-status-msg-issues",text:l.replace(l.titles.issues,{number:s})}).inject(u),t.createElement("div",{class:"im-status-msg-selection",text:l.replace(l.tooltips.selectedIssues,{number:o})}).inject(u),this.setBody(u),r.end(e.name+" render status")}}}),i},utils:{}})}),define("DS/IssueManagement/views/facets/Placeholder",["UWA/Class/View","UWA/Core","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n){"use strict";var i="attachments",s="comments",o="history",a="relations";return e.extend({name:"DS/IssueManagement/views/facets/Placeholder",tag:"div",className:"placeholder-view fade-in-element",setup:function(){},render:function(e){this.empty();var r="",l="";switch(e){case i:r="attach",l=n.facets.attachments.placeholder;break;case s:r="chat",l=n.facets.comments.placeholder;break;case o:r="navigation-history",l=n.facets.history.placeholder;break;case a:r="object-related",l=n.facets.relations.placeholder}var c=t.createElement("div",{class:"placeholder-content",html:[t.createElement("span",{class:"fonticon fonticon-5x fonticon-"+r}),t.createElement("span",{class:"placeholder-label",html:l})]});return this.container.setContent(c),this},empty:function(){this.container.empty()}})}),define("DS/IssueManagement/components/idcard/IdCardModel",["UWA/Class/Promise","UWA/Class/View","UWA/Core","UWA/Class/Model","DS/CoreEvents/ModelEvents","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o){return new i({name:"",thumbnail:"",description:"",withHomeButton:!1,withExpandCollapseButton:!1,withActionsButton:!0,withInformationButton:!1,withToggleMinifiedButton:!0,showBackButton:!1,minified:!1,modelEvents:new s,attributes:[{name:"",id:"maturity",value:"",editable:!0,displayWhenMinified:!0},{name:o.columns.ownerColumn,id:"owner",value:"",type:"type-hyperlink",editable:!0,displayWhenMinified:!0,isVaries:!1},{name:o.columns.collaborativeSpaceColumn,id:"collabspace",type:"type-hyperlink",value:"",editable:!0,displayWhenMinified:!0,isVaries:!1},{name:o.columns.priorityColumn,id:"priority",type:"type-hyperlink",value:"",editable:!0,displayWhenMinified:!0},{name:o.columns.resolutionDateColumn,id:"duedate",value:"",type:"type-hyperlink",editable:!0,displayWhenMinified:!0},{name:o.columns.approvalColumn,id:"approvals",value:"",displayWhenMinified:!0},{name:o.columns.responsibleOrganizationColumn,id:"responsibleOrg",value:"",type:"type-hyperlink",editable:!0,displayWhenMinified:!0},{name:o.columns.reportingOrganizationColumn,id:"reportingOrg",value:"",displayWhenMinified:!0},{name:o.columns.modifiedColumn,id:"modifiedDate",value:"",type:"type-hyperlink",editable:!0,displayWhenMinified:!0}],customEvents:{homeIconClick:{event:"custom-show-landing-page-event"},expandCollapseIconClick:{event:"issue-idcard-panel-toggle"},informationIconClick:{event:"custom-information-icon-event"},configurationLabelClick:{event:"custom-show-configuration-event"},versionLabelClick:{event:"custom-show-version-explorer-event"},actionsMenuClick:{event:"issue-idcard-actions-menu-click"}}})}),define("DS/IssueManagement/utils/customization/ComboSelector",["i18n!DS/IssueManagement/assets/nls/IssueManagement_list","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/Menu/Menu"],function(e,t,n,i,s){"use strict";return n.extend(i,{defaultOptions:{treedocument:null,withMore:!1,disabled:!1,title:null,multisel:!0},init:function(e){this._parent(e);if(this.elements.container=t.createElement("div",{class:"padComboSelector "+(e.className?e.className:"")}),this.elements.inner=t.createElement("div",{class:"padComboSelector-inner"}).inject(this.elements.container),this.elements.text=t.createElement("div",{class:"padComboSelector-text"}).inject(this.elements.inner),this.options.title&&t.createElement("p",{text:this.options.title,title:this.options.title}).inject(this.elements.text),this.elements.expander=t.createElement("span",{class:"padComboSelector-expander wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-down"}).inject(this.elements.inner),this.elements.container.addEventListener("click",this._launchCtxMenu.bind(this)),this.elements.container.addEventListener("contextmenu",this._launchCtxMenu.bind(this)),null===this.options.treedocument)throw new Error("Invalid attribute in constructor. Missing treedocument");this.options.treedocument.getXSO().onPostAdd(this._redrawInnerText.bind(this)),this.options.treedocument.getXSO().onPostRemove(this._redrawInnerText.bind(this)),this.disabled(this.options.disabled),this._redrawInnerText()},disabled:function(e){e?(this.elements.container.setAttribute("disabled",""),this.options.disabled=e):(this.elements.container.removeAttribute("disabled",""),this.options.disabled=e)},_launchCtxMenu:function(){var t=[],n=this;if(!1===this.options.disabled){for(var i=this.options.treedocument.getRoots(),o=0;o<i.length;o++){var a=i[o].options.icons&&i[o].options.icons.length&&i[o].options.icons[0].iconName?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+i[o].options.icons[0].iconName}:void 0;t.push({title:i[o].getLabel(),type:"CheckItem",state:i[o].isSelected()?"selected":void 0,fonticon:a,action:{this:this,context:i[o],callback:this._typeSelectedInMenu.bind(this)}})}if(this.options.withMore&&(t.push({type:"SeparatorItem"}),t.push({title:e.more,type:"PushItem",action:{this:this,callback:function(e){n.dispatchEvent("onMore")}}})),t.length){var r=this.elements.container.getBoundingClientRect();s.show(t,{position:{x:r.left,y:r.bottom}})}}},_typeSelectedInMenu:function(e){var t=e.context;!0===this.options.multisel?t.isSelected()?(t.unselect(),this.dispatchEvent("onUnselect",t)):(t.select(),this.dispatchEvent("onSelect",t)):(t.select(!0),this.dispatchEvent("onSelect",t)),this.dispatchEvent("onSelectionChange"),this._redrawInnerText()},_redrawInnerText:function(){if(!(t.is(this.options.title,"string")&&this.options.title.length>0)){this.elements.text.empty();for(var e="",n=[],i=this.options.treedocument.getSelectedNodes(),s=0;s<i.length;s++)n.push(i[s].getLabel());if(e=n.length?n.join(", "):this.options.nlsEmptySelection,!1===this.options.multisel&&1===i.length&&i[0].options.icons){t.createElement("div",{class:"iconMenu wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+i[0].options.icons[0].iconName}).inject(this.elements.text);i[0].options.subLabel&&(this.elements.text.title=i[0].options.subLabel)}t.createElement("p",{text:e}).inject(this.elements.text)}}})}),define("DS/IssueManagement/components/header/MultiSelection",["UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/ApplicationFrame/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a){"use strict";var r="DS/IssueManagement/components/header/MultiSelection";return{initialized:!1,_multiSelectMode:{state:null,count:null,tooltips:{state:null,actions:null}},_subscriberId:"",_subscriberTokens:[],initialize:function(){this._subscriberId=Math.random().toString(36).substr(2,9),this._subscriberTokens=[],this._subscribers()},getLayout:function(){var s=this;s.initialized||s.initialize();var o=e.createElement("div",{class:"multi-select-container"}),r=s._multiSelectMode.state=new t({className:"multi-select-toggle select-action",icon:"select-on"}).addEvent("onClick",function(e,t){this.isActive()?s.disableMultiselect():s.enableMultiselect()}).inject(o);new n({target:r.getContent(),body:a.multiSelection.toggleTooltip});s._multiSelectMode.count=e.createElement("sub",{class:"multi-select-count select-action",html:"0"}).inject(o);s._multiSelectMode.count.hide();var l=new t({className:"multi-select-dropdown select-action",icon:"chevron-down",dropdownCaret:!1,dropdown:{items:[{name:"SelectAllIssues",fonticon:"list-ok",text:a.actions.select.selectIssues,handler:function(e,t){i.getCommand("SelectAllIssues").begin()}},{name:"SelectAllRelatedObjects",fonticon:"flow-cascade-ok-2",text:a.actions.select.selectChildren,handler:function(){i.getCommand("SelectAllRelatedObjects").begin()}},{name:"UnselectAll",fonticon:"list-delete",text:a.actions.select.unselectAll,handler:function(){s._multiSelectMode.state.isActive()&&s.disableMultiselect(),i.getCommand("UnselectAll").begin()}}]}}).inject(o);return s._multiSelectMode.tooltips.actions=new n({target:l.getContent(),body:a.multiSelection.dropdownTooltip}),o},getCurrentState:function(){return this._multiSelectMode.state.isActive()},enableMultiselect:function(){this._multiSelectMode.state.toggleActive(),s.get("component").list._datagrid._cellsManager.forceMultiSelection(!0),this._multiSelectMode.count.show()},disableMultiselect:function(){this._multiSelectMode.state.toggleActive(),s.get("component").list._datagrid._cellsManager.forceMultiSelection(!1),this._multiSelectMode.count.hide(),i.getCommand("UnselectAll").begin()},_subscribers:function(){var e=this,t=s.get("eventsHandler");e._subscriberTokens.push(t.subscribe(e._subscriberId,"DS/Object/select",function(t){var n=Object.keys(t.data.attributes);e._manageSelection(n.length)}))},_manageSelection:function(e){o.start(r+" _manageSelection");var t=s.get("component").list._datagrid._cellsManager,n=this._multiSelectMode.state.isActive();this._multiSelectMode.count.innerHTML=e,e>1&&!n&&(this._multiSelectMode.state.toggleActive(),t.forceMultiSelection(!0),this._multiSelectMode.count.show()),o.end(r+" _manageSelection")}}}),define("DS/IssueManagement/commands/SelectAllRelatedObjects",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/SelectAllRelatedObjects",execute:function(){var e=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(t,n,i){var s=n.get("component").getTreeDocument();i.start(e.name+" execute"),s.withBroadcastSelect(new t(function(t){s.withTransactionUpdate(function(){s.unselectAll();for(var n=s.getRoots(!1),o=0;o<n.length;o++)n[o].processDescendants({processNode:function(e){e.nodeModel.select()}});i.end(e.name+" execute"),t()})}))})}})}),define("DS/IssueManagement/commands/Print",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;require(["DS/IssueManagement/export/Print","DS/IssueServices/Contexts"],function(t,n){t.exportation({context:n.get("component")}).then(e.end.bind(e),e.end.bind(e))})}})}),define("DS/IssueManagement/commands/ExportZIP",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;require(["DS/IssueManagement/export/ExportZIP"],function(t){t.exportation().finally(function(){e.end()})})}})}),define("DS/IssueManagement/commands/SwitchView",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/SwitchView",begin:function(e){this.execute(e)},execute:function(e){var t=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(n,i,s){s.start(t.name+" execute"),i.get("component").switchView(e),s.end(t.name+" execute")})}})}),define("DS/IssueManagement/utils/EventsHandler",["UWA/Class/Listener","UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/IssueServices/Contexts","DS/PlatformAPI/PlatformAPI","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o){"use strict";var a={INTERNAL_APPLICATIONS:["ENXISSU_AP","ENX3DIR_AP"],SUPPORTED_EVENTS:["DS/IssueManagementTask/add","DS/IssueManagementTask/ready","DS/IssueManagementTask/exec","DS/IssueManagementTask/done","DS/IssueManagementTask/cancel","DS/Object/create","DS/Object/delete","DS/Object/update","DS/Object/select"]};return n.extend(e,{name:"DS/IssueManagement/utils/EventsHandler",_logger:null,init:function(e){var t=this;t._parent(e),t._id=Math.random().toString(36).substr(2,9),t._subscriptions={"DS/Object/update":{"*":[],issue:{"*":[]}}},t._tokens={};t._platformAPIListeners=a.SUPPORTED_EVENTS.map(function(e){return{event:e,listener:function(e){return function(n){if(i.is(n.metadata,"object")){if(i.is(n.metadata.options,"object")&&i.is(n.metadata.options.isuEventsHandlerId,"string")&&n.metadata.options.isuEventsHandlerId===t._id)return;if("DS/Object/select"===e&&n.metadata.appId!==s.get("widget").id&&"ENXISSU_AP"===n.metadata.appName)return}t.publish(t._id,e,n,!0)}}(e)}});for(var n=0;n<t._platformAPIListeners.length;n++){var r=t._platformAPIListeners[n];r.token=o.subscribe(r.event,r.listener)}},destroy:function(){this._subscriptions={}},subscribe:function(e,t,n,s){var o=this,a={id:Math.random().toString(36).substr(2,9),subscriberId:e,event:t,callback:n,conditions:i.is(s,"object")?s:null,subscriptions:[]};if(void 0===o._subscriptions[t]&&(o._subscriptions[t]={"*":[]}),i.is(s,"object")&&i.is(s.type,"string")){var r=s.type;void 0===o._subscriptions[t][r]&&(o._subscriptions[t][r]={"*":[]}),Array.isArray(s.attributes)&&s.attributes.length>0?s.attributes.forEach(function(e){void 0===o._subscriptions[t][r][e]&&(o._subscriptions[t][r][e]=[]),o._subscriptions[t][r][e].push(a.id),a.subscriptions.push({callback:n,event:t,type:r,attribute:e})}):(o._subscriptions[t][r]["*"].push(a.id),a.subscriptions.push({callback:n,event:t,type:r}))}else o._subscriptions[t]["*"].push(a.id),a.subscriptions.push({callback:n,event:t,type:"*"});return o._tokens[a.id]=a,a.id},unsubscribe:function(e){var t=this;if(t._tokens.hasOwnProperty(e)){var n=t._tokens[e];if(null===n.conditions||void 0===n.conditions){if(-1!==t._subscriptions[n.event]["*"].indexOf(e)){var s=t._subscriptions[n.event]["*"].indexOf(e);t._subscriptions[n.event]["*"].splice(s,1)}}else if(i.is(n.conditions.type,"string")&&i.is(t._subscriptions[n.event][n.conditions.type],"object"))if(Array.isArray(n.conditions.attributes))n.conditions.attributes.forEach(function(i){if(-1!==t._subscriptions[n.event][n.conditions.type][i].indexOf(e)){var s=t._subscriptions[n.event][n.conditions.type][i].indexOf(e);t._subscriptions[n.event][n.conditions.type][i].splice(s,1)}});else if(-1!==t._subscriptions[n.event][n.conditions.type]["*"].indexOf(e)){var o=t._subscriptions[n.event][n.conditions.type]["*"].indexOf(e);t._subscriptions[n.event][n.conditions.type]["*"].splice(o,1)}delete t._tokens[e]}},publish:function(e,t,n,s){var r=this;if(void 0!==r._subscriptions[t]&&i.is(n.data,"object")&&Array.isArray(n.data.paths)&&i.is(n.data.attributes,"object")){var l={};n.data.paths.forEach(function(e){if(i.is(n.data.attributes[e],"object")&&i.is(n.data.attributes[e].type,"string")){var t=n.data.attributes[e].type.toLowerCase();Array.isArray(l[t])||(l[t]=[]),l[t].push(n.data.attributes[e])}});var c=Object.keys(l);if(-1===a.INTERNAL_APPLICATIONS.indexOf(n.metadata.appName)){Object.keys(r._tokens).forEach(function(e){var s=r._tokens[e];s.event===t&&s.callback(i.clone(n))})}else{var d=[];r._subscriptions[t]["*"].forEach(function(t){var s=r._tokens[t];-1===d.indexOf(t)&&s.subscriberId!==e&&(d.push(t),s.callback(i.clone(n)))}),c.forEach(function(s){if(i.is(r._subscriptions[t][s],"object")){r._subscriptions[t][s]["*"].forEach(function(t){var s=r._tokens[t];-1===d.indexOf(t)&&s.subscriberId!==e&&(d.push(t),s.callback(i.clone(n)))});var o=l[s][0].modifiedAttributes,a=Object.keys(r._subscriptions[t][s]);if(Array.isArray(o))for(var c=0;c<a.length;c++){var u=a[c];-1===o.indexOf("*")&&-1===o.indexOf(u)||r._subscriptions[t][s][u].forEach(function(t){var s=r._tokens[t];-1===d.indexOf(t)&&s.subscriberId!==e&&(d.push(t),s.callback(i.clone(n)))})}}})}}if(!0!==s){var u=i.clone(n);i.is(u.metadata.options,"object")||(u.metadata.options={}),u.metadata.options.isuEventsHandlerId=r._id,o.publish(t,u)}}})}),define("DS/IssueManagement/commands/ColumnCustomization",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{_padCustomizeView:null,init:function(e){this._isDisplayed=!1,this._parent(e)},execute:function(){var e=this;require(["DS/PADUtils/PADSettingsMgt","DS/IssueManagement/utils/customization/PADCustomizeView","DS/IssueServices/Contexts"],function(t,n,i){var s=i.get("component"),o=s.getTreeListView(),a=[];a=void 0===o.options.columns?o.columns.slice():o.options.columns.slice();for(var r=0;r<a.length;r++)"biColor"===a[r].dataIndex&&a.splice(r,1);a.forEach(function(e){"ContextualMenuColumn"===e.dataIndex?e.xnav_options={layout:{visibleFlag:!0===e.visibleFlag,hidden:!0==!e.visibleFlag,removable:!1!==e.isRemovable,styles:e.styles?e.styles:{}}}:e.xnav_options={layout:{visibleFlag:!0===e.visibleFlag,hidden:!0===e.isHidden,removable:!1!==e.isRemovable,styles:e.styles?e.styles:{}}}}),!0!==e._isDisplayed&&(t.setSetting("compactMode",!0),e._padCustomizeView=new n({id:"ColumnVisibility",columns:a,render_div:".im-body",viewMode:o.preferences.getViewModePreference(),thumbnails:!1,events:{modifyColumRendering:function(e){o.modifyColumnRendering(e).then(function(){o.preferences.savePreferences({columns:!0})})},custoViewChange:function(){},saveAsTemplate:function(){},compactMode:function(e){var t=o.getManager();if(o.preferences.savePreferences({view:e.viewMode}),"comfortable"===e.viewMode)i.get("ISU_LISTVIEW")?t.options.defaultCellHeight=38:t.layout.cellHeight=38;else{if("compact"!==e.viewMode)return;i.get("ISU_LISTVIEW")?t.options.defaultCellHeight=26:t.layout.cellHeight=26}if(i.get("ISU_LISTVIEW")){var n=s.getTreeDocument(),a=t._isPreparingView,r=t._updateCounter;t.unloadDocument(),t._syncRowIndexes(!0),t.loadDocument(n),t._isPreparingView=a,t._updateCounter=r,t.updateView(!0)}},reset:function(){o.resetColumnRendering(),o.preferences.resetPreferences({columns:!0})}}}))})}})}),define("DS/IssueManagement/utils/Synchronizer",["UWA/Class/Listener","UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/IssueServices/utils/Performance","DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o){"use strict";var a=1,r=0;return n.extend(e,{name:"DS/IssueManagement/utils/Synchronizer",list:null,kanban:null,_selectEventFromKanbanAcked:-1,_selectEventFromListAcked:-1,init:function(e){this._parent(e),this.list=e.list,this.kanban=e.kanban,this._selectEventFromKanbanAcked=-1,this._selectEventFromListAcked=-1},destroy:function(){this.list=null,this.kanban=null,this._selectEventFromKanbanAcked=-1,this._selectEventFromListAcked=-1},start:function(){var e=this;return new t(function(t){e._subscribeToList(),e._subscribeToKanban(),t()})},_refreshKanban:function(){this.kanban.refresh()},_selectInKanban:function(){if(0!==this._selectEventFromListAcked){this._selectEventFromKanbanAcked=0,s.start(this.name+" _selectInKanban");for(var e=this.list.document.getSelectedNodes().map(function(e){return e.getID()}),t=Object.keys(this.kanban._issuesNodesMapping),n={},i=0;i<t.length;i++){var o=t[i];if(-1!==e.indexOf(o))for(var a=0;a<this.kanban._issuesNodesMapping[o].length;a++){var r=this.kanban._issuesNodesMapping[o][a];n.hasOwnProperty(r.getTreeDocument()._id)||(n[r.getTreeDocument()._id]={tree:r.getTreeDocument(),toSelect:[],toUnselect:[]}),n[r.getTreeDocument()._id].toSelect.push(r)}else for(var l=0;l<this.kanban._issuesNodesMapping[o].length;l++){var c=this.kanban._issuesNodesMapping[o][l];n.hasOwnProperty(c.getTreeDocument()._id)||(n[c.getTreeDocument()._id]={tree:c.getTreeDocument(),toSelect:[],toUnselect:[]}),n[c.getTreeDocument()._id].toUnselect.push(c)}}var d=Object.keys(n);this.kanban.preventUnselectColumns=!0;for(var u=0;u<d.length;u++){var m=n[d[u]];this.kanban.currentView===m.tree._currentKanbanView&&this.kanban._preventCurrentViewSelection||(m.toSelect.length>0||m.tree.getSelectedNodes().length>0)&&m.tree.withTransactionUpdate(function(){for(var e=0;e<m.toSelect.length;e++)m.toSelect[e].select();for(var t=0;t<m.toUnselect.length;t++)m.toUnselect[t].unselect()})}this.list.dispatchEvent("onSelectAcked"),this.kanban.dispatchEvent("onSelectAcked"),s.end(this.name+" _selectInKanban")}else this._selectEventFromListAcked=1},_selectInList:function(){var e=this;if(0!==e._selectEventFromKanbanAcked){e._selectEventFromListAcked=0;var t=e.kanban.getSelectedIssues();e.list.document.prepareBroadcastSelect(),e.list.document.withTransactionUpdate(function(){e.list.document.unselectAll();for(var n=Object.keys(e.kanban._issuesNodesMapping),i=0;i<n.length;i++){var s=n[i];-1===t.indexOf(s)||e.list.document.getNodesById(s)[r].select()}}),e.list.document.pushBroadcastSelect(),e.list.dispatchEvent("onSelectAcked"),e.kanban.dispatchEvent("onSelectAcked")}else e._selectEventFromKanbanAcked=1},_subscribeToList:function(){var e=this.utils.debounce(this._refreshKanban.bind(this),a);this.list.document.getModelEvents().subscribe({event:"setPathTags"},e),this.listenTo(o.get("component"),"setPathTags",e),this.list.document.addEventListener("nodeModelUpdate",e);var t=this.utils.debounce(this._selectInKanban.bind(this),a);this.list.document.getModelEvents().subscribe({event:"select"},t),this.list.document.getModelEvents().subscribe({event:"unselect"},t)},_subscribeToKanban:function(){var e=this.utils.debounce(this._selectInList.bind(this),a);this.listenTo(this.kanban,"onSelect",e)},utils:{_debounceTimeouts:[],debounce:function(e,t,n){var i,s=this;return function(){var o=this,a=arguments,r=n&&!i;clearTimeout(i);var l=s._debounceTimeouts.indexOf(i);-1!==l&&s._debounceTimeouts.splice(l,1),i=setTimeout(function(){i=null,n||e.apply(o,a)},t),s._debounceTimeouts.push(i),r&&e.apply(o,a)}}}})}),define("DS/IssueManagement/utils/ModelParser",["UWA/Core","DS/Logger/Logger","DS/IssueCommon/utils/Utils","DS/IssueServices/utils/Performance","DS/IssueServices/services/IssueServices","DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(e,t,n,i,s,o,a,r){"use strict";var l={BASE_NLS:"ISU_TYPE_NLS",NODE:{id:"",physicalId:"",type:"",name:"",title:"",baseType:"",organizationTitle:"",organization:"",collaborativeSpaceTitle:"",collaborativeSpace:"",actionTaken:"",actualEndDate:"",actualStartDate:"",validation:{activated:!1,fetched:!1,toString:{validation:function(){return!0!==this.activated?a.validation.none:this.status?a.validation[this.status]:a.validation.loading}}.validation},assignees:[],contributors:[],informedUsers:[],contexts:[],created:"",description:"",estimatedEndDate:"",estimatedStartDate:"",modified:"",originator:{},owner:{},coOwners:[],priority:"",isAffectedItemsIds:"",reportedAgainst:[],reportingOrganization:"",reportingOrganizationTitle:"",resolutionDate:"",resolutionRecommendation:"",resolutionStatement:"",resolvedBy:[],resolvedItems:[],responsibleOrganization:"",responsibleOrganizationTitle:"",revision:"",isLastRevision:"",state:"",waitingOn:"",iconurl:"",custom:{},escalationRequired:"",occurrence:"",library:"",libraries:""},MAPPING:{id:"",physicalId:"",isAffectedItemsIds:"",type:"ds6w:type",name:"ds6w:name",title:"ds6w:title",organizationTitle:"ds6w:organization",organization:"ds6w:organization",collaborativeSpaceTitle:"ds6w:collaborativeSpace",collaborativeSpace:"ds6w:collaborativeSpace",actionTaken:"ds6w:actionTaken",actualEndDate:"ds6w:actualEndDate",actualStartDate:"ds6w:actualStartDate",validation:"ds6w:validation",assignees:"ds6w:assignees",contributors:"ds6w:contributors",informedUsers:"ds6w:informedUsers",contexts:"ds6w:contexts",created:"ds6w:created",description:"ds6w:description",estimatedEndDate:"ds6w:estimatedEndDate",estimatedStartDate:"ds6w:estimatedStartDate",modified:"ds6w:modified",originator:"ds6w:originator",owner:"ds6w:owner",coOwners:"ds6w:coOwners",priority:"ds6w:priority",reportedAgainst:"ds6w:reportedAgainst",reportingOrganizationTitle:"ds6w:reportingOrganization",resolutionDate:"ds6w:resolutionDate",resolutionRecommendation:"ds6w:resolutionRecommendation",resolutionStatement:"ds6w:resolutionStatement",resolvedBy:"ds6w:resolvedBy",resolvedItems:"ds6w:resolvedItems",responsibleOrganizationTitle:"ds6w:responsibleOrganization",revision:"ds6w:revision",isLastRevision:"ds6w:isLastRevision",state:"ds6w:state",waitingOn:"ds6w:waitingOn",escalationRequired:"ds6w:escalationRequired",occurrence:"ds6w:occurrence",library:"Library Classes",libraries:"Library"},NO_VALIDATION:"Unassigned",VALIDATION:"Analyst"},c=function(t){var i=e.clone(l.NODE);for(var a in i.grid={},i.icons=[],l.NODE)l.NODE.hasOwnProperty(a)&&(i[a]=t[a]?t[a]:e.clone(l.NODE[a]));i.id=t.physicalId?t.physicalId:i.id,i.physicalId=i.id,i.resourceid=i.id;var c=n.getIconByState(i.state,i.type,i.iconurl);for(var d in i.icons.push(c),l.MAPPING)switch(d){case"organization":""==i.organizationTitle&&(i.grid[l.MAPPING[d]]=i[d]);break;case"collaborativeSpace":""==i.collaborativeSpaceTitle&&(i.grid[l.MAPPING[d]]=i[d]);break;case"waitingOn":i.grid.Approvals="Unassigned"!==i[d]&&""!==i[d];break;default:i.grid[l.MAPPING[d]]=i[d]}var u=o.get(l.BASE_NLS);if(u&&u["ds6w:type"]&&Object.keys(u["ds6w:type"]).includes(i.type))i.grid["ds6w:type"]=u["ds6w:type"][i.type];else{var m={"ds6w:type":[i.type]};s.getNLSValuesPromise(m).then(t=>{e.is(t)&&e.is(t["ds6w:type"])&&e.is(t["ds6w:type"][i.type])&&(i.grid["ds6w:type"]=t["ds6w:type"][i.type])})}for(var p in i.grid["ds6w:organization"]=""!=i.organizationTitle?i.organizationTitle:i.organization,i.grid["ds6w:reportingOrganization"]=""!=i.reportingOrganizationTitle?i.reportingOrganizationTitle:i.reportingOrganization,i.grid["ds6w:responsibleOrganization"]=""!=i.responsibleOrganizationTitle?i.responsibleOrganizationTitle:i.responsibleOrganization,i.label=i.display=""!==i.title?i.title:i.name,i.grid[l.MAPPING.assignees]=i.assignees.reduce(function(e,t){return e+t.fullName+", "},""),i.grid[l.MAPPING.assignees].length>0&&(i.grid[l.MAPPING.assignees]=i.grid[l.MAPPING.assignees].trim(),i.grid[l.MAPPING.assignees]=i.grid[l.MAPPING.assignees].substring(0,i.grid[l.MAPPING.assignees].length-1)),i.grid[l.MAPPING.contributors]=i.contributors.reduce(function(e,t){return e+t.fullName+", "},""),i.grid[l.MAPPING.contributors].length>0&&(i.grid[l.MAPPING.contributors]=i.grid[l.MAPPING.contributors].trim(),i.grid[l.MAPPING.contributors]=i.grid[l.MAPPING.contributors].substring(0,i.grid[l.MAPPING.contributors].length-1)),i.grid[l.MAPPING.informedUsers]=i.informedUsers.reduce(function(e,t){return e+t.fullName+", "},""),i.grid[l.MAPPING.informedUsers].length>0&&(i.grid[l.MAPPING.informedUsers]=i.grid[l.MAPPING.informedUsers].trim(),i.grid[l.MAPPING.informedUsers]=i.grid[l.MAPPING.informedUsers].substring(0,i.grid[l.MAPPING.informedUsers].length-1)),i.grid[l.MAPPING.coOwners]=i.coOwners.reduce(function(e,t){return e+t.fullName+", "},""),i.grid[l.MAPPING.coOwners].length>0&&(i.grid[l.MAPPING.coOwners]=i.grid[l.MAPPING.coOwners].trim(),i.grid[l.MAPPING.coOwners]=i.grid[l.MAPPING.coOwners].substring(0,i.grid[l.MAPPING.coOwners].length-1)),i.grid[l.MAPPING.contexts]=String(i.contexts.length),i.grid[l.MAPPING.originator]=i.originator.fullName?i.originator.fullName:"",i.grid[l.MAPPING.owner]=i.owner.fullName?i.owner.fullName:"",i.grid[l.MAPPING.priority]=r.priorities[i.priority.toLowerCase()],i.grid[l.MAPPING.reportedAgainst]=String(i.reportedAgainst.length),i.grid[l.MAPPING.resolvedBy]=String(i.resolvedBy.length),i.grid[l.MAPPING.resolvedItems]=String(i.resolvedItems.length),i.grid[l.MAPPING.state]=r.maturity[i.state.toLowerCase()],i.waitingOn===l.VALIDATION&&(i.validation.activated=!0),i.custom)i.custom.hasOwnProperty(p)&&(i.grid[p]=i.custom[p]);if(Array.isArray(t.classification)?i.classification=t.classification:i.classification=t.classification?t.classification.split(""):[],Array.isArray(t.additionalPredicate))for(let e=0;e<t.additionalPredicate.length;e++){let n=Object.keys(t.additionalPredicate[e])[0],s=t.additionalPredicate[e][n];switch(n){case"ds6w:what/ds6w:libraries":i.grid[l.MAPPING.libraries]=s,i.libraries=s;break;case"ds6w:what/ds6w:library":i.grid[l.MAPPING.library]=s,i.library=s}}return i},d=function(t,n){var i=e.clone(l.NODE);i.grid={},i.icons=[];for(var s=t.attributes,o=0;o<s.length;o++){var a=s[o];if("Warning:Flattening"!==a.value&&"Warning:JPO"!==a.value)switch(a.name){case"resourceid":i.id=a.value;break;case"organization":i.organization=a.value,i.grid["ds6w:organization"]=a.dispValue;break;case"project":i.collaborativeSpace=a.value,i.grid["ds6w:collaborativeSpace"]=a.value;break;case"ds6w:project":i.collaborativeSpace=a.dispValue,i.grid["ds6w:collaborativeSpace"]=a.dispValue;break;case"ds6w:identifier":i.name=a.value;break;case"ds6w:label":i.title=a.value;break;case"ds6w:status":i.state=a.value,i.grid["ds6w:state"]=a.dispValue;break;case"ds6w:type":i.type=a.value,i.grid["ds6w:type"]=a.dispValue;break;case"ds6w:responsible":i.owner.fullName=a.value;break;case"owner":case"ds6w:responsibleUid":i.owner.user=a.value;break;case"type_icon_url":i.icons.push(a.value);break;case"ds6w:modified":i.modified=a.value;break;case"ds6w:created":i.created=a.value;break;case"ds6wg:revision":i.revision=a.value;break;case"ds6wg:PLMReference.V_isLastVersion":var r=a.value;r&&""!==r&&(i.isLastRevision="true"===r.toLowerCase());break;case"lastrevision":var c=a.value;""===i.isLastRevision&&c&&""!==c&&(i.isLastRevision="true"===c.toLowerCase());break;case"description":i.description=a.value,i.grid["ds6w:description"]=a.value;default:-1!==n.indexOf(a.name)&&(i.grid[a.name]=a.value)}}return i.resourceid=i.id,i.physicalId=i.id,i.label=i.display=""!==i.title?i.title:i.name,i.grid["ds6w:owner"]=i.owner,i.grid["ds6w:modified"]=i.modified,i.grid["ds6w:created"]=i.created,i.grid["ds6w:revision"]=i.revision,i.grid["ds6w:isLastRevision"]=i.isLastRevision,i.grid["ds6w:originator"]=i.owner,i.originator=i.owner,i};return{name:"DS/IssueManagement/utils/ModelParser",parse:function(e,t){var n=[];if(i.start(this.name+" parse"),t=t||{},Array.isArray(t.predicates)||(t.predicates=[]),Array.isArray(e))if(!0===t.useIndex)for(var s=0;s<e.length;s++)n.push(d(e[s],t.predicates));else for(var o=0;o<e.length;o++)n.push(c(e[o]));else n=!0===t.useIndex?d(e,t.predicates):c(e);return i.end(this.name+" parse"),n},update:function(e,t){e.context=t.context}}}),define("DS/IssueManagement/export/Utils",["UWA/Class/Promise","UWA/Core","DS/UIKIT/Input/Button","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/WebappsUtils/WebappsUtils","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c){"use strict";return{confirmation:function(s){var o=r.get("widget")||window.widget;return new e(function(e){var a=t.createElement("div",{class:"confirmation-export-issues-content",html:s.content}),r=new i({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"confirmation-export-issues-dialog",title:s.title,header:null,body:a,footer:[new n({value:c.export.confirmation.confirm,className:"primary confirmation-export-issues-dialog-confirm",events:{onClick:function(){r.destroy(),e(!0)}}}),new n({value:c.export.confirmation.cancel,className:"default confirmation-export-issues-dialog-cancel",events:{onClick:function(){r.destroy(),e(!1)}}})],events:{onClose:function(){r.destroy(),e(!1)}}}).inject(o.body);r.show()})},getIssuesToExport:function(){var e=r.get("component"),t=e.getSelectedNodes();return 0===t.length&&(t=e.getTreeDocument().getRoots(!1)),t},notifications:{exporting:function(){o.displayNotification({msg:c.export.exporting,eventID:"info"})},nothing:function(){o.displayNotification({msg:c.export.nothingToExport,eventID:"error"})},failure:function(e){o.displayNotification({msg:t.is(e,"string")?e:c.export.failure,eventID:"error"})}},download:{csv:function(e,t){var n=document.createElement("a"),i=n.href=URL.createObjectURL(new Blob(["\ufeff"+e],{encoding:"UTF-8",type:"text/csv;charset=UTF-8"}));n.setAttribute("download",t),document.body.appendChild(n),n.click(),setTimeout(function(){document.body.removeChild(n),URL.revokeObjectURL(i)},0)}}}}),define("DS/IssueManagement/utils/DragAndDrop",["UWA/Core","UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/components/Item","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/UploadDialog","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,b,I,y,w){"use strict";var S="Issue",C="ISU_TYPE_NLS",E=r.getLogger("DS/IssueManagement/utils/DragAndDrop"),_={setDroppableData:function(e,t){var n=g.get("widget")||window.widget,i={protocol:"3DXContent",version:"1.1",source:n.name,widgetId:n.id,data:{items:[]}};null!=t&&(i.data.options=t);for(var s=0;s<e.length;s++){var o=e[s];if(o.options.baseType===S){var a={};["contexts","reportedAgainst","resolvedBy","resolvedItems"].forEach(function(e){a[e]=[];for(var t=0;t<o.options[e].length;t++){var i={envId:v.getTenant(),serviceId:"3DSpace",contextId:n.id,objectId:o.options[e][t].physicalId,objectType:o.options[e][t].type,displayName:o.options[e][t].name,displayType:o.options[e][t].type,isIssue:!0};"reportedAgainst"==e&&(i.path=o.options[e][t].path.join()),a[e].push(i)}}),i.data.items.push({envId:v.getTenant(),serviceId:"3DSpace",contextId:n.id,objectId:o.options.physicalId,objectType:o.options.type,displayName:o.options.title+" ("+o.options.name+")",displayType:o.options.type,isIssue:!0,relatedObjects:a})}else{var r=o.options.physicalId.split(","),l=r[r.length-1],c={envId:v.getTenant(),serviceId:"3DSpace",contextId:n.id,objectId:l,objectType:o.options.type,displayName:o.options.display,displayType:o.options.type};i.data.items.push(c)}}var d="text/plain";try{(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))&&(d="text")}catch(e){}return{type:d,data:JSON.stringify(i)}},getDroppableData:function(t){for(var n=null,i=e.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",s="",o=["text/searchitems","text/plain","Text","Files"],a=0;a<o.length&&""===s;a++){var r=t.dataTransfer.types[i](o[a]);(e.is(r,"number")&&r>=0||e.is(r,"boolean")&&!0===r)&&(s=o[a])}var l={};if("Files"===s)n={files:t.dataTransfer.files};else if(""!==s){l=t.dataTransfer.getData(s);try{n=JSON.parse(l)}catch(e){}}return n},related:{whereToAddRelatedObjects:function(s,r,l){var c=this,d=g.get("widget")||window.widget,u=null;u=new i({className:"primary contexts-chooser",name:"typeChooser",value:"contexts",label:"",events:{onChange:function(){v.setDisabled(!0),b.setDisabled(!0)}}});var m=new i({className:"primary reported-against-chooser",name:"typeChooser",value:"reportedAgainst",label:"",checked:!0,events:{onChange:function(e){v.setDisabled(!1),0==E&&b.disable()}}}),p=new i({className:"primary resolved-by-chooser",name:"typeChooser",value:"resolvedBy",label:"",events:{onChange:function(){v.setDisabled(!0),b.setDisabled(!0)}}}),h=new i({className:"primary resolved-items-chooser",name:"typeChooser",value:"resolvedItems",label:"",events:{onChange:function(){v.setDisabled(!0),b.setDisabled(!0)}}}),f=new i({className:"primary attachments-chooser",name:"typeChooser",value:"attachments",label:"",events:{onChange:function(){v.setDisabled(!0),b.setDisabled(!0)}}}),v=new i({className:"primary where-to-drop-sub-icon isuReferenceInstanceChooser",name:"pathChooser",value:"reference",checked:!0,label:"",events:{onChange:function(){}}});v.elements.label.setContent([e.createElement("i",{class:"where-to-drop-reference wux-ui-3ds"}),y.dnd.references]);var b=new i({className:"primary where-to-drop-sub-icon isuReferenceInstanceChooser",name:"pathChooser",value:"instance",label:"",events:{onChange:function(){}}});b.elements.label.setContent([e.createElement("i",{class:"where-to-drop-instance wux-ui-3ds"}),y.dnd.instances]),u.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-contexts wux-ui-3ds wux-ui-3ds-3d-object"}),y.columns.contextsColumn]),m.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-reported-against wux-ui-3ds wux-ui-3ds-location"}),y.columns.reportedAgainstColumn]),p.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-contexts-resolved-by fonticon fonticon-docs"}),y.columns.resolvedByColumn]),h.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-resolved-items fonticon fonticon-markup-review"}),y.columns.resolvedItemsColumn]),f.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-contexts-attachments fonticon fonticon-attach"}),y.columns.attachmentsColumn]);var I=e.createElement("div",{class:"where-to-drop-main-label",html:y.dnd.whereToDrop}),w=(r=_.getDroppableData(l).data.items).map(function(e){return e.objectId}),S=[];r.map(function(e){e.path&&S.push(e.path.map(function(e){return e.resourceid}))});var C=[],E=0;S.map(function(e){var t=e.slice(-3);3==t.length?(C.push(t.join()),E++):1==t.length&&(C.push(t.join()),E++)}),w=w.sort().filter(function(e,t,n){return!t||e!==n[t-1]});var T=[I];T.push(u),T.push(m),T.push(v),T.push(b),T.push(p),T.push(h),T.push(f);var D=e.createElement("div",{html:T});return 0==E&&b.disable(),new t(function(e,t){var i=new a({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,minHeight:300,className:"drop-objects-issue-dialog",title:y.replace(y.dnd.dialogTitle,{number:w.length,issue:s.title+" ("+s.name+")"}),header:null,body:D,footer:[new n({value:y.dnd.attach,className:"primary drop-objects-issue-dialog-add",events:{onClick:function(){i.destroy();var t=!0===m.isChecked()?m.getValue():!0===p.isChecked()?p.getValue():!0===h.isChecked()?h.getValue():!0===f.isChecked()?f.getValue():u.getValue(),n=[];n="reportedAgainst"==t?v.isChecked()?w:C:w,e({ids:n,type:t,items:r})}}}),new n({value:y.dnd.cancel,className:"default drop-objects-issue-dialog-cancel",events:{onClick:function(){i.destroy(),c.utils.whereToAddModal=null,t(new Error("The dialog has been closed by the end user"))}}})],events:{onShow:function(){c.utils.whereToAddModal=i},onClose:function(){i.destroy(),c.utils.whereToAddModal=null,t(new Error("The dialog has been closed by the end user"))}}}).inject(d.body);new o({element:D}).inject(i.getBody()),i.show()})},addRelatedObjects:function(n,i,o){var a=this,r=g.get("widget")||window.widget,c=g.get("component");let d=[];d.push(n.node.options.physicalId),f.issues.retrieve({timestamp:null,data:{objects:d.map(function(e){return{physicalId:e}})},onComplete:function(e){n.node.options.reportedAgainst=e.results[0].body.reportedAgainst},onFailure:function(e){}}),_.related.whereToAddRelatedObjects.call(a,n,i,o).then(function(i){if(null===i)return t.resolve(null);var o=i.type,d=i.ids,u={};if(s.mask(r.body),u[n.id]={physicalId:n.id},"attachments"===o){var p=n.id,f=d;return m.connectDocumentsToParent(d,n.id).then(function(n){if(1===f.length&&1===n.length&&n[n.length-1].response.success)return m.fetch(f).then(function(n){if(e.is(n.results,"array")){var i=n.results.map(function(e){return m.parseFromFetch(e)});if(1===i.length&&"image"===i[i.length-1].documentType){var s=i[i.length-1];return m.setAsPrimary(s.id,p).then(function(e){var t=JSON.parse(e);s.id===t.documentId&&l.displayNotification({msg:w.notifications.SetAsPrimary.success,eventID:"info"})}).catch(function(e){l.displayNotification({msg:w.notifications.SetAsPrimary.failure,eventID:"error"}),a._logger.error(e)})}return t.resolve()}throw new Error("Unexpected empty fetch results for setAsPrimary.")}).catch(function(){a._logger.error(new Error("Unexpected fetch error for setAsPrimary."))});if(1===n.length&&!n[0].response.success&&n[0].response.error.includes("Relationship already exists"))throw new Error("Already attached");if(1===n.length&&!n[0].response.success&&-1!==n[0].response.internalError.indexOf("1500028"))throw new Error("1500028");return t.resolve()}).then(function(){var e={paths:[[p]],attributes:{}};e.attributes[p]={id:n.id,name:n.name,title:n.title,type:n.type,modifiedAttributes:["attachments"]},c.publishUpdate(e),c.document.refreshNodesById({modified:[n.id]})}).then(function(){s.unmask(r.body),l.displayNotification({msg:y.replace(y.notifications.attachSuccess.attachments,{count:f.length,issue:n.title+" ("+n.name+")"}),eventID:"success"})}).catch(function(e){E.error("Could not add attachment(s): %s",e),s.unmask(r.body),e.message.includes("Already attached")?l.displayNotification({msg:y.dnd.alreadyAttached,eventID:"info"}):e.message.includes("1500028")?h.displayErrorMessage(h.getErrorMessage("1500028_1"),"error"):l.displayNotification({msg:y.notifications.serverError,eventID:"error"})})}{if("resolvedBy"==i.type){var v=d.indexOf(n.id);v>-1&&d.splice(v,1),0==d.length&&l.displayNotification({msg:y.resolvedBy.errorSameIssue,eventID:"error"})}var b=[];if(Array.isArray(n.node.options[i.type])?b=b.concat(n.node.options[i.type]):n.node.options[i.type]&&"physicalId"in n.node.options[i.type]&&b.push(n.node.options[i.type]),b.forEach(function(e){var t=d.indexOf(e.physicalId);"reportedAgainst"==i.type&&(t=d.indexOf(e.path.join())),t>-1&&(d.splice(t,1),l.displayNotification({msg:y.dnd.alreadyAttached,eventID:"info"}))}),0===d.length)return s.unmask(r.body),!1;let e=g.get(C),c=Object.keys(e["ds6w:type"]),m=[];i.items.forEach(e=>{c.includes(e.objectType)&&m.push(e.objectId)});let p=!1;switch(o){case"contexts":u[n.id].contexts=d.filter(function(e){if(!m.includes(e))return e}).map(e=>(p=!0,{physicalId:e})),y.notifications.attachSuccessContexts;break;case"reportedAgainst":u[n.id].reportedAgainst=d.sort().filter(function(e,t,n){if((!t||e!==n[t-1])&&!m.includes(e))return e}).map(function(e){return p=!0,{physicalId:e}}),y.notifications.attachSuccessAffectedItems;break;case"resolvedBy":u[n.id].resolvedBy=d.sort().filter(function(e,t,n){return!t||e!==n[t-1]}).map(function(e){return p=!0,{physicalId:e}}),y.notifications.attachSuccessResolvedBy;break;case"resolvedItems":u[n.id].resolvedItems=d.sort().filter(function(e,t,n){if((!t||e!==n[t-1])&&!m.includes(e))return e}).map(function(e){return p=!0,{physicalId:e}}),y.notifications.attachSuccessResolvedItems}return p?a.document.addContextsOrReportedAgainstOrResolvedByOrResolvedItems(u).then(function(){s.unmask(r.body),l.displayNotification({msg:y.replace(y.notifications.attachSuccess[o],{count:d.length,issue:n.title+" ("+n.name+")"}),eventID:"success"})},function(e){if(E.error("Could not add related object(s): %s",e),s.unmask(r.body),e.error.internal.includes("Verify that your responsibility and the maturity state of the Issue are compatible with this operation.ErrorCode:2005")){var t=h.getErrorMessage("2005");h.displayErrorMessage(t,"error")}else l.displayNotification({msg:e.error.message,eventID:"error"})}):(s.unmask(r.body),l.displayNotification({msg:y.dnd.partiallyNotSupported,eventID:"error"}),t.resolve(null))}})},uploadFilesAsAttachments:function(e,n){for(var i=this,s=g.get("widget")||window.widget,o=g.get("component"),a=function(e){this.set("isCancelable",!0),this.set("request",e)},r=function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.set("requestProgress",t)}},h=function(){this.set("isCancelable",!1),this.set("request",null)},f=e.id,v=new d({id:f}),b=[],I=[],S=0;S<n.length;S++){var C=n[S],_="temporary_"+Math.floor(Date.now())+"_"+S,T=C.type,D={id:_,title:C.name,type:"Document",dispType:w.views.Attachment.types.Document,owner:{firstName:c.getUser().firstName,fullName:c.getUser().firstName.trim()+" "+c.getUser().lastName.trim(),lastName:c.getUser().lastName,user:c.getUser().login},relOwner:{firstName:c.getUser().firstName,fullName:c.getUser().firstName.trim()+" "+c.getUser().lastName.trim(),lastName:c.getUser().lastName,user:c.getUser().login},relOriginated:(new Date).toString()};C.hasOwnProperty("lastModifiedDate")?C.lastModifiedDate instanceof Date?(D.modified=C.lastModifiedDate.toString(),D.created=C.lastModifiedDate.toString()):(D.modified=new Date(C.lastModifiedDate).toString(),D.created=new Date(C.lastModifiedDate).toString()):(D.modified=(new Date).toString(),D.created=(new Date).toString());var M=new u(D);M.set("isProcessing",!0),M.setDocumentTypeByMIME(T),b.push(M);var A=function(e){return{file:{tempId:this.tempId,type:this.type},response:e}},x=m.uploadFile(C,v.id,{onCheckinStart:a.bind(M),onCheckinProgress:r.bind(M),onCheckinComplete:h.bind(M)});I.push(x.then(A.bind({tempId:_,type:T})).catch(A.bind({tempId:_,type:T})))}v.add(b,{sort:!1}),new p({container:s.body,collection:v}).render();var N=t.all(I).then(function(n){for(var s=0,o=0;o<n.length;o++){var a=n[o].file.tempId,r=n[o].file.type,d=n[o].response;if(d.success){s+=1,v.get(a).set("isProcessing",!1),v.remove(a);var p=d.data[0],h=m.parseDocument(p);h.relOwner={firstName:c.getUser().firstName,fullName:c.getUser().firstName.trim()+" "+c.getUser().lastName.trim(),lastName:c.getUser().lastName,user:c.getUser().login},h.relOriginated=(new Date).toString();var g=new u(h);g.set("iconUrl",g.get("thumbnailUrl")),g.setDocumentTypeByMIME(r),v.add(g)}else v.get(a).set("isFailed",!0),v.get(a).set("isProcessing",!1),v.get(a).set("isCancelable",!1),v.get(a).set("request",null),d instanceof Error&&E.error(d)}var b=t.resolve();if(s>0){if(1===v.size()&&"image"===v.at(0).get("documentType")){var I=v.at(0);b=m.setAsPrimary(I.id,f).then(function(e){var t=JSON.parse(e);I.id===t.documentId&&l.displayNotification({msg:w.notifications.SetAsPrimary.success,eventID:"info"})}).catch(function(e){l.displayNotification({msg:w.notifications.SetAsPrimary.failure,eventID:"error"}),i._logger.error(e)})}l.displayNotification({msg:y.replace(w.notifications.Upload.successIssue,{count:s,issue:e.title+" ("+e.name+")"}),eventID:"success"})}return s!==n.length&&l.displayNotification({msg:y.replace(w.notifications.Upload.failure,{count:n.length-s}),eventID:"error"}),b}).then(function(){var t={paths:[[e.id]],attributes:{}};t.attributes[e.id]={id:e.id,name:e.name,title:e.title,type:e.type,modifiedAttributes:["attachments"]},o.publishUpdate(t),o.document.refreshNodesById({modified:[e.id]})}).catch(function(e){E.error(e)});return{collection:v,promise:N}}},events:{onDropCell:function(e,t){e.preventDefault();var n=null,i=(n=t.nodeModel.options.baseType!==S?t.nodeModel.getParent():t.nodeModel).options.id,s=n.options.type,o=n.options.name,a=n.options.title,r=_.getDroppableData(e);if(!r)return l.displayNotification({msg:y.dnd.notSupported,eventID:"warning"}),!1;if(r.hasOwnProperty("files")&&r.files instanceof FileList)_.related.uploadFilesAsAttachments.call(this,{node:n,id:i,type:s,name:o,title:a},r.files);else{if(!h.isValid3DXContent(r)||!r.data.items.length)return l.displayNotification({msg:y.dnd.notSupported,eventID:"warning"}),!1;_.related.addRelatedObjects.call(this,{node:n,id:i,type:s,name:o,title:a},r.data.items,e)}return!0}}};return _}),define("DS/IssueManagement/commands/InlineCreate",["UWA/Class","DS/ApplicationFrame/CommandCheckHeader"],function(e,t){"use strict";var n=200,i=300,s=100;return e.extend(t,{view:null,activated:!1,mini:null,init:function(e){var t=this;t._parent(e,{});var n=!1,i=t.onStateChange(function(){!0!==n?t.activated!==t.getState()&&(t.activated=t.getState(),!0===t.activated?t.execute():t.hide()):n=!1}),s=t._destroy;t._destroy=function(){t._modelEvents.unsubscribe(i),s.call(t)},n=!0,t.setState(!1,!0)},execute:function(){var e=this;require(["UWA/Core","DS/IssueCommon/utils/Utils","DS/IssueManagement/components/header/InlineCreate","DS/IssueServices/Contexts","DS/Controls/Popup"],function(t,n,o,a,r){var l=a.get("actionBar");e.mini=null;var c=new o,d=a.get("actionBar").getIconBar().getItem("InlineCreate");d.tooltip.getContent().hide(),e.view=c;var u=d.elements.container,m=d.elements.icon;if(u.getBoundingClientRect().left-l.container.getBoundingClientRect().left<i)e.mini=t.createElement("div",{class:"mini-inline-create",html:[{tag:"div",class:"mini-inline-create-placeholder"},c.render()]}),e.createPopup=new r({target:a.get("actionBar").container.parentElement,trigger:"click",visibleFlag:!0,autoHide:!1,position:"bottom",alignment:"near",offset:{x:0,y:0},mouseRelativePosition:!1,constraint:"none",overlap:!0,arrowBoxFlag:!1,className:"wux-controls-popup-inline-create"}),e.createPopup.setBody(e.mini),setTimeout(function(){c.focus()},s);else{var p=function(){setTimeout(function(){c.focus()},s),u.removeEventListener("transitionend",p,{once:!0})};u.addEventListener("transitionend",p,{once:!0}),u.setStyles({transition:"width 0.2s",width:i}),m.setStyle("float","left"),c.render().inject(u)}})},hide:function(){var e=this;require(["DS/IssueServices/Contexts"],function(t){e.view.destroy(),e.view=null,null!==e.mini&&(e.mini.destroy(),e.mini=null),null!=e.createPopup&&(e.createPopup.destroy(),e.createPopup=null);var i=t.get("actionBar").getIconBar().getItem("InlineCreate");setTimeout(function(){i.tooltip.getContent().show(),i.tooltip.hide()},n);var s=i.elements.container,o=i.elements.icon;s.setStyle("width","38px"),o.setStyle("float","initial")})}})}),define("DS/IssueManagement/views/facets/Team",["UWA/Class/View","UWA/Core","DS/UIKIT/Scroller","DS/IssueComponents/team/Team","DS/IssueComponents/team/TeamNew","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o,a,r){"use strict";return e.extend({name:"DS/IssueManagement/views/facets/Team",tag:"div",className:"team-view fade-in-element",defaultOptions:{physicalIds:[]},team:null,_subscriberId:"",_eventListeners:[],setup:function(e){var t=this;r.start(t.name+" setup"),t._parent(e),t.team=new s({physicalIds:t.getOption("physicalIds")}),t._subscriberId=Math.random().toString(36).substr(2,9),t.listenTo(t.team,"onReady",function(e){t.dispatchEvent("onReady",e)}),t.listenTo(t.team,"onFailure",function(e){t.dispatchEvent("onFailure",e)}),t.listenTo(t.team,"onUpdate",function(e){for(var n=[],i={},s=Object.keys(e.issues),a=0;a<s.length;a++)n.push([e.issues[s[a]].id]),i[e.issues[s[a]].id]={id:e.issues[s[a]].id,type:e.issues[s[a]].type,name:e.issues[s[a]].name,title:e.issues[s[a]].title,modifiedAttributes:["assignees"]};o.get("eventsHandler").publish(t._subscriberId,"DS/Object/update",{metadata:{appId:o.get("widget").id,appName:o.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:n,attributes:i},version:"1.0"})}),t._eventListeners=[{event:"DS/Object/update",listener:function(e){t.team&&t.team.physicalIds&&(e.data.paths.some(function(e){return-1!==t.team.physicalIds.indexOf(e[0])})&&t.team.refresh())},conditions:{type:"issue",attributes:["owner","assignees"]}}];for(var n=0;n<t._eventListeners.length;n++){var i=t._eventListeners[n];i.token=o.get("eventsHandler").subscribe(t._subscriberId,i.event,i.listener.bind(t),i.conditions)}r.end(t.name+" setup")},render:function(){return r.start(this.name+" render"),this.team.render().inject(this.container),r.end(this.name+" render"),this},refresh:function(e){return this.setOption("physicalIds",e),this.team.refresh(e)},destroy:function(){if(this.stopListening(this.team,"onReady"),this.stopListening(this.team,"onFailure"),this.stopListening(this.team,"onUpdate"),Array.isArray(this._eventListeners))for(var e=0;e<this._eventListeners.length;e++){var t=this._eventListeners[e];o.get("eventsHandler").unsubscribe(t.token)}this._eventListeners=[],this._subcriberId="",this.team.destroy(),this.team=null,this.container.empty()}})}),define("DS/IssueManagement/commands/CommandsManager",["UWA/Class","UWA/Class/Events","DS/ApplicationFrame/CommandsManager","DS/Logger/Logger"],function(e,t,n,i){"use strict";var s="Issue",o="Default";return e.singleton(t,{_logger:null,init:function(){this._logger=i.getLogger("DS/IssueManagement/View")},setContext:function(e){o=e},commands:{issue:{single:["ChangeAction","3DMarkup"],multi:[],disable:[]},other:{single:[],multi:[],disable:["Export","ChangeAction","3DMarkup"]},empty:{single:[],multi:["InlineCreate","Create","Templates","Print","ColumnCustomization","Dynamic"],disable:["ChangeAction","3DMarkup","Find"]},common:{single:[],multi:["Print","ColumnCustomization"],disable:["Find"]}},all:["InlineCreate","Create","ChangeAction","3DMarkup","Templates","Print","ColumnCustomization","Dynamic"],special:["Selection","Export","Dynamic","SwitchLayout","ToggleInformationPanel"],idling:function(){var e=this.all;this.disable(e.filter(function(e){return!this.has(e)},new Set(["InlineCreate","Create","Templates"]))),this.dispatchEvent("onDisable",{commands:this.special,isIdle:!0}),this.enable(["InlineCreate","Create","Templates","Dynamic"])},select:function(e){this._logger.debug("Selecting elements in the list..."),this.dispatchEvent("onEnable",{commands:this.special});var t=[],n=[],i=[],o=[];if(!e||0===e.length)return t=this.all,n=this.commands.empty.multi,this.disable(t.filter(function(e){return!this.has(e)},new Set(n))),void this.enable(this.commands.empty.multi);var a=e.every(function(e){return e.options.baseType===s}),r=e.every(function(e){return e.options.baseType!==s});if(1===e.length){for(var l in this.commands)if(this.commands.hasOwnProperty(l))switch(l){case"issue":!1===a?o=o.concat(this.commands.other.disable):i=i.concat(this.commands.issue.single);break;default:i=i.concat(this.commands[l].single).concat(this.commands[l].multi)}}else for(var c in this.commands)if(this.commands.hasOwnProperty(c))switch(c){case"issue":!0===r&&(o=o.concat(this.commands.other.disable)),o=o.concat(this.commands.issue.single);break;default:i=i.concat(this.commands[c].multi)}t=t.concat(this.all),n=i,o=o.concat(t.filter(function(e){return!this.has(e)},new Set(n))),this.disable(o),this.enable(i)},getCommand:function(e){var t=o;return n.getCommand(e,t)},getCommandCheckHeader:function(e){var t=o;return n.getCommandCheckHeader(e,t)},enable:function(e){Array.isArray(e)&&(this._switchCommands(e,!0),this.dispatchEvent("onEnable",{commands:e}))},disable:function(e){Array.isArray(e)&&(this._switchCommands(e,!1),this.dispatchEvent("onDisable",{commands:e}))},_switchCommands:function(e,t){for(var n=0;n<e.length;n++){var i=this.getCommand(e[n]);void 0===i&&(i=this.getCommandCheckHeader(e[n]));try{!0===t?i.enable():i.disable()}catch(i){this._logger.debug("Cannot set the command %s to %s",e[n],t)}}}})}),define("DS/IssueManagement/components/information/Content",["UWA/Class/View","UWA/Core","UWA/Class/Promise","DS/Controls/TabBar","DS/Controls/TooltipModel","DS/Logger/Logger","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c){"use strict";var d={ELEMENTS:{VIEW_CONTAINER:"im-information-content-view",COMPACT:"compact"},DIMENSIONS:{MIN_WIDTH:420}},u="properties";return e.extend({name:"DS/IssueManagement/components/information/Content",tagName:"div",className:"im-information-content",_logger:null,views:{facets:{},current:"",indexes:{}},physicalIds:[],tabs:null,elements:{view:null},setup:function(e){l.start(this.name+" setup"),this._parent(e),this._logger=o.getLogger(this.name),this.views={facets:{},current:u,indexes:{}},this.customEvents=e.customEvents,this.views.facets={properties:{index:0,name:"properties",label:c.information.views.properties,icon:"newspaper",module:"DS/IssueManagement/views/facets/Properties",instance:null,isInstantiating:!1,toBeRefreshed:!1},relatedObjects:{index:1,name:"relatedObjects",label:c.information.views.relatedObjects,icon:"location",module:"DS/IssueManagement/views/facets/RelatedContent",instance:null,isInstantiating:!1,toBeRefreshed:!1},attachments:{index:2,name:"attachments",label:c.information.views.attachments,icon:"attach",module:"DS/IssueManagement/views/facets/Attachments",instance:null,isInstantiating:!1,toBeRefreshed:!1},team:{index:3,name:"team",label:c.information.views.team,icon:"users",module:"DS/IssueManagement/views/facets/Team",instance:null,isInstantiating:!1,toBeRefreshed:!1},comments:{index:4,name:"comments",label:c.information.views.comments,icon:"chat",module:"DS/IssueManagement/views/facets/Comments",instance:null,isInstantiating:!1,toBeRefreshed:!1},relations:{index:5,name:"relations",label:"Relations",icon:"object-related",module:"DS/IssueManagement/views/facets/Relations",instance:null,isInstantiating:!1,toBeRefreshed:!1},history:{index:6,name:"history",label:c.information.views.history,icon:"navigation-history",module:"DS/IssueManagement/views/facets/History",instance:null,isInstantiating:!1,toBeRefreshed:!1}},this.physicalIds=[],this.tabs=null,this.elements={view:null},l.end(this.name+" setup")},render:function(){var e=this;l.start(e.name+" render");var n=e.tabs=new i({displayStyle:"strip",showComboBoxFlag:!0,editableFlag:!1,multiSelFlag:!1,reindexFlag:!0,touchMode:!0,centeredFlag:!1,allowUnsafeHTMLOnTabButton:!0}),o=Object.keys(e.views.facets);return o.forEach(function(t){var i=e.views.facets[t],o=new s({shortHelp:i.label}),r=n.add({index:i.index,isSelected:t===e.views.current,label:i.label,icon:{iconName:i.icon,fontIconFamily:1},showTitleFlag:!1,tooltipInfos:o});0==a.get3DSwymUrl()&&"comments"==t&&(r.visibleFlag=!1),e.views.indexes[i.index]=t}),n.inject(e.container),n.addEventListener("change",function(){var i=n.value[n.value.length-1];t.is(e.views.indexes)&&t.is(e.views.indexes[i])&&(e.views.current=e.views.indexes[i],e.refresh(e.physicalIds,{force:!1}))}),o.forEach(function(i){var s=e.views.facets[i].index;n.buttonGroup.getButton(s).elements.container.addEventListener("dragover",function(){n.value[n.value.length-1]!==s&&n.buttonGroup.selectIndex(s)});let o=n.buttonGroup.getButton(s).elements.container;(n.buttonGroup.getButton(s).elements.iconContentCount=t.createElement("span",{class:"im-tab-content-count"})).inject(o)}),e.customEvents.subscribe({event:"im-update-tab-count"},function(t){t.tabs.forEach(function(i,s){let o=e.views.facets[i].index,a=n.buttonGroup.getButton(o).elements.iconContentCount;""===t.count[s]?a.innerHTML="":a.innerHTML=`(${t.count[s]})`})}),e.elements.view=t.createElement("div",{class:d.ELEMENTS.VIEW_CONTAINER}),e.elements.view.inject(e.container),l.end(e.name+" render"),e},destroy:function(){this.views={facets:{},current:"",indexes:{}},this.physicalIds=[],this.tabs.destroy(),this.tabs=null,this.elements={view:null},this.container.empty()},refresh:function(e,i){var s=this,o=n.resolve(),r=s.views.current;if(!Array.isArray(e)||0===e.length)return o;s.physicalIds=e;var l=Object.keys(s.views.facets);l.forEach(function(e){var t=s.views.facets[e];null!==t.instance&&t.instance.container.addClassName("hidden")}),a.Mask.mask(s.elements.view);var c=s.views.facets[[s.views.current]];return null===c.instance?!0!==c.isInstantiating&&(c.isInstantiating=!0,o=new n(function(e,t){require([c.module],function(n){c.instance=new n({physicalIds:s.physicalIds}),s.listenToOnce(c.instance,"onReady",function(){e()}),s.listenToOnce(c.instance,"onFailure",function(e){s._logger.error("Refresh has failed: %o",e.error),t(e.error)}),c.isInstantiating=!1,c.instance.render().inject(s.elements.view),c.instance.container.addClassName("visible"),s.views.current===c.name?c.instance.container.addClassName("visible"):c.instance.container.addClassName("hidden"),a.Mask.unmask(s.elements.view)})})):(c.instance.container.addClassName("visible"),c.instance.container.removeClassName("hidden"),i&&!0===i.force?(o=c.instance.refresh(s.physicalIds).then(function(){t.is(c.instance.resize,"function")&&c.instance.resize(),a.Mask.unmask(s.elements.view)}),l.forEach(function(e){var t=s.views.facets[e];t&&t!==c&&null!==t.instance&&(t.toBeRefreshed=!0)})):!0===c.toBeRefreshed?o=c.instance.refresh(s.physicalIds).then(function(){t.is(c.instance.resize,"function")&&c.instance.resize(),a.Mask.unmask(s.elements.view),c.toBeRefreshed=!1}):(t.is(c.instance.resize,"function")&&c.instance.resize(),a.Mask.unmask(s.elements.view))),o.then(function(){s.dispatchEvent("onReady",{view:r})})},resize:function(){var e=this;e.container.toggleClassName(d.ELEMENTS.COMPACT,e.container.getParent()&&e.container.getParent().offsetWidth<d.DIMENSIONS.MIN_WIDTH),Object.keys(e.views.facets).forEach(function(n){var i=e.views.facets[n];null!==i.instance&&t.is(i.instance.resize,"function")&&i.instance.resize()})},switchFacet:function(e){var t=this,i=t.tabs;return t.views.current===e?n.resolve(t.views.facets[e].instance):new n(function(n){t.listenToOnce(t,"onReady",function(e){n(t.views.facets[e.view].instance)}),i.buttonGroup.selectIndex(t.views.facets[e].index)})},getFacet:function(e){return this.views.facets[e]},getCurrentFacet:function(){return this.views.facets[this.views.current]},getTabs:function(){return this.tabs}})}),define("DS/IssueManagement/commands/SelectAllIssues",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/SelectAllIssues",execute:function(){var e=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(t,n,i){var s=n.get("component").getTreeDocument();i.start(e.name+" execute"),s.withBroadcastSelect(new t(function(t){s.withTransactionUpdate(function(){s.unselectAll();for(var n=s.getRoots(!1),o=0;o<n.length;o++)n[o].select();i.end(e.name+" execute"),t()})}))})}})}),define("DS/IssueManagement/commands/UnselectAll",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/UnselectAll",execute:function(){var e=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(t,n,i){var s=n.get("component").getTreeDocument();i.start(e.name+" execute"),s.withBroadcastSelect(new t(function(t){s.withTransactionUpdate(function(){s.unselectAll(),i.end(e.name+" execute"),t()})}))})}})}),define("DS/IssueManagement/commands/Find",["UWA/Class","DS/ApplicationFrame/CommandCheckHeader"],function(e,t){"use strict";var n=200,i=300,s=100;return e.extend(t,{view:null,activated:!1,_query:"",mini:null,init:function(e){var t=this;t._parent(e,{});var n=!1,i=t.onStateChange(function(){!0!==n?t.activated!==t.getState()&&(t.activated=t.getState(),!0===t.activated?t.execute():t.hide()):n=!1});t._destroy=function(){t._modelEvents.unsubscribe(i)},n=!0,t.setState(!1,!0)},execute:function(){var e=this;require(["UWA/Core","DS/IssueManagement/components/header/Find","DS/IssueServices/Contexts"],function(t,n,o){var a=o.get("actionBar");e.mini=null;var r=new n,l=o.get("actionBar").getIconBar().getItem("Find");l.tooltip.getContent().hide(),e.view=r;var c=l.elements.container,d=l.elements.icon;c.getBoundingClientRect().left-a.container.getBoundingClientRect().left<i?(e.mini=t.createElement("div",{class:"mini-inline-find",html:[{tag:"div",class:"mini-inline-find-placeholder"},r.render()]}),e.mini.inject(o.get("actionBar").container.parentElement),setTimeout(function(){r.focus()},s)):(c.addEventListener("transitionend",function(){setTimeout(function(){r.focus()},s)},{once:!0}),c.setStyles({transition:"width 0.2s",width:i}),d.setStyle("float","left"),r.render().inject(c)),""!==e._query&&(e.view.input.setValue(e._query),e.view.find(e._query))})},find:function(e){this._query=e,!0===this.getState()?(this.view.input.setValue(this._query),this.view.find(this._query)):this.toggleState()},hide:function(){var e=this;require(["DS/IssueServices/Contexts"],function(t){e.view.destroy(),e.view=null,e._query="",null!==e.mini&&(e.mini.destroy(),e.mini=null);var i=t.get("actionBar").getIconBar().getItem("Find");setTimeout(function(){i.tooltip.getContent().show(),i.tooltip.hide()},n);var s=i.elements.container,o=i.elements.icon;s.setStyle("width","38px"),o.setStyle("float","initial")})}})}),define("DS/IssueManagement/views/facets/Related",["UWA/Core","UWA/Class/View","DS/IssueComponents/related/Related","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s){"use strict";return t.extend({name:"DS/IssueManagement/views/facets/Related"})}),define("DS/IssueManagement/IssueManagement",["UWA/Class","UWA/Class/Promise","UWA/Core","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Migration","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Support","DS/WidgetServices/WidgetServices","text!DS/IssueManagement/assets/Settings.json","i18n!DS/IssueManagement/assets/nls/IssueManagement","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o,a,r,l,c,d,u){"use strict";var m="ENXISSU_AP",p="Issue",h="ISU_TYPE_NLS",g="CUSTOM_ATTR_INFOS",f="X3DContentId",v="XNotifContentId",b="XTemplateContentId",I="XSharedContentId",y="maturityGraph",w={DIMENSIONS:{MINIMUM_INFORMATION_WIDTH:430,MINIMUM_COMPONENT_WIDTH:260}},S=function(){for(var e='<div class="issue-list-placeholder-header"></div>',t=0;t<=50;t++)e+='<div class="issue-list-placeholder-line"></div>';return n.createElement("div",{class:"issue-list-placeholder fade-out-element",html:[n.createElement("div",{class:"issue-list-placeholder-actions",html:'<div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action-divider"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action-divider"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action-divider"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div>'}),n.createElement("div",{class:"issue-list-placeholder-lines",html:e})]})},C=function(){return n.createElement("div",{class:"placeholder-loading-container",html:[n.createElement("div",{class:"placeholder-loading",html:[n.createElement("div",{class:"pin",html:'<span class="fonticon fonticon-5x fonticon-issue"></span>'}),n.createElement("div",{class:"pulse"}),n.createElement("span",{class:"placeholder-loading-label saving",html:[u.titles.placeholder.loading,{tag:"span",html:"."},{tag:"span",html:"."},{tag:"span",html:"."}]}),n.createElement("div",{class:"placeholder-loading-sub-container",html:[]})]}),n.createElement("div",{class:"placeholder-loading-background",html:""})]})},E=function(e){return n.createElement("div",{class:"loading-error-container",html:n.createElement("div",{class:"loading-error",html:[n.createElement("div",{class:"loading-error-icon",html:n.createElement("span",{class:"fonticon fonticon-5x fonticon-attention"})}),n.createElement("div",{class:"loading-error-label",html:e.label}),n.createElement("div",{class:"loading-error-sub-label",html:e.sub})]})})};return e.extend({name:"DS/IssueManagement/IssueManagement",actionBar:null,filter:null,status:null,component:null,elements:{container:null,header:null,body:null,footer:null},isLoaded:null,isStandalone:!1,_deferred:{resolve:null,reject:null},_isDOMLoaded:!1,_placeholder:null,_loading:null,_isResizing:!1,init:function(e){var s=this;i.add("widget",window.widget),i.add("isNatifEnvironnement",c.isNatifEnvironnement()),i.get("widget").name=m,i.add("application",s),u.summaryview&&u.summaryview,i.add("ISU_LISTVIEW",!1),s.component=null,s.actionBar=null,s.filter=null,s.status=null,s.elements={container:null,header:null,body:null,footer:null},s.isStandalone=!1,n.is(e,"object")&&(s.isStandalone=e.standalone||!1),s.isLoaded=new t(function(e,t){s._deferred.resolve=e,s._deferred.reject=t}),s._isDOMLoaded=!1,s._placeholder=S(),s._isResizing=!1,s.settings=JSON.parse(d),s.settings.switchToModelerAPIsForLoading?i.add("LoadData_ModelerAPI",!0):i.add("LoadData_ModelerAPI",!1),s._subscribers()},onLoad_old:function(){var e=this;r.start(e.name+" onLoad_old"),i.get("widget").body.setContent(e._placeholder),e._placeholder.removeClassName("fade-out-element").addClassName("fade-in-element"),e._loading=C().inject(i.get("widget").body);try{l.checkBrowserSupport()}catch(e){}if(!a.isUpToDate())return e._loading.destroy(),e._loading=null,void a.upgrade();i.get("widget").body.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation()});require(["DS/MSFDocumentManagement/WidgetIntegration"],function(e){i.get("widget").MSFDocumentClient=e,i.get("widget").MSFDocumentClient.ConnectWidgetWithMSF()}),s.initPlatformServices().then(function(){try{l.checkSwymSupport()}catch(e){}var t=s.getSecurityContexts(),n=s.getTenants();return e._setPreferences({securityContexts:t,tenants:n})}).then(function(){var e=s.getCurrentCredentials();return i.get("widget").setValue("xPref_CREDENTIAL",e.role+"."+e.organization+"."+e.collaborativeSpace),new t(function(e,t){return o.issues.getIssueMaturityGraph({}).then(function(t){e(t)},function(t){e("")})})}).then(function(e){if(null!=e&&""!==e&&""!==e.body){var t=e.body[y];i.add(y,t)}}).then(()=>new t(function(e,t){var n=[p];o.type.getSubType().then(t=>{null!=t&&Object.keys(t).length>0&&(n=Object.keys(t)),e(n)}).catch(function(t){console.log(t),e(n)})})).then(function(e){var t={"ds6w:type":e,"ds6w:organizationResponsible":[s.getCurrentCredentials().organization],"ds6w:project":[s.getCurrentCredentials().collaborativeSpace]};o.getNLSValuesPromise(t).then(e=>{i.add(h,e)})}).then(function(){return new t(function(e,t){return o.getExpressionValue({}).then(function(t){e(t)},function(t){e("")})})}).then(function(t){var n=["ISU_AUTO_DATES"];return t&&t.data&&t.data.forEach(function(e){if(e.dataelements){var t=Object.keys(e.dataelements);for(var s in t)n.indexOf(t[s])>=0&&i.add([t[s]],e.dataelements[t[s]])}}),e._initializeComponent({})}).then(function(){r.end(e.name+" onLoad_old"),e._deferred.resolve()},function(t){r.end(e.name+" onLoad_old"),e._deferred.reject(t),e._loading.destroy(),e._loading=null;var n=e.utils.getNLSMsg(t);i.get("widget").body.appendChild(E(n)),"Oops! Something went wrong."===n.label&&e.utils.error(t)})},onLoad:function(){var e=this;if(r.start(e.name+" onLoad"),i.get("LoadData_ModelerAPI")){i.get("widget").body.setContent(e._placeholder),e._placeholder.removeClassName("fade-out-element").addClassName("fade-in-element"),e._loading=C().inject(i.get("widget").body);try{l.checkBrowserSupport()}catch(e){}if(!a.isUpToDate())return e._loading.destroy(),e._loading=null,void a.upgrade();i.get("widget").body.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation()});require(["DS/MSFDocumentManagement/WidgetIntegration"],function(e){i.get("widget").MSFDocumentClient=e,i.get("widget").MSFDocumentClient.ConnectWidgetWithMSF()}),s.initPlatformServices().then(function(){e.initialize().then(function(){r.end(e.name+" onLoad"),e._deferred.resolve()},function(t){r.end(e.name+" onLoad"),e._deferred.reject(t),e._loading.destroy(),e._loading=null;var n=e.utils.getNLSMsg(t);i.get("widget").body.appendChild(E(n)),"Oops! Something went wrong."===n.label&&e.utils.error(t)})})}else e.onLoad_old()},initialize:async function(e){this.setPreferences();var t=s.getCurrentCredentials();i.get("widget").setValue("xPref_CREDENTIAL",t.role+"."+t.organization+"."+t.collaborativeSpace);let n=await o.issues.getIssueMaturityGraph({});if(null!=n&&""!==n&&""!==n.body){var a=n.body[y];i.add(y,a)}var r=[p];let l=await o.type.getSubType();null!=l&&Object.keys(l).length>0&&(r=Object.keys(l));var c={"ds6w:type":await this.utils.getTypeExtensions(r),"ds6w:organizationResponsible":[s.getCurrentCredentials().organization],"ds6w:project":[s.getCurrentCredentials().collaborativeSpace]};let d=await o.getNLSValuesPromise(c);i.add(h,d),this.utils.getProperties();let u=await o.getExpressionValue({});var m=["ISU_AUTO_DATES"];return u&&u.data&&u.data.forEach(function(e){if(e.dataelements){var t=Object.keys(e.dataelements);for(var n in t)m.indexOf(t[n])>=0&&i.add([t[n]],e.dataelements[t[n]])}}),await this._initializeComponent({})},setPreferences:function(){try{l.checkSwymSupport()}catch(e){}var e=s.getSecurityContexts(),t=s.getTenants();return this._setPreferences({securityContexts:e,tenants:t})},onRefresh:function(e){var t=void 0!==e,n=i.get("widget")||window.widget;n.setTitle(this.getTitle()+" - "+u.titles.refreshing);let o=n.getValue("filter"),a=!1;(((o=JSON.parse(o)).reported||o.responsible)&&!0,null!==this.component)&&(0===this.component.getTreeDocument().getRoots(!0).length&&!0===this.component.getTreeDocument().isBIFiltered()?this.onTitleChange():i.get("LoadData_ModelerAPI")?this.component.refresh_New(t):this.component.refresh(t));if(null!==this.information&&this.information.refreshInfo(),void 0!==n.getValue("xPref_CREDENTIAL")){var r=s.getCurrentCredentials();n.setValue("xPref_CREDENTIAL",r.role+"."+r.organization+"."+r.collaborativeSpace)}},onResize:function(){this._isResizing=!1,!1!==this._isDOMLoaded&&(this._placeholder.removeClassName("fade-in-element").addClassName("fade-out-element"),this._placeholder.removeClassName("resizing"),this.elements.container.removeClassName("fade-out-element").addClassName("fade-in-element"),this.resize())},endEdit:function(){this.component.publishPreferences()},onDestroy:function(){null!==this.actionBar&&this.actionBar.destroy(),this.actionBar=null,i.remove("actionBar"),null!==this.filter&&this.filter.destroy(),this.filter=null,i.remove("filter"),null!==this.status&&this.status.destroy(),this.status=null,i.remove("status"),null!==this.component&&this.component.destroy(),this.component=null,i.remove("component"),null!==this.information&&this.information.destroy(),this.information=null,i.remove("information"),this.elements.container.destroy(),this.elements.header.destroy(),this.elements.body.destroy(),this.elements.footer.destroy(),this.elements={container:null,header:null,body:null,footer:null},i.remove("application"),i.remove("widget"),this._isDOMLoaded=!1},onTitleChange:function(){var e=i.get("widget"),t=this.getTitle(),n=this.component.getTreeDocument().getRoots(!1);0===n.length?t+=" - "+u.titles.placeholder.title:t+=" ("+n.length+")",e.getTitle()!==t&&e.setTitle(t)},onSetPathTags:function(){this.component.setLocalPathTags()},resize:function(){var e=i.get("widget")||window.widget;null!==this.actionBar&&this.actionBar.resize(),e.body.offsetWidth>w.DIMENSIONS.MINIMUM_INFORMATION_WIDTH+w.DIMENSIONS.MINIMUM_COMPONENT_WIDTH?(null!==this.information&&(this.information.fullScreenMode||(this.information.fullscreenWidth=!1),this.information.resize()),null!==this.component&&(this.component.container.show(),this.component.resize()),null!==this.elements.header&&this.elements.header.show()):(null!==this.information&&(this.information.fullscreenWidth=!0,this.information.resize()),"right"==this.information.layout.current&&this.information._isOpened&&this.information.physicalIds.length&&this.elements.header.hide()),null!==this.component&&this.component.resize()},getTitle:function(){var e=i.get("widget")||window.widget,t=e.getValue("myTitle"),n=e.getPreference("myTitle");return e&&n?t=(t=t&&t.trim())||n.defaultValue:u.preferences.name.default},getActions:function(){return this.actionBar},getInformation:function(){return this.information},getComponent:function(){return this.component},updateHeaderToggle:function(){"right"==this.information.layout.current&&this.information._isOpened&&this.information.fullscreenWidth&&this.information.physicalIds.length?this.elements.header.hide():(this.elements.header.show(),this.actionBar.resize())},_initializeComponent:function(e){var n=this,s=i.get("widget")||window.widget,o=null,a=null,r=null,l=null,c=null,d=null,u=null,m=null;return new t(function(e){require(["UWA/Core","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/Component","DS/IssueManagement/components/footer/Status","DS/IssueManagement/components/header/ActionBar","DS/IssueManagement/components/header/Filter","DS/IssueManagement/components/information/Information","DS/IssueManagement/utils/EventsHandler"],function(t,n,i,s,p,h,g,f){o=t,a=n,r=i,u=s,l=p,c=h,d=g,m=f,e()})}).then(function(){return new t(function(t,s){return n.eventsHandler=new m,i.add("eventsHandler",n.eventsHandler),n.information=(new d).render(),i.add("information",n.information),n.filter=(new c).render(),i.add("filter",n.filter),n.actionBar=(new l).render(),i.add("actionBar",n.actionBar),n.status=(new u).render(),i.add("status",n.status),n.component=new r(o.extend(e,{events:{onReady:function(e){t(e)},onRootsAdded:function(){n.onTitleChange(),0===n.component.getSelectedNodes().length&&a.select()},onRootsRemoved:function(){0===n.component.getTreeDocument().getRoots(!1).length?a.idling():0===n.component.getSelectedNodes().length&&a.select(),n.onTitleChange()},setPathTags:function(){n.onTitleChange(),n.component.publishFilteredIssues()}}})),i.add("component",n.component),n.component.build().catch(s)})}).then(function(e){return new t(function(t){n.elements.header=o.createElement("div",{class:"im-header"}),n.elements.body=o.createElement("div",{class:"im-body"}),n.elements.footer=o.createElement("div",{class:"im-footer"}),n.actionBar.inject(n.elements.header),n.component.inject(n.elements.body),n.information.inject(n.elements.body),n.status.inject(n.elements.footer);var r=n.elements.container=o.createElement("div",{class:"issue-list"});n.elements.header.inject(r),n.elements.body.inject(r),n.elements.footer.inject(r),r.inject(s.body),0===e.roots.length?(n.onTitleChange(),a.idling()):a.select(),n._placeholder.removeClassName("fade-in-element").addClassName("fade-out-element"),n._loading.destroy(),n._loading=null;var l=s.getValue("infoIsOpened"),c=o.is(l,"boolean")?l:"true"===l;if(!c){var d=s.getValue(f)?JSON.parse(s.getValue(f)):null;null!==d&&"ENXISSU_AP"==d.source&&(c=!0,n.information.fullScreenMode=!0,n.information.fullscreenWidth=!0,s.setValue("infoIsOpened",!0),i.get("actionBar").updatePanelToggle())}n.information.toggle(c,!1),n._isDOMLoaded=!0,t()})}).then(function(){return n.component.onPostInitialize()})},_setPreferences:function(e){var t=i.get("widget")||window.widget;if(!0===s.isCloudEnvironment()&&n.is(e.tenants,"object")&&t.addPreference({name:"x3dPlatformId",type:"list",label:u.preferences.tenant,options:e.tenants.platforms,defaultValue:e.tenants.tenant}),n.is(e.securityContexts,"object")){t.addPreference({name:"pad_security_ctx",type:"list",label:u.preferences.securityContext,options:e.securityContexts.cspaces});var o=t.getValue("pad_security_ctx"),a=e.securityContexts.cspaces.findIndex(e=>e.value==o)>=0?o:"";""!==a?t.setValue("pad_security_ctx",a):t.setValue("pad_security_ctx",e.securityContexts.securityContext)}return t.addPreference({name:"myTitle",type:"text",label:u.preferences.name.title,onchange:"onTitleChange",defaultValue:u.preferences.name.default}),this.settings.hideNoFilterSelectionPreference||t.addPreference({name:"defaultFilterForAll",type:"list",label:u.preferences.defaultFilterForAll.title,options:[{label:u.preferences.defaultFilterForAll.organizationAndProject,value:"organization-project",isDefault:!0},{label:u.preferences.defaultFilterForAll.organization,value:"organization"},{label:u.preferences.defaultFilterForAll.project,value:"project"},{label:u.preferences.defaultFilterForAll.policy,value:"policy"}],defaultValue:"organization-project"}),t.addPreference({name:"organizationFilter",type:"boolean",label:u.preferences.organizationFilter,defaultValue:"false"}),t.addPreference({name:"approaching",type:"range",min:"0",max:"100",label:u.preferences.highlights.soon,defaultValue:"3"}),t.addPreference({name:"activateBIFilter",type:"boolean",label:u.preferences.tagger,defaultValue:"true"}),t.addPreference({name:"filter",type:"hidden",defaultValue:JSON.stringify({owned:!0,assigned:!0,reported:!1,responsible:!1,contributed:!1,closed:!1,session:!1})}),t.addPreference({name:"roots",type:"hidden",defaultValue:[]}),this._computeFilter(),this._computePreferences(),t.getPreferences()},_computeFilter:function(){var e=i.get("widget")||window.widget;try{var t=JSON.parse(e.getValue("filter")),o=e.getValue(I)?JSON.parse(e.getValue(I)):null,a=e.getValue(v)?JSON.parse(e.getValue(v)):null,r=e.getValue(f)?JSON.parse(e.getValue(f)):null,l=[];if(null!==o)l=l.concat(o.issues);else if(null!==a)l=l.concat(a.issues);else if(null!==r){var c=[],d=!1;if(r.data.items.forEach(function(e){e.objectType===p&&(l.push(e.objectId),c.push(e.envId))}),1===c.length&&c[0]!==s.getTenant()&&n.is(e.getPreference("x3dPlatformId"),"object")&&n.is(e.getPreference("x3dPlatformId").options,"array")){d=!0;for(var m=e.getPreference("x3dPlatformId").options,h=0;h<m.length;h++){var g=m[h];if(g.value===c[0]){e.setValue("x3dPlatformId",g.value),require(["DS/PADUtils/views/PADAlert"],function(e){e.displayNotification({msg:u.multiTenants.differentTenant,eventID:"info"})}),d=!1;break}}}d&&require(["DS/PADUtils/views/PADAlert"],function(e){e.displayNotification({msg:u.replace(u.multiTenants.mismatchTenant,{tenant:c[0]}),eventID:"error"})})}0===l.length&&!0===t.session&&(l=e.getValue("roots")),l.length>0?(t={owned:!1,assigned:!1,reported:!1,responsible:!1,contributed:!1,closed:!1,session:!0},e.setValue("filter",JSON.stringify(t)),e.setValue("roots",l)):e.setValue("roots",[])}catch(e){}},_computePreferences:function(){var e=i.get("widget")||window.widget;return new t(function(t,n){try{var i=e.getValue(b)?JSON.parse(e.getValue(b)):null;if(null!==i){var s=i.template;s&&""!==s&&t(s)}}catch(e){n(new Error("An error occurred while adding a shared template "+e))}}).then(function(o){return new t(function(t){require(["DS/PADUtils/views/PADAlert","DS/IssueComponents/templates/Templates","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(a,r,l){var c=new r(i.get("widget"),{editMode:!0,onClose:function(){},onEnd:function(){}}),d=!1;if(o.envId!==s.getTenant()&&n.is(e.getPreference("x3dPlatformId"),"object")&&n.is(e.getPreference("x3dPlatformId").options,"array")){d=!0;for(var m=e.getPreference("x3dPlatformId").options,p=0;p<m.length;p++){var h=m[p];if(h.value===o.envId){e.setValue("x3dPlatformId",h.value),require(["DS/PADUtils/views/PADAlert"],function(e){e.displayNotification({msg:u.multiTenants.differentTenant,eventID:"info"})}),d=!1;break}}}d&&require(["DS/PADUtils/views/PADAlert"],function(e){e.displayNotification({msg:u.replace(u.multiTenants.mismatchTenantSharedTemplate,{tenant:o.envId}),eventID:"error"})}),c.addSharedTemplateToPreferences(o).then(t).catch(function(){a.displayNotification({msg:l.templates.notifications.sharedTemplateNotAdded,eventID:"error"}),t()})})})})},_subscribers:function(){var e=this,t=i.get("widget")||window.widget;t.addEvent("onLoad",e.onLoad.bind(e)),t.addEvent("onRefresh",e.onRefresh.bind(e)),t.addEvent("onResize",e.onResize.bind(e)),t.addEvent("endEdit",e.endEdit.bind(e)),t.addEvent("onDestroy",e.onDestroy.bind(e)),t.addEvent("onTitleChange",e.onTitleChange.bind(e)),t.addEventOnce("onSetPathTags",e.onSetPathTags.bind(e)),e._isResizing=!1,window.addEventListener("resize",function(){!1!==e._isDOMLoaded&&!0!==e._isResizing&&(e._isResizing=!0,e._placeholder.addClassName("resizing"),e._placeholder.removeClassName("fade-out-element").addClassName("fade-in-element"),e.elements.container.removeClassName("fade-in-element").addClassName("fade-out-element"))},!1)},utils:{error:function(e){n.is(e,"object")&&n.is(e.error,"object")&&n.is(e.error.message,"string")&&require(["DS/PADUtils/views/PADAlert"],function(t){t.displayNotification({msg:e.error.message,eventID:"error"})})},getNLSMsg:function(e){var t={label:u.error.generic.label,sub:u.error.generic.sub},i="";return n.is(e,"object")&&n.is(e.error,"object")&&n.is(e.error.message,"string")&&(i=e.error.message),i.contains("The server cannot obtain the license for user")&&(t.label=u.error.licensing.label,t.sub=u.replace(u.error.licensing.sub,{user:s.getUserName()})),t},getPropValue:function(e,t){t.split(".").reduce((e,t)=>null==e?e:e[t],e)},getTypeExtensions:function(e){return new t(function(n,i){let s=[],a=[],r=[];for(let t of e){s.push(t);let e=o.type.getClassExtensionInterface(t);r.push(e)}t.all(r).then(e=>{for(let t of e)if(t.extensions.length>0)for(let e of t.extensions)a.includes(e.curi)||a.push(e.curi);s.push(...a),n(s)})})},getProperties:function(){let e=[],s=[],a=i.get("ISU_TYPE_NLS"),r=[];n.is(a["ds6w:type"])&&(r=Object.keys(a["ds6w:type"]));for(let t of r){e.push(t);let n=o.type.getProperties(t);s.push(n)}t.all(s).then(e=>{if(Array.isArray(e)){let t=e.map(e=>{if(null!=e&&e.classPredicates&&e.classPredicates.length)return e.classPredicates[0].vocabularyPredicateInfo}).filter(function(e){return void 0!==e}),n=[];t.map(e=>{let t=e.filter(e=>{if(e.hasOwnProperty("userAccess"))return e});n.push(...t)});const s=[...new Set(n.map(e=>JSON.stringify(e)))].map(e=>JSON.parse(e));i.add(g,s)}})}}})}),define("DS/IssueManagement/commands/SwitchLayout",["UWA/Core","UWA/Class","DS/ApplicationFrame/Command"],function(e,t,n){"use strict";return t.extend(n,{name:"DS/IssueManagement/commands/SwitchLayout",begin:function(e){this.execute(e)},execute:function(e){var t=this;require(["DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(n,i){i.start(t.name+" execute"),n.get("information").setLayout(e.layout),n.get("actionBar").updateLayoutSwitcher(),i.end(t.name+" execute")})}})}),define("DS/IssueManagement/components/header/Find",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a){"use strict";var r={ENTER_KEY:13,ESCAPE_KEY:27,ISSUE_TYPE:"Issue",TIMEOUT_INPUT:250,REFRESH_DEBOUNCE_TIMEOUT:100,FIRST_INDEX:0},l=function(e,t,n){var i;return function(){var s=this,o=arguments,a=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(s,o)},t),a&&e.apply(s,o)}};return e.extend({name:"DS/IssueManagement/components/header/Find",tagName:"div",className:"find-container",_logger:null,domEvents:{"keyup input.find-input":"_onSearch","paste input.find-input":"_onSearch","click div.clear-cont":"_onClear","click div.fonticon-down-open":"_onNext","click div.fonticon-up-open":"_onPrevious","click div.fonticon-select-on":"_onSelect"},list:null,document:null,input:null,value:"",matches:[],advancedSearch:!1,index:-1,clearButton:null,nav:null,next:null,previous:null,select:null,clearTooltip:null,nextTooltip:null,previousTooltip:null,selectTooltip:null,_isSorted:!1,_sortToken:null,_tokens:{subscribe:null,listener:null},setup:function(e){o.start(this.name+" setup"),this._parent(e),this.list=null,this.document=null,this.input=null,this.value="",this.matches=[],this.advancedSearch=!1,this.index=-1,this.clearButton=null,this.navigation=null,this.next=null,this.previous=null,this.select=null,this.clearTooltip=null,this.nextTooltip=null,this.previousTooltip=null,this.selectTooltip=null,this._isSorted=!1,this._sortToken=null,this._tokens={subscribe:null,listener:null};var t=s.get("component");this.list=t.getTreeListView(),this.document=t.getTreeDocument(),this._subscribers(),o.end(this.name+" setup")},render:function(){return o.start(this.name+" render"),this.input=new n({className:"find-input",placeholder:a.actions.find.placeholder}),this.input.inject(this.container),this.clearButton=t.createElement("div",{class:"clear-cont fonticon fonticon-cancel-circled"}).inject(this.container),this.clearTooltip=new i({target:this.clearButton,body:a.actions.find.clear}),this.navigation=t.createElement("div",{class:"nav-cont hidden"}).inject(this.container),this.select=t.createElement("div",{class:"fonticon fonticon-select-on fonticon-1x"}).inject(this.navigation),this.selectTooltip=new i({target:this.select}),this.previous=t.createElement("div",{class:"fonticon fonticon-up-open"}).inject(this.navigation),this.previousTooltip=new i({target:this.previous,position:"bottom"}),this.next=t.createElement("div",{class:"fonticon fonticon-down-open"}).inject(this.navigation),this.nextTooltip=new i({target:this.next,position:"top"}),this.clearButton.setAttribute("style","font-size: 18px !important"),this.previous.setAttribute("style","font-size: 18px !important"),this.next.setAttribute("style","font-size: 18px !important"),this.select.setAttribute("style","font-size: 18px !important"),o.end(this.name+" render"),this},destroy:function(){this.reset(),this.document.getModelEvents().unsubscribe(this._tokens.subscribe),this._tokens.subscribe=null,this.document.removeEventListener("nodeModelUpdate",this._tokens.listener),this._tokens.listener=null,this.list=null,this.document=null,this.input.destroy(),this.input=null,this.value="",this.matches=[],this.advancedSearch=!1,this.index=-1,this.clearButton.destroy(),this.clearButton=null,this.navigation.destroy(),this.navigation=null,this.next.destroy(),this.next=null,this.previous.destroy(),this.previous=null,this.select.destroy(),this.select=null,this.clearTooltip.destroy(),this.clearTooltip=null,this.nextTooltip.destroy(),this.nextTooltip=null,this.previousTooltip.destroy(),this.previousTooltip=null,this.selectTooltip.destroy(),this.selectTooltip=null,this._isSorted=!1,this._sortToken=null,this.container.destroy()},find:l(function(e){if(null===this.document)return[];o.start(this.name+" find"),this.clear(),this.matches=[],this.value=e;var t,n=[],i=e.split(";");t=i.length>1;for(var s=0;s<i.length;s++){var a=i[s];if(0!==(a=a.trim()).length){var l=a.split(":"),c=null,d=null,u=a.indexOf(":");c=(c=a.substring(u+1,a.length)).trim();var m=this.list.getManager().getColumns();if(c.length>0)for(var p=0;p<m.length;p++){var h=m[p];if(h.text&&h.text.toLowerCase().valueOf()===l[r.FIRST_INDEX].toLowerCase().valueOf()){d="tree"===h.dataIndex?"ds6w:title":h.dataIndex;break}}if(n=null!==d?this.search({attribute:d,value:c}):this.search({value:a}),!0===t){if(0===n.length)return[];0===this.matches.length&&(this.matches=this.matches.concat(n))}else this.matches=this.matches.concat(n)}}if(!0===t){var g=[];g=g.concat(this.matches),this.matches=g.filter(function(e){return e._isMatchingSearch}),this.matches.sort(function(e,t){return e._getNodeInfos().virtualRowID-t._getNodeInfos().virtualRowID})}return this.list.getManager().prepareUpdateView(),this.list.getManager().pushUpdateView(!0),this.index=0,this.navigate(-1),o.end(this.name+" find"),this.matches},r.TIMEOUT_INPUT),search:function(e){var t=this;o.start(t.name+" search");var n=e.value,i=!1,s=[];e.hasOwnProperty("attribute")?(s.push(e.attribute),i=!0):t.list.getManager().getColumns().forEach(function(e){"tree"===e.dataIndex?s.push("ds6w:title"):s.push(e.dataIndex)});var a=!1;t.matches.length>0&&(a=!0);var l=n,c=(l=l.replace(/[-[\]{}()*+?\\^$]/g,"\\$&")).concat("|",n),d=null;try{d=new RegExp(c,"i")}catch(e){d=new RegExp(l,"i")}var u,m=!1;return o.start(t.name+" search match"),u=t.document.search({match:function(e){var o=e.nodeModel.options.baseType===r.ISSUE_TYPE;if(!o&&!0!==e.nodeModel.isVisible())return!1;var l=o?e.nodeModel.isMatchingSearch():e.nodeModel.getParent().isMatchingSearch();if(a&&!l||!a&&l)return!1;if(!i&&(n&&d.test(e.nodeModel.options.title)||n&&d.test(e.nodeModel.options.name)))return!1===o?(t.matches.push(e.nodeModel.getParent()),e.nodeModel.getParent()._isMatchingSearch=!0,!1):(e.nodeModel._isMatchingSearch=!0,!0);for(var c=0;c<s.length;c++){var u=s[c];if(e.nodeModel.options.grid.hasOwnProperty(u)){var m=e.nodeModel.options.grid[u];if(m&&d.test(m))return!1===o?(t.matches.push(e.nodeModel.getParent()),e.nodeModel.getParent()._isMatchingSearch=!0,!1):(e.nodeModel._isMatchingSearch=!0,!0)}}return!0===a&&(e.nodeModel._isMatchingSearch=!1),!1},shouldStop:function(){return t.value!==t.input.getValue()&&(t.clear(),m=!0),m}}),o.end(t.name+" search match"),o.end(t.name+" search"),!0===m?[]:u},clear:function(){var e=this;null!==e.document&&(o.start(e.name+" clear"),e.matches.length>0&&(e.document.withTransactionUpdate(function(){for(var t=0;t<e.matches.length;t++)e.matches[t].unmatchSearch(),e.matches[t].unmatchSearchNavigation()}),e.list.getManager().prepareUpdateView(),e.list.getManager().pushUpdateView(!0)),o.end(e.name+" clear"))},focus:function(){var e=this;if(e.input){e.input.focus();var t=function(){setTimeout(function(){e.input&&""===e.input.getValue().trim()&&(e.input.elements.container.removeEventListener("focusout",t),setTimeout(function(){e._onClose()},r.TIMEOUT_FOR_LOST_FOCUS))},r.ANIMATION_TIME/10)};e.input.elements.container.addEventListener("focusout",t)}},navigate:function(e){var t=this;if(o.start(t.name+" navigate"),t.matches.length>=1?t.navigation.hasClassName("hidden")&&t.navigation.removeClassName("hidden"):t.navigation.hasClassName("hidden")||(t.navigation.addClassName("hidden"),t.index=0),e>=0){t.matches[e].unmatchSearchNavigation();var n=t.matches[e]._getNodeInfos().virtualRowID;void 0!==t.list.getManager().getCell(n,"tree").getView()&&t.list.getManager().updateCellView(t.matches[e],"tree")}if(!0===t._isSorted&&(t._isSorted=!1,t.index=0,t.matches.sort(function(e,t){return e._getNodeInfos().virtualRowID-t._getNodeInfos().virtualRowID})),t.matches.length>0){t.matches[t.index].matchSearchNavigation();var i=t.matches[t.index]._getNodeInfos().virtualRowID;void 0!==t.list.getManager().getCell(i,"tree").getView()&&t.list.getManager().updateCellView(t.matches[t.index],"tree"),t.list.getManager().isNodeInVisibleViewport(t.matches[t.index])||t.list.getManager().scrollToNode(t.matches[t.index],"middle",!0),t.nextTooltip.setBody(a.replace(a.actions.find.next,{number1:t.index+1,number2:t.matches.length})),t.previousTooltip.setBody(a.replace(a.actions.find.previous,{number1:t.index+1,number2:t.matches.length})),t.selectTooltip.setBody(a.replace(a.actions.find.select,{number:t.matches.length})),null===t._sortToken&&(t._sortToken=t.list.getManager()._modelEvents.subscribe({event:"sort"},function(){t._isSorted=!0,t.list.getManager()._modelEvents.subscribeOnce({event:"UPDATE_VIEW_COMPLETED"},function(){t.navigate(t.index)})}))}o.end(t.name+" navigate")},reset:function(){this.index=-1,this.navigation.addClassName("hidden"),null!==this._sortToken&&(this.list.getManager()._modelEvents.unsubscribe(this._sortToken),this._sortToken=null),this.clear(),this.input.setValue(""),this.value=""},_onSearch:function(e){if(e.keyCode!==r.ESCAPE_KEY||document.activeElement!==e.target||e.target!==this.input.elements.container){if(e.keyCode===r.ENTER_KEY&&this.matches.length>1)e.shiftKey?this._onPrevious():this._onNext();else if("ShiftLeft"!==e.code&&"ShiftRight"!==e.code){var t=this.input.getValue();if(""===t&&"paste"===e.type&&(t=e.clipboardData.getData("text")),""===t)this.reset();else if(this.find(t),13===e.keyCode&&"do a barrel roll"===t){var n=s.get("widget")||window.widget;n.body.addClassName("do-a-barrel-roll"),setTimeout(function(){n.body.removeClassName("do-a-barrel-roll")},4200)}}}else this._onClose()},_onClear:function(){this.clear(),this.input.setValue(""),this.value="",this.input.focus()},_onClose:function(){var e=this;require(["DS/IssueManagement/commands/CommandsManager"],function(t){e._onClear(),t.getCommandCheckHeader("Find").setState(!1,!1)})},_onNext:function(){var e=this.index;this.index===this.matches.length-1?this.index=0:this.index++,this.navigate(e)},_onPrevious:function(){var e=this.index;0===this.index?this.index=this.matches.length-1:this.index--,this.navigate(e)},_onSelect:function(){var e=this;e.document.prepareBroadcastSelect(),e.document.withTransactionUpdate(function(){e.document.unselectAll(),e.matches.forEach(function(e){e.select()}),e.document.pushBroadcastSelect()})},_subscribers:function(){var e=this,t=l(function(){e.navigation&&(e.matches=[],e.index=-1,e.navigation.addClassName("hidden"),e._onSearch({}))},r.REFRESH_DEBOUNCE_TIMEOUT),n=l(function(){e.navigation&&(e.clear(),e.matches=[],e.index=-1,e.navigation.addClassName("hidden"),e._onSearch({}))},r.REFRESH_DEBOUNCE_TIMEOUT);e._tokens.subscribe=e.document.getModelEvents().subscribe({event:"setPathTags"},t),e._tokens.listener=e.document.addEventListener("nodeModelUpdate",n)}})}),define("DS/IssueManagement/views/facets/Properties",["UWA/Class/Promise","UWA/Core","UWA/Class/View","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/models/EditPropModel","DS/PADUtils/views/PADAlert","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","css!DS/IssueCommon/IssueCommon.css"],function(e,t,n,i,s,o,a,r,l,c,d){"use strict";return n.extend({name:"DS/IssueCommon/views/PropertiesView",tag:"div",className:"properties-view fade-in-element",defaultOptions:{physicalIds:[]},properties:{component:"",selection:[],promises:[]},_timestampUpdate:0,_subscriberTokens:[],_subscriberId:"",_eventListeners:[],setup:function(e){c.start(this.name+" setup"),this._parent(e),this.properties={component:null,selection:[],promises:[]},this._timestampUpdate=0,this._subscriberTokens=[];var t={getSecurityContext:function(){return{SecurityContext:"ctx::"+decodeURIComponent(l.getSecurityContext())}}};this.properties.component=new s({setEditButton:!0,readOnly:!1,warningOnUnsaved:!1,selectionType:i.NO_SELECTION,typeOfDisplay:i.ONLY_EDIT_PROPERTIES,context:t,events:{onNotification:function(e){a.displayNotification({msg:e.msg,eventID:"error"})}}}),this._subscribers(),c.end(this.name+" setup")},render:function(){return c.start(this.name+" render"),this.properties.component.inject(this.container),this.refresh(this.getOption("physicalIds")),c.end(this.name+" render"),this},refresh:function(t){var n=this;n.setOption("physicalIds",t),n.properties.selection.forEach(function(e){e.destroy()}),n.properties.selection=[],n.properties.promises=[],t.forEach(function(t){var i=new o({metatype:"businessobject",tenant:l.getTenant(),objectId:t});i.addEvent("onChangeAttributes",function(e,t){if(e.changedValues&&(e.changedValues.hasOwnProperty("Estimated Start Date")||e.changedValues.hasOwnProperty("Resolution Date"))){var n=e._attributes["Estimated Start Date"].valueDB,i=new Date(n),s=e._attributes["Resolution Date"].valueDB;if(i>new Date(s)){var o=d.getErrorMessage("12");d.displayErrorMessage(o,"error"),t.forEach(function(t){"Estimated Start Date"==t.name?e._attributes["Estimated Start Date"].resetInitialValues():"Resolution Date"==t.name&&e._attributes["Resolution Date"].resetInitialValues()})}}}),n.properties.promises.push(new e(function(e){i.listenToOnce(i,"onSave",function(){e(this)})})),n.properties.selection.push(i)}),n.properties.component.initDatas(n.properties.selection),e.all(n.properties.promises).then(function(e){n._onSave(e)});return(n.properties.component.getListModel().length,e.resolve()).then(function(){n.dispatchEvent("onReady",{})})},destroy:function(){this._subscriberTokens.forEach(function(e){r.get("eventsHandler").unsubscribe(e)}),this._subscriberTokens=[],this._timestampUpdate=0;try{this.properties.selection.forEach(function(e){e.destroy()})}catch(e){}try{this.properties.component.destroyComponent()}catch(e){}this.properties={component:null,selection:[],promises:[]},this.container.empty()},_onSave:function(t){var n=this;if(c.start(n.name+" _onSave"),n.properties.promises=[],n.properties.selection.forEach(function(t){n.properties.promises.push(new e(function(e){t.listenToOnce(t,"onSave",function(){e(this)})}))}),0!==n.properties.promises.length){e.all(n.properties.promises).then(function(e){n._onSave(e)});for(var i=[],s={},o=0;o<t.length;o++){var a=t[o].get("objectId");i.push([a]),s[a]={id:a,type:t[o].get("type").value,name:t[o].get("name").value,title:t[o].get("Title").value,modifiedAttributes:["*"]}}r.get("eventsHandler").publish(n._subscriberId,"DS/Object/update",{metadata:{appId:r.get("widget").id,appName:r.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:i,attributes:s},version:"1.0"}),c.end(n.name+" _onSave")}},_subscribers:function(){var e=this,t=r.get("eventsHandler");e._subscriberId=Math.random().toString(36).substr(2,9),e._eventListeners=[{event:"DS/Object/update",listener:function(t){c.start(e.name+" DS/Object/update");var n=e.properties.selection.reduce(function(e,t){return e.push(t.get("objectId")),e},[]);t.data.paths.reduce(function(e,t){return e.push(t.pop()),e},[]).filter(function(e){return n.includes(e)}).length>0&&(e.properties.promises=[]),c.end(e.name+" DS/Object/update")},conditions:{type:"issue"}}];for(var n=0;n<e._eventListeners.length;n++){var i=e._eventListeners[n];i.token=t.subscribe(e._subscriberId,i.event,i.listener.bind(e),i.conditions)}}})}),define("DS/IssueManagement/commands/Detach",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{dialog:null,execute:function(){var e=this;require(["UWA/Core","UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement","DS/IssueManagement/commands/CommandsManager"],function(t,n,i,s,o,a,r,l,c,d){var u=l.get("widget")||window.widget;if(!u.body.getElement(".detach-objects-issue-dialog")){for(var m=l.get("component"),p=m.getSelectedNodes(),h={},g=[],f=0;f<p.length;f++){var v=p[f].options.id,b=p[f].options.data.issue,I=p[f].options.data.relationToIssue;g.push(p[f].options.title+" ("+p[f].options.name+")"),void 0===h[b]&&(h[b]={physicalId:b}),void 0===h[b][I]&&(h[b][I]=[]),h[b][I].push({physicalId:v})}new n(function(n,s){var r=[];g.forEach(function(e){r.push(t.createElement("li",{html:e,title:e}))});var l=t.createElement("div",{html:[c.related.confirmDetach,t.createElement("ul",{class:"detach-objects-issue-dialog-ul",html:r})]}),d=null,m=e.dialog=new a({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"detach-objects-issue-dialog",title:c.replace(c.related.dialogTitle,{number:p.length,issues:Object.keys(h).length}),header:null,body:l,footer:[d=new i({value:c.related.detach,className:"primary detach-objects-issue-dialog-add",events:{onClick:function(){m.destroy(),e.dialog=null,n()}}}),new i({value:c.related.cancel,className:"default detach-objects-issue-dialog-cancel",events:{onClick:function(){m.destroy(),e.dialog=null,s(new Error("The dialog has been closed by the end user"))}}})],events:{onClose:function(){m.destroy(),e.dialog=null,s(new Error("The dialog has been closed by the end user"))}}}).inject(u.body);new o({element:l}).inject(m.getBody()),m.show(),d.focus()}).then(function(){s.mask(u.body),m.getTreeDocument().removeContextsOrReportedAgainstOrResolvedByOrResolvedItems(h).then(function(){s.unmask(u.body),r.displayNotification({msg:c.notifications.detachSuccess,eventID:"success"}),d.enable(["Export"])},function(){s.unmask(u.body)})})}})}})}),define("DS/IssueManagement/utils/BIFilter",["UWA/Class","UWA/Class/Promise","UWA/Core","DS/Logger/Logger","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a){"use strict";var r="IN";return e.extend({name:"DS/IssueManagement/utils/BIFilter",_loggerBIFilter:null,_biFilter:null,_isBIFilterInitialized:!1,_initializationPromiseBIFilter:null,_isBIFilterActivated:!1,_isBIFilterSelected:!1,_persistence:{filter:!1,dialog:null},initializeBIFilter:function(){var e=s.get("widget")||window.widget;o.start(this.name+" initializeBI"),this._loggerBIFilter=i.getLogger("DS/IssueManagement/View"),e.addEvent("endEdit",this._onModifyPreferences.bind(this)),this.document.addEventListener("setPathTags",this._onSetPathTags.bind(this)),this._initializationPromiseBIFilter=this._createBIFilterProxy(),this._isBIFilterActivated=!0===this.utils.isActivateBIFilter(),this.listView=s.get("ISU_LISTVIEW"),o.end(this.name+" initializeBI")},focusOnSubjects:function(e){var t=this._biFilter;if(t&&t._biFilter){if(0===e.length)return void t._biFilter.unfocus();for(var n={},i=[],s=0;s<e.length;s++)n[e[s].options.physicalId]="3DSpace",i.push("pid://"+e[s].options.physicalId);t._biFilter.myTagProxy.focusOnSubjects(i,!0,n)}},_onSetPathTags:function(e){var t=this,n=s.get("widget")||window.widget;!1!==t._isBIFilterInitialized?(t._loggerBIFilter.info("Setting the path tags for %s %s",n.name,n.id),!0===t.utils.isActivateBIFilter()&&setTimeout(function(){o.start(t.name+" _onSetPathTags");var n={nodes:[],paths:[]},i={};t.document.getRoots().forEach(function(e){if(!e.isHidden()){var t=e.getPath().map(function(e){var t=e.options.id;return i.hasOwnProperty(t)||(n.nodes.push(t),i[t]=n.nodes.length-1),i[t]});n.paths.push(t)}}),null==e.data&&(e.data=!1),t._isBIFilterSelected&&!e.data||t._cleanBIFilterProxy(),t._biFilter.setTagsWithFetchSynthesis(n.nodes,function(){s.get("widget").dispatchEvent("onSetPathTags")}),o.end(t.name+" _onSetPathTags")},0)):t._initializationPromiseBIFilter.then(function(){t._onSetPathTags(e)})},setLocalPathTags:function(){null!==this._persistence.dialog&&this._persistence.dialog.destroy();var e=s.get("widget").getValue("pathTags");this._persistence.filter&&n.is(e,"object")&&this._biFilter._biFilter.myTagProxy.setLocalFilter(e)},loadBIFilterPreference:function(){var e=this,t=s.get("widget")||window.widget,i=t.getValue("pathTags");e.utils.isActivateBIFilter()&&n.is(i,"object")&&(e._persistence.filter=!0,require(["DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/ENOFloatingPanel/ENOFloatingPanel"],function(n,i,s){e._persistence.dialog=new s({animate:!0,autocenter:!0,closable:!1,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"tagger-issues-dialog",title:a.tagger.waiting.title,header:null,body:null,footer:[new n({value:a.tagger.cancel,className:"primary",events:{onClick:function(){e._persistence.filter=!1,e._persistence.dialog.destroy(),e._persistence.dialog=null,t.deleteValue("pathTags")}}})]}).inject(t.body),i.mask(e._persistence.dialog.getBody(),a.tagger.waiting.label)}))},_createBIFilterProxy:function(){var e=this;o.start(e.name+" _createBIFilterProxy");var n=s.get("widget")||window.widget;return new t(function(t,i){require(["DS/ENOFilterBIUX/FilterBIComponentProxy","DS/IssueServices/services/PlatformServices"],function(s,a){var r={tenant:a.getTenant(),processingMode:"appProcessing",colorize:!0,widgetId:n.id};try{e._biFilter=new s(r),e._biFilter.addEvent("fetchFilterBIColorizeEvent",e._onFilterBIColorize,e),e._biFilter.addEvent("FilterBIUnColorize",e._onFilterBIUnColorize,e),e._biFilter.addEvent("fetchFilterBIFilteringEvent",e._onFilterBIFilteringEvent,e)}catch(e){i(new Error("The BIFilter proxy could not be initialized: "+e))}e._isBIFilterInitialized=!0,t(),o.start(e.name+" _createBIFilterProxy")})})},_cleanBIFilterProxy:function(){o.start(this.name+" cleanProxy"),this._biFilter&&this._biFilter.cleanProxy&&this._biFilter.cleanProxy(),o.end(this.name+" cleanProxy")},_onModifyPreferences:function(){var e=this;!1!==e._isBIFilterInitialized?(o.start(e.name+" _onModifyPreferences"),!0===e.utils.isActivateBIFilter()&&!1===e._isBIFilterActivated?(e._isBIFilterActivated=!0,!1===e._isBIFilterInitialized?e._initializationPromiseBIFilter=e._createBIFilterProxy():(e._biFilter.addEvent("fetchFilterBIColorizeEvent",e._onFilterBIColorize,e),e._biFilter.addEvent("FilterBIUnColorize",e._onFilterBIUnColorize,e),e._biFilter.addEvent("fetchFilterBIFilteringEvent",e._onFilterBIFilteringEvent,e),e._onSetPathTags())):!0===e._isBIFilterInitialized&&!1===e.utils.isActivateBIFilter()&&(e._isBIFilterActivated=!1,e._cleanBIFilterProxy(),e._biFilter.setPathTags({nodes:[],paths:[]}),e._biFilter.removeEvent("fetchFilterBIColorizeEvent",e._onFilterBIColorize,e),e._biFilter.removeEvent("FilterBIUnColorize",e._onFilterBIUnColorize,e),e._biFilter.removeEvent("fetchFilterBIFilteringEvent",e._onFilterBIFilteringEvent,e)),o.end(e.name+" _onModifyPreferences")):e._initializationPromiseBIFilter.then(function(){e._onSetPathTags()})},_onFilterBIColorize:function(e){var t=this;o.start(t.name+" _onFilterBIColorize"),t.listView&&!0===t.document.getComponent().getTreeListView().getManager().isColumnHidden("biColor")&&t.document.getComponent().getTreeListView().getManager().showColumn("biColor"),t.document.withTransactionUpdate(function(){for(var i,s,a=t.document.getRoots(!1),r=0;r<a.length;r++){var l={grid:{biColor:"rgba(0, 0, 0, 0)"}};a[r].updateOptions(l);for(var c=a[r].getAllDescendants(),d=0;d<c.length;d++)c[d].updateOptions(l)}i=e,s=function(e,n){t.document.getNodesById(n).forEach(function(t){var n={grid:{biColor:e},color:e};t.updateOptions(n)})},n.is(i,"array")?i.forEach(function(e){var t=e.color,n=e.id;s(t,n)}):t._loggerBIFilter.error("Invalid Argument : %o",e),o.end(t.name+" _onFilterBIColorize")})},_onFilterBIUnColorize:function(){var e=this;e.document.withTransactionUpdate(function(){for(var t=e.document.getRoots(!1),n=0;n<t.length;n++){var i={grid:{biColor:"rgba(0, 0, 0, 0)"},color:"rgba(0, 0, 0, 0)"};t[n].updateOptions(i);for(var s=t[n].getAllDescendants(),o=0;o<s.length;o++)s[o].updateOptions(i)}}),!0!==e.document.getComponent().getTreeListView().getManager().isColumnHidden("biColor")&&e.document.getComponent().getTreeListView().getManager().hideColumn("biColor")},_onFilterBIFilteringEvent:function(e){var t=this;t.document.withTransactionUpdate(function(){var i=t.document.getRoots(!0).slice(0);i.forEach(function(e){e.filterIn(!0)});var o=e.matchingIDs;if(o&&Array.isArray(o)){o.forEach(function(e){t.document.getNodesById(e).forEach(function(e){e._filterStatus=r,e.getParents().forEach(function(e){e._filterStatus=r})})});i.forEach(function(e){var t,n;(t=e)._filterStatus===r||(t.filterOut(),n&&n.push(t)),delete t._filterStatus}),i.length!=o.length||Object.keys(e.allfilters).length>0?t._isBIFilterSelected=!0:t._isBIFilterSelected=!1}else t._loggerBIFilter.error("The filtering argument is invalid: %o",e);t.dispatchEvent("setPathTags",{});var a=s.get("widget")||window.widget;e&&n.is(e.localfilters,"object")&&Object.keys(e.localfilters).length>0?a.setValue("pathTags",e.localfilters):a.deleteValue("pathTags")})},utils:{isActivateBIFilter:function(){var e=s.get("widget")||window.widget,t=!1;if(n.is(e.getPreference("activateBIFilter"),"object")){var i=e.getValue("activateBIFilter");t=n.is(i,"boolean")?i:"true"===i}return t}}})}),define("DS/IssueManagement/components/idcard/IssueMaturity",["UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/LifecycleCmd/MaturityCmd","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/UploadDialog","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Attachments","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/ChangeMaturityWidget/ChangeMaturityWidget"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v){var b={enableMaturityActions:!1,STATES_VALUES:["Create","Assign","Active","Review","Closed"],CSS:{ELEMENTS:{GRAPH_STATE_APPROVE:"fonticon fonticon-thumbs-up im-lifecycle-new graph-state-approve",GRAPH_STATE_REJECT:"fonticon fonticon-thumbs-down im-lifecycle-new graph-state-reject",GRAPH_STATE_INPROGRESS:"fonticon-hourglass wux-ui-3ds im-lifecycle-new graph-state-inprogress",GRAPH_HISTORY_APPROVED:"fonticon fonticon-check im-lifecycle-new graph-history-approved ",GRAPH_HISTORY_REJECTED:"fonticon fonticon-wrong im-lifecycle-new graph-history-rejected",GRAPH_HISTORY_MORE:"fonticon fonticon-menu-dot im-lifecycle-new graph-history-more",GRAPH_HISTORY_TOOLTIP:"im-lifecycle-graph-history-tooltip",GRAPH_HISTORY_TOOLTIP_TITLE:"im-lifecycle-graph-history-tooltip-title",STATE_APPROVE_MODAL:"im-lifecycle-approve-modal",STATE_APPROVE_MODAL_HEIGHT:490,STATE_APPROVE_MODAL_WIDTH:510,STATE_APPROVE_MODAL_BODY:"im-lifecycle-approve-modal-body",STATE_APPROVE_MODAL_REASON:"im-lifecycle-approve-modal-reason",STATE_APPROVE_MODAL_ATTACHMENTS:"im-lifecycle-approve-modal-attachments",STATE_NEXT:"double-chevron-right wux-ui-3ds issue-maturity-next-state",STATE_PREV:"double-chevron-left wux-ui-3ds issue-maturity-prev-state",STATE_MATURITY:"collaborative-lifecycle-management wux-ui-3ds issue-maturity-state"}}};return UWA.Class.extend({init:function(e){this.bos=UWA.is(e.bos)?e.bos:[],this.showRoute=!UWA.is(e.showRoute)||e.showRoute,this.modelEvents=e.modelEvents,this.maturityCmd=new r},buildMaturityView:function(e){var t=this;return t.targetDivs=[],e.targetDivs.forEach(e=>{e.empty();let n=UWA.createElement("div",{class:"issue-maturity-div"}),i=UWA.createElement("div",{class:"issue-maturity-history-div"});i.inject(n);let s=UWA.createElement("div",{class:"issue-maturity-cmd-div"});s.inject(n);let o=UWA.createElement("div",{class:"issue-maturity-actions-div"});o.inject(n);let a=UWA.createElement("div",{class:"issue-maturity-route-div"});a.inject(n),n.inject(e),t.targetDivs.push({element:e,maturityCmdDiv:s,maturityDiv:n,maturityActionDiv:o,maturityHistoryDiv:i,maturityRouteDiv:a})}),t},refresh:function(e){var t=this;t.bos=UWA.is(e)&&UWA.is(e.bos)?e.bos:t.bos;let n=[];if(t.targetDivs.forEach(e=>{e.maturityCmdDiv.empty(),e.maturityActionDiv.empty(),e.maturityHistoryDiv.empty(),e.maturityRouteDiv.empty(),n.push(e.element)}),1==t.bos.length){let e=t.bos[0].physicalId;b.enableMaturityActions?t._renderMultiSelectRoute():t.targetDivs.forEach(n=>{t.maturityCmd.executeCompactViewAsync(widget,n.maturityCmdDiv,{SecurityContext:decodeURIComponent(d.getSecurityContext())},e).then(e=>{console.log(e),t.modelEvents.publish({event:"issue-idcard-maturity-update",data:{result:e}}),t.refresh()})})}t.showRoute&&t._issueRouteManagement(t.bos,n).then(e=>{console.log(e.renderStatus),"Diff"==e.renderStatus&&t.bos.length>1&&t.targetDivs.forEach(e=>{e.maturityCmdDiv.innerHTML=v.lifecycle.varies,e.maturityCmdDiv.title=v.lifecycle.notSupported})}).catch(e=>{console.log(e)})},_issueRouteManagement:function(t,n){var i,s=this,o=new e(e=>{i=e});return c.routes.retrieve({data:{objects:t.map(function(e){return{physicalId:e.physicalId}})}}).then(function(e){if(s.routes=e.results.map(function(e){return e.body}),t.length!=e.results.length)return void i({renderStatus:"No"});if(!s.routes.every(function(e){return e.state===s.routes[0].state}))return void i({renderStatus:"Diff"});let o=UWA.is(s.routes[0].current,"object")&&UWA.is(s.routes[0].current.from,"string");s.routes.every(function(e){return(UWA.is(e.current,"object")&&UWA.is(e.current.from,"string"))===o})?(s._renderRouteActions(),1==t.length?(s._renderRoutesHistory(s.route,n),i({renderStatus:"OK"})):(s._renderMultiSelectRoute(),i({renderStatus:"Multi"}))):i({renderStatus:"Diff"})}).catch(e=>{console.log(e)}),o},_renderRouteActions:function(){var e=this;let t=e.targetDivs.map(e=>e.element),n=e.route=e.routes[0],i=n.state;var s=d.getUserName();if(n.current&&n.current.basepurpose&&"standard"===n.current.basepurpose.toLowerCase())n.current&&n.current.from===i&&(c.routes.retrieveTasks({data:{objects:[{physicalId:n.physicalId}]}}).then(function(n){n.results[0].body.tasks.length>0?e._renderApproveRejectButtons(e.routes,t):e._renderInProgressIndicator(e.routes,t)}).catch(e=>{console.log(e)}),t.forEach(e=>{e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-chng")}));else if(n.current&&n.current.from===i){var o=e.routes.every(function(e){return-1!==e.current.reviewers.map(function(e){return e.user}).indexOf(s)}),a=e.bos.every(function(e){return-1!==e.owners.map(function(e){return e.user}).indexOf(s)});if(o)e.routes.some(function(e){return-1===e.current.decisions.filter(function(e){return"approved"===e.status||"rejected"===e.status}).map(function(e){return e.reviewer.user}).indexOf(s)})?e._renderApproveRejectButtons(e.routes,t):e._renderInProgressIndicator(e.routes,t);else e._renderInProgressIndicator(e.routes,t);o||a||t.forEach(e=>{e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-chng"),e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-action")})}else{let n=e.bos.every(function(e){return-1!==e.owners.map(function(e){return e.user}).indexOf(s)}),i=e.bos.every(function(e){return-1!==e.assignees.map(function(e){return e.user}).indexOf(s)});n||i||t.forEach(e=>{e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-chng"),e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-action")})}},_renderApproveRejectButtons:function(e,t){var n=this;t.forEach(e=>{let t=e.getElement(".issue-maturity-route-div");t.empty();let s=UWA.createElement("span",{class:b.CSS.ELEMENTS.GRAPH_STATE_APPROVE}),o=UWA.createElement("span",{class:b.CSS.ELEMENTS.GRAPH_STATE_REJECT});new i({position:"left",target:s,body:v.lifecycle.approveModal.okButton}),new i({position:"left",target:o,body:v.lifecycle.rejectModal.okButton}),s.inject(t),o.inject(t),s.addEventListener("click",n._onClickApprove.bind(n)),o.addEventListener("click",n._onClickReject.bind(n))})},_renderInProgressIndicator:function(e,t){var n=this;let s,o=e[0],a=o.current.reviewers;if(e.length>1)s="<span>"+v.lifecycle.routeIndicatorTooltip.inProgressTooltip.multiSelectionTitle+"</span>";else if(1===e.length){let e=o.current.decisions.filter(function(e){return"approved"===e.status||"rejected"===e.status}).map(function(e){return e.reviewer.user}),t=a.filter(function(t){return-1===e.indexOf(t.user)}),n=o.current.decisions.filter(function(e){return"approved"===e.status});if(s=UWA.createElement("div",{class:b.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP}),t.length>0){let e=UWA.createElement("div",{html:'<span class="'+b.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+v.lifecycle.routeIndicatorTooltip.inProgressTooltip.title+"</span>"});t.forEach(function(t){UWA.createElement("span",{html:"<span>"+t.fullName+"</span>"}).inject(e)}),e.inject(s)}if(n.length>0){let e=UWA.createElement("div",{html:'<span class="'+b.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+v.lifecycle.routeIndicatorTooltip.approvalTitle+"</span>"});n.forEach(function(t){let n=v.replace(v.lifecycle.routeIndicatorTooltip.approvalText,{name:t.reviewer.fullName,date:new Date(t.date).toLocaleString(l.get("widget").lang)});UWA.createElement("span",{html:"<span>"+n+"</span>"}).inject(e)}),e.inject(s)}}t.forEach(e=>{let t=e.getElement(".issue-maturity-route-div");t.empty();let o=UWA.createElement("span",{class:b.CSS.ELEMENTS.GRAPH_STATE_INPROGRESS});new i({position:"bottom",target:o,body:s}),o.inject(t),o.addEventListener("click",n._onClickInProgress.bind(n))})},_renderRoutesHistory:function(e,t){var n=this;if(Array.isArray(e.history)&&e.history.length>0){let s=e.state,o=e.history.filter(e=>s==e.rejectTo||s==e.from);o.length>0&&t.forEach(e=>{let t=e.getElement(".issue-maturity-history-div");t.empty();let s="approved"===o[o.length-1].status?b.CSS.ELEMENTS.GRAPH_HISTORY_APPROVED:b.CSS.ELEMENTS.GRAPH_HISTORY_REJECTED,a=UWA.createElement("span",{class:s});a.inject(t);let r=UWA.createElement("div",{class:b.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP,html:'<span class="'+b.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+v.replace(v.lifecycle.routeIndicatorTooltip.moreTooltip.title,{number:o.length})+"</span>"});o.forEach(e=>{let t=e.date,n="approved"===e.status?"approvalText":"rejectionText";UWA.createElement("div",{html:"<span>"+v.replace(v.lifecycle.routeIndicatorTooltip.moreTooltip[n],{date:new Date(t).toLocaleString(l.get("widget").lang)})+"</span>"}).inject(r)}),new i({position:"bottom",target:a,body:r}),a.addEventListener("click",n._onClickHistory.bind(n))})}},_onClickApprove:function(){var e=this,i=e.route,r=v.maturity[i.current.approveTo.toLowerCase()],l=UWA.createElement("div",{class:b.CSS.ELEMENTS.STATE_APPROVE_MODAL_BODY}),c=UWA.createElement("div",{class:b.CSS.ELEMENTS.STATE_APPROVE_MODAL_REASON});c.inject(l),UWA.createElement("label",{html:v.lifecycle.approveModal.reasonLabel}).inject(c);var u=new n({multiline:!0,rows:4,placeholder:v.lifecycle.approveModal.reasonPlaceholder});u.inject(c),u.getContent().toggleClassName("highlight",""===u.getValue()),u.getContent().addEventListener("keyup",function(){u.getContent().toggleClassName("highlight",""===u.getValue())});var p=UWA.createElement("div",{class:b.CSS.ELEMENTS.STATE_APPROVE_MODAL_ATTACHMENTS});p.inject(l);var h=new f({parent:e,annotateCommand:{enable:!0,addTextbox:!0,getText:function(){var e=null,t=u.getValue();t&&(e=d.getFullName()+"\n"+(new Date).toLocaleString(widget.lang,{})+"\n"+t);return e}},searchAttachmentCommand:{getSearchQuery:function(){return m.getSearchQuery(e.physicalIds)}}});h.render(),h.inject(p),e.approveComponents={},e.approveComponents.attachments=h,e.approveComponents.reasonInput=u;var I={},y=new s({element:l}),w=new o({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:b.CSS.ELEMENTS.STATE_APPROVE_MODAL,header:UWA.createElement("h4",{html:v.replace(v.lifecycle.approveModal.header,{approveTo:r})}),body:y,footer:[I.okButton=new t({value:v.lifecycle.approveModal.okButton,className:"primary",events:{onClick:function(){""!==u.getValue()?(g.Mask.mask(l),I.okButton.elements.container.addClassName("disabled"),I.cancelButton.elements.container.addClassName("disabled"),e._approveRoutes(e.routes,u.getValue(),h).then(function(){w.destroy(),e.approveComponents=null}).catch(function(e){console.log(e);var t=v.lifecycle.error;if(null!=e&&void 0!==e&&null!=e.error&&(t=e.error.message),t.includes("Action Taken and Resolution Statement are not filled in")){I.cancelButton.elements.container.removeClassName("disabled");var n=g.getErrorMessage("5");g.displayErrorMessage(n,"error")}else if(t.includes("Action Taken field is not filled in")){I.cancelButton.elements.container.removeClassName("disabled");n=g.getErrorMessage("6");g.displayErrorMessage(n,"error")}else if(t.includes("Resolution Statement field is not filled in")){I.cancelButton.elements.container.removeClassName("disabled");n=g.getErrorMessage("7");g.displayErrorMessage(n,"error")}else if(t.includes("Resolution Date is not filled in")){I.cancelButton.elements.container.removeClassName("disabled");n=g.getErrorMessage("8");g.displayErrorMessage(n,"error")}else a.displayNotification({msg:t,eventID:"error"});g.Mask.unmask(l)})):a.displayNotification({msg:v.lifecycle.approveModal.reasonRequired,eventID:"warning"})}}}),I.cancelButton=new t({value:v.lifecycle.approveModal.cancelButton,className:"default",events:{onClick:function(){w.destroy(),e.approveComponents=null}}})]});w.inject(widget.body),w.elements.container.setStyle("height",b.CSS.ELEMENTS.STATE_APPROVE_MODAL_HEIGHT),w.elements.container.setStyle("width",b.CSS.ELEMENTS.STATE_APPROVE_MODAL_WIDTH),w.show(),u.focus()},_onClickReject:function(){var e=this,i=e.route,r=v.maturity[i.current.approveTo.toLowerCase()],l=UWA.createElement("div",{class:b.CSS.ELEMENTS.STATE_APPROVE_MODAL_BODY}),c=UWA.createElement("div",{class:b.CSS.ELEMENTS.STATE_APPROVE_MODAL_REASON});c.inject(l),UWA.createElement("label",{html:v.lifecycle.rejectModal.reasonLabel}).inject(c);var u=new n({multiline:!0,rows:4,placeholder:v.lifecycle.rejectModal.reasonPlaceholder});u.inject(c),u.getContent().toggleClassName("highlight",""===u.getValue()),u.getContent().addEventListener("keyup",function(){u.getContent().toggleClassName("highlight",""===u.getValue())});var p=UWA.createElement("div",{class:b.CSS.ELEMENTS.STATE_APPROVE_MODAL_ATTACHMENTS});p.inject(l);var h=new f({parent:e,annotateCommand:{enable:!0,addTextbox:!0,getText:function(){var e=null,t=u.getValue();t&&(e=d.getFullName()+"\n"+(new Date).toLocaleString(widget.lang,{})+"\n"+t);return e}},searchAttachmentCommand:{getSearchQuery:function(){return m.getSearchQuery(e.physicalIds)}}});h.render(),h.inject(p),e.rejectComponents={},e.rejectComponents.attachments=h,e.rejectComponents.reasonInput=u;var I={},y=new s({element:l}),w=new o({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:b.CSS.ELEMENTS.STATE_APPROVE_MODAL,header:UWA.createElement("h4",{html:v.replace(v.lifecycle.rejectModal.header,{approveTo:r})}),body:y,footer:[I.okButton=new t({value:v.lifecycle.rejectModal.okButton,className:"primary",events:{onClick:function(){if(""===u.getValue())return a.displayNotification({msg:v.lifecycle.rejectModal.reasonRequired,eventID:"warning"}),void u.elements.container.addClassName("highlight");g.Mask.mask(l),I.okButton.elements.container.addClassName("disabled"),I.cancelButton.elements.container.addClassName("disabled"),e._rejectRoutes(e.routes,u.getValue(),h).then(function(){w.destroy()}).catch(function(e){console.log(e),a.displayNotification({msg:v.lifecycle.error,eventID:"error"}),g.Mask.unmask(l)})}}}),I.cancelButton=new t({value:v.lifecycle.rejectModal.cancelButton,className:"default",events:{onClick:function(){w.destroy()}}})]});w.inject(widget.body),w.elements.container.setStyle("height",b.CSS.ELEMENTS.STATE_APPROVE_MODAL_HEIGHT),w.elements.container.setStyle("width",b.CSS.ELEMENTS.STATE_APPROVE_MODAL_WIDTH),w.show(),u.focus()},_onClickHistory:function(){this.modelEvents.publish({event:"issue-idcard-maturity-history-click",data:{}})},_onClickInProgress:function(){this.modelEvents.publish({event:"issue-idcard-maturity-history-click",data:{}})},_approveRoutes:function(e,t,n){var i=this,s=e.map(function(e){return e.physicalId});return g.Mask.mask(i.container),i._connectAttachments(s,n).then(function(){return c.routes.approve({data:{objects:e.map(function(e){return{physicalId:e.physicalId,comment:t}})},onFailure:function(e){var t=v.lifecycle.error;null!=e&&void 0!==e&&null!=e.error&&(t=e.error.message),UWA.is(e.error)&&UWA.is(e.error.internal)&&e.error.internal.includes("None of the Resolving Change started")?g.displayErrorMessage(g.getErrorMessage("1500167_1"),"error"):a.displayNotification({msg:t,eventID:"error"})}}).then(function(e){var t=e.results.map(function(e){return{physicalId:e.body.physicalId,task:e.body.task}});i.modelEvents.publish({event:"onApprovalCompleted",data:{issues:t,modifiedAttributes:["attachments"]}})}).catch(e=>{console.log(e)})}).catch(e=>{console.log(e)}).finally(function(){i.refresh()})},_rejectRoutes:function(e,t,n){var i=this,s=e.map(function(e){return e.physicalId});return g.Mask.mask(i.container),i._connectAttachments(s,n).then(function(){return c.routes.reject({data:{objects:e.map(function(e){return{physicalId:e.physicalId,reason:t}})}}).then(function(e){var t=e.results.map(function(e){return{physicalId:e.body.physicalId,task:e.body.task}});i.modelEvents.publish({event:"onRejectionCompleted",data:{issues:t,modifiedAttributes:["attachments"]}})}).catch(e=>{console.log(e)})}).catch(e=>{console.log(e)}).finally(function(){i.refresh()})},_connectAttachments:function(t,n){var i=l.get("widget")||window.widget,s=n.collection,o=s.filter(function(e){return!0===e.get("isFile")}).map(function(e){var t=e.clone();return t.set("isProcessing",!0),t}),r=[];if(o.length>0){var c=new u({id:"uploadAttachmentsToRoutes",attachments:o});new p({container:i.body,collection:c}).render(),r=o.map(function(e){var t=m.uploadFile(e.get("file"),null,{onCheckinStart:function(e){this.set("isCancelable",!0),this.set("request",e)}.bind(e),onCheckinProgress:function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.set("requestProgress",t)}}.bind(e),onCheckinComplete:function(){this.set("isCancelable",!1),this.set("request",null)}.bind(e)});return t=t.then(function(t){t&&t.data&&t.data.length>0&&t.data[0].id&&(s.get(e.id).set("isFile",!1),s.get(e.id).set("id",t.data[0].id),e.set("id",t.data[0].id),e.set("isFile",!1),e.set("isProcessing",!1))}).catch(function(t){e.set("isFailed",!0),e.set("isProcessing",!1),e.set("isCancelable",!1),e.set("request",null),t instanceof Error&&a.displayNotification({msg:h.replace(h.notifications.Upload.failure,{count:1}),eventID:"error"})})})}return e.all(r).then(function(){var n=s.filter(function(e){return!0!==e.get("isFile")}).map(function(e){return e.clone()}),i=[];return n.length>0&&t.forEach(function(e){var t=n.map(function(e){return e.id});i.push(m.connectDocumentsToParent(t,e).catch(function(e){a.displayNotification({msg:h.replace(h.notifications.Attach.failure,{count:1}),eventID:"error"})}))}),e.all(i)}).then(function(){var n=[],i=s.filter(function(e){return!0===e.get("isPrimary")});if(1===i.length){var o=i[0];return t.forEach(function(e){n.push(m.setAsPrimary(o.get("id"),e,!0).then(function(){}).catch(function(e){a.displayNotification({msg:h.notifications.SetAsPrimary.failure,eventID:"error"})}))}),e.all(n)}return e.resolve()}).catch(e=>{console.log(e)})},_renderMultiSelectRoute:function(){var e=this;let n=e.bos[0].physicalId,i=b.STATES_VALUES.indexOf(e.bos[0].state);e.targetDivs.forEach(t=>{t.maturityDiv.addClassName("no-state-chng"),t.maturityDiv.addClassName("no-state-action"),e.maturityCmd.executeCompactViewAsync(widget,t.maturityCmdDiv,{SecurityContext:decodeURIComponent(d.getSecurityContext())},n).then(t=>{console.log(t),e.refresh()})}),e.targetDivs.forEach(n=>{let s=n.maturityActionDiv,o=[];i!=b.STATES_VALUES.length-1&&o.push({name:"NextState",fonticon:b.CSS.ELEMENTS.STATE_NEXT,text:v.lifecycle.goToNextState,selected:!1}),0!=i&&o.push({name:"PreviousState",fonticon:b.CSS.ELEMENTS.STATE_PREV,text:v.lifecycle.goToPrevState,selected:!1}),o.push({name:"maturity",fonticon:b.CSS.ELEMENTS.STATE_MATURITY,text:v.resolveIssues.state,selected:!1}),new t({className:"route-action",icon:"chevron-down",dropdown:{items:o},events:{onDropdownClick:function(t,n){"NextState"==n.name&&e._onPromote(),"PreviousState"==n.name&&e._onDemote(),"maturity"==n.name&&e.maturityCmd.execute(e.bos,function(){e.modelEvents.publish({event:"refresh-issue-header",data:{}})})}}}).inject(s)})},_onPromote:function(){var e=this;let t=b.STATES_VALUES.indexOf(e.bos[0].state);if(t==b.STATES_VALUES.length-1)return;let n=b.STATES_VALUES[t+1],i=e.bos.map(e=>({physicalId:e.physicalId,state:n}));c.issues.promote({data:{objects:i}}).then(function(t){let n=t.results;n.forEach(t=>{let n=t.body.physicalId;e.bos.forEach(e=>{e.physicalId==n&&(e.state=t.body.state)})}),e.modelEvents.publish({event:"issue-idcard-maturity-update",data:{result:n}})}).catch(function(t){e._StateChangeErrors(t)}).finally(function(){e.refresh()})},_onDemote:function(){var e=this;let t=b.STATES_VALUES.indexOf(e.bos[0].state);if(0==t)return;let n=b.STATES_VALUES[t-1],i=e.bos.map(e=>({physicalId:e.physicalId,state:n}));c.issues.demote({data:{objects:i}}).then(function(t){let n=t.results;n.forEach(t=>{let n=t.body.physicalId;e.bos.forEach(e=>{e.physicalId==n&&(e.state=t.body.state)})}),e.modelEvents.publish({event:"issue-idcard-maturity-update",data:{result:n}})}).catch(function(t){e._StateChangeErrors(t)}).finally(function(){e.refresh()})},_StateChangeErrors:function(e){var t=v.lifecycle.error,n="";if(e&&e.error&&UWA.is(e.error.message,"string")&&(n=e.error.message),n.includes("Action Taken and Resolution Statement are not filled in")){t=g.getErrorMessage("5");g.displayErrorMessage(t,"error")}else if(n.includes("Action Taken field is not filled in")){t=g.getErrorMessage("6");g.displayErrorMessage(t,"error")}else if(n.includes("Resolution Statement field is not filled in")){t=g.getErrorMessage("7");g.displayErrorMessage(t,"error")}else if(n.includes("Resolution Date is not filled in")){t=g.getErrorMessage("8");g.displayErrorMessage(t,"error")}else if(n.includes("User does not have necessary privileges or selected object is not in correct maturity state for this operation.")){var i=g.getErrorMessage("1005_1");g.displayErrorMessage(i,"error")}else if(e.error&&e.error.internal&&(e.error.internal.includes("Message:No privilege for operation Severity:2 ErrorCode:1500019")||e.error.internal.includes("User does not have necessary privileges"))){i=g.getErrorMessage("1005");g.displayErrorMessage(i,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("You need at least one assignee to promote or demote this issue, as a validation process is attached to the issue for assignees")){i=g.getErrorMessage("1004");g.displayErrorMessage(i,"error")}else e&&e.error&&UWA.is(e.error.message,"string")&&(t=e.error.message,a.displayNotification({msg:t,eventID:"error"}))}})}),define("DS/IssueManagement/utils/customization/DataGridCellContent",["UWA/Core","DS/IssueServices/Contexts","DS/IssueComponents/users/Users","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(e,t,n,i,s){"use strict";var o={ISSUE_TYPE:"Issue",CREATE_STATE:"Create",ASSIGN_STATE:"Assign",ACTIVE_STATE:"Active",REVIEW_STATE:"Review",CLOSED_STATE:"Closed",LOW_PRIORITY:"Low",MEDIUM_PRIORITY:"Medium",HIGH_PRIORITY:"High",URGENT_PRIORITY:"Urgent"};return{updateCellContentForGrid:function(n){if(n.state)if(n.baseType==o.ISSUE_TYPE){var i=t.get("maturityGraph"),a=s.maturity[n.state.toLowerCase()];null!=i&&""!==i&&(a=i[n.state]);var r=e.createElement("span",{class:"issue-list-cell-state "+n.state.toLowerCase(),html:e.createElement("span",{class:"cell-state-content",html:a})}),l=n.state;if(void 0!==o[l.toUpperCase()+"_STATE"])n.grid["ds6w:state"]=r.outerHTML;else{var c=n.grid["ds6w:state"];c&&""!==c&&(l=c),n.grid["ds6w:state"]=r.outerHTML}}else{var d=n.grid["ds6w:state"];r=e.createElement("span",{class:"issue-list-cell-state "+d.replace(/ /g,"").toLowerCase(),html:e.createElement("span",{class:"cell-state-content",html:d})});n.state=d,n.grid["ds6w:state"]=r.outerHTML}if(n.priority){var u=n.priority,m="",p=s.priorities[u.toLowerCase()];switch(null==p&&(p=u),u){case o.LOW_PRIORITY:m="low wux-ui-3ds wux-ui-3ds-level-low";break;case o.MEDIUM_PRIORITY:m="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case o.HIGH_PRIORITY:m="high wux-ui-3ds wux-ui-3ds-level-high";break;case o.URGENT_PRIORITY:m="urgent wux-ui-3ds wux-ui-3ds-alert "}if(""==m)var h=e.createElement("div",{class:"issue-list-priority",html:p});else h=e.createElement("div",{class:"issue-list-priority",html:[e.createElement("span",{class:"issue-list-priority-icon "+m}),p]});n.grid["ds6w:priority"]=h.outerHTML}}}}),define("DS/IssueManagement/commands/ToggleInformationPanel",["UWA/Core","UWA/Class","DS/ApplicationFrame/Command"],function(e,t,n){"use strict";return t.extend(n,{name:"DS/IssueManagement/commands/ToggleInformationPanel",begin:function(e){this.execute(e)},execute:function(e){var t=this;require(["DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(n,i){i.start(t.name+" execute"),n.get("information").toggle(e.open,e.save),n.get("information").refreshInfo(),n.get("actionBar").updatePanelToggle(),n.get("application").updateHeaderToggle(),i.end(t.name+" execute")})}})}),define("DS/IssueManagement/views/facets/RelatedContent",["UWA/Core","UWA/Class/View","DS/IssueComponents/related/RelatedContent","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s){"use strict";return t.extend({name:"DS/IssueManagement/views/facets/RelatedContent",tagName:"div",className:"relatedContent-view fade-in-element",defaultOptions:{physicalIds:[]},related:null,_subscriberId:"",_eventListeners:[],setup:function(e){var t=this;s.start(t.name+" setup"),t._parent(e),t.relatedContent=new n({ids:t.getOption("physicalIds"),intercom:!0}),t._subscriberId=Math.random().toString(36).substr(2,9),t.listenTo(t.relatedContent,"onReady",function(e){t.dispatchEvent("onReady",e)}),t.listenTo(t.relatedContent,"onFailure",function(e){t.dispatchEvent("onFailure",e)}),t.listenTo(t.relatedContent,"onUpdate",function(e){for(var n=[],s={},o=Object.keys(e.issues),a=0;a<o.length;a++)n.push([e.issues[o[a]].id]),s[e.issues[o[a]].id]={id:e.issues[o[a]].id,type:e.issues[o[a]].type,name:e.issues[o[a]].name,title:e.issues[o[a]].title,modifiedAttributes:e.relation};i.get("eventsHandler").publish(t._subscriberId,"DS/Object/update",{metadata:{appId:i.get("widget").id,appName:i.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:n,attributes:s},version:"1.0"})}),t._eventListeners=[{event:"DS/Object/update",listener:function(e){t.relatedContent&&t.relatedContent.options.ids&&(e.data.paths.some(function(e){return-1!==t.relatedContent.options.ids.indexOf(e[0])})&&t.relatedContent.refresh(t.relatedContent.options.ids))},conditions:{type:"issue",attributes:["reportedAgainst","resolvedItems","resolvedBy","contexts"]}}];for(var o=0;o<t._eventListeners.length;o++){var a=t._eventListeners[o];a.token=i.get("eventsHandler").subscribe(t._subscriberId,a.event,a.listener.bind(t),a.conditions)}s.end(t.name+" setup")},render:function(){return s.start(this.name+" render"),this.relatedContent.render().inject(this.container),s.end(this.name+" render"),this},refresh:function(e){return this.setOption("physicalIds",e),this.relatedContent.refresh(e)},destroy:function(){if(this.stopListening(this.relatedContent,"onReady"),this.stopListening(this.relatedContent,"onFailure"),this.stopListening(this.relatedContent,"onUpdate"),Array.isArray(this._eventListeners))for(var e=0;e<this._eventListeners.length;e++){var t=this._eventListeners[e];i.get("eventsHandler").unsubscribe(t.token)}this._eventListeners=[],this._subcriberId="",this.relatedContent.destroy(),this.relatedContent=null,this.container.empty()}})}),define("DS/IssueManagement/views/facets/Comments",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Scroller","DS/SocialToolbar/SocialToolbar","DS/IssueServices/Contexts","DS/IssueManagement/views/facets/Placeholder","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","css!DS/IssueCommon/IssueCommon.css"],function(e,t,n,i,s,o,a,r,l,c,d){"use strict";return t.extend({name:"DS/IssueManagement/views/facets/Comments",tag:"div",className:"comments-view fade-in-element",defaultOptions:{physicalIds:[]},comments:null,elements:{target:null,scroller:null},setup:function(e){c.start(this.name+" setup"),this._parent(e),this.elements.target=n.createElement("div",{class:"comments-content"}),this.container.setContent(this.elements.target),this.elements.scroller=new i({element:this.elements.target}).inject(this.container),this.comments=null,c.end(this.name+" setup")},render:function(){var e=this;if(!1===e.isValidSelection())return e.elements.target.hide(),e.placeholder.show(e.container),setTimeout(function(){e.dispatchEvent("onReady",{})},0),e;e.placeholder.hide(e.container),e.elements.target.show(),c.start(e.name+" render");var t=e.getOption("physicalIds");return e.comments=new s({subjectURI:"pid:"+t[t.length-1],enableShare:!1,enableComment:!0,enableLike:!1,tenantId:r.getTenant(),commentProxyToken:{header:"X-DS-CSRFTOKEN"},serviceURL:r.get3DSpaceUrl()+"/resources","3DSwymUrl":r.get3DSwymUrl(),commentsNumberAtInit:8,enableUpload:!1}),e.comments.components.addEvent("onCommentCreateSuccess",function(t){e.addMentionedUser(t),e.notifyUsers(t)}),e.comments.components.addEvent("onCommentEditSuccess",function(t){e.addMentionedUser(t),e.notifyUsers(t)}),e.listenToOnce(e.comments,"onPopulate",function(){e.dispatchEvent("onReady",{})}),e.comments.inject(e.elements.scroller.getInnerElement()),c.end(e.name+" render"),e},refresh:function(t){var n=this;return null!==n.comments&&(n.comments.destroy(),n.comments=null),n.setOption("physicalIds",t),n.render(),new e(function(e){n.listenToOnce(n,"onReady",e)})},destroy:function(){this.stopListening(this,"onReady"),null!==this.comments&&(this.comments.destroy(),this.comments=null),this.container.empty()},isValidSelection:function(){var e=this.getOption("physicalIds");return Array.isArray(e)&&1===e.length},addMentionedUser:function(e){if(e&&n.is(e.get,"function")){var t="",i=e.get("subjectUri");if(i.length>0&&i.includes("pid:")){o="pid:";let e=i.indexOf(o)+o.length,n=i.length;t=i.substring(e,n)}var s=e.get("richMessage"),o='class="sum-user-link sm-link" data-login="',a=[];s.split("</a>").forEach(function(e){if(e.length>0&&e.includes(o)){let n=e.indexOf(o)+o.length,i=e.indexOf('"',n);var t=e.substring(n,i);a.push(t)}});var r=[];if(a.forEach(function(e){r.push({user:e})}),a.length>0&&t.length>0){var c=[{contributors:r,physicalId:t,userContext:"mentionedUser"}];l.people.update({data:{objects:c}}).catch(function(e){if(e.error.message.includes("'business object' does not exist")){var t=d.getErrorMessage("0");d.displayErrorMessage(t,"error")}else if(n.is(e.error.internal)&&e.error.internal.includes("You do not have the permissions to perform this action")){t=d.getErrorMessage("1");d.displayErrorMessage(t,"error")}else if(n.is(e.error.internal)&&e.error.internal.includes("No toconnect access to business object")){t=d.getErrorMessage("10");d.displayErrorMessage(t,"error")}else if(n.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")){t=d.getErrorMessage("2005");d.displayErrorMessage(t,"error")}else PADAlert.displayNotification({msg:e.error.message,eventID:"error"})})}}},notifyUsers:function(e){if(e&&n.is(e.get,"function")){var t="",i=e.get("subjectUri");if(i.length>0&&i.includes("pid:")){o="pid:";let e=i.indexOf(o)+o.length,n=i.length;t=i.substring(e,n)}var s=e.get("richMessage"),o='class="sum-user-link sm-link" data-login="',a=[];if(s.split("</a>").forEach(function(e){if(e.length>0&&e.includes(o)){let n=e.indexOf(o)+o.length,i=e.indexOf('"',n);var t=e.substring(n,i);a.push(t)}}),t.length>0){e={issue:t,users:a.toString()};l.comments.notify({data:e})}}},placeholder:{_view:new a,show:function(e){this._view.render("comments").inject(e),this._view.show()},hide:function(){this._view.hide(),this._view.empty()}}})}),define("DS/IssueManagement/export/ExportPPTX",["UWA/Class/Promise","UWA/Core","DS/IssueManagement/export/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a){"use strict";var r="DS/IssueManagement/export/ExportPPTX",l="Issue";return{exportation:function(){var t=this;o.start(r+" exportation");var c=i.get("component"),d=i.get("status"),u=a.export.pptx.name;return new e(function(e,t){var i=c.getSelectedNodes().filter(function(e){return e.options.baseType===l});0===i.length?(0===(i=c.getTreeDocument().getRoots(!1)).length&&(n.notifications.nothing(),t(new Error("Nothing to export as PPTX"))),n.confirmation({title:a.export.pptx.title,content:a.replace(a.export.pptx.content,{number:i.length})}).then(function(n){!0===n?e(i):t(new Error("Export PPTX canceled by user"))})):e(i)}).then(function(e){1===e.length&&(u=u+e[e.length-1].options.name+"_"),n.notifications.exporting(),d.loading.start(),d.loading.update(a.export.pptx.exporting);for(var i=[],l=0;l<e.length;l++)i.push({physicalId:e[l].options.physicalId});return s.export.pptx({data:{objects:i}}).then(function(e){t.utils.saveByteArray(e,u+(new Date).toString().split(" ").splice(1,4).join(" ")+".pptx"),d.loading.hide(a.export.pptx.done)},function(e){var t=new TextDecoder("utf-8"),i=JSON.parse(t.decode(e));n.notifications.failure(i.error.message),d.loading.hide(a.export.pptx.failure)}).finally(function(){o.end(r+" exportation")})})},utils:{saveByteArray:function(e,n){var i=t.createElement("a");document.body.appendChild(i),i.style="display: none";var s=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}),o=window.URL.createObjectURL(s);i.href=o,i.download=n,i.click(),setTimeout(function(){document.body.removeChild(i),window.URL.revokeObjectURL(o)},0)}}}}),define("DS/IssueManagement/views/facets/History",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/IssueComponents/routes/Routes","DS/IssueManagement/views/facets/Placeholder","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueTimeline/IssueTimeline","css!DS/IssueCommon/IssueCommon.css"],function(e,t,n,i,s,o,a,r){"use strict";return t.extend({name:"DS/IssueManagement/views/facets/History",tagName:"div",className:"history-view fade-in-element",defaultOptions:{physicalIds:[]},timeline:null,_subscriberId:"",_eventListeners:[],setup:function(t){var s=this;a.start(s.name+" setup"),s._parent(t),s.target=n.createElement("div",{class:"history-content"}),s.container.setContent(s.target);var l=s.getOption("physicalIds");s.timeline=new r({physicalId:l[l.length-1]}),s.routes=new i({physicalId:l[l.length-1]});var c=new e(function(e,t){s.listenTo(s.timeline,"onReady",function(t){e(t)}),s.listenTo(s.timeline,"onFailure",function(e){t(e)})}),d=new e(function(e,t){s.listenTo(s.routes,"onReady",function(t){s.container.toggleClassName("history-view-timeline-only",s.routes.isEmpty),e(t)}),s.listenTo(s.routes,"onFailure",function(e){t(e)})});e.all([c,d]).then(function(e){s.container.toggleClassName("history-view-wide",s.container.offsetWidth>1.4*s.container.offsetHeight),s.container.toggleClassName("history-view-timeline-only",null===s.routes||s.routes.isEmpty),s.dispatchEvent("onReady",e)}).catch(function(e){s.dispatchEvent("onFailure",e)}),s._subscriberId=Math.random().toString(36).substr(2,9),s._eventListeners=[{event:"DS/Object/update",listener:function(e){s.routes&&s.routes.getOption("physicalId")&&(e.data.paths.reduce(function(e,t){return e.push(t.pop()),e},[]).indexOf(s.routes.getOption("physicalId"))>-1&&s.routes.refresh(s.routes.getOption("physicalId")).then(function(){s.container.toggleClassName("history-view-timeline-only",null===s.routes||s.routes.isEmpty)}))},conditions:{type:"issue",attributes:["state","assignees"]}},{event:"DS/Object/update",listener:function(e){s.timeline&&s.timeline.getOption("physicalId")&&(e.data.paths.reduce(function(e,t){return e.push(t.pop()),e},[]).indexOf(s.timeline.getOption("physicalId"))>-1&&s.timeline.refresh(s.timeline.getOption("physicalId")))},conditions:{type:"issue"}}];for(var u=0;u<s._eventListeners.length;u++){var m=s._eventListeners[u];m.token=o.get("eventsHandler").subscribe(s._subscriberId,m.event,m.listener.bind(s),m.conditions)}a.end(s.name+" setup")},render:function(){return!1===this.isValidSelection()?(this.elements.target.hide(),this.placeholder.show(this.container)):(this.placeholder.hide(this.container),this.target.show()),a.start(this.name+" render"),this.timeline.render().inject(this.target),this.routes.render().inject(this.target),this.container.toggleClassName("history-view-wide",this.container.offsetWidth>1.4*this.container.offsetHeight),this.container.toggleClassName("history-view-timeline-only",!0),a.end(this.name+" render"),this},refresh:function(t){var n=this;return n.setOption("physicalIds",t),!1===n.isValidSelection()?(n.target.hide(),n.placeholder.show(n.container),setTimeout(function(){n.dispatchEvent("onReady",{})},0),e.resolve()):(n.placeholder.hide(n.container),n.target.show(),e.all([n.timeline.refresh(t[t.length-1]),n.routes.refresh(t[t.length-1])]).then(function(){n.container.toggleClassName("history-view-timeline-only",null===n.routes||n.routes.isEmpty),n.dispatchEvent("onReady",{})}))},resize:function(){null!==this.timeline&&this.timeline.resize(),null!==this.routes&&this.routes.resize(),this.container.toggleClassName("history-view-wide",this.container.offsetWidth>1.4*this.container.offsetHeight)},destroy:function(){if(this.stopListening(this.timeline,"onReady"),this.stopListening(this.timeline,"onFailure"),Array.isArray(this._eventListeners))for(var e=0;e<this._eventListeners.length;e++){var t=this._eventListeners[e];o.get("eventsHandler").unsubscribe(t.token)}this._eventListeners=[],this._subcriberId="",this.timeline.destroy(),this.timeline=null,this.container.empty()},isValidSelection:function(){var e=this.getOption("physicalIds");return Array.isArray(e)&&1===e.length},placeholder:{_view:new s,show:function(e){this._view.render("history").inject(e),this._view.show()},hide:function(){this._view.hide(),this._view.empty()}}})}),define("DS/IssueManagement/components/header/ActionBar",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Iconbar","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","DS/ApplicationFrame/ActionBar","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueServices/Contexts","DS/IssueServices/utils/LocalStorage","i18n!DS/IssueManagement/assets/nls/IssueManagement","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o,a,r,l,c,d,u,m){"use strict";var p="ListView",h="KanbanView",g={RIGHT:"right",BOTTOM:"bottom"};return t.extend({name:"DS/IssueManagement/components/header/ActionBar",tagName:"div",className:"action-bar",_iconBar:null,_switchers:{layout:null,information:null,tooltips:{layout:null,information:null}},setup:function(e){this._parent(e),this._iconBar=null,this._switchers={layout:null,information:null,tooltips:{layout:null,information:null}},this._filterModule=null,this._abar=new r({file:"IssueManagement.xml",module:"IssueManagement",context:"Default"}),this._subscribers()},render:function(){var e=this;e._filterModule=d.get("filter");var t=d.get("widget")||window.widget;e.listView=d.get("ISU_LISTVIEW"),e.container.addClassName("disabled");var n=e.utils.getCurrentView(),i="",o="",a="",r=!1,c=!1;a=e.listView?m.actions.listView:m.actions.gridView,n===p&&e.listView?(i="view-list",o=m.actions.listView,r=!0):n===p?(i="view-list",o=m.actions.gridView,r=!0):(i="compare-on",o=m.actions.kanbanView,c=!0);var u=t.getValue("kanbanViewBy")||"state";e._iconBar=new s({renderTo:e.container,items:[{name:"InlineCreate",fonticon:"plus",text:m.actions.create.title,handler:function(){l.getCommandCheckHeader("InlineCreate").toggleState()}},{name:"ChangeAction",fonticon:"change",text:m.actions.changeAction,handler:function(){l.getCommand("ChangeAction").begin()}},{name:"3DMarkup",fonticon:"app-3dmarkup",text:m.actions.markup3D,handler:function(){l.getCommand("3DMarkup").begin()}},{className:"divider"},{name:"ContextFilter"},{name:"Filter",fonticon:"list-filter",text:m.filter.title},{name:"Find",fonticon:"find",text:m.actions.find.title,handler:function(){l.getCommandCheckHeader("Find").toggleState()}},{name:"Selection",fonticon:"select-on",text:m.actions.select.title,content:{type:"dropdownmenu",options:{multiSelect:!1,closeOnClick:!0,items:[{name:"SelectAllIssues",fonticon:"list-ok",text:m.actions.select.selectIssues,handler:function(){l.getCommand("SelectAllIssues").begin()}},{name:"SelectAllRelatedObjects",fonticon:"flow-cascade-ok-2",text:m.actions.select.selectChildren,handler:function(){l.getCommand("SelectAllRelatedObjects").begin()}},{name:"UnselectAll",fonticon:"list-delete",text:m.actions.select.unselectAll,handler:function(){l.getCommand("UnselectAll").begin()}}]}}},{className:"divider"},{name:"ColumnCustomization",fonticon:"cog",text:m.actions.customizeView,handler:function(){l.getCommand("ColumnCustomization").begin()}},{name:"KanbanCustomization",fonticon:"cog",text:m.actions.customizeView,content:{type:"dropdownmenu",options:{multiSelect:!1,closeOnClick:!0,items:[{name:"state",text:m.columns.stateColumn,selectable:!0,selected:"state"===u,handler:function(){e.utils.setKanbanViewBy("state")}},{name:"priority",text:m.columns.priorityColumn,selectable:!0,selected:"priority"===u,handler:function(){e.utils.setKanbanViewBy("priority")}},{name:"resolutionDate",text:m.columns.resolutionDateColumn,selectable:!0,selected:"resolutionDate"===u,handler:function(){e.utils.setKanbanViewBy("resolutionDate")}},{name:"all",text:m.columns.allColumn,selectable:!0,selected:"all"===u,handler:function(){e.utils.setKanbanViewBy("all")}}]}}},{name:"SwitchView",fonticon:i,text:o,content:{type:"dropdownmenu",options:{items:[{name:"ListView",fonticon:"view-list",text:a,selectable:!0,selected:r,handler:function(){var n=e._iconBar.getItem("SwitchView"),i=n.elements.icon,s=n.tooltip;t.dispatchEvent("onResetSearch"),i.hasClassName("fonticon-compare-on")&&(i.removeClassName("fonticon-compare-on").addClassName("fonticon-view-list"),n.fonticon="fonticon-view-list",n.text=m.actions.listView,s.setBody(a)),e._iconBar.getItem("KanbanCustomization").elements.container.hide(),e._iconBar.getItem("ColumnCustomization").elements.container.show(),e._iconBar.elements.container.getElementsByClassName("divider")[1].removeClassName("disabled"),l.getCommand("SwitchView").begin("ListView")}},{name:"KanbanView",fonticon:"compare-on",text:m.actions.kanbanView,selectable:!0,selected:c,handler:function(){var n=e._iconBar.getItem("SwitchView"),i=n.elements.icon,s=n.tooltip;t.dispatchEvent("onResetSearch"),i.hasClassName("fonticon-view-list")&&(i.removeClassName("fonticon-view-list").addClassName("fonticon-compare-on"),n.fonticon="fonticon-compare-on",n.text=m.actions.kanbanView,s.setBody(m.actions.kanbanView)),e._iconBar.getItem("ColumnCustomization").elements.container.hide(),e._iconBar.getItem("KanbanCustomization").elements.container.show(),e._iconBar.elements.container.getElementsByClassName("divider")[1].addClassName("disabled"),l.getCommand("SwitchView").begin("KanbanView")}}]}},handler:function(e){e.target.addClassName("active"),setTimeout(()=>{document.getElementsByClassName("dropdown-menu dropdown-menu-root dropdown dropdown-root")[0].addEventListener("focusout",()=>{e.target.removeClassName("active")},!0)},100)}},{className:"divider"},{name:"Dynamic",fonticon:"menu-dot",text:m.actions.more,content:{type:"dropdownmenu",options:{items:e.utils.getMoreActions()}}}]}),e.updateFilterMenu(),e.listenTo(e._iconBar.overflowMenu,"onShow",function(){var t=e._iconBar.overflowMenu.getItem("SwitchView"),n=t.elements.container;if(e.utils.getCurrentView()===p){n.getElement(".fonticon-compare-on")&&(t.fonticon="view-list",t.text=m.actions.listView,n.getElement(".fonticon-compare-on").removeClassName("fonticon-compare-on").addClassName("fonticon-view-list"),n.getElement(".item-text").setText(m.actions.listView));var i=e._iconBar.overflowMenu.getItem("ColumnCustomization").elements.container;i.show(),i.hasClassName("hidden")&&i.removeClassName("hidden"),e._iconBar.overflowMenu.getItem("KanbanCustomization").elements.container.hide()}else{n.getElement(".fonticon-view-list")&&(t.fonticon="compare-on",t.text=m.actions.kanbanView,n.getElement(".fonticon-view-list").removeClassName("fonticon-view-list").addClassName("fonticon-compare-on"),n.getElement(".item-text").setText(m.actions.kanbanView));var s=e._iconBar.overflowMenu.getItem("KanbanCustomization").elements.container;s.show(),s.hasClassName("hidden")&&s.removeClassName("hidden"),e._iconBar.overflowMenu.getItem("ColumnCustomization").elements.container.hide()}}),e.listView=d.get("ISU_LISTVIEW"),e.listView||e._iconBar.getItem("Find").elements.container.hide(),n===p?(e._iconBar.getItem("KanbanCustomization").elements.container.hide(),e._iconBar.getItem("ColumnCustomization").elements.container.show()):(e._iconBar.elements.container.getElementsByClassName("divider")[1].addClassName("disabled"),e._iconBar.getItem("KanbanCustomization").elements.container.show(),e._iconBar.getItem("ColumnCustomization").elements.container.hide()),e._getLayoutSwitcher().inject(e.container);var h=d.get("information"),f=h.getPreferences().current||g.RIGHT;return h.getLayout().current!==f&&l.getCommand("SwitchLayout")&&l.getCommand("SwitchLayout").begin({layout:f}),e},updateFilterMenu:function(){var e=this,t=e._filterModule.getFilterMenu();e.filterMenu&&e.filterMenu.destroy(),e.filterMenu=new a({target:e._iconBar.getItem("Filter").elements.icon,multiSelect:!0,closeOnClick:!1,items:t,events:{onClick:function(t,n){var i={};if("others"!==n.name){if("session"===n.name)e.filterMenu.items.forEach(function(t){"session"!==t.name&&"others"!==t.name&&"closed"!==t.name&&!0===t.selected&&e.filterMenu.toggleSelection(t)});else if("closed"!==n.name){var s=e.filterMenu.getItem("session");!0===s.selected&&e.filterMenu.toggleSelection(s)}e.filterMenu.getSelectedItems().forEach(function(e){i[e.name]=!0}),e.filterMenu.hide(),widget.setValue("filter",JSON.stringify(i)),"filterbyobject"!==n.name&&(widget.dispatchEvent("onRefresh",["filter"]),widget.dispatchEvent("endEdit")),"filterbyobject"===n.name&&(!0===n.selected?e._filterModule.showContextFilter():e._filterModule.hideContextFilter())}}}}),widget.getValue("contextFilter")},refresh:function(){this.destroy(),this.render()},destroy:function(){this.stopListening(l,"onEnable"),this.stopListening(l,"onDisable"),this._iconBar.destroy(),this._iconBar=null,this._switchers.tooltips.information.destroy(),this._switchers.tooltips.information=null,this._switchers.information.destroy(),this._switchers.information=null,this._switchers.tooltips.layout.destroy(),this._switchers.tooltips.layout=null,this._switchers.layout.destroy(),this._switchers.layout=null},resize:function(){var e=this;requestAnimationFrame(function(){e._iconBar.resize()})},enable:function(t){var n=this;Array.isArray(t)&&t.forEach(function(t){switch(t){case"ToggleInformationPanel":if(n._switchers.information.enable(),l.getCommand("ToggleInformationPanel")){var i=d.get("widget").getValue("infoIsOpened"),s=e.is(i,"boolean")?i:"true"===i;l.getCommand("ToggleInformationPanel").begin({open:s,save:!1})}break;case"SwitchLayout":n._switchers.layout.enable();break;default:if(n._iconBar.overflowMenu.enableItem(t),n._iconBar.getItem(t))n._iconBar.getItem(t).elements.container.show(),"ColumnCustomization"==t&&n.utils.getCurrentView()==h&&n._iconBar.getItem(t).elements.container.hide();else{var o=n._iconBar.getItem("Dynamic").content.component;o&&o.getItem(t)&&o.enableItem(t),n._iconBar.disabledCommands&&n._iconBar.disabledCommands.indexOf(t)>=0&&n._iconBar.disabledCommands.splice(n._iconBar.disabledCommands.indexOf(t),1)}}})},disable:function(e){var t=this;Array.isArray(e)&&e.forEach(function(e){switch(e){case"ToggleInformationPanel":t._switchers.information.setActive(!1),t._switchers.information.disable(),l.getCommand("ToggleInformationPanel")&&l.getCommand("ToggleInformationPanel").begin({open:!1,save:!1});break;case"SwitchLayout":t._switchers.layout.disable();break;default:if(t._iconBar.overflowMenu.disableItem(e),t._iconBar.getItem(e))t._iconBar.getItem(e).elements.container.hide();else{var n=t._iconBar.getItem("Dynamic").content.component;if(n&&n.getItem(e))n.disableItem(e);else{for(var i=t._iconBar.getItem("Dynamic").content.options.items,s=-1,o=0;o<i.length;o++)i[o].name===e&&(s=o);s>-1&&(t._iconBar.getItem("Dynamic").content.options.items[s].disabled=!0)}t._iconBar.disabledCommands||(t._iconBar.disabledCommands=[]),t._iconBar.disabledCommands.push(e)}}})},getIconBar:function(){return this._iconBar},getLayoutSwitcher:function(){return this._switchers.layout},getApplicationFrameActionBar:function(){return this._abar},_getLayoutSwitcher:function(){var t=d.get("widget")||window.widget,s=t.getValue("infoIsOpened"),a=e.is(s,"boolean")?s:"true"===s,r=e.clone(t.getValue("infoLayout"))||g.RIGHT,c=this._switchers.information=new n({className:"info-toggle info-action",active:a,icon:"info"}).addEvent("onClick",function(){this.toggleActive();var e=this.isActive();l.getCommand("ToggleInformationPanel").begin({open:e,save:!0})});this._switchers.tooltips.information=new o({target:c.getContent(),body:m.information.toggleTooltip});var u=this._switchers.layout=new n({className:"info-action",icon:"chevron-down",dropdown:{items:[{name:g.RIGHT,fonticon:"side-panel",text:m.information.right,selected:r===g.RIGHT,selectable:!0},{name:g.BOTTOM,fonticon:"bottom-panel",text:m.information.bottom,selected:r===g.BOTTOM,selectable:!0}]},events:{onDropdownClick:function(e,t){l.getCommand("SwitchLayout").begin({layout:t.name,save:!0})}}});this._switchers.tooltips.layout=new o({target:u.getContent(),body:m.information.layoutSwitcherTooltip});var p=new i({buttons:[c,u]});return e.createElement("div",{class:"button-panel-container",html:p})},updatePanelToggle:function(){if(!this._switchers.information.isDisabled()){var t=(d.get("widget")||window.widget).getValue("infoIsOpened"),n=e.is(t,"boolean")?t:"true"===t;this._switchers.information.setActive(n)}},_getDropdownLayoutSwitcher:function(e){return{items:[{name:g.RIGHT,fonticon:"side-panel",text:m.information.right,selected:e===g.RIGHT,selectable:!0},{name:g.BOTTOM,fonticon:"bottom-panel",text:m.information.bottom,selected:e===g.BOTTOM,selectable:!0}]}},updateLayoutSwitcher:function(t){var n=d.get("widget")||window.widget,i=e.is(t,"string")?t:e.clone(n.getValue("infoLayout"))||g.RIGHT,s=this._switchers.layout;s.dropdown.removeItem(g.RIGHT),s.dropdown.removeItem(g.BOTTOM),this._getDropdownLayoutSwitcher(i).items.forEach(function(e){s.dropdown.addItem(e)})},_subscribers:function(){var e=this,t=d.get("widget")||window.widget;e.listenTo(l,"onEnable",function(t){e.enable(t.commands),e.utils.getCurrentView()===h&&l.disable(["Selection","Find"])}),e.listenTo(l,"onDisable",function(t){e.disable(t.commands),e.utils.getCurrentView()==p&&(1==t.isIdle?e._iconBar.elements.container.getElementsByClassName("divider")[1].addClassName("disabled"):t.isIdle||e._iconBar.elements.container.getElementsByClassName("divider")[1].removeClassName("disabled"))}),e._abar.onActionBarReady(function(){var n=l.getCommandCheckHeader("InlineCreate");n.onStateChange(function(){if(null!==e._iconBar){var t=e._iconBar.getItem("InlineCreate").elements.container;!0===n.getState()?t.addClassName("active"):t.removeClassName("active")}});var i=l.getCommandCheckHeader("Find");i.onStateChange(function(){if(null!==e._iconBar){var t=e._iconBar.getItem("Find").elements.container;!0===i.getState()?t.addClassName("active"):t.removeClassName("active")}}),t.addEvent("onSearch",function(t){var n=d.get("ISU_LISTVIEW"),s=d.get("component");if(e.utils.getCurrentView()===h)for(var o=s.kanban.currentView,a=s.kanban.columns[o].length,r=0;r<a;r++)for(var l=s.kanban.columns[o][r].getTreeDocument().getAllDescendants(),c=0;c<l.length;c++)l[c].getLabel().contains(t)||l[c].hide();else n?!0===i.isEnabled()&&i.find(t):t&&s.getTreeDocument().setFilterModel({label:{filterId:"stringRole",filterModel:{allowedRoles:t}}})}),t.addEvent("onResetSearch",function(){var t=d.get("ISU_LISTVIEW"),n=d.get("component");if(e.utils.getCurrentView()===h)for(var s=n.kanban.currentView,o=n.kanban.columns[s].length,a=0;a<o;a++)for(var r=n.kanban.columns[s][a].getTreeDocument().getAllDescendants(),l=0;l<r.length;l++)r[l].isVisible()||r[l].show();else t?!0===i.isEnabled()&&!0===i.getState()&&i.toggleState():n.getTreeDocument().setFilterModel({})}),e._iconBar&&e.disable(e._iconBar.disabledCommands),e.container.removeClassName("disabled")})},utils:{getCurrentView:function(){var e=u.getItem("view");return e&&e.name?e.name:(u.setItem("view",{name:p}),p)},getMoreActions:function(){return this._getBasicMenu()},setKanbanViewBy:function(e){var t=d.get("widget");d.get("component").kanban.switchView(e),t.setValue("kanbanViewBy",e),t.dispatchEvent("endEdit")},_getBasicMenu:function(){var e=[];return e.push({name:"Export",fonticon:"export",text:m.actions.export,items:this._getExportMenu()}),e.push({name:"Print",fonticon:"print",text:m.actions.print,handler:function(){l.getCommand("Print").begin()}}),e.push({name:"Templates",fonticon:"template-cog",text:m.actions.templates,handler:function(){l.getCommand("Templates").begin()}}),e},_getExportMenu:function(){var e=[];return e.push({name:"ExportCSV",fonticon:"doc-log",text:m.actions.exportCSV,handler:function(){l.getCommand("ExportCSV").begin()}}),e.push({name:"ExportPPTX",fonticon:"newspaper",text:m.actions.exportPPTX,handler:function(){l.getCommand("ExportPPTX").begin()}}),e.push({name:"ExportZIP",fonticon:"archive",text:m.actions.exportZIP,handler:function(){l.getCommand("ExportZIP").begin()}}),e}}})}),define("DS/IssueManagement/views/facets/Relations",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/ENORIPE_Relations/RelationsTabSettings","DS/ENORIPE_Relations/views/RelationsTab","UWA/Class/Model","DS/IssueServices/Contexts","DS/IssueManagement/views/facets/Placeholder","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","css!DS/IssueCommon/IssueCommon.css"],function(e,t,n,i,s,o,a,r,l,c,d,u){"use strict";return t.extend({name:"DS/IssueManagement/views/facets/Relations",tag:"div",className:"relations-view fade-in-element",defaultOptions:{physicalIds:[]},relations:null,elements:{target:null},setup:function(e){d.start(this.name+" setup"),this._parent(e),this.elements.target=n.createElement("div",{class:"relations-content"}),this.container.setContent(this.elements.target),this.relations=null,d.end(this.name+" setup")},render:function(){var e=this;if(!1===e.isValidSelection())return e.elements.target.hide(),e.placeholder.show(e.container),setTimeout(function(){e.dispatchEvent("onReady",{})},0),e;e.placeholder.hide(e.container),e.elements.target.show(),d.start(e.name+" render");var t=e.getOption("physicalIds");return e.renderRelations(t[0]),d.end(e.name+" render"),e},renderRelations:function(e){var t=this,n={getPlatformID:function(){return l.getTenant()},getServiceID:function(){return"3DSpace"}},a=new o({source:"3DSpace",tenant:l.getTenant(),objectId:e});return i.isAvailable(n,{isDraggable:!0,isProfilesVisible:!0,appID:"ENORIPE_ISU",isExternal:!0}).then(function(e){"object"==typeof e&&e.isAvailable&&void 0!==e.facetInfo&&(null!=t.relations&&null!=t.relations||(t.relations=new s,t.relations.elements.container.inject(t.elements.target)),t.relations.updateFacetExternal(a))})},refresh:function(t){if(this.setOption("physicalIds",t),!1===this.isValidSelection())this.elements.target.hide(),this.placeholder.show(this.container);else{if(this.placeholder.hide(this.container),this.elements.target.show(),null==this.relations||null==this.relations)return this.renderRelations(t[0]);var n=new o({source:"3DSpace",tenant:l.getTenant(),objectId:t[0]});this.relations.updateFacetExternal(n)}return e.resolve()},destroy:function(){this.stopListening(this,"onReady"),null!==this.relations&&(this.relations.destroy(),this.relations=null),this.container.empty()},isValidSelection:function(){var e=this.getOption("physicalIds");return Array.isArray(e)&&1===e.length},placeholder:{_view:new r,show:function(e){this._view.render("relations").inject(e),this._view.show()},hide:function(){this._view.hide(),this._view.empty()}}})}),define("DS/IssueManagement/components/header/InlineCreate",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Text","DS/UIKIT/DropdownMenu","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/IssueCommon/utils/Utils","DS/IssueManagement/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f){"use strict";var v=7,b=13,I=27,y=40,w="IFB",S="IFT",C="IFRT",E="RECENT_TEMPLATES_HEADER",_="LOADING_TEMPLATES_PLACEHOLDER",T="SIMILAR_ISSUES",D="Analyst",M=250,A=100,x=0,N="Issue",O=1e3;return t.extend({name:"DS/IssueManagement/components/header/Find",tagName:"div",className:"create-container",_logger:null,domEvents:{"keyup input.create-input":"_onKeyUp","keydown input.create-input":"_onKeyDown","click .clear-create":"_onClear","click .validate-create":"_onValidate"},input:null,dropdown:null,icons:null,clear:null,validate:{button:null,tooltip:null},_onCreating:!1,_similarities:{issues:[],search:null},setup:function(e){g.start(this.name+" setup"),this._parent(e),this._logger=r.getLogger(this.name),this.input=null,this.dropdown=null,this.icons=null,this.clear=null,this.validate={button:null,tooltip:null},this._subscriberId=Math.random().toString(36).substr(2,9),this._onCreating=!1,this._similarities={issues:[],search:c.debounce(this._searchSimilarIssues.bind(this),O)},g.end(this.name+" setup")},render:function(){var e=this;g.start(e.name+" render"),e.input=new i({className:"create-input",placeholder:f.actions.create.placeholder}),e.dropdown=new s({className:"im-inline-create-dropdown",target:e.input.elements.container,bound:!1,closeOnClick:!1,items:[{id:w,text:f.actions.create.issue.blank,fonticon:"issue"},{id:S,text:f.actions.create.issue.template,fonticon:"template"},{id:E,text:f.actions.create.issue.recentTemplate,className:"im-inline-create-recent-template-header"},{id:_,text:" "}],events:{onShow:function(){var t=e.input.elements.container.offsetWidth;e.dropdown.elements.container.setStyle("width",t);var i=e.dropdown.getItem(_);c.Mask.mask(i.elements.container),require(["DS/IssueComponents/templates/Templates","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(t,i){var s=new t(u.get("widget"),{editMode:!0,onClose:function(){},onEnd:function(){}});s.getAndFetchTemplates().then(function(t){if(null!==e.dropdown){if(e.dropdown.removeItem(_),0===t.length)return e.dropdown.addItem({id:"empty",text:i.templates.treeList.placeholder,title:i.templates.treeList.placeholder,data:null,fonticon:"clock",disabled:!0}),null;for(var s=t.sort(function(e,t){var n=Number.isInteger(e.info.lastUsed)?e.info.lastUsed:0;return(Number.isInteger(t.info.lastUsed)?t.info.lastUsed:0)-n}),o=Math.min(s.length,3),a=0;a<o;a++){var r=!1;n.is(s[a].info.tenant,"string")&&s[a].info.tenant!==p.getTenant()&&(r=!0),e.dropdown.addItem({id:C+":::"+s[a].id,text:c.getTextFromHTML(s[a].info.name),title:c.getTextFromHTML(s[a].info.name),data:s[a],fonticon:"clock",disabled:r})}return s}return null},function(t){e._logger.error("Could not fetch the templates: %o",t),e.dropdown.removeItem(_),e.dropdown.addItem({id:"empty",text:i.templates.errors.get,title:i.templates.errors.get,data:null,fonticon:"attention ",disabled:!0})}).finally(function(){s.destroy(),s=null,n.is(e.dropdown,"object")&&(e.dropdown.removeItem(T),e._similarities.issues.length&&e.dropdown.addItem({id:T,text:f.replace(f.actions.create.issue.similarIssues,{count:e._similarities.issues.length}),title:f.replace(f.actions.create.issue.similarIssues,{count:e._similarities.issues.length}),fonticon:"open",className:"im-inline-create-similar-issues-header"}))})})},onClick:function(t,n){var i=d.getCommand("Create"),s=e.input.getValue().trim();s.length>0?i.autoFillData={title:s}:i.autoFillData=null;var o=!0;switch(n.id){case w:i.mode=w,i.begin();break;case S:i.mode=S,i.begin();break;case T:o=!1;var a=c.computeSharedIssuesURL(e._similarities.issues.map(function(e){return e.physicalId}));window.open(a,"_blank");break;case _:case E:return;default:if(0===n.id.indexOf(C)){i.mode=S,i.template=n.data,i.begin();break}}!0===o&&e._onClose()}}});var t=null;return e.icons=n.createElement("div",{class:"icons-create",html:[t=n.createElement("div",{class:"clear-create fonticon fonticon-cancel-circled"})]}),t.setAttribute("style","font-size: 18px !important"),e.input.inject(e.container),e.icons.inject(e.container),e.clear=new a({position:"bottom",target:t,body:f.actions.create.clear}),g.end(e.name+" render"),e},destroy:function(){this.dropdown.destroy(),this.dropdown=null,this.input.destroy(),this.input=null,this.icons=null,this.clear.destroy(),this.clear=null,null!==this.validate.button&&(this.validate.button.destroy(),this.validate.tooltip.destroy(),this.validate={button:null,tooltip:null}),this._onCreating=!1,this._similarities={issues:[],search:null},this.container.destroy()},focus:function(){var e=this;if(e.dropdown&&e.input){e.dropdown.show(),e.input.focus();var t=function(){setTimeout(function(){e.input&&""===e.input.getValue().trim()&&(n.is(e.dropdown)&&Array.isArray(e.dropdown.menus)&&e.dropdown.menus.length>0&&document.activeElement===e.dropdown.menus[x].elements.wrapper||(e.input.elements.container.removeEventListener("focusout",t),setTimeout(function(){e._onClose()},M)))},A/10)};e.input.elements.container.addEventListener("focusout",t)}},_onKeyUp:function(e){var t=this.input.getValue().trim();document.activeElement===e.target&&e.target===this.input.elements.container&&(t.length>0?(null===this.validate.button&&(this.validate.button=n.createElement("div",{class:"validate-create fonticon fonticon-check"}),this.validate.button.inject(this.icons),this.validate.button.setAttribute("style","font-size: 18px !important"),this.validate.tooltip=new a({position:"bottom",target:this.validate.button,body:f.actions.create.title})),n.is(this._similarities.search,"function")&&this._similarities.search()):this.validate.button instanceof HTMLElement&&(this.validate.button.destroy(),this.validate.tooltip.destroy(),this.validate={button:null,tooltip:null}))},_onKeyDown:function(e){var t=this;if(!0!==t._onCreating)if(e.keyCode!==I||document.activeElement!==e.target||e.target!==t.input.elements.container){if(e.keyCode===y&&document.activeElement===e.target&&e.target===t.input.elements.container){t.dropdown.menus[x].focusIt();var n=document.createEvent("Events");return n.initEvent("keydown",!0,!0),n.which=40,void t.dropdown.menus[x].elements.container.dispatchEvent(n)}var i=t.input.getValue().trim();if(e.keyCode===b&&document.activeElement===e.target&&e.target===t.input.elements.container){if(0===i.length)return t.input.elements.container.addClassName("has-error"),void t.input.setValue("");t._onCreating=!0,t._onValidate({doNotClose:!0}).then(function(){t.validate.button instanceof HTMLElement&&(t.validate.button.destroy(),t.validate.tooltip.destroy(),t.validate={button:null,tooltip:null})}).finally(function(){t._onCreating=!1})}}else t._onClose()},_onValidate:function(e){var t=this,i=u.get("widget")||window.widget;o.mask(i.body),t.input.elements.container.removeClassName("has-error");var s,a,r,c=new Date,d=new Date(c.getFullYear(),c.getMonth(),c.getDate()+v);"true"==u.get("ISU_AUTO_DATES")&&(s=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear(),a=d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear(),r=d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear());let h=p.getSecurityContexts().cspaces;var g={title:t.input.getValue(),resolutionDate:r,estimatedStartDate:s,estimatedEndDate:a,responsibleOrganization:p.getCurrentCredentials().organization,reportingOrganization:p.getCurrentCredentials().organization,securityContexts:i.getPreference("pad_security_ctx")?i.getPreference("pad_security_ctx").value:h[0].value};return m.preferences.getApprovalEnablement({data:{}}).then(function(i){var s=i.body.ApprovalProcess;"Always"==s?(g.waitingOn=D,t._onCreate(e,g)):"Never"==s?t._onCreate(e,g):m.preferences.get({data:{name:"approvalPreference"}}).then(function(n){!0===n.body&&(g.waitingOn=D),t._onCreate(e,g)}).catch(function(e){e&&n.is(e.error,"object")&&n.is(e.error.message,"string")&&l.displayNotification({msg:e.error.message,eventID:"error"})})}).catch(function(e){e&&n.is(e.error,"object")&&n.is(e.error.message,"string")&&l.displayNotification({msg:e.error.message,eventID:"error"})})},_onCreate:function(e,t){var i=this,s=u.get("widget")||window.widget;m.issues.create({data:t}).then(function(n){var a=n.body;try{c.cloudProbeUtils.sendCreateIssueTrackerEvent({createData:t,options:{issueCreationType:"InlineIssue"}})}catch(e){}finally{l.displayNotification({msg:f.actions.create.success,eventID:"success"}),o.unmask(s.body);var r=u.get("eventsHandler"),d=[],m={};d.push([a.physicalId]),m[a.physicalId]={id:a.physicalId,type:N};var p={metadata:{appId:s.id,appName:s.name,timestamp:Math.floor(Date.now())},data:{paths:d,attributes:m},version:"1.0"};r.publish(i._subscriberId,"DS/Object/create",p),setTimeout(function(){i.input.setValue(""),e&&!0!==e.doNotClose&&i._onClose()},0)}}).catch(function(e){if(o.unmask(s.body),e&&n.is(e.error,"object")&&n.is(e.error.message,"string"))if(n.is(e.error.internal)&&(e.error.internal.includes("ErrorCode:2004")||e.error.internal.includes("Admin not allowed to create Issue"))){var t=c.getErrorMessage("4");c.displayErrorMessage(t,"error")}else l.displayNotification({msg:e.error.message,eventID:"error"});else l.displayNotification({msg:f.actions.create.failure,eventID:"error"})})},_onClear:function(){null!==this.input&&(this.input.setValue(""),this.input.focus())},_onClose:function(){this._onClear(),d.getCommandCheckHeader("InlineCreate").setState(!1,!1)},_searchSimilarIssues:function(){var e=this;if(n.is(e.input)&&n.is(e.dropdown)){var t=e.input.getValue().trim();t.length>0?m.search({data:{query:"(3dexpiss:#all) "+t,select_predicate:["resourceid","ds6w:created","ds6w:modified","ds6w:identifier","owner","ds6w:responsible","ds6wg:revision","ds6w:status","ds6w:label","ds6w:type"]}}).then(function(t){e.dropdown&&(Array.isArray(t.body.results)?e._similarities.issues=t.body.results.map(function(e){return h.parseFetchResponse(e).value}):e._similarities.issues=[],e.dropdown.removeItem(T),e._similarities.issues.length>0&&e.dropdown.addItem({id:T,text:f.replace(f.actions.create.issue.similarIssues,{count:e._similarities.issues.length}),title:f.replace(f.actions.create.issue.similarIssues,{count:e._similarities.issues.length}),fonticon:"open",className:"im-inline-create-similar-issues-header"}))}):(e._similarities.issues=[],e.dropdown.removeItem(T))}}})}),define("DS/IssueManagement/views/facets/Attachments",["UWA/Class/Promise","UWA/Core","UWA/Class/View","DS/IssueAttachmentManager/IssueAttachmentManager","DS/IssueCommon/commands/CommandsManager","DS/IssueManagement/views/facets/Placeholder","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","css!DS/IssueCommon/IssueCommon.css","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(e,t,n,i,s,o,a,r,l,c){"use strict";var d="ENX3DIR_AP";return n.extend({name:"DS/IssueManagement/views/facets/Attachments",tag:"div",className:"attachments-view fade-in-element",manager:null,_subscriberId:"",_eventListeners:[],setup:function(n){var s=this;r.start(s.name+" setup"),s._parent(n),s._deferred={},s.isLoaded=new e(function(e,t){s._deferred.resolve=e,s._deferred.reject=t}),s.target=t.createElement("div",{class:"attachments-content"}),s.container.setContent(s.target);var o=a.get("widget"),l=a.get("component"),c=o.body.getDimensions(),u={mode:2,catalogLayout:1,catalogVisibility:!0,sliderVisibility:!1,annotationPreLaunchCallback:function(){if(s.hasOwnProperty("modal")&&s.modal.hide(),o.name===d)try{this.annotationCanvasTarget=t.Element.getElement.call(l.get3DContext().root.getFrameWindow().elements.viewerFrame,"canvas")}catch(e){}else this.annotationCanvasDefaultDimensions={width:c.width-50,height:c.height-50}}},m=a.get("widget").getValue("attachmentManagerPreferences");u=t.merge(u,m||{});var p=s.getOption("physicalIds");u.id=p[p.length-1],s.manager=new i(u),s._subscriberId=Math.random().toString(36).substr(2,9),r.end(s.name+" setup")},render:function(){var e=this;!1===e.isValidSelection()?(e.target.hide(),e.placeholder.show(e.container)):(e.placeholder.hide(e.container),e.target.show()),r.start(e.name+" render");var t=a.get("component");return e.manager.render().inject(e.target),e.manager.isLoaded.then(function(){e.utils._addCustomCommands.apply(e),e.manager.container.setAttribute("tabindex","0"),e.manager.container.focus(),e.manager.resize(),e.listenTo(e.manager,"onRefresh",e.utils._addCustomCommands.bind(e)),e.listenTo(t,"onResize",function(){e.manager.resize()}),e.listenTo(e.manager,"onUpdate",function(t){for(var n=[],i={},s=Object.keys(t.objects),o=0;o<s.length;o++)n.push([t.objects[s[o]].physicalId]),i[t.objects[s[o]].physicalId]={id:t.objects[s[o]].physicalId,type:t.objects[s[o]].type||"Issue",modifiedAttributes:["attachments"]};a.get("eventsHandler").publish(e._subscriberId,"DS/Object/update",{metadata:{appId:a.get("widget").id,appName:a.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:n,attributes:i},version:"1.0"})}),e._eventListeners=[{event:"DS/Object/update",listener:function(t){e.manager&&e.manager.id&&(t.data.paths.some(function(t){return e.manager.id===t[0]})&&e.manager.refresh())},conditions:{type:"issue",attributes:["attachments","state"]}}];for(var n=0;n<e._eventListeners.length;n++){var i=e._eventListeners[n];i.token=a.get("eventsHandler").subscribe(e._subscriberId,i.event,i.listener.bind(e),i.conditions)}e._deferred.resolve(),e.dispatchEvent("onReady",{})}),r.end(e.name+" render"),e},refresh:function(t){var n=this;return n.setOption("physicalIds",t),n.isLoaded=new e(function(e,t){n._deferred.resolve=e,n._deferred.reject=t}),!1===n.isValidSelection()?(n.target.hide(),n.placeholder.show(n.container),setTimeout(function(){n._deferred.resolve(),n.dispatchEvent("onReady",{})},0),n.isLoaded):(n.placeholder.hide(n.container),n.target.show(),n.options.physicalIds=t,n.manager.refresh(n.options.physicalIds[n.options.physicalIds.length-1]).then(function(){n._deferred.resolve()}),n.isLoaded)},resize:function(){this.manager.resize()},destroy:function(){var e=a.get("component");if(this.stopListening(e,"onResize"),this.stopListening(this.manager,"onUpdate"),this.stopListening(this.manager,"onRefresh"),Array.isArray(this._eventListeners))for(var t=0;t<this._eventListeners.length;t++){var n=this._eventListeners[t];a.get("eventsHandler").unsubscribe(n.token)}this._eventListeners=[],this._subcriberId="",null!==this.manager&&(this.manager.destroy(),this.manager=null),this.destroy()},isValidSelection:function(){var e=this.getOption("physicalIds");return Array.isArray(e)&&1===e.length},placeholder:{_view:new o,show:function(e){this._view.render("attachments").inject(e),this._view.show()},hide:function(){this._view.hide(),this._view.empty()}},utils:{_addCustomCommands:function(){var e=this,t=function(){s.getCommand("AttachmentManager").begin({authoring:e.manager.authoring})};(e.manager.views.header.iconBarFix.addItem({id:"popup",fonticon:"popup",text:c.attachments.popup,selectable:!0,handler:t}),this.manager&&this.manager.contextualMenu&&this.manager.contextualMenu.customCommands)&&(this.manager.contextualMenu.customCommands.some(function(e){return"popup"===e.name})||this.manager.contextualMenu.customCommands.push({name:"popup",title:c.attachments.popup,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-popup"},data:null,action:{callback:t}}))}}})}),define("DS/IssueManagement/utils/customization/PADCustomizeView",["css!DS/UIKIT/UIKIT","css!DS/IssueManagement/IssueManagement.css","i18n!DS/IssueManagement/assets/nls/IssueManagement_list","UWA/Controls/Abstract","UWA/Class/Events","DS/Controls/Button","DS/Controls/Toggle","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Tree/TreeListView","DS/IssueServices/Contexts","DS/Core/PointerEvents","DS/IssueManagement/utils/customization/ComboSelector","DS/WidgetServices/WidgetServices"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p){"use strict";var h={apiVersion:2,defaultCellHeight:40,isEditable:!1,show:{columnHeaders:!0},resize:{columns:!1},height:"auto",isSortable:!1,columns:[]};return i.extend(s,{name:"padcustomizeview",_command_id:"",_applyOnlyToThisApp:!1,init:function(e){this._parent(e),this._reverts=[];var t=this;t.listView=d.get("ISU_LISTVIEW"),require(["DS/ENOFloatingPanel/ENOFloatingPanel"],function(i){e.events&&t.addEvents(e.events),t.render_div=document.querySelector(t.options.render_div),t._command_id=e.id,t.elements.container=t._createContent(e),t.elements.floatingpanel=new i({className:t.name,body:t.elements.container,footer:t._buildFooter(e),title:n[t.name+"_"+e.id+"_title"],persistId:"ISUColumnCustomization",overlay:!0,closable:!0,animate:!0,resizable:!0,visible:!0,events:{onClose:function(){t._closePanel(),t.elements.floatingpanel.destroy()}}}),t.elements.floatingpanel.inject(t.render_div)})},_closePanel:function(){this.options.cmd&&this.options.cmd.enable(),"ColumnVisibility"===this.options.id&&(!0===this._applyOnlyToThisApp?this.dispatchEvent("custoViewChange"):this.dispatchEvent("saveAsTemplate"))},_createContent:function(e){var t=this,i=UWA.createElement("div",{class:"padcustomizeview_content"}),s=UWA.createElement("div",{class:"padcustomizeview_body"}).inject(i);UWA.createElement("div",{class:this.name+"_instruction",content:n[this.name+"_"+e.id+"_instruction"]}).inject(s),this.content_document=new r({useAsyncPreExpand:!0,shouldAcceptDrag:function(e,t){return!1},shouldAcceptDrop:function(e){return!1}}),this.content_document.onNodeModelUpdate(this._onNodeModelUpdate.bind(this));var o=UWA.clone(h);if(o.columns.push({width:40,dataIndex:"pad_toggle",isDraggable:!1,isSortable:!1,setValue:function(e){t.content_document.withTransactionUpdate(function(){e.nodeModel.updateOptions({updateType:"visibility",grid:{pad_toggle:e.value}})});var n=t.content_treelist.getManager().getColumnIDFromDataIndex("pad_toggle");t.content_treelist.getManager().updateCellView(-1,n)},getValue:function(e){return t._isSelected(e.nodeModel)},onCellChange:function(e){return e.event.target.dsModel.checkFlag},onCellRequest:function(e){var n;if(e.isHeader)""===e.cellView.getContent().innerHTML&&((n=new a({checkFlag:t._isEveryVisibleNodeSelected()&&t.columnHeader,mixedState:!t._isNoVisibleNodeSelected()&&!t._isEveryVisibleNodeSelected()})).getContent().addEventListener(u.POINTERDOWN,function(e){e.stopPropagation()}),n.getContent().addEventListener("focus",function(e){e.preventDefault(),e.stopPropagation()}),n.getContent().addEventListener("change",function(e){e.dsModel.checkFlag||e.dsModel.mixedState?(t.columnHeader=e.dsModel.checkFlag,t._toggleAllVisibleNodes(!0)):(t.columnHeader=e.dsModel.checkFlag,t._toggleAllVisibleNodes(!1))}),e.cellView.getContent().setHTML(n));else if(t._isLocked(e.nodeModel))e.cellView.getContent().setHTML('<span class="fonticon fonticon-block " style="padding-left:5px;color: #b2b4b8;"></span>');else{var i=e.cellView.reuseCellContent("_pad_toggle");i&&(i.checkFlag=t._isSelected(e.nodeModel),i.disabled=t._isLocked(e.nodeModel))}}}),o.columns.push({text:n.padcustomizeview_column_name_header,dataIndex:"tree",width:"auto",isDraggable:!1}),t.listView&&"ColumnVisibility"===this.options.id&&(o.isEditable=!0,o.columns.push({text:n.padcustomizeview_color_header,dataIndex:"column_color",width:60,isDraggable:!0,isColumnMovable:!1,isEditable:!1,onCellRequest:function(e){if(!e.isHeader){var t="#ffffff";e.nodeModel.options.grid&&e.nodeModel.options.grid.column_color&&(t=e.nodeModel.options.grid.column_color["background-color"]?e.nodeModel.options.grid.column_color["background-color"]:"#ffffff"),t=t.replace(/;/g,"");var n="#000000";e.nodeModel.options.grid&&e.nodeModel.options.grid.column_color&&(n=e.nodeModel.options.grid.column_color.color?e.nodeModel.options.grid.column_color.color:"#0000"),n=n.replace(/;/g,"");var i=UWA.createElement("div",{class:"padcustomizeview_colorpicker font-3dsregular",text:"a",styles:{"background-color":t,color:n}});i.addEvent("click",function(t){t.preventDefault(),t.stopPropagation(),require(["DS/PADServices/views/private/ColorPicker"],function(t){var n=e.nodeModel.options.grid.column_color,i="#ffffff",s="#000000";n.color;n&&(i=n["background-color"].toLowerCase().replace(";",""),s=n.color.toLowerCase().replace(";","")),new t({selected_color:{background_color:i,color:s},renderTo:document.body,events:{onColorOK:function(t){e.nodeModel.updateOptions({updateType:"color",grid:{column_color:{"background-color":t.background_color+";",color:t.color+";"}}})}}})})}),e.cellView.getContent().setHTML(i)}}})),o.shouldDisplayTooltip=this.provideTooltip.bind(this),o.shouldBeEditable=this.shouldBeEditable.bind(this),this.content_treelist=new c(o),this.content_treelist.getManager().registerReusableCellContent({id:"_pad_toggle",buildContent:function(){var e=new a({checkFlag:!1});return e.getContent().addEventListener(u.POINTERDOWN,function(e){e.stopPropagation()}),e.getContent().addEventListener("focus",function(e){e.preventDefault(),e.stopPropagation()}),e}}),"ColumnVisibility"===this.options.id&&this.options.events.saveAsTemplate?this.content_treelist.getContent().addClassName("padcustomizeview_columnvisibility"):this.content_treelist.getContent().addClassName("padcustomizeview_options"),this.content_treelist.inject(s),this.content_treelist.getManager().loadDocument(this.content_document),this.loadRows(e),"ColumnVisibility"===this.options.id&&this.options.events.saveAsTemplate){var d=UWA.createElement("div",{class:"padcustomizeview_footer"}).inject(i);d.addClassName("compactModeAvailable"),s.addClassName("compactModeAvailable");var g=new r,f=new l({viewMode:"comfortable",label:n.Comfortable,subLabel:n.ComfortableExplanation,children:null,icons:[{iconName:"view-big-tile",fontIconFamily:WUXManagedFontIcons.Font3DS}]});g.addRoot(f);var v=new l({viewMode:"compact",label:n.Compact,subLabel:n.CompactExplanation,children:null,icons:[{iconName:"view-list",fontIconFamily:WUXManagedFontIcons.Font3DS}]});g.addRoot(v),this._hasThumbNail?(this.options.viewMode="comfortable",f.select(!0)):"compact"===this.options.viewMode?v.select(!0):f.select(!0),this.comboCompact=new m({className:"compactModeSelector",treedocument:g,withMore:!1,disabled:this.options.thumbnails,multisel:!1,events:{onSelectionChange:function(){t.dispatchEvent("compactMode",{viewMode:g.getSelectedNodes()[0].options.viewMode})}}}),p.isTouchDevice()&&(this.options.viewMode="comfortable",f.select(!0),this.comboCompact.disabled(!0)),this._hasThumbNail&&this.comboCompact.disabled(!0);var b=UWA.createElement("div",{class:this.name+"_footerArea comboDiv"});UWA.createElement("div",{class:"comboLabel",text:n.density}).inject(b),this.comboCompact.inject(b),b.inject(d),this.applyToggle=new a({label:n.padcustomizeview_apply_to_this_app});var I=UWA.createElement("div",{class:this.name+"_footerArea applyToggle",content:this.applyToggle});this.applyToggle.inject(I),I.inject(d),this.applyToggle.addEventListener("change",function(e){var n=e.dsModel;t._applyOnlyToThisApp=n.checkFlag})}return i},_buildFooter:function(e){var t=this,i=UWA.createElement("div",{class:"footerModal"});if("ColumnVisibility"===this.options.id){var s=new o({label:n.padcustomizeview_button_close,emphasize:"primary",touchMode:!0});s.addEventListener("click",function(){t._closePanel(),t.elements.floatingpanel.destroy()}),s.inject(i)}else{var a=new o({label:n.padcustomizeview_button_save,emphasize:"primary",touchMode:!0});a.addEventListener("click",function(){t._closePanel(),t.elements.floatingpanel.destroy(),"PrintOptions"!==t.options.id&&"ExportCSVOptions"!==t.options.id||t.dispatchEvent("ok")}),a.inject(i);var r=new o({label:n.padcustomizeview_button_cancel,emphasize:"secondary",touchMode:!0});r.addEventListener("click",function(){t._processReverts(),t.elements.floatingpanel.destroy()}),r.inject(i)}var l=new o({label:n.padcustomizeview_button_reset,touchMode:!0});return l.inject(i),l.addEventListener("click",function(){window.top.performance.mark("reset_event_begin"),t.dispatchEvent("reset"),!1===require("DS/PADUtils/PADSettingsMgt").getSetting("readsettingsv2")&&(t._closePanel(),t.elements.floatingpanel.destroy())}),i},provideTooltip:function(e){var t="";if(e.model.options.isHeader)t="";else switch(e.dataIndex){case"pad_toggle":t=this._isLocked(e.nodeModel)?t=n.padcustomizeview_tooltip_cannot_hide:n.padcustomizeview_tooltip_show_or_hide;break;case"tree":t="";break;case"column_color":t=n.padcustomizeview_tooltip_set_color;break;default:t=""}return{longHelp:t}},shouldBeEditable:function(e){var t=!0;if(!0===e.isHeader)t=!1;else if("tree"===e.dataIndex){var n=e.nodeModel.options.origin_dataIndex;"selection"!==n&&"hide_show"!==n&&"find_in_ctx"!==n&&"thumbnail"!==n&&"ds6w:reserved"!==n||(t=!1)}return t},loadRows:function(e,t){var i=this;function s(e,t){var s={label:function(e){var t="";if(""===e.text||null===e.text||void 0===e.text){var i="treelistview_customization_"+e.dataIndex;if(UWA.is(n[i]))t=n[i];else{var s=e.dataIndex.split(":");t=s&&2===s.length?s[1]:e.dataIndex}}else t=e.text;return t}(e),children:null,grid:{pad_toggle:!e.isHidden},origin_dataIndex:e.dataIndex,editableLabel:!(""===e.text||null===e.text||void 0===e.text)},o=e.customisation?e.customisation:e.xnav_options;switch(t){case"PrintOptions":case"ExportCSVOptions":s.grid.pad_toggle=!o.exportable||o.exportable.value,s.lock=!o.exportable||o.exportable.lock;break;case"ColumnVisibility":s.lock=!!o.layout&&(void 0!==o.layout.removable?!1===o.layout.removable:!!o.layout.lock&&o.layout.lock);var a={"background-color":"#ffffff",color:"#000000"};o.layout&&void 0!==o.layout.styles&&Object.keys(o.layout.styles).length>0&&(a={"background-color":o.layout.styles.backgroundColor?o.layout.styles.backgroundColor:o.layout.styles["background-color"],color:o.layout.styles.color}),s.grid.column_color=a,"thumbnail"===e.dataIndex&&!1===e.isHidden&&(i._hasThumbNail=!0)}return s}this.content_document&&(this.content_document.unselectAll(),this.content_document.removeRoots()),i.content_document.withTransactionUpdate(function(){e.columns.forEach(function(n){if(function(e,t){var n=!0,i=e.customisation?e.customisation:e.xnav_options;if(i)switch(t){case"PrintOptions":case"ExportCSVOptions":i.exportable&&!0===i.exportable.lock&&!1===i.exportable.value&&(n=!1)}else n=!1;return n}(n,e.id)){var o=s(n,e.id);!0===t&&"thumbnail"===o.origin_dataIndex&&!1===o.grid.pad_toggle&&i.comboCompact&&(i.comboCompact.disabled(!1),i.comboCompact.dispatchEvent("onSelectionChange")),i.content_document.addRoot(o)}})})},_isSelected:function(e){return e.options.grid.pad_toggle},_isLocked:function(e,t){var n=e.options.lock;return"tree"!==e.options.origin_dataIndex&&"Title"!==e.options.label||(n=!0),n},_isEveryVisibleNodeSelected:function(){for(var e=!0,t=this.content_document.getRoots(),n=0;n<t.length&&e;n++)t[n].isVisible()&&!1===t[n].options.lock&&!1===t[n].options.grid.pad_toggle&&(e=!1);return e},_isNoVisibleNodeSelected:function(){for(var e=!0,t=this.content_document.getRoots(),n=0;n<t.length&&e;n++)t[n].isVisible()&&!1===t[n].options.lock&&!0===t[n].options.grid.pad_toggle&&(e=!1);return e},_toggleAllVisibleNodes:function(e){var t=this;this.content_document.withTransactionUpdate(function(){for(var n=t.content_document.getRoots(),i=0;i<n.length;i++)!0!==n[i].options.lock&&n[i].updateOptions({updateType:"visibility",grid:{pad_toggle:e}})})},_onNodeModelUpdate:function(e){var t={dataIndex:e.target.options.origin_dataIndex};switch(this._command_id){case"PrintOptions":case"ExportCSVOptions":t.exportable=e.target.options.grid.pad_toggle;for(var n={dataIndex:t.dataIndex,exportable:!t.exportable},i=!1,s=0;s<this._reverts.length;s++)if(this._reverts[s].dataIndex===n.dataIndex){i=!0;break}i||this._reverts.push(n);break;case"ColumnVisibility":e.target.options.editableLabel&&(t.headerName=e.target.options.label),t.column_color=e.target.options.grid.column_color,t.isHidden=!e.target.options.grid.pad_toggle}if("thumbnail"===t.dataIndex&&"visibility"===e.target.options.updateType&&this.comboCompact)if(t.isHidden)this.comboCompact.disabled(!1);else{for(var o=this.comboCompact.options.treedocument.getRoots(),a=0;a<o.length;a++){var r=o[a];"compact"===r.options.viewMode&&r.unselect(),"comfortable"===r.options.viewMode&&r.select()}this.comboCompact.dispatchEvent("onSelectionChange"),this.comboCompact.disabled(!0)}this.dispatchEvent("modifyColumRendering",t)},_processReverts:function(){var e=this;this._reverts.forEach(function(t){e.dispatchEvent("modifyColumRendering",t)}),this._reverts.length=0}})}),define("DS/IssueManagement/components/ContextualMenu",["UWA/Class/Promise","DS/WebappsUtils/WebappsUtils","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueManagement/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","DS/IssueCommon/utils/DocumentUtils","DS/IssueCommon/utils/Utils","DS/IssueAttachmentManager/services/AttachmentServices","i18n!DS/IssueManagement/assets/nls/IssueManagement","text!DS/IssueCommon/assets/Settings.json"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h){"use strict";var g="Issue",f="Closed",v="ListView",b={REPORTED_AGAINST:"reportedAgainst",RESOLVED_BY:"resolvedBy",RESOLVED_ITEMS:"resolvedItems",CONTEXTS:"contexts",OPEN_WITH:"Open with",OPEN:"Open"},I={REPORTED_AGAINST:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-location",RESOLVED_BY:"wux-ui-3ds wux-ui-3ds-1x fonticon-docs",RESOLVED_ITEMS:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-3d-object",CONTEXTS:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-3d-object",OPEN_WITH:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-menu-dot",OPEN:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open"},y=100,w="DS/IssueManagement/components/ContextualMenu",S=function(){var e=o.get("component").getTreeListView().getManager().getKeymapManager();e.wait(),setTimeout(function(){e.listen()},y);var t=o.get("component").getKanbanView();t.columns[t.currentView].forEach(function(e){var t=e.grid._keymapManager;t.wait(),setTimeout(function(){t.listen()},y)})};return{getContextualMenuHeader:function(t){var n=[],i=o.get("component").getTreeListView().getManager(),s=o.get("ISU_LISTVIEW");n.push({title:p.commands.sizeColumnToFit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-arrow-double-combo"},action:{callback:function(){s&&S(),i.sizeColumnToFit(t)}}});var a=i.getColumnIDFromDataIndex(t);return"none"!==i.getColumnOrderState(a)&&n.push({title:p.commands.clearSortOrder,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-sorting"},action:{callback:function(){s&&S(),i.setColumnOrderState(a,"none"),o.get("component").getTreeListView().preferences.resetPreferences({sort:!0})}}}),e.resolve(n)},getContextualMenu:function(){var t=o.get("component").getTreeDocument().getSelectedNodes();if(0===t.length)return e.resolve([]);var n=t.reduce(function(e,t){var n=[],i=[],s=[],o=[];t.options.reportedAgainst.forEach(function(e){var t=e.physicalId.split(","),i=t[t.length-1];n.push({physicalId:i,path:e.physicalId,type:e.type,name:e.name,title:e.title?e.title:e.name})}),t.options.resolvedBy.forEach(function(e){i.push({physicalId:e.physicalId,type:e.type,name:e.name,title:e.title?e.title:e.name})}),t.options.resolvedItems.forEach(function(e){s.push({physicalId:e.physicalId,type:e.type,name:e.name,title:e.title?e.title:e.name})}),t.options.contexts.forEach(function(e){o.push({physicalId:e.physicalId,type:e.type,name:e.name,title:e.title?e.title:e.name})});var a=t.options.id.split(","),r=a[a.length-1],l=t.options.grid.Approvals;return e.push({physicalId:r,path:t.options.id,parentId:t.options.data.issue,relationToIssue:t.options.data.relationToIssue,type:t.options.type,baseType:t.options.baseType,name:t.options.name,title:t.options.title,state:t.options.state,reportedAgainst:n,resolvedBy:i,resolvedItems:s,contexts:o,approvals:l}),e},[]);return this._getMenu({objects:n,isList:o.get("component").getCurrentView()===v})},_getMenu:function(t){var n=this,i=[],s=Array.isArray(t.objects)?t.objects:[];return 0===s.length?e.resolve([]):(l.start(w+" _getMenu"),t.allObjectsAreIssues=s.every(function(e){return e.baseType===g}),t.allObjectsAreNotIssues=s.every(function(e){return e.baseType!==g}),t.atLeastOneIssueIsClosed=s.some(function(e){return e.state===f}),t.atLeastOneIssueIsNotClosed=s.some(function(e){return e.state!==f}),t.allObjectsAreIssues&&1===s.length&&(t.approvals=s[0].approvals),n._getApprovalMenu(t).then(function(e){i=i.concat(e)}).then(function(){return n._getOpenWithMenu(t)}).then(function(e){o.get("isNatifEnvironnement")||(i=i.concat(e))}).then(function(){return n._getBasicMenu(t)}).then(function(e){return i=i.concat(e),l.end(w+" _getMenu"),i}))},_getApprovalMenu:function(t){var s=[];o.get("component").getTreeDocument().getSelectedNodes();if(t.allObjectsAreIssues&&1===t.objects.length){var a={type:"CheckItem",icon:"check",state:"unselected",action:{callback:function(e,s){var l=a.state,c={id:t.objects[0].physicalId};"selected"===l?r.issues.disableApproval({data:c,onComplete:function(e){var n=o.get("component").getTreeDocument();n.undoRegisterNodeModelUpdateEvent(),n.withTransactionUpdate(function(){n.getSelectedNodes()[0].updateOptions({validation:{activated:!1},grid:{Approvals:!1,"ds6w:validation":{activated:!1}}})}),n.registerNodeModelUpdateEvent();var s=[[t.objects[0].physicalId]],a={};a[t.objects[0].physicalId]={id:t.objects[0].physicalId,type:"Issue",modifiedAttributes:["Approvals"]},i.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:s,attributes:a},version:"1.0"})},onFailure:function(e){if(UWA.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Waiting On' for")){var t=u.getErrorMessage("2005");u.displayErrorMessage(t,"error")}else n.displayNotification({msg:e.error.message,eventID:"error"})}}):r.issues.enableApproval({data:c,onComplete:function(e){var n=o.get("component").getTreeDocument();n.undoRegisterNodeModelUpdateEvent(),n.withTransactionUpdate(function(){n.getSelectedNodes()[0].updateOptions({validation:{activated:!0},grid:{Approvals:!0,"ds6w:validation":{activated:!0}}})}),n.registerNodeModelUpdateEvent();var s=[[t.objects[0].physicalId]],a={};a[t.objects[0].physicalId]={id:t.objects[0].physicalId,type:"Issue",modifiedAttributes:["Approvals"]},i.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:s,attributes:a},version:"1.0"})},onFailure:function(e){if(UWA.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Waiting On' for")){var t=u.getErrorMessage("2005");u.displayErrorMessage(t,"error")}else n.displayNotification({msg:e.error.message,eventID:"error"})}})}}};t.approvals?(a.state="selected",a.title=p.commands.approvalOn):a.title=p.commands.approvalOff,s.push(a),s.push({type:"SeparatorItem"})}return e.resolve(s)},_getBasicMenu:function(t){var n=this,i=o.get("ISU_LISTVIEW");l.start(w+" _getBasicMenu");var a=o.get("component").getTreeDocument().getSelectedNodes(),r=[],c=Array.isArray(t.objects)?t.objects:[];if(0===c.length)return r;var g=null,f=JSON.parse(h).duplicateIssues,v=new e(function(e){e()});return v=v.then(function(){return!0===t.allObjectsAreNotIssues&&1===c.length&&"Document"===c[0].type?m.getDocuments([c[0].physicalId]).then(function(e){g=e.data[0]}):e.resolve()}).then(function(){if(!0===t.allObjectsAreIssues){if(!0===t.isList){var e=o.get("component").getTreeDocument().getIssuesFromSelectedNodes(),m=e.every(function(e){return!Array.isArray(e.getChildren())||!0===e.isExpanded()}),h=e.every(function(e){return!Array.isArray(e.getChildren())||!1===e.isExpanded()}),v=e.every(function(e){return!Array.isArray(e.getChildren())});!1===v&&(!0===h||!1===m&&!1===h)&&r.push({name:"Expand",title:p.commands.expandAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye"},data:null,action:{callback:function(){i&&S();var e=o.get("component").getTreeDocument();e.withTransactionUpdate(function(){for(var t=e.getSelectedNodes(),n=0;n<t.length;n++)t[n].expand()})}}}),!1===v&&(!0===m||!1===m&&!1===h)&&r.push({name:"Collapse",title:p.commands.collapseAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye-off"},data:null,action:{callback:function(){i&&S();var e=o.get("component").getTreeDocument();e.withTransactionUpdate(function(){for(var t=e.getSelectedNodes(),n=0;n<t.length;n++)t[n].collapse()})}}}),r.push({type:"SeparatorItem"})}c.length<=f&&r.push({name:"Duplicate",title:p.commands.duplicate,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-duplicate"},data:null,action:{callback:function(){i&&S(),s.getCommand("Duplicate").begin()}}}),!0===t.atLeastOneIssueIsNotClosed&&r.push({name:"Close",title:p.commands.close,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-status-change"},data:null,action:{callback:function(){i&&S(),s.getCommand("Close").begin()}}}),!0===t.atLeastOneIssueIsClosed&&r.push({name:"Reopen",title:p.commands.reopen,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-open"},data:null,action:{callback:function(){i&&S(),s.getCommand("Reopen").begin()}}}),r.push({name:"CollaborativeLifecycle",title:p.commands.collaborativeLifecycle,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){i&&S(),s.getCommand("CollaborativeLifecycle").begin()}}}),r.push({type:"SeparatorItem"}),r.push({name:"Move",title:p.commands.move,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-move-to"},data:null,action:{callback:function(){i&&S(),s.getCommand("Move").begin()}}}),r.push({name:"Share",title:p.commands.share,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-link"},data:null,action:{callback:function(){s.getCommand("Share").begin()}}}),r.push({type:"SeparatorItem"}),1===c.length&&r.push({name:"Attachments",title:p.commands.attachments,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-attach"},data:null,action:{callback:function(){i&&S(),s.getCommand("AttachmentManager").begin()}}}),o.get("isNatifEnvironnement")||r.push({name:"RelationalExplorer",title:p.commands.relationalExplorer,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-object-related"},data:null,action:{callback:function(){i&&S(),s.getCommand("RelationalExplorer").begin()}}}),r.push({type:"SeparatorItem"}),r.push({name:"Delete",title:p.commands.delete,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-trash"},data:null,action:{callback:function(){i&&S(),s.getCommand("Delete").begin()}}}),r.push({type:"SeparatorItem"})}else if(!0===t.allObjectsAreNotIssues){if(r.push({type:"SeparatorItem"}),1===c.length&&"Document"===c[0].type){var b={data:g,from:"summary"};(y=[]).push(a[0].options);var I={data:g,from:"summary",menu:n,selected:y};r.push({name:"Preview",title:p.commands.preview,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-eye"},data:null,action:{callback:function(){d.preview(I)}}}),r.push({type:"SeparatorItem"}),""===g.relateddata.files[0].dataelements.locker?r.push({name:"Edit",title:p.commands.edit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-pencil"},data:null,action:{callback:function(){d.edit(b)}}}):(r.push({name:"UndoEdit",title:p.commands.undoEdit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-undo"},data:null,action:{callback:function(){d.undoEdit(b)}}}),r.push({name:"Update",title:p.commands.update,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-upload"},data:null,action:{callback:function(){d.update(b)}}}))}if(r.push({type:"SeparatorItem"}),r.push({name:"CollaborativeLifecycle",title:p.commands.collaborativeLifecycle,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){i&&S(),s.getCommand("CollaborativeLifecycle").begin()}}}),o.get("isNatifEnvironnement")||c.length<=2&&(r.push({name:"Compare",title:p.commands.compare,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-compare-on"},data:null,action:{callback:function(){i&&S(),s.getCommand("Compare").begin()}}}),r.push({type:"SeparatorItem"})),c.every(e=>"Document"==e.type)){for(var y=[],C=0;C<a.length;C++)y.push(a[C].options);var E={data:g,from:"summary",menu:n,selected:y};r.push({name:"Download",title:p.commands.download,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-download"},data:null,action:{callback:function(){d.download(E)}}})}o.get("isNatifEnvironnement")||(r.push({name:"RelationalExplorer",title:p.commands.relationalExplorer,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-object-related"},data:null,action:{callback:function(){i&&S(),s.getCommand("RelationalExplorer").begin()}}}),1===c.length&&r.push({name:"information",title:p.commands.information,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-properties"},data:null,action:{callback:function(){u.viewProperties(c[0].physicalId)}}})),r.push({name:"Detach",title:p.commands.detach,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"},data:null,action:{callback:function(){i&&S(),s.getCommand("Detach").begin()}}})}else r=!0===t.isList?n._getListMenu():n.getKanbanMenu(),o.get("isNatifEnvironnement")||r.push({name:"RelationalExplorer",title:p.commands.relationalExplorer,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-object-related"},data:null,action:{callback:function(){i&&S(),s.getCommand("RelationalExplorer").begin()}}});return l.end(w+" _getBasicMenu"),r})},_getOpenWithMenu:function(t){var n=[];if(0===(Array.isArray(t.objects)?t.objects:[]).length)return e.resolve([]);if(o.get("isNatifEnvironnement"))return e.resolve([]);if(!0===t.allObjectsAreIssues){var i=[],s=[],a=[],r=[];t.objects.forEach(function(e){i=i.concat(e.contexts),s=s.concat(e.reportedAgainst),a=a.concat(e.resolvedBy),r=r.concat(e.resolvedItems)});var l=[];return e.all([this._getOpenWithSubMenu({name:b.CONTEXTS,label:p.commands.open.contexts,objects:i,icon:I.CONTEXTS}),this._getOpenWithSubMenu({name:b.REPORTED_AGAINST,label:p.commands.open.reportedAgainst,objects:s,icon:I.REPORTED_AGAINST}),this._getOpenWithSubMenu({name:b.RESOLVED_BY,label:p.commands.open.resolvedBy,objects:a,icon:I.RESOLVED_BY}),this._getOpenWithSubMenu({name:b.RESOLVED_ITEMS,label:p.commands.open.resolvedItems,objects:r,icon:I.RESOLVED_ITEMS})]).then(function(e){return(l=e.reduce(function(e,t){return e.concat(t)},[])).length>0&&(n.push({name:b.OPEN,title:p.commands.open.multiple,type:"PushItem",data:null,fonticon:{content:I.OPEN},submenu:l}),n.push({type:"SeparatorItem"})),n})}return!0===t.allObjectsAreNotIssues?this._getOpenWithSubMenu({name:b.OPEN_WITH,label:p.commands.open.single,objects:t.objects,icon:I.OPEN_WITH}):e.resolve([])},_getListMenu:function(){var e=[],t=o.get("ISU_LISTVIEW"),n=o.get("component").getTreeDocument().getIssuesFromSelectedNodes(),i=n.every(function(e){return!Array.isArray(e.getChildren())||!0===e.isExpanded()}),a=n.every(function(e){return!Array.isArray(e.getChildren())||!1===e.isExpanded()}),r=n.every(function(e){return!Array.isArray(e.getChildren())});return!1===r&&(!0===a||!1===i&&!1===a)&&e.push({name:"Expand",title:p.commands.expandAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye"},data:null,action:{callback:function(){t&&S();var e=o.get("component").getTreeDocument();e.withTransactionUpdate(function(){for(var t=e.getSelectedNodes(),n=0;n<t.length;n++)t[n].expand()})}}}),!1===r&&(!0===i||!1===i&&!1===a)&&e.push({name:"Collapse",title:p.commands.collapseAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye-off"},data:null,action:{callback:function(){t&&S();var e=o.get("component").getTreeDocument();e.withTransactionUpdate(function(){for(var t=e.getSelectedNodes(),n=0;n<t.length;n++)t[n].collapse()})}}}),e.push({type:"SeparatorItem"}),e.push({name:"CollaborativeLifecycle",title:p.commands.collaborativeLifecycle,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){t&&S(),s.getCommand("CollaborativeLifecycle").begin()}}}),e.push({type:"SeparatorItem"}),e.push({name:"Share",title:p.commands.share,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-link"},data:null,action:{callback:function(){s.getCommand("Share").begin()}}}),"SeparatorItem"===e[e.length-1].type&&e.pop(),e},getKanbanMenu:function(){var e=[];return e.push({name:"CollaborativeLifecycle",title:p.commands.collaborativeLifecycle,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){listView&&S(),s.getCommand("CollaborativeLifecycle").begin()}}}),e.push({type:"SeparatorItem"}),e.push({name:"Share",title:p.commands.share,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-link"},data:null,action:{callback:function(){s.getCommand("Share").begin()}}}),e},_getOpenWithSubMenu:function(t){if(!t||!Array.isArray(t.objects)||0===t.objects.length)return e.resolve([]);var n=[],i=[],s=t.objects;return l.start(w+" _getOpenWithSubMenu"),new e(function(e){for(var d=[],u=0;u<s.length;u++){var m=s[u];d.push(m.type),i.push({envId:a.getTenant(),serviceId:"3DSpace",objectId:m.physicalId,objectType:m.type,objectTaxonomies:[m.type],displayName:m.title+"("+m.name+")"})}r.getTypesHierarchy({types:d,onComplete:function(a){if(UWA.is(a.types_hierarchies,"array")&&a.types_hierarchies.forEach(function(e,t){i.forEach(function(t,n){t.objectTaxonomies[0]===e.type&&(t.objectTaxonomies=t.objectTaxonomies.concat(e.hierarchy))})}),0===i.length)return l.end(w+" _getOpenWithSubMenu"),void e(n);var r=o.get("widget")||window.widget;c.getOpenWith().set3DXContent({protocol:"3DXContent",version:"1.1",source:r.name,widgetId:r.id,data:{items:i}},!0).retrieveCompatibleApps(function(i){if(i&&i.length>0){var a=[],r=[];if(i.forEach(function(e){r={name:e.text.replace(/ /g,""),type:"PushItem",title:e.text,action:{callback:function(t){o.get("ISU_LISTVIEW")&&S(),o.get("component").utils.setTypesCallbackForOFW(s),e.handler.call(t)}}},null!=e.fonticon?r.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon}:r.icon=e.icon,a.push(r)}),a.length>0){var c={name:t.name,type:"PushItem",fonticon:{content:t.icon},title:t.label,submenu:a};n.push(c)}}l.end(w+" _getOpenWithSubMenu"),e(n)})},onFailure:function(t){e(n)}})})}}}),define("DS/IssueManagement/components/header/Filter",["UWA/Class/View","UWA/Core","DS/UIKIT/DropdownMenu","DS/UIKIT/Iconbar","DS/WUXAutoComplete/AutoComplete","DS/Menu/Menu","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/TooltipModel","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DataDragAndDrop/DataDragAndDrop","DS/PADUtils/views/PADAlert","DS/IssueManagement/components/ContextualMenu","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Views","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,b,I,y,w,S,C){"use strict";return e.extend({name:"DS/IssueManagement/components/header/Filter",tagName:"div",className:"filter-container",_logger:null,elements:{bar:null,menu:null},filter:{},setup:function(e){S.start(this.name+" setup"),this._parent(e),this.elements={bar:null,menu:null},S.end(this.name+" setup")},render:function(){return this},getFilterMenu:function(){var e=JSON.parse(widget.getValue("filter")),t=widget.getValue("roots");!1===Array.isArray(t)&&(t=[]);var n=!1;widget.getValue("contextFilter")&&(n=!0);var i=[{text:C.filter.session.header,className:"header"},{name:"session",text:t.length>0?C.replace(C.filter.session.title,{number:t.length}):C.filter.session.nothing,selectable:!0,selected:!0===e.session,disabled:0===t.length},{name:"owned",text:C.filter.owned,selectable:!0,selected:!0===e.owned},{name:"assigned",text:C.filter.assigned,selectable:!0,selected:!0===e.assigned},{className:"divider"},{name:"contributed",text:C.filter.others.contributed,selectable:!0,selected:!0===e.contributed},{className:"divider"},{name:"closed",text:C.filter.others.closed,selectable:!0,selected:!0===e.closed},{className:"divider"},{name:"filterbyobject",text:C.filter.filterbyobject.title,selectable:!0,selected:n}];return widget.getPreference("organizationFilter").value&&i.splice(5,0,{name:"reported",text:C.filter.others.reported,selectable:!0,selected:!0===e.reported,disabled:!0===e.synchronize},{name:"responsible",text:C.filter.others.responsible,selectable:!0,selected:!0===e.responsible}),i},showContextFilter:function(){var e=this;if(b.get("actionBar")){var n=b.get("actionBar").getIconBar().getItem("ContextFilter").elements.container;n.show()}if(e.filterDiv&&e.filterDiv.show(),widget.setValue("contextFilter",!0),e.autoCompleteFilter)e.autoCompleteFilter.focus();else{e.filterDiv=t.createElement("div",{class:"filter-context"}),e.makeDroppable(e.filterDiv);var i=b.get("actionBar");if(n.getBoundingClientRect().left-i.container.getBoundingClientRect().left<300?e.filterDiv.inject(i.container.parentElement):e.filterDiv.inject(n),e.modelForFilter=new m,e.modelForRecentObjects=new m,e.recentObjects=[],I.preferences.get({data:{name:"recentFilterObjects"}}).then(function(t){""!==t.body&&(e.recentObjects=t.body)}),e.autoCompleteFilter=new s({elementsTree:function(t){return e.modelForRecentObjects.empty(),e.modelForFilter.empty(),t.length<3?e.recentObjects.length>0?new Promise(function(t,n){I.fetch({data:{objects:e.recentObjects.map(function(e){return{physicalId:e}})},onComplete:function(n){var i=n.body;e.modelForRecentObjects.prepareUpdate(),i.results&&i.results.length>0&&(i.results.sort((t,n)=>{var i=e.parseFetchAttributes(t),s=e.parseFetchAttributes(n);const o=i.id,a=s.id;return e.recentObjects.indexOf(o)-e.recentObjects.indexOf(a)}),i.results.forEach(function(t){var n=e.parseFetchAttributes(t);n.revision=void 0===n.revision?"":n.revision,n.identifier=void 0===n.identifier?"":" ("+n.identifier+")";var i=n.label+" "+n.revision+n.identifier,s=new p({label:i,value:n.id,name:n.identifier,id:n.id,icon:n.icon,icons:["clock",t.attributes.icon],type:n.type});e.modelForRecentObjects.addRoot(s)})),e.modelForRecentObjects.pushUpdate(),t(e.modelForRecentObjects)},onFailure:function(n){t(e.modelForRecentObjects)}})}):void 0:new Promise(function(n,i){setTimeout(function(){I.getRelatedObjects({text:t}).then(function(t){e.modelForFilter.prepareUpdate();for(var i=0;i<t.length;i++){t[i].identifier;t[i].revision=void 0===t[i].revision?"":t[i].revision,t[i].identifier=void 0===t[i].identifier?"":" ("+t[i].identifier+")";var s=t[i].label+" "+t[i].revision+t[i].identifier,o=new p({label:s,value:t[i].id,name:t[i].identifier,id:t[i].id,icon:t[i].icon,type:t[i].type});e.modelForFilter.addRoot(o)}e.modelForFilter.pushUpdate(),n(e.modelForFilter)},function(t){n(e.modelForFilter)})},1e3)})},placeholder:C.filter.filterbyobject.placeholder,customFilterMessage:C.filter.filterbyobject.filterMessage,multiSearchMode:!1,allowFreeInputFlag:!1,minLengthBeforeSearch:0,keepSearchResultsFlag:!1}).inject(e.filterDiv),e.autoCompleteFilter.focus(),widget.getValue("selectedContext")){var r=new p(widget.getValue("selectedContext"));e.autoCompleteFilter.selectedItems=r}e.autoCompleteFilter.addEventListener("change",function(){var t="";if(e.autoCompleteFilter.selectedItems&&(t=e.autoCompleteFilter.selectedItems.options,!e.recentObjects.includes(t.id))){if(e.recentObjects.unshift(t.id),e.recentObjects.length>5){for(var n=[],i=0;i<5;i++)n.push(e.recentObjects[i]);e.recentObjects=n}I.preferences.set({data:{name:"recentFilterObjects",value:JSON.stringify(e.recentObjects)}}).catch(function(t){e._logger.error("Could not save the preferences: %o",t)})}widget.setValue("selectedContext",t),widget.dispatchEvent("onRefresh",["filter"]),widget.dispatchEvent("endEdit")});var l=new a({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"search",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(e.filterDiv);l.tooltipInfos=new c({shortHelp:C.filter.filterbyobject.search}),l.getContent().addEventListener("buttonclick",function(){e.searchContext()});var d=new a({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"chevron-down",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(e.filterDiv);d.tooltipInfos=new c({shortHelp:C.filter.filterbyobject.menu.title}),d.getContent().addEventListener("buttonclick",function(){var t=this.getBoundingClientRect(),n={position:{x:t.left-140,y:t.top+30}};e.getContextualMenu().then(function(e){o.show(e,n)})})}},parseFetchAttributes:function(e){var t={};return e.attributes.forEach(function(e){"ds6w:type"===e.name&&(t.type=e.value),"resourceid"===e.name&&(t.id=e.value),"ds6w:identifier"===e.name&&(t.identifier=e.value),"ds6w:label"===e.name&&(t.label=e.value),"ds6wg:revision"===e.name&&(t.revision=e.value),"type_icon_url"===e.name&&(t.icon=e.value)}),t},hideContextFilter:function(){b.get("actionBar").getIconBar().getItem("ContextFilter").elements.container.hide(),this.filterDiv&&this.filterDiv.hide(),this.autoCompleteFilter.selectedItems&&(this.autoCompleteFilter.selectedItems=[]),widget.setValue("contextFilter",!1)},makeDroppable:function(e){var n=this;h.droppable(e,{drop:function(i,s,o){if(o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault(),o.dataTransfer&&o.dataTransfer.dropEffect&&(o.dataTransfer.dropEffect="copy"),t.is(i)&&""!=i){var a=JSON.parse(i).data.items;t.is(a)&&t.is(a.length)&&a.length>0&&n.dropFilterObject(a)}else g.displayNotification({msg:C.filter.filterbyobject.dropNotSupported,eventID:"error"});e.style.borderWidth="0px"},over:function(){arguments[0].setStyles({borderStyle:"solid",borderColor:"#368ec4",borderWidth:"1px"})},leave:function(){arguments[0].setStyle("borderWidth","0px")}})},dropFilterObject:function(e){var t=this;if(e.length>0){var n=e[0].objectId;I.fetch({data:{objects:[{physicalId:n}]},onComplete:function(e){var n=e.body;if(n.results&&n.results.length>0){t.modelForFilter.prepareUpdate();var i=n.results[0],s=t.parseFetchAttributes(i);s.revision=void 0===s.revision?"":s.revision,s.identifier=void 0===s.identifier?"":" ("+s.identifier+")";var o=s.label+" "+s.revision+s.identifier,a=new p({label:o,value:s.id,name:s.identifier,id:s.id,icon:s.icon,type:s.type});t.modelForFilter.addRoot(a),t.modelForFilter.pushUpdate(),t.autoCompleteFilter.selectedItems=a}else g.displayNotification({msg:C.filter.filterbyobject.dropNotSupported,eventID:"error"})},onFailure:function(e){g.displayNotification({msg:C.filter.filterbyobject.dropNotSupported,eventID:"error"})}})}},searchContext:function(){var e=this;y.search({default_search_criteria:"",precond:"",multiSel:!1,callback:function(t){var n=t[0];e.modelForFilter.prepareUpdate(),n["ds6wg:revision"]=void 0===n["ds6wg:revision"]?"":n["ds6wg:revision"],n["ds6w:identifier"]=void 0===n["ds6w:identifier"]?"":" ("+n["ds6w:identifier"]+")";var i=n["ds6w:label"]+" "+n["ds6wg:revision"]+n["ds6w:identifier"],s=new p({label:i,value:n.id,name:n["ds6w:identifier"],id:n.id,icon:n.type_icon_url,type:n["ds6w:type_value"]});e.modelForFilter.addRoot(s),e.modelForFilter.pushUpdate(),e.autoCompleteFilter.selectedItems=s},cancel:function(){}})},getContextualMenu:function(){var e=this;e.isRemoveDialogOpen=!!e.isRemoveDialogOpen&&e.isRemoveDialogOpen,e.isSettingsDialogOpen=!!e.isSettingsDialogOpen&&e.isSettingsDialogOpen;var t=[];return e.getOpenWithMenu().then(function(e){t=t.concat(e)}).then(function(){return t.push({name:"Settings",title:C.filter.filterbyobject.menu.settings.title,type:"PushItem",icon:"cog",data:null,action:{callback:function(){e.createSettingsDialog()}}}),t.push({type:"SeparatorItem"}),widget.getValue("selectedContext")&&t.push({name:"Information",title:C.filter.filterbyobject.menu.information,type:"PushItem",icon:"info-open-in-a-new-window",data:null,action:{callback:function(){var e=widget.getValue("selectedContext").id;v.viewProperties(e)}}}),t})},getOpenWithMenu:function(){var e=[],n=widget.getValue("selectedContext");return""===n||void 0===n?Promise.resolve([]):new Promise(function(i){S.start(name+" getOpenWithMenu");var s=[],o=[];o.push(n.type),s.push({envId:y.getTenant(),serviceId:"3DSpace",objectId:n.id,objectType:n.type,objectTaxonomies:[n.type],displayName:n.label?n.label:n.name}),I.getTypesHierarchy({types:o,onComplete:function(n){if(t.is(n.types_hierarchies,"array")&&n.types_hierarchies.forEach(function(e,t){s.forEach(function(t,n){t.objectTaxonomies[0]===e.type&&(t.objectTaxonomies=t.objectTaxonomies.concat(e.hierarchy))})}),0===s.length)return S.end(name+" getOpenWithMenu"),void i(e);var o=b.get("widget")||window.widget;w.getOpenWith().set3DXContent({protocol:"3DXContent",version:"1.1",source:o.name,widgetId:o.id,data:{items:s}},!0).retrieveCompatibleApps(function(t){if(t&&t.length>0){var n=[],s=[];if(t.forEach(function(e){s={name:e.text.replace(/ /g,""),type:"PushItem",title:e.text,action:{callback:e.handler}},null!=e.fonticon?s.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon}:s.icon=e.icon,n.push(s)}),n.length>0){var o={name:"OpenWith",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-menu-dot"},title:C.filter.filterbyobject.menu.openwith,submenu:n};e.push(o),e.push({type:"SeparatorItem"})}}i(e)}),S.end(name+" getOpenWithMenu")},onFailure:function(t){i(e)}})})},createSettingsDialog:function(){var e=this;if(!e.isSettingsDialogOpen){var n=!1,i=t.createElement("div",{class:"filter-settings"}),s=t.createElement("div",{class:"filter-by",html:[t.createElement("span",{class:"filter-by-label",html:C.filter.filterbyobject.menu.settings.filterby}),t.createElement("div",{class:"filter-by-label wux-ui-3ds-required wux-ui-3ds"})]}),o=void 0===widget.getValue("affectedItemSetting")||widget.getValue("affectedItemSetting"),c=void 0===widget.getValue("resolvedItemSetting")||widget.getValue("resolvedItemSetting"),m=void 0===widget.getValue("contextSetting")||widget.getValue("contextSetting");o||c||m||(n=!0);var p=new l({type:"checkbox"}),h=new r({type:"checkbox",label:C.filter.filterbyobject.menu.settings.affectedItem,checkFlag:o,value:"AffectedItem"}),g=new r({type:"checkbox",label:C.filter.filterbyobject.menu.settings.resolvedItem,checkFlag:c,value:"ResolvedItem"}),f=new r({type:"checkbox",label:C.filter.filterbyobject.menu.settings.context,checkFlag:m,value:"Context"});p.addChild(h),p.addChild(g),p.addChild(f),s.inject(i),p.inject(i),p.addEventListener("change",function(t){0===p.value.length?e.settingsDialog.buttons.Yes.disabled=!0:e.settingsDialog.buttons.Yes.disabled=!1});var v=new d({}),b=document.getElementsByClassName("issue-list")[0];v.inject(b),e.settingsDialog=new u({immersiveFrame:v,title:C.filter.filterbyobject.menu.settings.title,content:i,activeFlag:!1,modelFlag:!0,width:400,buttons:{No:new a({label:C.filter.filterbyobject.menu.settings.cancel,domId:"applySettingsNo",onClick:function(t){v.destroy(),e.isSettingsDialogOpen=!1}}),Yes:new a({label:C.filter.filterbyobject.menu.settings.apply,domId:"applySettingsYes",disabled:n,onClick:function(t){widget.setValue("affectedItemSetting",p.value.includes("AffectedItem")),widget.setValue("resolvedItemSetting",p.value.includes("ResolvedItem")),widget.setValue("contextSetting",p.value.includes("Context")),v.destroy(),e.isSettingsDialogOpen=!1,e.autoCompleteFilter.selectedItems&&(widget.dispatchEvent("onRefresh",["filter"]),widget.dispatchEvent("endEdit"))}})}}),e.isSettingsDialogOpen=!0,e.settingsDialog.addEventListener("close",function(t){v&&v.destroy(),e.isSettingsDialogOpen=!1})}},refresh:function(){this.destroy(),this.render(),b.get("actionBar").updateFilterMenu()},destroy:function(){this.elements={bar:null,menu:null},this.container.empty()},utils:{debounce:function(e,t,n){var i;return function(){var s=this,o=arguments,a=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(s,o)},t),a&&e.apply(s,o)}}}})}),define("DS/IssueManagement/views/datagrid/DataGrid",["UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/DataGridView/DataGridView","DS/Controls/TooltipModel","DS/IssueCommon/utils/Utils","DS/IssueComponents/users/Users","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueServices/services/PlatformServices","text!DS/IssueManagement/assets/Settings.json","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f){"use strict";var v="Issue",b={CREATE:1,ASSIGN:2,ACTIVE:3,REVIEW:4,CLOSED:5},I={LOW:1,MEDIUM:2,HIGH:3,URGENT:4},y=10,w="ds6w:",S={COMPACT:"compact",COMFORTABLE:"comfortable",COMPACT_HEIGHT:26,COMFORTABLE_HEIGHT:38},C=this;return s.extend({name:"DS/IssueManagement/views/list/TreeList",_logger:null,component:null,document:null,settings:{},_predicates:[],_ghost:null,init:function(s){var o=this;s.cellSelection="none",s.cellDragEnabledFlag=!0,s.showRowIndexFlag=!1,o.summaryview="datagrid",m.start(o.name+" init"),C=o,o._logger=n.getLogger("DS/IssueManagement/View"),o.component=s.component,o.document=null,o.datagridSettings=s.settings,o.settings=JSON.parse(h),o.settings.loadInfoFromFetch?u.add("LoadInfoFromFetch",!0):u.add("LoadInfoFromFetch",!1),o._predicates=[],s.columns.forEach(function(e){switch(e.text=o.getHeader(e.dataIndex),e.text){case"Affected Items":e.icon={iconName:"location",fontIconFamily:WUXManagedFontIcons.Font3DS};break;case"Resolved By":e.icon={iconName:"docs",fontIconFamily:WUXManagedFontIcons.Font3DS};break;case"Contexts":e.icon={iconName:"3d-object",fontIconFamily:WUXManagedFontIcons.Font3DS}}}),o.utils._originalColumns=s.columns.slice(),s.columns=o.preferences.getColumnsPreference(s.columns);for(var r=0;r<s.columns.length;r++)!0===s.columns[r].isIndexed&&o._predicates.push(s.columns[r].dataIndex);return o._parent(s),o.preferences.getViewModePreference()===S.COMFORTABLE?this.layout.cellHeight=S.COMFORTABLE_HEIGHT:this.layout.cellHeight=S.COMPACT_HEIGHT,o.layout.setColumnOrGroupProperties("ContextualMenuColumn",{text:g.columns.actionsColumn,width:55,isHidden:!1,visibleFlag:!0,defaultVisibility:!0}),o.layout.columns.filter(e=>"ContextualMenuColumn"==e.dataIndex).forEach(e=>e.export={value:!1,lock:!1}),o._customizeColumnSorting(s.columns),o._customizeColumnRendering(s.columns),o.addEventListener("columnOrderChange",function(e){o.preferences.savePreferences({columns:!0})}),o.addEventListener("click",o.doOnTreeNodeClick.bind(o)),o.addEventListener("dblclick",o.doOnTreeNodeDblClick.bind(o)),o.addEventListener("keyup",function(e){if("Delete"===e.key)l.getCommand("Delete").begin();else if("ArrowUp"===e.key||"ArrowDown"===e.key||"Enter"===e.key){var t=o.getCellInfosAt(o.getActiveCellID());o.doOnTreeNodeClick(e,t)}}),o.onContextualEvent=async function(e){if(e){var n=e.cellInfos;if(-1===n.rowID&&e.collectionView){return e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!0})}if(n.nodeModel){var i=u.get("component"),s=i.getTreeDocument().getSelectedNodes().filter(e=>{if(e.options.reportedAgainst.length>0&&!e.options.reportedAgainst[0].hasOwnProperty("type")||e.options.contexts.length>0&&!e.options.contexts[0].hasOwnProperty("type")||e.options.resolvedBy.length>0&&!e.options.resolvedBy[0].hasOwnProperty("type")||e.options.resolvedItems.length>0&&!e.options.resolvedItems[0].hasOwnProperty("type"))return e});return u.get("LoadInfoFromFetch")?await i.loadInfo_fetchV2(s):await i.loadInfo(s),!1===n.nodeModel.isSelected()&&(n.nodeModel.select(!0),o.document.prepareBroadcastSelect(),o.document.pushBroadcastSelect()),d.getContextualMenu(n.nodeModel)}return t.resolve()}return t.resolve()},o._registerReusableCellContent(),o.getCellTooltip=function(e){m.start(o.name+" shouldDisplayTooltip");var t="";if(-1==e.rowID)return this.component.list.getCellDefaultTooltip(e);switch(e.cellView.collectionView.columns[e.columnID].dataIndex){case"ds6w:assignees":(t=e.nodeModel.options.assignees.reduce(function(e,t){return e+t.fullName+" ("+t.user+"), "},"")).length>0&&(t=(t=t.trim()).substring(0,t.length-1));break;case"ds6w:contributors":(t=e.nodeModel.options.contributors.reduce(function(e,t){return e+t.fullName+" ("+t.user+"), "},"")).length>0&&(t=(t=t.trim()).substring(0,t.length-1));break;case"ds6w:informedUsers":(t=e.nodeModel.options.informedUsers.reduce(function(e,t){return e+t.fullName+" ("+t.user+"), "},"")).length>0&&(t=(t=t.trim()).substring(0,t.length-1));break;case"ds6w:coOwners":(t=e.nodeModel.options.coOwners.reduce(function(e,t){return e+t.fullName+" ("+t.user+"), "},"")).length>0&&(t=(t=t.trim()).substring(0,t.length-1));break;case"ds6w:validation":t=e.nodeModel.options.validation.toString();break;default:return this.component.list.getCellDefaultTooltip(e)}return m.end(o.name+" getCellTooltip"),{shortHelp:t}},o.onDragOverCell=function(e,t){return e.preventDefault(),e.dataTransfer.dropEffect="copy",e.dataTransfer.effectAllowed="copy",void 0!==t&&(t.dropPosition="middle"),!0},o.onDropCell=function(e,t){e.preventDefault();var n=null,s=(n=t.nodeModel.options.baseType!==v?t.nodeModel.getParent():t.nodeModel).options.id,o=n.options.type,r=n.options.name,l=n.options.title,d=c.getDroppableData(e);if(d.hasOwnProperty("files")&&d.files instanceof FileList)c.related.uploadFilesAsAttachments.call(this,{node:n,id:s,type:o,name:r,title:l},d.files);else{if(!a.isValid3DXContent(d)||!d.data.items.length)return i.displayNotification({msg:g.dnd.notSupported,eventID:"warning"}),!1;c.related.addRelatedObjects.call(this,{node:n,id:s,type:o,name:r,title:l},d.data.items,e)}return!0},o.onDragEndCell=function(e,t){},o.onDragStartCell=function(t,n){var i=o.document.getSelectedNodes(),s=c.setDroppableData(i);o.getTreeDocument().prepareBroadcastSelect(),o.getTreeDocument().pushBroadcastSelect(),t.dataTransfer.setData(s.type,s.data);var r=n.nodeModel.options;return null!==o._ghost&&(o._ghost.destroy(),o._ghost=null),o._ghost=e.createElement("div",{class:"issue-ghost-container",html:[e.createElement("div",{class:"issue-ghost-panel",html:[e.createElement("img",{class:"issue-ghost-image",src:n.nodeModel.options.icons[n.nodeModel.options.icons.length-1]}),e.createElement("div",{class:"issue-ghost-title",html:a.getTextFromHTML(r.title)+" ("+a.getTextFromHTML(r.name)+")"})]}),e.createElement("span",{class:"issue-ghost-counter",html:i.length})]}),o._ghost.setStyle("transform","translate3d(0,0,0)"),document.body.appendChild(o._ghost),t.dataTransfer.setDragImage(o._ghost,t.offsetX,t.offsetY),!0},m.end(o.name+" init"),o},load:function(e){return m.start(this.name+" load"),null!=e&&(this.document=e),this.sortModel=[{dataIndex:"ds6w:created",sort:"desc"}],m.end(this.name+" load"),this},getManager:function(){return C.component.list},getColumns:function(){return C.component.list.columns},destroy:function(){this.utils._debounceTimeouts.forEach(function(e){clearTimeout(e)}),this.utils._debounceTimeouts=[],this._parent()},doOnTreeNodeClick:function(e,t){e&&void 0!==t&&(this.getTreeDocument().prepareBroadcastSelect(),this.getTreeDocument().pushBroadcastSelect(),"ds6w:revision"==e.dsModel.layout.getDataIndexFromColumnIndex(t.columnID)&&"Issue"!=t.nodeModel.options.type&&""!=t.nodeModel.options.revision&&"-"!=t.nodeModel.options.revision&&this.actionOnClick(t))},actionOnClick:function(t){t?a.showRevisionModal(t):e.log("Issue management Version Explorer : Invalid type...")},doOnTreeNodeDblClick:function(e,t){e&&void 0!==t&&-1!=t.rowID&&l.getCommand("ToggleInformationPanel")&&l.getCommand("ToggleInformationPanel").begin({save:!0})},modifyColumnRendering:function(n){var i=this;return new t(function(t){setTimeout(function(){m.start(i.name+" modifyColumnRendering");var s=e.is(n,"string")?JSON.parse(n):n,o=i.getColumnOrGroup(s.dataIndex);if(void 0!==o){var a=o.text;if(s.headerName&&s.headerName!==a&&(o.text=s.headerName,!0),o.isHidden=!0===o.isHidden,void 0!==s.isHidden&&s.isHidden!==o.isHidden&&(o.isHidden?(C.component.list.layout.setColumnVisibleFlag(o.dataIndex,!0),o.isHidden=!1):(C.component.list.layout.setColumnVisibleFlag(o.dataIndex,!1),o.isHidden=!0)),s.column_color){o.styles=s.column_color,o.styles||(o.styles={}),o.styles.color=s.column_color.color.replace(";",""),o.styles["background-color"]=s.column_color["background-color"].replace(";","");try{i.rendering.updateColumnStyles(o.dataIndex,o.styles)}catch(e){C._logger.warn("Could not set the column styles because %",e)}}}m.end(i.name+" modifyColumnRendering"),t()},0)})},resetColumnRendering:function(){var e=this;m.start(e.name+" resetColumnRendering"),require(["text!DS/IssueManagement/assets/IssueManagement.dataGrid.json"],function(t){var n=JSON.parse(t),i=n.columns;e.component.list.getColumns().forEach(function(t){if("ContextualMenuColumn"==t.dataIndex)t.isHidden=!1,t.visibleFlag=!0,t.defaultVisibility=!0;else{var n=1==t.defaultVisibility;t.isHidden=!n}e.component.list.layout.setColumnVisibleFlag(t.dataIndex,n)}),i.forEach(function(t){t.text=e.getHeader(t.dataIndex)}),n.specificColumns.forEach(function(e){i.splice(e.colIndex,0,{width:e.width,maxWidth:e.maxWidth,minWidth:e.minWidth,dataIndex:e.dataIndex,isDraggable:e.isDraggable,isHidden:e.isHidden})}),e._customizeColumnSorting(i),e._customizeColumnRendering(i),m.end(e.name+" resetColumnRendering")})},getHeader:function(e){var t=u.get("widget")||window.widget,n=this.datagridSettings.list.columns;return n&&n.default&&n.default[e]?g.columns[n.default[e]]:n&&n.custom&&n.custom[e]?n.custom[e][t.lang]:e},getTreeDocument:function(){return this.document},getPredicates:function(){return this._predicates},_customizeColumnRendering:function(e){var t=this;e.forEach(function(e){e.dataIndex.replace(w,"");switch(!0===e.isHidden?e.visibleFlag=!1:e.visibleFlag=!0,e.dataIndex){case"ds6w:biColor":e.onCellRequest=t.rendering.biColor;break;case"ds6w:state":e.getCellSemantics=t.rendering.state;break;case"ds6w:assignees":e.onCellRequest=t.rendering.assignees;break;case"ds6w:contributors":e.onCellRequest=t.rendering.contributors;break;case"ds6w:informedUsers":e.onCellRequest=t.rendering.informedUsers;break;case"ds6w:originator":e.onCellRequest=t.rendering.originator;break;case"ds6w:validation":e.onCellRequest=t.rendering.validation;break;case"ds6w:owner":e.onCellRequest=t.rendering.owner;break;case"ds6w:coOwners":e.onCellRequest=t.rendering.coOwners;break;case"ds6w:reportedAgainst":e.getCellValue=t.rendering.isReportedAgainstPresent;break;case"ds6w:resolvedBy":e.getCellValue=t.rendering.isResolvedByPresent;break;case"ds6w:contexts":e.getCellValue=t.rendering.isContextsPresent;break;case"ds6w:isLastRevision":e.onCellRequest=t.rendering.isLastRevision;break;case"ds6w:revision":e.getCellValue=t.rendering.revision;break;case"ds6w:resolutionDate":e.onCellRequest=t.rendering.date;break;default:if(e.isCustom){var n={that:t,attr:{name:e.dataIndex}};e.getCellValue=t.rendering.classificationAttributes.bind(n)}}})},_customizeColumnSorting:function(e){var t=this;e.forEach(function(e){var n=e.dataIndex.replace(w,"");switch(e.dataIndex){case"tree":e.compareFunction=t.sorting.title;break;case"ds6w:name":e.compareFunction=t.sorting.name(!1);break;case"ds6w:description":e.compareFunction=t.sorting.description(!1);break;case"ds6w:created":case"ds6w:modified":case"ds6w:estimatedStartDate":case"ds6w:estimatedEndDate":case"ds6w:actualStartDate":case"ds6w:actualEndDate":case"ds6w:resolutionDate":break;case"ds6w:priority":case"ds6w:state":e.compareFunction=t.sorting.enumeration(n);break;case"ds6w:validation":e.compareFunction=t.sorting.validation(n);break;case"ds6w:assignees":e.compareFunction=t.sorting.assignees;break;case"ds6w:contributors":e.compareFunction=t.sorting.contributors;break;case"ds6w:informedUsers":e.compareFunction=t.sorting.informedUsers;break;case"ds6w:originator":e.compareFunction=t.sorting.originator;break;case"ds6w:owner":e.compareFunction=t.sorting.owner;break;case"ds6w:coOwners":e.compareFunction=t.sorting.coOwners;break;default:!0===e.custom&&(e.compareFunction=t.sorting.custom(n))}})},_registerReusableCellContent:function(){this.registerReusableCellContent({id:"biColorCell",buildContent:function(){return e.createElement("div",{class:"bi-color-cell"})}}),this.registerReusableCellContent({id:"validationloading",buildContent:function(){return e.createElement("div",{class:"container-loading-ring-cell",html:e.createElement("div",{class:"loading-ring-cell",html:"<div></div><div></div><div></div><div></div>"})})}}),this.registerReusableCellContent({id:"validation",buildContent:function(){return e.createElement("div",{class:"container-validation-none-cell",html:e.createElement("span",{class:""})})}}),this.registerReusableCellContent({id:"validationactive",buildContent:function(){return e.createElement("div",{class:"container-validation-active-cell",html:e.createElement("span",{class:"fonticon fonticon-route-start"})})}}),this.registerReusableCellContent({id:"dummy",buildContent:function(){return e.createElement("div",{class:"dummy-container"})}})},rendering:{biColor:function(e){!1===e.manager.getColumnOptions("biColor").isHidden&&(e.isHeader||(e.cellView.reuseCellContent("biColorCell").style["background-color"]=e.nodeModel.options.grid.biColor))},revision:function(e){if(e.nodeModel)return{label:e.nodeModel.options.revision}},classificationAttributes:function(t){if(-1===t.rowID)return;let n=t.nodeModel.options.grid[this.attr.name];if(void 0!==n)return e.is(n,"string")&&(n=n.replaceAll("",", ")),n;this.that.getTreeDocument().autoFill.classificationAttributes(t.nodeModel.options.physicalId,this.attr.name)},validation:function(t){if(-1!==t.rowID){m.start(C.name+" rendering validation");var n=t.nodeModel.options.validation;if(!0!==n.activated)t.cellView.reuseCellContent("validation");else{var i=e.createElement("div",{class:"validation-cell-container"});if(!0===n.fetched){var s=null;switch(n.status){case"inProgress":i.append(e.createElement("div",{class:"im-routes-cell-status",html:e.createElement("div",{class:"fonticon fonticon-clock in-progress"})}));break;case"approved":s=e.createElement("div",{class:"fonticon fonticon-check approved"});case"rejected":s=s||e.createElement("div",{class:"fonticon fonticon-wrong rejected"}),i.append(e.createElement("div",{class:"im-routes-cell-status",html:s}));break;case"notStarted":return void t.cellView.reuseCellContent("validationactive")}for(var a=t.nodeModel.options.validation.decisions,l=[],c=0;c<a.length;c++){var d=a[c].reviewer;n.status===a[c].status&&l.push(d)}i.append(r.create({users:l})),t.cellView.setReusableContent(i);let u=t.nodeModel.options.validation.toString();i.tooltipInfos=new o({shortHelp:u,mouseRelativePosition:!1,position:"bottom"})}else t.cellView.reuseCellContent("validationloading"),this.getTreeDocument().autoFill.validation(t.nodeModel.options.physicalId)}m.end(C.name+" rendering validation")}},owner:function(t){if(m.start(C.name+" rendering owner"),-1!==t.rowID){var n=t.nodeModel.options,i=r.create({users:[n.owner]}).addClassName("issue-owner-container");e.createElement("span",{class:"userName issue-user-image issue-owner-full-name",html:n.owner.fullName}).inject(i),t.cellView.setReusableContent(i);let s="";n.owner.fullName&&n.owner.user&&(s=n.owner.fullName+" ("+n.owner.user+")"),i.tooltipInfos=new o({shortHelp:s,mouseRelativePosition:!1,position:"bottom"})}m.end(C.name+" rendering owner")},originator:function(t){if(m.start(C.name+" rendering originator"),-1!==t.rowID){var n=t.nodeModel.options,i=r.create({users:[n.originator]}).addClassName("issue-owner-container");e.createElement("span",{class:"userName issue-user-image issue-owner-full-name",html:n.originator.fullName}).inject(i),t.cellView.setReusableContent(i);let s="";n.originator.fullName&&n.originator.user&&(s=n.originator.fullName+" ("+n.originator.user+")"),i.tooltipInfos=new o({shortHelp:s,mouseRelativePosition:!1,position:"bottom"})}m.end(C.name+" rendering originator")},assignees:function(e){if(m.start(C.name+" rendering assignees"),-1!==e.rowID){var t=C.component.list.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.assignees&&n.assignees.length){var i=n.assignees.map(function(e){return e}),s=r.create({users:i});e.cellView.setReusableContent(s);let t="";i.forEach(e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName}),s.tooltipInfos=new o({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}m.end(C.name+" rendering assignees")},contributors:function(e){if(m.start(C.name+" rendering contributors"),-1!==e.rowID){var t=C.component.list.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.contributors&&n.contributors.length){var i=n.contributors.map(function(e){return e}),s=r.create({users:i});e.cellView.setReusableContent(s);let t="";i.forEach(e=>{""!=t&&(t+=", "),t+=e.fullName+" ("+e.user+")"}),s.tooltipInfos=new o({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}m.end(C.name+" rendering contributors")},informedUsers:function(e){if(m.start(C.name+" rendering informedUsers"),-1!==e.rowID){var t=C.component.list.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.informedUsers&&n.informedUsers.length){var i=n.informedUsers.map(function(e){return e}),s=r.create({users:i});e.cellView.setReusableContent(s);let t="";i.forEach(e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName}),s.tooltipInfos=new o({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}m.end(C.name+" rendering informedUsers")},coOwners:function(e){if(m.start(C.name+" rendering coOwners"),-1!==e.rowID){var t=C.component.list.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.coOwners&&n.coOwners.length){var i=n.coOwners.map(function(e){return e}),s=r.create({users:i});e.cellView.setReusableContent(s);let t="";i.forEach(e=>{""!=t&&(t+=", "),t+=e.fullName+" ("+e.user+")"}),s.tooltipInfos=new o({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}m.end(C.name+" rendering coOwners")},array:function(t){return function(n){if(m.start(C.name+" rendering array"),n.nodeModel.options.baseType===v){var i=n.nodeModel.options[t];if(!0===(t in n.nodeModel.options&&i.length>0))if(i.length<y)n.cellView.reuseCellContent("arrayLengthIs"+i.length);else{var s=e.createElement("div",{class:"issue-list-cell-related",html:g.replace(g.list.hasRelated,{number:i.length})});n.cellView.getContent().setContent(s)}else n.cellView.reuseCellContent("arrayLengthEmpty")}m.end(C.name+" rendering array")}},isContextsPresent:function(e){if(m.start(C.name+" rendering isContextsPresent"),e.nodeModel.options.baseType===v){var t=e.nodeModel.options.contexts;return t.length?g.list.hasRelatedItems+"("+t.length+")":g.list.noRelated}m.end(C.name+" rendering isContextsPresent")},isResolvedByPresent:function(e){if(m.start(C.name+" rendering isResolvedByPresent"),e.nodeModel.options.baseType===v){var t=e.nodeModel.options.resolvedBy;return t.length?g.list.hasRelatedItems+"("+t.length+")":g.list.noRelated}m.end(C.name+" rendering isResolvedByPresent")},isReportedAgainstPresent:function(e){if(m.start(C.name+" rendering isReportedAgainstPresent"),e.nodeModel.options.baseType===v){var t=e.nodeModel.options.reportedAgainst;return t.length?g.list.hasRelatedItems+"("+t.length+")":g.list.noRelated}m.end(C.name+" rendering isReportedAgainstPresent")},isLastRevision:function(t){m.start(C.name+" rendering isLastRevision");var n="";let i;"Issue"!=t.nodeModel.options.type&&""!=t.nodeModel.options.revision&&null!=t.nodeModel.options.revision?""===t.nodeModel.options.isLastRevision?(n=e.createElement("div",{}),i="",t.cellView.setReusableContent(n)):1==t.nodeModel.options.isLastRevision?(n=e.createElement("div",{class:"isLastRevisionTrue wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check"}),i=f.resolveIssues.tooltips.isLastRevision,t.cellView.setReusableContent(n)):0==t.nodeModel.options.isLastRevision&&(n=e.createElement("div",{class:"isLastRevisionFalse wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong"}),i=f.resolveIssues.tooltips.isNotLastRevision,t.cellView.setReusableContent(n)):(n=e.createElement("div",{}),i="",t.cellView.setReusableContent(n)),n.tooltipInfos=new o({shortHelp:i,mouseRelativePosition:!1,position:"bottom"}),m.end(C.name+" rendering isLastRevision")},date:function(t){var n="";if(""!=t.nodeModel.options.resolutionDate){var i=u.get("widget")||window.widget,s=parseInt(i.getValue("approaching"),10),o="",a=new Date;a.setHours(0,0,0,0);var r=new Date(t.nodeModel.options.resolutionDate);r.setHours(0,0,0,0),o=""===(o=Math.ceil(Math.abs(r-a)/864e5)<=s&&r>a?"approaching":"")&&r<=a?"overdue":o;var l=r.toLocaleString("default",{month:"short"})+" "+r.getDate()+", "+r.getFullYear();n=e.is(o,"string")&&""!==o?e.createElement("div",{class:"target-approaching-overdue",html:[{class:"approaching"===o?"fonticon fonticon-clock":"fonticon fonticon-attention"},{html:l}]}):e.createElement("div",{class:"target-approaching-overdue",html:l})}t.cellView.setReusableContent(n)},updateColumnStyles:function(t,n){var i={};void 0!==n.color&&(i.color=n.color+";"),void 0!==n["background-color"]&&(i["background-color"]=n["background-color"]+";");var s=[],o=document.styleSheets[0];o.cssRules?s=o.cssRules:o.rules&&(s=o.rules);var a='.issue-list-container .wux-datagrid-cell[data-index="'+t+'"]:not(.wux-datagrid-header)',r=this._getBrowserSelector(a),l=function(e,t,n){for(var i=e.length;--i;){var s=e[i];if(n(t,s))return{item:s,index:i}}return null}(s,r,function(e,t){return t.selectorText===e});null!==l&&o.deleteRule(l.index);var c="{}";e.is(n,"object")&&(c=(c=(c=JSON.stringify(i)).replace(/"/g,"")).replace(/,/g,"")),"{}"!==c&&o.insertRule(r+c,s.length)},_getBrowserSelector:function(e){var t=document.styleSheets,n=t[t.length-1],i=-1,s=null;try{i=n.insertRule(e+"{}",n.cssRules.length),s=(n.cssRules||n.rules)[i].selectorText}finally{i>=0&&n.deleteRule(i)}return s}},sorting:{custom:function(e){return function(e,t,n,i,s){var o=!(s in n.options.custom)||null===n.options.custom[s],a=!(s in i.options.custom)||null===i.options.custom[s];if(o||a)return o&&!a?-1:!o&&a?1:0;var r=n.options.custom[s],l=i.options.custom[s];return isNaN(r)||isNaN(l)?r>l?1:r<l?-1:0:(r=parseFloat(r))>(l=parseFloat(l))?1:r<l?-1:0}},title:function(e,t,n,i,s){return n.options.baseType!==v||i.options.baseType,n.options.label<i.options.label?-1:n.options.label>i.options.label?1:0},name:function(e){return function(t,n,i,s,o){return i.options.name<s.options.name?e?1:-1:i.options.name>s.options.name?e?-1:1:0}},description:function(e){return function(t,n,i,s,o){var r=a.getTextFromHTML(i.options.description),l=a.getTextFromHTML(s.options.description);return r<l?e?1:-1:r>l?e?-1:1:0}},array:function(e){return function(e,t,n,i,s){return n.options[s].length-i.options[s].length}},date:function(e){return function(e,t,n,i,s){if(n.options[s]&&i.options[s]){var o=n.options[s]<i.options[s]?-1:1;try{var a=new Date(n.options[s]),r=new Date(i.options[s]);o=a>r?1:a<r?-1:0}catch(e){}return o}return!n.options[s]&&i.options[s]?-1:!i.options[s]&&n.options[s]?1:0}},enumeration:function(e){var t={};switch(e){case"state":t=b;break;case"priority":t=I;break;default:t=b}return function(e,n,i,s,o){var a=0;o=o.replace("ds6w:","");try{o in i.options&&o in s.options&&(e=i.options[o].toUpperCase(),n=s.options[o].toUpperCase(),a=t[e]-t[n])}catch(e){}return a}},validation:function(){return function(e,t,n,i,s){return n.options.validation.status<i.options.validation.status?-1:n.options.validation.status>i.options.validation.status?1:0}},assignees:function(e,t,n,i,s){var o=0;if("assignees"in n.options&&"assignees"in i.options){var a=n.options.assignees,r=i.options.assignees;o=a.length>=r.length?1:-1}return o},contributors:function(e,t,n,i,s){var o=0;if("contributors"in n.options&&"contributors"in i.options){var a=n.options.contributors,r=i.options.contributors;o=a.length>=r.length?1:-1}return o},informedUsers:function(e,t,n,i,s){var o=0;if("informedUsers"in n.options&&"informedUsers"in i.options){var a=n.options.informedUsers,r=i.options.informedUsers;o=a.length>=r.length?1:-1}return o},originator:function(e,t,n,i,s){return n.options.originator.lastName<i.options.originator.lastName?-1:n.options.originator.lastName>i.options.originator.lastName?1:0},owner:function(e,t,n,i,s){return n.options.owner.lastName<i.options.owner.lastName?-1:n.options.owner.lastName>i.options.owner.lastName?1:0},coOwners:function(e,t,n,i,s){var o=0;if("coOwners"in n.options&&"coOwners"in i.options){var a=n.options.coOwners,r=i.options.coOwners;o=a.length>=r.length?1:-1}return o}},preferences:{savePreferences:function(t){var n=u.get("widget")||window.widget,i=u.get("component").getTreeListView(),s=[];if(s=(i.layout._balancedColumnTree,i.layout._balancedColumnTree.slice()),!0===t.sort&&s.forEach(function(e){var t=manager.getColumnIDFromDataIndex(e.dataIndex);"none"!==manager.getColumnOrderState(t)&&n.setValue("IssueManagementTableSorting",JSON.stringify({columnID:t,order:manager.getColumnOrderState(t)}))}),!0===t.columns){var o=[];s.forEach(function(t){o.push({dataIndex:t.dataIndex,text:t.text,originalText:C.getHeader(t.dataIndex),export:t.export,width:t.width,visibleFlag:t.visibleFlag,isHidden:!0===t.isHidden,styles:t.styles?t.styles:{},isCustom:!!e.is(t.isCustom)&&t.isCustom})}),n.setValue("IssueManagementTableDefinition",JSON.stringify(o))}t.hasOwnProperty("view")&&n.setValue("IssueManagementTableView",t.view)},resetPreferences:function(e){var t=u.get("widget")||window.widget;!0===e.sort&&t.setValue("IssueManagementTableSorting",""),!0===e.columns&&t.setValue("IssueManagementTableDefinition",null)},loadSortPreference:function(){var e=u.get("widget")||window.widget;m.start(C.name+" preferences loadSortPreference");var t=e.getValue("IssueManagementTableSorting");try{var n=JSON.parse(t);if(!Number.isInteger(n.columnID)||!n.order)throw new Error("The sort preference has an incorrect format");this.sort()}catch(t){e.setValue("IssueManagementTableSorting",null)}m.end(C.name+" preferences loadSortPreference")},getColumnsPreference:function(e){var t=u.get("widget")||window.widget;m.start(C.name+" preferences getColumnsPreference");var n=[];try{if(n=JSON.parse(t.getValue("IssueManagementTableDefinition")),!Array.isArray(n))throw new Error("The columns preference has an incorrect format")}catch(e){t.setValue("IssueManagementTableDefinition",null),n=[]}for(var i=e.slice(0),s=n.slice(0),o=i.reduce(function(e,t){return e[t.dataIndex]=t,e},{}),a=s.reduce(function(e,t){return e[t.dataIndex]=t,e},{}),r=[],l=Math.max(i.length,s.length),c=0;c<l;c++){var d=s[c],p=void 0;if(void 0===(p=void 0===d||d.isCustom||"ContextualMenuColumn"===d.dataIndex?d:o[d.dataIndex]));else{p.width=d.width,p.isHidden=d.isHidden,p.text!==d.originalText&&(d.originalText===d.text||(p.text=d.text)),p.styles=d.styles?d.styles:{};try{C.rendering.updateColumnStyles(d.dataIndex,p.styles)}catch(e){C._logger.warn("Could not set the column styles because %",e)}r.push(p)}}for(var h=0;h<i.length;h++){void 0===a[i[h].dataIndex]&&r.splice(h,0,i[h])}return m.end(C.name+" preferences getColumnsPreference"),r},getViewModePreference:function(){var e=u.get("widget")||window.widget;m.start(C.name+" preferences getViewModePreference");var t=S.COMPACT;try{if((t=e.getValue("IssueManagementTableView"))!==S.COMPACT&&t!==S.COMFORTABLE)throw new Error("The columns preference has an incorrect format")}catch(n){e.setValue("IssueManagementTableView",t),t=S.COMPACT,C.component.utils.isTouchDevice()&&(t=S.COMFORTABLE)}return C.component.utils.isTouchDevice()&&(t=S.COMFORTABLE),m.end(C.name+" preferences getViewModePreference"),t}},getRoots:function(){return this.document.getRoots()},resize:function(){let e=u.get("component");if(e){let t=e.list.getTreeDocument().getSelectedNodes();t[0]&&this.ensureNodeModelVisible(t[0])}},utils:{whereToAddModal:null,_originalColumns:[],_debounceTimeouts:[],getOriginalColumns:function(){return this._originalColumns},debounce:function(e,t,n){var i,s=this;return function(){var o=this,a=arguments,r=n&&!i;clearTimeout(i);var l=s._debounceTimeouts.indexOf(i);-1!==l&&s._debounceTimeouts.splice(l,1),i=setTimeout(function(){i=null,n||e.apply(o,a)},t),s._debounceTimeouts.push(i),r&&e.apply(o,a)}}}})}),define("DS/IssueManagement/models/TreeNodeModel",["UWA/Core","DS/IssueManagement/utils/customization/DataGridCellContent","DS/Tree/TreeNodeModel","DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s){"use strict";function o(t){t=e.extend({id:"",physicalId:"",label:"",icons:[],grid:{},type:"",children:[],useAsyncPreExpand:!0,matchSearchNavigation:!1},t),this.listView=i.get("ISU_LISTVIEW"),this.listView&&null!=this.listView||this.updateGrid(t),n.call(this,t)}function a(e){e._getFilterInfo||(e.filterInChild=o.prototype.filterInChild.bind(e),e.filterOutChild=o.prototype.filterOutChild.bind(e),e._getFilterInfo=o.prototype._getFilterInfo.bind(e),e._getChildrenFilterInfo=o.prototype._getChildrenFilterInfo.bind(e),e._removeChildrenFilterInfo=o.prototype._removeChildrenFilterInfo.bind(e))}return o.prototype=Object.create(n.prototype),o.prototype.getOccurrencePath=function(t){if(e.is(t,"function")&&t(this),!this.isRoot()&&this.getParent()){var n=this.getParent().getOccurrencePath(t);return n.push(this.options.id),n.push(this.options.data.relationToIssue),n}return[this.options.id]},o.prototype.updateGrid=function(e){this.listView&&null!=this.listView||t.updateCellContentForGrid(e)},o.prototype.getNodesById=function(e){var t={listOfNodesFound:[]};return this._getNodesById(e,t),t.listOfNodesFound},o.prototype._getNodesById=function(e,t){var n=!1;if(this.options.id===e)t.listOfNodesFound.push(this),n=!0;else{var i=this.getChildren();if(i)for(var s=0;s<i.length;s++)n=i[s]._getNodesById(e,t)||n}return n},o.prototype.matchSearchNavigation=function(){this.options.matchSearchNavigation=!0},o.prototype.unmatchSearchNavigation=function(){this.options.matchSearchNavigation=!1},o.prototype.getID=function(){return this.options.id},o.prototype.filterOut=function(){var e=this.isRoot()?this.getTreeDocument():this.getParent();null!==e&&(a(e),e.filterOutChild(this))},o.prototype.filterOutChild=function(t){var n=this.getChildren();if(n.indexOf(t)<0)throw new Error("This is not a child");var i=this._getChildrenFilterInfo(!0);if(!i.childrenBeforeFiltering){i.childrenBeforeFiltering=n&&n.length>0?n.slice(0):[];e.is(this._expandState)&&(i.expandStateBeforeFiltering={noExpandState:"noChildren",expandingState:"expanding",partiallyExpandedState:"partiallyExpanded",collapseState:"expanded",expandState:"collapsed"}[this._expandState])}t._getFilterInfo(!0).parentBeforeFiltering=this,e.is(this.removeChild,"function")?this.removeChild(t):this.removeRoot(t,!0,!0),e.is(this.setState,"function")&&this.setState({state:i.expandStateBeforeFiltering}),i.filteredOutChildren||(i.filteredOutChildren=[]),i.filteredOutChildren.push(t)},o.prototype.filterIn=function(e){var t=this._getFilterInfo();if(t&&t.parentBeforeFiltering){var n=t.parentBeforeFiltering;a(n),n.filterInChild(this)}if(!0===e){var i=null,s=this._getChildrenFilterInfo();(i=s&&s.childrenBeforeFiltering?s.childrenBeforeFiltering:this.getChildren())&&Array.isArray(i)&&i.forEach(function(t){t.filterIn(e)})}},o.prototype.filterInChild=function(t){var n=this._getChildrenFilterInfo();if(n&&n.childrenBeforeFiltering){var i=n.childrenBeforeFiltering.indexOf(t);if(i>=0){var s=t._getFilterInfo();if(s&&s.parentBeforeFiltering===this){var o=this.getChildren(),a=null;if(o&&Array.isArray(o))for(var r=0;r<o.length;r++){var l=o[r];if(n.childrenBeforeFiltering.indexOf(l)>i){a=l;break}}delete s.parentBeforeFiltering,t.options&&t.options.isRootAttached?!0===t.options.isRootAttached&&this.insertBefore(t,a):this.insertBefore(t,a),e.is(this.setState,"function")&&this.setState({state:n.expandStateBeforeFiltering}),t._removeFilterInfo();var c=n.filteredOutChildren.indexOf(t);n.filteredOutChildren.splice(c,1),0===n.filteredOutChildren.length&&this._removeChildrenFilterInfo()}}}},o.prototype._removeFilterInfo=function(){delete this.options._filterInfo},o.prototype._removeChildrenFilterInfo=function(){delete this.options._childrenFilterInfo},o.prototype._getFilterInfo=function(e){return!this.options._filterInfo&&e&&(this.options._filterInfo={}),this.options._filterInfo},o.prototype._getChildrenFilterInfo=function(e){return!this.options._childrenFilterInfo&&e&&(this.options._childrenFilterInfo={}),this.options._childrenFilterInfo},o}),define("DS/IssueManagement/components/information/Header",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/Menu/Menu","DS/SocialToolbar/SocialToolbar","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/lifecycle/Lifecycle","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v){"use strict";var b="Issue",I={ELEMENTS:{COMPACT:"compact",MULTIPLE_SELECTION:"multiple-selection",PLACEHOLDER:"im-information-header-placeholder",PLACEHOLDER_IMAGE:"im-information-header-placeholder-image",PLACEHOLDER_CONTENT:"im-information-header-placeholder-content",IMAGE_CONTAINER:"im-information-header-image-ctn",TITLE_CONTAINER:"im-information-header-info-title",TITLE_CONTENT:"im-information-header-info-title-content",MENU_BUTTON:"im-information-header-info-title-menu-btn fonticon fonticon-2x fonticon-chevron-down",PREV_BUTTON:"im-information-header-info-title-prev-btn fonticon fonticon-2x fonticon-chevron-left",NEXT_BUTTON:"im-information-header-info-title-next-btn fonticon fonticon-2x fonticon-chevron-right",CLOSE_BUTTON:"im-information-header-info-title-close-btn wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-close",SUMMARY_CONTAINER:"im-information-header-info-summary",OWNER_CONTAINER:"im-information-header-info-owner",INFO_CONTAINER:"im-information-header-info-ctn",INFO_ELEMENT:"im-information-header-info-element",INFO_CONTEXTS:"im-information-header-info-contexts",INFO_REPORTEDAGAINST:"im-information-header-info-reportedagainst",INFO_RESOLVEDBY:"im-information-header-info-resolvedby",INFO_RESOLVEDITEMS:"im-information-header-info-resolvedItems",INFO_ASSIGNEES:"im-information-header-info-assignees",INFO_COMMENTS:"im-information-header-info-comments",INFO_ATTACHMENTS:"im-information-header-info-attachments",INFO_RESOLUTIONDATE:"im-information-header-info-resolutiondate",IMAGE:"im-information-header-image",STACK_IMAGES:"im-information-header-stack-images",STACK_ELEMENT:"im-information-header-stack-element"},DIMENSIONS:{MIN_WIDTH:420}},y=3;return t.extend({name:"DS/IssueManagement/components/information/Header",tagName:"div",className:"im-information-header",_logger:null,setup:function(t){var n=this;f.start(n.name+" setup"),n._parent(t),n._logger=o.getLogger(n.name),n.elements={image:null,info:null,buttons:null,tooltips:[]},n._deferred={},n.isLoaded=new e(function(e,t){n._deferred.resolve=e,n._deferred.reject=t}),n.physicalIds=[],n._eventListeners=[],f.end(n.name+" setup")},render:function(){var e=this;f.start(e.name+" render"),(e.elements.placeholder=n.createElement("div",{class:I.ELEMENTS.PLACEHOLDER,html:[n.createElement("div",{class:I.ELEMENTS.PLACEHOLDER_IMAGE,html:[n.createElement("div",{})]}),n.createElement("div",{class:I.ELEMENTS.PLACEHOLDER_CONTENT,html:[n.createElement("div",{}),n.createElement("div",{}),n.createElement("div",{}),n.createElement("div",{})]})]})).inject(e.container),(e.elements.imageContainer=n.createElement("div",{class:I.ELEMENTS.IMAGE_CONTAINER,html:[e.elements.image=n.createElement("div",{class:I.ELEMENTS.IMAGE,html:n.createElement("span",{class:"fonticon fonticon-5x fonticon-camera"})}),e.elements.stackImages=n.createElement("div",{class:I.ELEMENTS.STACK_IMAGES})],events:{click:function(){c.getCommand("AttachmentManager").begin()}}})).inject(e.container);var t=e.elements.title=n.createElement("div",{class:I.ELEMENTS.TITLE_CONTAINER});t.inject(e.container);var i=e.elements.prevButton=n.createElement("span",{class:I.ELEMENTS.MENU_BUTTON,events:{click:function(e){var t=e.target.getBoundingClientRect(),n={position:{x:t.left,y:t.top+20}};m.getContextualMenu().then(function(e){a.show(e,n)})}}});i.inject(t),e.elements.menuButtonTooltip=new s({position:"bottom",target:i,body:v.information.header.showMenu});var o=e.elements.prevButton=n.createElement("span",{class:I.ELEMENTS.PREV_BUTTON,events:{click:function(){var t=p.get("component").getTreeListView();if(e.listView=p.get("ISU_LISTVIEW"),n.is(t,"object")){var i=t.getManager();if(n.is(i,"object")){var s="";s=e.listView?i.getActiveNode():i.getTreeDocument().getSelectedNodes()[0],e._scrollToPreviousNode(s)}}}}});o.inject(t),e.elements.prevButtonTooltip=new s({position:"bottom",target:o,body:v.information.header.goToPrevious}),(e.elements.titleContent=n.createElement("div",{class:I.ELEMENTS.TITLE_CONTENT})).inject(t);var r=e.elements.nextButton=n.createElement("span",{class:I.ELEMENTS.NEXT_BUTTON,events:{click:function(){var t=p.get("component").getTreeListView();if(e.listView=p.get("ISU_LISTVIEW"),n.is(t,"object")){var i=t.getManager();if(n.is(i,"object")){var s="";s=e.listView?i.getActiveNode():i.getTreeDocument().getSelectedNodes()[0],e._scrollToNextNode(s)}}}}});e.elements.nextButtonTooltip=new s({position:"bottom",target:r,body:v.information.header.goToNext}),r.inject(t),(e.elements.summary=n.createElement("div",{class:I.ELEMENTS.SUMMARY_CONTAINER})).inject(e.container);var l=e.elements.closeButton=n.createElement("span",{class:I.ELEMENTS.CLOSE_BUTTON,events:{click:function(){c.getCommand("ToggleInformationPanel").begin({open:!1,save:!0})}}});e.elements.closeButtonTooltip=new s({position:"bottom",target:l,body:v.information.header.close}),l.inject(e.container),(e.lifecycle=new u).render().inject(e.container),e.listenTo(e.lifecycle,"request:openRoute",function(t){var i={facetName:"history"};n.is(t,"object")&&t.issueId&&t.route&&(i.callback=function(e){e.routes&&e.routes.selectRoute(t.route)}),e.dispatchEvent("request:switchFacet",i)}),e.listenTo(e.lifecycle,"onPromotionCompleted",function(t){e._publishUpdate(t.issues)}),e.listenTo(e.lifecycle,"onDemotionCompleted",function(t){e._publishUpdate(t.issues)}),e.listenTo(e.lifecycle,"onApprovalCompleted",function(t){var n=t.issues.map(function(e){return e.physicalId});1===n.length&&e._refreshInfo(n[n.length-1]),e._refreshPrimaryImage(n),e._publishUpdate(t.issues,t.modifiedAttributes)}),e.listenTo(e.lifecycle,"onRejectionCompleted",function(t){var n=t.issues.map(function(e){return e.physicalId});1===n.length&&e._refreshInfo(n[n.length-1]),e._refreshPrimaryImage(n),e._publishUpdate(t.issues,t.modifiedAttributes)});var d=e.elements.info=n.createElement("div",{class:I.ELEMENTS.INFO_CONTAINER});d.inject(e.container),(e.elements.infoContexts=n.createElement("div",{class:I.ELEMENTS.INFO_ELEMENT+" "+I.ELEMENTS.INFO_CONTEXTS,html:[n.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-3d-object"}),n.createElement("span",{class:"value"})]})).inject(d),(e.elements.infoReportedAgainst=n.createElement("div",{class:I.ELEMENTS.INFO_ELEMENT+" "+I.ELEMENTS.INFO_REPORTEDAGAINST,html:[n.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-location"}),n.createElement("span",{class:"value"})]})).inject(d),(e.elements.infoResolvedBy=n.createElement("div",{class:I.ELEMENTS.INFO_ELEMENT+" "+I.ELEMENTS.INFO_RESOLVEDBY,html:[n.createElement("span",{class:"fonticon fonticon-docs"}),n.createElement("span",{class:"value"})]})).inject(d),(e.elements.infoResolvedItems=n.createElement("div",{class:I.ELEMENTS.INFO_ELEMENT+" "+I.ELEMENTS.INFO_RESOLVEDITEMS,html:[n.createElement("span",{class:"fonticon fonticon-markup-review"}),n.createElement("span",{class:"value"})]})).inject(d),(e.elements.infoAssignees=n.createElement("div",{class:I.ELEMENTS.INFO_ELEMENT+" "+I.ELEMENTS.INFO_ASSIGNEES,html:[n.createElement("span",{class:"fonticon fonticon-users"}),n.createElement("span",{class:"value"})]})).inject(d),(e.elements.infoComments=n.createElement("div",{class:I.ELEMENTS.INFO_ELEMENT+" "+I.ELEMENTS.INFO_COMMENTS,html:[n.createElement("span",{class:"fonticon fonticon-chat"}),n.createElement("span",{class:"value"})]})).inject(d),(e.elements.infoAttachments=n.createElement("div",{class:I.ELEMENTS.INFO_ELEMENT+" "+I.ELEMENTS.INFO_ATTACHMENTS,html:[n.createElement("span",{class:"fonticon fonticon-attach"}),n.createElement("span",{class:"value"})]})).inject(d),(e.elements.infoResolutionDate=n.createElement("div",{class:I.ELEMENTS.INFO_ELEMENT+" "+I.ELEMENTS.INFO_RESOLUTIONDATE,html:[n.createElement("span",{class:"fonticon fonticon-calendar"}),n.createElement("span",{class:"value"})]})).inject(d);var h=p.get("eventsHandler");e._subscriberId=Math.random().toString(36).substr(2,9),e._eventListeners=[{event:"DS/Object/update",listener:function(t){t.data.paths.reduce(function(e,t){return e.push(t.pop()),e}).some(function(t){return-1!==e.physicalIds.indexOf(t)})&&e.refresh(e.physicalIds)},conditions:{type:"issue",attributes:["owner","contexts","reportedAgainst","resolvedBy","resolvedItems","assignees","attachments","state"]}}];for(var g=0;g<e._eventListeners.length;g++){var b=e._eventListeners[g];b.token=h.subscribe(e._subscriberId,b.event,b.listener.bind(e),b.conditions)}return f.end(e.name+" render"),e},refresh:function(t){var i=this,s=[];if(i._deferred={},i.isLoaded=new e(function(e,t){i._deferred.resolve=e,i._deferred.reject=t}),i.elements.placeholder.show(),i.container.toggleClassName(I.ELEMENTS.MULTIPLE_SELECTION,t.length>1),i.elements.tooltips.forEach(function(e){e.destroy()}),i.elements.tooltips=[],i.physicalIds=t,1===t.length){var o=t[t.length-1];s.push(i._refreshPrimaryImage(t)),s.push(i._refreshInfo(o)),s.push(i.lifecycle.refresh(t))}else t.length>1?(s.push(i._refreshPrimaryImage(t)),i.elements.titleContent.setContent(v.replace(v.information.header.multipleSelection.title,{number:t.length})),i.elements.summary.setContent(v.information.header.multipleSelection.summary),s.push(i.lifecycle.refresh(t))):0===t.length&&(i.elements.image.setStyle("background-image","none"),i.elements.image.setContent(n.createElement("span",{class:"fonticon fonticon-5x fonticon-camera"})));return e.all(s).then(function(){i.elements.placeholder.hide(),i.dispatchEvent("onRefresh"),i._deferred.resolve()}).catch(function(e){i._logger.error("Cannot refresh information header %o",e),i._deferred.reject(e)})},_refreshPrimaryImage:function(e){var t=this;return h.images.retrieve({data:{objects:e.map(function(e){return{physicalId:e}})}}).then(function(e){if(!Array.isArray(e.results))throw new Error("Unexpected response when retrieving images.");if(1===e.results.length){var i=e.results[0].body;if(n.is(i,"object")&&n.is(i.url,"string")&&""!==i.url){var s=n.createElement("div");s.setStyle("background-image",'url("'+i.url+'")'),t.elements.image.setContent(s)}else t.elements.image.setStyle("background-image","none"),t.elements.image.setContent(n.createElement("span",{class:"fonticon fonticon-5x fonticon-camera"}))}else if(e.results.length>1){t.elements.stackImages.empty();for(var o=0;o<e.results.length;o++){if(o>=y)return;var a=e.results[o].body,r=n.createElement("div",{class:I.ELEMENTS.STACK_ELEMENT});n.is(a,"object")&&n.is(a.url,"string")&&""!==a.url?(r.setContent(""),r.setStyle("background-image",'url("'+a.url+'")')):(r.setStyle("background-image","none"),r.setContent(n.createElement("span",{class:"fonticon fonticon-5x fonticon-camera"})));var l=4*o-(e.results.length>y?y:e.results.length)+1,c=100-o;l<0?r.setStyle("transform","translate(-"+-1*l+"px,"+-1*l+"px)"):r.setStyle("transform","translate("+l+"px,-"+l+"px)"),r.setStyle("z-index",c),t.elements.stackImages.appendChild(r)}}}).catch(function(e){t._logger.error("Cannot retrieve the images: %o",e)})},_refreshInfo:function(t){var i=this,o=[],a=h.issues.retrieve({data:{objects:[{physicalId:t}]}}).then(function(e){if(!Array.isArray(e.results)||1!==e.results.length)throw new Error("Unexpected response when retrieving issues.");var t=e.results[0].body,o=n.String.escapeHTML(t.title)+" ("+d.getTextFromHTML(t.name)+")";i.elements.titleContent.setContent("<span>"+o+"</span>"),i.elements.tooltips.push(new s({position:"bottom",target:i.elements.titleContent.getElement("span"),body:o,trigger:"touch"}));var a=i.elements.owner=n.createElement("span",{class:"summary-ownerIcon"});g.getUserImageElement(t.owner,!0,{Title:""}).inject(a);var r='<span class="created-date">'+d.timeSince(new Date(t.created))+"</span>",l='<span class="owner-fullname">'+t.owner.fullName+"</span>",c=v.replace(v.information.header.summary,{timeSince:r,ownerIcon:a.outerHTML,owner:l});i.elements.summary.setContent(c),i.elements.summary.getElement("span.summary-ownerIcon").addEventListener("click",function(){g.getUserProfile(t.owner.user)}),i.elements.tooltips.push(new s({position:"bottom",target:i.elements.summary.getElement("span.summary-ownerIcon"),body:t.owner.fullName+" ("+t.owner.user+")"})),i.elements.summary.getElement("span.created-date").addEventListener("click",function(){i.dispatchEvent("request:switchFacet",{facetName:"properties"})}),i.elements.tooltips.push(new s({position:"bottom",target:i.elements.summary.getElement("span.created-date"),body:v.replace(v.tooltips.creationDate,{date:new Date(t.created).toLocaleString(p.get("widget").lang)})})),i.elements.tooltips.push(new s({position:"bottom",target:i.elements.summary.getElement("span.owner-fullname"),body:t.owner.fullName+" ("+t.owner.user+")"})),i.elements.summary.getElement("span.owner-fullname").addEventListener("click",function(){g.getUserProfile(t.owner.user)}),i.elements.infoContexts.getElement("span.value").setContent(String(t.contexts.length)),i.elements.infoContexts.addEventListener("click",function(){i.dispatchEvent("request:switchFacet",{facetName:"related"})}),i.elements.tooltips.push(new s({position:"bottom",target:i.elements.infoContexts,body:t.contexts.length?v.replace(v.tooltips.contexts,{number:t.contexts.length}):v.tooltips.noContext})),i.elements.infoReportedAgainst.getElement("span.value").setContent(String(t.reportedAgainst.length)),i.elements.infoReportedAgainst.addEventListener("click",function(){i.dispatchEvent("request:switchFacet",{facetName:"related"})}),i.elements.tooltips.push(new s({position:"bottom",target:i.elements.infoReportedAgainst,body:t.reportedAgainst.length?v.replace(v.tooltips.reportedAgainst,{number:t.reportedAgainst.length}):v.tooltips.noReportedAgainst})),i.elements.infoResolvedBy.getElement("span.value").setContent(String(t.resolvedBy.length)),i.elements.infoResolvedBy.addEventListener("click",function(){i.dispatchEvent("request:switchFacet",{facetName:"related"})}),i.elements.tooltips.push(new s({position:"bottom",target:i.elements.infoResolvedBy,body:t.resolvedBy.length?v.replace(v.tooltips.resolvedBy,{number:t.resolvedBy.length}):v.tooltips.noResolvedBy})),i.elements.infoResolvedItems.getElement("span.value").setContent(String(t.resolvedItems.length)),i.elements.infoResolvedItems.addEventListener("click",function(){i.dispatchEvent("request:switchFacet",{facetName:"related"})}),i.elements.tooltips.push(new s({position:"bottom",target:i.elements.infoResolvedItems,body:t.resolvedItems.length?v.replace(v.tooltips.resolvedItems,{number:t.resolvedItems.length}):v.tooltips.noResolvedItems})),i.elements.infoAssignees.getElement("span.value").setContent(String(t.assignees.length)),i.elements.infoAssignees.addEventListener("click",function(){i.dispatchEvent("request:switchFacet",{facetName:"team"})});var u="";u=t.assignees.length>0?t.assignees.reduce(function(e,t){return e=e+"<br>"+t.fullName},v.replace(v.tooltips.assignees,{number:t.assignees.length})):v.tooltips.noAssignee,i.elements.tooltips.push(new s({position:"bottom",target:i.elements.infoAssignees,body:u}));var m="";if(t.resolutionDate&&""!==t.resolutionDate&&void 0!==t.resolutionDate){m=new Date(t.resolutionDate).toLocaleString(p.get("widget").lang,{year:"numeric",month:"numeric",day:"numeric"})}i.elements.infoResolutionDate.getElement("span.value").setContent(m),i.elements.infoResolutionDate.addEventListener("click",function(){i.dispatchEvent("request:switchFacet",{facetName:"properties"})}),i.elements.tooltips.push(new s({position:"bottom",target:i.elements.infoResolutionDate,body:v.replace(v.tooltips.resolutionDate,{date:m})}))}).catch(function(e){i._logger.error("Cannot retrieve the info: %o",e)});return o.push(a),0==d.get3DSwymUrl()?i.elements.infoComments.hide():h.comments.retrieve({data:{physicalId:t}}).then(function(e){var t=0;try{t=e.body.result.nbComments}catch(e){t=0}d.isInteger(t)||(t=0),i.elements.infoComments.getElement("span.value").setContent(String(t)),i.elements.infoComments.addEventListener("click",function(){i.dispatchEvent("request:switchFacet",{facetName:"comments"})}),i.elements.tooltips.push(new s({position:"bottom",target:i.elements.infoComments,body:v.replace(v.tooltips.comments,{number:t})}))}),l.getDocumentsFrom(t).then(function(e){var t=0;try{t=e.attachments.length}catch(e){t=0}d.isInteger(t)||(t=0),i.elements.infoAttachments.getElement("span.value").setContent(String(t)),i.elements.infoAttachments.addEventListener("click",function(){i.dispatchEvent("request:switchFacet",{facetName:"attachments"})}),i.elements.tooltips.push(new s({position:"bottom",target:i.elements.infoAttachments,body:v.replace(v.tooltips.attachments,{number:t})}))}),e.all(o)},resize:function(){this.container.toggleClassName(I.ELEMENTS.COMPACT,this.container.getParent()&&this.container.getParent().offsetWidth<I.DIMENSIONS.MIN_WIDTH),this.lifecycle.resize()},destroy:function(){if(this.elements.tooltips.forEach(function(e){e.destroy()}),this.elements.menuButtonTooltip&&this.elements.menuButtonTooltip.destroy(),this.elements.prevButtonTooltip&&this.elements.prevButtonTooltip.destroy(),this.elements.nextButtonTooltip&&this.elements.nextButtonTooltip.destroy(),this.elements.closeButtonTooltip&&this.elements.closeButtonTooltip.destroy(),this.elements={image:null,info:null,buttons:null,tooltips:[]},this.physicalIds=[],Array.isArray(this._eventListeners))for(var e=0;e<this._eventListeners.length;e++){var t=this._eventListeners[e];p.get("eventsHandler").unsubscribe(t.token)}this._eventListeners=[],this.container.empty()},_publishUpdate:function(e,t){for(var n=[],i={},s=0;s<e.length;s++)n.push([e[s].physicalId]),i[e[s].physicalId]={id:e[s].id,type:"Issue",modifiedAttributes:Array.isArray(t)?["state"].concat(t):["state"]};p.get("eventsHandler").publish(this._subscriberId,"DS/Object/update",{metadata:{appId:p.get("widget").id,appName:p.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:n,attributes:i},version:"1.0"})},_scrollToNextNode:function(e){e.options.baseType===b&&(this.currentSelectedIssue=e);var t=p.get("component").getTreeListView();if(n.is(t,"object")){var i=t.getManager();if(n.is(i,"object")){var s=e.getNextVisibleNode();if(s)if(s.options.baseType===b){this.listView?i._goToNode(e,1):(this.currentSelectedIssue&&this.currentSelectedIssue.unselect(),s.select());var o=p.get("component").getTreeDocument();o.prepareBroadcastSelect(),o.pushBroadcastSelect()}else this._scrollToNextNode(s)}}},_scrollToPreviousNode:function(e){e.options.baseType===b&&(this.currentSelectedIssue=e);var t=p.get("component").getTreeListView();if(n.is(t,"object")){var i=t.getManager();if(n.is(i,"object")){var s=e.getPreviousVisibleNode();if(s)if(s.options.baseType===b){this.listView?i._goToNode(e,-1):(this.currentSelectedIssue&&this.currentSelectedIssue.unselect(),s.select());var o=p.get("component").getTreeDocument();o.prepareBroadcastSelect(),o.pushBroadcastSelect()}else this._scrollToPreviousNode(s)}}}})}),define("DS/IssueManagement/views/list/TreeList",["UWA/Core","UWA/Class/Promise","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/Core/PointerEvents","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/Tree/TreeListView","DS/Menu/Menu","DS/IssueCommon/utils/Utils","DS/IssueComponents/users/Users","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,b){"use strict";return r.extend({name:"DS/IssueManagement/views/list/TreeList"})}),define("DS/IssueManagement/components/idcard/IssueIdcard",["DS/IssueManagement/components/idcard/IssueMaturity","DS/ENOXIDCard/js/IDCard","DS/ENOFloatingPanel/ENOFloatingPanel","DS/UIKIT/Input/Button","DS/IssueServices/services/IssueServices","DS/IssueComponents/utils/Utils","DS/IssueComponents/search/PeopleSearch","DS/SearchWidget/SearchWidgetConstant","DS/Controls/TooltipModel","DS/IssueServices/Contexts","DS/PADUtils/views/PADAlert","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p){var h="Low",g="Medium",f="High",v="Urgent";return t.extend({fields:{responsibleOrganization:null},values:{responsibleOrganization:null,responsibleOrganizationTitle:null},renderView:function(){return this.render(),this._removeOtherTitleSections(),this._addNavigationButtons(),this._subscribeViewEvents(),this},resize:function(){var e=this.container.offsetWidth,t=this.container.getElement(".main-section").offsetWidth;this.container.hasClassName("minified")?this._checkMinifiedAttributesOverflow():this._checkAttributesOverflow(),this.container.getElement(".free-zone-1").addClassName("hidden"),this.container.getElement(".free-zone-0").addClassName("hidden"),e<420?(this.container.addClassName("no-image-placeholder"),this.container.getElement(".image-placeholder").addClassName("hidden")):(this.container.removeClassName("no-image-placeholder"),this.container.getElement(".image-placeholder").removeClassName("hidden")),null!==this.container.getElement('.attribute-columns[data-column-index="1"]')&&(t<646?this.container.getElement('.attribute-columns[data-column-index="1"]').addClassName("hidden"):this.container.getElement('.attribute-columns[data-column-index="1"]').removeClassName("hidden")),null!==this.container.getElement('.attribute-columns[data-column-index="2"]')&&(t<1e3?this.container.getElement('.attribute-columns[data-column-index="2"]').addClassName("hidden"):this.container.getElement('.attribute-columns[data-column-index="2"]').removeClassName("hidden"))},_removeOtherTitleSections:function(){this.container.getElement(".version").addClassName("hidden"),this.container.getElement(".versionModel").addClassName("hidden"),this.container.getElement(".modelVersion").addClassName("hidden"),this.container.getElement(".ngfilter").addClassName("hidden"),this.container.getElement(".configuration").addClassName("hidden")},_addNavigationButtons:function(){var e=this;let t=e.container.getElement(".title-section-buttons"),n=UWA.createElement("div",{class:"fonticon-chevron-left wux-ui-3ds",title:u.information.header.goToPrevious,events:{click:function(){e.modelEvents.publish({event:"issue-idcard-nav-prev",data:{}})}}});UWA.createElement("div",{class:"fonticon-chevron-right wux-ui-3ds",title:u.information.header.goToNext,events:{click:function(){e.modelEvents.publish({event:"issue-idcard-nav-next",data:{}})}}}).inject(t,"top"),n.inject(t,"top"),UWA.createElement("span",{class:"wux-ui-3ds-close wux-ui-3ds",title:u.information.header.close,events:{click:function(){e.modelEvents.publish({event:"issue-idcard-nav-close",data:{}})}}}).inject(t)},_addMaturityComponent:function(t){var n=this.container.getElements("#maturity");if(n.forEach(e=>e.empty()),UWA.is(t)){new e({bos:t,modelEvents:this.modelEvents,showRoute:!0}).buildMaturityView({targetDivs:n}).refresh()}},_subscribeViewEvents:function(){},setAttributeValue:function(e,t,n){var i=this;i.model.get("attributes").forEach(i=>{i.id==e&&(i.value=t,i.isVaries=!!UWA.is(n,"boolean")&&n)});UWA.String.escapeHTML(t);if("priority"==e){i.container.getElements("#priority").map(e=>{let n=i._priorityDiv({priority:t});e.innerHTML=n.div,e.title=n.nls})}else{let n=`#${e}`;i.container.getElements(n).map(e=>{e.innerHTML=t,e.title=t})}},displayMaturity:function(e){this._addMaturityComponent(e)},_priorityDiv:function(e){var t=e.priority,n="",i=m.priorities[t.toLowerCase()];switch(null==i&&(i=t),e.priority){case h:n="low wux-ui-3ds wux-ui-3ds-level-low";break;case g:n="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case f:n="high wux-ui-3ds wux-ui-3ds-level-high";break;case v:n="urgent wux-ui-3ds wux-ui-3ds-alert "}if(""==n)var s=UWA.createElement("div",{class:"issue-list-priority",html:i});else s=UWA.createElement("div",{class:"issue-list-priority",html:[UWA.createElement("span",{class:"issue-list-priority-icon "+n}),i]});return{div:s.outerHTML,nls:i}}})}),define("DS/IssueManagement/views/list/Keyboard",["UWA/Class/Promise","DS/IssueCommon/utils/Utils","DS/IssueManagement/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(e,t,n,i,s){"use strict";var o="DS/IssueManagement/views/list/Keyboard",a={ISSUE_TYPE:"Issue"},r=function(){return!(window.document.getElementsByClassName("wux-menu").length>0&&window.document.getElementsByClassName("wux-menu-container").length>0)};return{"treelistview:go-to-next-node":function(){if(!1!==r()){s.start(o+" go-to-next-node");var t=this,n=i.get("component").getTreeDocument(),a=n.getSelectedNodes(),l=[],c=function(t){return new e(function(e){t.onPostExpand(function(){e()}),t.expand()})};n.withTransactionUpdate(function(){for(var n=t.getKeymapManager(),i=0;i<a.length;i++)!a[i].isExpanded()&&a[i].getChildren()&&l.push(c(a[i]));l.length>0&&n.wait(),e.all(l).then(function(){n.listen();var e=t.getActiveNode();e&&!l.length>0&&t._goToNode(e,1)})}),s.end(o+" go-to-next-node")}},"treelistview:go-to-previous-parent-node":function(){if(!1!==r()){s.start(o+" go-to-previous-parent-node");var t=this,n=i.get("component").getTreeDocument(),a=n.getSelectedNodes(),l=[],c=function(t){return new e(function(e){t.onPostCollapse(function(){e()}),t.collapse()})};n.withTransactionUpdate(function(){for(var n=t.getKeymapManager(),i=0;i<a.length;i++)a[i].isExpanded()&&l.push(c(a[i]));l.length>0&&n.wait(),e.all(l).then(function(){n.listen();var e=t.getActiveNode();e&&!l.length>0&&t._goToNode(e,-1)})}),s.end(o+" go-to-previous-parent-node")}},"treelistview:go-to-previous-visible-node":function(){if(!1!==r()){s.start(o+" go-to-previous-visible-node");var e=this,t=e.getActiveNode(),n=e.getKeymapManager();!function t(s){if(s){var o=s.getPreviousVisibleNode();if(o)if(o.options.baseType===a.ISSUE_TYPE){n.wait(),e._goToNode(s,-1);var r=i.get("component").getTreeDocument();r.prepareBroadcastSelect(),r.pushBroadcastSelect()}else t(o)}}(t),s.end(o+" go-to-previous-visible-node")}},"treelistview:go-to-next-visible-node":function(){if(!1!==r()){s.start(o+" go-to-next-visible-node");var e=this,t=e.getActiveNode(),n=e.getKeymapManager();!function t(s){if(s){var o=s.getNextVisibleNode();if(o)if(o.options.baseType===a.ISSUE_TYPE){n.wait(),e._goToNode(s,1);var r=i.get("component").getTreeDocument();r.prepareBroadcastSelect(),r.pushBroadcastSelect()}else t(o)}}(t),s.end(o+" go-to-next-visible-node")}},"treelistview:edit-mode":function(){!1!==r()&&(s.start(o+" edit-mode"),i.get("component").getTreeDocument().getSelectedNodes().length>0&&n.getCommand("ToggleInformationPanel")&&n.getCommand("ToggleInformationPanel").begin({open:!0,save:!0}),s.end(o+" edit-mode"))},"treelistview:edit-cancel":function(){if(!1!==r()){s.start(o+" edit-cancel");var e=i.get("component").getTreeDocument();e.withTransactionUpdate(function(){e.unselectAll(),n.getCommand("ToggleInformationPanel")&&n.getCommand("ToggleInformationPanel").begin({open:!1,save:!0})}),s.end(o+" edit-cancel")}},"treelistview:select-all":function(){!1!==r()&&(s.start(o+" select-all"),n.getCommand("SelectAllIssues").begin(),s.end(o+" select-all"))},"treelistview:copy-node":function(){if(!1!==r()){s.start(o+" copy-node");var e=i.get("component").getTreeDocument().getSelectedNodes(),n=[];e.forEach(function(e){n.push(e.options.type+" "+e.options.name+" "+e.options.revision)}),t.copyTextToClipboard(n.join(", ")),s.end(o+" copy-node")}},"treelistview:delete-node":function(){if(!1!==r()){s.start(o+" delete-node");var e=i.get("component").getSelectedNodes();if(0!==e.length){for(var t=!1,l=0;l<e.length;l++)e[l].options.baseType===a.ISSUE_TYPE&&(t=!0);!0===t?n.getCommand("Delete").begin():n.getCommand("Detach").begin(),s.end(o+" delete-node")}}}}}),define("DS/IssueManagement/components/information/IssueHeader",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/Controls/TooltipModel","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","DS/Logger/Logger","DS/Menu/Menu","DS/ENOFloatingPanel/ENOFloatingPanel","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueCommon/utils/Utils","DS/IssueCommon/commands/CommandsManager","DS/IssueManagement/components/idcard/IssueIdcard","DS/IssueManagement/components/idcard/IdCardModel","DS/IssueManagement/components/ContextualMenu","DS/IssueComponents/search/PeopleSearch","DS/SearchWidget/SearchWidgetConstant","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/PADUtils/views/PADAlert","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,b,I,y,w,S,C){"use strict";var E={ISSUE_TYPE:"Issue",CSS:{ELEMENTS:{COMPACT:"compact",MULTIPLE_SELECTION:"multiple-selection",PLACEHOLDER:"im-information-header-placeholder",PLACEHOLDER_IMAGE:"im-information-header-placeholder-image",PLACEHOLDER_CONTENT:"im-information-header-placeholder-content",IMAGE_CONTAINER:"im-information-header-image-ctn",TITLE_CONTAINER:"im-information-header-info-title",TITLE_CONTENT:"im-information-header-info-title-content",MENU_BUTTON:"im-information-header-info-title-menu-btn fonticon fonticon-2x fonticon-chevron-down",PREV_BUTTON:"im-information-header-info-title-prev-btn fonticon fonticon-2x fonticon-chevron-left",NEXT_BUTTON:"im-information-header-info-title-next-btn fonticon fonticon-2x fonticon-chevron-right",CLOSE_BUTTON:"im-information-header-info-title-close-btn wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-close",SUMMARY_CONTAINER:"im-information-header-info-summary",OWNER_CONTAINER:"im-information-header-info-owner",INFO_CONTAINER:"im-information-header-info-ctn",INFO_ELEMENT:"im-information-header-info-element",INFO_CONTEXTS:"im-information-header-info-contexts",INFO_REPORTEDAGAINST:"im-information-header-info-reportedagainst",INFO_RESOLVEDBY:"im-information-header-info-resolvedby",INFO_RESOLVEDITEMS:"im-information-header-info-resolvedItems",INFO_ASSIGNEES:"im-information-header-info-assignees",INFO_COMMENTS:"im-information-header-info-comments",INFO_ATTACHMENTS:"im-information-header-info-attachments",INFO_RESOLUTIONDATE:"im-information-header-info-resolutiondate",IMAGE:"im-information-header-image",STACK_IMAGES:"im-information-header-stack-images",STACK_ELEMENT:"im-information-header-stack-element"},DIMENSIONS:{MIN_WIDTH:420}},defaultImage:o.getWebappsAssetUrl("IssueManagement","icons/camera.png"),MAXIMUM_STACK_ELEMENTS_FOR_IMAGES:3};return t.extend({name:"DS/IssueManagement/components/information/WuxHeader",tagName:"div",className:"im-information-new-header",_logger:null,fields:{responsibleOrganization:null},values:{responsibleOrganization:null,responsibleOrganizationTitle:null},setup:function(t){var n=this;y.start(n.name+" setup"),n._parent(t),n._logger=r.getLogger(n.name),n._deferred={},n.isLoaded=new e(function(e,t){n._deferred.resolve=e,n._deferred.reject=t}),n.IssueIDCard={},n.physicalIds=[],n.customEvents=t.customEvents,n._eventListeners=[],y.end(n.name+" setup")},render:function(){var e=this;y.start(e.name+" render"),I.organizations.getCompanies({onComplete:function(t){e.organizations=t.body},onFailure:function(){e.organizations=[]}});var t=b.get("eventsHandler");e._subscriberId=Math.random().toString(36).substr(2,9),e._eventListeners=[{event:"DS/Object/update",listener:function(t){t.data.paths.length>0&&(t.data.paths.reduce(function(e,t){return e.push(t.pop()),e}).some(function(t){return-1!==e.physicalIds.indexOf(t)})&&e.refresh(e.physicalIds))},conditions:{type:"issue",attributes:["*","owner","contexts","reportedAgainst","resolvedBy","resolvedItems","assignees","attachments","state"]}}];for(var n=0;n<e._eventListeners.length;n++){var i=e._eventListeners[n];i.token=t.subscribe(e._subscriberId,i.event,i.listener.bind(e),i.conditions)}return y.end(e.name+" render"),e.IssueIDCard=new p({model:h}),e.IssueIDCard.renderView().inject(e.container),e.IssueIDCard.attachResizeSensor(),e._idCardSubscribers(),e},refresh:function(t){var n=this,i=[];return n._deferred={},n.isLoaded=new e(function(e,t){n._deferred.resolve=e,n._deferred.reject=t}),n.physicalIds=t,0!=t.length?(i.push(n._refreshPrimaryImage(t)),i.push(n._refreshInfo(t))):t.length,e.all(i).then(function(){n.dispatchEvent("onRefresh"),n._deferred.resolve()}).catch(function(e){n._logger.error("Cannot refresh information header %o",e),n._deferred.reject(e)})},_refreshPrimaryImage:function(e){var t=this;return I.images.retrieve({data:{objects:e.map(function(e){return{physicalId:e}})}}).then(function(e){if(!Array.isArray(e.results))throw new Error("Unexpected response when retrieving images.");if(1===e.results.length){var i=e.results[0].body;n.is(i,"object")&&n.is(i.url,"string")&&""!==i.url?t.IssueIDCard.model.set("thumbnail",i.url):t.IssueIDCard.model.set("thumbnail",E.defaultImage)}else e.results.length>1&&t.IssueIDCard.model.set("thumbnail",E.defaultImage)}).catch(function(e){t._logger.error("Cannot retrieve the images: %o",e)})},_refreshInfo:function(t){var n=this,i=[],s=I.issues.retrieve({data:{objects:t.map(function(e){return{physicalId:e}})}}).then(function(e){if(Array.isArray(e.results)&&(n._setHeaderValues(e.results),1===e.results.length)){let t=e.results[0].body,i=t.reportedAgainst.length;i+=t.resolvedBy.length,i+=t.resolvedItems.length,i+=t.contexts.length;let s=n._getMembersCount(t);n.customEvents.publish({event:"im-update-tab-count",data:{tabs:["relatedObjects","team"],count:[i,s]}})}}).catch(function(e){n._logger.error("Cannot retrieve the info: %o",e)});return i.push(s),1==t.length?(I.comments.retrieve({data:{physicalId:t[0]}}).then(function(e){var t=0;try{t=e.body.result.nbComments}catch(e){t=0}u.isInteger(t)||(t=0),n.customEvents.publish({event:"im-update-tab-count",data:{tabs:["comments"],count:[t]}})}),d.getDocumentsFrom(t[0]).then(function(e){var t=0;try{t=e.attachments.length}catch(e){t=0}u.isInteger(t)||(t=0),n.customEvents.publish({event:"im-update-tab-count",data:{tabs:["attachments"],count:[t]}})})):n.customEvents.publish({event:"im-update-tab-count",data:{tabs:["relatedObjects","team","comments","attachments"],count:["","","",""]}}),e.all(i)},resize:function(){this.container.toggleClassName(E.CSS.ELEMENTS.COMPACT,this.container.getParent()&&this.container.getParent().offsetWidth<E.CSS.DIMENSIONS.MIN_WIDTH),this.IssueIDCard.resize()},destroy:function(){if(this.physicalIds=[],Array.isArray(this._eventListeners))for(var e=0;e<this._eventListeners.length;e++){var t=this._eventListeners[e];b.get("eventsHandler").unsubscribe(t.token)}this._eventListeners=[],this.container.empty()},_publishUpdate:function(e,t){for(var n=[],i={},s=0;s<e.length;s++)n.push([e[s].physicalId]),i[e[s].physicalId]={id:e[s].physicalId,type:"Issue",modifiedAttributes:Array.isArray(t)?["state"].concat(t):["state"]};b.get("eventsHandler").publish(this._subscriberId,"DS/Object/update",{metadata:{appId:b.get("widget").id,appName:b.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:n,attributes:i},version:"1.0"})},_scrollToNextNode:function(e){e.options.baseType===E.ISSUE_TYPE&&(this.currentSelectedIssue=e);var t=b.get("component").getTreeListView();if(n.is(t,"object")){var i=t.getManager();if(n.is(i,"object")){var s=e.getNextVisibleNode();if(s)if(s.options.baseType===E.ISSUE_TYPE){this.listView?i._goToNode(e,1):(this.currentSelectedIssue&&this.currentSelectedIssue.unselect(),s.select());var o=b.get("component").getTreeDocument();o.prepareBroadcastSelect(),o.pushBroadcastSelect()}else this._scrollToNextNode(s)}}},_scrollToPreviousNode:function(e){e.options.baseType===E.ISSUE_TYPE&&(this.currentSelectedIssue=e);var t=b.get("component").getTreeListView();if(n.is(t,"object")){var i=t.getManager();if(n.is(i,"object")){var s=e.getPreviousVisibleNode();if(s)if(s.options.baseType===E.ISSUE_TYPE){this.listView?i._goToNode(e,-1):(this.currentSelectedIssue&&this.currentSelectedIssue.unselect(),s.select());var o=b.get("component").getTreeDocument();o.prepareBroadcastSelect(),o.pushBroadcastSelect()}else this._scrollToPreviousNode(s)}}},_setHeaderValues:function(e){let t={title:"",priority:S.information.header.Varies,owner:{fullName:S.information.header.Varies,isVaries:!0},collaborativeSpace:{value:S.information.header.Varies,isVaries:!0},resolutionDate:S.information.header.Varies,modified:S.information.header.Varies,responsibleOrg:{value:S.information.header.Varies,isVaries:!0},reportingOrg:{value:S.information.header.Varies,isVaries:!0},approvals:S.information.header.Varies};if(e.length>1){let n=e.length;t.title=S.replace(S.information.header.multipleSelection.title,{number:n});let i=e[0].body,s=i.owner.fullName,o=i.priority,a=i.collaborativeSpaceTitle,r=i.responsibleOrganizationTitle,l=i.reportingOrganizationTitle,c=i.waitingOn;e.every(e=>e.body.owner.fullName==s)&&(t.owner.fullName=s,t.owner.isVaries=!1),e.every(e=>e.body.priority==o)&&(t.priority=o),e.every(e=>e.body.collaborativeSpaceTitle==a)&&(t.collaborativeSpace.value=a,t.collaborativeSpace.isVaries=!1),e.every(e=>e.body.responsibleOrganizationTitle==r)&&(t.responsibleOrg.value=r,t.responsibleOrg.isVaries=!1),e.every(e=>e.body.reportingOrganizationTitle==l)&&(t.reportingOrg.value=l,t.reportingOrg.isVaries=!1),e.every(e=>e.body.waitingOn==c)&&(t.approvals="Unassigned"===c?S.approvals.approvalOff:S.approvals.approvalOn),this.IssueIDCard.setAttributeValue("duedate",t.resolutionDate,!0),this.IssueIDCard.setAttributeValue("modifiedDate",t.modified,!0),this.IssueIDCard.setAttributeValue("approvals",t.approvals)}else if(1==e.length){let n=e[0].body;t.title=`${n.title}`,t.priority=n.priority,t.owner.fullName=n.owner.fullName,t.owner.isVaries=!1,t.collaborativeSpace.value=n.collaborativeSpaceTitle,t.collaborativeSpace.isVaries=!1,t.resolutionDate=n.resolutionDate,t.modified=n.modified,t.approvals="Unassigned"===n.waitingOn?S.approvals.approvalOff:S.approvals.approvalOn,""!=n.responsibleOrganizationTitle?t.responsibleOrg.value=n.responsibleOrganizationTitle:t.responsibleOrg.value=n.responsibleOrganization,t.responsibleOrg.isVaries=!1,""!=n.reportingOrganizationTitle?t.reportingOrg.value=n.reportingOrganizationTitle:t.reportingOrg.value=n.reportingOrganization,t.reportingOrg.isVaries=!1;u.getFormattedDate(t,{year:"numeric",month:"numeric",day:"numeric"});this.IssueIDCard.setAttributeValue("modifiedDate",t.modified,!1),this.IssueIDCard.setAttributeValue("duedate",t.resolutionDate),this.IssueIDCard.setAttributeValue("approvals",t.approvals)}else e.length;this.IssueIDCard.model.set("name",t.title),this.IssueIDCard.setAttributeValue("owner",t.owner.fullName,t.owner.isVaries),this.IssueIDCard.setAttributeValue("collabspace",t.collaborativeSpace.value,t.collaborativeSpace.isVaries),this.IssueIDCard.setAttributeValue("responsibleOrg",t.responsibleOrg.value,t.responsibleOrg.isVaries),this.IssueIDCard.setAttributeValue("reportingOrg",t.reportingOrg.value,t.reportingOrg.isVaries),this.IssueIDCard.setAttributeValue("priority",t.priority);let n=e.map(e=>({physicalId:e.body.physicalId,state:e.body.state,owners:[e.body.owner,...e.body.coOwners],assignees:e.body.assignees}));this.IssueIDCard.displayMaturity(n)},_idCardSubscribers:function(){var e=this;a.subscribe("Lifecycle.Modification",function(t){var n=JSON.parse(t).Refresh.modified;if(Array.isArray(n)){var i=n.reduce((e,t)=>(e["Issue"==t.policy?"issuesPhysicalIds":"objectsPhysicalIds"].push(t),e),{issuesPhysicalIds:[],objectsPhysicalIds:[]}),s=i.issuesPhysicalIds,o=i.objectsPhysicalIds;if(s.length>0){let t=[],n=[];s.forEach(e=>{t.push(e.physicalid),n.push({physicalId:e.physicalid})}),e.refresh(t),e._publishUpdate(n)}var a=o.filter(e=>null!=e.policy);a.length>0&&e.updateObjectNode(a)}}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-nav-prev"},function(){var t=b.get("component").getTreeListView();if(e.listView=b.get("ISU_LISTVIEW"),n.is(t,"object")){var i=t.getManager();if(n.is(i,"object")){var s="";s=e.listView?i.getActiveNode():i.getTreeDocument().getSelectedNodes()[0],e._scrollToPreviousNode(s)}}}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-nav-next"},function(){var t=b.get("component").getTreeListView();if(e.listView=b.get("ISU_LISTVIEW"),n.is(t,"object")){var i=t.getManager();if(n.is(i,"object")){var s="";s=e.listView?i.getActiveNode():i.getTreeDocument().getSelectedNodes()[0],e._scrollToNextNode(s)}}}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-nav-close"},function(e){m.getCommand("ToggleInformationPanel").begin({open:!1,save:!0})}),e.IssueIDCard.modelEvents.subscribe({event:"idcard-expanded"},function(t){e.dispatchEvent("request:resizeContent",{state:"expanded"})}),e.IssueIDCard.modelEvents.subscribe({event:"idcard-minified"},function(t){e.dispatchEvent("request:resizeContent",{state:"minified"})}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-actions-menu-click"},function(t){var n=e.IssueIDCard.container.getElement(".actions-menu-icon").getBoundingClientRect(),i={position:{x:n.left,y:n.top+20}};g.getContextualMenu().then(function(e){l.show(e,i)})}),e.IssueIDCard.modelEvents.subscribe({event:"idcard-attributes-clicked"},function(t){if(console.log("idcard-attributes-clicked: modelEvents"),n.is(t.index,"number"))switch(console.log(t.index),t.index){case 0:break;case 1:m.getCommand("ChangeOwner").begin();break;case 2:m.getCommand("Move").begin();break;case 6:1==e.physicalIds.length&&e.changeResponsibleOrg();break;default:e.dispatchEvent("request:switchFacet",{facetName:"properties"})}}),e.IssueIDCard.modelEvents.subscribe({event:"idcard-thumbnail-clicked"},function(e){m.getCommand("AttachmentManager").begin()}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-maturity-update"},function(t){let n=e.physicalIds.map(e=>({physicalId:e}));e._publishUpdate(n)}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-responsibleOrg-update"},function(t){let n=e.physicalIds.map(e=>({physicalId:e}));var i=[[n[0].physicalId]],s={};s[n[0].physicalId]={id:n[0].physicalId,type:"Issue",modifiedAttributes:["responsibleOrg"]},a.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:i,attributes:s},version:"1.0"})}),e.IssueIDCard.modelEvents.subscribe({event:"onApprovalCompleted"},function(t){var n=t.issues.map(function(e){return e.physicalId});1===n.length&&e._refreshInfo(n),e._refreshPrimaryImage(n),e._publishUpdate(t.issues,t.modifiedAttributes)}),e.IssueIDCard.modelEvents.subscribe({event:"onRejectionCompleted"},function(t){var n=t.issues.map(function(e){return e.physicalId});1===n.length&&e._refreshInfo(n),e._refreshPrimaryImage(n),e._publishUpdate(t.issues,t.modifiedAttributes)}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-maturity-history-click"},function(t){e.dispatchEvent("request:switchFacet",{facetName:"history"})}),e.IssueIDCard.modelEvents.subscribe({event:"refresh-issue-header"},function(t){e.refresh(e.physicalIds);let n=e.physicalIds.map(e=>({physicalId:e}));e._publishUpdate(n)})},_getMembersCount:function(e){let t=new Set;return t.add(e.owner.user),e.assignees.map(e=>{t.add(e.user)}),e.contributors.map(e=>{t.add(e.user)}),e.coOwners.map(e=>{t.add(e.user)}),e.informedUsers.map(e=>{t.add(e.user)}),t.size},changeResponsibleOrg:function(){var e,t=this;t.moveButton;var o=t.IssueIDCard.model.get("attributes").find(e=>"responsibleOrg"==e.id);e=new c({animate:!0,autocenter:!0,closable:!0,limitParent:!0,overlay:!0,resizable:!0,visible:!0,className:"confirm-select-in-3d-dialog",title:S.information.header.moveResponsibleOrg,header:null,body:n.createElement("div",{class:"idcard-form-element idcard-form-element-responsible-organization",html:[{tag:"div",class:"idcard-form-field form-group",html:[{tag:"h5",html:S.information.header.changeResponsibleOrg},{tag:"div",html:[t.fields.addResponsibleOrganization=t._orgSearch("responsibleOrganization"),t.fields.responsibleOrganization=n.createElement("div",{class:"idcard-responsible-organization-holder"}),t.fields.responsibleOrganization.responsibleOrganizationHelper=n.createElement("div",{html:[n.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"idcard-form-help-tooltip",html:[t.fields.responsibleOrganization.responsibleOrganizationHelper]}]}),footer:[t.moveButton=new i({value:S.information.header.move,className:"primary",disabled:!0,events:{onClick:function(){I.issues.update({data:{objects:[{physicalId:t.physicalIds[0],responsibleOrganization:t.values.responsibleOrganization}]},onComplete:function(e){w.displayNotification({msg:S.information.header.moveOrgMsg,eventID:"info"}),o.value=t.values.responsibleOrganizationTitle,t.IssueIDCard.modelEvents.publish({event:"issue-idcard-responsibleOrg-update",data:{}})},onFailure:function(e){w.displayNotification({msg:e.error.message,eventID:"error"})}}),setTimeout(function(){e.destroy(),e=null},100)}}}),new i({value:S.information.header.cancel,className:"default",events:{onClick:function(){setTimeout(function(){e.destroy(),e=null},100)}}})],events:{onClose:function(){setTimeout(function(){e.destroy(),e=null},100)}}}).inject(widget.body),t._setOrganization(o.value,"responsibleOrganization",!1),t.fields.responsibleOrganization.responsibleOrganizationHelper.tooltipInfos=new s({shortHelp:C.create.team.labels.responsibleOrganizationHelper})},_orgSearch:function(e){var t=this,n=new f({className:"searchPeople_TransferOwnership",MaxNumber:"5",MaxSize:"300",position:"auto",showEmptyCategory:!1,type:v.TYPE_ORGANIZATION,events:{onValid:function(){var i=n.getNewOwner().organization;t._setOrganization(i.orgID,e,i.orgTitle,!0),n.clearInput(),n.getContent().searchInput.focus()},onUnvalid:function(){},onError:function(){w.displayNotification({msg:C.team.error.orgNotFound,eventID:"info"})}}});return n.setSelectedItemList([{objectID:t.organizations[0].physicalId}]),n},_setOrganization:function(e,t,i,s){if(!n.is(i)||""==i){i=e;var o=b.get(E.BASE_NLS);n.is(o)&&n.is(o["ds6w:organizationResponsible"][e])&&(i=o["ds6w:organizationResponsible"][e])}var a=n.createElement("div",{class:"idcard-content-org-container",html:[n.createElement("span",{class:"idcard-content-org-icon fonticon view-icon fonticon-users"}),n.createElement("span",{class:"idcard-content-org-info",html:u.getTextFromHTML(i)})]});s&&this.moveButton.setDisabled(!1),this.fields[t].empty(),this.fields[t].appendChild(a),this.values.responsibleOrganization=e,this.values.responsibleOrganizationTitle=i},updateObjectNode:function(e){var t=b.get("component").getSelectedNodes(),i=[];e.forEach(e=>{null!=e.policy&&(e.maturity=e.policy+"."+e.state,i.push(e.maturity))});var s={"ds6w:status":i};I.getNLSValuesPromise(s).then(i=>{if(n.is(i["ds6w:status"])){var s=Object.values(i["ds6w:status"])[0],o="issue-list-cell-state "+s.toLowerCase().replace(/ /g,"");t.filter(t=>e.some(e=>t.options.physicalId.includes(e.physicalid))).forEach(e=>{e.updateOptions({state:s,grid:{"ds6w:state":'<span class=" '+o+' "><span class="cell-state-content">'+s+"</span></span>"}})})}})}})}),define("DS/IssueManagement/components/information/Information",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/ENO6WPlugins/jQuery","DS/ExternalComponents/jQueryUI","DS/Logger/Logger","DS/CoreEvents/ModelEvents","DS/IssueManagement/components/information/Content","DS/IssueManagement/components/information/IssueHeader","DS/IssueManagement/components/information/Header","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c,d,u,m){"use strict";var p=!0,h="Issue",g={RIGHT:"right",BOTTOM:"bottom",CLOSED:"closed"},f={ELEMENTS:{INNER:"im-information-inner",NO_SELECTION_PLACEHOLDER:"im-information-no-selection-placeholder",FULLSCREEN_INDICATOR_RESIZING:"im-information-fullscreen-indicator-resizing"},LAYOUTS:{RIGHT:"layout-right",BOTTOM:"layout-bottom",CLOSED:"layout-closed"},DIMENSIONS:{RIGHT_LAYOUT:{DEFAULT_WIDTH:430,MIN_WIDTH:430},BOTTOM_LAYOUT:{DEFAULT_HEIGHT:400,MIN_HEIGHT:400},MINIMUM_REMAINING_HEIGHT:75,MINIMUM_REMAINING_WIDTH:260,MVHAW:260},STATUS:{NO_SELECTION:"no-selection",MULTI_SELECTION:"multi-selection"}};return t.extend({name:"DS/IssueManagement/components/information/Information",tagName:"div",className:"im-information-component",_logger:null,layout:{current:g.RIGHT,width:f.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH,height:f.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT},elements:{inner:null,placeholder:null},physicalIds:[],resizer:null,header:null,content:null,fullscreenWidth:!1,fullScreenMode:!1,_isOpened:!1,_subscriberId:"",_subscriberTokens:[],previousPhysicalIds:[],setup:function(e){u.start(this.name+" setup"),this._parent(e),this._logger=o.getLogger(this.name);var t=this.getPreferences();t.current!==g.RIGHT&&t.current!==g.BOTTOM&&(t.current=g.RIGHT,this.setPreferences({current:t.current})),this._isOpened=t.isOpened||!1,this.layout={current:t.current||g.RIGHT,isOpened:this.isOpened,width:t.width||f.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH,height:t.height||f.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT},this.elements={inner:null,placeholder:null},this.physicalIds=[],this.resizer=null,this._subscriberId=Math.random().toString(36).substr(2,9),this._subscriberTokens=[],this._subscribers(),u.end(this.name+" setup")},render:function(){return u.start(this.name+" render"),this.elements.inner=n.createElement("div",{class:f.ELEMENTS.INNER}),this.elements.inner.inject(this.container),this.elements.placeholder=this.utils.placeholder(),this.elements.placeholder.inject(this.elements.inner),this.customModelEvents=new a,this.header=p?new l({customEvents:this.customModelEvents}):new c({customEvents:this.customModelEvents}),this.header.render().inject(this.elements.inner),this._listenToHeader(),this.content=new r({customEvents:this.customModelEvents}),this.content.render().inject(this.elements.inner),this.container.toggleClassName(f.STATUS.NO_SELECTION,!0),this.container.toggleClassName(f.STATUS.MULTI_SELECTION,!1),this._resizable(),u.end(this.name+" render"),this},refreshInfo:function(e){var t=this;e&&(t.physicalIds=e);var n=t.content.getCurrentFacet().name;(t._isOpened&&!function(){if(t.previousPhysicalIds.length!==t.physicalIds.length)return!1;for(var e=0;e<t.previousPhysicalIds.length;e++)if(!1===t.physicalIds.includes(t.previousPhysicalIds[e]))return!1;return!0}()||t._isOpened&&"properties"==n)&&(t.refresh(t.physicalIds),t.resize(),t.previousPhysicalIds=t.physicalIds)},refresh:function(t){var n=this;Array.isArray(t)&&(n.physicalIds=t),n.container.toggleClassName(f.STATUS.NO_SELECTION,0===n.physicalIds.length),n.container.toggleClassName(f.STATUS.MULTI_SELECTION,n.physicalIds.length>1);var i=[n.header.refresh(n.physicalIds),n.content.refresh(n.physicalIds,{force:!0})];return e.all(i).then(function(){n.dispatchEvent("onRefresh")})},resize:function(){var e=d.get("widget")||window.widget,t=this.container.getParent();if(this.container&&t){if(this.layout.current===g.RIGHT){var n=this.container.offsetWidth,i=t.offsetWidth;!0===this.fullscreenWidth?this.container.setStyle("width",i):e.body.offsetWidth>=f.DIMENSIONS.MVHAW&&n>i-f.DIMENSIONS.MINIMUM_REMAINING_WIDTH?this.container.setStyle("width",i-f.DIMENSIONS.MINIMUM_REMAINING_WIDTH):this.container.setStyle("width",this.layout.width)}else if(this.layout.current===g.BOTTOM){var s=this.container.offsetHeight,o=t.offsetHeight;e.body.offsetHeight>=f.DIMENSIONS.MVHAW&&s>o-f.DIMENSIONS.MINIMUM_REMAINING_HEIGHT&&this.container.setStyle("height",o-f.DIMENSIONS.MINIMUM_REMAINING_HEIGHT)}this.header.resize(),this.content.resize(),d.get("component").resize()}},destroy:function(){this._subscriberTokens.forEach(function(e){d.get("eventsHandler").unsubscribe(e)}),this._subscriberTokens=[],this._subscriberId="",this.layout={current:g.RIGHT,isOpened:!1,width:f.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH,height:f.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT},this.elements={inner:null,placeholder:null},this.physicalIds=[],i(this.container).resizable("destroy"),this.resizer=null,this.header.destroy(),this.header=null,this.content.destroy(),this.content=null,this.container.empty()},setLayout:function(e){e!==g.RIGHT&&e!==g.BOTTOM||(this.layout.current=e,this.setPreferences({current:e}),this.getPreferences().isOpened&&this.open())},open:function(e){var t=this.container.getParent();t.removeClassName(f.LAYOUTS.CLOSED),t.removeClassName(f.LAYOUTS.RIGHT),t.removeClassName(f.LAYOUTS.BOTTOM);var n=this.getPreferences();if(this.layout.current===g.RIGHT){let e=t.offsetWidth-450,i=f.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH;i=e>i?e:i,this.layout.width=n.width||i,this.container.setStyles({width:this.layout.width,height:"100%"}),t.addClassName(f.LAYOUTS.RIGHT)}else this.layout.current===g.BOTTOM&&(this.layout.height=n.height||f.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT,this.container.setStyles({width:"100%",height:this.layout.height}),t.addClassName(f.LAYOUTS.BOTTOM));this._isOpened=!0,this.resize(),!0===e&&this.setPreferences({isOpened:!0})},close:function(e){var t=this.container.getParent();this.container.setStyles({width:0,height:0}),t.addClassName(f.LAYOUTS.CLOSED),t.removeClassName(f.LAYOUTS.RIGHT),t.removeClassName(f.LAYOUTS.BOTTOM),this.layout.width=0,this.layout.height=0,this._isOpened=!1,d.get("component").resize(),!0===e&&this.setPreferences({isOpened:!1})},toggle:function(e,t){!0===(n.is(e,"boolean")?e:!this.getPreferences().isOpened)?this.open(t):this.close(t)},switchFacet:function(e){return this.content.switchFacet(e)},setPreferences:function(e){var t=d.get("widget")||window.widget;e&&n.is(e.isOpened,"boolean")&&t.setValue("infoIsOpened",e.isOpened),e&&n.is(e.current,"string")&&t.setValue("infoLayout",e.current),e&&n.is(e.width,"number")&&t.setValue("infoLayoutRightWidth",e.width),e&&n.is(e.height,"number")&&t.setValue("infoLayoutBottomHeight",e.height)},getPreferences:function(){var e=d.get("widget")||window.widget;return{current:n.is(e.getValue("infoLayout"),"string")?e.getValue("infoLayout"):g.RIGHT,isOpened:!!n.is(e.getValue("infoIsOpened"),"boolean")&&e.getValue("infoIsOpened"),width:e.getValue("infoLayoutRightWidth"),height:e.getValue("infoLayoutBottomHeight")}},getLayout:function(){return this.layout},getInformationHeader:function(){return this.header},getInformationContent:function(){return this.content},isOpened:function(){return this._isOpened},_resizable:function(){var e=this;e.resizer=i(e.container).resizable({handles:"n, w",helper:"ui-resizable-helper-information-left",minWidth:f.DIMENSIONS.RIGHT_LAYOUT.MIN_WIDTH,minHeight:f.DIMENSIONS.BOTTOM_LAYOUT.MIN_HEIGHT,start:function(t,s){if(e.fullScreenMode=!1,e.layout.current===g.RIGHT){var o=document.querySelector(".ui-resizable-helper-information-left");o&&(o.getElementsByClassName(f.ELEMENTS.FULLSCREEN_INDICATOR_RESIZING).length||(e.elements.fullscreenIndicator=n.createElement("div",{class:f.ELEMENTS.FULLSCREEN_INDICATOR_RESIZING}),n.createElement("span",{class:"fonticon fonticon-2x fonticon-move-to-start"}).inject(e.elements.fullscreenIndicator),e.elements.fullscreenIndicator.inject(o))),s.helper[s.helper.length-1].setAttribute("class","ui-resizable-helper-information-left");var a=e.container.getParent().offsetWidth;i(e.container).resizable("option","maxWidth",a)}else if(e.layout.current===g.BOTTOM){s.helper[s.helper.length-1].setAttribute("class","ui-resizable-helper-information-top");var r=e.container.getParent().offsetHeight;i(e.container).resizable("option","maxHeight",r-f.DIMENSIONS.MINIMUM_REMAINING_HEIGHT)}e.container.getParent().addClassName("information-panel-resizing")},resize:function(t){if(e.layout.current===g.RIGHT){e.fullscreenWidth=!!e.fullScreenMode||t.clientX>=0&&t.clientX<=260;var n=document.querySelector("."+f.ELEMENTS.FULLSCREEN_INDICATOR_RESIZING);n&&n.toggleClassName("visible",e.fullscreenWidth)}},stop:function(t,n){e.container.getParent().removeClassName("information-panel-resizing"),e.layout.current===g.RIGHT?(e.layout.width=n.size.width,e.setPreferences({width:e.layout.width})):e.layout.current===g.BOTTOM&&(e.layout.height=n.size.height,e.setPreferences({height:e.layout.height})),e.resize()}})},_subscribers:function(){var e=this,t=d.get("eventsHandler");e._subscriberTokens.push(t.subscribe(e._subscriberId,"DS/Object/select",function(t){var n=Object.keys(t.data.attributes),i=[],s=d.get("component");if(s._tasks&&s._tasks.current&&s._tasks.current.taskType&&"SELECT_IN_3D"===s._tasks.current.taskType)return!1;var o=s.getTreeDocument();if(n.forEach(function(e){var t=o.getNodesById(e);t.length>0&&t[0].options.baseType===h&&i.push(e)}),n.length>0&&0===i.length)return!1;e.physicalIds=i})),e._subscriberTokens.push(t.subscribe(e._subscriberId,"DS/Object/delete",function(t){for(var i=Object.keys(t.data.attributes),s=n.clone(e.physicalIds),o=0;o<i.length;o++){var a=s.indexOf(i[o]);-1!==a&&s.splice(a,1)}e.physicalIds.length!==s.length&&e._isOpened&&e.refresh(s)}))},_listenToHeader:function(){var e=this;e.listenTo(e.header,"request:switchFacet",function(t){var i=e.switchFacet(t.facetName);n.is(t.callback,"function")&&i.then(t.callback)}),e.listenTo(e.header,"request:resizeContent",function(t){"expanded"==t.state&&e.content.container.removeClassName("collapsed-idcard"),"minified"==t.state&&e.content.container.addClassName("collapsed-idcard"),e.content.resize()})},utils:{placeholder:function(){return n.createElement("div",{class:f.ELEMENTS.NO_SELECTION_PLACEHOLDER,html:[n.createElement("span",{class:"fonticon fonticon-5x fonticon-info"}),n.createElement("span",{class:"no-selection-placeholder-label",html:m.information.views.noSelection})]})}}})}),define("DS/IssueManagement/views/kanban/Keyboard",["UWA/Core","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/views/list/Keyboard","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(e,t,n,i,s){"use strict";var o="DS/IssueManagement/views/kanban/Keyboard",a=function(){return!(window.document.getElementsByClassName("wux-menu").length>0&&window.document.getElementsByClassName("wux-menu-container").length>0)};return{override:function(t){var n=this._addShouldWeProcessThisInputTrigger(t);return e.extend(n,this.commands)},_addShouldWeProcessThisInputTrigger:function(t){s.start(o+" _addShouldWeProcessThisInputTrigger");var n=e.clone(t);for(var i in t)!function(){if(t.hasOwnProperty(i)){var e=t[i];n[i]=function(){return!1===a()?null:e.apply(this,arguments)}}}();return s.end(o+" _addShouldWeProcessThisInputTrigger"),n},commands:{rightMove:function(){if(!1!==a()){s.start(o+" right");var t=i.get("component").getKanbanView();if(e.is(t.siblings.right,"object")){t.siblings.right.grid.elements.container.focus();var n=t.siblings.right.getTreeDocument().getRoots(!1);e.is(n[t.verticalLevelSelector],"object")?n[t.verticalLevelSelector].select():n.length>0&&n[n.length-1].select()}s.end(o+" right")}},leftMove:function(){if(!1!==a()){s.start(o+" left");var t=i.get("component").getKanbanView();if(e.is(t.siblings.left,"object")){t.siblings.left.grid.elements.container.focus();var n=t.siblings.left.getTreeDocument().getRoots(!1);e.is(n[t.verticalLevelSelector],"object")?n[t.verticalLevelSelector].select():n.length>0&&n[n.length-1].select()}s.end(o+" left")}},enter:e.clone(n["treelistview:edit-mode"]),escape:e.clone(n["treelistview:edit-cancel"]),copy:e.clone(n["treelistview:copy-node"]),deleteKeyPressed:e.clone(n["treelistview:delete-node"])}}}),define("DS/IssueManagement/export/ExportCSV",["UWA/Class/Promise","UWA/Core","DS/IssueManagement/export/Utils","DS/IssueServices/Contexts","DS/IssueComponents/utils/Utils","DS/IssueServices/utils/Performance","i18n!DS/IssueCommon/assets/nls/IssueCommon","DS/IssueServices/services/IssueServices","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l){"use strict";var c="DS/IssueManagement/export/ExportCSV",d="Issue",u=0;return{exportation:function(){let t,s=new e(e=>{t=e});o.start(c+" exportation"),n.notifications.exporting();var a=i.get("component");new Set;var r=a.getSelectedNodes().filter(function(e){return e.options.baseType===d});return this.getCSV({type:"string",roots:r}).then(e=>{var i=l.export.csv.name;1===r.length&&(i=i+r[r.length-1].options.name+"_");var s=i+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv";n.download.csv(e,s,"text/csv;encoding:utf-8"),t()}),s},getCSV:function(n){var s=this;let a,l=new e(e=>{a=e});var u="string";if(n&&t.is(n.type,"string"))switch(n.type){case"string":u="string";break;case"array":u="array";break;default:u="string"}o.start(c+" exportation");var m=i.get("component"),p=m.getTreeListView().getManager().getColumns();let h=!1;m.list.getManager().getColumns().forEach(function(e){!m.attributes.includes(e.dataIndex)||p.includes(e)||e.isHidden||p.push(e),"ds6w:validation"==e.dataIndex&&(h=e.visibleFlag)});var g=[],f=[s.utils.escape("sep=,")];g.push(f);let v=(p=p.filter(e=>t.is(e.visibleFlag)&&e.visibleFlag)).filter(e=>t.is(e.isCustom)&&e.isCustom);v=v.map(e=>({name:e.dataIndex})),g.push(s.utils.getCSVHeader({columns:p}));var b=n&&Array.isArray(n.roots)?n.roots:m.getSelectedNodes().filter(function(e){return e.options.baseType===d});0===b.length&&(b=m.getTreeDocument().getRoots(!1));let I={};var y=new Set,w=[];b.map(e=>{if(e.options.validation.activated&&w.push(e.options.physicalId),t.is(e.options.reportedAgainst,"array")&&e.options.reportedAgainst!=[]&&e.options.reportedAgainst.map(e=>{y.add(e.type)}),t.is(e.options.resolvedBy,"array")&&e.options.resolvedBy!=[]&&e.options.resolvedBy.map(e=>{y.add(e.type)}),t.is(e.options.resolvedItems,"array")&&e.options.resolvedItems!=[]&&e.options.resolvedItems.map(e=>{y.add(e.type)}),t.is(e.options.contexts,"array")&&e.options.contexts!=[]&&e.options.contexts.map(e=>{y.add(e.type)}),v.length>0){let t=I[e.options.physicalId]={};t.attributes=[],t.physicalId=e.options.physicalId,v.forEach(e=>t.attributes.push(e))}});var S=w.reduce(function(e,t){return e.push({physicalId:t}),e},[]);return r.routes.retrieve({data:{objects:S,validationColumnVisibility:h}}).then(function(e){"validationColumnInvisible"!==e&&s.utils.updateValidationStatus(e,b),m.loadInfo(b).then(()=>{var e={"ds6w:type":[...y]};r.getNLSValuesPromise(e).then(e=>e=t.is(e["ds6w:type"])?e["ds6w:type"]:{}).then(e=>{r.classification.retrieve({data:{objects:I}}).then(function(t){let n=t.results,i={};n.forEach(e=>{let t=e.body;i[t.physicalId]=[];for(var n=I[t.physicalId].attributes,s=0;s<n.length;s++){var o=n[s].name,a=t[o].substring(1,t[o].length-1),r={};r.attrName=o,r.attrValue=a,i[t.physicalId].push(r)}});for(var r=0;r<b.length;r++){let t=b[r];if(i[t.options.physicalId]){for(var l=i[t.options.physicalId],d={grid:{}},m=0;m<l.length;m++){var h=l[m].attrName,f=l[m].attrValue;d.grid[h]=f}t.updateOptions(d)}g.push(s.utils.getCSVRow({node:b[r],columns:p,typeNLS:e}))}if(o.end(c+" exportation"),"array"!==u){if("string"===u){for(var v=[],y=0;y<g.length;y++){var w=g[y].join(",");v.push(w)}a(v.join("\n"))}a(g)}else a(g)})})})}),l},utils:{getCSVHeader:function(e){o.start(c+" getCSVHeader");for(var t=[],n=0;n<e.columns.length;n++)if(this.isExportable(e.columns[n])){var i=e.columns[n].text;t.push(this.escape(i))}return o.end(c+" getCSVHeader"),t},getCSVRow:function(e){o.start(c+" getCSVRow");for(var n=[],r=e.node,d=0;d<e.columns.length;d++)if(this.isExportable(e.columns[d])){var u=e.columns[d].dataIndex;switch(u){case"tree":n.push(this.escape(e.node.getLabel()));break;case"ds6w:occurrence":let o=[];var m=r.getAllDescendants();for(let e=0;e<m.length;e++){var p=m[e].options.grid["ds6w:occurrence"];p&&o.push(p)}n.push(this.escape(o.join(",")));break;case"ds6w:reportedAgainst":for(var h=r.options.reportedAgainst,g=[],f=0;f<h.length;f++)g.push(h[f].title+" ("+h[f].name+") "+(e.typeNLS[h[f].type]?e.typeNLS[h[f].type]:h[f].type)+" "+h[f].revision);n.push(this.escape(g.join(", ")));break;case"ds6w:resolvedBy":for(var v=r.options.resolvedBy,b=[],I=0;I<v.length;I++)b.push(v[I].title+" ("+v[I].name+") "+(e.typeNLS[v[I].type]?e.typeNLS[v[I].type]:v[I].type)+" "+v[I].revision);n.push(this.escape(b.join(", ")));break;case"ds6w:resolvedItems":for(var y=r.options.resolvedItems,w=[],S=0;S<y.length;S++)w.push(y[S].title+" ("+y[S].name+") "+(e.typeNLS[y[S].type]?e.typeNLS[y[S].type]:y[S].type)+" "+y[S].revision);n.push(this.escape(w.join(", ")));break;case"ds6w:contexts":for(var C=r.options.contexts,E=[],_=0;_<C.length;_++)E.push(C[_].title+" ("+C[_].name+") "+(e.typeNLS[C[_].type]?e.typeNLS[C[_].type]:C[_].type)+" "+C[_].revision);n.push(this.escape(E.join(", ")));break;case"ds6w:assignees":for(var T=r.options.assignees,D=[],M=0;M<T.length;M++)"person"===T[M].type?D.push(T[M].fullName+" ("+T[M].user+")"):D.push(T[M].fullName);n.push(this.escape(D.join(", ")));break;case"ds6w:coOwners":for(var A=r.options.coOwners,x=[],N=0;N<A.length;N++)x.push(A[N].fullName+" ("+A[N].user+")");n.push(this.escape(x.join(", ")));break;case"ds6w:contributors":for(var O=r.options.contributors,P=[],k=0;k<O.length;k++)P.push(O[k].fullName+" ("+O[k].user+")");n.push(this.escape(P.join(", ")));break;case"ds6w:informedUsers":for(var L=r.options.informedUsers,R=[],U=0;U<L.length;U++)R.push(L[U].fullName+" ("+L[U].user+")");n.push(this.escape(R.join(", ")));break;case"ds6w:validation":n.push(this.escape(r.options.validation.toString()));break;case"ds6w:description":var V=r.options.description;n.push(this.escape(V));break;case"ds6w:created":case"ds6w:modified":case"ds6w:actualStartDate":case"ds6w:actualEndDate":var F=u.slice(5),j={};if(t.is(r.options[F],"string")&&r.options[F].length>0){j[F]=r.options[F];var B=s.getFormattedDate(j,{});n.push(this.escape(B[F]))}else n.push(this.escape(""));break;case"ds6w:estimatedStartDate":case"ds6w:estimatedEndDate":case"ds6w:resolutionDate":var W=u.slice(5),H={};if(t.is(r.options[W],"string")&&r.options[W].length>0){H[W]=r.options[W];var z=s.getFormattedDate(H,{});n.push(this.escape(z[W]))}else n.push(this.escape(""));break;case"ds6w:state":var G=a.maturity[r.options.state.toLowerCase()],K=i.get("maturityGraph");null!=K&&""!==K&&(G=K[r.options.state]),G=this.escape(G),n.push(G);break;case"ds6w:priority":G=r.options.priority;G=this.escape(G),n.push(G);break;case"ds6w:originator":G=r.options.originator.fullName;G=this.escape(G),n.push(G);break;case"ds6w:owner":G=r.options.owner.fullName;G=this.escape(G),n.push(G);break;case"Approvals":G=r.options.grid.Approvals;var q=r.options.grid.Approvals?l.approvals.approvalOn:l.approvals.approvalOff;n.push(q);break;case"Library":for(var Y=r.options.libraries,J=[],X=0;X<Y.length;X++)J.push(Y[X]);n.push(this.escape(J.join(", ")));break;case"Library Classes":for(var Z=r.options.library,$=[],Q=0;Q<Z.length;Q++)$.push(Z[Q]);n.push(this.escape($.join(", ")));break;default:var ee=e.columns[d].dataIndex;if(t.is(r.options.grid[ee],"string")){G=r.options.grid[ee];G=this.escape(G),n.push(G)}}}return o.end(c+" getCSVRow"),n},escape:function(e){return e='"'+(e=e.replace(/"/g,'""'))+'"'},isExportable:function(e){return!t.is(e.export,"object")&&!0===e.visibleFlag||!(!t.is(e.export,"object")||!0!==e.export.value||!0!==e.visibleFlag)},updateValidationStatus:function(e,n){for(var i={},s=0;s<e.results.length;s++){var o=e.results[s].body,a={};if(t.is(o.current.status,"string"))a=t.clone(o.current);else if(Array.isArray(o.history)&&o.history.length>0){var r=o.history.sort(function(e,t){var n=0;if(e.date)if(t.date){n=new Date(e.date)-new Date(t.date)}else n=1;else n=-1;return-1*n});a=t.clone(r[u])}else a={status:"notStarted",approveTo:"",decisions:[]};i[o.physicalId]={activated:!0,fetched:!0,status:a.status,approveTo:a.approveTo,decisions:a.decisions}}for(var l=0;l<n.length;l++){var c=n[l];i[c.options.physicalId]&&c.updateOptions({validation:i[c.options.physicalId]})}}}}}),define("DS/IssueManagement/export/ExportZIP",["UWA/Core","UWA/Promise","DS/Logger/Logger","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueManagement/export/ExportCSV","DS/IssueManagement/export/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/ExternalComponents/JSZip","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c,d){"use strict";var u="DS/IssueManagement/export/ExportZIP",m="Issue";return{exportation:function(){var n=this;l.start(u+" exportation");var i=a.get("status"),r=[],m={},p=new c;return n.getNodes().then(function(e){return r=e,o.notifications.exporting(),i.loading.start(),i.loading.update(d.export.zip.images),n.getImages({nodes:r})}).then(function(n){m=n;var i=[];return r.forEach(function(n){var s=p.folder(n.options.name),o=m[n.options.physicalId];e.is(o,"object")&&i.push(fetch(o.url).then(function(e){return 200===e.status||0===e.status?t.resolve(e.blob()):t.reject(new Error(e))}).then(function(e){s.file(d.export.zip.primary,e)}))}),t.all(i)}).then(function(){return i.loading.update(d.export.zip.documents),n.getFiles({nodes:r})}).then(function(n){var a=[];return n.forEach(function(n){var i=p.folder(n.name),s={};s[n.name+"-"+d.export.zip.primary]=0,n.response.forEach(function(o){e.is(o,"object")&&!o.errorMessage&&a.push(fetch(o.downloadUrl).then(function(e){return 200===e.status||0===e.status?t.resolve(e.blob()):t.reject(new Error(e.statusText))}).then(function(t){var a=o.fileName;if(null!==i.file(a)){var r=/(?:\.([^.]+))?$/.exec(a)[1];e.is(r,"string")||(r="");var l=a.replace(/\.[^/.]+$/,"");s[n.name+"-"+a]+=1,a=l+" ("+s[n.name+"-"+a]+")."+r}Number.isInteger(s[n.name+"-"+a])||(s[n.name+"-"+a]=0),i.file(a,t)}))})}),t.all(a).then(function(){return s.getCSV({type:"string"})}).then(function(e){i.loading.update(d.export.zip.zipping);var t=d.export.csv.name;1===r.length&&(t=t+r[r.length-1].options.name+"_");var n=t+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv";return n=n.split(":").join("_"),p.file(n,"\ufeff"+e),p.generateAsync({type:"blob"}).then(function(e){i.loading.hide(d.export.zip.done);var t=document.createElement("a"),n=t.href=URL.createObjectURL(e),s=d.export.zip.name;1===r.length&&(s=s+r[r.length-1].options.name+"_"),t.setAttribute("download",s+(new Date).toString().split(" ").splice(1,4).join(" ")+".zip"),document.body.appendChild(t),t.click(),setTimeout(function(){document.body.removeChild(t),URL.revokeObjectURL(n)},0)})},function(){o.notifications.failure()})})},getNodes:function(){var e=a.get("component");return new t(function(t,n){var i=e.getSelectedNodes().filter(function(e){return e.options.type===m});0===i.length?(0===(i=e.getTreeDocument().getRoots(!1)).length&&(o.notifications.nothing(),n(new Error("Nothing to export as ZIP"))),o.confirmation({title:d.export.zip.title,content:d.replace(d.export.zip.content,{number:i.length})}).then(function(e){!0===e?t(i):n(new Error("Export ZIP canceled by user"))})):t(i)})},getFiles:function(e){var n=e.nodes,s=[];return n.forEach(function(e){s.push(i.getDocumentsFrom(e.options.physicalId).then(function(t){return{response:t,name:e.options.name}}))}),t.all(s).then(function(e){var n=[];return e.forEach(function(e){var t=e.response.attachments.reduce(function(e,t){return e.push(t.id),e},[]);n.push(i.downloadDocuments(t).then(function(t){return{response:t,name:e.name}}))}),t.all(n)})},getImages:function(t){var i=t.nodes,s={};return r.images.retrieve({data:{objects:i.map(function(e){return{physicalId:e.options.physicalId}})}}).then(function(t){for(var n=0;n<t.results.length;n++){var i=t.results[n].body;e.is(i,"object")&&e.is(i.fileName,"string")&&""!==i.fileName&&e.is(i.url,"string")&&""!==i.url&&(s[i.physicalId]=i)}return s},function(e){return n.getLogger(u).error("Cannot fetch the primary images %o",e),s})}}}),define("DS/IssueManagement/views/kanban/TileList",["UWA/Core","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/IssueManagement/views/kanban/Keyboard"],function(e,t,n){"use strict";return t.inherit({_manageKeyboard:function(){this._parent();var t=n.override(this.commands);e.extend(this.commands,t)}})}),define("DS/IssueManagement/models/TreeDocument",["UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/Tree/TreeDocument","DS/TreeModel/BaseFilter","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/models/TreeNodeModel","DS/IssueManagement/utils/ModelParser","DS/IssueServices/Contexts","DS/IssueServices/utils/Parser","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f){"use strict";var v="Issue",b=10,I=0,y=100,w=100,S=function(e,t,n){var i;return function(){var s=this,o=arguments,a=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(s,o)},t),a&&e.apply(s,o)}},C=this;return o.extend({name:"DS/IssueManagement/models/TreeDocument",_logger:null,component:null,settings:{},_publishSelection:!1,_onNodeModelUpdateSubscriptionToken:"",init:function(t){this.listView=d.get("ISU_LISTVIEW"),C=this,this._logger=n.getLogger("DS/IssueManagement/Model"),this.component=t.component,this.settings=t.settings,t.list=e.merge(t.document||{},this.getEventOptions()),this._parent(t.document),this._publishSelection=!1,this.listView||(this.initCustomFilter(),this.registerCustomFilter()),this._subscribers()},registerNodeModelUpdateEvent:function(){var t=this;t._onNodeModelUpdateSubscriptionToken=t.onNodeModelUpdate(function(n){var o=n.data.nodeModel;if(o){var a=n.data.attributes,r={id:o.options.physicalId};if(a.hasOwnProperty("Approvals")){o.options.id;a.Approvals?m.issues.enableApproval({data:r,onComplete:function(e){t.undoRegisterNodeModelUpdateEvent(),t.withTransactionUpdate(function(){o.updateOptions({validation:{activated:!0},grid:{"ds6w:validation":{activated:!0}}})}),t.registerNodeModelUpdateEvent();var n=[[o.options.physicalId]],i={};i[o.options.physicalId]={id:o.options.physicalId,type:"Issue",modifiedAttributes:["Approvals"]},s.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:n,attributes:i},version:"1.0"})},onFailure:function(n){if(e.is(n.error.internal)&&n.error.internal.includes("No 'modify' access on Attribute 'Waiting On' for")){var s=h.getErrorMessage("2005");h.displayErrorMessage(s,"error")}else i.displayNotification({msg:n.error.message,eventID:"error"});t.undoRegisterNodeModelUpdateEvent(),t.withTransactionUpdate(function(){o.updateOptions({grid:{Approvals:!1}})}),t.registerNodeModelUpdateEvent()}}):m.issues.disableApproval({data:r,onComplete:function(e){t.undoRegisterNodeModelUpdateEvent(),t.withTransactionUpdate(function(){o.updateOptions({validation:{activated:!1},grid:{"ds6w:validation":{activated:!1}}})}),t.registerNodeModelUpdateEvent();var n=[[o.options.physicalId]],i={};i[o.options.physicalId]={id:o.options.physicalId,type:"Issue",modifiedAttributes:["Approvals"]},s.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:n,attributes:i},version:"1.0"})},onFailure:function(n){if(e.is(n.error.internal)&&n.error.internal.includes("No 'modify' access on Attribute 'Waiting On' for")){var s=h.getErrorMessage("2005");h.displayErrorMessage(s,"error")}else i.displayNotification({msg:n.error.message,eventID:"error"});t.undoRegisterNodeModelUpdateEvent(),t.withTransactionUpdate(function(){o.updateOptions({grid:{Approvals:!0}})}),t.registerNodeModelUpdateEvent()}})}}})},undoRegisterNodeModelUpdateEvent:function(){this.unsubscribe(this._onNodeModelUpdateSubscriptionToken)},registerCustomFilter:function(){this.getFilterManager().registerFilter("stringRole",this.stringRoleFilter)},initCustomFilter:function(){C.filteredListOfNodes=[],this.stringRoleFilter=a.inherit({publishedProperties:{},isDataFiltered:function(e){var t=e.getAttributeValue(this.propertyId);return!(!this.filterModel||!this.filterModel.allowedRoles)&&!t.includes(this.filterModel.allowedRoles)},isEmpty:function(){return void 0===this.filterModel.allowedRoles}})},getEventOptions:function(){return{shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!0}}},addRoots:function(e,n){var i=this;return 0===e.length?t.resolve([]):new t(function(t){i.withTransactionUpdate(function(){for(var s=i.component.list,o=[],a=0;a<e.length;a++){var r=new l(e[a]);0===r.options.reportedAgainst.length&&0===r.options.resolvedBy.length&&0===r.options.resolvedItems.length&&0===r.options.contexts.length&&(r.options.children=null,r.setState({state:"noChildren"})),o.push(r)}for(var c=0;c<o.length;c++)i.addRoot(o[c],0);var u=d.get("widget").getValue("IssueManagementTableSorting");try{var m=JSON.parse(u);if(!Number.isInteger(m.columnID)||!m.order)throw new Error("The sort preference has an incorrect format");s.getManager().sortColumnContent(m.columnID,{sortOrder:m.order})}catch(e){"datagrid"==i.component.list.summaryview?i.getRoots().sort():i.getRoots().sort(s.sorting.name(!0))}!0===n&&setTimeout(function(){var e=s.getManager();if(1===o.length)i.listView?e.isNodeInVisibleViewport(o[I])||e.scrollToNode(o[I],"top",!1):s.ensureNodeModelVisible(o[I]);else if(o.length>1&&i.listView){if(!0===o.every(function(t){return!e.isNodeInVisibleViewport(t)})){for(var t=e.getScroller().getPosition().y,n=0,a=null,r=0;r<o.length;r++){var l=e.getRowPosition(o[r]._getRowID(!0)),c=Math.abs(t-l);0===r&&(n=c,a=o[r]),c<n&&(n=c,a=o[r])}e.scrollToNode(a,"top",!1)}}},0),i.getModelEvents().publish({event:"onRootsAdded",data:{roots:o,filterChange:i.filterChange}}),t(o)})},function(){i._logger.error('An error occurred during "%s"',"addRoots")})},updatePredicates:function(){var e=this,n=e.component.list.getPredicates(),i=e.getRoots(!1);if(0===n.length||0===i.length)return t.resolve();var s=i.map(function(e){return{physicalId:e.options.physicalId}});return m.fetch({data:{objects:s,predicates:n}}).then(function(s){return new t(function(t){e.withTransactionUpdate(function(){for(var e=0;e<s.body.results.length;e++){for(var o=s.body.results[e].attributes,a={},r=0;r<o.length;r++){var l=o[r];-1!==n.indexOf(l.name)&&(a[l.name]=l.value)}i[e].updateOptions({grid:a})}t()})})})},removeRootsById:function(e){var n=this;return 0===e.length?t.resolve():new t(function(t){n.withTransactionUpdate(function(){var i=[];e.forEach(function(e){var t=n.searchRootById(e);null!==t&&(i.push(t),n.removeRoot(t))}),n.getModelEvents().publish({event:"onRootsRemoved",data:{roots:i}}),t({roots:i})})})},prepareBroadcastSelect:function(){this._publishSelection=!0},buildBroadcastSelect:function(){p.start(this.name+" buildBroadcastSelect");for(var e=[],t={},n=this.getSelectedNodes(),i=0;i<n.length;i++){var s=n[i];s.options.baseType===v&&(e.push([s.options.id]),t[s.options.id]={id:s.options.id,type:s.options.type,name:s.options.name,title:s.options.title})}return p.end(this.name+" buildBroadcastSelect"),{paths:e,attributes:t}},pushBroadcastSelect:S(function(){p.start(this.name+" pushBroadcastSelect");var e=this.buildBroadcastSelect();this.component.getTreeDocument().getRoots(!1).length>0&&r.select(this.getSelectedNodes()),this.component.publishSelect(e),this.component.publishCompass(),this._publishSelection=!1,p.end(this.name+" pushBroadcastSelect")},y),withBroadcastSelect:function(e){var t=this;t.prepareBroadcastSelect(),e.then(function(){t.pushBroadcastSelect()},function(){t._publishSelection=!1})},refresh_v2:function(n){var s=this,o=d.get("widget")||window.widget;p.start(s.name+" refresh");var a=[],r=[],l=[];s.filterChange=n;var u=o.getValue("filter"),f=void 0===o.getValue("affectedItemSetting")||o.getValue("affectedItemSetting"),v=void 0===o.getValue("resolvedItemSetting")||o.getValue("resolvedItemSetting"),b=void 0===o.getValue("contextSetting")||o.getValue("contextSetting");return!0===s.utils.isJson(u)?((u=JSON.parse(u)).onlyids=!1,o.getPreference("organizationFilter").value||(u.reported=!1,u.responsible=!1,o.setValue("filter",JSON.stringify(u))),u.affectedItem=f,u.resolvedItem=v,u.context=b):u={},m.issues.filter({version:"2.0",data:{filter:u,isFilterChange:n}}).then(function(i){if(void 0!==i.success&&!1===i.success){if(i.body&&i.body.error&&i.body.error.internal&&e.is(i.body.error.internal,"string")){var o=i.body.error.internal;if(o.includes("No business object")||o.includes("not exist")){var m=h.getErrorMessage("0");h.displayErrorMessage(m,"error")}}t.resolve([])}var p=s.getRoots(!0).slice(0);return new t(function(e){s.withTransactionUpdate(function(){if(p.length>0){for(var t=0;t<p.length;t++){var o=p[t],m=o.options.physicalId;a.push(m),!0===o.isSelected()&&r.push(m),!0===o.isExpanded()&&l.push(m)}n?s.removeIssueRoots():s.removeRoots(p)}var h=c.parse(i.body);s.addRoots(h).then(function(){d.get("ISU_TYPE_NLS");s.component.addCustomAttrToColumnsList(),s.component.getClassificationIds(u).then(e=>{s.component.addClassificationAttrToColumnsList(e)}),s.component.getCustomAttrValues(u).then(e=>{s.component.updateCustomAttrValuesInDatagrid(e)}),s.component.updateNLSValuesInDatagrid(h),e(h)})})})}).then(function(){l.forEach(function(e){s.getNodesById(e).forEach(function(e){e.expand()})}),s.withTransactionUpdate(function(){r.forEach(function(e){s.getNodesById(e).forEach(function(e){e.select()})}),s.pushBroadcastSelect()}),s.component.list.reapplySortModel(),i.displayNotification({msg:g.notifications.refresh})}).catch(function(e){s._logger.error("Refresh has failed: %o",e),i.displayNotification({msg:g.notifications.serverError,eventID:"error"})}).finally(function(){p.end(s.name+" refresh")})},refresh:function(n){var s=this,o=d.get("widget")||window.widget;p.start(s.name+" refresh");var a=[],r=[],l=[];s.filterChange=n;var u=o.getValue("filter");return!0===s.utils.isJson(u)?((u=JSON.parse(u)).onlyids=!0,o.getPreference("organizationFilter").value||(u.reported=!1,u.responsible=!1,o.setValue("filter",JSON.stringify(u)))):u={},m.issues.filter({version:"1.0",data:{filter:u,isFilterChange:n}}).then(function(i){if(void 0!==i.success&&!1===i.success){if(i.body&&i.body.error&&i.body.error.internal&&e.is(i.body.error.internal,"string")){var o=i.body.error.internal;if(o.includes("No business object")||o.includes("not exist")){var d=h.getErrorMessage("0");h.displayErrorMessage(d,"error")}}t.resolve([])}var u=s.getRoots(!0).slice(0);return new t(function(e){s.withTransactionUpdate(function(){if(u.length>0){for(var t=0;t<u.length;t++){var o=u[t],d=o.options.physicalId;a.push(d),!0===o.isSelected()&&r.push(d),!0===o.isExpanded()&&l.push(d)}n?s.removeIssueRoots():s.removeRoots(u)}var m=c.parse(i.body);s.addRoots(m).then(function(){e(m)})})})}).then(function(t){let n=d.get("ISU_TYPE_NLS"),i=[];e.is(n["ds6w:type"])&&(i=Object.keys(n["ds6w:type"]));let o={},a=i.filter(e=>"Issue"!=e);return a.length>0&&(o.subType=a.toString()),i=i.filter(e=>"Issue"!=e),m.custom.getCustomAttributes(o).then(function(t){if(e.is(t)){var n=s.component.list.getColumns().map(function(e){return e.name});s.component.attributes=n.filter(function(t){return e.is(t)}),t.body.forEach(function(e){if(!s.component.attributes.includes(e.name)){s.component.attributes.push(e.name);var t={column:{name:e.name,text:e.title,dataIndex:e.path,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustom:"Attribute"}};if(s.listView)t.column.onCellRequest=s.component.list.rendering.classificationAttributes,s.component.list.getManager().getColumns().filter(e=>e.dataIndex==t.column.dataIndex).length<=0&&s.component.list.getManager().addColumn(t);else{var n={that:s,attr:e};t.column.getCellValue=s.component.list.rendering.classificationAttributes.bind(n),s.component.list.getManager().getColumns().filter(e=>e.dataIndex==t.column.dataIndex).length<=0&&s.component.list.getManager().addColumnOrGroup(t.column)}}})}}),i.includes("Issue")||i.push("Issue"),m.type.getSubTypesAttributes({types:i}).then(function(t){if(e.is(t)&&t.results&&t.results.length>1){let i=t.results.filter(e=>"Issue"==e.name)[0].properties.map(e=>e.name),o=new Set;t.results.forEach(e=>{e.properties.forEach(e=>{i.includes(e.name)||o.add(e)})});var n=s.component.list.getColumns().map(function(e){return e.name});s.component.attributes=n.filter(function(t){return e.is(t)}),o.forEach(function(e){if(!s.component.attributes.includes(e.name)){s.component.attributes.push(e.name);var t={column:{name:e.name,text:e.nlsName,dataIndex:e.name,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustom:"Attribute"}};if(s.listView)t.column.onCellRequest=s.component.list.rendering.classificationAttributes,s.component.list.getManager().getColumns().filter(e=>e.dataIndex==t.column.dataIndex).length<=0&&s.component.list.getManager().addColumn(t);else{var n={that:s,attr:e};t.column.getCellValue=s.component.list.rendering.classificationAttributes.bind(n),s.component.list.getManager().getColumns().filter(e=>e.dataIndex==t.column.dataIndex).length<=0&&s.component.list.getManager().addColumnOrGroup(t.column)}}})}}),t}).then(function(e){for(var n=[],i=0;i<e.length;i++){var o=e[i].classification;o.length>0&&o.forEach(function(e){if(!s.component.classes.includes(e)){s.component.classes.push(e);var i=new t(function(t){m.classification.getClassificationAttributesOfClass({id:e,onFailure:function(e){console.log(e)}}).then(function(n){var i={classAttributes:n.member[0].ClassAttributes.member,classID:e};t(i)})});n.push(i)}})}return t.all(n)}).then(function(e){e.forEach(function(e){e.classAttributes.forEach(function(e){if(!s.component.attributes.includes(e.name)){s.component.attributes.push(e.name);var t={column:{text:e.name,dataIndex:e.name,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustom:"Classification"}};if(s.listView){t.column.onCellRequest=s.component.list.rendering.classificationAttributes,s.component.list.getManager().getColumns().filter(e=>e.dataIndex==t.column.dataIndex).length<=0&&s.component.list.getManager().addColumn(t)}else{var n={that:s,attr:e};t.column.onCellRequest=s.component.list.rendering.classificationAttributes.bind(n),s.component.list.getManager().getColumns().filter(e=>e.dataIndex==t.column.dataIndex).length<=0&&s.component.list.getManager().addColumnOrGroup(t.column)}}})})}).then(function(){l.forEach(function(e){s.getNodesById(e).forEach(function(e){e.expand()})}),s.withTransactionUpdate(function(){r.forEach(function(e){s.getNodesById(e).forEach(function(e){e.select()})}),s.pushBroadcastSelect()}),s.component.list.reapplySortModel(),i.displayNotification({msg:g.notifications.refresh})}).catch(function(e){s._logger.error("Refresh has failed: %o",e),i.displayNotification({msg:g.notifications.serverError,eventID:"error"})}).finally(function(){p.end(s.name+" refresh")})},addChildren:function(e,t){var n=this,i=t.results,s=[];n.withTransactionUpdate(function(){p.start(n.name+" addChildren"),e.sortChildren=function(){return!1};for(var t=[],o=[],a=[],r=e.options.contexts.reduce(function(e,t){return e[t.physicalId]=t,t.isAdded=!1,e},{}),d=e.options.reportedAgainst.reduce(function(e,t){return e[t.path.toString()]=t,t.isAdded=!1,e},{}),u=e.options.resolvedBy.reduce(function(e,t){return e[t.physicalId]=t,t.isAdded=!1,e},{}),m=e.options.resolvedItems.reduce(function(e,t){return e[t.physicalId]=t,t.isAdded=!1,e},{}),h=1,g=1,f=1,v=1,b=0;b<i.length;b++){if((E=c.parse(i[b],{useIndex:!0,predicates:n.component.list.getPredicates()})).useAsyncPreExpand=!1,E.asyncChildren=[],E.children=null,E.label=E.title,E.display=E.title,E.grid.biColor="rgba(0, 0, 0, 0)",E.icons.length>1&&E.icons.shift(),void 0!==r[E.physicalId]&&!r[E.physicalId].isAdded){r[E.id].isAdded=!0,E.grid["ds6w:name"]=r[E.physicalId].name;var I=new l(E);I.setState({state:"noChildren"}),I.options.icons=E.icons.slice(0),1==h?(I.options.icons.length>1&&I.options.icons.shift(),I.options.icons.unshift({iconName:"3d-object"})):I.options.icons.unshift({iconName:"docs",className:"fade-out-element"}),I.options.data.relationToIssue="contexts",I.options.data.issue=e.options.physicalId,I.options.data.position=h,t.push(I),h+=1}if(void 0!==u[E.physicalId]&&!u[E.physicalId].isAdded){u[E.physicalId].isAdded=!0,E.grid["ds6w:name"]=u[E.physicalId].name;var y=new l(E);y.setState({state:"noChildren"}),y.options.icons=E.icons.slice(0),1==f?(y.options.icons.length>1&&y.options.icons.shift(),y.options.icons.unshift({iconName:"docs"})):y.options.icons.unshift({iconName:"docs",className:"fade-out-element"}),y.options.data.relationToIssue="resolvedBy",y.options.data.issue=e.options.physicalId,y.options.data.position=f,o.push(y),f+=1}if(void 0!==m[E.physicalId]&&!m[E.physicalId].isAdded){m[E.physicalId].isAdded=!0,E.grid["ds6w:name"]=m[E.physicalId].name;var w=new l(E);w.setState({state:"noChildren"}),w.options.icons=E.icons.slice(0),1==v?(w.options.icons.length>1&&w.options.icons.shift(),w.options.icons.unshift({iconName:"markup-review"})):w.options.icons.unshift({iconName:"markup-review",className:"fade-out-element"}),w.options.data.relationToIssue="resolvedItems",w.options.data.issue=e.options.physicalId,w.options.data.position=v,a.push(w),v+=1}}var S={};for(b=0;b<i.length;b++){S[(E=c.parse(i[b],{useIndex:!0,predicates:n.component.list.getPredicates()})).physicalId]=E}var C=[];for(const[t,n]of Object.entries(d))if(void 0!==d[t]&&!d[t].isAdded){C.push(t),d[t].isAdded=!0;var E,_=t.split(",");(E=S[_[_.length-1]]).grid["ds6w:name"]=d[t].name,E.physicalId=t,E.id=t;var T=new l(E);T.setState({state:"noChildren"}),T.options.icons=E.icons.slice(0),1==g?(T.options.icons.length>1&&T.options.icons.shift(),T.options.icons.unshift({iconName:"location"})):T.options.icons.unshift({iconName:"docs",className:"fade-out-element"}),T.options.data.relationToIssue="reportedAgainst",T.options.data.issue=e.options.physicalId,T.options.data.position=g,s.push(T),g+=1}t.forEach(function(t){e.addChild(t)}),s.forEach(function(t){e.addChild(t)}),o.forEach(function(t){e.addChild(t)}),a.forEach(function(t){e.addChild(t)}),p.end(n.name+" addChildren")}),n.fetchOccurencePath(s)},fetchOccurencePath:function(e){var t=this,n=[];if(0!=e.length){for(var s=0;s<e.length;s++)if(e[s].options.id)for(var o=e[s].options.id.split(","),a=0;a<o.length;a++)0!=a&&a%2!=1&&a!=o.length-1||n.push(o[a]);n=[...new Set(n)],m.fetch({data:{objects:n.map(function(e){return{physicalId:e}})},onComplete:function(s){var o=s.body;o.infos&&o.infos.nresults&&n.length!==o.infos.nresults&&i.displayNotification({msg:f.create.templateApplyWarningRelated,eventID:"warning"}),o.infos&&o.infos.nresults&&o.infos.nresults>0&&t.withTransactionUpdate(function(){var t={};"results"in o&&o.results.forEach(function(e){var n=u.parseFetchResponse(e);t[n.value.id]=n});for(var n=0;n<e.length;n++){var i=e[n].options.id.split(","),s="";i.length>0&&t[i[i.length-1]].display.title;for(var a=0;a<i.length;a++)t[i[a]]&&a!=i.length-1&&(s+=t[i[a]].display.title,a!=i.length-2&&(s+="\\"));var r=e[n]._options.grid;r["ds6w:occurrence"]=s,e[n].updateOptions({grid:r})}})},onFailure:function(e){}})}},addContextsOrReportedAgainstOrResolvedByOrResolvedItems:function(e){var t=this;p.start(t.name+" addContextsOrReportedAgainstOrResolvedByOrResolvedItems");for(var n=Object.keys(e),i=[],s=0;s<n.length;s++){var o=e[n[s]];for(s=0;o.reportedAgainst&&s<o.reportedAgainst.length;s++){var a=(r=(r=o.reportedAgainst[s].physicalId).split(","))[r.length-1];o.reportedAgainst[s].physicalId=a+"",o.reportedAgainst[s].path=r}for(s=0;o.resolvedBy&&s<o.resolvedBy.length;s++){a=(r=(r=o.resolvedBy[s].physicalId).split(","))[r.length-1];o.resolvedBy[s].physicalId=a+"",o.resolvedBy[s].path=r}for(s=0;o.resolvedItems&&s<o.resolvedItems.length;s++){a=(r=(r=o.resolvedItems[s].physicalId).split(","))[r.length-1];o.resolvedItems[s].physicalId=a+"",o.resolvedItems[s].path=r}for(s=0;o.contexts&&s<o.contexts.length;s++){var r;a=(r=(r=o.contexts[s].physicalId).split(","))[r.length-1];o.contexts[s].physicalId=a+"",o.contexts[s].path=r}i.push(o)}return m.related.update({data:{objects:i}}).then(function(){p.end(t.name+" addContextsOrReportedAgainstOrResolvedByOrResolvedItems");var i={paths:[],attributes:{}};for(var s in e)i.paths.push([s]),i.attributes[s]={id:s,type:"Issue",modifiedAttributes:["reportedAgainst","resolvedBy","resolvedItems","contexts"]};return d.get("component").publishUpdate(i),t.refreshNodesById({modified:n})})},removeContextsOrReportedAgainstOrResolvedByOrResolvedItems:function(e){var t=this;p.start(t.name+" removeContextsOrReportedAgainstOrResolvedByOrResolvedItems");for(var n=Object.keys(e),s=[],o=0;o<n.length;o++){if(Array.isArray(e[n[o]].reportedAgainst))for(var a=0;a<e[n[o]].reportedAgainst.length;a++){var r=e[n[o]].reportedAgainst[a].physicalId,l=(r=r.split(","))[r.length-1];e[n[o]].reportedAgainst[a].physicalId=l+"",e[n[o]].reportedAgainst[a].path=r}s.push(e[n[o]])}return m.related.delete({data:{objects:s},onFailure:function(e){t._logger.error(e);var n="";if(e&&e.error&&e.error.internal)n=e.error.internal;if(n.includes("No business object")||n.includes("not exist")){var s=h.getErrorMessage("0");h.displayErrorMessage(s,"error")}else if(n.includes("ErrorCode:2005")){s=h.getErrorMessage("2005");h.displayErrorMessage(s,"error")}else if(n.includes("No fromdisconnect access to object")){s=h.getErrorMessage("10");h.displayErrorMessage(s,"error")}else i.displayNotification({msg:e.error.message,eventID:"error"})}}).then(function(){p.end(t.name+" removeContextsOrReportedAgainstOrResolvedByOrResolvedItems");var i={paths:[],attributes:{}};for(var s in e)i.paths.push([s]),i.attributes[s]={id:s,type:"Issue",modifiedAttributes:["reportedAgainst","resolvedBy","resolvedItems","contexts"]};return d.get("component").publishUpdate(i),t.refreshNodesById({modified:n})})},refreshNodesById:function(n){var i=this;p.start(i.name+" refreshNodesById");var s=[],o=[],a=[];return new t(function(t,i){e.is(n.created)&&e.is(n.created,"array")&&n.created.forEach(function(e){-1===s.indexOf(e)&&(s.push(e),a.push(e))}),e.is(n.modified)&&e.is(n.modified,"array")&&n.modified.forEach(function(e){-1===s.indexOf(e)&&(s.push(e),o.push(e))}),s.length>0&&m.issues.retrieve({timestamp:n.timestamp?n.timestamp:null,data:{objects:s.map(function(e){return{physicalId:e}})},onComplete:function(e){var n=c.parse(e.results.map(function(e){return e.body}));t(n)},onFailure:function(e){i(e)}})}).then(function(e){var t=[],n=[],s=[],r={};return e.forEach(function(e){-1!==a.indexOf(e.id)&&t.push(e),-1!==o.indexOf(e.id)&&(n.push(e),s.push([e.id]),r[e.id]={id:e.id,type:e.type,name:e.name,title:e.title})}),i.addRoots(t,!0).then(function(e){var t=[];return i.withTransactionUpdate(function(){n.forEach(function(e){var n=i.searchRootById(e.id);null!==n&&(c.update(n.options,e),i.listView&&null!=i.listView||n.updateGrid(e),n.updateOptions(e),i.refreshChildrenNodeById(e.id),t.push(n))})}),p.end(i.name+" refreshNodesById"),{created:e,modified:t}})})},refreshChildrenNodeById:function(e){var t=this.searchRootById(e);if(p.start(this.name+" refreshChildrenNodeById"),0===t.options.reportedAgainst.length&&0===t.options.resolvedBy.length&&0===t.options.resolvedItems.length&&0===t.options.contexts.length)t.removeChildren(),t.setState({state:"noChildren"});else if(t.isExpanded())t.expand();else{var n=t.getChildren();Array.isArray(n)&&0!==n.length||t.addChild(new l)}p.end(this.name+" refreshChildrenNodeById")},searchRootById:function(e){var t=null;p.start(this.name+" searchRootById");for(var n=this.getRoots(),i=0;i<n.length;i++)if(n[i].options.id===e){t=n[i];break}return p.end(this.name+" searchRootById"),t},autoFill:{_physicalIdsForValidation:{},_physicalIdsForClassification:{},validation:function(e){this._physicalIdsForValidation[e]=e,this._autoFillValidation(Object.keys(this._physicalIdsForValidation))},_autoFillValidation:S(function(t){var n=t.reduce(function(e,t){return e.push({physicalId:t}),e},[]);this._physicalIdsForValidation={},m.routes.retrieve({data:{objects:n}}).then(function(t){for(var n={},i=0;i<t.results.length;i++){var s=t.results[i].body,o={};if(e.is(s.current.status,"string"))o=e.clone(s.current);else if(Array.isArray(s.history)&&s.history.length>0){var a=s.history.sort(function(e,t){var n=0;if(e.date)if(t.date){n=new Date(e.date)-new Date(t.date)}else n=1;else n=-1;return-1*n});o=e.clone(a[I])}else o={status:"notStarted",approveTo:"",decisions:[]};n[s.physicalId]={activated:!0,fetched:!0,status:o.status,approveTo:o.approveTo,decisions:o.decisions}}for(var r=C.getRoots(!1),l=0;l<r.length;l++){var c=r[l];n[c.options.physicalId]&&c.updateOptions({validation:n[c.options.physicalId]})}})},w),classificationAttributes:function(e,t){if(this._physicalIdsForClassification[e]){var n=this._physicalIdsForClassification[e];if(!n.attributes.some(e=>e.name===t)){var i={name:t};n.attributes.push(i)}}else{this._physicalIdsForClassification[e]={},this._physicalIdsForClassification[e].physicalId=[e];i={name:t};this._physicalIdsForClassification[e].attributes=[i]}this._autoFillClassification(this._physicalIdsForClassification)},_autoFillClassification:S(function(e){m.classification.retrieve({data:{objects:e}}).then(function(t){for(var n={},i=0;i<t.results.length;i++){var s=t.results[i].body,o=s.physicalId;n[o]=[];for(var a=e[o].attributes,r=0;r<a.length;r++){var l=a[r].name,c=s[l].substring(1,s[l].length-1),d={};d.attrName=l,d.attrValue=c,n[o].push(d)}}var u=C.getAllDescendants();for(r=0;r<u.length;r++){var m=u[r];if(n[m.options.physicalId]){a=n[m.options.physicalId];for(var p=0;p<a.length;p++){var h=a[p].attrName,g=a[p].attrValue,f={grid:{}};f.grid[h]=g,m.updateOptions(f)}}}})},w)},getComponent:function(){return this.component},getRoots:function(t){var n=this._parent();if(!0===t&&e.is(this._getChildrenFilterInfo,"function")){var i=this._getChildrenFilterInfo();if(i&&e.is(i.childrenBeforeFiltering,"array")){var s=n;n=i.childrenBeforeFiltering.slice(0),s.forEach(function(e){n.indexOf(e)<0&&n.push(e)})}}return n},removeIssueRoots:function(){if(this.removeRoots(),e.is(this._getChildrenFilterInfo,"function")){var t=this._getChildrenFilterInfo();t&&e.is(t.childrenBeforeFiltering,"array")&&(delete t.childrenBeforeFiltering,delete t.filteredOutChildren)}},getNodesById:function(e){var t=[];p.start(this.name+" getNodesById");for(var n=this.getRoots(!1),i=0;i<n.length;i++)t=t.concat(n[i].getNodesById(e));return p.end(this.name+" getNodesById"),t},getNodesByPath:function(e){function t(e,n,i,s){if(e.options.id===n[i])if(i===n.length-1)s.push(e);else{var o=e.getChildren();o&&o.length>0&&(i+=1,o.forEach(function(e){t(e,n,i,s)}))}}p.start(this.name+" getNodesByPath");for(var n=[],i=this.getRoots(!1),s=0;s<i.length;s++)t(i[s],e,0,n);return p.end(this.name+" getNodesByPath"),n},getReportedAgainstFromSelectedNodes:function(){for(var e=this.getSelectedNodes(),t=[],n=0;n<e.length;n++){var i=e[n];i.options.baseType===v?i.options.reportedAgainst.forEach(function(e){t.push(e.physicalId)}):t.push(i.options.id)}return t},getIssuesFromSelectedNodes:function(){for(var e=this.getSelectedNodes(),t=[],n=0;n<e.length;n++){var i=e[n];i.options.baseType===v&&t.push(i)}return t},isBIFiltered:function(){var t=!1;if(e.is(this._getChildrenFilterInfo,"function")){var n=this._getChildrenFilterInfo();n&&e.is(n.childrenBeforeFiltering,"array")&&(t=n.childrenBeforeFiltering.length>0)}return t},_onPreExpand:function(e){var t=this;p.start(t.name+" _onPreExpand");var n=e.data.nodeModel,s=function(s,o){!0===o?(t._logger.warn("Expand request has failed: %o",s),i.displayNotification({msg:g.notifications.serverWarning,eventID:"warning"})):(t._logger.error("Expand request has failed: %o",s),i.displayNotification({msg:g.notifications.serverError,eventID:"error"})),n.options.children=[],e.target.preExpandDone({state:"collapsed"})};n.removeChildren();var o=[];n.options.reportedAgainst.forEach(function(e){o.push(e.physicalId)}),n.options.resolvedBy.forEach(function(e){o.push(e.physicalId)}),n.options.resolvedItems.forEach(function(e){o.push(e.physicalId)}),n.options.contexts.forEach(function(e){o.push(e.physicalId)}),o=o.sort().filter(function(e,t,n){return!t||e!==n[t-1]}),m.fetch({data:{objects:o.map(function(e){return{physicalId:e}}),predicates:t.component.list.getPredicates()}}).then(function(i){if(n.removeChildren(),Array.isArray(i.body.results)){let e={};i.body.results.forEach(t=>{let n={};var i="";t.attributes.forEach(e=>{switch(e.name){case"resourceid":i=e.value;break;case"ds6w:label":n.title=e.value;break;case"ds6w:type":n.type=e.value;break;case"ds6w:identifier":n.name=e.value;break;case"ds6wg:revision":n.revision=e.value}}),e[i]=n});var o={};let t=n.options.contexts;o.contexts=[],t.forEach(t=>{if(e[t.physicalId]){let n={};n={...e[t.physicalId],...t},o.contexts.push(n)}});let s=n.options.reportedAgainst;o.reportedAgainst=[],s.forEach(t=>{if(e[t.physicalId]){let n={};n={...e[t.physicalId],...t},o.reportedAgainst.push(n)}});let a=n.options.resolvedBy;o.resolvedBy=[],a.forEach(t=>{if(e[t.physicalId]){let n={};n={...e[t.physicalId],...t},o.resolvedBy.push(n)}});let r=n.options.resolvedItems;o.resolvedItems=[],r.forEach(t=>{if(e[t.physicalId]){let n={};n={...e[t.physicalId],...t},o.resolvedItems.push(n)}}),n.options.contexts=o.contexts,n.options.reportedAgainst=o.reportedAgainst,n.options.resolvedBy=o.resolvedBy,n.options.resolvedItems=o.resolvedItems}var a=i.body;if(a.hasOwnProperty("results"))try{t.addChildren(n,{results:a.results}),e.target.preExpandDone({state:"expanded"})}catch(e){s(e.toString(),!1)}else n.options.children=null,n.setState({state:"noChildren"}),e.target.preExpandDone({state:"collapsed"}),n.options.contexts=[],n.options.reportedAgainst=[],n.options.resolvedBy=[],n.options.resolvedItems=[]},function(e){s(e,!1)}).finally(function(){p.end(t.name+" _onPreExpand")})},_onPostExpand:function(t){p.start(this.name+" _onPostExpand");var n=t.data.nodeModel,i=d.get("widget")||window.widget,s=e.clone(i.getValue("expandedIds"));!1===Array.isArray(s)&&(s=[]),s.includes(n.options.physicalId)||s.push(n.options.physicalId),i.setValue("expandedIds",s),i.dispatchEvent("endEdit"),p.end(this.name+" _onPreExpand")},_onPostCollapse:function(t){p.start(this.name+" _onPostCollapse");var n=t.data.nodeModel,i=d.get("widget")||window.widget,s=e.clone(i.getValue("expandedIds"));!1===Array.isArray(s)&&(s=[]);var o=s.indexOf(n.options.physicalId);-1!==o&&(s.splice(o,1),i.setValue("expandedIds",s),i.dispatchEvent("endEdit")),p.end(this.name+" _onPreCollapse")},_subscribers:function(){var e=this;e.getXSO().onEmpty(function(){e.prepareBroadcastSelect(),setTimeout(function(){0===e.getSelectedNodes().length&&e.pushBroadcastSelect()},b)}),e.onPreExpand(function(t){e._onPreExpand(t)}),e.onPostExpand(function(t){e._onPostExpand(t)}),e.onPostCollapse(function(t){e._onPostCollapse(t)})},utils:{isJson:function(e){try{JSON.parse(e)}catch(e){return!1}return!0}}})}),define("DS/IssueManagement/views/kanban/Column",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/IssueManagement/views/kanban/TileList","DS/Core/PointerEvents","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/Tree/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/IssueComponents/users/Users","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,b,I,y,w){"use strict";var S={STATE:"state",PRIORITY:"priority",DUE_DATE:"resolutionDate"},C="Closed",E={Create:0,Assign:1,Active:2,Review:3,Closed:4},_="Low",T="Medium",D="High",M="Urgent",A="Overdue",x="None",N="Today",O="Tomorrow",P="Week",k="Future",L=0,R=500,U=1,V=18,F=function(e){return n.createElement("div",{class:"column-header",html:[n.createElement("div",{class:"column-header-label",html:e.title}),n.createElement("div",{class:"column-header-count",html:"("+e.count+")"})]})},j=function(){return n.createElement("div",{class:"column-content",html:""})},B=function(){return n.createElement("div",{class:"column-overlay",html:[{tag:"div",class:"column-overlay-label",html:y.kanban.dnd.placeholder},{tag:"span",class:"column-overlay-icon fonticon fonticon-drag-drop"}]})};return t.extend({name:"DS/IssueManagement/views/kanban/Column",tagName:"div",className:"kanban-container-column",_logger:null,defaultOptions:{title:{},defaultImage:d.getWebappsAssetUrl("IssueManagement","icons/camera.png")},kanban:null,document:null,models:[],grid:null,attributeKeyValue:{key:null,value:null},_dnd:{dragged:!1},_cellsAwaitingPostRendering:[],setup:function(e){b.start(this.name+" setup"),this._parent(e),this._logger=r.getLogger("DS/IssueManagement/View"),this.kanban=e.kanban,this.document=new c,this.document._id=this.id,this.document._currentKanbanView=e.attributeKeyValue.key,this.models=[];for(var t=0;t<e.models.length;t++){var n=Object.keys(e.models[t]).reduce(function(n,i){return"children"!==i&&(n[i]=e.models[t][i]),n},{});n.contextualMenu=[{}],this.models.push(n)}var i=this.getEventOptions();i.allowUnsafeHTMLContent=!1,i.selectionBehavior={},i.selectionBehavior.toggle=!0,i.selectionBehavior.unselectAllOnEmptyArea=!0,i.selectionBehavior.selectNodeModelOnCellSelection=!0,i.selectionBehavior.canMultiSelect=!0,i.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=!0,i.selectionBehavior.enableShiftSelection=!0,i.selectionBehavior.enableFeedbackForActiveCell=!0,this.grid=new o(i),this.setEventOptions(this.grid),this.attributeKeyValue={key:e.attributeKeyValue.key,value:e.attributeKeyValue.value},this._dnd={dragged:!1},this._cellsAwaitingPostRendering=[],this._subscribers(),b.end(this.name+" setup")},render:function(){var e=this;b.start(e.name+" render");var t=F({title:e.getOption("title"),count:e.models.length}),i=j();if(t.inject(e.container),i.inject(e.container),t.addEventListener("drop",function(t){e._onDrop(t)},!1),t.addEventListener("dragover",function(e){e.preventDefault()},!1),e.attributeKeyValue.key===S.STATE&&e.attributeKeyValue.value===C){var o=g.get("widget");if(!0!==JSON.parse(o.getValue("filter")).closed){e.container.addClassName("not-filtered");var a=n.createElement("div",{class:"not-filtered-warning",html:{tag:"span",class:"fonticon fonticon-attention"}});new s({target:a,body:y.kanban.warning.closed}),a.inject(t)}}return e.grid.inject(i),B().inject(e.container),e.load(),b.end(e.name+" render"),e},load:function(){var e=this;b.start(e.name+" load");for(var t=0;t<e.models.length;t++)e._populate(e.models[t]);e.document.withTransactionUpdate(function(){for(var t=0;t<e.models.length;t++){var n=e.document.addRoot(e.models[t]);e.kanban._issuesNodesMapping[e.models[t].id].push(n),e.models[t].isSelected&&n.select()}e.document.getRoots().sort(function(e,t){return e.name<t.name?1:e.name>t.name?-1:0})}),e.grid.model=e.document,b.end(e.name+" load")},destroy:function(){this._logger=null,this.document=null,this.models=[],this.grid.destroy(),this.grid=null,this.attributeKeyValue={key:null,value:null},this._dnd={dragged:!1},this._cellsAwaitingPostRendering=[]},getTreeDocument:function(){return this.document},getSelectedNodes:function(){return this.document.getSelectedNodes()},unselectAll:function(){this.document.unselectAll()},getEventOptions:function(){var e=this;return{useDragAndDrop:!0,onDragStartCell:function(t,n){t.stopPropagation();var i=e.kanban.getSelectedNodes();0===i.length&&(i=[]).push(n.nodeModel);var s={isKanbanView:!0,columnKeyValue:{key:e.attributeKeyValue.key,value:e.attributeKeyValue.value},models:i.map(function(e){return e.options})},o=p.setDroppableData(i,s);t.dataTransfer.setData(o.type,o.data),t.dataTransfer.effectAllowed="move",e._dnd.dragged=!0;var a=e.container.getElements(".wux-ui-state-highlighted");if(null!==a)for(var r=0;r<a.length;r++)a[r].getParent().addClassName("kanban-dragged-tile");return!1},onDropCell:function(t,n){e.utils.clean(e.kanban.container,{dragged:!0,hovered:!0,placeholder:!0}),p.events.onDropCell.call(e.kanban,t,n)},onDropBlank:e._onDrop.bind(e),onDragEnterBlank:function(t){t.preventDefault(),e.utils.clean(e.kanban.container,{hovered:!0,placeholder:!0}),!0===e._dnd.dragged||e.container.addClassName("drop-authorized")},onDragLeaveBlank:function(t){t.preventDefault(),e.container.removeClassName("drop-authorized")},onDragOverCell:function(t,n){return t.preventDefault(),e.utils.clean(e.kanban.container,{hovered:!0,placeholder:!0}),n.cellView.elements.container.addClassName("kanban-hovered-tile"),!0}}},setEventOptions:function(t){var i=this;t.onCellDoubleClick(function(){m.getCommand("ToggleInformationPanel")&&m.getCommand("ToggleInformationPanel").begin({save:!0})}),t.onContextualEvent={callback:function(t){return!(!t||!t.cellInfos)&&new e(function(e){var n=t.cellInfos;!1===n.nodeModel.isSelected()?(i.listenTo(i.kanban,"onSelectAcked",function(){i.stopListening(i.kanban,"onSelectAcked"),h.getContextualMenu(n.nodeModel).then(function(t){e(t)})}),n.nodeModel.select(!0),i.kanban.document.prepareBroadcastSelect(),i.kanban.document.pushBroadcastSelect()):h.getContextualMenu(n.nodeModel).then(function(t){e(t)})})}},t.onDragEndCell=function(){i.utils.clean(i.kanban.container,{dragged:!0,placeholder:!0}),i._dnd.dragged=!1},t.onStatusbarIconPointerDown=function(e){var t=e.cellInfos,n=e.clickedIconIndex,s=t?t.cellView:void 0,o=s?s.contentView:void 0,a=t?t.cellModel:void 0;if(o&&a&&n>=0&&n<o.statusbarIcons.length){for(var r=[],l=[],c=0;c<o.statusbarIcons.length;c++)r.push(o.statusbarIcons[c]),l.push(o.statusbarIconsTooltips[c]);switch(i.document.unselectAll(),a.select(),r[n]){case"attach":m.getCommand("AttachmentManager").begin()}}};var s=i.kanban.utils.debounce(function(){var t=this;new e(function(e,i){if(t._cellsAwaitingPostRendering.length>0){var s=t._cellsAwaitingPostRendering.map(function(e){return{physicalId:e.nodeModel.options.physicalId}}).filter(function(e,t,n){return n.indexOf(e)===t});f.images.retrieve({data:{objects:s},onComplete:function(i){for(var s=0;s<i.results.length;s++){var o=i.results[s].body;n.is(o,"object")&&n.is(o.url,"string")&&""!==o.url&&t._cellsAwaitingPostRendering[s].nodeModel.updateOptions({thumbnail:o.url})}e()},onFailure:function(e){t._logger.error("Cannot retrieve the images: %s",e),i(new Error(e))}})}else e()}).finally(function(){t._cellsAwaitingPostRendering=[]})}.bind(i),R);t.onPostCellRequest(function(e){var t=e.cellView.elements.container;if(t&&"hidden"!==t.getStyle("visibility")){var o=e.nodeModel;e.cellView.contentView.setProperties({description:o.options.description||"",subtitle:n.createElement("div",{class:"sub-label-container",html:[i.utils.getHTMLPriority(o.options.priority),o.options.name,{tag:"span",class:"fonticon fonticon-user"},i.utils.getHTMLOwner(o.options.owner),{tag:"span",class:"fonticon fonticon-users"},i.utils.getHTMLAssignees(o.options.assignees)]})}),i._cellsAwaitingPostRendering.push(e),s()}})},_populate:function(e){e.thumbnail=this.getOption("defaultImage"),e.statusbarIcons=["attach"],e.statusbarIconsTooltips=[y.commands.attachments]},_subscribers:function(){var e=this,t=e.kanban.utils.debounce(function(t){e.dispatchEvent("onSelect",{column:e,node:t,event:"select"})}.bind(e),U);e.document.getModelEvents().subscribe({event:"select"},t);var n=e.kanban.utils.debounce(function(t){e.dispatchEvent("onSelect",{column:e,node:t,event:"unselect"})}.bind(e),U);e.document.getModelEvents().subscribe({event:"unselect"},n),e.grid.addEventListener(a.POINTERDOWN,function(t,n){var i=e.grid;if(!(!0!==i.selectionBehavior.unselectAllOnEmptyArea||n&&n.cellView)){var s=i.getViewportDimensions(),o=i.layout.getContentDimensions(),a=0;t.target===i.elements.scroller.getContent()&&("vertical"===i.layout.direction?a=s.height<o.height?V:0:"horizontal"===i.layout.direction&&(a=s.width<o.width?V:0));var r=Math.max(o.width,s.width-a),l=Math.max(o.height,s.height-a);t.offsetX<r&&t.offsetY<l&&e.dispatchEvent("onUnselectAll",{column:e})}},!1)},_onDrop:function(t){var n=this;t.preventDefault(),t.stopPropagation();var s=null;n.utils.clean(n.kanban.container,{dragged:!0,hovered:!0,placeholder:!0});try{s=p.getDroppableData(t)}catch(e){return l.displayNotification({msg:y.dnd.notSupported,eventID:"info"}),!1}if(s&&s.data)if(s.widgetId===g.get("widget").id&&s.data.options&&s.data.options.isKanbanView){var o=s.data.items,a=s.data.options.models;if(n.attributeKeyValue.key===s.data.options.columnKeyValue.key&&n.attributeKeyValue.value===s.data.options.columnKeyValue.value)return!0;i.mask(n.kanban.container),("state"===n.attributeKeyValue.key?n._onDropUpdateState(a,s.data.options.columnKeyValue.value):n._onDropUpdateIssues(a)).then(function(t){if(!1!==t){for(var i={paths:[],attributes:{}},s=0;s<o.length;s++)i.paths.push([o[s].objectId]),i.attributes[o[s].objectId]={id:o[s].objectId,name:o[s].displayName,title:o[s].displayName,type:o[s].objectType,modifiedAttributes:["state"]};return g.get("component").publishUpdate(i),n.kanban.document.refreshNodesById({modified:o.map(function(e){return e.objectId}),timestamp:Math.floor(Date.now())})}return e.resolve()}).catch(function(e){n._logger.error(e)}).finally(function(){i.unmask(n.kanban.container)})}else l.displayNotification({msg:y.dnd.notSupported,eventID:"info"});return!0},_onDropUpdateState:function(t,i){var s=this;if(!t.every(function(e){return e.state===t[L].state}))return l.displayNotification({msg:y.kanban.dnd.notAllSameStatePromote,eventID:"error"}),e.reject(new Error("Not supported dnd, all issues must be in the same state"));var o=function(e){var t="";if(e&&e.error&&n.is(e.error.message,"string")&&(t=e.error.message),t.includes("Action Taken and Resolution Statement are not filled in")){var i=I.getErrorMessage("5");I.displayErrorMessage(i,"error")}else if(t.includes("Action Taken field is not filled in")){i=I.getErrorMessage("6");I.displayErrorMessage(i,"error")}else if(t.includes("Resolution Statement field is not filled in")){i=I.getErrorMessage("7");I.displayErrorMessage(i,"error")}else if(t.includes("Resolution Date is not filled in")){i=I.getErrorMessage("8");I.displayErrorMessage(i,"error")}else if(t.includes("User does not have necessary privileges or selected object is not in correct maturity state for this operation")){i=I.getErrorMessage("1005");I.displayErrorMessage(i,"error")}else{i=y.notifications.serverError;e&&e.error&&n.is(e.error.message,"string")&&(i=e.error.message),l.displayNotification({msg:i,eventID:"error"})}s._logger.error(e)},a=-1;switch(a=s.attributeKeyValue.value===C?0:E[s.attributeKeyValue.value]-E[i]){case 0:var r=t.map(function(e){return{physicalId:e.physicalId,resolutionStatement:e.resolutionStatement}});return f.issues.close({data:{objects:r}}).catch(function(e){o(e)});case 1:var c=t.map(function(e){return{physicalId:e.physicalId,state:s.attributeKeyValue.value}});return f.issues.promote({data:{objects:c}}).catch(function(e){o(e)});case-1:var d=t.map(function(e){return{physicalId:e.physicalId,state:s.attributeKeyValue.value}});return f.issues.demote({data:{objects:d}}).catch(function(e){o(e)});default:return l.displayNotification({msg:y.replace(a>0?y.kanban.dnd.unsupportedPromote:y.kanban.dnd.unsupportedDemote,{currState:w.maturity[i.toLowerCase()],state:w.maturity[s.attributeKeyValue.value.toLowerCase()]}),eventID:"error"}),e.reject(new Error("Unexpected dropped data, cannot update state of issue(s)"))}},_onDropUpdateIssues:function(t){var i=this,s=t.filter(function(e){return e.state!==C});if(s.length!==t.length&&l.displayNotification({msg:y.kanban.dnd.cannotEditClosedIssues,eventID:"warning"}),s.length>0){var o="";if(i.attributeKeyValue.key===S.DUE_DATE)if(i.attributeKeyValue.value===x)o="";else{var a=new Date;a.setHours(0,0,0,0);var r=new Date(a);r.setDate(r.getDate()-r.getDay()+8);var c=new Date(a);switch(i.attributeKeyValue.value){case A:c.setDate(a.getDate()-1);break;case N:break;case O:c.setDate(a.getDate()+1);break;case P:c.setDate(a.getDate()+2),c-r>=0&&(c.setDate(a.getDate()+1),c-r>=0&&c.setDate(a.getDate()-a.getDay()));break;case k:c.setDate(a.getDate()+30)}o=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear()}else o=i.attributeKeyValue.value;var d=s.map(function(e){var t={physicalId:e.physicalId};return t[i.attributeKeyValue.key]=o,t});return f.issues.update({data:{objects:d}}).catch(function(e){e&&n.is(e.error,"object")&&n.is(e.error.message,"string")?l.displayNotification({msg:e.error.message,eventID:"error"}):l.displayNotification({msg:y.notifications.serverError,eventID:"error"}),i._logger(e)})}return e.resolve(!1)},utils:{whereToAddModal:null,getHTMLPriority:function(e){var t="";switch(e){case _:t="low wux-ui-3ds wux-ui-3ds-level-low";break;case T:t="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case D:t="high wux-ui-3ds wux-ui-3ds-level-high";break;case M:t="urgent wux-ui-3ds wux-ui-3ds-alert "}return n.createElement("div",{class:"issue-list-priority",html:[n.createElement("span",{class:"issue-list-priority-icon "+t,title:w.priorities[e.toLowerCase()]})]})},getHTMLOwner:function(e){return u.create({users:[e]})},getHTMLAssignees:function(e){var t=e;return u.create({users:t})},clean:function(e,t){if(!0===t.dragged)for(var n=e.getElements(".kanban-dragged-tile"),i=0;i<n.length;i++)n[i].getParent().removeClassName("kanban-dragged-tile");if(!0===t.hovered)for(var s=e.getElements(".kanban-hovered-tile"),o=0;o<s.length;o++)s[o].removeClassName("kanban-hovered-tile");if(!0===t.placeholder){var a=e.getElement(".drop-authorized");null!==a&&a.removeClassName("drop-authorized")}}}})}),define("DS/IssueManagement/views/kanban/Kanban",["UWA/Class/View","UWA/Core","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/IssueManagement/views/kanban/Column","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(e,t,n,i,s,o,a,r,l){"use strict";var c=260,d={STATE:"state",PRIORITY:"priority",DUE_DATE:"resolutionDate",ALL:"all"},u="Create",m="Assign",p="Active",h="Review",g="Closed",f="Low",v="Medium",b="High",I="Urgent",y="Overdue",w="None",S="Today",C="Tomorrow",E="Week",_="Future",T="All",D={RIGHT:"right",BOTTOM:"bottom",CLOSED:"closed"},M=1,A=0;return e.extend({name:"DS/IssueManagement/views/kanban/Kanban",tagName:"div",className:"kanban-container",_logger:null,component:null,document:null,settings:{},columns:{state:[],priority:[],resolutionDate:[],all:[]},chizu:{container:null,tooltips:[],position:0},currentView:null,columnsListeners:[],siblings:{right:null,left:null},verticalLevelSelector:-1,_issuesNodesMapping:{},preventUnselectColumns:!1,_ctrlKey:!1,_subscribed:!1,setup:function(e){a.start(this.name+" setup"),this._parent(e),this._logger=i.getLogger("DS/IssueManagement/View"),this.component=e.component,this.document=null,this.settings=e.settings,this.columns={state:[],priority:[],resolutionDate:[],all:[]},this.chizu={container:null,tooltips:[],position:0},this.currentView=null,this.columnsListeners=[],this.siblings={right:null,left:null},this.verticalLevelSelector=-1,this._issuesNodesMapping={},this.preventUnselectColumns=!1,this._ctrlKey=!1,this._subscribed=!1,a.end(this.name+" setup")},render:function(){var e=this;a.start(e.name+" render"),e.columns.state.forEach(function(t){t.render().inject(e.container)}),e.columns.priority.forEach(function(t){t.render().inject(e.container)}),e.columns.resolutionDate.forEach(function(t){t.render().inject(e.container)}),e.columns.all.forEach(function(t){t.render().inject(e.container)});var i=o.get("widget").getValue("kanbanViewBy")||"state";return e.switchView(i),e.arrow=t.createElement("div",{class:"arrow-fonticon"}).inject(e.container),e.arrow.left=t.createElement("span",{class:"fonticon fonticon-2x fonticon-left-open"}).inject(e.arrow),e.arrow.leftTooltip=new n({position:"bottom",target:e.arrow.left,body:r.kanban.tooltips.leftArrow}),e.arrow.right=t.createElement("span",{class:"fonticon fonticon-2x fonticon-right-open"}).inject(e.arrow),e.arrow.rightTooltip=new n({position:"bottom",target:e.arrow.right,body:r.kanban.tooltips.rightArrow}),a.end(e.name+" render"),e},load:function(e){a.start(this.name+" load"),null!=e&&(this.document=e);var t=this.document.getRoots(!1),n={};n[u]=[],n[m]=[],n[p]=[],n[h]=[],n[g]=[];var i={};i[f]=[],i[v]=[],i[b]=[],i[I]=[];var c={};c[y]=[],c[w]=[],c[S]=[],c[C]=[],c[E]=[],c[_]=[];var D={};D[T]=[];var M=new Date;M.setHours(0,0,0,0);var A=new Date(M);A.setDate(A.getDate()-A.getDay()+8),this._issuesNodesMapping={};for(var x=0;x<t.length;x++){var N=t[x].options;if(this._issuesNodesMapping[t[x].options.id]=[],N.isSelected=t[x].isSelected(),n[N.state]&&i[N.priority]&&D[T])if(n[N.state].push(N),i[N.priority].push(N),D[T].push(N),void 0!==N.resolutionDate&&null!==N.resolutionDate&&""!==N.resolutionDate){var O=new Date(N.resolutionDate),P=O-M;if(isNaN(P))c[w].push(N);else{var k=P/1e3/60/60/24;if(k<0)c[y].push(N);else if(0<=k&&k<1)c[S].push(N);else if(1<=k&&k<2)c[C].push(N);else if(2<=k){O-A<0?c[E].push(N):c[_].push(N)}}}else c[w].push(N)}var L=o.get("maturityGraph");for(var R in n)if(n.hasOwnProperty(R)){var U=l.maturity[R.toLowerCase()];""!==L&&null!=L&&(U=L[R]);var V=new s({id:d.STATE+R.replace(/ /g,"+").toLowerCase(),kanban:this,title:U,models:n[R],attributeKeyValue:{key:d.STATE,value:R}});this.columns.state.push(V)}for(var F in i)if(i.hasOwnProperty(F)){var j=new s({id:d.PRIORITY+F.replace(/ /g,"+").toLowerCase(),kanban:this,title:l.priorities[F.toLowerCase()],models:i[F],attributeKeyValue:{key:d.PRIORITY,value:F}});this.columns.priority.push(j)}for(var B in c)if(c.hasOwnProperty(B)){var W=new s({id:d.DUE_DATE+B.replace(/ /g,"+").toLowerCase(),kanban:this,title:r.kanban.resolutionDate[B.toLowerCase()],models:c[B],attributeKeyValue:{key:d.DUE_DATE,value:B}});this.columns.resolutionDate.push(W)}for(var H in D)if(D.hasOwnProperty(H)){var z=new s({id:d.ALL,kanban:this,title:r.kanban.all,models:D[H],attributeKeyValue:{key:d.ALL,value:H}});this.columns.all.push(z)}return this._subscribers(),a.end(this.name+" load"),this},refresh:function(){for(var e in a.start(this.name+" refresh"),this.preventUnselectColumns=!0,this.container.empty(),this.columns)this.columns.hasOwnProperty(e)&&(this.columns[e].forEach(function(e){e.destroy()}),this.columns[e]=[]);this.chizu.tooltips.forEach(function(e){e.destroy(),e=null}),this.chizu.container.destroy(),this.chizu={container:null,tooltips:[],position:0},this.load(),this.render(),a.end(this.name+" refresh")},destroy:function(){this._stopListeningToColumns(),this._logger=null,this.component=null,this.document=null,this.settings={},this.columns={state:[],priority:[],resolutionDate:[],all:[]},this.chizu.tooltips.forEach(function(e){e.destroy(),e=null}),this.chizu.container.destroy(),this.chizu={container:null,tooltips:[],position:0},this.currentView=null,this.columnsListeners=[],this.siblings={right:null,left:null},this.verticalLevelSelector=-1,this._issuesNodesMapping={},this.preventUnselectColumns=!1,this._ctrlKey=!1,this._subscribed=!1},resize:function(){if(this.container&&this.container.getParent()){var e=o.get("application"),t=e.elements.body,n=e.information.container,i=t.offsetWidth,s=t.offsetHeight,a=o.get("information");a.isOpened()&&a.getLayout().current===D.RIGHT&&(i-=n.offsetWidth),a.isOpened()&&a.getLayout().current===D.BOTTOM&&(s-=n.offsetHeight);var r=i,l=this.container.getElements(".kanban-container-column.visible");if(0!==l.length){var d=l[A].offsetWidth,u=r/(d=(d=d>c?c:d)<c?c:d);u=Math.floor(u);var m=this.chizu.position,p=m;u<l.length&&(u===l.length-m||u>l.length-m&&(p=m-(u-(l.length-m))));var h=p,g=p+u;l.forEach(function(e,t){e.setStyle("max-height",s),h<=t&&t<g?(e.show(),e.setStyle("width",d)):e.hide()}),this._setChizu(l,u,p)}}},switchView:function(e){for(var t in this.columns)this.columns.hasOwnProperty(t)&&(t!==e?this.columns[t].forEach(function(e){e.hide(),e.container.removeClassName("visible")}):(this.currentView=t,this._stopListeningToColumns(),this._listenToColumns(),this.columns[t].forEach(function(e,t){e.show(),0===t&&e.container.addClassName("visible first"),e.container.addClassName("visible")})));this.resize()},getSelectedNodes:function(){for(var e=[],t=0;t<this.columns[this.currentView].length;t++)e=e.concat(this.columns[this.currentView][t].getSelectedNodes());return e},getSelectedIssues:function(){for(var e=[],t=0;t<this.columns[this.currentView].length;t++){var n=this.columns[this.currentView][t].getSelectedNodes().map(function(e){return e.options.id});e=e.concat(n)}return e},_setChizu:function(e,i,s){var o=this;o.chizu.position=s;var a=[],l=[],c=0;e.forEach(function(e,d){var u="";d<s||c<i&&(u="displayed",c+=1);var m=t.createElement("div",{class:"chizu-placeholder-column "+u,events:{click:function(){var e=o.container.getElements(".kanban-container-column.visible"),t=0,n=e.length-d;n<i&&(d-=i-n);for(var s=0;s<e.length;s++)s<d?e[s].hide():t<i?(e[s].show(),e[s].setStyle("width",100/i+"%"),t+=1):e[s].hide();o._setChizu(e,i,d)}}});l.push(new n({position:"top",target:m,body:r.replace(r.kanban.tooltips.chizu,{title:o.columns[o.currentView][d].getOption("title")+" ("+o.columns[o.currentView][d].getTreeDocument().getRoots(!1).length+")"})})),a.push(m)}),null===o.chizu.container?(o.chizu.container=t.createElement("div",{class:"chizu",html:[{tag:"div",class:"chizu-placeholder-columns",html:a}]}),o.chizu.tooltips=l,o.chizu.container.inject(o.container)):(o.chizu.tooltips.forEach(function(e){e.destroy(),e=null}),o.chizu.tooltips=l,o.chizu.container.getElement(".chizu-placeholder-columns").setContent(a)),1===e.length?o.chizu.container&&!o.chizu.container.hasClassName("chizu-hidden")&&o.chizu.container.addClassName("chizu-hidden"):o.chizu.container&&o.chizu.container.hasClassName("chizu-hidden")&&o.chizu.container.removeClassName("chizu-hidden"),0===s?o.arrow.left&&!o.arrow.left.hasClassName("disable")&&o.arrow.left.addClassName("disable"):o.arrow.left&&o.arrow.left.hasClassName("disable")&&o.arrow.left.removeClassName("disable"),e.length<=c+s?o.arrow.right&&!o.arrow.right.hasClassName("disable")&&o.arrow.right.addClassName("disable"):o.arrow.right&&o.arrow.right.hasClassName("disable")&&o.arrow.right.removeClassName("disable"),o.clickLeftArrowEventListener&&o.arrow.left.removeEventListener("click",o.clickLeftArrowEventListener),o.clickLeftArrowEventListener=function(){e.forEach(function(e,t){t>=s-1&&t<=s+c-2?(e.show(),e.setStyle("width",100/c+"%")):e.hide()}),o._setChizu(e,i,s-1)},o.arrow.left.addEventListener("click",o.clickLeftArrowEventListener),o.clickRightArrowEventListener&&o.arrow.right.removeEventListener("click",o.clickRightArrowEventListener),o.clickRightArrowEventListener=function(){e.forEach(function(e,t){t>=s+1&&t<=s+c?(e.show(),e.setStyle("width",100/c+"%")):e.hide()}),o._setChizu(e,i,s+1)},o.arrow.right.addEventListener("click",o.clickRightArrowEventListener)},_listenToColumns:function(){var e=this,n=e.utils.debounce(function(n){if("select"===n.event){e.verticalLevelSelector=n.node.data.virtualRowID;for(var i=e.columns[n.column.attributeKeyValue.key],s=0;s<i.length;s++)n.column.id===i[s].id&&(e.siblings.right=t.is(i[s+1],"object")?i[s+1]:null,e.siblings.left=t.is(i[s-1],"object")?i[s-1]:null)}if(e.preventUnselectColumns)e.preventUnselectColumns=!1;else if(!e._ctrlKey&&"select"===n.event)for(var o=0;o<e.columns[e.currentView].length;o++)e.columns[e.currentView][o]!==n.column&&e.columns[e.currentView][o].unselectAll();e.dispatchEvent("onSelect")}.bind(e),M);e.columns[e.currentView].forEach(function(t){e.listenTo(t,"onSelect",n),e.columnsListeners.push({component:t,event:"onSelect"}),e.listenTo(t,"onUnselectAll",function(){for(var t=0;t<e.columns[e.currentView].length;t++)e.columns[e.currentView][t].unselectAll()}),e.columnsListeners.push({component:t,event:"onUnselectAll"})})},_stopListeningToColumns:function(){var e=this;e.columnsListeners.forEach(function(t){e.stopListening(t.component,t.event)}),e.columnsListeners=[]},_subscribers:function(){var e=this;if(!1===e._subscribed){var t=o.get("widget")||window.widget;t.body.addEventListener("keydown",function(t){e.container.getParent().isHidden()||17===t.keyCode&&(e._ctrlKey=!0)}),t.body.addEventListener("keyup",function(t){e.container.getParent().isHidden()||17===t.keyCode&&(e._ctrlKey=!1)}),e._subscribed=!0}},utils:{_debounceTimeouts:[],debounce:function(e,t,n){var i,s=this;return function(){var o=this,a=arguments,r=n&&!i;clearTimeout(i);var l=s._debounceTimeouts.indexOf(i);-1!==l&&s._debounceTimeouts.splice(l,1),i=setTimeout(function(){i=null,n||e.apply(o,a)},t),s._debounceTimeouts.push(i),r&&e.apply(o,a)}}}})}),define("DS/IssueManagement/Component",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/IssueComponents/open/Open","DS/IssueCommon/utils/TaskManager","DS/IssueCommon/utils/Utils","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/models/TreeDocument","DS/IssueManagement/utils/BIFilter","DS/IssueManagement/utils/ModelParser","DS/IssueManagement/utils/Synchronizer","DS/IssueManagement/views/kanban/Kanban","DS/IssueManagement/views/list/TreeList","DS/IssueManagement/views/datagrid/DataGrid","DS/DataGridView/DataGridView","DS/Tree/TreeNodeView","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/LocalStorage","DS/IssueServices/utils/Performance","text!DS/IssueManagement/assets/Settings.json","text!DS/IssueManagement/assets/IssueManagement.1D.json","text!DS/IssueManagement/assets/IssueManagement.2D.json","text!DS/IssueManagement/assets/IssueManagement.dataGrid.json","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,b,I,y,w,S,C,E,_,T,D,M,A,x){"use strict";var N="ENXISSU_AP",O="CUSTOM_ATTR_INFOS",P=0,k=0,L="ListView",R="KanbanView",U="IFB",V={ISU_TASK_MANAGER:"ISU_TASK_MANAGER"},F={FILTER:"FILTER",PREFERENCES:"PREFERENCES",GET_FILTERED_ISSUES:"GET_FILTERED_ISSUES"};return t.extend(h,{name:"DS/IssueManagement/Component",tag:"div",className:"im-main-component",_logger:null,defaultOptions:{document:{},kanban:JSON.parse(D),settings:JSON.parse(T)},containers:{list:null,kanban:null},document:null,list:null,kanban:null,synchronizer:null,taskManager:null,_subscriberTokens:[],_tasks:{subscriberTokens:[],current:null},_timestampUpdate:0,_subscriberId:"",setup:function(e){if(this.attributes=[],this._logger=r.getLogger("DS/IssueManagement/Component"),this._parent(e),this.document=new p({component:this,settings:this.getOption("settings"),document:this.getOption("document")}),this.listView=S.get("ISU_LISTVIEW"),this.isAnyFilterSelected=!1,this.settings=JSON.parse(T),this.listView)this.setOption("list",JSON.parse(M)),this.list=new b({component:this,settings:this.getOption("settings"),list:this.getOption("list")});else{var t=JSON.parse(A);this.setOption("list",t),this.list=new I({component:this,settings:this.getOption("settings"),treeDocument:this.document,columns:this.getOption("list").columns,showNodeKPIColorFlag:!0,showContextualMenuColumnFlag:!0,showRowBorderFlag:!0,showAlternateBackgroundFlag:!0,identifier:widget.id})}this.kanban=new v({component:this,settings:this.getOption("settings"),kanban:this.getOption("kanban")}),this.synchronizer=new f({list:this.list,kanban:this.kanban}),this._subscriberId=Math.random().toString(36).substr(2,9),this.taskManager=d,this._subscriberTokens=[],this._tasks={subscriberTokens:[],current:null},this._timestampUpdate=0,this.utils._setTypesCallbackSubscribe=!1,this.initializeBIFilter(),this._subscribers(),this._subscribersTaskManager(),this.setPADContext()},render:function(){_.start(this.name+" render"),this.container.empty(),this.containers.list=n.createElement("div",{class:"issue-list-container"}),this.containers.kanban=n.createElement("div",{class:"issue-kanban-container"}),this.containers.list.inject(this.container),this.containers.kanban.inject(this.container),this.getCurrentView()===R?(this.containers.list.addClassName("hidden"),this.containers.kanban.removeClassName("hidden")):(this.containers.list.removeClassName("hidden"),this.containers.kanban.addClassName("hidden")),this.containers.list.setContent(this.list.getContent()),this.containers.kanban.setContent(this.kanban.render());var e=this.document.getRoots();return 0===e.length&&this.placeholder.show(this.container,this.isAnyFilterSelected),this.container.addEventListener("contextmenu",function(e){e.preventDefault()},this),_.end(this.name+" render"),this.dispatchEvent("onReady",{roots:e}),this},build:function(){var e=this;_.start(e.name+" build");var t=(S.get("widget")||window.widget).getValue("filter");t=JSON.parse(t);return S.get("LoadData_ModelerAPI")?e.load_v2().then(function(){return e.list.load(e.document)}).then(function(){return e.kanban.load(e.document)}).then(function(){return e.synchronizer.start()}).then(function(){e.render(),_.end(e.name+" build")}):e.load().then(function(){return e.list.load(e.document)}).then(function(){return e.kanban.load(e.document)}).then(function(){return e.synchronizer.start()}).then(function(){e.render(),_.end(e.name+" build")})},load_v2:function(){var t=this;_.start(t.name+" load");var i=S.get("widget")||window.widget,s=i.getValue("filter"),a=void 0===i.getValue("affectedItemSetting")||i.getValue("affectedItemSetting"),r=void 0===i.getValue("resolvedItemSetting")||i.getValue("resolvedItemSetting"),l=void 0===i.getValue("contextSetting")||i.getValue("contextSetting");return!0===t.utils.isJson(s)?((s=JSON.parse(s)).onlyids=!1,s.affectedItem=a,s.resolvedItem=r,s.context=l):s={},t.isAnyFilterSelected=t.isFilteringRequestEligible(),!t.isAnyFilterSelected&&t.settings.hideNoFilterSelectionPreference?(t.getTreeDocument().removeIssueRoots(),t.dispatchEvent("onRootsRemoved",{}),o.unmask(i.body),new e(function(e){e([])})):C.issues.filter({version:"2.0",data:{filter:s}}).then(function(i){if(void 0!==i.success&&!1===i.success){if(i.body&&i.body.error&&i.body.error.internal&&n.is(i.body.error.internal,"string")){var o=i.body.error.internal;if(o.includes("No business object")||o.includes("not exist")){var a=u.getErrorMessage("0");u.displayErrorMessage(a,"error")}}e.resolve([])}var r=g.parse(i.body);t.document.addRoots(r);S.get("ISU_TYPE_NLS");t.addCustomAttrToColumnsList(),t.getClassificationIds(s).then(e=>{t.addClassificationAttrToColumnsList(e)}),t.getCustomAttrValues(s).then(e=>{t.updateCustomAttrValuesInDatagrid(e)}),t.updateNLSValuesInDatagrid(r)})},addClassificationAttrToColumnsList:function(e){let t=[];e&&e.body&&Array.isArray(e.body)&&e.body.map(e=>{if(e.attribute.length){let n=e.attribute[0]["to[Classified Item].from.id"];""!=n&&(n=(n=(n=n.replace("[","")).replace("]","")).split(", "),t.push(...n))}});let n=[...new Set(t)];n.length&&this.getClassificationAttributeValues(n)},addCustomAttrToColumnsList:function(){var e=this;let t=S.get(O);Array.isArray(t)&&t.forEach(function(t){var n={column:{name:t.name,text:t.nlsName,dataIndex:t.selectable,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustom:"Attribute"}};e.list.getManager().getColumns().filter(e=>e.dataIndex==n.column.dataIndex).length<=0&&(e.list.getManager().removeColumnOrGroup(t.selectable),e.list.getManager().addColumnOrGroup(n.column))})},updateCustomAttrValuesInDatagrid:function(e){var t={};for(let a=0;a<e.body.length;a++){for(var n=e.body[a].attribute,i=e.body[a].physicalId,s={},o=0;o<n.length;o++){let e=Object.keys(n[o])[0],t=n[o][e];switch(e=(e=e.replace("attribute[","")).replace("]","")){case"Waiting On":s.Approvals="Unassigned"!==t&&""!==t,s["ds6w:validation"]={},s["ds6w:validation"].activated="Unassigned"!==t&&""!==t;break;default:s[e]=t}}t[i]=s}var a=this.document.getRoots(!1);this.document.undoRegisterNodeModelUpdateEvent(),this.document.withTransactionUpdate(function(){for(var e=0;e<a.length;e++){var n=a[e];if(t[n.options.physicalId]){var i=t[n.options.physicalId];n.updateOptions({validation:{activated:i["ds6w:validation"].activated},grid:i})}}}),this.document.registerNodeModelUpdateEvent()},updateNLSValuesInDatagrid:function(e){var t=this,n=[],i=[];e.forEach(e=>{n.push(e.organization),i.push(e.collaborativeSpace),n.push(e.responsibleOrganization),n.push(e.reportingOrganization)});var s={"ds6w:organizationResponsible":n,"ds6w:project":i};C.getNLSValuesPromise(s).then(n=>{if(null!=n){var i=n["ds6w:organizationResponsible"],s=n["ds6w:project"];t.getTreeDocument().withTransactionUpdate(function(){for(var n={},o=0;o<e.length;o++){var a=e[o],r=a.physicalId,l={};Object.keys(i).forEach(function(e){e==a.organization&&(l.organization=i[e]),e==a.responsibleOrganization&&(l.responsibleOrganizationTitle=i[e]),e==a.reportingOrganization&&(l.reportingOrganizationTitle=i[e])}),Object.keys(s).forEach(function(e){e==a.collaborativeSpace&&(l.collaborativeSpaceTitle=s[e])}),n[r]=l}for(var c=t.document.getRoots(!1),d=0;d<c.length;d++){var u=c[d];if(n[u.options.physicalId]){var m=n[u.options.physicalId];u.updateOptions({grid:{"ds6w:collaborativeSpace":m.collaborativeSpaceTitle,"ds6w:organization":m.organization,"ds6w:responsibleOrganization":m.responsibleOrganizationTitle,"ds6w:reportingOrganization":m.reportingOrganizationTitle},collaborativeSpaceTitle:m.collaborativeSpaceTitle,organization:m.organization,reportingOrganization:m.reportingOrganizationTitle,responsibleOrganization:m.responsibleOrganizationTitle})}}})}})},getCustomAttrValues:function(t){var n=[];let i=S.get(O);return Array.isArray(i)?(i.forEach(e=>{let t=e.selectable,i={predicate:e.uri,selectable:t};n.push(i)}),JSON.parse(A).columns.forEach(e=>{if(e.isGenericResource){let t={predicate:e.predicate,selectable:e.selectable};n.push(t)}}),C.issues.customAttrFilter({version:"2.0",data:{filter:t,customAttrInfo:n}})):e.reject()},getClassificationIds:function(e){return C.classification.getClassIds({version:"1.0",data:{filter:e}})},getClassificationAttributeValues:async function(e){var t=this;await t.getClassificationAttrValues(e).then(e=>{t.attributes=[],e.forEach(function(e){e.classAttributes.forEach(function(e){if(!t.attributes.includes(e.name)){t.attributes.push(e.name);var n={column:{text:e.name,dataIndex:e.name,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustom:"Classification"}},i={that:t,attr:e};n.column.getCellValue=t.list.rendering.classificationAttributes.bind(i),t.list.getManager().getColumns().filter(e=>e.dataIndex==n.column.dataIndex).length<=0&&(t.list.getManager().removeColumnOrGroup(e.name),t.list.getManager().addColumnOrGroup(n.column))}})})})},getClassificationAttrValues:function(t){var n=[];return t.forEach(function(t){var i=new e(function(e){C.classification.getClassificationAttributesOfClass({id:t,onFailure:function(e){console.log(e)}}).then(function(n){if(n.member){var i={classAttributes:n.member[0].ClassAttributes.member,classID:t};e(i)}else e()})});n.push(i)}),e.all(n)},load:function(){var t=this;_.start(t.name+" load");var i=S.get("widget")||window.widget,s=i.getValue("filter");return!0===t.utils.isJson(s)?(s=JSON.parse(s)).onlyids=!0:s={},t.isAnyFilterSelected=t.isFilteringRequestEligible(),!t.isAnyFilterSelected&&t.settings.hideNoFilterSelectionPreference?(t.getTreeDocument().removeIssueRoots(),t.dispatchEvent("onRootsRemoved",{}),o.unmask(i.body),new e(function(e){e([])})):C.issues.filter({version:"1.0",data:{filter:s}}).then(function(i){if(void 0!==i.success&&!1===i.success){if(i.body&&i.body.error&&i.body.error.internal&&n.is(i.body.error.internal,"string")){var s=i.body.error.internal;if(s.includes("No business object")||s.includes("not exist")){var o=u.getErrorMessage("0");u.displayErrorMessage(o,"error")}}e.resolve([])}var a=g.parse(i.body);t.document.addRoots(a),t.classes=[];var r=[];t.columns=[];let l=S.get("ISU_TYPE_NLS"),c=[];n.is(l["ds6w:type"])&&(c=Object.keys(l["ds6w:type"]));let d={},m=c.filter(e=>"Issue"!=e);m.length>0&&(d.subType=m.toString()),C.custom.getCustomAttributes(d).then(function(e){n.is(e)&&e.body.forEach(function(e){var n={column:{name:e.name,text:e.title,dataIndex:e.path,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustom:"Attribute"}};t.list.getManager().getColumns().filter(e=>e.dataIndex==n.column.dataIndex).length<=0&&(t.listView?t.list.getManager().addColumn(n):t.list.getManager().addColumnOrGroup(n.column))})}),c.includes("Issue")||c.push("Issue"),C.type.getSubTypesAttributes({types:c}).then(function(e){if(n.is(e)&&e.results&&e.results.length>1){let n=e.results.filter(e=>"Issue"==e.name)[0].properties.map(e=>e.name),i=new Set;e.results.forEach(e=>{e.properties.forEach(e=>{n.includes(e.name)||i.add(e)})}),i.forEach(function(e){var n={column:{name:e.name,text:e.nlsName,dataIndex:e.name,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustom:"Attribute"}};if(t.list.getManager().getColumns().filter(e=>e.dataIndex==n.column.dataIndex).length<=0)if(t.listView)t.list.getManager().addColumn(n);else{var i={that:t,attr:e};n.column.getCellValue=t.list.rendering.classificationAttributes.bind(i),t.list.getManager().addColumnOrGroup(n.column)}})}});for(var p=0;p<a.length;p++){var h=a[p].classification;h.length>0&&h.forEach(function(n){if(!t.classes.includes(n)){t.classes.push(n);var i=new e(function(e){C.classification.getClassificationAttributesOfClass({id:n,onFailure:function(e){console.log(e)}}).then(function(t){var i={classAttributes:t.member[0].ClassAttributes.member,classID:n};e(i)})});r.push(i)}})}return e.all(r)}).then(function(e){t.attributes=[],e.forEach(function(e){e.classAttributes.forEach(function(e){if(!t.attributes.includes(e.name)){t.attributes.push(e.name);var n={column:{text:e.name,dataIndex:e.name,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustom:"Classification"}};if(t.listView)n.column.onCellRequest=t.list.rendering.classificationAttributes,t.list.getManager().getColumns().filter(e=>e.dataIndex==n.column.dataIndex).length<=0&&(t.list.getManager().addColumn(n),t.columns.push(n));else{var i={that:t,attr:e};n.column.getCellValue=t.list.rendering.classificationAttributes.bind(i),t.list.getManager().getColumns().filter(e=>e.dataIndex==n.column.dataIndex).length<=0&&(t.list.getManager().addColumnOrGroup(n.column),t.columns.push(n.column))}}})})}).then(function(){t.document.updatePredicates().finally(function(){t.dispatchEvent("onPredicatesUpdate",{})})}).finally(function(){_.end(t.name+" load")})},loadInfo:function(t){var n=this,i=t.map(e=>e.options.physicalId);return new e(function(e,s){C.issues.retrieve({timestamp:n._timestampUpdate?n._timestampUpdate:null,data:{objects:i.map(function(e){return{physicalId:e}})},onComplete:function(i){Array.isArray(i.results)?n.getTreeDocument().withTransactionUpdate(function(){for(var n={},s=0;s<i.results.length;s++){var o=i.results[s].body,a=o.physicalId,r={};r.reportedAgainst=o.reportedAgainst,r.resolvedBy=o.resolvedBy,r.resolvedItems=o.resolvedItems,r.contexts=o.contexts,n[a]=r}for(var l=0;l<t.length;l++){var c=t[l];if(n[c.options.physicalId]){var d=n[c.options.physicalId];c.updateOptions({reportedAgainst:d.reportedAgainst,resolvedItems:d.resolvedItems,resolvedBy:d.resolvedBy,contexts:d.contexts})}}e()}):s(new Error("Unexpected response when retrieving issues."))},onFailure:function(e){n._logger.log("getIssues :Failure..."+e),s(e)}})})},loadInfo_fetchV2:function(t){var n=this;if(0==t.length)return e.resolve();let i=[];return t.forEach(e=>{e.options.reportedAgainst.forEach(e=>{i.push(e.physicalId)}),e.options.resolvedBy.forEach(e=>{i.push(e.physicalId)}),e.options.contexts.forEach(e=>{i.push(e.physicalId)}),e.options.resolvedItems.forEach(e=>{i.push(e.physicalId)})}),i=[...new Set(i)],new e(function(e,s){C.fetch({data:{objects:i.map(function(e){return{physicalId:e}}),predicates:n.list.getPredicates()}}).then(i=>{Array.isArray(i.body.results)?n.getTreeDocument().withTransactionUpdate(function(){let n={};i.body.results.forEach(e=>{let t={};var i="";e.attributes.forEach(e=>{switch(e.name){case"resourceid":i=e.value;break;case"ds6w:label":t.title=e.value;break;case"ds6w:type":t.type=e.value;break;case"ds6w:identifier":t.name=e.value;break;case"ds6wg:revision":t.revision=e.value}}),n[i]=t});for(var s=0;s<t.length;s++){var o=t[s],a={};let e=o.options.contexts;a.contexts=[],e.forEach(e=>{if(n[e.physicalId]){let t={};t={...n[e.physicalId],...e},a.contexts.push(t)}});let i=o.options.reportedAgainst;a.reportedAgainst=[],i.forEach(e=>{if(n[e.physicalId]){let t={};t={...n[e.physicalId],...e},a.reportedAgainst.push(t)}});let r=o.options.resolvedBy;a.resolvedBy=[],r.forEach(e=>{if(n[e.physicalId]){let t={};t={...n[e.physicalId],...e},a.resolvedBy.push(t)}});let l=o.options.resolvedItems;a.resolvedItems=[],l.forEach(e=>{if(n[e.physicalId]){let t={};t={...n[e.physicalId],...e},a.resolvedItems.push(t)}}),o.updateOptions({reportedAgainst:a.reportedAgainst,resolvedItems:a.resolvedItems,resolvedBy:a.resolvedBy,contexts:a.contexts})}e()}):s(new Error("Unexpected response when retrieving issues."))})})},onPostInitialize:function(){var e=this,t=S.get("widget")||window.widget,n=t.getValue("expandedIds");if(!0===Array.isArray(n))for(var i=0;i<n.length;i++)for(var s=e.getNodesById(n[i]),o=0;o<s.length;o++)s[o].expand();e.loadBIFilterPreference();var a=S.get("information");a&&a.isOpened()&&a.fullScreenMode&&((s=e.document.getRoots(!1)).length>0&&(e.document.prepareBroadcastSelect(),e.document.withTransactionUpdate(function(){e.document.unselectAll(),s[0].select(),e.document.pushBroadcastSelect()})));t.getValue("contextFilter")&&S.get("filter").showContextFilter();try{require(["DS/WebappsUtils/WebappsUtils","DS/IssueComponents/konami/Konami"],function(e,t){t.kojima()})}catch(e){}},destroy:function(){this._subscriberTokens.forEach(function(e){S.get("eventsHandler").unsubscribe(e)}),this._tasks.subscriberTokens.forEach(function(e){S.get("eventsHandler").unsubscribe(e)}),this.document.removeEventListener("onRootsAdded"),this.document.removeEventListener("onRootsRemoved"),this.document.empty(),this.document=null,this.synchronizer=null,this.list.destroy(),this.list=null,this.kanban.destroy(),this.kanban=null,this.containers={list:null,kanban:null},this._timestampUpdate=0,this._subscriberTokens=[],this.utils._setTypesCallbackSubscribe=!1,this._tasks={subscriberTokens:[],current:null},this.taskManager.destroy(),this.taskManager=null,this._subscriberId=""},refresh_New:function(t){var n=this,i=S.get("widget")||window.widget;if(o.mask(i.body),n.isAnyFilterSelected=n.isFilteringRequestEligible(),!n.isAnyFilterSelected&&n.settings.hideNoFilterSelectionPreference)return n.getTreeDocument().removeIssueRoots(),n.placeholder.show(n.container,n.isAnyFilterSelected),n.dispatchEvent("onRootsRemoved",{}),S.get("filter").refresh(),o.unmask(i.body),new e(function(e){e([])});n.document.refresh_v2(t).then(function(){0===n.document.getRoots().length?(n.placeholder.show(n.container,n.isAnyFilterSelected),n.dispatchEvent("onRootsRemoved",{})):n.placeholder.hide(n.container),n.list.preferences.loadSortPreference(),S.get("filter").refresh(),n.document.getModelEvents().publish({event:"setPathTags"}),n.dispatchEvent("onRefreshComplete"),n.publishFilteredIssues(),o.unmask(i.body)})},refresh:function(t){var n=this,i=S.get("widget")||window.widget;if(o.mask(i.body),n.isAnyFilterSelected=n.isFilteringRequestEligible(),!n.isAnyFilterSelected&&n.settings.hideNoFilterSelectionPreference)return n.getTreeDocument().removeIssueRoots(),n.placeholder.show(n.container,n.isAnyFilterSelected),n.dispatchEvent("onRootsRemoved",{}),S.get("filter").refresh(),o.unmask(i.body),new e(function(e){e([])});n.document.refresh(t).then(function(){0===n.document.getRoots().length?(n.placeholder.show(n.container,n.isAnyFilterSelected),n.dispatchEvent("onRootsRemoved",{})):n.placeholder.hide(n.container),n.list.preferences.loadSortPreference(),S.get("filter").refresh(),n.document.getModelEvents().publish({event:"setPathTags"}),n.dispatchEvent("onRefreshComplete"),n.publishFilteredIssues(),o.unmask(i.body)})},resize:function(){null!==this.kanban&&this.kanban.resize()},switchView:function(e){(E.setItem("view",{name:e}),e===R)?(this.containers.list.addClassName("hidden"),this.containers.kanban.removeClassName("hidden"),m.disable(["Selection","Find"])):(this.containers.list.removeClassName("hidden"),this.containers.kanban.addClassName("hidden"),0===this.getTreeDocument().getRoots(!1).length?m.idling():m.enable(["Selection"]))},publishSelect:function(e){var t=S.get("widget")||window.widget;S.get("eventsHandler").publish(this._subscriberId,"DS/Object/select",{metadata:{appId:t.id,appName:t.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:e.paths,attributes:e.attributes},version:"1.0"})},publishUpdate:function(e,t){var i=S.get("widget")||window.widget;S.get("eventsHandler").publish(this._subscriberId,"DS/Object/update",{metadata:{appId:i.id,appName:i.name,timestamp:Math.floor(Date.now()),options:n.is(t,"object")?t:{}},data:{paths:e.paths,attributes:e.attributes},version:"1.0"})},publishPreferences:function(){for(var e=S.get("widget")||window.widget,t=[],n=this.getTreeDocument().getRoots(!1),i=0;i<n.length;i++)t.push(n[i].options.physicalId);S.get("eventsHandler").publish(this._subscriberId,"DS/Widget/preferences",{metadata:{appId:e.id,appName:e.name,timestamp:Math.floor(Date.now())},data:{preferences:JSON.stringify(e.getPreferences())},version:"1.0"})},publishFilteredIssues:function(){for(var e=S.get("widget"),t=[],n=this.getTreeDocument().getRoots(!1),i=0;i<n.length;i++)t.push(n[i].options.physicalId);S.get("eventsHandler").publish(this._subscriberId,"DS/ENXISSU_AP/Filter/Issues",{metadata:{appId:e.id,appName:e.name,timestamp:Math.floor(Date.now())},data:{filter:{issues:t}},version:"1.0"})},publishCompass:function(){this.utils.setTypesCallbackForOFW(this.document.getSelectedNodes())},getSelectedNodes:function(){return this.document.getSelectedNodes()},getNodesById:function(e){return this.document.getNodesById(e)},getTreeDocument:function(){return this.document},getTreeListView:function(){return this.list},getManager:function(){return this.list},getKanbanView:function(){return this.kanban},getCurrentView:function(){var e=E.getItem("view");return null!==e&&e.name?e.name:(E.setItem("view",{name:L}),L)},getSessionOrFilteredRoots:function(){var e=[],t=this.getTreeDocument();if(!0===t.isBIFiltered())for(var n=t.getRoots(!1),i=0;i<n.length;i++)e.push(n[i].options.physicalId);else{var s=S.get("widget"),o=s.getValue("filter");!0===t.utils.isJson(o)&&!0===(o=JSON.parse(o)).session&&(e=s.getValue("roots"))}return e},_subscribers:function(){var t=this,n=S.get("widget")||window.widget,i=S.get("eventsHandler");t.document.addEventListener("onRootsAdded",function(e){t.placeholder.hide(t.container),t.dispatchEvent("onRootsAdded",e),t.document.getModelEvents().publish({event:"setPathTags",data:e.data.filterChange})}),t.document.addEventListener("onRootsRemoved",function(e){0===t.document.getRoots().length&&t.placeholder.show(t.container),t.dispatchEvent("onRootsRemoved",e),t.document.getModelEvents().publish({event:"setPathTags"})}),t.listenTo(t,"onResize",function(){S.get("application").resize()}),t._subscriberTokens.push(i.subscribe(t._subscriberId,"DS/Object/create",function(n){_.start(t.name+" DS/Object/create");var i=n.data.attributes;t.document.refreshNodesById({timestamp:n.metadata.timestamp,created:Object.keys(i)}).then(function(n){t.document.withBroadcastSelect(new e(function(e){t.document.withTransactionUpdate(function(){t.document.unselectAll();for(var i=n.created,s=0;s<i.length;s++)i[s].select();e()})})),_.end(t.name+" DS/Object/create")})})),t._subscriberTokens.push(i.subscribe(t._subscriberId,"DS/Object/update",function(e){var n=e.data.attributes;t.document.refreshNodesById({timestamp:e.metadata.timestamp,modified:Object.keys(n)}).then(function(){_.end(t.name+" DS/Object/update")})})),t._subscriberTokens.push(i.subscribe(t._subscriberId,"DS/Object/delete",function(e){_.start(t.name+" DS/Object/delete");var n=t.document,i=[];e.data.paths.forEach(function(e){i.push(e.pop())}),n.removeRootsById(i).then(function(){_.end(t.name+" DS/Object/delete")})})),t._subscriberTokens.push(i.subscribe(t._subscriberId,"DS/Object/select",function(e){var i=e.data.paths;if(e.metadata.appId!==n.id&&!(t._tasks&&t._tasks.current&&t._tasks.current.taskType&&"SELECT_IN_3D"===t._tasks.current.taskType)){_.start(t.name+" DS/Object/select");var s=t.document;s.withTransactionUpdate(function(){for(var e=t.getSelectedNodes(),n=t.getTreeListView(),o=0;o<i.length;o++){var a=s.getNodesById(i[o][P]);if(a.length>0){var r=a[P];_.start(t.name+" scrollToNode"),t.listView?0!==o||n.getManager().isNodeInVisibleViewport(r)||n.getManager().scrollToNode(r,"top",!1):n.ensureNodeModelVisible(r),_.end(t.name+" scrollToNode"),e.forEach(function(e){e.unselect()}),r.select()}}m.select(t.getSelectedNodes()),_.end(t.name+" DS/Object/select")})}}))},_subscribersTaskManager:function(){var t=this,i=S.get("widget")||window.widget,s=S.get("eventsHandler");t._tasks.subscriberTokens.push(s.subscribe(t._subscriberId,"DS/IssueManagementTask/add",function(e){if(_.start(t.name+" DS/IssueManagementTask/add"),n.is(e.metadata,"object")&&n.is(e.metadata.options,"object")&&n.equals(e.metadata.options[V.ISU_TASK_MANAGER],V.ISU_TASK_MANAGER)&&Array.isArray(e.data.paths)&&e.data.paths.length>0){var s=e.data.paths[P][P],o=e.data.attributes[s];if(!n.is(t._tasks.current)&&(l=i.body.getDimensions().height,c=window.getComputedStyle(i.body),0!==l&&"none"!==c.display&&-1!==Object.keys(F).indexOf(o.taskType))){var a=[],r={};a.push([s]),r[s]={taskType:o.taskType,widgetIdIM:o.widgetIdIM,widgetId3D:i.id},S.get("eventsHandler").publish(t._subscriberId,"DS/IssueManagementTask/ready",{metadata:{appId:i.id,appName:i.name,timestamp:Math.floor(Date.now()),options:n.clone(e.metadata.options)},data:{paths:a,attributes:r},version:"1.0"})}}var l,c;_.end(t.name+" DS/IssueManagementTask/add")})),t._tasks.subscriberTokens.push(s.subscribe(t._subscriberId,"DS/IssueManagementTask/exec",function(s){if(_.start(t.name+" DS/IssueManagementTask/exec"),n.is(s.metadata,"object")&&n.is(s.metadata.options,"object")&&n.equals(s.metadata.options[V.ISU_TASK_MANAGER],V.ISU_TASK_MANAGER)&&Array.isArray(s.data.paths)&&s.data.paths.length>0){var o=s.data.paths[P][P],a=s.data.attributes[o];i.name===N&&a.widgetId3D===i.id&&new e(function(e){e()}).then(function(){t._tasks.current={taskId:o,taskType:a.taskType,widgetIdIM:a.widgetIdIM,widgetId3D:i.id}}).then(function(){return n.is(t._taskHandlers[a.taskType],"function")?t._taskHandlers[a.taskType].call(t,a.args):e.resolve()}).then(function(e){n.is(e,"object")&&(t._tasks.current.cancel=e)}).catch(function(e){t._tasks.current=null,t._logger.error(e)})}_.end(t.name+" DS/IssueManagementTask/exec")})),t._tasks.subscriberTokens.push(s.subscribe(t._subscriberId,"DS/IssueManagementTask/cancel",function(e){if(_.start(t.name+" DS/IssueManagementTask/cancel"),n.is(e.metadata,"object")&&n.is(e.metadata.options,"object")&&n.equals(e.metadata.options[V.ISU_TASK_MANAGER],V.ISU_TASK_MANAGER)&&Array.isArray(e.data.paths)&&e.data.paths.length>0){var s=e.data.paths[P][P],o=e.data.attributes[s];o.taskId===t._tasks.current.taskId&&o.widgetId3D===i.id&&o.widgetIdIM===t._tasks.current.widgetIdIM&&(n.is(t._tasks.current.cancel,"function")&&t._tasks.current.cancel(),t._tasks.current=null)}_.end(t.name+" DS/IssueManagementTask/cancel")}))},_taskHandlers:{FILTER:function(t){var n=this,i=S.get("widget")||window.widget;return new e(function(e){n.listenTo(n,"onRefreshComplete",function(){var e=[],t={};e.push([n._tasks.current.taskId]),t[n._tasks.current.taskId]={taskType:n._tasks.current.taskType,widgetIdIM:n._tasks.current.widgetIdIM,widgetId3D:n._tasks.current.widgetId3D},S.get("eventsHandler").publish(n._subscriberId,"DS/IssueManagementTask/done",{metadata:{appId:i.id,appName:i.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:e,attributes:t},version:"1.0"}),n._tasks.current=null,n.stopListening(n,"onRefreshComplete")});i.setValue("filter",JSON.stringify({session:!0})),i.setValue("roots",t[k]),i.dispatchEvent("onRefresh"),e(null)})},PREFERENCES:function(){var t=this,n=S.get("widget")||window.widget;return new e(function(e){var i=[],s={};i.push([t._tasks.current.taskId]),s[t._tasks.current.taskId]={taskType:t._tasks.current.taskType,widgetIdIM:t._tasks.current.widgetIdIM,widgetId3D:t._tasks.current.widgetId3D,response:{preferences:JSON.stringify(n.getPreferences())}},S.get("eventsHandler").publish(t._subscriberId,"DS/IssueManagementTask/done",{metadata:{appId:n.id,appName:n.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:i,attributes:s},version:"1.0"}),t._tasks.current=null,e(null)})},GET_FILTERED_ISSUES:function(){var t=this,n=S.get("widget");return new e(function(e){for(var i=[],s=t.getTreeDocument().getRoots(!1),o=0;o<s.length;o++)i.push(s[o].options.physicalId);var a=[],r={};a.push([t._tasks.current.taskId]),r[t._tasks.current.taskId]={taskType:t._tasks.current.taskType,widgetIdIM:t._tasks.current.widgetIdIM,widgetId3D:t._tasks.current.widgetId3D,response:{filter:{issues:i}}},S.get("eventsHandler").publish(t._subscriberId,"DS/IssueManagementTask/done",{metadata:{appId:n.id,appName:n.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:a,attributes:r},version:"1.0"}),t._tasks.current=null,e(null)})}},getPADTreeDocument:function(){return this.getTreeDocument()},setPADContext:function(){var e=this;require(["DS/PADUtils/PADContext"],function(t){t.set(e)})},maskForTask:function(e,t){var i=this,o=S.get("widget")||window.widget;i._tasks.current={taskId:e.taskId,taskType:e.taskType,widgetIdIM:o.id,widgetId3D:""};var a=o.body;a.addClassName("masked masked-task");var r=n.createElement("div",{class:"mask mask-for-task"});n.createElement("div",{class:"mask-wrapper",html:n.createElement("div",{class:"task-mask-cancel",html:[n.createElement("div",{class:"task-select-message",html:t||x.tasks.cancelLabel}),new s({value:x.tasks.cancel,className:"default task-cancel-button",id:"task-cancel",events:{onClick:function(){null!==i._tasks.current?i.taskManager.cancel(i._tasks.current.taskId):(a.removeClassName("masked masked-task"),r.destroy())}}})]})}).inject(r),i._mask=r,r.inject(a)},unmaskForTask:function(e){var t=S.get("widget")||window.widget;e.widgetIdIM===t.id&&(t.body.removeClassName("masked masked-task"),n.is(this._mask)&&(this._mask.destroy(),this._mask=null),this._tasks.current=null)},placeholder:{show:function(e,t){var i=e.getElement(".no-issues-to-show-container");i&&i.destroy();var s=x.titles.placeholder.sub;t||(s=x.titles.placeholder.sub2),e.getChildren().forEach(function(e){e.setStyle("display","none")});var o=n.createElement("span",{class:"no-issues-to-show-filter-shortcut fonticon fonticon-list-filter"}),r=n.createElement("span",{class:"no-issues-to-show-create-shortcut fonticon fonticon-plus"}),l=n.createElement("div",{class:"no-issues-to-show-container",html:[n.createElement("div",{class:"no-issues-to-show",html:[n.createElement("div",{class:"pin",html:'<span class="fonticon fonticon-5x fonticon-issue"></span>'}),n.createElement("div",{class:"pulse"}),n.createElement("span",{class:"no-issues-to-show-label",html:x.titles.placeholder.label}),n.createElement("div",{class:"no-issues-to-show-sub-container",html:n.createElement("span",{html:x.replace(s,{filter:o.outerHTML,create:r.outerHTML})})})]})]});return e.appendChild(l),this._filterTooltip=new a({position:"top",target:l.getElement(".no-issues-to-show-filter-shortcut"),body:x.filter.title}),l.getElement(".no-issues-to-show-filter-shortcut").addEventListener("click",function(){S.get("application").actionBar._iconBar.getItem("Filter").elements.icon.click()}),t&&(this._createTooltip=new a({position:"top",target:l.getElement(".no-issues-to-show-create-shortcut"),body:x.actions.create.title}),l.getElement(".no-issues-to-show-create-shortcut").addEventListener("click",function(){var e=m.getCommand("Create");e.mode=U,e.begin()})),l},hide:function(e){var t=e.getElement(".no-issues-to-show-container");null!==t&&(e.getChildren().forEach(function(e){e.setStyle("display","initial")}),t.destroy(),this._filterTooltip&&(this._filterTooltip.destroy(),this._filterTooltip=null),this._createTooltip&&(this._createTooltip.destroy(),this._createTooltip=null))}},isFilteringRequestEligible:function(){let e=S.get("actionBar");var t=!1;if(e.filterMenu){let i=e.filterMenu.items.filter(e=>{if(e.selected)return t=!0,e.name}).map(e=>e.name);var n=!0;(1==i.length&&("closed"==i[0]||"filterbyobject"==i[0])&&this.settings.hideNoFilterSelectionPreference||2==i.length&&i.includes("closed")&&i.includes("filterbyobject")&&this.settings.hideNoFilterSelectionPreference)&&(n=!1),n||(t=!1)}return t},utils:{_iconBarForPlaceHolder:null,_setTypesCallbackSubscribe:!1,setTypesCallbackForOFW:function(e){c.setTypesCallbackForOFW(e,{setTypesCallbackSubscribe:this._setTypesCallbackSubscribe}),this._setTypesCallbackSubscribe=!0},isJson:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},isTouchDevice:function(){return"ontouchstart"in document.documentElement}}})});