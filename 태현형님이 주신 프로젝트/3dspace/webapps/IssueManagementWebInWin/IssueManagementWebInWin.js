define("DS/IssueManagementWebInWin/ENOIssueFromTemplateGenerationPanel",["UWA/Core","UWA/Class","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueComponents/create/Create","DS/PlatformAPI/PlatformAPI","DS/IssueComponents/templates/Templates"],function(e,t,n,a,s,i,o){"use strict";return t.extend({init:function(r){var d=parent,l=null,c=null,u=null,p=d.htmlContainer||window.widget.body;function g(e){e.templateList||e.getDialog().addEvent("onResizeFloating",function(){var t=e.getDialog().elements.container.getSize();t.width===window.widget.body.getSize().width&&t.height===window.widget.body.getSize().height||(e.getDialog().setNewBodySize(window.widget.body.getSize()),e.getDialog().centerIt())});var n=new t.Listener;n.listenToOnce(e,"onCreateDialogClose",function(){window.dscef.sendString(JSON.stringify({action:"closePanel"}))}),e.templateList&&n.listenToOnce(e,"onTemplatesDialogClose",function(){window.dscef.sendString(JSON.stringify({action:"closePanel"}))}),i.subscribe("DS/Object/create",function(){window.dscef.sendString(JSON.stringify({action:"displayNotif",notifMsg:"IssueSuccess"}))})}function m(e){var t=[],n=[];return e.forEach(e=>{n.includes(e.physicalId)||(t.push(e),n.push(e.physicalId))}),t}n.initPlatformServices().then(function(){var t,i,d,h;(t=r.contexts?r.contexts.map(function(e){return{physicalId:e}}):[],i=r.reportedAgainst?r.reportedAgainst.map(function(e){return{physicalId:e,automation:{assignee:!r.assignees}}}):[],d=r.attachments?r.attachments:[],h={id:"Ext_GenereateIssue",info:{description:null,name:null},ui:{assignees:[],responsibleOrganization:n.getCurrentCredentials().organization},data:{title:r.title,description:r.description,priority:void 0===r.priority?"Low":r.priority,resolutionDate:Date.now(),reportedAgainst:i,contexts:t,assignees:[],attachments:d,automationTasks:[],responsibleOrganization:n.getCurrentCredentials().organization,reportingOrganization:n.getCurrentCredentials().organization}},new Promise(function(t){if(r.assignees&&r.assignees.length>=1){var a=[],s=r.assignees.length;r.assignees.forEach(function(i){n.getUserInfo(i,{onComplete:function(n){var i=JSON.parse(n);h.data.assignees.push(i.name),a.push({user:i.name,fullName:i.firstname+" "+i.lastname,organization:i.company.name}),0==--s&&(h.ui.assignees=e.merge({},a),t())},onFailure:function(){0==--s&&t()}})})}else t()}).then(function(){return h})).then(function(e){a.add("widget",window.widget),a.get("widget").name="ENOIssueFromTemplateGenerationPanel",(c=new o(p,{editMode:!1,onClose:function(){},onEnd:function(e){u=e,(l=new s(p,{escapeToClose:!1,resizable:!0})).render(),l.isLoaded.finally(function(){var e,t,n;if(u.hidden.contexts||(u.data.contexts.push(...templateFromXApp.data.contexts),u.data.contexts=m(u.data.contexts)),u.hidden.reportedAgainst||(u.data.reportedAgainst.push(...templateFromXApp.data.reportedAgainst),u.data.reportedAgainst=m(u.data.reportedAgainst)),u.hidden.attachments||(u.data.attachments.push(...templateFromXApp.data.attachments),u.data.attachments=(e=u.data.attachments,t=[],e.forEach(e=>{t.includes(e)||t.push(e)}),t)),""==u.data.title&&""!=templateFromXApp.data.title&&(u.data.title=templateFromXApp.data.title),u.hidden.description||""!=u.data.description||""==templateFromXApp.data.description||(u.data.description=templateFromXApp.data.description),u.hidden.resolutionRecommendation||""!=u.data.resolutionRecommendation||""==templateFromXApp.data.resolutionRecommendation||(u.data.resolutionRecommendation=templateFromXApp.data.resolutionRecommendation),!u.hidden.priority){let e=function(e,t){let n=PRIORITY_OPTIONS[e],a=PRIORITY_OPTIONS[t],s="";return s=null==t?e:n>a?e:t}(u.data.priority,templateFromXApp.data.priority);u.data.priority=e}l.applyTemplate(u),g(l),"attachments"in(n=l).views&&(n.views.attachments.view.fields.attachments.iconBar.disableItem("attachFrom3DX"),n.views.attachments.view.fields.attachments.iconBar.disableItem("screenshot")),"related"in n.views&&(n.views.related.view.fields.reportedAgainst.iconBar.getItem("location").elements.container.addClassName("disabled"),n.views.related.view.fields.contexts.iconBar.getItem("location").elements.container.addClassName("disabled"),n.views.related.view.fields.reportedAgainst.iconBar.getItem("addReported").elements.container.addClassName("disabled"),n.views.related.view.fields.contexts.iconBar.getItem("addContext").elements.container.addClassName("disabled")),n.getDialog().options.limitParent=!0,n.getDialog().setNewBodySize(window.widget.body.getSize()),document.getElementsByClassName("floatingPanel_RightButtons")[0]&&document.getElementsByClassName("floatingPanel_RightButtons")[0].setStyle("display","none"),document.getElementsByClassName("isu-am-catalog-placeholder-button btn-primary btn btn-root")[0]&&document.getElementsByClassName("isu-am-catalog-placeholder-button btn-primary btn btn-root")[0].setStyle("display","none")})}})).render(),c.isLoaded.finally(function(){g(c)})})})}})}),define("DS/IssueManagementWebInWin/MfgIssueManagement",["DS/IssueManagement/IssueManagement","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts"],function(e,t,n,a){"use strict";var s=null,i={SELECT_IN_3D:"SELECT_IN_3D",ADD_OBJECTS:"ADD_OBJECTS",TAKE_SCREENSHOT:"TAKE_SCREENSHOT"},o="ENXISSU_RC",r=/[/\\?%*:|"<>]/g,d=function(){dscef.sendString("Refresh=")},l={_tasks:{subscriberTokens:[],current:null},InitWebInWin:function(t){s=t;var n={};l._getWebInWinParameters(function(t){n=t||null,l._populate3DSpaceURL(n).then(function(t){var n=e.prototype.onResize;e.prototype.onResize=function(){var e=this;setTimeout(function(){n.call(e)},0)};new e({standalone:!0})},function(e){return console.log("Populate 3DSpace URL failed"),Promise.reject(e)})})},_getWebInWinParameters:function(e){window.COMPASS_CONFIG&&window.COMPASS_CONFIG.myAppsBaseUrl?e(window.COMPASS_CONFIG):l._getAppsUrl(function(t){window.COMPASS_CONFIG||(window.COMPASS_CONFIG={}),t&&(window.COMPASS_CONFIG.myAppsBaseUrl=t,window.COMPASS_CONFIG.userId||(window.COMPASS_CONFIG.userId=s),window.COMPASS_CONFIG.lang||(window.COMPASS_CONFIG.lang=widget.lang)),e(window.COMPASS_CONFIG)})},_getAppsUrl:function(e){"function"==typeof dscef.getMyAppsURL?dscef.getMyAppsURL().then(function(t){console.log("MyApps URL",t),e.call(null,t)}).catch(function(t){console.error("Failed to fetch MyApps URL: "+t),e.call(null,null)}):e.call(null,null)},_populate3DSpaceURL:function(e){return new Promise(function(n,a){var s=null;e&&((s={}).myAppsBaseUrl=e.myAppsBaseUrl,s.userId=e.userId,s.lang=e.lang),t.getPlatformServices({config:s,onComplete:function(e){for(var t=0;t<e.length;t++)console.log("platformId",e[t].platformId),console.log("3DSpace",e[t]["3DSpace"]),console.log("3DSearch",e[t]["3DSearch"]);n()},onFailure:a})})},subscribeToTasks:function(){var e=this;e._tasks.subscriberTokens.push(n.subscribe("DS/IssueManagementTask/add",function(e){var t=e.data.paths[0][0],a=e.data.attributes[t];if(-1!==Object.keys(i).indexOf(a.taskType)){var s=[],o={};s.push([t]),o[t]={taskType:a.taskType,widgetIdIM:a.widgetIdIM,widgetId3D:widget.id},n.publish("DS/IssueManagementTask/ready",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:s,attributes:o},version:"1.0"})}})),e._tasks.subscriberTokens.push(n.subscribe("DS/IssueManagementTask/exec",function(t){var n=t.data.paths[0][0],a=t.data.attributes[n];if(-1!==Object.keys(i).indexOf(a.taskType))switch(e._tasks.current={taskId:n,taskType:a.taskType,widgetIdIM:a.widgetIdIM,widgetId3D:widget.id},a.taskType){case i.SELECT_IN_3D:console.log("Executing Select in 3D, We have to call C++ from here"),dscef.sendString("SelectFrom3D=1");break;case i.ADD_OBJECTS:console.log("Executing Select From Search, We have to call C++ from here"),dscef.sendString("SelectFromSearch=1");break;case i.TAKE_SCREENSHOT:console.log("Executing Take Snapshot, We have to call C++ from here"),dscef.sendString("TakeScreenShot=1")}})),e._tasks.subscriberTokens.push(n.subscribe("DS/IssueManagementTask/cancel",function(t){console.log("Cancel Task triggered"),dscef.sendString("TaskCancelled=1");var n=a.get("component");null!==n&&n.unmaskForTask(e._tasks.current),e._tasks.current=null})),e._tasks.subscriberTokens.push(n.subscribe("DS/Object/select",function(t){if(t.metadata&&t.metadata.appName!==o&&t.data&&t.data.paths){var n="";t.data.paths.forEach(function(e){1==e.length&&(n+=e[0]+";")}),dscef.sendString("ObjectSelect="+n);var s=a.get("component");null!==s&&s.unmaskForTask(e._tasks.current),e._tasks.current=null}})),e._tasks.subscriberTokens.push(n.subscribe("DS/Object/delete",function(t){if(t.metadata&&t.metadata.appName!==o&&t.data&&t.data.paths){var n="";t.data.paths.forEach(function(e){1==e.length&&(n+=e[0]+";")}),dscef.sendString("ObjectDelete="+n);var s=a.get("component");null!==s&&s.unmaskForTask(e._tasks.current),e._tasks.current=null}})),e._tasks.subscriberTokens.push(n.subscribe("DS/Object/create",d)),e._tasks.subscriberTokens.push(n.subscribe("DS/Object/update",d))},SetSecurityContextAndTenant:function(e){e.tenantID&&widget.setValue("x3dPlatformId",e.tenantID),e.securityContext&&widget.setValue("pad_security_ctx","ctx::"+e.securityContext)},SelectFrom3DDone:function(e){var t=[],a={},s={nodes:[]};s.nodes.push("node"),s.paths=e;var i={};i[e]={x:0,y:0,z:0,balloons:[]},t.push([this._tasks.current.taskId]),a[this._tasks.current.taskId]={taskType:this._tasks.current.taskType,widgetIdIM:this._tasks.current.widgetIdIM,widgetId3D:this._tasks.current.widgetId3D,response:{target:e,positions:i,nodes:s}},n.publish("DS/IssueManagementTask/done",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:t,attributes:a},version:"1.0"})},SelectFromSearchDone:function(e){for(var t=e.split(","),a=[],s=0;s<t.length;s++)a.push(t[s]);var i=[],o={};i.push([this._tasks.current.taskId]),o[this._tasks.current.taskId]={taskType:this._tasks.current.taskType,widgetIdIM:this._tasks.current.widgetIdIM,widgetId3D:this._tasks.current.widgetId3D,response:{physicalIds:a}},n.publish("DS/IssueManagementTask/done",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:i,attributes:o},version:"1.0"})},ScreenShotCaptured:function(e){var t=e,a=(new Date).toLocaleString(),s="screenshot_"+(a=a.replace(r,"-"))+".png",i=Date.now(),o=[],d={};o.push([this._tasks.current.taskId]),d[this._tasks.current.taskId]={taskType:this._tasks.current.taskType,widgetIdIM:this._tasks.current.widgetIdIM,widgetId3D:this._tasks.current.widgetId3D,response:{data:t,fileName:s,fileType:"image/png",lastModified:i}},n.publish("DS/IssueManagementTask/done",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:o,attributes:d},version:"1.0"})},SelectIssues:function(e){var t={},a=[];e.forEach(function(e){a.push([e]),t[e]={id:e,type:"Issue"}});var s={metadata:{appName:o},data:{paths:a,attributes:t},version:"1.0"};n.publish("DS/Object/select",s)}};return l}),define("DS/IssueManagementWebInWin/ENOIssueGenerationPanel",["UWA/Core","UWA/Class","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueComponents/create/Create","DS/PlatformAPI/PlatformAPI"],function(e,t,n,a,s,i){"use strict";return t.extend({init:function(o){n.initPlatformServices().then(function(){var r,d,l,c;(r=o.contexts?o.contexts.map(function(e){return{physicalId:e}}):[],d=o.reportedAgainst?o.reportedAgainst.map(function(e){return{physicalId:e,automation:{assignee:!o.assignees}}}):[],l=o.attachments?o.attachments:[],c={id:"Ext_GenereateIssue",info:{description:null,name:null},ui:{assignees:[],responsibleOrganization:n.getCurrentCredentials().organization},data:{title:o.title,description:o.description,priority:void 0===o.priority?"Low":o.priority,resolutionDate:Date.now(),reportedAgainst:d,contexts:r,assignees:[],attachments:l,automationTasks:[],responsibleOrganization:n.getCurrentCredentials().organization,reportingOrganization:n.getCurrentCredentials().organization}},new Promise(function(t){if(o.assignees&&o.assignees.length>=1){var a=[],s=o.assignees.length;o.assignees.forEach(function(i){n.getUserInfo(i,{onComplete:function(n){var i=JSON.parse(n);c.data.assignees.push(i.name),a.push({user:i.name,fullName:i.firstname+" "+i.lastname,organization:i.company.name}),0==--s&&(c.ui.assignees=e.merge({},a),t())},onFailure:function(){0==--s&&t()}})})}else t()}).then(function(){return c})).then(function(e){a.add("widget",window.widget),a.get("widget").name="ENOIssueGenerationPanel";var n=new s(window.widget.body,{escapeToClose:!1,resizable:!1});n.render(),n.isLoaded.finally(function(){var a;n.applyTemplate(e),(a=n).getDialog().addEvent("onResizeFloating",function(){var e=a.getDialog().elements.container.getSize();e.width===window.widget.body.getSize().width&&e.height===window.widget.body.getSize().height||(a.getDialog().setNewBodySize(window.widget.body.getSize()),a.getDialog().centerIt())}),(new t.Listener).listenToOnce(a,"onCreateDialogClose",function(){window.dscef.sendString(JSON.stringify({action:"closePanel"}))}),i.subscribe("DS/Object/create",function(){window.dscef.sendString(JSON.stringify({action:"displayNotif",notifMsg:"IssueSuccess"}))}),function(e){"attachments"in e.views&&(e.views.attachments.view.fields.attachments.iconBar.disableItem("attachFrom3DX"),e.views.attachments.view.fields.attachments.iconBar.disableItem("screenshot")),"related"in e.views&&(e.views.related.view.fields.reportedAgainst.iconBar.getItem("location").elements.container.addClassName("disabled"),e.views.related.view.fields.contexts.iconBar.getItem("location").elements.container.addClassName("disabled"),e.views.related.view.fields.reportedAgainst.iconBar.getItem("addReported").elements.container.addClassName("disabled"),e.views.related.view.fields.contexts.iconBar.getItem("addContext").elements.container.addClassName("disabled")),e.getDialog().options.limitParent=!0,e.getDialog().setNewBodySize(window.widget.body.getSize()),document.getElementsByClassName("floatingPanel_RightButtons")[0]&&document.getElementsByClassName("floatingPanel_RightButtons")[0].setStyle("display","none"),document.getElementsByClassName("isu-am-catalog-placeholder-button btn-primary btn btn-root")[0]&&document.getElementsByClassName("isu-am-catalog-placeholder-button btn-primary btn btn-root")[0].setStyle("display","none")}(n)})})})}})}),define("DS/IssueManagementWebInWin/ENOIssueGenerationWebPanel",["UWA/Core","UWA/Class","DS/IssueServices/services/PlatformServices","DS/IssueComponents/create/Create"],function(e,t,n,a){"use strict";return t.extend({init:function(s,i){var o,r,d,l,c=s,u=null,p=i||s.data,g=s.onClose,m=c.htmlContainer||window.widget.body;this.hide=this.hideIssuePanel=function(){u&&u.getDialog().hide()},this.show=this.showIssuePanel=function(){u&&u.getDialog().show()},this.destroy=this.destroyIssuePanel=function(){u&&u.getDialog().destroy()},(o=p.contexts?p.contexts.map(function(e){return{physicalId:e}}):[],r=p.reportedAgainst?p.reportedAgainst.map(function(e){return{physicalId:e,automation:{assignee:!p.assignees}}}):[],d=p.attachments?p.attachments:[],l={id:"Ext_GenereateIssue",data:{title:p.title,description:p.description,priority:p.priority,reportedAgainst:r,contexts:o,assignees:p.assignees,attachments:d}},new Promise(function(t){if(p.assignees&&p.assignees.length>0){var a=[],s=p.assignees.length;l.ui={assignees:[]},p.assignees.forEach(function(i){n.getUserInfo(i,{onComplete:function(n){var i=JSON.parse(n);l.data.assignees.push(i.name),a.push({user:i.name,fullName:i.firstname+" "+i.lastname,organization:i.company.name}),0==--s&&(l.ui.assignees=e.merge({},a),t())},onFailure:function(){0==--s&&t()}})})}else t()}).then(function(){return l})).then(function(e){(u=new a(m,{escapeToClose:!1,resizable:!0})).render(),u.isLoaded.finally(function(){var n;u.applyTemplate(e),n=u,(new t.Listener).listenToOnce(n,"onCreateDialogClose",function(){g?g():c.end()}),function(e){"attachments"in e.views&&e.views.attachments.view.fields.attachments.iconBar.disableItem("screenshot"),"related"in e.views&&(e.views.related.view.fields.reportedAgainst.iconBar.getItem("location").elements.container.addClassName("disabled"),e.views.related.view.fields.contexts.iconBar.getItem("location").elements.container.addClassName("disabled")),e.getDialog().options.limitParent=!0}(u)})})}})}),define("DS/IssueManagementWebInWin/ENOIssueFromTemplateGenerationWebPanel",["UWA/Core","UWA/Class","DS/IssueServices/services/PlatformServices","DS/IssueComponents/create/Create","DS/IssueComponents/templates/Templates"],function(e,t,n,a,s){"use strict";return t.extend({init:function(i,o){var r=i,d=null,l=null,c=null,u=o||i.data,p=i.onClose,g=r.htmlContainer||window.widget.body;const m={Low:0,Medium:1,High:2,Urgent:3};function h(e){var n=new t.Listener;n.listenToOnce(e,"onCreateDialogClose",function(){p?p():r.end()}),n.listenToOnce(e,"onTemplatesDialogClose",function(){p?p():r.end()})}function f(e){var t=[],n=[];return e.forEach(e=>{n.includes(e.physicalId)||(t.push(e),n.push(e.physicalId))}),t}var w,I,S,y;this.hide=this.hideIssuePanel=function(){d&&d.getDialog().hide(),l&&d.getDialog().hide()},this.show=this.showIssuePanel=function(){d&&d.getDialog().show(),l&&l.getDialog().show()},this.destroy=this.destroyIssuePanel=function(){d&&d.getDialog().destroy(),l&&(l.destroy(),l=null)},(w=u.contexts?u.contexts.map(function(e){return{physicalId:e}}):[],I=u.reportedAgainst?u.reportedAgainst.map(function(e){return{physicalId:e,automation:{assignee:!u.assignees}}}):[],S=u.attachments?u.attachments:[],y={id:"Ext_GenereateIssue",data:{title:u.title,description:u.description,priority:u.priority,reportedAgainst:I,contexts:w,assignees:u.assignees,attachments:S}},new Promise(function(t){if(u.assignees&&u.assignees.length>0){var a=[],s=u.assignees.length;y.ui={assignees:[]},u.assignees.forEach(function(i){n.getUserInfo(i,{onComplete:function(n){var i=JSON.parse(n);y.data.assignees.push(i.name),a.push({user:i.name,fullName:i.firstname+" "+i.lastname,organization:i.company.name}),0==--s&&(y.ui.assignees=e.merge({},a),t())},onFailure:function(){0==--s&&t()}})})}else t()}).then(function(){return y})).then(function(e){(l=new s(g,{editMode:!1,onClose:function(){},onEnd:function(t){c=t,(d=new a(g,{escapeToClose:!1,resizable:!0})).render(),d.isLoaded.finally(function(){var t,n,a;if(c.hidden.contexts||(c.data.contexts.push(...e.data.contexts),c.data.contexts=f(c.data.contexts)),c.hidden.reportedAgainst||(c.data.reportedAgainst.push(...e.data.reportedAgainst),c.data.reportedAgainst=f(c.data.reportedAgainst)),c.hidden.attachments||(c.data.attachments.push(...e.data.attachments),c.data.attachments=(t=c.data.attachments,n=[],t.forEach(e=>{n.includes(e)||n.push(e)}),n)),""==c.data.title&&""!=e.data.title&&(c.data.title=e.data.title),c.hidden.description||""!=c.data.description||""==e.data.description||(c.data.description=e.data.description),c.hidden.resolutionRecommendation||""!=c.data.resolutionRecommendation||""==e.data.resolutionRecommendation||(c.data.resolutionRecommendation=e.data.resolutionRecommendation),!c.hidden.priority){let t=function(e,t){let n=m[e],a=m[t],s="";return s=null==t?e:n>a?e:t}(c.data.priority,e.data.priority);c.data.priority=t}d.applyTemplate(c),h(d),"attachments"in(a=d).views&&a.views.attachments.view.fields.attachments.iconBar.disableItem("screenshot"),"related"in a.views&&(a.views.related.view.fields.reportedAgainst.iconBar.getItem("location").elements.container.addClassName("disabled"),a.views.related.view.fields.contexts.iconBar.getItem("location").elements.container.addClassName("disabled")),a.getDialog().options.limitParent=!0})}})).render(),l.isLoaded.finally(function(){h(l)})})}})});