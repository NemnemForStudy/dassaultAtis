/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/CAT3DComposeDirectMove/CAT3DComposeDirectMove",["UWA/Core","UWA/Class","DS/Selection/HSOManager","DS/Selection/CSOManager","DS/CATW3DGeometry/CATW3DEquivalentGeometry","DS/Manipulators/ScreenPlaneManipulator","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/SceneGraphNodes/AxisSystemNode","DS/CATW3DConstraints/CATW3DConstraintsController","DS/CATW3DUtils/CATW3DUtils","DS/CATW3DAnims/CATW3DAnimation3D","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/CAT3DComposeUI/CAT3DComposeWidgetOptions","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/CATW3DMoveManager/CATW3DMoveReferent","DS/CATW3DMoveManager/CATW3DMoveManager","DS/Visualization/IdPath","DS/CoreEvents/ModelEvents","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/SceneGraphUtils","DS/CATW3DGeometry/CATW3DGeometryEnums","DS/ApplicationFrame/CommandsManager","css!DS/CAT3DComposeUI/CAT3DComposeUI.css"],function(e,t,n,i,a,o,r,l,s,c,p,u,m,v,d,h,f,E,g,y,M,x,C,D){"use strict";var b,T=t.extend({init:function(){var t,b,T=!1,S=null,A=null,P=null,w=this,I={},W=[],G="",R=!0,O=!1,V=null,N=null,L={},F=3394815,k=!1,q={},B=[],H=null,j=null,U=null,_=null,K=null,z=null,X=null,Y=!d.getOption("animationOff"),J=!1,Q={},Z=!1,$=null,ee=!1,te=null,ne=null,ie=new y,ae=function(){var e=t.getRootBagPath();return e?e.getLastElement(!0):null},oe=function(e){return t.getRootBagPath().isAParentOf(e)},re=new l("LocalAxisSystemNode");re.exludeFromBounding(!0),re.setVisibilityInTree(!1),re.setPickable(s.PICKTHROUGH),re.setVisibility(!1),re.setVisibilityFree(!0),re.updateDisplay=function(e){0===re.parents.length&&P.addNode(re),e.visibility&&e.pathElement&&re.pathElement!==e.pathElement&&(re.pathElement=e.pathElement,re.setMatrix(e.pathElement.getWorldMatrix()),re.setVisibility(!0)),e.visibility||(re.pathElement=null,re.setVisibility(!1))};var le=new l("MovePrevisuNode");le.exludeFromBounding(!0),le.setVisibilityFree(!0),le.setVisibilityInTree(!1),le.setPickable(s.PICKTHROUGH),le.setNoZ(!0),le.updateDisplay=function(e,t,n){0===le.parents.length&&P.addNode(le),le.removeChildren(),e&&e.equivalentGeometry&&e.equivalentGeometry.getPrevisuNode&&le.addChild(e.equivalentGeometry.getPrevisuNode(t,n))};var se=function(e){if(e.color){var t=new r.MeshBasicMaterial({side:2,forceSide:!0,color:e.color,transparent:!0,depthWrite:!1,depthTest:!1,opacity:.6,overridable:!1});x.applyMaterialToPath(e.path,t)}else x.applyMaterialToPath(e.path,null)},ce=function(e){e.objectToMove.override.setColor("#FFFFFF",!1);var t=function(t){e.objectToMove&&X&&!Z&&t&&P.render()},n=S.isPathLocked({pathElement:e.objectToMove.path,onCompleted:function(e){Q.isRunning()||t(e.isLocked)}});0===n.returnCode&&n.hasOwnProperty("isLocked")&&(t(n.isLocked),t=function(){})};function pe(){X&&P.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(X),X=null,H=null,T=!1,I={},k=!1,q={},N=null,L={},G="",B=[],W.forEach(function(e){e.lockedID&&t.getController().unlockNodes({ids:[e.lockedID]})}),W=[],Z=!1,Y&&(J=!1,ee=!1)}var ue,me=function(){if(X&&P.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(X),X=null,k)B.forEach(function(e){e.path&&n.add({pathElement:e.path})}),S.onMoveEnd({from:w,status:G}),"Moved"===G&&i.get().some(function(e){if(e.pathElement.isEqual(I.pathElement))return e.position=I.beginPosLocal.clone().applyMatrix4(I.pathElement.getWorldMatrix()),!0}),V&&(V.simulateReverseDirection(I.pathElement)||V.getAxisTypeIfCstOnProductAxis(I.pathElement))&&t.getFrameWindow().getContextualUIManager().showContextualBar({hideWithDistance:!0});else if(I.pathElement&&!q.partIsInCSO){var e=I.pathElement;i.add({pathElement:e,event:I.beginEvent,position:I.beginPosLocal.clone().applyMatrix4(e.getWorldMatrix())}),t.getFrameWindow().getContextualUIManager().showContextualBar({hideWithDistance:!0})}pe(),ie.publish({event:"onDirectMoveEnd"})},ve={panInterval:void 0,viewpoint:void 0,panDuration:100,x:void 0,y:void 0},de=function(){ve.panInterval&&clearInterval(ve.panInterval),ve.panInterval=void 0,ve.viewpoint=void 0,ve.x=void 0,ve.y=void 0,ve.div=ve.div?ve.div.destroy():void 0,ve.divL=ve.divT=ve.divR=ve.divB=void 0},he=function(n){function i(){if(ve.viewpoint||(ve.viewpoint=P.currentViewpoint),ve.viewpoint&&ve.viewpoint.control&&void 0!==ve.x&&void 0!==ve.y){var n,i,a=new r.Vector3(ve.x,ve.y,0);if(a.applyQuaternion(ve.viewpoint.control.orientation),a.setLength(.05*ve.viewpoint.control.distanceToTarget),n=ve.viewpoint.target.clone().add(a),i=ve.viewpoint.control.distanceToTarget,ve.viewpoint.moveTo({eyePosition:n.add(ve.viewpoint.getCamera().getLookAt().normalize().multiplyScalar(-i)),duration:Y?ve.panDuration:0}),!ve.div){var o=t.getFrameWindow().getUIFrame();ve.div=e.createElement("div",{id:"C3D-viewpoint",styles:{top:P.SCREEN_HEIGHT/2+"px",left:P.SCREEN_WIDTH/2+"px"}}).inject(o);var l=function(t){var n=e.createElement("div",{class:t.side}).inject(ve.div);n.setStyle(t.posKey,t.posValue+"px");var i=e.createElement("div",{class:"arrow"}).inject(n);return e.createElement("div",{class:"borderBottom"}).inject(i),e.createElement("div",{class:"borderRight"}).inject(i),n},s=Math.min(P.SCREEN_WIDTH/10,P.SCREEN_HEIGHT/10);ve.divL=l({side:"left",posKey:"left",posValue:-s}),ve.divT=l({side:"top",posKey:"top",posValue:-s}),ve.divR=l({side:"right",posKey:"left",posValue:s}),ve.divB=l({side:"bottom",posKey:"top",posValue:s})}ve.x<0?ve.divL.addClassName("active"):ve.divL.removeClassName("active"),ve.x>0?ve.divR.addClassName("active"):ve.divR.removeClassName("active"),ve.y<0?ve.divB.addClassName("active"):ve.divB.removeClassName("active"),ve.y>0?ve.divT.addClassName("active"):ve.divT.removeClassName("active")}}var a=(n.event.gesture?n.event.gesture.getEvents()[0]:n.event.from[0]).getCurrentPosition(t.getViewer().canvas);return ve.x=a.x<=9?-1:a.x>=P.SCREEN_WIDTH-10-1?1:0,ve.y=a.y<=9?1:a.y>=P.SCREEN_HEIGHT-10-1?-1:0,0===ve.x&&ve.y?ve.x=a.x<P.SCREEN_WIDTH/3?-1:a.x>2*P.SCREEN_WIDTH/3?1:0:0===ve.y&&ve.x&&(ve.y=a.y<P.SCREEN_HEIGHT/3?1:a.y>2*P.SCREEN_HEIGHT/3?-1:0),ve.x||ve.y?(clearInterval(ve.panInterval),ve.panInterval=setInterval(function(){i()},ve.panDuration),i(),1):(de(),0)};function fe(e){if(b&&b.cancel&&b.cancel(),b=null,de(),e&&!R?(R=!1,G="Moved"):G="Cancelled",re&&re.updateDisplay({visibility:!1}),k)if(Y){if($&&(clearTimeout($),$=null),Q.forward(),Q.addAnimation({animationType:"opacityOff",objectListToAnimate:W,callBackFct:function(){W.forEach(function(e){e.override.setColor(null,!1)}),I.equivalentGeometry&&se({path:I.pathElement})}}),"Cancelled"===G){var a=P.getSceneGraphOverrideSetManager();W.forEach(function(e){e.currentMatrix=a.computeAppliedPosition(e.path)}),Q.addAnimation({animationType:"cancel",objectListToAnimate:W,callBackFct:function(){me()}})}else Z?me():J?ee=!0:(ee=!0,Q.addAnimation({animationType:"snap",objectListToAnimate:W,callBackFct:function(){Z=!0,$=!1,ee&&me()}}));Q.startAnimation()}else me();else B.forEach(function(a){if(a.path)if(a.path.isEqual(I.pathElement))if(q.partIsInCSO)if(T)i.remove({pathElement:I.pathElement,event:e.event}),n.remove({pathElement:I.pathElement});else{var o=I.pathElement;i.remove({pathElement:o}),i.add({pathElement:o,event:I.beginEvent,position:I.beginPosLocal.clone().applyMatrix4(o.getWorldMatrix())}),t.getFrameWindow().getContextualUIManager().showContextualBar({hideWithDistance:!0})}else n.add({pathElement:I.pathElement});else a.path.isAParentOf(I.pathElement)&&T&&q.partIsInCSO&&(i.remove({pathElement:I.pathElement,event:e.event}),n.remove({pathElement:I.pathElement}))}),me();P.render()}function Ee(){de(),te&&(S.unsubscribe(te),te=null),ne&&(S.unsubscribe(ne),ne=null),j&&(j.unsubscribe(_),j.unsubscribe(K),j.unsubscribe(z),j.unlink(U),j=_=K=z=U=null),re&&re.removeChildren(),le&&le.removeChildren()}this.activate=function(e){t=e.context,ue=!0,function(e,l){if(ue&&!j){var s=t.getFrameWindow();if(S=E.giveMoveManager({context:t}),A=f.getMoveReferentManager({context:t}),V||(V=p.getConstraintsController({context:t})),te=S?S.subscribe("onValidateMove",function(){V&&V.deleteAllCst()}):null,ne=S?S.subscribe("onCancelMove",function(e){V&&e.objectsCancelled.some(function(e){return V.isLevelConstrained(e.path)})&&V.deleteAllCst()}):null,s)if(S)if(A){if(P=s.getViewer(),Q=m.getAnimation3DEngine({viewer:P}),(j=new o).setDynamic(!0),j.setPrePickingDuringManipulation(!0),j.setPreActivationDuringManipulation(!0),j.setPickingDuringManipulation(!0),j.setExclusive(!0),U=j.linkToNode(ae()),j.HandleLongHold=function(){return pe(),!0},_=j.subscribe("BeginManipulate",function(e){if(!Q.isRunning()){var o,s=t.getController(),c=s.getRootBagId();if(X=new M(s.getRootBag(),c),P.getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(X),P.setCursor("pointer"),T=e.event.gesture.events[0].event.ctrlKey,I={},l&&l.isActive())o=P.pick(P.getMousePosition(e.event.from[0].currentPosition),"primHybrid",!1),(I=l.filterPath({pathElement:o.path[0]})).pathReferent=A.getMoveReferent(o.path[0]);else{var p=v.giveSelectionManager({context:t});p&&((o=P.pick(P.getMousePosition(e.event.from[0].currentPosition),p.getPicking()?"mesh":"primHybrid",!1)).path[0]=p.getTruncatedPath(o.path[0]),I.pathElement=o.path[0],I.pathReferent=A.getMoveReferent(o.path[0]),I.equivalentGeometry=a.getEquivalentGeometry({pathElement:o.path[0],viewer:P,nonCanonicGeometry:!0}))}I.pathElement&&(I.beginEvent=e.event,I.beginPosLocal=e.position.clone().applyMatrix4((new r.Matrix4).getInverse(I.pathElement.getWorldMatrix())),B.push({path:I.pathElement}),e&&e.event&&e.event.from&&e.event.from&&e.event.from.length&&"Touch"!==e.event.from[0].type&&i.get().slice(0).forEach(function(t){t.pathElement&&(t.pathElement.isEqual(I.pathElement)?q.partIsInCSO=!0:T?(t.pathElement.isAParentOf(I.pathElement)&&(q.fatherIsInCSO=!0),B.push({path:t.pathElement})):(i.remove({pathElement:t.pathElement,event:e.event}),n.remove({pathElement:t.pathElement})))}),B.forEach(function(e){if(e.path){var n,i=W.slice(0).some(function(t){if(t.path&&(!t.path.isEqual(e.path)&&t.path.isAParentOf(e.path)||!oe(e.path)))return!0});if(!O){var a=D.getCommand("CAT3DComposeMoveHdr",t.getCommandContext());a&&!a.isRunning()&&(i=!0)}if(i||!(n=A.getMoveReferent(e.path)))return;for(var o,r=n.externalPath.map(function(e){return h.getNodeID(e)}).filter(function(e){return e}),l=e.path.externalPath.length-1;l>0;--l)if(h.isRepReference(e.path.externalPath[l])){o=h.getNodeID(e.path.externalPath[l]);break}o&&s.lockNodes({ids:[o]}),r.unshift(c),W.push({path:n,lockedID:o,override:X.createIdPathOverride({idPathes:[new g(r)]}),initWorldMatrix:n.getWorldMatrix(),initMatrix:n.getLastElement(!0).getMatrix(),selectionWorldMatrix:I.pathElement.getWorldMatrix(),isAxisSystem:I.pathElement.externalPath.some(function(e){return"AxisSystems"===e.name})})}}))}}),K=j.subscribe("Manipulate",function o(s,c){if(b&&b.cancel&&b.cancel(),b=null,!Q.isRunning()&&(P.setCursor("pointer"),!s.event.from[0].currentPosition.equals(s.event.from[0].lastPosition)&&W.length)){var p=e?s.intersection.path[0]:null;if(!k){if(s&&s.event&&s.event.from&&s.event.from&&s.event.from.length&&"Touch"===s.event.from[0].type&&i.get().slice(0).forEach(function(e){e.pathElement&&(e.pathElement.isEqual(I.pathElement)?q.partIsInCSO=!0:T?(e.pathElement.isAParentOf(I.pathElement)&&(q.fatherIsInCSO=!0),B.push({path:e.pathElement})):(i.remove({pathElement:e.pathElement,event:s.event}),n.remove({pathElement:e.pathElement})))}),ie.publish({event:"onDirectMoveBegin"}),!q.partIsInCSO){var m=I.pathElement;i.add({pathElement:m,event:I.beginEvent,position:I.beginPosLocal.clone().applyMatrix4(m.getWorldMatrix())})}B.forEach(function(e){e.path&&n.remove({pathElement:e.path})}),S.onMoveBegin({objectsMoved:W,from:w,moveMode:"Transient"}),W.forEach(function(e){e.path&&e.override.setPickability("IGNORED")}),P.render(),I.equivalentGeometry||(I.equivalentGeometry=a.getEquivalentGeometry({pathElement:I.pathReferent,axis:V.getProductAxisForConstraint(),viewer:P})),Y?(Q.addAnimation({animationType:"opacityOn",objectListToAnimate:W,callBackFct:function(){I.equivalentGeometry&&I.equivalentGeometry.getMode()===C.GeometryMode.REAL&&se({path:I.pathElement,color:F}),W.forEach(function(e){e.path&&ce({objectToMove:e})})}}),Q.startAnimation()):(I.equivalentGeometry&&I.equivalentGeometry.getMode()===C.GeometryMode.REAL&&se({path:I.pathElement,color:F}),W.forEach(function(e){e.path&&(e.override.setOpacity(.35,!1),ce({objectToMove:e}))})),V&&(V.count()>0&&!I.equivalentGeometry||V.count()>0&&!V.isLevelConstrained(I.pathReferent))&&V.deleteAllCst(),k=!0}if(!he({event:s.event})){var v=e?P.pick(P.getMousePosition(s.event.from[0].currentPosition),"primHybrid",!1):{path:[]};v.path[0]&&!h.isAModelPath(v.path[0])&&(v.path[0]=null);var d={pathElement:v.path[0]};!(b=u.switchToAV1withMesh({pathElement:d.pathElement,pad3DViewer:t,selectionFilter:l?l.getFiltersState():null,onComplete:function(){o(s,!0),b=null},onFailure:function(){b=null}}))||"filtered"!==b.status&&"done"!==b.status||(b=null),l&&l.filterPath(d);var f=!1;d.pathElement&&L.pathElement&&(f=L.pathElement.isEqual(d.pathElement)),L=d,N&&!f&&(V.deleteLastCst(),N=null);var E={},g=null,y=null;if(d.pathElement&&p&&!I.pathReferent.isAParentOf(p)){var M=I.equivalentGeometry&&I.equivalentGeometry.getType(),x=d.equivalentGeometry&&d.equivalentGeometry.getType();if(g=M&&M!==C.GeometryType.AXISSYSTEM&&M!==C.GeometryType.SURFACE,y=x&&x!==C.GeometryType.AXISSYSTEM&&x!==C.GeometryType.SURFACE,d.pathElement&&!I.pathReferent.isAParentOf(d.pathElement)&&y&&g){if(!f){N=V.createCst({movable:I,fixed:d});var D=V.simulateSolveCst();if(D){var A=D.matrix;E.rc=D.rc,E.redundancy=D.redundancy,0===E.rc&&A&&!E.redundancy?E.matrix=A.multiply(I.pathReferent.getWorldMatrix()):(0!==E.rc||E.redundancy)&&(V.deleteLastCst(),N=null),L=d}else L={}}}else d&&d.pathElement&&(E.matrix=d.pathElement.getWorldMatrix(),d.pathElement.externalPath.some(function(e){return"AxisSystems"===e.name})?(E.isAxisSystem=!0,re.updateDisplay({visibility:!1})):re.updateDisplay({pathElement:d.pathElement,visibility:!0}))}if(E.matrix){var G;if(E.isAxisSystem&&W[0].isAxisSystem){var O=(new r.Matrix4).copy(E.matrix);O.multiply((new r.Matrix4).getInverse(W[0].selectionWorldMatrix)),O.multiply(W[0].initWorldMatrix),G=(new r.Matrix4).getInverse(W[0].initWorldMatrix).multiply(O)}else(G=(new r.Matrix4).getInverse(W[0].initWorldMatrix).multiply(E.matrix)).multiply((new r.Matrix4).getInverse(I.pathElement.getLastElement(!0).getMatrix()));W.forEach(function(e,t){var n=(new r.Matrix4).copy(e.initWorldMatrix).multiply(G);if(e.path){var i=(new r.Matrix4).getInverse(e.path.getParentPath().getWorldMatrix()),a=(new r.Matrix4).copy(i).multiply(n),o=null;e.snappedPosition&&(o=(new r.Matrix4).copy(e.snappedPosition));var l=o&&o.equals(a);if(e.snappedPosition=(new r.Matrix4).copy(a),Y){var p=(new r.Matrix4).copy(e.initWorldMatrix),u=(new r.Vector3).getPositionFromMatrix(e.initWorldMatrix).add(s.translationVector);p.setPosition(u);var m=(new r.Matrix4).copy(i).multiply(p);Z?l||(e.currentPosition=a):(e.currentPosition=(new r.Matrix4).copy(m),(V&&V.count()<=1&&y&&g||!y&&!g||y&&!g)&&e.override.setPosition(m)),0===t&&(e.snappedTarget=d.pathElement,l||!d.pathElement||e.snappedTarget.isEqual(d.pathElement)||(clearTimeout($),$=null),$||l&&Z||b||($=setTimeout(function(){Q.addAnimation({animationType:"snap",objectListToAnimate:W,callBackFct:function(){Z=!0,$=null,ee&&me()}}),Q.addAnimation({animationType:"opacityOff",offsetTime:Q.getDefaultDuration("snap"),objectListToAnimate:W,callBackFct:function(){W.forEach(function(e){e.override.setColor(null,!1)}),I.equivalentGeometry&&se({path:I.pathElement})}}),Q.startAnimation()},c?0:500)))}else e.override.setPosition(a),Z=!0}}),R=!1,S.onMove({objectsMoved:W,transformation:G,from:w})}else if(re&&re.updateDisplay({visibility:!1}),void 0===d.pathElement||null===d.pathElement||E.rc&&0!==E.rc||E.redundancy?(R=!0,S.onMove({objectsMoved:W,vector:s.translationVector,from:w})):y&&g&&0===E.rc&&(R=!1),void 0!==d.pathElement||null!==d.pathElement){var U=null;W.forEach(function(e,t){if(e.path){var n=null;if(0===V.count()||1===V.count()&&N){var i=(new r.Matrix4).copy(e.initWorldMatrix),a=(new r.Vector3).getPositionFromMatrix(e.initWorldMatrix).add(s.translationVector);i.setPosition(a);var o=e.path.getParentPath().getWorldMatrix();n=(new r.Matrix4).getInverse(o).multiply(i),Z||e.override.setPosition(n),e.currentPosition=(new r.Matrix4).copy(n)}else{if(0===t){U=null,N&&V.deleteLastCst();var l=(new r.Vector3).addVectors(s.translationVector,j.initial3dIntersectionPoint),c=null;c=H?(new r.Vector3).subVectors(s.translationVector,H):s.translationVector,H=s.translationVector;var p=V.simulateMoveWithCst({movableReference:l,translation:c});p&&0===p.rc&&p.matrix&&(U=p.matrix.multiply(I.pathReferent.getWorldMatrix())),N&&V.restoreLastDeletedCst()}if(U){var u=(new r.Matrix4).getInverse(W[0].initWorldMatrix).multiply(U),m=(new r.Matrix4).copy(e.initWorldMatrix).multiply(u),v=(new r.Matrix4).getInverse(e.path.getParentPath().getWorldMatrix());n=(new r.Matrix4).copy(v).multiply(m),Z||e.override.setPosition(n)}e.currentPosition=(new r.Matrix4).copy(e.initMatrix)}}}),Y?f||($&&(clearTimeout($),$=null),Z&&R&&(Q.addAnimation({animationType:"unsnap",objectListToAnimate:W,callBackFct:function(){Z=!1,W.forEach(function(e){e.snappedPosition=null})}}),Q.addAnimation({animationType:"opacityOn",objectListToAnimate:W,offsetTime:Q.getDefaultDuration("unsnap"),callBackFct:function(){I.equivalentGeometry&&se({path:I.pathElement,color:F}),W.forEach(function(e){e.path&&ce({objectToMove:e})})}}),Q.startAnimation())):Z&&R&&(W.forEach(function(e){e.path&&e.currentPosition&&e.override.setPosition(e.currentPosition)}),Z=!1)}le.updateDisplay(d,s.intersection.position,s.intersection.normal),P.render()}}}),z=j.subscribe("EndManipulate",fe),0===re.getChildren().length){var d=new c({headLength:10,arrowLength:50,arrowWidth:2,head:c.types.ARROW});re.addChild(d)}re.updateDisplay({visibility:!1}),P.render({updateInfinitePlane:!0})}else window.console.log("A move referent component must be defined");else window.console.log("A move manager component must be defined");else window.console.log("A frame window must be defined")}}(e.withSnap,e.selectionFilter)},this.deactivate=function(){Ee(),ue=!1},this.unreference=function(){Ee(),V&&(V.deleteAllCst(),V.unreference()),re&&P.removeNode(re),re=null,le&&P.removeNode(le),le=null,t=null,ie=null,ue=!1},this.subscribe=function(e,t){return"onDirectMoveBegin"===e||"onDirectMoveEnd"===e?ie.subscribe({event:e},t):void 0},this.unsubscribe=function(e){return ie.unsubscribe(e)},this.setAllowManipulation=function(e){O=e}}});return t.singleton({init:function(){},activate:function(e){e&&e.context&&"ENOPAD3DViewer"===e.context.name&&(b||(b=new T),b.activate(e))},deactivate:function(e){e&&e.context&&"ENOPAD3DViewer"===e.context.name&&b&&b.deactivate()},unreference:function(e){e&&e.context&&"ENOPAD3DViewer"===e.context.name&&(b&&b.unreference(),b=null)},subscribe:function(e,t){return b?b.subscribe(e,t):null},unsubscribe:function(e){return b?b.unsubscribe(e):null},give:function(){return b}})});