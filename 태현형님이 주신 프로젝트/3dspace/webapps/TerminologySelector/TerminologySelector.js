define("DS/TerminologySelector/service/TerminologyWebService",["DS/IPClassifyActive/service/IPClassifyActiveWebService","text!DS/TerminologySelector/assets/Terminology_setting.json","DS/WidgetServices/WidgetServices","text!DS/TerminologySelector/assets/config/webservices.conf.json"],function(e,t,n,o){"use strict";var i=JSON.parse(o);const r=["VPMInstance","VPMReference"];var s=null;function a(){return new Promise(function(e,t){n.get3DSearchUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})}var l=Object.assign({},e);return l.attachTerminology=function(e){var t={};UWA.extend(t,e);var n=e.csrfValue,o=e.spaceUrl,r=e.attachTerm?i.attachTerm:i.attachTerminology,s=o+r.replace(new RegExp("{ID}","g"),e.terminologyID);return t.method="PATCH",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang"),SecurityContext:this.getSecurityContext(),ENO_CSRF_TOKEN:n},t.type="json",t.payload=[],e.itemsID.forEach(function(n){var i={identifier:n,relativePath:"/resources/v1/modeler/dseng/dseng:EngItem/"+n,type:e.isInstance?"VPMInstance":"VPMReference",source:o};t.payload.push(i)}),t.data=UWA.Json.encode(t.payload),this._executeRequest(s,t,"attachTerminologies")},l.attachTerminologies=function(e){var t=this;return UWA.extend({},e),t.get3DSpaceUrl().then(function(n){return new Promise(function(o,i){var r=n;t.createCSRFTokens({onComplete:function(n){var i=JSON.parse(n).csrf.value;e.onComplete=e.onComplete||function(){},e.onFailure=e.onFailure||function(){};var s={csrfValue:i,spaceUrl:r,terminologyID:"",itemsID:e.itemsID,isInstance:e.isInstance},a=[];e.terminologiesId&&e.terminologiesId.forEach(function(n,o){s.terminologyID=n,s.attachTerm=!1,a.push(new Promise(function(n,o){s.onComplete=function(t){e.onComplete.call(this,t),n(t)},s.onFailure=function(t){e.onFailure.call(this,t),o({error:t,id:s.terminologyID})},t.attachTerminology(s)}))}),e.termsId&&e.termsId.forEach(function(n,o){s.terminologyID=n,s.attachTerm=!0,a.push(new Promise(function(n,o){s.onComplete=function(t){e.onComplete.call(this,t),n(t)},s.onFailure=function(t){e.onFailure.call(this,t),o({error:t,id:s.terminologyID})},t.attachTerminology(s)}))}),o(Promise.allSettled(a))},onFailure:function(e){i(e)}},r)})})},l.detachTerminology=function(e){var t={};UWA.extend(t,e);var n=e.csrfValue,o=e.spaceUrl,r=e.detachTerm?i.detachTerm:i.detachTerminology,s=o+r.replace(new RegExp("{ID}","g"),e.terminologyID);return t.method="PATCH",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang"),SecurityContext:this.getSecurityContext(),ENO_CSRF_TOKEN:n},t.type="json",t.payload=[],e.itemsID.forEach(function(n){var i={identifier:n,relativePath:"/resources/v1/modeler/dseng/dseng:EngItem/"+n,type:e.isInstance?"VPMInstance":"VPMReference",source:o};t.payload.push(i)}),t.data=UWA.Json.encode(t.payload),this._executeRequest(s,t,"detachTerminologies")},l.detachTerminologies=function(e){var t=this;return UWA.extend({},e),t.get3DSpaceUrl().then(function(n){return new Promise(function(o,i){var r=n;t.createCSRFTokens({onComplete:function(n){var i=JSON.parse(n).csrf.value;e.onComplete=e.onComplete||function(){},e.onFailure=e.onFailure||function(){};var s={csrfValue:i,spaceUrl:r,terminologyID:"",itemsID:e.itemsID,isInstance:e.isInstance},a=[];e.terminologiesId&&e.terminologiesId.forEach(function(n,o){s.terminologyID=n,s.detachTerm=!1,a.push(new Promise(function(n,o){s.onComplete=function(t){e.onComplete.call(this,t),n(t)},s.onFailure=function(t){e.onFailure.call(this,t),o({error:t,id:s.terminologyID})},t.detachTerminology(s)}))}),e.termsId&&e.termsId.forEach(function(n,o){s.terminologyID=n,s.detachTerm=!0,a.push(new Promise(function(n,o){s.onComplete=function(t){e.onComplete.call(this,t),n(t)},s.onFailure=function(t){e.onFailure.call(this,t),o({error:t,id:s.terminologyID})},t.detachTerminology(s)}))}),o(Promise.allSettled(a))},onFailure:function(e){i(e)}},r)})})},l.getAssociatedTerminologies=function(e){var t=this,n={};UWA.extend(n,e);var o=e.isInstance;return t.get3DSpaceUrl().then(function(r){var s=r;t.createCSRFTokens({onComplete:function(r){var a=JSON.parse(r).csrf.value,l=o?i.locateTerm:i.locateTerminology,c=s+l;n.method="POST",n.headers={Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang"),SecurityContext:t.getSecurityContext(),ENO_CSRF_TOKEN:a},n.type="json",n.payload=[],e.itemsID.forEach(function(t){var o={identifier:t,relativePath:"/resources/v1/modeler/dseng/dseng:EngItem/"+t,type:e.isInstance?"VPMInstance":"VPMReference",source:s};n.payload.push(o)}),n.data=UWA.Json.encode(n.payload);t._executeRequest(c,n,"getAssociatedTerminologies")},onFailure:function(e){}},s)})},l.getSearchQuery=function(){return'type: "Terminology" AND [ds6w:status]: "Terminology.Released"'},l.getType_filter_bo=function(){return["Terminology","Term"]},l.generateSearchQuery=function(e,t){return'((type: "Terminology" AND [ds6w:status]: "Terminology.Released" ) OR type: "Term") AND (label: *'+e+"*)"+(t?' AND NOT physicalid: "'+t+'"':"")},l.getLabel=function(e){return"ActiveTerminology-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime()},l.getSpecific_source_parameter=function(e,t){return{"3dspace":{search_in_context:{expand:{root_physicalid:e,expand_iter:t?"-1":"1",type_filter_bo:["Term","Terminology"]}}}}},l.generateLabelQuery=function(e){return'(type: "Terminology" OR type: "Term") AND (physicalid:'+e+")"},l.getSetting=function(){return JSON.parse(t)},l.fetchObjectsForFindInTree=function(e){var t=[];if(t.push(a()),this.getSecurityContext()||t.push(this.initSecurityContext()),!UWA.is(e,"object"))throw new Error("Invalid inputs for TerminologyWebService.fetchObjectsForFindInTree");var n=this,o={};UWA.extend(o,e),Promise.allSettled(t).then(function(t){var i=t[0].value+"/search",r=widget.lang?widget.lang:widget.getValue("lang");o.payload={},o.payload.locale=r,e.searchFTSquery&&(o.payload.query="[ds6w:label]:(*"+e.searchFTSquery+"*)"),e.rscIdToSearch&&(o.payload.query="physicalid:"+e.rscIdToSearch),o.payload.select_bo=["physicalid","ds6w:type","ds6w:globalType","ds6w:label"],"TermSection_All"===e.type?o.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_path_physicalid:e.pid,type_filter_bo:["Terminology","Term"]}}}}:o.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:e.pid,type_filter_bo:["Terminology","Term"]}}}},o.payload.nresults=100,o.payload.source=["3dspace"],o.payload.login={"3dspace":{SecurityContext:n._securityContext}};var s=new Date,a=window.top.dsUserLogin?window.top.dsUserLogin:"unknown";return o.payload.label=("TerminologyFetchObjectsForFindInTree_"+a+"_"+s.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),o.timeout=12e4,o.method="POST",o.payload.tenant=n.getTenantID(),o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":r,SecurityContext:n.getSecurityContext()},o.type="json",o.data=UWA.Json.encode(o.payload),n._executeRequest(i,o,"_fetchObjectsForFindInTree")})},l.createCSRFTokens=function(e,t){var n=e,o=t+"/resources/v1/application/CSRF";n.method="GET",this._executeRequest(o,n,"TerminologyAssociation-createCSRFToken")},l.searchTerminologies=function(e){var t={};if(UWA.extend(t,e),!UWA.is(t,"object"))throw new Error("Invalid inputs for TerminologyWebService.searchTerminologies");var n=e.searchTerms?'type: "Term" AND [ds6w:status]: "Term.Released" ':'type: "Terminology" AND [ds6w:status]: "Terminology.Released"',o=this;a().then(function(i){var r=i+"/search",s=widget.lang?widget.lang:widget.getValue("lang");t.payload={with_nls:!1,with_indexing_date:!0,select_predicate:["ds6w:label","ds6w:created","ds6w:reservedBy","relcount","taxonomies","ds6w:classification","icon_2ddefaultthb.subtype","mxid","predicatename"],select_file:["icon","thumbnail_2d"],order_field:"ds6w:label",order_by:"asc",nresults:100},t.payload.locale=s,t.payload.query=n,t.payload.tenant=o.getTenantID(),t.payload.next_start=void 0,t.payload.start=void 0,t.payload.source=["3dspace"],t.payload.login={"3dspace":{SecurityContext:o.getSecurityContext()}},t.payload.label=o.getLabel(),null!=e.next_start?t.payload.next_start=e.next_start:t.payload.start=0,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":s},t.type="json",t.data=UWA.Json.encode(t.payload),t.withoutSC=!0,t.timeout=12e4,o._executeRequest(r,t,"searchTerminologies")})},l.expandV2Terms=function(e){var t={};UWA.extend(t,e);var n=this;return n.get3DSpaceUrl().then(function(o){var r=o+i.expandV2,s=widget.lang?widget.lang:widget.getValue("lang");t.payload={batch:{expands:[]},outputs:{format:"entity_relation",hits:{predefined_computation:["icons"]},select_object:["physicalid","ds6w:label","ds6w:type"],select_relation:["physicalid"]}};var a=[];e.physicalIds.forEach(function(e){var t={label:"terminology-expandv2-"+e,root:{physical_id:e},filter:{and:{filters:[{prefix_filter:{prefix_path:[{physical_id_path:[e]}]}},{and:{filters:[{sequence_filter:{sequence:[{uql:'(taxonomies:"types/Term" OR taxonomies:"types/Terminology") AND [ds6w:status]: "Terminology.Released"'}]}}]}}]}},graph:{descending_condition_object:{uql:'(taxonomies:"types/Term") OR (taxonomies:"types/Terminology")'}}};a.push(t)}),t.payload.batch.expands=a,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":s,SecurityContext:n.getSecurityContext(),SecurityToken:window.top.dsUserLogin+"|"+n.getSecurityContext()+"|preferred"},t.type="json",t.data=UWA.Json.encode(t.payload),n._executeRequest(r,t,"expandV2Terminologies")})},l.getTypeInfo=function(e){var t,n=this,o=n.get3DSpaceUrl().then(function(o){var r=o,s={};UWA.extend(s,e);var a=r+i.getTypeInfo;return s.method="POST",s.headers={Accept:"application/json","content-type":"application/json"},s.type="json",s.payload=e.types.slice(),s.data=UWA.Json.encode(s.payload),t=n._executeRequest(a,s,"getTypeInfo")});return o.cancel=function(){t&&t.cancel()},o},l.getSubTypesVPMRefInst=function(e){var t,n,o=this,i=new Promise(function(e,i){if(n=i,s)e(s);else{var a={};a.types=r,a.onComplete=function(t){s=Object.keys(t),e(s)},a.onFailure=function(){i()},t=o.getTypeInfo(a)}});return i.cancel=function(){t&&t.cancel(),n({error:"cancel"})},i},l.getObjectSecurityContext=function(){return{SecurityContext:this.getSecurityContext(),tenant:this.getTenantID()}},l.canBeAddedToBrowsingStructureOrNode=function(e){var t=this,n={};return UWA.extend(n,e),t.get3DSpaceUrl().then(function(o){var r=o;t.createCSRFTokens({onComplete:function(o){var s=JSON.parse(o).csrf.value,a=e.isBrowsingNode?i.canBeAddedToBrowsingNode:i.canBeAddedToBrowsingStructure,l=r+a;n.method="POST",n.headers={Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang"),SecurityContext:t.getSecurityContext(),ENO_CSRF_TOKEN:s},n.type="json",n.payload={objectIds:e.objectIds},n.data=UWA.Json.encode(n.payload);t._executeRequest(l,n,"canBeAddedToBrowsingStructure")},onFailure:function(e){}},r)})},l.canBeAddedToBrowsingStructure=function(e){var t=this;return new Promise(function(n,o){e.objectIds&&e.objectIds.length?t.canBeAddedToBrowsingStructureOrNode({onComplete:function(e){n(e)},onFailure:function(e){o(e)},objectIds:e.objectIds,isBrowsingNode:!1}):n()})},l.canBeAddedToBrowsingNode=function(e){var t=this;return new Promise(function(n,o){e.objectIds&&e.objectIds.length?t.canBeAddedToBrowsingStructureOrNode({onComplete:function(e){n(e)},onFailure:function(e){o(e)},objectIds:e.objectIds,isBrowsingNode:!0}):n()})},l}),define("DS/TerminologySelector/commands/TerminologyCtxMenuCommands",["i18n!DS/TerminologySelector/assets/nls/TerminologySelector","DS/WidgetServices/WidgetServices","DS/WebappsUtils/WebappsUtils"],function(e,t,n){"use strict";return{ExpandAllCmd:function(e,t){e.plmType;var n=[];"TREE"===t&&e&&n.push(e),n.length&&n.forEach(function(e){null===e.options.children||"TREE"!==t&&"Folder"!==e.plmType&&"TermSection_All"!==e.plmType||e.expand({expandLevel:"All"})})},CollapseAllCmd:function(e,t){e.plmType;var n=[];"TREE"===t&&e&&n.push(e),n.length&&n.forEach(function(e){e.collapseAll(),e.removeChildren()})},_addCtxCmd:function(e,t,n,o){var i=!1;!1!==n.spaceAvailability&&(i=!0),i&&(o&&("separator"!==o.type||t.length>0)&&t.push(o),t.push(n))},GetContextualMenuForTerminology:function(t,o){var i,r=this,s=[],a=!!t.white_Click&&t.white_Click;void 0===(i=!0===a?i=Folder_CSO.getCurrentFolder():t.nodeModel)&&(i=t);var l={label:e.CMDExpandAll,icon:"url("+n.getWebappsAssetUrl("IPClassifyNav","icons/32/I_ExpandAll.png")+")",callback:function(){r.ExpandAllCmd(i,o)},searchAvailability:!0},c={label:e.CMDCollapseAll,icon:"url("+n.getWebappsAssetUrl("IPClassifyNav","icons/32/I_CollapseAll.png")+")",callback:function(){r.CollapseAllCmd(i,o)},searchAvailability:!0};return this._addCtxCmd(o,s,l,{type:"separator"}),this._addCtxCmd(o,s,c),s}}}),define("DS/TerminologySelector/utils/TerminologyUtil",["DS/Notifications/NotificationsManagerUXMessages","DS/PlatformAPI/PlatformAPI","DS/Notifications/NotificationsManagerViewOnScreen"],function(e,t,n){var o=e;n.setNotificationManager(o);var i={sendPublicNotification:function(e,n,o){t.publish(e,n),o&&i.sendWebInWinNotification(e,n)},sendWebInWinNotification:function(e,t){window.dscef&&window.dscef.sendString(e,t||"")},searchNodesById:function(e,t){return e.search({match:function(e){if(t&&e.nodeModel.getID&&e.nodeModel.getID()&&-1!==e.nodeModel.getID().indexOf(t))return!0}})},getTerminologyParent:function(e){if(!e)return null;var t=e.getParent();return t&&"RootFolder"===t.getType()?t:this.getTerminologyParent(t)},compareArray:function(e,t){return e.length===t.length&&e.every(function(e){return t.includes(e)})},createDataForEventAssociationUpdate:function(e,t,n,o,i,r,s,a){var l={widgetID:widget.id,browsingStructures:{add:[],remove:[],referencesID:e||[]},browsingNodes:{add:[],remove:[],relationsID:t||[]}};function c(e,t,n){var o=[];return e&&e.forEach(function(e){var t=null;if("fulfilled"===e.status&&(t=e.value&&e.value.member?e.value.member[0]:null)){var i={};if(n){if(i.nodeID=t.id,i.nodeName=t.name,i.nodeTitle=t.title,s){var r=s(t.id);r&&(i.structureID=r.id,i.structureTitle=r.title,i.ds6w=r.predicatename)}}else i.structureID=t.id,i.structureTitle=t.title,i.structureName=t.name,i.ds6w=a(t.id);o.push(i)}}),o}return l.browsingStructures.add=c(n,!1,!1),l.browsingNodes.add=c(o,!1,!0),l.browsingStructures.remove=c(i,!0,!1),l.browsingNodes.remove=c(r,!0,!0),l}};return i}),define("DS/TerminologySelector/TerminologyAssociation/TerminologyAssociation",["DS/IPClassifyActive/IPClassifyActive","DS/TerminologySelector/service/TerminologyWebService","DS/TerminologySelector/utils/TerminologyUtil","DS/IPClassifyUtil/IPClassifyAlert","DS/PlatformAPI/PlatformAPI","i18n!DS/TerminologySelector/assets/nls/TerminologySelector","DS/WebappsUtils/WebappsUtils","DS/TerminologySelector/commands/TerminologyCtxMenuCommands","DS/Controls/Loader","DS/Controls/ModalContainer","DS/Controls/TooltipModel","text!DS/TerminologySelector/assets/Terminology_setting.json"],function(e,t,n,o,i,r,s,a,l,c,u,d){var m={iconName:"browsing-structure-root",fontIconFamily:1},g={iconName:"browsing-structure-node",fontIconFamily:1};return e.extend({name:"TerminologyAssociation",_rootNodeFavorite:null,_rootNodeFolders:null,_rootNodeTrash:null,_requestInfo:{},_searchKeys:{},_pathInfo:{},_subBookmarkExpand:{},_favoriteSection:null,_allSection:"TermSection_All",_findInTreeNLS:r,init:function(e){var i=this;this.items=e.items,this.isInstance=e.isInstance||!1,this.deactivateAssociate=e.deactivateAssociate||!1,this.alreadySelected=e.alreadySelected||null,this.mapRelationParentTerms=e.mapRelationParentTerms||null,e.dataProvider={},e.selectionMode="DefaultMulti",e.authoring=!1,e.dialogButtons=!0,e.favoriteButton=!1,e.hideFavorite=!0,e.multiSelectionComponent={withClassify:!1,launchDialog:!e.webinwin,NLS:r.multiSelectionComponent},e.popOverDialogProperties={modalFlag:!0},e.multiSelectionComponent.NLS.widget_name=i.isInstance?r.widget_name_associate_terms:r.widget_name_associate_terminologies,e.dataProvider.widgetDataProvider={getWidgetIcon:function(){return"browsing-structure-root-add-to"},getSettings:function(){return JSON.parse(d)},getAdditionalSearchAttributes:function(){return["predicatename"]}},this._parent(e),e.webinwin||this.nestedMenuInContext.popover.elements.container.addClassName("TerminologyAssociation"),this.nestedMenuInContext.nestedMenu._modelEvents.subscribeOnce({event:"onPostExpand:TermSection_All"},function(){i.initSelection()}),this.nestedMenuInContext._modelEvents.subscribe({event:"IPActive/NodeSelection/OnChange"},function(){var e=i.nestedMenuInContext.nestedMenu?i.nestedMenuInContext.nestedMenu._treeView:null,t=e?e.getTreeDocument():null;if(i.nestedMenuInContext._classifyButton.tooltipInfos=null,t){var o=[],s=[];if(t.getSelectedNodes().length<1)i.disableButtonAssociate(r.tooltip_selection_empty);else if(i.alreadySelected&&i.alreadySelected.length>0){n.compareArray(i.alreadySelected,t.getSelectedNodes().map(e=>e.getID()))&&i.disableButtonAssociate(r.tooltip_selection_no_changes)}t.getSelectedNodes().forEach(function(e){if(i.isInstance&&"Folder"!==e.getType()||!i.isInstance&&"RootFolder"!==e.getType())i.disableButtonAssociate(r.tooltip_selection_rows_invalid);else if("Folder"===e.getType()&&!(o.indexOf(e.id)>-1)){o.push(e.id);var t=n.getTerminologyParent(e);t&&(s.indexOf(t.id)>-1||s.push(t.id))}})}}),this.nestedMenuInContext.addEvent("select",function(e){var t=i.nestedMenuInContext.nestedMenu?i.nestedMenuInContext.nestedMenu._treeView:null,o=t?t.getTreeDocument():null;if("Folder"===e.getType()){var r=n.getTerminologyParent(e);r&&o.getSelectedNodes().forEach(function(t){if("Folder"===t.getType()&&t.id!==e.id){var o=n.getTerminologyParent(t);o&&o.id===r.id&&t.unselect()}})}}),this.nestedMenuInContext.addEvent("onClassifyMultiple",function(e){var s=i.nestedMenuInContext.nestedMenu?i.nestedMenuInContext.nestedMenu._treeView:null,a=s?s.getTreeDocument():null,u=i.nestedMenuInContext?i.nestedMenuInContext.getMultiSelectorContainer().getParent():null,d=new l;d.on(r.loading),c.createModal(u,d.elements.container);var m=[],g=[],p={},f={};e.chosenClasses.forEach(function(e,t){n.searchNodesById(a,e).forEach(function(e,t){if("RootFolder"!==e.getType()||g.indexOf(e.id)>-1){if("Folder"===e.getType()&&!(m.indexOf(e.id)>-1)){m.push(e.id),p[e.id]={title:e.getLabel()};var o=n.getTerminologyParent(e);o&&(f[e.id]={id:o.getID(),title:o.getLabel(),predicatename:o.options.predicatename})}}else g.push(e.id),p[e.id]={title:e.getLabel(),predicatename:e.options.predicatename}})});var h=i.items.map(function(e){return e.label}).filter(function(e){return e}),y=i.items.map(function(e){return e.id});i.dispatchEvent("associateTerminology",{terminologiesID:g,termsID:m}),i.deactivateAssociate?(d.off(),c.removeModal(u),i.nestedMenuInContext._classifyButton&&i._closePanel()):t.attachTerminologies({terminologiesId:g,termsId:m,itemsID:y,isInstance:i.isInstance,onComplete:function(e){var t="";t=this.isInstance?y.length>1?r.success_association_instances_term:r.success_association_instance_term:y.length>1?r.success_association_references_terminology:r.success_association_reference_terminology,t=r.replace(t,{items:h.length>0?h:"",terminology:p[this.terminologyID]?p[this.terminologyID].title:""}),o.displayNotification({title:r.association_success,message:t,className:"success"})},onFailure:function(e){var t="";t=this.isInstance?y.length>1?r.error_association_instances_term:r.error_association_instance_term:y.length>1?r.error_association_references_terminology:r.error_association_reference_terminology,t=r.replace(t,{items:h.length>0?h:"",terminology:p[this.terminologyID]?p[this.terminologyID].title:""}),o.displayNotification({title:r.association_error,message:t,className:"error"})}}).then(function(e){d.off(),c.removeModal(u);var t=i.isInstance?null:e,o=i.isInstance?e:null,r=i.isInstance?y:null,s=i.isInstance?null:y;let a=n.createDataForEventAssociationUpdate(s,r,t,o,null,null,function(e){return f[e]},function(e){return p[e].predicatename}),l=e.filter(function(e){return"rejected"===e.status}).length<1;n.sendPublicNotification("BrowsingStructureAssociationUpdate",a,l),l&&i.nestedMenuInContext._classifyButton&&i._closePanel()}).catch(function(){d.off(),c.removeModal(u),o.displayNotification({title:r.association_error,message:r.error_association_service,className:"error"})})}),this.nestedMenuInContext.addEvent("onSelectorCancel",this._closePanel.bind(this))},_closePanel:function(){Object.getPrototypeOf(this.nestedMenuInContext.nestedMenu)._expandedNodes=[],this.nestedMenuInContext.destroy(),this.options.deactivateAssociate||n.sendWebInWinNotification("onPanelClose")},_getWebServiceRef:function(){return t},_getPlmType:function(e){return"Terminology"===e?"RootFolder":"Term"===e?"Folder":void 0},_getRootIcon:function(){return s.getWebappsAssetUrl("TerminologySelector","icons/22/Browsing_Structure_22.png")},_getFavoritesIcon:function(){return null},_getRootName:function(){return r.name_Section_AllFolders},_getFavoritesName:function(){return null},_getActiveIcon:function(e){return this.isInstance?s.getWebappsAssetUrl("TerminologySelector","icons/22/Browsing_Node_22.png"):s.getWebappsAssetUrl("TerminologySelector","icons/22/Browsing_Structure_22.png")},_getFocusBtnTooltip:function(){return r.terminology_btn_focus},_showMessageWhileEmpty:function(e){return e?r.terminology_msg_empty:r.terminology_msg_noterminology},_getIcon:function(e,t){var n;return"Terminology"===e.type||"RootFolder"===e.type?n=m:"Term"!==e.type&&"Folder"!==e.type||(n=g),n},couldBeExpand:function(e){return!0},couldBeValid:function(e,t,n,o){var i=!1,r=t.getSelectedNodes().length;if(t&&r>0){if(0==n&&r>1)return!1;i=0==o?!t.getRoots()[0].isSelected():1==o?!t.getRoots()[1].isSelected():!t.getRoots()[0].isSelected()&&!t.getRoots()[1].isSelected()}return i},couldBeSelected:function(e){return!0},getFavoriteKey:function(){return null},_getContextualMenu:function(e,t){return a.GetContextualMenuForTerminology(e,t)},initSelection:function(){var e=this.nestedMenuInContext.nestedMenu?this.nestedMenuInContext.nestedMenu._treeView:null,t=e?e.getTreeDocument():null,o=this;t&&o.alreadySelected&&o.alreadySelected.length>0&&o.alreadySelected.forEach(function(e){if(o.isInstance&&o.mapRelationParentTerms){var i=o.mapRelationParentTerms[e]?o.mapRelationParentTerms[e].parent:null;o.nestedMenuInContext.nestedMenu._modelEvents.subscribeOnce({event:"onPostExpand:"+i},function(){n.searchNodesById(t,e).forEach(function(e){e.select()})}),function e(i){if(i){var r=o.mapRelationParentTerms[i]?o.mapRelationParentTerms[i].parent:null;if(r)o.nestedMenuInContext.nestedMenu._modelEvents.subscribeOnce({event:"onPostExpand:"+r},function(){var e=n.searchNodesById(t,i);e.forEach(function(e){e.expand()})}),e(r);else{var s=n.searchNodesById(t,i);s.forEach(function(e){e.expand()})}}}(i)}else{n.searchNodesById(t,e).forEach(function(e,t){e.select()})}})},disableButtonAssociate:function(e){this.nestedMenuInContext._classifyButton&&(this.nestedMenuInContext._classifyButton.disabled=!0),e&&(this.nestedMenuInContext._classifyButton.tooltipInfos=new u({shortHelp:e}))}})}),define("DS/TerminologySelector/commands/TerminologyGlobalCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/TerminologySelector/service/TerminologyWebService","DS/Controls/Loader","DS/Controls/ModalContainer","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/TerminologySelector/assets/nls/TerminologySelector"],function(e,t,n,o,i,r,s){"use strict";var a={};return t.extend({isInsert:!0,datas:{},launchComponent:function(e,t){},init:function(e){var t=this;this._parent(e,{mode:"exclusive",isAsynchronous:!1});require(["DS/PADUtils/PADContext"],function(e){e.get()&&(n.getSubTypesVPMRefInst().then(function(e){t._check_selection(e)}).catch(function(e){t.disable()}),e.get().getPADTreeDocument().getXSO().onChange(function(){n.getSubTypesVPMRefInst().then(function(e){t._check_selection.call(t,e)}).catch(function(e){t.disable()})}))})},beginExecute:function(){},execute:function(){var e=this;require(["DS/PADUtils/PADContext"],function(t){var l=t.get().getSelectedNodes();if(l&&l.length>0&&l.length<=20){var c,u=new o({showButtonFlag:!0});u.on(s.loading),u.elements.stopButton.addEventListener("buttonclick",function(e){c.cancel()}),i.createModal(widget.body,u.elements.container),(c=n.getSubTypesVPMRefInst()).then(function(t){u.off(),i.removeModal(widget.body),(a[e.options.ID]||e.isValidSelection(l,t)).then(function(t){t?e.launchComponent(l):r.displayNotification({message:s.error_command_selection,className:"error"})})}).catch(function(e){u.off(),i.removeModal(widget.body),e&&"cancel"==e.error||r.displayNotification({message:s.error_run_command,className:"error"})})}else r.displayNotification({message:s.error_command_selection,className:"error"})})},endExecute:function(){},isValidSelection:function(e,t){},_check_selection:function(e){var t=this;require(["DS/PADUtils/PADContext"],function(n){var o=n.get().options.model.getXSO().get();if(o&&o.length>0&&o.length<=20){var i=t.isValidSelection(o,e);i.then(function(e){e?t.enable():t.disable()}),a[t.options.ID]=i}else t.disable()})}})}),define("DS/TerminologySelector/commands/AssociateTermsCommand",["DS/TerminologySelector/commands/TerminologyGlobalCommand","DS/TerminologySelector/TerminologyAssociation/TerminologyAssociation","DS/IPClassifyUtil/IPClassifyAlert","DS/TerminologySelector/service/TerminologyWebService","i18n!DS/TerminologySelector/assets/nls/TerminologySelector"],function(e,t,n,o,i){"use strict";return e.extend({labelTopBar:i.widget_name_associate_terms,launchComponent:function(e){var n=[];if(e.forEach(function(e){e.getRelationID&&e.getRelationID()&&n.push({id:e.getRelationID()})}),n&&n.length>0)new t({items:n,isInstance:!0})},isValidSelection:function(e,t){return new Promise(function(n){var i=!0,r=[];e.forEach(function(e){if(e.getRelationID&&e.getRelationID())if(e.options.relationtype){if(e.options.relationtype&&!t.includes(e.options.relationtype))return void(i=!1)}else r.push(e.getRelationID());else i=!1}),i?r.length>0?o.canBeAddedToBrowsingNode({objectIds:r}).then(function(e){e.isValid?n(!0):n(!1)}).catch(function(){n(!1)}):n(!0):n(!1)})}})}),define("DS/TerminologySelector/commands/AssociateTerminologiesCommand",["DS/TerminologySelector/commands/TerminologyGlobalCommand","DS/TerminologySelector/TerminologyAssociation/TerminologyAssociation","DS/IPClassifyUtil/IPClassifyAlert","DS/TerminologySelector/service/TerminologyWebService","i18n!DS/TerminologySelector/assets/nls/TerminologySelector"],function(e,t,n,o,i){"use strict";return e.extend({labelTopBar:i.widget_name_associate_terminologies,launchComponent:function(e){var n=[];if(e.forEach(function(e){e.getID()&&n.push({id:e.getID(),label:e.getLabel()})}),n&&n.length>0)new t({items:n,isInstance:!1})},isValidSelection:function(e,t){return new Promise(function(n){var i=!0,r=[];e.forEach(function(e){if(e.getID()){var n=e.options.type||e.getType&&e.getType();if(n){if(n&&!t.includes(n))return void(i=!1)}else r.push(e.getID())}else i=!1}),i?r.length>0?o.canBeAddedToBrowsingStructure({objectIds:r}).then(function(e){e.isValid?n(!0):n(!1)}).catch(function(){n(!1)}):n(!0):n(!1)})}})}),define("DS/TerminologySelector/TerminologyManagement/TerminologyManagement",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/WUXAutoComplete/AutoComplete","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Controls/Button","DS/Controls/TooltipModel","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Loader","DS/Controls/ModalContainer","DS/IPClassifyUtil/IPClassifyAlert","DS/PlatformAPI/PlatformAPI","DS/TerminologySelector/service/TerminologyWebService","DS/TerminologySelector/utils/TerminologyUtil","DS/TerminologySelector/TerminologyAssociation/TerminologyAssociation","i18n!DS/TerminologySelector/assets/nls/TerminologySelector","css!DS/TerminologySelector/TerminologySelector.css"],function(e,t,n,o,i,r,s,a,l,c,u,d,m,g,p,f,h,y){const T="term",v="terminology";var S={iconName:"browsing-structure-root",fontIconFamily:1},I={iconName:"browsing-structure-node",fontIconFamily:1};return e.extend(t,n,{name:"TerminologyManagement",init:function(e){this._parent(e);this.instances=e.instances,this.references=e.references,this.initialSelectedTerms=[],this.initialSelectedTerminologies=[],this.autocompleteTerminologies=null,this.autocompleteTerms=null,this.mapNameIDTerminologies={},this.mapRelationParentTerms={};var t=[this.getAssociatedTerminologies(),this.getAssociatedTerms(),this.getTerminologies()];this.initialPromise=Promise.all(t),this.elements.masterContainer=UWA.createElement("div",{class:"terminologyManagement-masterContainer"}),this.container=UWA.createElement("div",{class:"terminologyManagement-container"}).inject(this.elements.masterContainer),this.elements.cancel=new s({label:y.cancel,emphasize:"secondary",onClick:this._closePanel.bind(this)}),this.elements.save=new s({label:y.save,emphasize:"primary",onClick:this.saveAssociations.bind(this)});let n=e.container;if(e.webInWin){this.elements.masterContainer.inject(e.container);let t=UWA.createElement("div",{class:"buttonBar"}).inject(this.elements.masterContainer);this.elements.save.inject(t),this.elements.cancel.inject(t)}else this.createModal(e.container,y.terminology_management,this.elements.masterContainer),n=this.container.getParent();this.loader=new u,this.loader.on(y.loading),d.createModal(this.elements.masterContainer,this.loader.elements.container),this.createContentTerminologyManagement().inject(this.container)},_closePanel:function(){this.dialog&&this.dialog.close(),f.sendWebInWinNotification("onPanelClose")},createAutocompleteComponent:function(e,t,n,i){var r=UWA.createElement("div",{class:"terminologyManagement-autocomplete-container"}),l=(UWA.createElement("div",{class:"terminologyManagement-autocomplete-label",html:"<label>"+e+"</label>"}).inject(r),UWA.createElement("div",{class:"terminologyManagement-autocomplete-line"}).inject(r)),c=UWA.createElement("div",{class:"terminologyManagement-autocomplete"}).inject(l),u=UWA.createElement("div",{class:"terminologyManagement-button-browse"}).inject(l),d=new o({elementsTree:t,allowFreeInputFlag:!1,class:"test"}).inject(c);return new s({displayStyle:"lite",label:"Browse",onClick:i,icon:{iconName:"open-in-a-new-window",fontIconFamily:1},showLabelFlag:!1}).inject(u).tooltipInfos=new a({shortHelp:y.tooltip_browse}),r.inject(n),d},setPossibleDatasAutocomplete:function(e,t){e.elementsTree=t},setValuesAutocomplete:function(e,t){e.value=t},createContentTerminologyManagement:function(){var e=this,t=UWA.createElement("div",{class:"terminologyManagement-autocompletes-container"});function n(e,t){return e.map(function(e){return{label:e.label,value:e.id,icon:t?I:S}})}return this.initialPromise.then(o=>{var s=o[0],a=o[1],l=o[2].terminologies,c=o[2].terms,u=o[2].relationsTerms;s&&l&&(e.autocompleteTerminologies=e.createAutocompleteComponent(y.associated_terminologies_reference,[],t,e.browseAssociations.bind(e,e.references,!1)),e.setPossibleDatasAutocomplete(e.autocompleteTerminologies,n(l)),e.displayAssociateTerminologies(s)),a&&c&&(e.autocompleteTerms=e.createAutocompleteComponent(y.associated_terms_instance,[],t,e.browseAssociations.bind(e,e.instances,!0)),e.autocompleteTerms.addEventListener("change",function(){e.autocompleteTerms.selectedItems&&e.autocompleteTerms.selectedItems.length>0&&e.autocompleteTerms.selectedItems.forEach(function(e){e.options.type===v&&e.unselect()})}),l&&u?e.setPossibleDatasAutocomplete(e.autocompleteTerms,function(e,t,n){var o=new i,s={};return o.prepareUpdate(),t.forEach(function(e){var t=a(e.label,e.id,S,v);o.addRoot(t),s[e.id]=t}),e.forEach(function(e){var t=a(e.label,e.id,I,T);s[e.id]=t}),n.forEach(function(e){var t=s[e.parent],n=s[e.child];t&&n&&t.addChild(n)}),o.getRoots().forEach(function(e,t){e.sortChildren({isRecursive:!0,sortFunction:function(e,t){return e.options.label.localeCompare(t.options.label)>=1?1:-1}})}),o.expandAll(),o.pushUpdate(),o;function a(e,t,n,o){var i=new r({label:e,value:t,icon:n,type:o});return i}}(c,l,u)):e.setPossibleDatasAutocomplete(e.autocompleteTerms,n(c,!0)),e.displayAssociateTerms(a)),e.loader.off(),d.removeModal(this.elements.masterContainer)}),t},createModal:function(e,t,n){var o=new l({});that=this,this.dialog=new c({immersiveFrame:o,title:t,content:n,activeFlag:!1,height:"auto",minHeight:50,width:500,modalFlag:!0,domId:"terminologyManagementDialog",buttons:{Cancel:this.elements.cancel,Save:this.elements.save}}),o.inject(e)},browseAssociations:function(e,t,n){var o=this,i=null;o.autocompleteTerms&&t?i=o.autocompleteTerms.value||[]:!t&&o.autocompleteTerminologies&&(i=o.autocompleteTerminologies.value||[]),new h({items:e,isInstance:t,deactivateAssociate:!0,alreadySelected:i,mapRelationParentTerms:t?o.mapRelationParentTerms:null}).addEvent("associateTerminology",function(e){o.autocompleteTerminologies&&!t&&o.setValuesAutocomplete(o.autocompleteTerminologies,e.terminologiesID),o.autocompleteTerms&&t&&o.setValuesAutocomplete(o.autocompleteTerms,e.termsID)})},saveAssociations:function(){var e=this,t=new u;t.on(y.loading),d.createModal(this.elements.masterContainer,t.elements.container);var n=[],o=[],i=[],r=[];if(e.autocompleteTerminologies){var s=e.autocompleteTerminologies.value||[];n=l(e.initialSelectedTerminologies,s),i=c(e.initialSelectedTerminologies,s)}if(e.autocompleteTerms){var a=e.autocompleteTerms.value||[];o=l(e.initialSelectedTerms,a),r=c(e.initialSelectedTerms,a)}function l(e,t){return g(e,t)}function c(e,t){return g(t,e)}function g(e,t){var n=[];return e.forEach(function(e){t.includes(e)||n.push(e)}),n}var h=[],T=i.length>0?p.attachTerminologies({terminologiesId:i,itemsID:e.references.map(function(e){return e.id}),isInstance:!1}):Promise.resolve(null),v=r.length>0?p.attachTerminologies({termsId:r,itemsID:e.instances.map(function(e){return e.id}),isInstance:!0}):Promise.resolve(null),S=n.length>0?p.detachTerminologies({terminologiesId:n,itemsID:e.references.map(function(e){return e.id}),isInstance:!1}):Promise.resolve(null),I=o.length>0?p.detachTerminologies({termsId:o,itemsID:e.instances.map(function(e){return e.id}),isInstance:!0}):Promise.resolve(null);h.push(T,v,S,I),Promise.all(h).then(n=>{var o=n[0],i=n[1],r=n[2],s=n[3],a=!0;let l=f.createDataForEventAssociationUpdate(e.references.map(function(e){return e.id}),e.instances.map(function(e){return e.id}),o,i,r,s,function t(n){var o=e.mapRelationParentTerms[n];return o&&o.parent?t(o.parent):{id:n,title:e.mapNameIDTerminologies[n].title,predicatename:e.mapNameIDTerminologies[n].predicatename}},function(t){return e.mapNameIDTerminologies[t].predicatename});(o||r)&&(a=e.displayReponseAssociations(o,r)),(i||s)&&e.displayReponseAssociations(i,s,!0);let c=a&&a;f.sendPublicNotification("BrowsingStructureAssociationUpdate",l,c),c?this._closePanel():((o||r)&&e.updateAssociatedTerminologies(),(i||s)&&e.updateAssociatedTerms()),t.off(),d.removeModal(this.elements.masterContainer)}).catch(e=>{console.log(e),t.off(),d.removeModal(this.elements.masterContainer),m.displayNotification({title:y.association_error,message:y.error_association_service,className:"error"})})},displayReponseAssociations:function(e,t,n){var o=this;function i(e){if(e&&null!=e.length){var t=[],n=[];return e.forEach(function(e){var i=e.status,r=null;"fulfilled"===i?(r=e.value.member[0],t.push({id:r.id,label:o.mapNameIDTerminologies[r.id].title})):"rejected"===i&&(r=e.reason,n.push({id:r.id,label:o.mapNameIDTerminologies[r.id].title}))}),{successID:t,errorID:n}}return null}var r=i(e),s=i(t);if(r||s){var a="",l="",c="",u="";return n?(a=y.title_association_success_terms,l=y.title_association_error_terms):(a=y.title_association_success_terminologies,l=y.title_association_error_terminologies),r&&(r.successID.length>0&&(c+=n?y.association_success_terms:y.association_success_terminologies,c+="\n",c=y.replace(c,{terminologies:r.successID.map(function(e){return e.label})})),r.errorID.length>0&&(u+=n?y.association_error_terms:y.association_error_terminologies,u+="\n",u=y.replace(u,{terminologies:r.errorID.map(function(e){return e.label})}))),s&&(s.successID.length>0&&(c+=n?y.detach_success_terms:y.detach_success_terminologies,c=y.replace(c,{terminologies:s.successID.map(function(e){return e.label})})),s.errorID.length>0&&(u+=n?y.detach_error_terms:y.detach_error_terminologies,u=y.replace(u,{terminologies:s.errorID.map(function(e){return e.label})}))),c&&m.displayNotification({title:a,message:c,className:"success"}),!u||(m.displayNotification({title:l,message:u,className:"error"}),!1)}},getAssociatedTerminologies:function(){var e=this;if(e.references&&e.references.length>0)return new Promise(function(t,n){p.getAssociatedTerminologies({itemsID:e.references.map(function(e){return e.id}),isInstance:!1,onComplete:function(n){var o=n?e.getResultIntersectionOfTerminologies(n,!1):[];e.initialSelectedTerminologies=o,t(o)},onFailure:function(e){t([])}})});Promise.resolve(null)},getAssociatedTerms:function(){var e=this;if(e.instances&&e.instances.length>0)return new Promise(function(t,n){p.getAssociatedTerminologies({itemsID:e.instances.map(function(e){return e.id}),isInstance:!0,onComplete:function(n){var o=n?e.getResultIntersectionOfTerminologies(n,!0):[];e.initialSelectedTerms=o,t(o)},onFailure:function(e){t([])}})});Promise.resolve(null)},displayAssociateTerminologies:function(e){this.setValuesAutocomplete(this.autocompleteTerminologies,e)},displayAssociateTerms:function(e){this.setValuesAutocomplete(this.autocompleteTerms,e)},updateAssociatedTerminologies:function(){this.getAssociatedTerminologies().then(function(e){e&&that.displayAssociateTerminologies(e)})},updateAssociatedTerms:function(){this.getAssociatedTerms().then(function(e){e&&that.displayAssociateTerms(e)})},getResultIntersectionOfTerminologies:function(e,t){t=t||!1;var n=e.member,o=[];if(n&&n.length>1)o=n.map(function(e){var n=t?e.browsingNodes:e.browsingStructures;return n&&n.member&&n.member.length>0?n.member.map(function(e){return e.identifier}):[]}).reduce(function(e,t){return e.filter(function(e){return t.includes(e)})});else if(n&&1===n.length){var i=t?n[0].browsingNodes:n[0].browsingStructures;i&&i.member&&i.member.length>0&&(o=i.member.map(function(e){return e.identifier}))}return o.slice()},addmapNameIDTerminologies:function(e){var t=this;e&&e.length>0&&e.forEach(function(e){t.mapNameIDTerminologies[e.id]={title:e.label,predicatename:e.predicatename||void 0}})},getTerminologies:function(){var e=this;return this.references&&this.references.length>0?new Promise(function(t,n){p.searchTerminologies({searchTerms:!1,onComplete:function(n){var o=n.results,i=e.parseDataSearch(o);e.addmapNameIDTerminologies(i);var r={};r.terminologies=i||[],e.instances&&e.instances.length>0?i&&i.length>0?p.expandV2Terms({physicalIds:i.map(function(e){return e.id}),onComplete:function(n){var o=e.parseDataExpandV2(n)||{};UWA.extend(o,r),o.terminologies=i||[],e.addmapNameIDTerminologies(o.terms),t(o)},onFailure:function(e){}}):(r.terms=[],t(r)):t(r)},onFailure:function(e){}})}):Promise.resolve(null)},parseDataExpandV2:function(e){var t=e.results,n=[],o=[],i=this;return t&&t.length>0?(t.forEach(function(e){e.from&&e.to?o.push({parent:e.from,child:e.to}):"Term"===e["ds6w:type"]&&n.push({label:e["ds6w:label"],id:e.resourceid,icon:e.icon})}),o&&o.length>0&&o.forEach(function(e){i.mapRelationParentTerms[e.child]={id:e.child,parent:e.parent}}),{terms:n,relationsTerms:o}):null},parseDataSearch:function(e){var t=[];return e&&e.length>0&&e.forEach(function(e){var n=e.attributes,o={};n.forEach(function(e,t){"resourceid"===e.name&&(o.id=e.value),"ds6w:label"===e.name&&(o.label=e.value),"type_icon_url"===e.name&&(o.icon=e.value),"predicatename"===e.name&&(o.predicatename=e.value)}),t.push(o)}),t}})}),define("DS/TerminologySelector/commands/TerminologyManagementCommand",["DS/TerminologySelector/commands/TerminologyGlobalCommand","DS/TerminologySelector/TerminologyManagement/TerminologyManagement","DS/IPClassifyUtil/IPClassifyAlert","DS/TerminologySelector/service/TerminologyWebService","i18n!DS/TerminologySelector/assets/nls/TerminologySelector"],function(e,t,n,o,i){"use strict";return e.extend({labelTopBar:i.terminology_management,launchComponent:function(e){var n=[],o=[];if(e.forEach(function(e){e.getID()&&n.push({id:e.getID(),label:e.getLabel()}),e.getRelationID&&e.getRelationID()&&o.push({id:e.getRelationID()})}),n&&n.length>0||o&&o.length>0)new t({container:document.body,references:n,instances:o})},isValidSelection:function(e,t){return new Promise(function(n){var i=!0,r=[],s=[];if(e.forEach(function(e){if(e.getID()){var n=e.options.type||e.getType&&e.getType();if(n){if(n&&!t.includes(n))return void(i=!1)}else s.push(e.getID());if(e.getRelationID&&e.getRelationID())if(e.options.relationtype){if(e.options.relationtype&&!t.includes(e.options.relationtype))return void(i=!1)}else r.push(e.getRelationID())}else i=!1}),i)if(s.length>0||r.length>0){var a=[s.length>0?o.canBeAddedToBrowsingStructure({objectIds:s}):{isValid:!0},r.length>0?o.canBeAddedToBrowsingNode({objectIds:r}):{isValid:!0}];Promise.all(a).then(function(e){var t=e[0],o=e[1];t.isValid&&o.isValid?n(!0):n(!1)}).catch(function(){n(!1)})}else n(!0);else n(!1)})}})});