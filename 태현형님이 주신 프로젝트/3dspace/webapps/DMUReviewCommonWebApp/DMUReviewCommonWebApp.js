define("DS/DMUReviewCommonWebApp/DMUCommonWebAppController",["UWA/Class","DS/DMUControls/EXPNotify","DS/DMUReadPersistence/DMULoadMarkupServices","DS/DMUBaseExperience/DMUContextManager","UWA/Utils","DS/DMUBaseExperience/EXPManagerSet","DS/DMUPlaySlide/controllers/DMUSlideShowController","DS/DMUPlaySlide/DMUSlide","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/CoreEvents/ModelEvents","DS/DMUBaseUIControllers/DMU2DSheetManager","DS/DMUBaseUIControllers/DMUCommentsController","DS/PADUtils/PADUtilsServices","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUControls/DMUInfoModalDiv","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUReadPersistence/DMULoadingContextController","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/DMUReadPersistence/DMUWebServicesUtils","DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADProgressBar","DS/PADServices/utils/GlobalModelEvents","DS/DMUBaseUIControllers/DMUSceneDisplayController","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUPlayMarker/DMUMarkerFactory","DS/DMUPlayMarker/DMUMarkerServices","DS/DMUControls/DMUWarningPanel","DS/Selection/PSOManager","DS/ApplicationFrame/CommandsManager","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUReviewController","DS/CATWebUXComponents/CATWebUXUtils","i18n!DS/DMUBaseUI/assets/nls/DMUBaseUI","DS/CATWebUXSlideDrop/CATWebUXSlideDropServices","i18n!DS/DMUReviewCommonWebApp/assets/nls/DMUReviewCommonWebApp"],function(e,t,n,i,a,o,r,l,s,d,c,u,g,p,m,f,h,D,v,w,C,S,b,y,M,R,P,V,A,U,I,x,k,E,F,O,T,_,W,L,N){"use strict";return e.extend({init:function(j,B){this._parent(j);var X,q,H,G,J,z=this,Q=!1,K=B,$=(j||{}).ctxViewer,Y=i.getEventsController({viewer:$.getViewer()}),Z=!1,ee=new g,te={},ne={},ie=null,ae={},oe={};let re,le,se,de,ce=null;var ue,ge,pe,me,fe,he,De,ve,we,Ce,Se,be,ye,Me,Re,Pe,Ve,Ae,Ue,Ie,xe=!1,ke=!1;let Ee,Fe,Oe=!1,Te=!1,_e=!0;const We=["SIMItfSimulation","PLMPIMMetricReference","Document","DIFLayout","DIFSheet","DIFAnnotationSet","Requirement","Requirement Specification","DesignSight"];function Le(e,n){Fe&&(Fe.destroy(),Fe=null),Fe=new t({body:$.getFrameWindow().getUIFrame(),type:e,message:n})}this.setSlideShowController=function(e){X=e},this.setValidatedObjCreationFlag=function(e){Z=e};var Ne,je,Be,Xe=function(){return q||(q=O.giveDMUSlidesController({context:$.getFrameWindow()})),q};function qe(){"R3V"===K?(Ae&&clearTimeout(Ae),Ae=setTimeout(function(){if(Ae=null,!$)return;var e,t,n=i.getReviewContext({context:$});e=["DMU2DCompareCmdHdr"],t=Q&&0!==$.getViewer().getVisibleSpace()&&d.getRoots($).length&&(!n||n&&!n.isReadOnly())&&me&&("Drawing"===Ie||"DIFSheet"===Ie||"DIFLayout"===Ie);let a=!0;n&&n.getCurrentSessionMarkup()&&n.getCurrentSessionMarkup().getActiveFlag()&&n.getCurrentSessionMarkup().isVisible()&&n.getCurrentSessionMarkup().getMarkupOwner()&&!n.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(a=!1),z._applyFlag(e,t&&a),e=["measureCmdHdr","sectionCmdHdr","3DcompareCmdHdr","thicknessCmdHdr","LockUnlockSectionHdr"],t=Q&&0!==$.getViewer().getVisibleSpace()&&d.getRoots($).length&&(!n||n&&!n.isReadOnly()),a=!0,n&&n.getCurrentSessionMarkup()&&n.getCurrentSessionMarkup().getActiveFlag()&&n.getCurrentSessionMarkup().isVisible()&&n.getCurrentSessionMarkup().getMarkupOwner()&&!n.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(a=!1),z._applyFlag(e,t&&a),t=(t||!t&&!d.getRoots($).length)&&n&&!n.isReadOnly()&&n.getCurrentSessionMarkup()&&!n.getCurrentSessionMarkup().isReadOnly();let r=n&&n.getValidation()?n.getValidation().getCurrentMarkup():null;for(;r&&"Markup"!==r.getValType();)r=r.getParentRepRef().getParent();a=!0,r&&!1===r.isWebMarkup()&&(a=!1),e=["DMUEditFormatsHdr","slideCmdHdr","DMUExportReviewAsPdfHdr"],z._applyFlag(e,t&&a),t=Q&&0!==$.getViewer().getVisibleSpace()&&n&&n.getValidation()&&!n.isReadOnly(),e=["DMUReviewMarkupHdr","DMUAddCheckHdr","CATWebUXGenerateIssueHdr","CATWebUXGenerateCAHdr"],z._applyFlag(e,t),t=t&&n&&n.getCurrentSessionMarkup()&&n.getCurrentSessionMarkup().getActiveFlag()&&n.getCurrentSessionMarkup().isVisible()&&n.getCurrentSessionMarkup().getCurrentSlide()&&n.getCurrentSessionMarkup().getCurrentSlide().isVisible(),e=["DMUAddHighlightHdr"],z._applyFlag(e,t),t=t&&n&&!n.isReadOnly()&&n.getCurrentSessionMarkup()&&n.getCurrentSessionMarkup().getActiveFlag()&&n.getCurrentSessionMarkup().isVisible()&&n.getCurrentSessionMarkup().getCurrentSlide()&&n.getCurrentSessionMarkup().getCurrentSlide().isVisible()&&!n.getCurrentSessionMarkup().isReadOnly(),e=["markerTextCmdHdr","markerPictureCmdHdr","marker2DTextCmdHdr","marker2DPictureCmdHdr","markerCircleCmdHdr","DMU3DRectangleCmdHdr","DMUFreehandCmdHdr","DMUCommentCmdHdr","DMUCreateValidatedMkrHdr","DMUCreateRejectedMkrHdr","markerArrowCmdHdr"],z._applyFlag(e,t),t=Q&&0!==$.getViewer().getVisibleSpace()&&d.getRoots($).length&&n&&n.getCurrentSessionMarkup()&&n.getCurrentSessionMarkup().getSlides().length>0||"Document"===ge||"Requirement"===pe||"Requirement Specification"===pe,e=["CATWebUXSlideShowHdr"],z._applyFlag(e,t),t=Q&&(!n||!n.isReadOnly())&&("Document"===ge||"Requirement"===pe||"Requirement Specification"===pe)&&ue&&ue.documentHasBookmarks(),e=["WebDocumentBookmarksPanelCmdHdr"],z._applyFlag(e,t),t=Q&&("Document"===ge||"Requirement"===pe||"Requirement Specification"===pe)&&ue&&ue.documentHasMultipleElements(),e=["WebDocumentPreviousPageCmdHdr","WebDocumentNextPageCmdHdr"],z._applyFlag(e,t),t=Q&&("Document"===ge||"Requirement"===pe||"Requirement Specification"===pe)&&ue&&"Document"===ue.getDocumentType(),e=["WebDocumentRotatePagesLeftCmdHdr","WebDocumentRotatePagesRightCmdHdr"],z._applyFlag(e,t);var l=o.getManager({name:"DMUUserExperienceManager",context:$.getFrameWindow()});l&&l.refreshCCPCommandsAvailability()})):(Ae&&clearTimeout(Ae),Ae=setTimeout(function(){if(Ae=null,!$)return;var e,t,n=i.getReviewContext({context:$});e=["DMU2DCompareCmdHdr"],t=Q&&0!==$.getViewer().getVisibleSpace()&&d.getRoots($).length&&(!n||n&&!n.isReadOnly())&&("Drawing"===Ie||"DIFSheet"===Ie||"DIFLayout"===Ie);let a=!0;n&&n.getCurrentSessionMarkup()&&n.getCurrentSessionMarkup().getActiveFlag()&&n.getCurrentSessionMarkup().isVisible()&&n.getCurrentSessionMarkup().getMarkupOwner()&&!n.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(a=!1),z._applyFlag(e,t&&a),e=["measureCmdHdr","sectionCmdHdr","3DcompareCmdHdr","thicknessCmdHdr","LockUnlockSectionHdr"],t=Q&&0!==$.getViewer().getVisibleSpace()&&d.getRoots($).length&&(!n||n&&!n.isReadOnly()),a=!0,n&&n.getCurrentSessionMarkup()&&n.getCurrentSessionMarkup().getActiveFlag()&&n.getCurrentSessionMarkup().isVisible()&&n.getCurrentSessionMarkup().getMarkupOwner()&&!n.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(a=!1),z._applyFlag(e,t&&a),t=(t||!t&&!d.getRoots($).length)&&n&&!n.isReadOnly()&&n.getCurrentSessionMarkup()&&!n.getCurrentSessionMarkup().isReadOnly();let r=n&&n.getValidation()?n.getValidation().getCurrentMarkup():null;for(;r&&"Markup"!==r.getValType();)r=r.getParentRepRef().getParent();a=!0,r&&!1===r.isWebMarkup()&&(a=!1),e=["DMUEditFormatsHdr","slideCmdHdr","DMUExportReviewAsPdfHdr"],z._applyFlag(e,t&&a),t=t&&n&&!n.isReadOnly()&&n.getCurrentSessionMarkup()&&n.getCurrentSessionMarkup().getActiveFlag()&&n.getCurrentSessionMarkup().isVisible()&&n.getCurrentSessionMarkup().getCurrentSlide()&&n.getCurrentSessionMarkup().getCurrentSlide().isVisible()&&!n.getCurrentSessionMarkup().isReadOnly(),e=["markerTextCmdHdr","markerPictureCmdHdr","marker2DTextCmdHdr","marker2DPictureCmdHdr","markerCircleCmdHdr","DMU3DRectangleCmdHdr","DMUFreehandCmdHdr","DMUCommentCmdHdr","DMUCreateValidatedMkrHdr","DMUCreateRejectedMkrHdr","markerArrowCmdHdr"],z._applyFlag(e,t),t=d.getRoots($).length,e=["DMUReviewHdr"],z._applyFlag(e,t),t=Q&&0!==$.getViewer().getVisibleSpace()&&n&&n.getValidation()&&!n.isReadOnly(),e=["DMUReviewMarkupHdr","CATWebUXGenerateIssueHdr","CATWebUXGenerateCAHdr"],z._applyFlag(e,t),t=Q&&0!==$.getViewer().getVisibleSpace()&&d.getRoots($).length&&n&&n.getCurrentSessionMarkup()&&n.getCurrentSessionMarkup().getSlides().length>0||"Document"===ge||"Requirement"===pe||"Requirement Specification"===pe,e=["CATWebUXSlideShowHdr"],z._applyFlag(e,t),t=Q&&(!n||!n.isReadOnly())&&("Document"===ge||"Requirement"===pe||"Requirement Specification"===pe)&&ue&&ue.documentHasBookmarks(),e=["WebDocumentBookmarksPanelCmdHdr"],z._applyFlag(e,t),t=Q&&("Document"===ge||"Requirement"===pe||"Requirement Specification"===pe)&&ue&&ue.documentHasMultipleElements(),e=["WebDocumentPreviousPageCmdHdr","WebDocumentNextPageCmdHdr"],z._applyFlag(e,t),t=Q&&("Document"===ge||"Requirement"===pe||"Requirement Specification"===pe)&&ue&&"Document"===ue.getDocumentType(),e=["WebDocumentRotatePagesLeftCmdHdr","WebDocumentRotatePagesRightCmdHdr"],z._applyFlag(e,t);var l=o.getManager({name:"DMUUserExperienceManager",context:$.getFrameWindow()});l&&l.refreshCCPCommandsAvailability()}))}function He(e){ge!==e&&(ge&&fe&&fe.removeApplicativeContainer(ge),ge=e,i.setCurrentReviewContext(ge),z.publish("onReviewContextModified",{type:ge,onABReady:qe}),fe.initApplicativeContainer(ge,{authoring:!0})),qe()}function Ge(e,t){let n=[];d.getRoots($).forEach(i=>{const a=$.getController().getRootStats(d.getNodeID(i))&&"r2vsurvey"===$.getController().getRootStats(d.getNodeID(i)).serviceId?"R2V_FeatureState":d.getNodeType(i);e&&a===e||d.getNodeID(i)!==t&&("VPMReference"===e&&"R2V_FeatureState"===a||"R2V_FeatureState"===e&&"VPMReference"===a||n.push(d.getNodeID(i)))}),n.length&&$.removeRoots({pids:n})}async function Je(e){try{let t=await y.getParentTypes(e);return[e].concat(t)}catch{return[e]}}async function ze(e){if(!Q||!e)return;var t,n;if(Ie=void 0,e.path?(t=d.getNodeID(e.path.getLastElement(!0)),n=$.getController().getRootStats(t)&&"r2vsurvey"===$.getController().getRootStats(t).serviceId?"R2V_FeatureState":d.getNodeType(e.path.getLastElement(!0))):e.docData&&(t=e.docData.objectId,n=e.docData.objectType),!t||!n)return;Ie=n,me&&me.getLoadedID()===t||(ue&&ue.getDocumentLoadedID()!==t&&!ke&&ue.clean2DDocument(),Ve&&!xe&&Ve.cleanCommentsPanel(),me&&me.clean()),he=null;var o=function(){He("ITF")};var r=async function(){Ge("R2V_FeatureState",t),await async function(){const e=d.getRoots($);let t=!1;for(let n=0;n<e.length;n++){let i=d.getNodeType(e[n]),a=0;const o=await Je(i);if(o.includes("VPMReference")||a===e.length-1)return o.includes("VPMReference")&&(t=!0),t;a++}}()||He("R2V"),me.load({data:{serviceId:"r2vsurvey",objectParentType:"R2V_FeatureState",objectType:"R2V_FeatureState",objectId:t}})},s=function(){if("DIFLayout"===n||"DIFSheet"===n)He("2DFL");else if("Drawing"===n){He("2D"),ke||Ge(null,t);var e=setInterval(function(){var i,a,o,r;(1===$.getRootBagPath().getChildrenPathes().length||ke&&2===$.getRootBagPath().getChildrenPathes().length)&&(clearInterval(e),i=t,a=n,o=$.getRootBagPath().getChildrenPathes()[$.getRootBagPath().getChildrenPathes().length-1].getLastElement(!0),ue.load2DDocument({phyID:i,dataType:a,serverUrl:f.get3DSpaceUrl(),securityContext:M.getSetting("pad_security_ctx"),parentNode:o,is2DCompareActive:ke,onLoadingStarted:function(){R.on(),r=1},onComplete:function(){r&&(R.off(),r=0)},onFailure:function(){$.removeRoots({pids:[i]}),$.displayNotification({msg:N.fileWithNoSVG,eventID:"error"}),r&&(R.off(),r=0),Y&&"R3V"===K&&Y.fireEvent("on2DDocumentLoadFailure")}}))},100)}},c=function(){!me||"DXF"!==me.getLoadMarkupCtxType()&&"DWG"!==me.getLoadMarkupCtxType()?(He(n),Ge(null,t)):(He("2D"),Ge(null,t)),he=t};if("Drawing"===n||"DIFLayout"===n||"DIFSheet"===n&&e.path.getParentPath().isEqual($.getRootBagPath()))s(),pe=n;else if("Document"===n||"Requirement"===n||"Requirement Specification"===n){c(),pe=n;var u=i.getReviewContext({viewer:$.getViewer()});if(u){var g=u.getValidation().getLoadedRepRefs();if(g.length>0)for(let e=0;e<g.length;e++){var p=g[e].getMarkupContent();if(p&&!p.getCurrentSlide()&&0===p.getComments().length){var h=new l($,p);h.setAttributes([{name:"sID",value:p.computeNewID()},{name:"sUuid",value:a.getUUID()}]),h.updateEnvironmentOverload({target:u.getEnvironment(),state:u.getEnvironment().getEnvironmentInfo()}),p.addSlide(h),h&&p.setCurrentSlide(h)}}Ve||(Ve=m.giveDMUCommentsController({context:$.getFrameWindow(),commandContext:$?$.getCommandContext():null})),Ve?Ve.setVisibleFlag(!0):(Ve=m.getDMUCommentsController({context:$.getFrameWindow(),commandContext:$?$.getCommandContext():null})).setVisibleFlag(!0)}}else if($.getApplicativeData().getLoadedItfData&&$.getApplicativeData().getLoadedItfData().data.length>0)o(),pe="SIMItfSimulation";else if("DesignSight"===n)He("MSR"),pe="MSR";else if("R2V_FeatureState"===n)r(),pe="R2V";else{const i=await Je(n);i&&i.length&&-1!==i.indexOf("Drawing")&&e.path.getParentPath().isEqual($.getRootBagPath())?(n=pe="Drawing",s()):i&&i.length&&-1!==i.indexOf("SIMItfSimulation")&&e.path.getParentPath().isEqual($.getRootBagPath())?(n=pe="SIMItfSimulation",o()):i&&i.length&&(-1!==i.indexOf("Requirement")||-1!==i.indexOf("Requirement Specification"))?(n=-1!==i.indexOf("Requirement Specification")?"Requirement Specification":"Requirement",pe="Requirement",c()):i&&i.length&&-1!==i.indexOf("Document")?(n=pe="Document",c()):i&&i.length&&-1!==i.indexOf("R2V_FeatureState")?(r(),pe="R2V"):Ue?$.removeRoots({pids:[t]}):(Ge("VPMReference",t),He("3D"))}qe()}function Qe(){var e=i.getReviewContext({context:$}),t=e?e.getValidation():null;if(t){let e=t.getAllRepRefs().filter(e=>{let t=e.getMarkupContent();if(t)return t.isDirty()&&!t.isReadOnly()&&!e.isBeingRemoved()});Q&&!ye&&e&&e.length&&(Ne&&clearTimeout(Ne),je&&clearTimeout(je),be&&be.destroy(),Ne=setTimeout(function(){if(Q&&!ye&&i.getReviewContext({context:$}))if(v.isProcessing())je=setTimeout(Qe,1e3);else{if($){be||(be=new w),be.display({frmWindow:$.getFrameWindow(),type:"save"});let t=[],n=0;e.forEach(e=>t.push(function(e){return new Promise((t,n)=>{let i,a,o,r,l,s=null;pe&&"Document"===pe&&(l=me.getDocumentVersionInfos(),r="Document",s=me.getLoadMarkupCtxType()),$.getApplicativeData&&($.getApplicativeData(),$.getApplicativeData().getLoadedItfData&&(i=$.getApplicativeData().getLoadedItfData()).data.length&&(i.data[0].metricID&&(a=i.data[0].metricID),void 0!==i.loadMode&&(o=i.loadMode),r="SIMItfSimulation")),v.saveReviewMarkup({markupRepRefId:e,frmWindow:$.getFrameWindow(),superType:r,documentType:s,listData:a,loadingInfos:o,documentVersionInfos:l,onSaveCompleted:t,onSaveFailed:n})})}(e.getPlmID()))),Promise.allSettled(t).then(e=>{if(e.forEach(e=>{"fulfilled"!==e.status&&"NoSaveNeeded"!==e.reason||n++}),n===t.length){be&&be.destroy(),i.giveEventsController({viewer:$.getViewer()}).fireEvent("onReviewSaved")}else{be&&(be.destroy(),be.display({frmWindow:$.getFrameWindow(),type:"error"})),i.giveEventsController({viewer:$.getViewer()}).fireEvent("onReviewSaveFailed"),je=setTimeout(Qe,5e3)}})}Ne=null}},750))}}function Ke(){Qe(),qe()}function $e(){const e=i.getReviewContext({context:$});(e?e.getValidation():null)&&setTimeout(()=>{$.toggleSOITimelinesUsability(!1)},1e3)}function Ye(e){if(!Q)return;ye=!1,Oe=!1;var t=V.giveDMUSceneDisplayController({context:$});const n=t=>{var n=i.getReviewContext({viewer:$.getViewer()});if(n&&n.getValidation()&&"R3V"===K){var a=n.getValidation().getContext(),o=$.getApplicativeData().getLoadedItfData&&$.getApplicativeData().getLoadedItfData().data.length>0?[$.getApplicativeData().getLoadedItfData().data[0].isrID]:[e.id];const i=i=>{v.updateReviewContext({ctxViewer:$,validation:n.getValidation(),contextId:o[0],rootData:{label:i.label,icon:i.icon,type:i.type},onUpdateReviewContextCompleted:function(){"DesignSight"!==t&&"DIFLayout"!==t&&"Requirement Specification"!==t&&v.updateValidatedObjectsList({fullPathRefs:[[e.id]],validatedObjects:[[e.id]],validatedId:n.getValidation().getValidated().getPlmID()?n.getValidation().getValidated().getPlmID():null,validatedToAdd:[[e.id]],referenceIds:[e.id],instanceIds:[e.id],instanceNames:[],updateMode:"add",onReviewCtxUpdateOrDropValidated:!0,ctxViewer:$.getFrameWindow().getViewer(),onSaveValidatedObjectsFailed:function(){}})},onUpdateReviewContextFailed:function(){}})};if(!a||a&&!a.getJsonContexts().length)if("R2V_FeatureState"===t){let e=setInterval(()=>{if(me&&me.getLoadedR2VInformations().length){clearInterval(e);let t=me.getLoadedR2VInformations()[0].info;i({label:t[0]["ds6w:label"],icon:t[0].icon,type:"R2V_FeatureState"})}},100)}else $.getController().getAttributes({ids:o,attributes:["ds6w:label","type_icon_url","ds6w:type"],callbacks:{onComplete:function(e){i({label:e[o[0]]["ds6w:label"],icon:e[o[0]].type_icon_url,type:e[o[0]]["ds6w:type"]})},onFailure:function(){}}})}};if((!t||!t.getCurrentComparedObjectIDPaths()&&X&&X.getActiveState())&&X.setActiveState(!1),e.id===sessionStorage.getItem("DMU2DCompareTempRoot"))$.removeRoots({pids:[sessionStorage.getItem("DMU2DCompareTempRoot")]}),sessionStorage.removeItem("DMU2DCompareTempRoot");else if(e.path){ze({path:e.path}),n(d.getNodeType(e.path.getLastElement(!0))),he=null}else{var a=$.getRootBagPath().externalPath[0].path.getChildrenPathes().length;if(a){var o=$.getRootBagPath().externalPath[0].path.getChildrenPathes()[a-1];ze({path:o}),n(d.getNodeType(o.getLastElement(!0)))}}}function Ze(e){if(Q){if(!$.getRootBagPath().getChildrenPathes().length&&X&&X.getActiveState()&&X.setActiveState(!1),ue&&(e&&e.id?ue.clean2DDocument(e):ue.clean2DDocument()),Ve&&(Ve.cleanCommentsPanel(),m.unreferenceDMUCommentsController({context:$.getFrameWindow()}),Ve=null),Ie&&"R2V_FeatureState"===Ie&&$.toggleSOITimelinesUsability(!0),$.getRootBagPath().getChildrenPathes().length){var t=$.getRootBagPath().externalPath[0].path.getChildrenPathes().length;let e;t&&(e=$.getRootBagPath().externalPath[0].path.getChildrenPathes()[t-1]),Ie=d.getNodeType(e.getLastElement(!0))}else ye=!0,i.setReviewContext({context:$});me&&(me.clean(),me.setLoadedR2VInformations([])),qe()}}function et(){$.unsubscribe(te.onRootRemoved),te.onRootRemoved=-1}function tt(){te.onRootRemoved=$.subscribe({event:"onRootRemoved"},Ze)}function nt(e){Be=A.getNearPositionFrom2DCoordinates({x:e.clientX,y:e.clientY},$.getViewer())}function it(e){Q&&z&&e&&f.multiTenantMgt([e],d.getRoots($),function(t){if(!t.isMultiTenant){var n=i.getReviewContext({context:$}),a=n?n.getCurrentSessionMarkup():null;if(!a||a.isReadOnly()||!a.getCurrentSlide())return;I.getDataFromRelatedId({type:"DMUMarker3DPicture",objectId:e.objectId,onComplete:function(t){var n=U.create3DMarker({viewer:$.getViewer(),frameWindow:$.getFrameWindow(),parent:a,date:Date.now(),objectId:e.objectId,shape:{type:"picture",pointingPoint:Be,data:t}});n&&(a.getCurrentSlide().addDMUObject(n),n.fireEvent("onDMUObjectInitialized",{dmuObject:n}))}})}})}function at(e){Q&&z&&e&&_e&&f.multiTenantMgt([e],d.getRoots($),function(t){t.isMultiTenant||z.loadMarkupContext(e)})}this.loadReviewAfterRefresh=function(e){"_DMUValidationValidation"!==e.type&&"DMUValidationValidation"!==e.displayType||z.loadContext(e,Q,"_DMUValidationValidation","refreshMode",!0,z),"_DMUValidationExposedPresentation"===e.type&&z.loadContext(e,Q,"_DMUValidationExposedPresentation","refreshMode",!0,z)},this.loadContext=function(e,t,n,a){var o;t&&z&&e&&(o=H&&H.objectId===e.reviewId?H:e,f.multiTenantMgt([o],d.getRoots($),async function(e){if(!e.isMultiTenant&&("_DMUValidationValidation"===n||"_DMUValidationExposedPresentation"===n)){var t={};t.loadMode=a||null,t.reviewId=o.objectId,t.context=$,t.displayName=o.displayName,t.displayType=o.displayType?o.displayType:"DMUValidationValidation"===o.objectType?"Review":void 0,t.type="_DMUValidationValidation"===n?"DMUValidationValidation":"DMUValidationExposedPresentation",t.readOnly=!1,t.cbRootAdded=function(){H=o},t.cbOK=async function(e){let t=!1;e&&!0===e.sameReview&&(t=!0);var n=await C.createReviewContext({context:$}),a=Xe(),r=n.getValidation(),l=r.getLoadedRepRefs();l.length>0&&a&&(a=O.giveDMUSlidesController({context:$.getFrameWindow()}),z.autoReframe=!1,"DMUValidationValidation"!==o.objectType&&"_DMUValidationValidation"!==o.objectType||t||a.setActiveSlide(l[0].getMarkupContent().getSlides()[0]));var s,d,c=[];let u=r.getHighlights();if(u&&u.length)for(s=0;s<u.length;s++)c.push(u[s]);if(d=[],r){var g=r.getLoadedRepRefs();for(s=0;s<g.length;s++){d=d.concat(g[s].getMarkupContent().getSlides());for(let e=0;e<g[s].getMarkupContent().getSlides().length;e++){var p=g[s].getMarkupContent().getSlides()[e].getDMUObjects();for(let e=0;e<p.length;e++)p[e].getDMUComments&&(d=d.concat(p[e].getDMUComments()))}}let e,t,n=i.getReviewContext({viewer:$.getFrameWindow().getViewer()}),a=r.getContext()?r.getContext().getJsonContexts():null;a&&a.length>0&&(e=a[0].id,t=a[0].type),n.setReviewCtxInformation({contextId:e,contextType:t,reviewId:r.getPlmID(),reviewName:r.getName(),reviewType:r.getValType(),owner:r.getOwner()})}var f=function(e,t){m.giveDMUCommentsController({context:$.getFrameWindow()}).applyComment({commentId:e,markupId:t})};let h,D=(e,t)=>{h||(h=Y.addEvent("on2DDocumentLoadSuccess",function(){f(e,t),Y&&h&&Y.removeEvent(h),h=null}))};for(let e=0;e<d.length;e++)for(let n=0;n<c.length;n++)if(c[n].getAttribute("sPresentationSlideID")===d[e].getAttribute("sUuid")){if(c[n].getPlmID()===o.objectId)if("DMUSlide"===d[e].getType())a&&a.setActiveSlide(d[e]);else if("DMUComment"===d[e].getType()){let i=d[e].getAttribute("sUuid"),a=c[n].getAttribute("sRepRefMarkupID");t?f(i,a):D(i,a)}t||z.highlightInitialization({highlight:c[n],slide:d[e]})}Y.addEvent("onReplyExpandRequest",function(e){let t=i.getReviewContext({viewer:$.getFrameWindow().getViewer()}),n=t.getValidation();Y.fireEvent("onGetMarkupJsonEvt",{markup:n.getRepRef(e.data.id),onLoadingCompleted:function(e,i){n.setCurrentMarkup(i),Y.fireEvent("onImportModelEvt",{asset:e,onImportCompleted:function(){var e=t.getCurrentSessionMarkup();i.setMarkupContent(e),e.setMarkupOwner(i),a&&a.setActiveSlide(e.getSlides()[0]),e.setReadOnly(t.isReadOnly());let o=n.getHighlightsData();if(o&&o.length)for(d=e.getSlides(),s=0;s<o.length;s++)for(var r=0;r<d.length;r++)o[s].slideId===d[r]._sUuid&&z.highlightInitialization({highlight:o[s],slide:d[r]})}})}})})},t.cbFailed=function(){},await z.loadValidation(t),F.setSlidePreferences({context:$.getFrameWindow(),preferences:{displayNominal:!1,displayInWork:!1}})}}))},this.createSharedPreferences=function(e){e&&e.addPreferences([{nls:N.markerPrefTitle,id:"MarkerPreferences",type:"section",preferences:[{nls:N.validatedStampMarkerLabel,id:"MarkerValidatedStampLabel",type:"editor",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_MarkerValidatedStampLabel")||W.defaultValidatedStampLabel},getDefaultValue:function(){return W.defaultValidatedStampLabel},setValue:function(e){e!==localStorage.getItem("CATWebUXMePreferences_MarkerValidatedStampLabel")&&localStorage.setItem("CATWebUXMePreferences_MarkerValidatedStampLabel",e)}},{nls:N.rejectedStampMarkerLabel,id:"MarkerRejectedStampLabel",type:"editor",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_MarkerRejectedStampLabel")||W.defaultRejectedStampLabel},getDefaultValue:function(){return W.defaultRejectedStampLabel},setValue:function(e){e!==localStorage.getItem("CATWebUXMePreferences_MarkerRejectedStampLabel")&&localStorage.setItem("CATWebUXMePreferences_MarkerRejectedStampLabel",e)}}]},{nls:N.compareSectionTitle,id:"ComparePreferences",type:"section",preferences:[{nls:N.firstProductColor,id:"CompareFirstColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareFirstColor")?localStorage.getItem("CATWebUXMePreferences_CompareFirstColor"):"#FF0000"},getDefaultValue:function(){return"#FF0000"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareFirstColor",e)}},{nls:N.secondProductColor,id:"CompareSecondColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareSecondColor")?localStorage.getItem("CATWebUXMePreferences_CompareSecondColor"):"#00FF00"},getDefaultValue:function(){return"#00FF00"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareSecondColor",e)}},{nls:N.compare3DCommonColor,id:"Compare3DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor"):"#D3D3D3"},getDefaultValue:function(){return"#D3D3D3"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare3DCommonColor",e)}},{nls:N.compare2DCommonColor,id:"Compare2DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor"):"#000000"},getDefaultValue:function(){return"#000000"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare2DCommonColor",e)}}]},{nls:N.slideSectionTitle,id:"SlidePreferences",type:"section",preferences:[{nls:N.slideNameFromFeature,id:"SlideNameFromFeature",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SlideNameFromFeature")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SlideNameFromFeature"))&&localStorage.setItem("CATWebUXMePreferences_SlideNameFromFeature",e?"true":"false")}},{nls:N.slideTitleDisplayLbl,id:"DisplaySlideTitle",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle"))&&localStorage.setItem("CATWebUXMePreferences_DisplaySlideTitle",e?"true":"false")}},{nls:N.preferences.slideCaptureSpecLayers,id:"CaptureSpecLayers",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXMePreferences_CaptureSpecLayers")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("CATWebUXMePreferences_CaptureSpecLayers"))&&localStorage.setItem("CaptureSpecLayers",e?"true":"false")}},{nls:N.preferences.slideEnableDrag,id:"SlideDragAndDropOperation",type:"radio",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_SlideDragAndDropOperation")||"SlideReorder"},getDefaultValue:function(){return"0"},setValue:function(e){e!==localStorage.getItem("CATWebUXMePreferences_SlideDragAndDropOperation")&&localStorage.setItem("CATWebUXMePreferences_SlideDragAndDropOperation",e)},options:[{id:"SlideReorder",nls:N.preferences.enableReorder},{id:"TransferView",nls:N.preferences.enableDragContent}]}]}])},this.removeSharedPreferences=function(e){e&&e.removePreferences(["MarkerPreferences","ComparePreferences","SlidePreferences"])},this._onContextualBarReadyCB=function(){var e=[],t=c.get(),n=t[t.length-1],a=function(e,t){return e.x>=t.x-3&&e.x<=t.x+3&&e.y>=t.y-3&&e.y<=t.y+3};if(t.length){for(var o,r=!1,l=null,s=!1,u=0;u<t.length;u++){for(o=t[u].pathElement.clone();o&&o.internalPath.length;)o=o.getParentPath();if(o.getLastElement(!0).getAnnotationClassType||o.getLastElement(!0).getDMUType)return{cmdList:[]};l=d.getLastReference(o);let e=!$.getController().isRootSupported||$.getController().isRootSupported(d.getNodeID(l.getLastElement(!0)));l&&d.isReference(l.getLastElement(!0))&&e?r=!0:l=null}n&&n.event&&n.event.lastPosition&&n.event.startPosition&&a(n.event.startPosition,n.event.lastPosition)&&n.pathElement.externalPath.length>2&&n.pathElement.externalPath[0]===$.getRootBagPath().getLastElement(!0)&&(s=!0);var g=i.getReviewContext({context:$}),p=g?g.getCurrentSessionMarkup():null;let c="3D"===i.getCurrentReviewContext()||"ITF"===i.getCurrentReviewContext();if(p&&p.getActiveFlag()&&!p.isReadOnly()&&p.isVisible()&&p.getCurrentSlide()&&!Z){if(r&&c&&e.push({name:"DMUHideShowOverloadStr",line:1,hdr_list:["DMUHideShowOverloadHdr"]}),l&&l.externalPath&&l.externalPath.length&&c){var m=V.getDMUSceneDisplayController({context:$});m&&!m.getCurrentComparedObjectIDPaths()&&e.push({name:"DMUColorOpacityOverloadStr",line:1,hdr_list:["DMUColorOpacityOverloadHdr"]}),e.push({name:"DMUPositionOverloadStr",line:1,hdr_list:["DMUPositionOverloadHdr"]})}}else r&&c&&e.push({name:"HideShowStr",line:1,hdr_list:["HideShowHdr"]});s&&c?e.push({name:"DMULevelSelectorStr",line:1,hdr_list:["DMULevelSelectorHdr"]}):1===t.length&&n&&n.pathElement&&n.pathElement.getParentPath().isEqual($.getRootBagPath())&&c&&e.push({name:"RemoveRootStr",line:1,hdr_list:["RemoveRootHdr"]})}return"DIFLayout"!==Ie&&"DIFSheet"!==Ie||n&&n.event&&n.event.lastPosition&&n.event.startPosition&&a(n.event.startPosition,n.event.lastPosition)&&n.pathElement.externalPath.length>2&&n.pathElement.externalPath[0]===$.getRootBagPath().getLastElement(!0)&&e.push({name:"DMULevelSelectorStr",line:1,hdr_list:["DMULevelSelectorHdr"]}),{cmdList:e}},this._applyFlag=function(e,t){for(var n,i=0;i<e.length;i++)(n=E.getCommand(e[i],$.getCommandContext()))||(n=E.getCommandCheckHeader(e[i],$.getCommandContext())),n&&(t?n.enable():n.disable())},this._onContextualMenuReadyCB=function(e,t){var n=[];if(X&&X.getActiveState())return{cmdList:n};var a=i.getReviewContext({context:$}),r=c.get(),l=!$.getViewer().get2DMode(),s=o.getManager({name:"DMUUserExperienceManager",context:$.getFrameWindow()}),u={x:t.XmousePositionWithDevPxRatio,y:t.YmousePositionWithDevPxRatio};if(0===(s?s.pick(u,"mesh"):$.getViewer().pick({xPix:u.x,yPix:u.y},"mesh",!0).path).length){var g=k.get(),p=g&&g[0]&&g[0].pathElement?g[0].pathElement.getLastElement(!0):null,m=p&&p.getDMUType?p.getDMUType():"";if("DMUSlide"===m||"DMUFormat"===m||"DMUComment"===m||"DMUMarkup"===m||"DMUValidationExposedPresentation"===m||"DMUValidationCheck"===m||"Checks"===m||"Highlights"===m)return{cmdList:n};n=[{line:1,name:"DMU3DReviewDisplaySubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:!_.isMobile()&&l?["VisuQMCommand","PAD3DToggleStatusBarHdr"]:["PAD3DToggleStatusBarHdr"]},{line:1,name:"DMU3DReviewAmbiencesSubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}]}else if(r.length){var f=a?a.getCurrentSessionMarkup():null,h=!1,D=!1,v=!1,w=f&&!f.isReadOnly()&&f.isVisible();for(let e=0;e<r.length;e++){if(f&&!f.isReadOnly()&&f.isVisible()){var C=f.getOrCreateOccurrenceOverloader(r[e]);if(!h)if(C&&C.isOverloadedInCurrentSlide())h=!0;else{let t=r[e].pathElement.clone();t.getParentPath()&&d.isInstance(t.getParentPath().getLastElement(!0))&&(C=f.getOrCreateOccurrenceOverloader({pathElement:t.getParentPath()}))&&C.isOverloadedInCurrentSlide()&&(h=!0)}}for(var S=!0,b=0;b<r[e].pathElement.externalPath.length;b++)r[e].pathElement.externalPath[b].getDMUType&&(D=!0,S=!1);S&&(v=!0)}var y=!1;if(s&&(y=s.areOccurenceOverloadsCopied()),h&&(n=n.concat([{line:1,name:"DMURemoveOverloadStr",hdr_list:["DMURemoveOverloadHdr"]},{line:1,name:"DMUCopyStr",hdr_list:["DMUCopyHdr"]},{line:1,name:"DMUCutStr",hdr_list:["DMUCutHdr"]}])),v&&y&&(n=n.concat([{line:1,name:"DMUPasteStr",hdr_list:["DMUPasteHdr"]},{line:1,name:"DMUPasteSpecialStr",hdr_list:["DMUPasteSpecialHdr"]}])),!D){l?n.push({line:1,name:"FocusOn",hdr_list:["FocusOnHdr"]}):-1===pe.indexOf("Document")&&n.push({line:1,name:"FocusOn",hdr_list:["DMUFocusOnRepresentationHdr"]}),"Requirement"===Ie||"Requirement Specification"===Ie?n.push({line:1,name:"ReframeOn",hdr_list:["WebDocumentReframeOnHdr"]}):"Drawing"===pe||"DIFLayout"===pe||"DIFSheet"===pe?n.push({line:1,name:"ReframeOn",hdr_list:["DMUReframeOnRepresentationHdr"]}):n.push({line:1,name:"ReframeOn",hdr_list:["ReframeOnHdr"]});let e=!$.getController().isRootSupported||r.length>=1&&r[0].pathElement.externalPath.length>=2&&$.getController().isRootSupported(d.getNodeID(r[0].pathElement.externalPath[1]));if(w&&l&&e){var M=!1;let e,t;for(let n=0;n<r.length;n++){for(e=r[n].pathElement.clone();e&&e.internalPath.length;)e=e.getParentPath();if((t=d.getLastReference(e))&&d.isReference(t.getLastElement(!0))){M=!0;break}}t&&t.externalPath.length<=2&&(M=!1),M&&n.push({line:1,name:"DMUHideShowOverloadStr",hdr_list:["DMUHideShowOverloadHdr"]})}1===r.length&&"Drawing"!==Ie&&$.getRootBagPath().isAParentOf(r[0].pathElement)&&n.push({name:"DMUNavOnImplementationLinksStr",line:1,hdr_list:["DMUNavOnImplementationLinksHdr"]}),n.push({line:1,name:"EditPropertiesCmd",hdr_list:["ActionBar_Attributes"]}),l&&e&&n.push({line:1,name:"PAD3DViewerToggleGeometrySection",resourceFile:"ENOPAD3DViewer/ENOPAD3DViewer",hdr_list:["PAD3DToggleSimplifiedHdr","PAD3DToggleAccurateHdr"]})}}return{cmdList:n}},this.highlightInitialization=function(e){e&&e.slide&&e.slide.setAssociatedHighlightData&&e.highlight&&e.slide.setAssociatedHighlightData(JSON.stringify({protocol:"3DXContent",version:"1.1",data:{items:[{envId:f.getPlatformId(),serviceId:"3DSpace",contextId:M.getSetting("pad_security_ctx")?M.getSetting("pad_security_ctx"):void 0,objectId:e.highlight.getPlmID(),objectType:e.highlight.getType(),displayName:e.highlight.getName()}]},source:window.widget&&window.widget.getValue("appId")?window.widget.getValue("appId"):"ENOR3D_AP",widgetId:window.widget?window.widget.id:void 0}))},this._setActiveState=async function(e){const t=()=>f.get3DSpaceUrl(),a=()=>f.getPlatformId(),l=()=>M.getSetting("pad_security_ctx");let g,C,y;if(e!==Q){if(Q=e){me||(me=S.getLoadingContextController({context:$}));let e=function(e){return new Promise((n,i)=>{let o=t()+"/resources/dictionary/getTypeInfo?tenant="+a(),r=l();require("DS/WAFData/WAFData").authenticatedRequest(o+"&SecurityContext="+r,{method:"POST",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:r},data:JSON.stringify(e),onComplete:function(e){n(e)},onFailure:function(e){i(e)},onTimeout:function(e){i(e)}})})},c={_DMUValidationValidation:function(e){z.loadContext(e,Q,"_DMUValidationValidation",!1,z)},_DMUValidationExposedPresentation:function(e){z.loadContext(e,Q,"_DMUValidationExposedPresentation",!1,z)},...L.getDelegation($,function(){Y.fireEvent("onApplyingSlideView")})};try{let t=await e(We);Object.keys(t).forEach(e=>{c["_"+e]=at}),$.setLoadingDelegations(c)}catch{We.forEach(e=>{c["_"+e]=at}),$.setLoadingDelegations(c)}if((Pe=b.getSelectionManager({context:$})).setActiveState(!0),Me={activated:$.getViewer().picking.activated,trapSelection:$.getViewer().picking.trapSelection,trapGPU:$.getViewer().picking.trapGPU},Re={activated:$.getViewer().pPicking.activated},$.getViewer().setPicking({activated:!0,trapSelection:!0,trapGPU:!0}),$.getViewer().setPrePicking({activated:!0}),P.subscribe({event:"ENXViews/WelcomePanel/openContent"},async e=>{let t=e.unserializedData?e.unserializedData.data.items:null;if(t&&t.length>1)for(const e of t){const t=await Je(e.objectType);if(!t.includes("VPMReference")&&!t.includes("R2V_FeatureState")){_e=!1,Le("warning",N.dropMultiNoAutorized);break}}else _e=!0}),Y=i.getEventsController({viewer:$.getViewer()}),ae.onValidationObjectDeleted=Y.addEvent("onValidationObjectDeleted",function(e){if(e&&e.dmuObject&&e.dmuObject.length&&e.dmuObject[0].getType&&"Markup"===e.dmuObject[0].getType()){let t=i.getReviewContext({context:$});t.getCurrentSessionMarkup()===e.dmuObject[0].getRepRef().getMarkupContent()&&t.setCurrentSessionMarkup(null),e.dmuObject[0].getRepRef().removeMarkupContent(),v.deleteObject({ctxViewer:$,objectIds:[e.dmuObject[0].getPlmID()],type:e.dmuObject[0].getValType(),onDeleteCompleted:qe})}else if(e&&e.dmuObject&&e.dmuObject.length&&("DMUValidationExposedPresentation"===e.dmuObject[0].getType()||"DMUValidationCheck"===e.dmuObject[0].getType())){var t=[];for(let n=0;n<e.dmuObject.length;n++)t.push(e.dmuObject[n].getPlmID());v.deleteObject({ctxViewer:$,objectIds:t,type:"validationObject",onDeleteCompleted:function(){}})}}),ae.onValidationObjectAttributesModificationRequest=Y.addEvent("onValidationObjectAttributesModificationRequest",function(e){if(e&&e.attr&&e.dmuObject&&e.dmuObject.getValType&&e.attr.key){var t=[];if("name"===e.attr.key&&"ReviewMarkup"===e.dmuObject.getValType()){var n=[];n.push({sAlias:e.attr.value}),t.push({object:e.dmuObject,attributesList:n}),e.dmuObject.getParent&&e.dmuObject.getParent()&&t.push({object:e.dmuObject.getParent(),attributesList:n})}be||(be=new w),be.display({frmWindow:$.getFrameWindow(),type:"save"}),v.updateAttributes({ctxViewer:$,objectsToModify:t,onAttributesSaveCompleted:function(){be.destroy()},onSaveFailed:function(){be.destroy()}})}}),ae.onDMUObjectDeleted=Y.addEvent("onDMUObjectDeleted",function(e){e&&e.dmuObject&&e.dmuObject.getParent()&&"DMUTemporaryBag"!==e.dmuObject.getParent().getType()&&(e.dmuObject.getValType||Ke())}),ae.onDMUObjectInitialized=Y.addEvent("onDMUObjectInitialized",function(e){if(e&&e.dmuObject&&e.dmuObject.getParent()&&"DMUTemporaryBag"!==e.dmuObject.getParent().getType())if(!e.dmuObject.getValType||Oe)Ke(),qe();else if("DMUValidationValidation"===e.dmuObject.getValType())if(qe(),$.elements.container.removeEventListener("drop",nt),"2DFL"===ge){$.elements.container.addEventListener("drop",nt);var t={_EleLogicalRelay:it,_EleLogicalContact:it,_EleLogicalOperatingDevice:it,_EleLogicalSingleConnector:it,_EleLogicalInlineConnector:it,_EleLogicalShellConnector:it,_EleLogicalSplice:it,_EleLogicalTerminalBoard:it,_EleLogicalBusbar:it,_EleLogicalHarness:it,_EleLogicalNet:it,_EleLogicalNetGroup:it,_EleLogicalWire:it,_EleLogicalWireShield:it,_EleLogicalCable:it,_EleLogicalCableShielded:it,_EleLogicalCableTwisted:it,_EleLogicalCableTwistedShielded:it,_EleLogicalOverShield:it,_EleLogicalPowerCable:it,_EleLogicalCoaxCable:it,_EleLogicalCableGroup:it,_EnsLogicalEquipment:it,_EnsInCLoop:it,_EnsInCLogicalRoute:it,_EnsInCLogicalBranch:it,_EnsInCLogicalComponent:it,_Piping_Logical_Miscellaneous:it,_Piping_Logical_Branch:it,_Piping_Logical_Instrument:it,_Piping_Logical_Reducer:it,_Piping_Logical_Valve:it,_Piping_Logical_Pipe:it,_Piping_Line:it,_ICLoop_Line:it,_HVAC_Logical_Miscellaneous:it,_HVAC_Logical_Branch:it,_HVAC_Logical_Instrument:it,_HVAC_Logical_Reducer:it,_HVAC_Logical_Damper:it,_HVAC_Logical_Duct:it,_HVAC_Line:it};$.setLoadingDelegations(Object.assign({},t,c))}else $.setLoadingDelegations(c);else"DMUValidationExposedPresentation"===e.dmuObject.getValType()&&z.highlightInitialization({highlight:e.dmuObject,slide:e.slideObject})}),ae.onSlideApplicativeContextModified=Y.addEvent("onSlideApplicativeContextModified",function(e){e&&e.dmuObject&&("DMUSlide"===e.dmuObject.getType()||"DMUFormat"===e.dmuObject.getType())&&Ke()}),ae.onDMUOverloadPropertiesChanged=Y.addEvent("onDMUOverloadPropertiesChanged",Ke),ae.onDMUOccOverloadRemoved=Y.addEvent("onDMUOccOverloadRemoved",Ke),ae.onDMUSlideSessionInfoChanged=Y.addEvent("onDMUSlideSessionInfoChanged",function(e){e&&e.dmuObject&&("DMUSlide"===e.dmuObject.getType()||"DMUFormat"===e.dmuObject.getType())&&Qe()}),ae.onDMUSlideNameChanged=Y.addEvent("onDMUSlideNameChanged",Qe),ae.onSaveRequested=Y.addEvent("onSaveRequested",Qe),ae.onDMUCurrentSlideChanged=Y.addEvent("onDMUCurrentSlideChanged",qe),ae.onFormatsEditionModeStarted=Y.addEvent("onFormatsEditionModeStarted",function(){z.publish("onReviewContextModified",{type:ge+"Formats",onABReady:qe})}),ae.onFormatsEditionModeEnded=Y.addEvent("onFormatsEditionModeEnded",function(){z.publish("onReviewContextModified",{type:"RefreshAB",onABReady:qe})}),ae.onComparisonStarted=Y.addEvent("onComparisonStarted",function(e){e&&e.is2DCompare&&(ke=!0),qe()}),ae.onComparisonEnded=Y.addEvent("onComparisonEnded",function(){ke=!1,qe()}),ae.onReviewCtxInformationChanged=Y.addEvent("onReviewCtxInformationChanged",function(e){e&&e.reviewId&&$&&$.getWidget()&&$.getWidget().dispatchEvent("onDMUReviewLoaded",{envId:f.getPlatformId(),reviewId:"DMUValidationExposedPresentation"===e.reviewType&&e.highlightId?e.highlightId:e.reviewId,objectId:e.reviewId,objectType:"Review"===e.reviewType?"_DMUValidationValidation":"_"+e.reviewType,displayName:e.reviewName,displayType:e.reviewType,type:"Review"===e.reviewType?"_DMUValidationValidation":"_"+e.reviewType})}),ae.onDMUObjectReadOnlyFlagChanged=Y.addEvent("onDMUObjectReadOnlyFlagChanged",function(e){if("Markup"===e.dmuObject.getAttribute("sType"))qe();else if("DMUValidationValidation"===e.dmuObject.getType()){var t="R3V"===K&&!e.flag;Y.fireEvent("setEditionMode",{editionMode:t,readOnly:e.flag}),qe()}}),ae.onDMUObjectActiveFlagChanged=Y.addEvent("onDMUObjectActiveFlagChanged",qe),ae.onDMUObjectVisibleFlagChanged=Y.addEvent("onDMUObjectVisibleFlagChanged",qe),ae.onApplicativeContextCommandsRequired=Y.addEvent("onApplicativeContextCommandsRequired",function(e){z.publish("onReviewContextModified",{type:"Data",data:e,onABReady:e.cb})}),ae.on2DDocumentLoadSuccess=Y.addEvent("on2DDocumentLoadSuccess",function(){qe(),Ue=!1}),ae.onDXFLoadSuccess=Y.addEvent("onDXFLoadSuccess",function(){He("2D"),Ve&&(Ve.cleanCommentsPanel(),m.unreferenceDMUCommentsController({context:$.getFrameWindow()}),Ve=null)}),ae.onDXFLoadSuccess=Y.addEvent("onR2VReviewCreationSuccess",function(){He("R2V")}),ae.reviewNoContextModeOn=Y.addEvent("reviewNoContextModeOn",function(){He("ReviewNoContext"),ye=!1,Oe=!0}),require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(e){Ee=e.getLoaderForMarkup({context:$}),ne.onDMUCtxtLoadingSuccess=Ee.subscribe("onDMUCtxtLoadingSuccess",function(){He("ITF")}),ne.onDMUCtxtRemoved=Ee.subscribe("onDMUCtxtRemoved",function(){i.getReviewContext({context:$})&&i.removeReviewContext({context:$}),He("3D")})}),ae.onValidatedCreationFlagChanged=Y.addEvent("onUpdateValidatedRequested",function(e){z.setValidatedObjCreationFlag(e)}),ae.onValidatedObjectDropped=Y.addEvent("onValidatedObjectDropped",function(e){C=i.getReviewContext({context:$}),v.updateValidatedObjectsList({fullPathRefs:e.path,validatedObjects:e.path,validatedId:C.getValidation().getValidated().getPlmID()?C.getValidation().getValidated().getPlmID():null,validatedToAdd:e.pathToAdd,referenceIds:e.pathToAdd,instanceIds:e.pathToAdd,instanceNames:[],updateMode:"add",ctxViewer:$.getViewer(),onReviewCtxUpdateOrDropValidated:!0,serviceId:e.serviceId,onSaveValidatedObjectsFailed:function(){}})}),ae.onRequirementDropped=Y.addEvent("onRequirementDropped",function(e){C=i.getReviewContext({context:$});let t=[];function n(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}const a=e=>{let i=e["attribute[Content Text]"]?n(e["attribute[Content Text]"]):e["Content Text"]?e["Content Text"]:"",a=e["attribute[Title]"]?n(e["attribute[Title]"]):e.Title?e.Title:"",o=e.type.value?e.type.value:e["type.kindof"]?e["type.kindof"]:"";i&&i.length>100&&(i=i.substring(0,99)+"..."),"Requirement"===o&&t.push({sValidationId:C.getValidation().getPlmID(),sRequirementDocId:e.physicalid,sName:a,sDescription:i,iCheckState:1})};new Promise(t=>{let n=0;e.forEach(async i=>{if(["Requirement Specification","Chapter"].includes(i.objectType)){(await function(e){return new Promise((t,n)=>{require("DS/WAFData/WAFData").authenticatedRequest(f.get3DSpaceUrl()+"/resources/trm/streaming/structure/"+e.phyId,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:M.getSetting("pad_security_ctx")},timeout:6e4,onComplete:function(e){let n=JSON.parse(e);t(n)},onFailure:n,onTimeout:n})})}({phyId:i.objectId})).forEach(e=>{a(e)})}else{(await function(e){return new Promise((t,n)=>{let i=encodeURI(`${f.get3DSpaceUrl()}/resources/trm/dictionary/info?pid=${e}&select=type,attribute[Content Data],attribute[Title],attribute[Content Text]`);require("DS/WAFData/WAFData").authenticatedRequest(i,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:M.getSetting("pad_security_ctx")},timeout:6e4,onComplete:function(e){let i=JSON.parse(e);i&&"success"===i.status&&i.results[0]?t(i):n(new Error("Requirement has no content"))},onFailure:function(){n(new Error("Requirement content Request Failed"))},onTimeout:function(){n(new Error("Requirement content Request Timeout"))}})})}(i.objectId)).results.forEach(e=>{e.physicalid||(e.physicalid=i.objectId),a(e)})}++n===e.length&&t()})}).then(()=>{let e=[],n=[],i=e=>{if(e>10){new x({title:N.warningPanelTitle,message:N.createCheckInfo,frmWindow:$._frmWindow,callbacks:{onValidateCB:()=>{v.addChecks({checkList:t,iCtxViewer:$})},onCancelCB:()=>{},onCloseCB:()=>{}}})}else v.addChecks({checkList:t,iCtxViewer:$})};if(C.getValidation().getChecks().forEach(i=>{t.forEach(t=>{i.getJsonRequirements().length&&t.sRequirementDocId===i.getJsonRequirements()[0]._sPlmID&&(e.includes(t.sRequirementDocId)||(e.push(t.sRequirementDocId),n.push(t.sName)))})}),n.length){new x({title:N.warningPanelTitle,message:N.requirementAlreadyAssociated01+" <br /> "+N.requirementAlreadyAssociated02+" <br /> "+n.toString(),frmWindow:$._frmWindow,callbacks:{onValidateCB:()=>{i(t.length)},onCancelCB:()=>{},onCloseCB:()=>{}}})}else i(t.length)})}),ae.onIssueDataRequested=Y.addEvent("onIssueDataRequested",function(e){!function(e){new Promise(function(t,n){var i={method:"GET"};i.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:M.getSetting("pad_security_ctx")},i.onComplete=function(t){var n=JSON.parse(t).body;e.onComplete&&n&&e.onComplete(n.title)},i.onFailure=n;var a=f.get3DSpaceUrl()+"/resources/issues/"+e.physicalId;require("DS/WAFData/WAFData").authenticatedRequest(a,i)})}(e)}),ae.onLoadingReviewContext=Y.addEvent("onLoadingReviewContext",function(e){"Document"!==e.rootType&&"Requirement Specification"!==e.rootType&&"Requirement"!==e.rootType||Ve||(Ve=m.getDMUCommentsController({context:$.getFrameWindow(),commandContext:$.getCommandContext()}))}),G=n.getLoadMarkupServices({context:$}),J=$.getFrameWindow().getActionBar().onActionBarReady(qe),(ue=o.getManager({name:"DMU2DSheetManager",context:$.getFrameWindow()}))||(ue=new p({ctxViewer:$}),o.addManager({name:"DMU2DSheetManager",context:$.getFrameWindow(),manager:ue})),Ve||!ue.isADocumentDisplayed()&&!ue.isRunning()||"Document"!==ue.getDocumentType()&&"Requirement"!==ue.getDocumentType()||(Ve=m.getDMUCommentsController({context:$.getFrameWindow(),commandContext:$?$.getCommandContext():null})),X||(X=new r({context:$})),te.onApplyFilterBegin=$.subscribe({event:"onBeginFilterApplied"},et),te.onFilterApplied=$.subscribe({event:"onFilterApplied"},tt),te.onLoadingFailure=$.subscribe({event:"onLoadingFailure"},tt),te.onRootAdded=$.subscribe({event:"onRootAdded"},Ye),te.onR2VLoaded=$.subscribe({event:"onR2VLoaded"},$e),te.onRootRemoved=$.subscribe({event:"onRootRemoved"},Ze),te.onRootAttached=$.subscribe({event:"onRootAttached"},Ye),te.onRootDetached=$.subscribe({event:"onRootDetached"},Ze),te.onRefresh=$.subscribe({event:"onRefresh"},()=>{Te=!0}),te.onRefreshBegin=$.subscribe({event:"onRefreshBegin"},()=>{ye=!0,Te||($.unsubscribe(te.onRootRemoved),te.onRootRemoved=-1)}),te.onRefreshCompleted=$.subscribe({event:"onRefreshCompleted"},function(){ye=!1,Te?Te=!1:te.onRootRemoved=$.subscribe({event:"onRootRemoved"},Ze)}),ie=$.getViewer().onSwapVisibleSpace(qe),fe=s.getDMUApplicativeContextManager({context:$}),ae.onR3VAppTransitionRequested=Y.addEvent("onLeavingR3VApp",function(e){if("X3DPLAW_AP"===e.targetApp)(C=i.getReviewContext({context:$}))&&C.getValidation()&&(C.getValidation().setReadOnly(!0),qe());else if("ENOR3R_AP"!==e.targetApp&&(C=i.getReviewContext({context:$}))&&C.getValidation()){T.giveDMUReviewController({context:$.getFrameWindow()}).setVisibleFlag(!1),q&&q.setVisibleFlag(!1)}}),ae.onR3RAppTransitionRequested=Y.addEvent("onLeavingR3RApp",function(e){if("X3DPLAW_AP"===e.targetApp)(C=i.getReviewContext({context:$}))&&C.getValidation()&&(C.getValidation().setReadOnly(!0),qe());else if("ENOR3V_AP"!==e.targetApp&&"ENOR3R_AP"!==e.targetApp&&(C=i.getReviewContext({context:$}))&&C.getValidation()){T.giveDMUReviewController({context:$.getFrameWindow()}).setVisibleFlag(!1);const e=q||Xe();e&&e.setVisibleFlag(!1)}}),(C=i.getReviewContext({context:$}))&&C.getCurrentSessionMarkup()){var R=!1,V=C.getReviewCtxInformation();if(V&&V.contextId||"R3R"===K){var A=$.getRootBagPath().getChildrenPathes();for(g=0;g<A.length;g++){if(($.getApplicativeData().getLoadedItfData&&$.getApplicativeData().getLoadedItfData().data.length?$.getApplicativeData().getLoadedItfData().data[0].isrID:d.getNodeID(A[g].getLastElement(!0)))===V.contextId){C.getCurrentSessionMarkup().setActiveFlag(!0),!1!==V.modifiable&&C.setReadOnly(!1),R=!0;break}}R||C.setCurrentSessionMarkup(null)}}if(C&&C.getValidation()){T.giveDMUReviewController({context:$.getFrameWindow()}).setVisibleFlag(!0);const e=q||Xe();e&&e.setVisibleFlag(!0),C.setReadOnly(!1),C.getValidation().setReadOnly(!1),Y.fireEvent("setEditionMode",{editionMode:"R3V"===K,readOnly:!1}),qe()}else C&&C.setCurrentSessionMarkup(null);Se=$.getViewer().sectionCappingEnabled,$.getViewer().setSectionCapping(!0),(Ce=$.isRobotVisible())&&$.setRobotVisibility(!1),$.getFrameWindow().getContextualUIManager().registerUnshift({subscriberId:"R3V"===K?"3DValidationWebAppCtxElements":"3DReviewWebAppCtxElements",workbenchName:"R3V"===K?"DMUValWebAppController":"DMUReviewWebAppController",context:$.getCommandContext(),module:"R3V"===K?"DMUValWebAppController":"DMUReviewWebAppController",cmdPrefix:"",directory:"assets/afr/",merge:!0,onContextualBarReady:this._onContextualBarReadyCB,onContextualMenuReady:this._onContextualMenuReadyCB}),(De=$.isDefaultContextualBarVisible())&&$.setDefaultContextualBarVisibility(!1),(ve=$.isDefaultContextualMenuVisible())&&$.setDefaultContextualMenuVisibility(!1),(we=$.isOpenWithMenuAvailable())||$.setOpenWithMenuAvailability(!0),await async function(){var e=h.getPreferenceManager({context:$.getFrameWindow()});if(e){if(e.setUnitsPreferencesDisplayFlag(!0),e.setDisplayPreferencesDisplayFlag(!0),e.set3DSelectionPreferencesDisplayFlag(!0),e.set2DSelectionPreferencesDisplayFlag(!0),e.setExportPreferencesDisplayFlag(!0),e.addPreferences([{nls:N.preferences.reviewSectionTitle,id:"ReviewPreferences",type:"section",preferences:[{nls:N.preferences.reviewQuickCreationLbl,id:"DisplayReviewCreationDialog",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_DisplayReviewCreationDialog")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_DisplayReviewCreationDialog"))&&localStorage.setItem("CATWebUXMePreferences_DisplayReviewCreationDialog",e?"true":"false")}},{nls:N.preferences.markupAutomaticCreationLbl,id:"AutomaticMarkupCreationDialog",type:"checkbox",getValue:function(){return"R3V"===K?"true"===localStorage.getItem("CATWebUXMePreferences_AutomaticMarkupCreationDialog"):"false"!==localStorage.getItem("CATWebUXMePreferences_AutomaticMarkupCreationDialog")},getDefaultValue:function(){return"R3V"===K},setValue:function(e){(e!==("true"===localStorage.getItem("CATWebUXMePreferences_AutomaticMarkupCreationDialog"))&&"R3V"===K||e!==("false"!==localStorage.getItem("CATWebUXMePreferences_AutomaticMarkupCreationDialog"))&&"R3R"===K)&&localStorage.setItem("CATWebUXMePreferences_AutomaticMarkupCreationDialog",e?"true":"false")}}]},{nls:N.preferences.markupSectionTitle,id:"MarkupPreferences",type:"section",preferences:[{nls:N.preferences.QuickCreationLbl,id:"CATWebUXMePreferences_DisplayMarkupCreationDialog",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_DisplayMarkupCreationDialog")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_DisplayMarkupCreationDialog"))&&localStorage.setItem("CATWebUXMePreferences_DisplayMarkupCreationDialog",e?"true":"false")}},{nls:N.preferences.automaticallyCreateFirstSlide,id:"CreateFirstSlide",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_CreateFirstSlide")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_CreateFirstSlide"))&&localStorage.setItem("CATWebUXMePreferences_CreateFirstSlide",e?"true":"false")}}]},{nls:N.preferences.handlesSectionTitle,id:"HandlesPreferences",type:"section",preferences:[{prefixnls:N.preferences.gridSpacingPrefix,suffixnls:N.preferences.gridSpacingSuffix,id:"SnapHandlesToGrid",type:"checkbox+spinbox",disableSpinboxAtUncheck:!0,getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SnapHandlesToGrid")},getSpinBoxValues:function(){var e=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapHandlesGridValue"));e=isNaN(e)?.001:e;var t=localStorage.getItem("CATWebUXMePreferences_Length")||"Millimeter";return{value:e="Inch"===(t="Foot"===t?"Inch":"Centimeter"===t||"Meter"===t||"Kilometer"===t?"Millimeter":t)||"Millimeter"===t?D.convert(e,"Length","Meter",t):e,units:t,minValue:"Millimeter"===t?1:.01,stepValue:"Millimeter"===t?1:.01}},getDefaultValue:function(){return!0},getSpinBoxDefaultValues:function(){return{value:1,units:"Millimeter",minValue:1,stepValue:1}},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SnapHandlesToGrid"))&&localStorage.setItem("CATWebUXMePreferences_SnapHandlesToGrid",e?"true":"false")},setSpinBoxValue:function(e){var t=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapHandlesGridValue"));e!==(t=isNaN(t)?1:t)&&localStorage.setItem("CATWebUXMePreferences_SnapHandlesGridValue",e)}},{prefixnls:N.preferences.rotSnappingPrefix,suffixnls:"("+N.preferences.rotSnappingSuffix+")",id:"SnapRotationToggle",type:"checkbox+spinbox",disableSpinboxAtUncheck:!1,getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SnapRotationToggle")},getSpinBoxValues:function(){var e=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapRotationAngle"));e=isNaN(e)?1.5708:e;var t=localStorage.getItem("CATWebUXMePreferences_Angle")||"Degree";return{value:e="Degree"===t?Math.round(D.convert(e,"Angle","Radian",t)):e,units:t,minValue:"Degree"===t?1:.01,stepValue:"Degree"===t?1:.01}},getDefaultValue:function(){return!0},getSpinBoxDefaultValues:function(){return{value:90,units:"Degree",minValue:1,maxValue:360,stepValue:1}},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SnapRotationToggle"))&&localStorage.setItem("CATWebUXMePreferences_SnapRotationToggle",e?"true":"false")},setSpinBoxValue:function(e){var t=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapRotationAngle"));e!==(t=isNaN(t)?90:t)&&localStorage.setItem("CATWebUXMePreferences_SnapRotationAngle",e)}}]}]),z.createSharedPreferences(e),e.setPreferredPreferenceContainersOrder(["ReviewPreferences","MarkupPreferences","SlidePreferences","HandlesPreferences","MarkerPreferences","MeasurePreferences","SectionPreferences"]),!$.getViewer().get2DMode()){try{let e=(await D.readPreferences([{Repository:"VisualizationRepository",PreferenceNames:["Gravity"]},{Repository:"FrameGeneral",PreferenceNames:["ProjectionType"]},{Repository:"SelectionRepository",PreferenceNames:["Select3DGeometry","SelectParentReferenceOr3DShape"]}])).repositories;for(let t=0;t<e.length;t++)if("VisualizationRepository"===e[t].name)re="true"===e[t].preferences[0].value;else if("FrameGeneral"===e[t].name)le=e[t].preferences[0].value;else if("SelectionRepository"===e[t].name){let n=e[t].preferences;for(let e=0;e<n.length;e++)"Select3DGeometry"===n[e].name?se="true"===n[e].value:"SelectParentReferenceOr3DShape"===n[e].name&&(de=n[e].value)}}catch(e){re=!1,le="Perspective",se=!1,de="selectParentReference",window.console.warn("Could not get server value, default value set instead.",e)}"boolean"==typeof re&&($.getViewer().currentViewpoint.getControl().setRotationRolling(!re),$.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!re)),"Perspective"!==le&&"Parallel"!==le||$.getViewer().currentViewpoint.setProjectionType("Perspective"===le?0:1),Pe&&Pe.setPicking(se?0:1),Pe&&Pe.selectParentReference("select3DShape"!==de)}ce=e.subscribe("com.ds.mep:onPrefUpdate",function(e){let t=JSON.parse(e[1].preferences);for(let e=0;e<t.repositories.length;e++)for(let n=0;n<t.repositories[e].preferences.length;n++)"SelectParentReferenceOr3DShape"===t.repositories[e].preferences[n].name?(de=t.repositories[e].preferences[n].value,Pe&&Pe.selectParentReference("select3DShape"!==de)):"Select3DGeometry"===t.repositories[e].preferences[n].name?(se="true"===t.repositories[e].preferences[n].value,Pe&&Pe.setPicking(se?0:1)):"ProjectionType"===t.repositories[e].preferences[n].name?(le=t.repositories[e].preferences[n].value,$&&$.getViewer()&&$.getViewer().currentViewpoint&&$.getViewer().currentViewpoint.setProjectionType(le)):"Gravity"===t.repositories[e].preferences[n].name&&(re="true"===t.repositories[e].preferences[n].value,$&&$.getViewer()&&$.getViewer().currentViewpoint&&$.getViewer().currentViewpoint.control&&($.getViewer().currentViewpoint.getControl().setRotationRolling(!re),$.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!re)))})}}(),$.getRootBagPath()&&$.getRootBagPath().getChildrenPathes().length&&ze({path:$.getRootBagPath().getChildrenPathes()[0]})}else{var U;if(b.unreferenceSelectionManager({context:$}),Pe=null,be&&be.destroy(),Me&&$.getViewer().setPicking(Me),Re&&$.getViewer().setPrePicking(Re),Re=null,Re=null,$.elements.container.removeEventListener("drop",nt),y=h.givePreferenceManager({context:$.getFrameWindow()})){for(U=Object.keys(oe),g=0;g<U.length;g++)y.unsubscribe(oe[U[g]]);oe={},y.removePreferences("R3V"===K?["MarkupPreferences","HandlesPreferences"]:["ReviewPreferences","HandlesPreferences"]),z.removeSharedPreferences(y)}if(h.unreferencePreferenceManager({context:$.getFrameWindow()}),Ne&&(clearTimeout(Ne),Ne=null),$.setLoadingDelegations({}),$.getFrameWindow().getActionBar().removeCallback(J),$.getFrameWindow().getContextualUIManager().unregister("3DReviewWebAppCtxElements"),void 0!==De&&$.setDefaultContextualBarVisibility(De),De=void 0,void 0!==ve&&$.setDefaultContextualMenuVisibility(ve),ve=void 0,void 0!==we&&$.setOpenWithMenuAvailability(we),we=void 0,void 0!==Ce&&$.setRobotVisibility(Ce),Ce=void 0,void 0!==Se&&$.getViewer().setSectionCapping(Se),Se=void 0,s.unreferenceDMUApplicativeContextManager({context:$}),fe=null,ue.isADocumentDisplayed())if(xe)(C=i.getReviewContext({context:$}))&&C.getCurrentSessionMarkup()&&C.setReadOnly(!0);else{ue.clean2DDocument(),Ve&&Ve.cleanCommentsPanel();for(var I=[],k=d.getRoots($),E=0;E<k.length;E++)I.push(d.getNodeID(k[E]));$.removeRoots({pids:I})}else(C=i.getReviewContext({context:$}))&&C.getCurrentSessionMarkup()&&(xe?C.setReadOnly(!0):C.getCurrentSessionMarkup().setActiveFlag(!1));for(c.empty(),u.empty(),U=Object.keys(te),g=0;g<U.length;g++)$.unsubscribe(te[U[g]]);if(te={},Y){for(U=Object.keys(ae),g=0;g<U.length;g++)Y.removeEvent(ae[U[g]]);i.unreferenceEventsController({viewer:$.getViewer()}),Y=null}if(ae={},Ee){for(U=Object.keys(ne),g=0;g<U.length;g++)Ee.unsubscribe(ne[U[g]]);ne={},Ee=null}X&&(X.clean(),X=null),ie&&($.getViewer().unsubscribe(ie),ie=null),ce&&(y.unsubscribe(ce),ce=null),xe||(o.removeManager({name:"DMU2DSheetManager",context:$.getFrameWindow()}),ue=null,Ve&&(m.unreferenceDMUCommentsController({context:$.getFrameWindow()}),Ve=null)),n.unreferenceLoadMarkupServices({context:$}),G=null}qe()}},this.disableDMUContextualBar=function(){$.getFrameWindow().getContextualUIManager().getContextualBar().hide()},this.enableDMUContextualBar=function(){},this.subscribe=function(e,t){if(e&&t&&ee)return ee.subscribe({event:e},t)},this.unsubscribe=function(e){ee&&e&&ee.unsubscribe(e)},this.getActiveState=function(){return Q},this.clearController=function(){Ae&&clearTimeout(Ae),z._setActiveState(!1),be=$=z=ee=te=Ue=Ae=null},this.loadMarkupContext=async function(e){var t=!1,n=i.getReviewContext({context:$});if(n){var a=n.getReviewCtxInformation();t=a&&a.contextId===e.objectId}const o=await Je(e.objectType);if(e.objectId&&!t){if(he===e.objectId)return void $.displayNotification({msg:N.documentAlreadyLoaded,eventID:"info"});var r;o&&o.length&&["SIMItfSimulation","PLMPIMMetricReference","Document","DIFLayout","DIFSheet","DIFAnnotationSet","Requirement","Requirement Specification","DesignSight"].some(function(e){if(-1!==o.indexOf(e))return r=e,!0})?(e.objectParentType=r||e.objectType,me.load({data:e}),-1!==o.indexOf("Document")&&(Ue=!0)):ze({docData:e})}},this.loadValidation=async function(e){await C.createReviewContext({context:$}),e.editionMode="R3V"===K,e&&G&&G.loadValidation(e)},this.appInitFromTransition=function(t){return new e.Promise(function(e){e()}).then(function(e){e||t.onNoActionDone()}).catch(t.onNoActionDone).finally(function(){void 0})},this.refreshContext=function(){var e=i.getReviewContext({context:$});e&&(e.refreshNode(),$.getViewer().render())},this.publish=function(e,t){Q&&setTimeout(function(){ee&&ee.publish({event:e,data:t,context:z})})},this.setappTransition=function(e){xe=e}},setControllerActiveState:async function(e){this._setActiveState&&await this._setActiveState(e)}})}),
/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/DMUReviewCommonWebApp/DMUCommonWebAppOptions",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Utils"],function(e,t,n,i){"use strict";return t.singleton(n,{init:function(){var t={};""!==window.location.search&&(e.extend(t,i.parseQuery(window.location.search)),t.widgetDomain&&e.extend(t,i.parseQuery(t.widgetDomain))),("debug_me"in t||window.debug)&&(t.debug=!0),("testWkb"in t||window.testWkb)&&(t.testWkb=!0),this.setOptions(t)}})}),define("DS/DMUReviewCommonWebApp/DMUCommonWebAppMain",["UWA/Core","DS/DMUControls/EXPNotify","DS/DMUReviewCommonWebApp/DMUCommonWebAppOptions","DS/DMUMeasurable/DMUToolsSceneGraph","DS/PADUtils/PADSettingsMgt","DS/ApplicationFrame/CommandsManager","DS/PADServices/views/LandingPage","DS/PADServices/utils/GlobalModelEvents","DS/EditPropWidget/constants/ConstantsMapping","DS/DMUReadPersistence/DMUWebServicesUtils","i18n!DS/DMUReviewCommonWebApp/assets/nls/DMUCommonWebAppMain"],function(e,t,n,i,a,o,r,l,s,d,c){"use strict";let u,g,p={widget:null,widgetLink:null,viewer:null,viewerAttachment:null};const m=[{key:"rvw",type:"DMUValidationValidation"},{key:"highlight",type:"DMUValidationExposedPresentation"},{key:"isr",type:"SIMItfSimulation"},{key:"itf",type:"PLMPIMMetricReference"},{key:"difLayout",type:"DIFLayout"},{key:"difSheet",type:"DIFSheet"},{key:"difAnnotSet",type:"DIFAnnotationSet"},{key:"doc",type:"Document"},{key:"req",type:"Requirement"},{key:"reqSpec",type:"Requirement Specification"},{key:"msr",type:"DesignSight"},{key:"pointClouds",type:"R2V_FeatureState"}],f=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier"];function h(){var e=this.params.widget.getValue("xsceneStoredObjects");return e&&"string"==typeof e||(e='{"products":{},"filters":{}}'),JSON.parse(e)}function D(e){e&&e.length&&(e[0].id.reviewId&&(e[0]=e[0].id,e[0].type&&"_DMUValidationValidation"===e[0].type&&(e[0].type="DMUValidationValidation"),e[0].type&&"_DMUValidationExposedPresentation"===e[0].type&&(e[0].type="DMUValidationExposedPresentation")),this.showWelcomePanel(!1),this.pad3DViewer.addRootNodesFromContent({json3DXContent:{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:e.map(function(e){return{envId:require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:e.reviewId?e.reviewId:e.id,objectType:"PointCloud"!==e.type?e.type:"R2V_FeatureState",displayName:e.displayName,serviceId:"PointCloud"!==e.type?void 0:"r2vsurvey"}})}}}))}async function v(e){try{let t=await d.getParentTypes(e);return[e].concat(t)}catch{return[e]}}async function w(e){let n=!0;if(e.length>1)for(const t of e){let e=await v(t["ds6w:type"]);if(!e.includes("VPMReference")&&!e.includes("R2V_FeatureState")){n=!1;break}}var i,a,o;n?D.call(this,e.map(function(e){return{id:e.resourceid,type:e["ds6w:type_value"],displayName:e["ds6w:label"]}})):(i="warning",a=c.dropMultiNoAutorized,o=this.pad3DViewer,g&&(g.destroy(),g=null),g=new t({body:o.getFrameWindow().getUIFrame(),type:i,message:a}))}function C(e){if(e&&e.length){l.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:e.map(function(e){return{resourceid:e,openWithFilter:!1,loading:!0,fromCustom:!0}})}});var t=setInterval(function(){this.isAppReady&&this.welcomePanel&&(clearInterval(t),function(e,t){require("DS/WAFData/WAFData").authenticatedRequest(require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx")},data:JSON.stringify({physicalid:e,label:"M3DFetchForWelcomePanel"+Date.now(),select_predicate:f,select_file:["icon","thumbnail_2d"]}),onComplete:t,onFailure:function(){},onTimeout:function(){}})}(e,function(e){if(this.welcomePanel){var t=((e?JSON.parse(e):{}).results||[]).map(function(e){var t={},n=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),i=n.getRoots(this.pad3DViewer).map(function(e){return n.getNodeID(e)}),a=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:this.pad3DViewer}),o=a?a.getReviewCtxInformation():{};o&&o.reviewId&&i.push(o.reviewId),o&&o.highlightId&&i.push(o.highlightId),this.pad3DViewer.getApplicativeData().getLoadedItfData&&this.pad3DViewer.getApplicativeData().getLoadedItfData().data.forEach(function(e){i=i.concat(e.metricID.length?e.metricID:[e.isrID])}),e.attributes.forEach(function(e){t[e.name]=e.value});var r={resourceid:t.resourceid,label:t["ds6w:label"],icons:[t.type_icon_url],thumbnail:t.preview_url,grid:t,subLabel:t["ds6w:responsible"]+" | "+new Date(t["ds6w:modified"]).toLocaleString(),description:t["ds6w:identifier"],openWithFilter:!1,fromCustom:!0,loading:void 0,opened:i.indexOf(t.resourceid)>-1,item2Load:{}};r.item2Load[r.resourceid]={};let l=t["ds6w:type"];return"SIMItfSimulation"!==l&&"PLMPIMMetricReference"!==l&&"DIFAnnotationSet"!==l||(r.addRemoveFromViewCtx=!0),r}.bind(this));l.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:t}})}}.bind(this)))}.bind(this),100)}}function S(e){this.isAppReady=!1,this.params=e,this.welcomePanel=this.pad3DViewer=this.reviewCtrl=null,this.tokensWelcomePanel=[],this.tokensPAD=[],this.tokensMkp=[],this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/LandingPage/refreshCustom"},C.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/LandingPage/openCustom"},function(e){var t=h.call(this),n=[];e.customitem2open.forEach(function(e){m.some(function(i){if(t[i.key]&&t[i.key][e])return n.push({id:e,type:i.type}),!0})}),D.call(this,n)}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/LandingPage/removeFromView"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=t.getRoots(this.pad3DViewer).map(function(e){return t.getNodeID(e)}),i=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:this.pad3DViewer}),a=i?i.getReviewCtxInformation():{},o=a?a.reviewId:null,r=[];this.pad3DViewer.getApplicativeData().getLoadedItfData&&(r=this.pad3DViewer.getApplicativeData().getLoadedItfData().data),this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd&&e.customitem2remove.forEach(e=>{this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd(e)}),e.customitem2remove.indexOf(o)>-1&&require(["DS/DMUBaseExperience/DMUContextManager"],function(e){e.removeReviewContext({context:p.viewer});let t=e.giveEventsController({viewer:p.viewer.getViewer()});t&&t.fireEvent("onDMURemoveSessionReview")}),r.forEach(function(t){(t.metricID.length?t.metricID:[t.isrID]).some(function(n){if(e.customitem2remove.indexOf(n)>-1)return this.pad3DViewer.getApplicativeData().removeIsrKeepContext(t.isrID),!0},this)},this),n.forEach(function(t){e.customitem2remove.indexOf(t)>-1&&this.pad3DViewer.removeRoots({pids:[t]})},this)}}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/LandingPage/removeFromStore"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=h.call(this),n=[];e.customitem2remove.forEach(function(e){m.some(function(i){if(t[i.key]&&t[i.key][e]&&-1===n.indexOf(e))return n.push(e),delete t[i.key][e],!0})}),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),l.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:n}})}}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelHighlights"},function(){r.launchSearch({title:c.highlights,precondition:'flattenedtaxonomies:"types/DMUValidationExposedPresentation"',showApplyButton:!1,ok:w.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRvw"},function(){r.launchSearch({title:c.rvw,precondition:'flattenedtaxonomies:"types/DMUValidationValidation"',showApplyButton:!1,ok:w.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelIsr"},function(){r.launchSearch({title:c.isr,precondition:'flattenedtaxonomies:"types/SIMItfSimulation"',showApplyButton:!1,ok:w.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelItf"},function(){r.launchSearch({title:c.itf,precondition:'flattenedtaxonomies:"types/PLMPIMMetricReference"',showApplyButton:!1,ok:w.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDrw"},function(){r.launchSearch({title:c.drw,precondition:'flattenedtaxonomies:"types/Drawing"',showApplyButton:!1,ok:w.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFLayout"},function(){r.launchSearch({title:c.difLayout,precondition:'flattenedtaxonomies:"types/DIFLayout"',showApplyButton:!1,ok:w.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFSheet"},function(){r.launchSearch({title:c.difSheet,precondition:'flattenedtaxonomies:"types/DIFSheet"',showApplyButton:!1,ok:w.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFAnnotationSet"},function(){r.launchSearch({title:c.difAnnotSet,precondition:'flattenedtaxonomies:"types/DIFAnnotationSet"',showApplyButton:!1,ok:w.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDocument"},function(){r.launchSearch({title:c.doc,precondition:'flattenedtaxonomies:"types/Document"',showApplyButton:!1,ok:w.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirement"},function(){r.launchSearch({title:c.req,precondition:'flattenedtaxonomies:"types/Requirement"',showApplyButton:!1,ok:w.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirementSpec"},function(){r.launchSearch({title:c.reqSpec,precondition:'flattenedtaxonomies:"types/Requirement Specification"',showApplyButton:!1,ok:w.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelMsr"},function(){r.launchSearch({title:c.msr,precondition:'flattenedtaxonomies:"types/DesignSight"',showApplyButton:!1,ok:w.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelPrefCmd"},function(){if("true"===localStorage.getItem("CATWebUXMePreferenceImplementation")){require(["DS/MePreferencesClientAPI/MePreferencesClientAPI"],function(e){if(e&&e.getMePreferencesDialog){const t=window.widget.getValue("appId");e.getMePreferencesDialog(`3DSApp.${t}`).then(e=>{this.showWelcomePanel(!1),e.inject(this.pad3DViewer.getFrameWindow().getImmersiveFrame().getContent())})}}.bind(this))}else require(["DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(e){var t=e.givePreferenceManager({context:this.pad3DViewer.getFrameWindow()});if(t){var n=t.subscribe("onPreferencesPanelDestroyed",function(){t.unsubscribe(n),this.showWelcomePanel(!0)}.bind(this));this.showWelcomePanel(!1),t.displayPreferencePanel(this.pad3DViewer.getFrameWindow())}}.bind(this))}.bind(this))),"R3V"===u&&this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelNewActivity"},function(){var e=o.getCommand("DMUReviewHdr",this.pad3DViewer.getCommandContext());this.showWelcomePanel(!1),e.begin()}.bind(this)));var t=r.getDefaultActivities();t.activities[0].section.actions.splice(2,0,{id:"welcomePanelRvw",title:c.rvw,icon:"review"}),t.activities[0].section.actions.splice(3,0,{id:"welcomePanelHighlights",title:c.highlights,icon:"highlight-review"}),t.activities[0].section.actions.splice(6,0,{id:"welcomePanelDIFAnnotationSet",title:c.difAnnotSet,icon:"annotation"}),t.activities[0].section.actions.splice(7,0,{id:"welcomePanelIsr",title:c.isr,icon:"interference-simulation"}),t.activities[0].section.actions.splice(8,0,{id:"welcomePanelItf",title:c.itf,icon:"interference-metric"}),t.activities[0].section.actions.splice(9,0,{id:"welcomePanelMsr",title:c.msr,icon:"physics-simulation"}),t.activities[0].section.actions.splice(10,0,{id:"welcomePanelDrw",title:c.drw,icon:"drawing"}),t.activities[0].section.actions.splice(11,0,{id:"welcomePanelRequirementSpec",title:c.reqSpec,icon:"requirement-specification"}),t.activities[0].section.actions.splice(12,0,{id:"welcomePanelRequirement",title:c.req,icon:"requirement"}),t.activities[0].section.actions.splice(13,0,{id:"welcomePanelDIFLayout",title:c.difLayout,icon:"fl-diagrams"}),t.activities[0].section.actions.splice(14,0,{id:"welcomePanelDIFSheet",title:c.difSheet,icon:"fl-diagram"}),t.activities[0].section.actions.splice(15,0,{id:"welcomePanelDocument",title:c.doc,icon:"doc"}),"R3V"===u&&t.activities.push({section:{id:"NewActivitySection",title:c.startNewActivity,actions:[{id:"welcomPanelNewActivity",title:c.newReview,icon:"review"}]}}),t.activities.push({section:{id:"customizeAppSection",title:c.customApp,actions:[{id:"welcomPanelPrefCmd",title:c.prefs,icon:"cog"}]}}),this.welcomePanel=new r({widget:e.widget,readOnlyApp:!1,renderDiv:e.renderDiv,externalViewerMgt:!0,externalViewerMgtCB:function(e,t){!0!==t&&this.showWelcomePanel("viewer"!==e)}.bind(this),globalSearchPrecond:'flattenedtaxonomies:"types/DMUValidation" OR flattenedtaxonomies:"types/DMUValidationExposedPresentation" OR flattenedtaxonomies:"types/SIMItfSimulation" OR flattenedtaxonomies:"types/PLMPIMMetricReference" OR flattenedtaxonomies:"types/DIFLayout" OR flattenedtaxonomies:"types/DIFSheet" OR flattenedtaxonomies:"types/DIFAnnotationSet" OR flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference" OR flattenedtaxonomies:"types/ENOStrRefinementSpecification" OR (flattenedtaxonomies:"types/Document" AND [ds6w:docextension]:(pdf OR dxf OR dwg)) OR flattenedtaxonomies:"types/Requirement" OR flattenedtaxonomies:"types/Requirement Specification"',defaultActionId:t.defaultActionId,activities:t.activities,onLandingPageReady:e.onLandingPageReady})}var b;S.prototype={constructor:S,initialize:function(){var e=this.welcomePanel.initialize();return e.then(function(){var e=h.call(this),t=Array.prototype.concat.apply([],m.map(function(t){return Object.keys(e[t.key]||[])}));C.call(this,t)}.bind(this)),e},setViewer:function(e){this.pad3DViewer=e,!this.params.initApp&&this.showWelcomePanel(!1);var t=e.render().getContent(),n=t.parentNode;t.style.position="relative",!this.params.renderDiv.parentNode&&n&&n!==this.params.renderDiv&&n.insertBefore(this.params.renderDiv,n.firstChild),this.params.renderDiv.insertBefore(t,this.params.renderDiv.firstChild),this.welcomePanel&&(this.params.renderDiv.insertBefore(this.welcomePanel.elements.mainBody,this.params.renderDiv.firstChild),this.welcomePanel.setViewer(e,!this.params.initApp)),this.tokensPAD.push(e.subscribe({event:"onRootAdded"},function(t){var n=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),i=t.id,a=e.getController().getNode({id:i}),o=n.getNodeType(a);if("R2V_FeatureState"===o||"DesignSight"===o||"DIFLayout"===o||"DIFSheet"===o||"Document"===o||"Requirement"===o||"Requirement Specification"===o){"DesignSight"===o?this.params.widget.setValue("mkpSession",JSON.stringify({type:"msr",plmType:o,id:i})):this.params.widget.setValue("mkpSession",JSON.stringify({type:"Document"===o||"Requirement"===o||"Requirement Specification"===o?o:"2D",plmType:o,id:i}));var r=h.call(this);r[o="DIFLayout"===o?"difLayout":"DIFSheet"===o?"difSheet":"Requirement"===o?"req":"Requirement Specification"===o?"reqSpec":"DesignSight"===o?"msr":"R2V_FeatureState"===o?"pointClouds":"doc"]||(r[o]={}),r[o][i]={},this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(r)),this.showWelcomePanel(!1),C.call(this,[i])}}.bind(this))),this.tokensPAD.push(e.subscribe({event:"onRootRemoved"},function(e){var t=h.call(this);["difLayout","difSheet","doc","req","reqSpec","msr"].some(function(n){return t[n]&&t[n][e.id]})&&(C.call(this,[e.id]),this.params.widget.deleteValue("mkpSession"))}.bind(this))),require(["DS/DMUBaseExperience/DMUContextManager"],function(t){var n=t.getEventsController({viewer:e.getViewer()});this.tokensMkp.push(n.addEvent("onReviewCtxInformationChanged",function(e){var t=h.call(this);t.rvw||(t.rvw={}),t.highlight||(t.highlight={}),"DMUValidationValidation"===e.reviewType?t.rvw[e.reviewId]={}:"DMUValidationExposedPresentation"===e.reviewType&&(t.highlight[e.highlightId]={}),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),C.call(this,[e.reviewId])}.bind(this))),this.tokensMkp.push(n.addEvent("onReviewRemoved",function(e){var t=h.call(this);e&&t.rvw&&t.rvw[e.reviewId]&&C.call(this,[e.reviewId]),e&&e.highlightId&&t.highlight&&t.highlight[e.highlightId]&&C.call(this,[e.highlightId]),this.params.widget.deleteValue("reviewIdInSession")}.bind(this)))}.bind(this))},appReady:function(e){if(this.reviewCtrl=e,this.isAppReady=!0,this.params.initApp){let l=this.params.widget.getValue("X3DContentId"),s=this.params.widget.id.indexOf("preview")>-1;if(this.params.widget.deleteValue("X3DContentId"),l)e.appInitFromTransition({x3dContent:JSON.parse(l),onNoActionDone:function(){setTimeout(function(e){var t=JSON.parse(l);(t.data&&t.data.items||[]).forEach(function(e){("Drawing"===e.objectType||e.objectTaxonomies&&e.objectTaxonomies.indexOf("Drawing")>-1)&&delete e.path}),e.addRootNodesFromContent({json3DXContent:t,dispatch:!1})},0,this.pad3DViewer)}.bind(this)});else if(!0===this.params.widget.getValue("autoreload")||!0===this.params.widget.getValue("autoreloadPreviewApp")&&!s){var t=this.params.widget.getValue("reviewIdInSession");if(t){var n=JSON.parse(t);"_DMUValidationExposedPresentation"===n.objectType?D.call(this,[{id:JSON.parse(t),type:"DMUValidationExposedPresentation"}]):"_DMUValidationValidation"===n.objectType?D.call(this,[{id:JSON.parse(t),type:"DMUValidationValidation"}]):D.call(this,[{id:JSON.parse(t),type:"Markup"}])}else{var i=this.params.widget.getValue("mkpSession");if((i=i?JSON.parse(i):null)&&"ITF"===i.type){var a=this.params.widget.getValue("ItfSimuInSession");if((a=a?JSON.parse(a):null)&&!Array.isArray(a)&&"object"==typeof a){var o=Object.keys(a);if(1===o.length){var r=o[0];Array.isArray(a[r])&&a[r].length?D.call(this,a[r].map(function(e){return{id:e,type:"PLMPIMMetricReference"}})):D.call(this,[{id:r,type:"SIMItfSimulation"}])}}}else i&&i.id&&("2D"===i.type||"Document"===i.type||"msr"===i.type)&&D.call(this,[{id:i.id,type:i.plmType}])}}s?this.params.widget.setValue("autoreloadPreviewApp",!0):this.params.widget.deleteValue("autoreloadPreviewApp")}var l=this.welcomePanel.appReady();return this.welcomePanel.redraw(),l},dispose:function(){if(this.showWelcomePanel(!1),this.welcomePanel){var e=require("DS/DMUBaseExperience/DMUContextManager").getEventsController({viewer:this.pad3DViewer.getViewer()});this.tokensMkp.forEach(e.removeEvent,e),this.tokensMkp=[],this.tokensPAD.forEach(this.pad3DViewer.unsubscribe,this.pad3DViewer),this.tokensPAD=[],this.pad3DViewer=this.params=null,this.tokensWelcomePanel.forEach(l.unsubscribe,l),this.tokensWelcomePanel.length=0;var t=this.welcomePanel.dispose();return this.welcomePanel=null,t}},showWelcomePanel:function(e){this.welcomePanel&&(this.welcomePanel.elements.mainBody.style.position="relative",this.welcomePanel.elements.mainBody.style.display=e?"":"none",e&&this.welcomePanel.redraw())}};var y,M,R,P,V=!1,A="CATCmdWorkbench",U=n.getOption("testWkb");function I(){return p.widget.getValue(A)}function x(e){p.widget.setValue(A,e)}function k(){p.viewer.getContentName({callbacks:{onComplete:function(e){p.widget.setTitle(e.contentName)},onFailure:function(){}}})}var E=[],F=function(e){E.push(e),1===E.length&&function e(t){var n={lastCommand:[],currentCommand:null,defaultCommand:null},i=p.viewer.getCommandContext?p.viewer.getCommandContext():null;i?o._commandsState[i]=n:o._commandsState=n,o.resetDefaultCommand(i),o._isCommandEnding=!1,o._ignoreCommandBeginWhileEndingCommand=!1,["_commands","_cmdCheckHeader"].forEach(function(e){var t=i?o[e][i]:o[e];Object.keys(t).forEach(function(e){var n=t[e];n&&n._destroy&&n._destroy(),delete t[e]})});var a=0,r=t.viewer.getFrameWindow().getActionBar(),l=r.onActionBarReady(function(){++a<t.afr.wkb.length&&t.merge?t.viewer.loadActionBar({merge:!0,file:t.afr.wkb[a].file,module:t.afr.wkb[a].module}):(r.removeCallback(l),t.viewer.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClicAfterCSOChange(),o.setDefaultCommand({ID:"R3R"===u?"DMUReviewWebAppDefaultHdr":"DMUValidationWebAppDefaultHdr",className:"R3R"===u?"DS/DMUReviewWebApp/DMUReviewWebAppDefaultCmd":"DS/DMUValidationWebApp/DMUValidationWebAppDefaultCmd",context:i}),t.actionBarReadyCb&&t.actionBarReadyCb(),t.options&&t.options.done({appMainDiv:M,pad3DViewer:t.viewer})),t.merge&&a!==t.afr.wkb.length||(E.shift(),E.length&&e(E[0]))});t.viewer.loadActionBar({merge:!1,file:t.afr.wkb[0].file,module:t.afr.wkb[0].module})}(E[0])};async function O(e){e&&(e.subscribe("onReviewContextModified",function(e){var t=e.onABReady?e.onABReady:function(){},n=I();if("Data"===e.type){if("3D"===e.data.wkb){for(var i=!1,a=0;a<P.wkb3D.wkb.length;a++)P.wkb3D.wkb[a].file===e.data.file&&P.wkb3D.wkb[a].module===e.data.module&&(i=!0);i||(P.wkb3D.wkb.push({file:e.data.file,module:e.data.module}),"3D"===n&&F({merge:!0,afr:U?P.wkb3DTst:P.wkb3D,viewer:p.viewer,actionBarReadyCb:t}))}}else"RefreshAB"===e.type?F({merge:!0,afr:P["wkb"+n],viewer:p.viewer,actionBarReadyCb:t}):("ITF"===e.type||"MSR"===e.type||"R2V"===e.type||"Document"===e.type||"Requirement"===e.type||"Requirement Specification"===e.type||e.type!==n&&P["wkb"+e.type])&&(F({merge:!0,afr:P["wkb"+e.type+(U&&P["wkb"+e.type+"Tst"]?"Tst":"")],viewer:p.viewer,actionBarReadyCb:t}),e.type.contains("Formats")||x(e.type));"ITF"===e.type?p.widget.setValue("mkpSession",JSON.stringify({type:e.type})):"Data"===e.type&&p.widget.deleteValue("mkpSession")}),await e.setActiveState(!0))}var T,_,W,L=function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(e,t){(T=e).renderDiv||T.initialize2(p.viewer.getFrameWindow().getViewerFrame(),t.appId(),p.widget.getValue("changeControlActivation")?"show":"hide","top-right",function(){T.addEvent("onAuthoringCtxVisible",function(e){e.showAuthoringContext&&p.widget.setValue("changeControlActivation",!0)})})})},N=function(e){require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSharedSettings","DS/DMUBaseExperience/DMUContextManager","i18n!DS/PADUtils/assets/nls/PADUtils"],function(t,i,o,r){var l,s=[],d=[];W=function(){p.widget.setPreferences([]),l.destroy(),s.forEach(function(e){e.cb&&a.removeEvent(e.cb,e.padFct)}),W=function(){}},_=function(){if(s.forEach(function(e){var t=e.preference.name,n=p.widget.getValue(t),i=a.getSetting(t);(n="boolean"===e.preference.type&&"boolean"!=typeof n?"true"===n:n)!==i&&a.setSetting(t,n),e.fct&&e.fct(n)}),a.updateWidgetPreferences(),!l&&s.length){let e=o.giveEventsController({viewer:p.viewer.getViewer()});l=t.create({events:{onPreferenceModification:function(e){s.some(function(t){if(e.name===t.preference.name){if("boolean"!=typeof e.value&&"string"!=typeof e.value)throw new Error("Value must be a string or a boolean");if(a.getSetting(e.name)!==e.value){if("boolean"===t.preference.type&&"boolean"!=typeof e.value)throw new Error("Preference is a boolean type so value must be a boolean");t.debounce=!0,p.widget.setValue(e.name,e.value),a.setSetting(e.name,e.value)}return t.fct&&t.fct(e.value),!0}})},onSelect:function(t){e&&e.fireEvent("onCrossWidgetSelection",t)}}}),p.widgetLink&&p.widgetLink.subscribe("DS/ExternalWdgtCom/Find",t=>{e&&e.fireEvent("onCrossWidgetFind",t)}),e&&(e.addEvent("onFireCrossWidgetSelection",e=>{l&&l.select(e)}),e.addEvent("onFireCrossWidgetFind",e=>{e&&e.paths&&e.paths.length&&p.widgetLink&&p.widgetLink.publish("DS/ExternalWdgtCom/Find",{paths:e.paths})})),s.forEach(function(e){e.cb&&a.addEvent(e.cb,e.padFct=function(t){e.debounce?e.debounce=!1:l.preferenceModification({name:e.preference.name,value:t})})})}},p.widget.setPreferences([]),a.setSetting("syncAutoReload",!0),i.destroy(),i.addSharedSettings(p.widget),s.push({preference:{name:"changeControlActivation",type:"boolean",label:r.changeControlActivation_label,defaultValue:!1},fct:function(e){T&&T[e?"show":"hide"]()},cb:"onChangeControlActivation",debounce:!1}),s.push({preference:{name:"changeControlPosition",type:"list",label:r.changeControlPosition_label,defaultValue:"top-right",options:[{label:r["top-right_label"],value:"top-right"},{label:r["top-left_label"],value:"top-left"},{label:r["bottom-left_label"],value:"bottom-left"},{label:r["bottom-right_label"],value:"bottom-right"}]},fct:function(e){T&&T.setPosition(e)}}),a.setSetting("authorizeChangeControl",!0),e&&L(),n.getOption("debug")?(s.push({preference:{name:"populateTags",type:"boolean",label:r.activateFilter_label,defaultValue:!1},fct:function(e){var t=p.viewer.getBIController();t&&t.toggleBetweenStandaloneAndSlaveMode(e?"STANDALONE":"SLAVE")}}),s.push({preference:{name:"webapi_timeout",type:"text",label:"Query timeout",defaultValue:"60000"}})):d=["populateTags","webapi_timeout"],d.forEach(function(e){p.widget.deleteValue(e)}),d.length=0,s.forEach(function(e){p.widget.mergePreferences([e.preference])}),_(),p.widget.addEvent("endEdit",_)})},j=function(e){e.unsubscribe(y),y=null,k(),L(),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&e.getViewer().displayIntroductoryControlPreferencePanel(),p.widget.getValue(A)||p.widget.addPreference({name:A,type:"hidden"});var t=!1,n=async function(){if(t){var n=b.getController({context:e});await O(n),R.appReady(n)}else t=!0};require([p.controller],function(e){b=e,n()}),setTimeout(function(){"1"===p.widget.getValue("widgetForODTReplay")&&(p.widgetViewer3DReview._viewer3DReview=e),p.widget.dispatchEvent("onWidgetAndAppReady","1"===p.widget.getValue("widgetForODTReplay")?[{pad3DViewer:p.viewer}]:void 0),n()}),p.viewerAttachment&&p.viewerAttachment(M),p.viewerAttachment=null,e.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClicAfterCSOChange()};function B(t){return M||(M=e.createElement("div",{class:"appMain",styles:{width:"auto",height:"100%"}})),(R=new S({widget:p.widget,readOnlyApp:!1,renderDiv:M,initApp:t&&t.initApp,onLandingPageReady:t&&t.onLandingPageReady})).initialize()}function X(e){e&&"string"==typeof e.reviewId&&p.widget.setValue("reviewIdInSession",JSON.stringify(e))}function q(){if(a&&a.setSetting("activateWidgetLink",!0),!p.viewer){var e=new Promise(function(e){B({initApp:!0,onLandingPageReady:function(){p.viewerAttachment(M),p.viewerAttachment=null}}).then(e)}),t=new Promise(function(e){require(["DS/ENOPAD3DViewer/PAD3DViewer","text!DS/DMUReviewCommonWebApp/assets/DMUCommonWebApp.json"],function(t,n){e([t,n])})}),n=new Promise(e=>{require(["DS/ENOXInterWdgCom/LinkManager"],t=>{p.widgetLink=t,t.initializeWidgetLink(p.widget,{appIds:[],uses:["ENXContent","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"],open:!0}).then(e)})});Promise.all([e,t,n]).then(function(e){var t=JSON.parse(e[1][1]);t.context="Default",t.mouseProfile=require("DS/PADUtils/PADUtilsServices").isCloud()?window.__mouseProfile:"CATIA";var n=I();t.workbenchModule="2D"===n||"ITF"===n||"MSR"===n||"R2V"===n||"Document"===n||"2DFL"===n||"ReviewNoContext"===n?P["wkb"+n].wkb[0].module:P.wkb3D.wkb[0].module,t.workbench="2D"===n||"ITF"===n||"MSR"===n||"R2V"===n||"Document"===n||"2DFL"===n||"ReviewNoContext"===n?P["wkb"+n].wkb[0].file:P.wkb3D.wkb[0].file;var i={widget:p.widget,windowOptions:t,enableFiltering:!0,binaryPrimitives:!0,enableSidePanel:!0,readyCB:N,authorizedRootTypes:["MCAD Assembly","MCAD Component","VPMReference","VPMRepReference"],visuProgressiveTileModel:!0},o=p.viewer=new e[1][0](i);t.mouseProfile&&o.getViewpoint().setDefaultController(!0,t.mouseProfile),R.setViewer(o);var r=a.getSetting("propertiesFacet"),l=s.getMapping();l&&(l.physicssimulation.alwaysVisible=!1,r.push(l.physicssimulation)),o.setOption("propertiesFacet",r),o.setAuthorizedRootTypes(a.getSetting("ups_authorized_root_types")),y=o.subscribe({event:"onReady"},j),o.subscribe({event:"onRootAdded"},k),o.subscribe({event:"onRootRemoved"},k),o.subscribe({event:"onRootAttached"},k),o.subscribe({event:"onRootDetached"},k),o.subscribe({event:"onContentNameModified"},k),a.setSetting("settypes",!0),a.setSetting("syncAutoReload",!0),"1"===p.widget.getValue("widgetForODTReplay")&&p.widget.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:o}]),p.widgetInitDone&&p.widgetInitDone({appMainDiv:M,pad3DViewer:o})})}}function H(){if(!1===V&&p.viewer){var e=p.widget.getValue("reviewIdInSession");e=e?JSON.parse(e):void 0,p.viewer.refresh();var t,n,a=i.getRoots(p.viewer),o=!1;for(let e=0;e<a.length;e++)if(""!==i.getNodeID(a[e])&&(t=i.getNodeID(a[e]),"Document"===(n=i.getNodeType(a[e]))||"Requirement"===n||"Requirement Specification"===n||"DIFSheet"===n||"DIFLayout"===n)){o=!0;break}if(o)var r=p.viewer.subscribe({event:"onRefreshCompleted"},function(){p.viewer.unsubscribe(r);var e=p.viewer.options.visuProgressiveTileModel?[{rootID:t,structure:{rootStats:{infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:t,"ds6w:type":n,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",boundingbox:{max:[-1,-1,-1],min:[1,1,1]}},{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:1}}]},infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:t,"ds6w:type":n,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",nbchildren:"0"}]}}]:[{rootID:t,structure:{rootId:n,results:[{attributes:[{name:"did",value:t},{name:"physicalid",value:t},{name:"ds6w:type",value:n}]},{path:[t]}]}}];p.viewer.loadJSON({data:e})});else"DesignSight"===n&&p.viewer.publish({event:"widgetReresh",data:{objectId:t,objectType:n}});var l=p.viewer.subscribe({event:"onLoadingComplete"},function(){p.viewer.unsubscribe(l),X(e);var t=p.widget.getValue("reviewIdInSession");t&&b&&b.giveController({context:p.viewer}).loadReviewAfterRefresh(JSON.parse(t))})}}function G(){V=!0}function J(){if(b){var e=b.giveController({context:p.viewer});e&&e.refreshContext()}V=!1}function z(){R&&R.dispose(),R=null,p.viewer&&(b&&b.unreferenceController({context:p.viewer}),p.viewer.destroy()),p={widget:null,viewer:null,viewerAttachment:null},b=null}function Q(e){p.viewer&&p.viewer.search({searchQuery:e})}var K=function(e){if(p.widget=e.widget,M=e.appMainDiv,p.widgetInitDone=e.done,p.data=e.data.wkb?e.data.wkb:e.data,p.controller=e.data.controller?e.data.controller:e.controller,P=e.data.wkb?e.data.wkb:e.data,u=e.data.appId?e.data.appId:e.appId,e.pad3DViewer){p.viewer=e.pad3DViewer;var t=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:e.pad3DViewer}),n=t?t.getReviewCtxInformation():null;n&&n.reviewId&&X(n.reviewId)}else e.viewerAttachment?(p.viewerAttachment=e.viewerAttachment,q()):(p.viewerAttachment=function(e){p.widget.setBody(e)},p.widget.addEvent("onLoad",q)),p.widget.addEvent("onEdit",G),p.widget.addEvent("endEdit",J),p.widget.addEvent("onRefresh",H),p.widget.addEvent("onDestroy",z),p.widget.addEvent("onSearch",Q),"1"===p.widget.getValue("widgetForODTReplay")&&(p.widgetViewer3DReview=this),p.widget.addEvent("onDMUReviewLoaded",X),p.widget.setMetas({helpPath:"DMUReviewWebApp/assets/help"})};return K.prototype.setUp=function(e){function t(){require([p.controller],function(t){var n=(b=t).getController({context:p.viewer});(async()=>{await O(n),B().then(function(){R.setViewer(p.viewer),R.appReady(n)}),e.sourceApp&&e.sourceApp.issues&&1===e.sourceApp.issues.length&&n.appInitFromTransition({issues:e.sourceApp.issues,onNoActionDone:function(){}})})()})}e.sourceApp&&e.sourceApp.pad3DViewer!==p.viewer&&(p.viewer=e.sourceApp.pad3DViewer),require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"]}),a.setSetting("activateWidgetLink",!0),p.widget.addEvent("onRefresh",H),p.widget.addEvent("onSearch",Q),p.widget.addEvent("onDMUReviewLoaded",X),p.widget.setMetas({helpPath:"DMUReviewWebApp/assets/help"}),e.sourceApp&&e.sourceApp.pad3DViewer!==p.viewer&&(p.viewer=e.sourceApp.pad3DViewer);var n=a.getSetting("propertiesFacet"),o=s.getMapping();o&&o.physicssimulation&&o.physicssimulation.facet&&(n.find(function(e){return!(!e||!e.facet||e.facet.name!==o.physicssimulation.facet.name)})||(o.physicssimulation.alwaysVisible=!1,n.push(o.physicssimulation))),p.viewer.setOption("propertiesFacet",n),p.viewer.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),N(p.viewer),p.viewer.getViewer().updateViewPanelUIConfiguration&&p.viewer.getViewer().updateViewPanelUIConfiguration({useShadingIllustration:!1,useOutline:!1}),k(),"3D"===I()||i.getRoots(p.viewer).length>0?(F({options:e,merge:!1,afr:P.wkb3D,actionBarReadyCb:t,viewer:p.viewer}),p.viewer.getViewer().set2DMode(!1),x("3D")):"2DFL"===I()?(F({options:e,merge:!1,afr:P.wkb2DFL,actionBarReadyCb:t,viewer:p.viewer}),x("2DFL")):"ReviewNoContext"===I()?(F({options:e,merge:!1,afr:P.wkbReviewNoContext,actionBarReadyCb:t,viewer:p.viewer}),x("ReviewNoContext")):(F({options:e,merge:!1,afr:P.wkb2D,actionBarReadyCb:t,viewer:p.viewer}),x("2D")),a.setSetting("dynamic_authorized_types",!0);var r=a.getSetting("unsupported_root_types");r.push("Drawing"),a.setSetting("unsupported_root_types",r)},K.prototype.dispose=function(e){if(a.setSetting("dynamic_authorized_types",!1),p.widget.removeEvent("onRefresh",H),p.widget.removeEvent("onSearch",Q),p.widget.removeEvent("endEdit",_),p.widget.removeEvent("onDMUReviewLoaded",X),W&&W(),R&&R.dispose(),R=null,p.viewer){var t=a.getSetting("propertiesFacet"),n=s.getMapping();if(n){var i=t.findIndex(function(e){return!(!e||!e.facet||e.facet.name!==n.physicssimulation.facet.name)});i>=0&&t.splice(i,1)}p.viewer.setOption("propertiesFacet",t),b&&b.unreferenceController({context:p.viewer,options:e})}P.wkb2D.wkb.length>1&&P.wkb2D.wkb.splice(1,P.wkb2D.wkb.length),P.wkb2DFL.wkb.length>1&&P.wkb2DFL.wkb.splice(1,P.wkb2DFL.wkb.length),P.wkb3D.wkb.length>1&&P.wkb3D.wkb.splice(1,P.wkb3D.wkb.length),P.wkb2DFormats.wkb.length>1&&P.wkb2DFormats.wkb.splice(1,P.wkb2DFormats.wkb.length),P.wkb2DFLFormats.wkb.length>1&&P.wkb2DFLFormats.wkb.splice(1,P.wkb2DFLFormats.wkb.length),P.wkb3DFormats.wkb.length>1&&P.wkb3DFormats.wkb.splice(1,P.wkb3DFormats.wkb.length),b=null},K.prototype.onWillLeave=function(e){if(p.viewer){var t=require("DS/DMUBaseExperience/DMUContextManager");if(t){var n=t.giveEventsController({viewer:p.viewer.getViewer()});n&&n.fireEvent("onLeavingR3RApp",{targetApp:e&&e.options?e.options.id:""})}}},K});