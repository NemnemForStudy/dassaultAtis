define("DS/WebVisuParameters/CSICustomNodeHandler",["UWA/Class","DS/Visualization/Node3D"],function(e,t){"use strict";return e.extend({init:function(){},handleMessage:function(e){return t()},handleUpdateMessage:function(e,t){}})}),define("DS/WebVisuParameters/HighlightTransactionUtils/HighlightTransactionXSO",["DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";var i=function(e){this._addedPaths=null,this._keyToPath=null,this._treeKeyToStruct=new Map,this._currentTreeKey=null,this.viewer=e,this._event="",this.highlightColor=null};return i.prototype._setTreeKey=function(e){var t=null;this._currentTreeKey=e,this._treeKeyToStruct.has(e)&&(t=this._treeKeyToStruct.get(e)),t||(t={keyToPath:new Map,addedPaths:new Map},this._treeKeyToStruct.set(e,t)),this._keyToPath=t.keyToPath,this._addedPaths=t.addedPaths},i.prototype.getPathFromKey=function(e){return this._keyToPath.get(e)},i.prototype._add=function(t){e.publish({event:"/VISU/SELECTION/CSI_"+this._event+"_ADD",data:{eventChannel:"/VISU/SELECTION/CSI_"+this._event+"_ADD",eventType:"@CSI_"+this._event+"_ADD",path:t,parameters:{highlightColor:this.highlightColor,viewer:this.viewer}}})},i.prototype.add=function(e){var t=e.hash(),i=this._addedPaths;this._keyToPath.set(t,e),i.has(t)?i.set(t,i.get(t)+1):(i.set(t,1),this._add(e))},i.prototype._remove=function(t){e.publish({event:"/VISU/SELECTION/CSI_"+this._event+"_REMOVE",data:{eventChannel:"/VISU/SELECTION/CSI_"+this._event+"_REMOVE",eventType:"@CSI_"+this._event+"_REMOVE",path:t,parameters:{highlightColor:this.highlightColor,viewer:this.viewer}}})},i.prototype.remove=function(e){var t=e.hash(),i=this._addedPaths;i.has(t)&&(i.set(t,i.get(t)-1),0===i.get(t)&&(i.delete(t),this._keyToPath.delete(t),this._remove(e)))},i.prototype.removeAll=function(){var e=this;this._addedPaths&&this._addedPaths.forEach(function(t,i,r){var n=e.getPathFromKey(i);if(n)for(var a=0;a<t;a++)e.remove(n)})},i}),define("DS/WebVisuParameters/GeometryParameterHelper",["UWA/Class","DS/CSIViewModelWebInterfaces/CSIVMClientGeometryParameter","DS/CSIViewModelWebInterfaces/CSIVMClientDrawGroupParameter","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/GraphicAttributeSet","DS/GPUFormats/VertexAttribute"],function(e,t,i,r,n,a,o){"use strict";var s=i.prototype.geomTypeValues,l=[0];const d={[s.unknown]:{glType:4,geomType:r.GeomTypeEnum.UNKNOWN},[s.unknown_0D]:{glType:0,geomType:r.GeomTypeEnum.UNKNOWN},[s.unknown_1D]:{glType:1,geomType:r.GeomTypeEnum.UNKNOWN},[s.unknown_2D]:{glType:4,geomType:r.GeomTypeEnum.UNKNOWN},[s.unknown_3D]:{glType:4,geomType:r.GeomTypeEnum.UNKNOWN},[s.edge]:{glType:1,geomType:r.GeomTypeEnum.EDGE},[s.wire_Edge]:{glType:1,geomType:r.GeomTypeEnum.WIRE_EDGE},[s.boundary_Edge]:{glType:1,geomType:r.GeomTypeEnum.BOUNDARY_EDGE},[s.sharp_Edge]:{glType:1,geomType:r.GeomTypeEnum.SHARP_EDGE},[s.smooth_Edge]:{glType:1,geomType:r.GeomTypeEnum.SMOOTH_EDGE},[s.hidden_Seam_Edge]:{glType:1,geomType:r.GeomTypeEnum.HIDDEN_SEAM_EDGE},[s.boundary_Point]:{glType:0,geomType:r.GeomTypeEnum.BOUNDARY_POINT},[s.sharp_Point]:{glType:0,geomType:r.GeomTypeEnum.SHARP_POINT},[s.smooth_Point]:{glType:0,geomType:r.GeomTypeEnum.SMOOTH_POINT},[s.hidden_Seam_Point]:{glType:0,geomType:r.GeomTypeEnum.HIDDEN_SEAM_POINT},[s.surfacic_Point]:{glType:0,geomType:r.GeomTypeEnum.SURFACIC_POINT},[s.free_Point]:{glType:0,geomType:r.GeomTypeEnum.FREE_POINT},[s.infinite_Face]:{glType:4,geomType:r.GeomTypeEnum.INFINITE_FACE},[s.face]:{glType:4,geomType:r.GeomTypeEnum.FACE}};var c=a.DefaultGASs.defaultGAS,h=a.DefaultGASs.transition;class u{constructor(e,t){this.parameter=e,this.version=t.version,this.hasGeomDecorations=t.hasGeomDecorations}getGeometry(e,t,i){var a=e.getDefaultMaterials(),o=(a.volume,a.surface,a.line,a.point,new r.BufferGeometryDS),u=!1;let g=!1;var p,f=[],m=0;for(var v in this.parameter.bufferPartitionValues){var y=this.parameter.bufferPartitionValues[v],S=this.parameter.getBufferPartition(y);if(S)if(y===this.parameter.bufferPartitionValues.vertexIndexArray){g=4===S.getBytePerElement();const e=S.getByteLength()/S.getBytePerElement();p=g?new Uint32Array(this.parameter.getBuffer(),S.getOffset(),e):new Uint16Array(this.parameter.getBuffer(),S.getOffset(),e),1===this.version&&(o[v]=p)}else if(y===this.parameter.bufferPartitionValues.primitiveDecorationArray)this.hasGeomDecorations&&(o.decorations=new Uint8Array(this.parameter.getBuffer(),S.getOffset(),S.getByteLength()));else{var _=new Float32Array(this.parameter.getBuffer(),S.getOffset(),S.getByteLength()/S.getBytePerElement());if(y===this.parameter.bufferPartitionValues.vertexUv2Array){for(var w=new Float32Array(3*_.length/2),I=0;I<_.length/2;I++)w[3*I]=_[2*I],w[3*I+1]=_[2*I+1],w[3*I+2]=0;_=w}o[v]=_}}var T=new n.SGRep({solid:t}),D=this.parameter.getDrawGroups(),C=[];for(I=0;I<D.length;I++){var P=D[I],E=P.getPrimitives();E=new Uint32Array(this.parameter.getBuffer(),E.getOffset(),E.getByteLength()/E.getBytePerElement());var M=d[P.getGeomType()],A=M.glType,b=M.geomType;P.getGeomType()===s.unknown_2D&&(u=!0);var V=[],O=[],N=new n.DrawingGroup(i?h:c,null,A,2===this.version?m:P.getStart(),P.getCount(),V,void 0,b,0);if(N.geometry=o,o.drawingGroups.push(N),2===this.version)for(var G=1===A&&b!==r.GeomTypeEnum.WIRE_EDGE?1:0,R=4+G+(z=this.hasGeomDecorations?1:0),x=0;x<E.length;x+=R){var H=E[x],F=E[x+1],L=!G||E[x+3+G],U=m;if(L)for(var B=H;B<H+F;B++)f[m]=p[B],f[m]>65535&&(g=!0),m++;else for(B=0;B<F-1;B++)f[m]=H+B,f[m+1]=H+B+1,(f[m]>65535||f[m+1]>65535)&&(g=!0),m+=2;var k=F>0?2*(F-1):0,W=new n.SGPrimitive({start:U,count:L?F:k,cgmId:E[x+2],rep:T,group:N});if(z)4294967294===(j=E[x+3+G+z])?W.decoration=l:4294967295!==j&&(W.decoration=j);V.push(W),O.push(E[x+3]),T._primitives.push(W)}else{var z;for(R=4+(z=this.hasGeomDecorations?1:0),x=0;x<E.length;x+=R){var j;W=new n.SGPrimitive({start:E[x],count:E[x+1],cgmId:E[x+2],rep:T,group:N});if(z)4294967294===(j=E[x+3+z])?W.decoration=l:4294967295!==j&&(W.decoration=j);V.push(W),O.push(E[x+3]),T._primitives.push(W)}}C.push(O)}if(2===this.version&&(o.vertexIndexArray=g?new Uint32Array(f):new Uint16Array(f)),!o.boundingBox){var X=[0,0,0],K=[0,0,0],J=o.vertexPositionArray;if(J){var Y=J.length;if(Y>=3){X=[J[0],J[1],J[2]],K=[J[0],J[1],J[2]];for(var Z=0;Z<Y;Z+=3)J[Z]<X[0]&&(X[0]=J[Z]),J[Z+1]<X[1]&&(X[1]=J[Z+1]),J[Z+2]<X[2]&&(X[2]=J[Z+2]),J[Z]>K[0]&&(K[0]=J[Z]),J[Z+1]>K[1]&&(K[1]=J[Z+1]),J[Z+2]>K[2]&&(K[2]=J[Z+2])}}X=new r.Vector3(X[0],X[1],X[2]),K=new r.Vector3(K[0],K[1],K[2]),o.boundingBox=new r.Box3(X,K),o.boundingSphere=new r.Sphere(K.clone().add(X).multiplyScalar(.5),K.clone().sub(X).multiplyScalar(.5).length())}return{geometry:o,primitiveIDs:C,is2Din3D:u}}updateGeometry(e){if(e){var t=e.getPrimitives();if(Array.isArray(t)&&0!==t.length){var i,r={},n=0;t.forEach(function(e){(i=e.getIdentificationObject())&&void 0!==(n=i.getLocalId())&&(r[n]=e)});for(var a=e._occurrences[0].renderable.geometry,o=0;o<a.length;o++)a[o].needsUpdate=!0;var s=a[0],l=s.vertexIndexArray,d=s.vertexPositionArray;if(l&&d){var c,h,u,g={};for(var p in this.parameter.bufferPartitionValues)if(h=this.parameter.bufferPartitionValues[p],(c=this.parameter.getBufferPartition(h))&&h!==this.parameter.bufferPartitionValues.vertexIndexArray){u=new Float32Array(this.parameter.getBuffer(),c.getOffset(),c.getByteLength()/c.getBytePerElement()),g[p]=u;for(o=0;o<a.length;o++){var f=a[o];(d=f.vertexPositionArray)&&!f[p]&&(f[p]=new Float32Array(d.length))}}var m,v=this.parameter.getDrawGroups();if(Array.isArray(v)&&1===v.length&&(m=v[0]),m){var y=m.getPrimitives();if(y){var S,_,w,I,T,D,C,P,E,M;y=new Uint32Array(this.parameter.getBuffer(),y.getOffset(),y.getByteLength()/y.getBytePerElement());for(var A=0;A<y.length;A+=3)if(n=y[A],_=y[A+1],w=y[A+2],(S=r[n])&&S.sgNode){l=(M=S.sgNode.getGroup().geometry).vertexIndexArray,d=M.vertexPositionArray;I=S.sgNode.getStart(),T=S.sgNode.getCount(),P=C=l[I];for(o=1;o<T;++o)(D=l[o+I])<C?C=D:D>P&&(P=D);if(E=3*(P-C+1),w&&w!==d.length||(w=E),E&&E===w)for(var p in g)for(o=0;o<w;++o)M[p][o+3*C]=g[p][o+_]}}}}}}}}const g={vis_vertex_components:{0:"position",1:"normal",2:"color",3:"uv",4:"uv2",5:"texcoord3",6:"texcoord4",7:"texcoord5",8:"texcoord6",9:"texcoord7",10:"texcoord8",11:"user0"},vis_data_type:{0:"uint8",1:"uint16",2:"uint32",3:"sint8",4:"sint16",5:"sint32",6:"float32",7:"float64",8:"uint8x2",9:"uint16x2",10:"uint32x2",11:"sint8x2",12:"sint16x2",13:"sint32x2",14:"float32x2",15:"float64x2",16:"uint8x3",17:"uint16x3",18:"uint32x3",19:"sint8x3",20:"sint16x3",21:"sint32x3",22:"float32x3",23:"float64x3",24:"uint8x4",25:"uint16x4",26:"uint32x4",27:"sint8x4",28:"sint16x4",29:"sint32x4",30:"float32x4",31:"float64x4",32:"<unsupported FLOAT_9>",33:"<unsupported DOUBLE_9>",34:"<unsupported MATRIX_3x3>",35:"<unsupported FLOAT_16>",36:"<unsupported DOUBLE_16>",37:"<unsupported MATRIX_4x4>",38:"<unsupported RAWBUFFER_PTR>"},vis_connectivity_type:{1:0,2:1,4:2,8:3,16:4,32:5,64:6},set_vertex_layout(e,t){const i=[],r=new Map;function n(e,t,n){const a=`${e}/${t}/${n}`;let o=r.get(a);return void 0===o&&(r.set(a,o=i.length),i[o]=[e,t,n]),o}const a={};for(let e=0;e<t.length;e++){const i=t[e],r=g.vis_data_type[i.getType()];if(void 0===r)throw new Error("Malformed vertex components description: unknown component type");let s=g.vis_vertex_components[i.getComponentType()];if(void 0===s)throw new Error("Malformed vertex components description: unknown component name");let l=i.getOffset(),d=i.getStride(),c=i.getRawBufferId();0===d?(c=n(c,l,(d=o[r].size)*i.getNbVertices()),l=0):c=n(c,0,d*i.getNbVertices()),a[s]={bufferId:c,type:r,offset:l,stride:d}}return e.layout.set(a),i},rawbuffers_by_id(e){const t={};for(let i=0;i<e.length;i++){const r=e[i];t[r.getId()]=r.getData()}return t},set_buffers(e,t,i){const r=g.rawbuffers_by_id(t);for(let t=0;t<i.length;t++){const[n,a,o]=i[t];e.buffers[t]=new Uint8Array(r[n],a,o)}},set_vertices(e,t){const i=t.getRawBuffer(),r=g.set_vertex_layout(e,t.getComponents());g.set_buffers(e,i,r)},set_indices(e,t){const i=g.vis_data_type[t.getType()],a=t.getOffset(),o=t.getNbIndices();if("uint16"===i)e.vertexIndexArray=new Uint16Array(t.getRawBuffer().getData(),a,o);else{if("uint32"!==i)throw new Error("Unsupported index type");e.vertexIndexArray=new Uint32Array(t.getRawBuffer().getData(),a,o)}const s={start:0,count:o},l=g.vis_connectivity_type[t.getConnectivityType()],d=r.GeomTypeEnum.UNKNOWN,c=new n.DrawingGroup(null,null,l,0,o,[s],void 0,d);e.drawingGroups=[c],c.geometry=e}},p={createGeometryBuffersV6(e){console.log(e);const t=e.getVisPrimitiveGroupRep();if(!t)return null;const i=[],n=t.getVisPrimitives();for(let e=0;e<n.length;e++){const t=n[e];t.getAttribute().getAttributeType();const o=new a({colorRGB:new r.Color(11189196)}),s=t.getIndicesDescription();for(let e=0;e<s.length;e++){const n=new r.BufferGeometryDS;g.set_vertices(n,t.getVerticesDescription()),g.set_indices(n,s[e]),n.drawingGroups.forEach(e=>e.gas=o),n._updateAccessors(),i.push(n)}}return i}};return Object.assign(u,p),u}),define("DS/WebVisuParameters/ImagePixelHelper",["DS/Visualization/ThreeJS_DS","DS/Visualization/MaterialManager","DS/SceneGraphNodes/BillBoardNode3D","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/GraphicAttributeSet"],function(e,t,i,r,n,a){"use strict";let o=new e.Vector2(0,0),s=null,l=0,d=0,c=null;const h={type:"Spherical"};let u=null;return{createFreeTypeText:function(r,g,p){const f=r.point;let m=function(t){(s=e.MaterialUtils.createMatteFaceMaterial({color:16777215,side:e.DoubleSide})).transparent=!0,s.force=!0,s.useLighting=!1,s.useGASColor=!0,s.activatePDSFX(),s.setPDSFXVaryings({vTexCoord:{type:"v3"}});var i={textMask:{type:"t2",value:t}};s.setPDSFXUniforms(i);var r={ComputeVaryingValues:["void ComputeVaryingValues() {","vTexCoord = vGetAttribTexCoord0().xyz;","}"].join("\n")},n={ComputeDiscard:["bool ComputeDiscard() { ","vec4 maskValue = texture2D(textMask, vTexCoord.xy);","return (maskValue.r < 0.01);","}"].join("\n"),ProcessFinalColor:["void ProcessFinalColor(inout vec4 ioFinalColor) { ","vec4 maskValue = texture2D(textMask, vTexCoord.xy);","ioFinalColor.a = maskValue.r  + maskValue.r*0.5;","}"].join("\n")};return s.setPDSFXOverridableFunctions(r,n),s.needsUpdate=!0,s.force=!0,s}(p);m.force=!0,g&&g.isNative2D()&&(new t)._setPDSFXDepthPriority(m,4,!1),l=p.image.width,d=p.image.height,(o=new e.Vector2(0,0)).x=r.freetypeTextGPInfo.min.x,o.y=r.freetypeTextGPInfo.min.y,l=r.freetypeTextGPInfo.max.x-r.freetypeTextGPInfo.min.x,d=r.freetypeTextGPInfo.max.y-r.freetypeTextGPInfo.min.y;var v=n.createRectangleNode({width:l,height:d,cornerPoint:o,fill:!0,material:m});v.setMaterialMode(!0);const y=v.getPrimitives();var S=new a({basic:!0,colorIndex:e.COLORMAP_INDEX.FOREGROUND,inheritance:e.GASEnum.COLOR_INHERITANCE_OFF});return v._setGAS([y[0]],S),c=(new e.Matrix4).setPosition(f),(u=new i(h)).setMatrix(c),u.addChild(v),u},createImagePixel:function(r,a,s){let g=new e.Vector2(0,0),p=1;const f=r.point;g=r.imageGPInfo.offset,p=r.imageGPInfo.alpha;var m=e.MaterialUtils.createMatteFaceMaterial({color:16777215,map:s,side:e.DoubleSide,alphaTest:.1});if(m.transparent=!0,m.force=!0,a&&a.isNative2D()&&(new t)._setPDSFXDepthPriority(m,4,!1),l=s.image.width,d=s.image.height,o=new e.Vector2(0,0),r.imageGPInfo.is3D?(o.x=-l/2,o.y=-d/2,g&&(o.x+=g.x,o.y+=g.y)):g&&(o.x+=g.x,o.y+=g.y),r.imageGPInfo.zoomQuality&&r.pixelSizes&&r.pixelSizes.length&&r.pixelSizes[0]){const e=r.pixelSizes[0];l*=e[0],d*=e[1]}var v=n.createRectangleNode({width:l,height:d,cornerPoint:o,fill:!0,material:m});return v.setMaterialMode(!0),r.imageGPInfo.zoomQuality||v.setRatio(1),c=(new e.Matrix4).setPosition(f),(u=new i(h)).setMatrix(c),u.addChild(v),u}}}),define("DS/WebVisuParameters/CustomDataParameterHelper",["UWA/Class","DS/CSIViewModelWebInterfaces/CSIVMClientCustomDataParameter","DS/Visualization/Node3D"],function(e,t,i){"use strict";return e.extend({init:function(e,t){this.parameter=e,this.onFinishedCB=t},getNode:function(){var e=this,t=new i;return require([this.parameter.getModule()],function(i){if(i){var r=(new i).handleMessage(e.parameter.getData());t.addChild(r),e.onFinishedCB&&e.onFinishedCB()}},this.onModuleError),t},modifyNode:function(e){var t=this;require([this.parameter.getModule()],function(i){if(i){var r=new i,n=null;if(e){n=e.children[0];for(var a=e.getChildren(),o=0;o<a.length;o++)if(!a[o].getModelIdentification()){n=a[o];break}}r.handleUpdateMessage(t.parameter.getData(),n),t.onFinishedCB&&t.onFinishedCB()}},this.onModuleError)},onModuleError:function(e){var t=e.requireModules&&e.requireModules[0];console.log("Module "+t+" is missing.")}})}),define("DS/WebVisuParameters/CSISelectionObject",["DS/CSIViewModelWebInterfaces/CSIVMClientSelectionObject"],function(e){return e}),define("DS/WebVisuParameters/GraphicPropertyParameterHelper",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/MaterialApplication","DS/Visualization/GraphicAttributeSet","DS/VisuLoaders/ThreeDXResourcesLibrary","DS/VisuLoaders/ThreeDXLoader","DS/Visualization/Node3D","DS/Visualization/Mesh3D","DS/CSIViewModelWebInterfaces/CSIViewModelWebEnv","DS/CSIViewModelWebInterfaces/CSIVMClientDrawGroupParameter","DS/CSIViewModelWebInterfaces/CSIVMClientCustomPropertyParameter","DS/Visualization/PickingMode","DS/Visualization/RenderStyle","DS/Visualization/Filters/GeomTypeFilter","DS/Visualization/Filters/DoNotPickUnderFilter","DS/Visualization/Filters/LookFilter"],function(e,t,i,r,n,a,o,s,l,d,c,h,u,g,p,f,m){"use strict";var v=new a,y=new o,S=-1,_=new Map,w=new Map,I=c.prototype.geomTypeValues,T={};T[I.unknown]=t.GeomTypeEnum.UNKNOWN,void 0!==I.unknown_2D&&(T[I.unknown_2D]=t.GeomTypeEnum.FACE),T[I.edge]=t.GeomTypeEnum.EDGE,T[I.wire_Edge]=t.GeomTypeEnum.WIRE_EDGE,T[I.boundary_Edge]=t.GeomTypeEnum.BOUNDARY_EDGE,T[I.sharp_Edge]=t.GeomTypeEnum.SHARP_EDGE,T[I.smooth_Edge]=t.GeomTypeEnum.SMOOTH_EDGE,T[I.hidden_Seam_Edge]=t.GeomTypeEnum.HIDDEN_SEAM_EDGE,T[I.boundary_Point]=t.GeomTypeEnum.BOUNDARY_POINT,T[I.sharp_Point]=t.GeomTypeEnum.SHARP_POINT,T[I.smooth_Point]=t.GeomTypeEnum.SMOOTH_POINT,T[I.hidden_Seam_Point]=t.GeomTypeEnum.HIDDEN_SEAM_POINT,T[I.surfacic_Point]=t.GeomTypeEnum.SURFACIC_POINT,T[I.free_Point]=t.GeomTypeEnum.FREE_POINT,T[I.infinite_Face]=t.GeomTypeEnum.INFINITE_FACE,T[I.face]=t.GeomTypeEnum.FACE;var D=0,C=1,P=2,E=3,M=4,A=9;return e.extend({init:function(e,t){this.clientManager=t,this.parameter=e},applyMatAppsToElt:function(e,t,i,r,n,a){if(e)for(var o=0;o<t.length;o++)this.applyMatAppToElt(e[t[o]],i,r,n,a)},applyMatAppToElt:function(e,t,i,r,n){if(e){var a=e;if(a.isDecal){if(!a.decal)return;var o=a.decal,s=w.get(a.uid);s||(s=new Set,w.set(a.uid,s)),o.__shareAttachementFrom(s),a.apply&&o.applyOn(i),a.attach&&o.attachTo(i)}else t?(n.length>0&&i._setMaterialOnGeomTypes(n,a),Array.isArray(r)&&r.length>0&&i.setMaterial(r,a)):(i.removeMaterialApplication(),i.setMaterialApplication(a))}},applyMaterialToElt:function(e,t,i,n,a,o,s,l){if(e&&e[t]){var d=e[t];if(a){var c=new r({geometricalFaceMaterial:d,layer:i,inheritance:n});l.length>0&&o._setMaterialOnGeomTypes(l,c),Array.isArray(s)&&s.length>0&&o.setMaterial(s,c)}else o.removeMaterialApplication(),o.setMaterialApplication(new r({geometricalFaceMaterial:d,layer:i,inheritance:n}))}},removeTextureFromCache:function(e){v&&v.removeImage(e)},applyGP:function(e,r,a,o){if(void 0!==e&&void 0!==r){var s=this.parameter;if(void 0!==s){var d=this,c=[];Array.isArray(o)&&o.forEach(function(e){c.push(T[e])});var g=Array.isArray(a)&&a.length>0||c.length>0,w=!1,I={},D=s.getGasStruct();void 0!==D&&Object.keys(D).length>0?(w=!0,void 0!==D.colorRGB&&Number.isInteger(D.colorRGB)&&(D.colorRGB=new t.Color(D.colorRGB)),void 0!==D.colorA&&Number.isInteger(D.colorA)&&(D.colorA/=255),void 0!==D.showFree&&(g||(I.showFree=D.showFree)),void 0!==D.noShow&&(g?D.show=!D.noShow:I.show=!D.noShow),void 0!==D.noPick&&(g||(I.pick=D.noPick?i.PICKTHROUGH:i.PICKABLE))):D={};var C=s.getCustomProperty();if(C){var P=C.getValue(h.prototype.propertyTypes.InheritanceMode);void 0!==P&&(D.inheritance=P,w=!0);var E=C.getValue(h.prototype.propertyTypes.ViewMode);void 0!==E&&this.applyRepViewMode(e,r,E)}if(w){var M=new n.IncrementalGraphicAttributeSet(D).usingNREInit(!0);g?r instanceof l?(c.length>0&&r._setGASOnGeomTypes(c,M),Array.isArray(a)&&a.length>0&&r._setGAS(a,M)):a.forEach(function(e){e._setGAS&&e._setGAS(M)}):r._setGAS(M)}var A=s.getMaterial();if(void 0!==A){var b=A.getMaterialDefinition();if(void 0!==b)if(!0===b.DefaultMaterial)g?(c.length>0&&r._setMaterialOnGeomTypes(c,null),Array.isArray(a)&&a.length>0&&r.setMaterial(a,null)):r.removeMaterialApplication();else{e.id!==S&&(S=e.id,_.clear());var V=b.JSON,O=_.get(V),N=b.Buffers,G=b.Layer,R=b.Inherit,x=[0];if(b.Index?x=[b.Index]:b.Indices&&(x=b.Indices),O)O.materialApplications?this.applyMatAppsToElt(O.materialApplications,x,g,r,a,c):this.applyMaterialToElt(O.materials,x[0],G,R,g,r,a,c);else{var H=[];Array.isArray(N)&&N.length>0&&N.forEach(function(e){H.push({buffer:e.getData()})}),y.load({resourcesLibrary:v,zipped:!1,json:V,chunks:H,doneCallback:function(e){if(e.materialApplications?(_.set(e.json,{materialApplications:e.materialApplications,materials:null}),d.applyMatAppsToElt(e.materialApplications,x,g,r,a,c)):(_.set(e.json,{materialApplications:null,materials:e.materials}),d.applyMaterialToElt(e.materials,x[0],G,R,g,r,a,c)),d.clientManager){var t=v.getRequestedUids();t.length&&d.clientManager.getTexturesFromUids({node:void 0,serverNodeId:void 0,textureUids:t,onAnswer:function(e){for(var t in e.buffers){var i=v.getImageToRequest(parseInt(t)),r="image/"+i.format;"dds"!==i.format&&"hdr"!==i.format&&"basis"!==i.format||(r="arraybuffer");var n=new Blob([e.buffers[t]._data],{type:r});y._loadGenericTexture(i.format,null,window.URL.createObjectURL(n),!0,function(){console.log("texture map updated")},null,i.map),v.removeImageToRequest(parseInt(t))}}})}}})}}}if(!g&&(void 0!==I.pick&&r.setPickable(I.pick),void 0!==I.show&&r.setVisibility(I.show),void 0!==I.showFree&&r.setVisibilityFree(I.showFree),C)){var F=C.getValue(h.prototype.propertyTypes.PickMode);if(void 0!==F)if(0===F)r.setPickingMode(null);else{var L=new u;L.applyToAll(i.PICK_VISIBLE),1&F&&(L.setPickingMode("Face",i.PICK_ALWAYS),L.setPickingMode("AxisSystem",i.PICK_ALWAYS),L.setPickingMode("InfiniteFace",i.PICK_ALWAYS)),2&F&&(L.setPickingMode("InternalSharpEdge",i.PICK_ALWAYS),L.setPickingMode("InternalSmoothEdge",i.PICK_ALWAYS),L.setPickingMode("BoundaryEdge",i.PICK_ALWAYS)),4&F&&L.applyToAll(i.PICK_NEVER),r.setPickingMode(L)}var U=C.getValue(h.prototype.propertyTypes.StaticPickWithChildrenAsAWhole);if(void 0!==U){var B=!!U;r.setVisuFilters({doNotPickUnderFilter:new f(B)})}let n=C.getValue(h.prototype.propertyTypes.IsIn3DBackGround);void 0!==n&&r.setIsInBackground(!!n);var k=C.getValue(h.prototype.propertyTypes.ExcludeFromBounding);"undefined"!=typeof excludeValue&&r.exludeFromBounding(!!k);var W=C.getValue(h.prototype.propertyTypes.LayerNumber);void 0!==W&&r.setLayerNumber(W);var z=C.getValue(h.prototype.propertyTypes.StaticGeomType);if(void 0!==z&&""!==z){var j=t.GeomTypeEnum[z];if(void 0!==j){var X=new p(j);r.setVisuFilters({_staticGeomTypeFilter:X}),r.traverse(function(e,t){if(void 0===e)return!0;if("Mesh3D"===e.getNodeType()){var i=e.mesh3js.geometry;if(!(i&&i.length>0))return!0;i[0].drawingGroups.forEach(function(e){e._geomType!==t&&(e._initialGeomType=e._geomType),e._geomType=t})}return!1},j)}}var K=C.getValue(h.prototype.propertyTypes.StaticPickPriority);void 0!==K&&""!==K&&r.setPickingPriorityId(K);var J=C.getValue(h.prototype.propertyTypes.StaticMaterial);if(void 0!==J&&""!==J)(q=e.getStaticMaterial(J))&&r.setVisuFilters({lookFilter:new m(q)});var Y=C.getValue(h.prototype.propertyTypes.StaticLook);if(void 0!==Y&&""!==Y){var Z=e.getStaticLook(Y);if(Z){var q=Z.material;r.setVisuFilters({lookFilter:new m(q).usingShadowReceive(Z.shadowReceive).usingShadowCast(Z.shadowCast)})}}}}}},applyRepViewMode:function(e,i,r){var n=e.viewManager.viewer._getCSIOverrideManager(),a=n.getRepViewModeOverride(i),o=!1;if(r===D)o=!0;else{t.GeomTypeEnum;var s=t.GeomTypeEnum.EDGE|t.GeomTypeEnum.SHARP_EDGE|t.GeomTypeEnum.SMOOTH_EDGE|t.GeomTypeEnum.BOUNDARY_EDGE|t.GeomTypeEnum.FACE|t.GeomTypeEnum.INFINITE_FACE,l=new g({faceMode:null});switch(l._displayNothingRenderMode(),l.setReplaceMask(s),r){case C:l.setRenderMode("Face",!0),l.setRenderMode("InfiniteFace",!0);break;case P:l.setRenderMode("@Edge",!0);break;case E:l.setRenderMode("Face",!0),l.setRenderMode("InfiniteFace",!0),l.setRenderMode("@Edge",!0);break;case M:l.setRenderMode("Face",!0),l.setRenderMode("InfiniteFace",!0);break;case A:break;default:o=!0}o||a.setRenderStyle(l)}o&&n.deleteRepViewModeOverride(i)}})}),define("DS/WebVisuParameters/BoundingSphereParameterHelper",["DS/CSIViewModelWebInterfaces/CSIVMClientBoundingSphereParameter","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";var i={getBoundingSphere:function(e){if(!e)return null;var i=e.getRadius(),r=e.getRadiusMM();e.getState()===e.stateValues.infinite&&(i=0,r=0);var n=new t.Sphere(new t.Vector3(e.getCenterX(),e.getCenterY(),e.getCenterZ()),i);return n.pixelRadius=r*t.getPixelsPerMM(),n}};return i}),define("DS/WebVisuParameters/CSIModelIdPathParameter",["UWA/Class","DS/CSICommandBinder/CSICommandBinder"],function(e,t){"use strict";var i={labels:{elementsId:"elems_id",elementsNamingContext:"elems_nc",subElements:"subelems_id"},serialize:function(e,t){var r,n,a=[],o=[];for(r=0;r<t.elements.length;r++)n=t.elements[r],a.push(n.id),o.push(n.namingContext);e.writeUint32Array(i.labels.elementsId,a),e.writeUint8Array(i.labels.elementsNamingContext,o),e.writeUint32Array(i.labels.subElements,t.subElements)},unserialize:function(e){var t,r={elements:[],subElements:[]},n=e.readUint32Array(i.labels.elementsId),a=e.readUint8Array(i.labels.elementsNamingContext),o=e.readUint32Array(i.labels.subElements);for(t=0;t<n.length;t++)r.elements.push({id:n[t],namingContext:a[t]});for(t=0;t<o.length;t++)r.subElements.push(o[t]);return r}};return t.declareType({type:"CATModelIdPath",serialize:i.serialize,unserialize:i.unserialize}),i}),define("DS/WebVisuParameters/PathElementRepNodeUtils",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/Mesh3D","DS/Visualization/Filters/SideFilter"],function(e,t,i,r){function n(e){if(e.parents.length>1)throw"Wrong number of parents on linked node"}const a=new Map;class o{constructor(e,t){this.linkerMap=t,t.set(e,this),this.mainNode3D=e,this.linkedNode3Ds=null}removeMainNode3D(e){const t=this.linkerMap;if(this.linkedNode3Ds&&0!==this.linkedNode3Ds.size){if(e){const e=this;this.linkedNode3Ds.forEach((t,i,r)=>e.removeLinkedNode3D(i)),t.delete(this.mainNode3D)}}else t.delete(this.mainNode3D)}isLinkedNode(e){return this.linkedNode3Ds&&this.linkedNode3Ds.has(e)}isIntermediateLinkedNode(e){return this.isLinkedNode(e)&&this.linkedNode3Ds.get(e)}isFinalLinkedNode(e){return this.isLinkedNode(e)&&!this.linkedNode3Ds.get(e)}createLinkedNode3D(e,t,i){const r=this.linkerMap;if(0!==t.children.length&&t._getForbidHierarchyUpdate())throw"Invalid parent node for node linking";var n=this.mainNode3D._linkingClone(null,i);this.linkedNode3Ds||(this.linkedNode3Ds=new Map),r.set(n,this),this.linkedNode3Ds.set(n,e);const a=t._getForbidHierarchyUpdate();return t._setForbidHierarchyUpdate(!1),t.addChild(n),t._setForbidHierarchyUpdate(a),n._setForbidHierarchyUpdate(!0),e||this.syncChildren(n),n}removeLinkedNode3D(e,t){const i=this.linkerMap;if(this.isLinkedNode(e)){n(e),e._setForbidHierarchyUpdate(!1);const s=e.parents[0],l=s._getForbidHierarchyUpdate();if(s._setForbidHierarchyUpdate(!1),s.removeChild(e),s._setForbidHierarchyUpdate(l),i.delete(e),this.linkedNode3Ds.get(e)||e.removeChildren(),this.linkedNode3Ds.delete(e),t){var r=Array.from(e.children);for(let e=0;e<r.length;e++){var a=r[e];if(i.has(a)){var o=i.get(a);o.removeLinkedNode3D(a,o,!0)}}}this.removeMainNode3D(!1)}}lock(e){this.isLinkedNode(e)&&(n(e),e._setForbidHierarchyUpdate(!0))}toArray(){return this.linkedNode3Ds?Array.from(this.linkedNode3Ds.keys()):[]}syncChildren(e){if(this.isFinalLinkedNode(e)){e._setForbidHierarchyUpdate(!1),e.removeChildren();for(var t=0;t<this.mainNode3D.children.length;t++)e.addChild(this.mainNode3D.children[t]);e._setForbidHierarchyUpdate(!0)}}}function s(e,t){let i=null;return a.has(e)?i=a.get(e):t&&(i=new o(e,a)),i}const l="PathElementRepNode3D";let d=!1,c=0;class h extends t{constructor(){super(l),c++}_cleanTemp(){if(this.parents.length>0)return;c--;const e=this.children[0];if(!e)return;const t=s(e,!1);t&&t.removeLinkedNode3D(e,!0)}_toExternalPathElement(){if(0===this.parents.length)return[];let e=[this.parents[0]],t=this;for(;t;){e.push(t);const i=s(t=t.children[0],!1);if(!i||!i.isLinkedNode(t))break}return e}addChild(e){if(!d)return!1;super.addChild(e)}}const u={set(e,i,r){if("__isProxy__"===i||"__target__"===i)throw"Do not manipulate private proxy parameters";if("children"===i||"parents"===i)throw"Do not manipulate children and parents of a proxified Node3D directly";if(e[i]instanceof Function&&t.prototype[i])throw"Don't override prototype";"_"===i[0]&&console.error("Unexpected: setting a private property manually, may not work properly in linkage - "+i);const n=s(e,!1);let a=[];n&&(n.isLinkedNode(e)||0===(a=n.toArray()).length&&n.removeMainNode3D(!0)),e[i]=r;for(let e=0;e<a.length;e++){a[e][i]=r}},get(e,i,r){if("__isProxy__"===i)return!0;if("__target__"===i)return e;if("children"===i||"parents"===i)throw"Do not manipulate children and parents of a proxified Node3D directly";i[0];const n=e[i];if(n instanceof Function){const r="addChild"===i||"removeChild"===i||"removeChildren"===i,a=s(e,!1);let o=[];return a&&(a.isLinkedNode(e)||0===(o=a.toArray()).length&&a.removeMainNode3D(!0)),function(...i){if(i)for(let e=0;e<i.length;e++)i[e]instanceof t&&i[e].__isProxy__&&(i[e]=i[e].__target__);var s=n.apply(e,i);for(let e=0;e<o.length;e++){const t=o[e];r?a.syncChildren(t):n.apply(t,i)}return s}}return n}};return{buildPathElementRepNode3DFromArray:function(n,a,o){d=!0;const l=new h;a.addChild(l);let c=l;for(let e=0;e<n.length;e++){let i=n[e];if(!(i instanceof t))throw"Unsupported operation, expected an array of Node3D";c=s(i,!0).createLinkedNode3D(e!==n.length-1,c,o)}if(c instanceof i&&o){const t=c.mesh3js;c.setVisuFilters({_sideFilter:new r(e.DoubleSide)}),null===t.layer&&t.initLayers();const i=o.getPrimitives();for(let e=0;e<i.length;e++)i[e]=i[e].clone();t.layer.addPrimitivesToLayers(i,1)}return d=!1,l},getProfixiedNodeIfNecessary:function(e){return e&&e instanceof t&&0!==c?new Proxy(e,u):e}}}),define("DS/WebVisuParameters/CSIViewParameterLabels",[],function(){"use strict";return{viewStatus:"viewStatus",idPatterns:"idPatterns",graphicProperties:"GraphicProperties",treeUpdates:"treeUpdates",viewStatusTemporary:"temporary",viewStatusPermanent:"permanent",viewStatusCommit:"commit",viewStatusAbort:"abort",showMode:"ShowMode",staticMaterial:"SetStaticMaterial",staticPickPriority:"SetStaticPickPriority",id:"id",idSpace:"idSpace",idContext:"idContext",shared:"shared",treeKey:"treeKey",tokens:"tokens",appliedGas:"AppliedGraphicProperties",node:"Node",value:"value",localIdInt:"localId_Int",localIdString:"localId_String",idPattern:"idPattern",batchCellIdPattern:"batchCellIdPattern",parent:"parent",batchParent:"batchParent",valueAddNode:"AddNode",valueAddCustomNode:"AddCustomNode",valueModifyCustomNode:"ModifyCustomNode",valueAddExistingNode:"AddExistingNode",valueRemoveExistingNode:"RemoveExistingNode",valueAddBody:"AddBody",valueAddCells:"AddCells",valueRemoveAll:"RemoveAll",valueMesh:"mesh",valueBoundingSphere:"bs",valueBoundingBox:"bbox",valueInitializers:"inits",valueCustomData:"customdata",valueGeometry:"geometry",valueGeometries:"geometries",valueOffset:"offset",valueByteLength:"bytelength",valueBytePerElement:"bpe",valueDrawGroups:"dgs",valueStart:"start",valueCount:"count",valueGeomType:"geomType",valuePrimitives:"primitives",valueBuffer:"buffer",valueBufferPartitions:"bufferPartitions",valueBufferPartition:["vertexPositionArray","vertexIndexArray","vertexColorArray","vertexNormalArray","vertexBinormalArray","vertexTangentArray","vertexUvArray","vertexUv2Array"],valueGeomTypeValue:["EDGE","WIRE_EDGE","BOUNDARY_EDGE","SHARP_EDGE","SMOOTH_EDGE","BOUNDARY_POINT","SHARP_POINT","SMOOTH_POINT","SURFACIC_POINT","FREE_POINT","INFINITE_FACE","FACE"],glTypeFromGeomType:{EDGE:1,WIRE_EDGE:1,BOUNDARY_EDGE:1,SHARP_EDGE:1,SMOOTH_EDGE:1,BOUNDARY_POINT:0,SHARP_POINT:0,SMOOTH_POINT:0,SURFACIC_POINT:0,FREE_POINT:0,INFINITE_FACE:4,FACE:4},valueRadius:"rad",valueState:"state",valueStateValue:["EMPTY","NORMAL","INIFINITE","CONTAIN"],valueX1:"x1",valueY1:"y1",valueZ1:"z1",valueX2:"x2",valueY2:"y2",valueZ2:"z2",shortId:"shortId",idPath:"idPath",valueBinaryFormat:"binaryformat",valueClientModule:"clientmodule",valueData:"Data",valueBinaryFormatValue:["Bin","Cgr"]}}),define("DS/WebVisuParameters/SceneEnvParameterItem",["DS/Visualization/ThreeJS_DS"],function(e){"use strict";var t=function(e){this.container=e};t.prototype={constructor:t,areViewModesManaged:function(){return!1},getViewMode:function(){return null},getViewModeMask:function(){return 0},getViewModeAppearanceStructure:function(e){return null},getCamerasJSON:function(){return null},getCameras2DJSON:function(){return null},getChangeType:function(){return null},getViewpointsInfo:function(){return null},areCamerasManaged:function(){return!1},areLightsManaged:function(){return!1},getLightsJSON:function(){return null},areAmbiancesManaged:function(){return!1},isDefaultAmbiance:function(){return!1},getAmbianceJSON:function(){return null},getAmbianceBuffers:function(){return null},areSupportParametersManaged:function(){return!1},getHighlightRenderingData:function(){return null},getPrehighlightRenderingData:function(){return null},getColorMap:function(){return null},getFog:function(){return!1},getClippingPlane:function(){return null},getBackground3DViewMode:function(){return null},getMainViewpointUID:function(){return null},getViewerType:function(){return null},get2DMode:function(){return null},getPLMViewMode:function(){return null}};var i=function(e){t.call(this,e)};i.prototype=Object.create(t.prototype),Object.assign(i.prototype,{areViewModesManaged:function(){return!!this.getViewMode()},getViewMode:function(){return this.container.getViewmode?this.container.getViewmode():null},getViewModeMask:function(){var e=this.container.getViewmode();return e?e._viewMode:0},getViewModeAppearanceStructure:function(t){if(this.getViewModeMask()&t){var i=this.getViewMode();return{appearanceName:i._appearanceName,customParams:{shininess:i._shininess,opacity:i._opacity,color:(new e.Color).setRGB(i._color[0],i._color[1],i._color[2]),useColorFromGAS:i._useObjectColor}}}return null},getCamerasJSON:function(){var e=this.container.getCamerasJSON();return e?e.getJSON():null},areCamerasManaged:function(){return this.container.AreCamerasManaged&&this.container.AreCamerasManaged()},areLightsManaged:function(){return this.container.AreLightsManaged&&this.container.AreLightsManaged()},getLightsJSON:function(){var e=this.container.getLightsJSON();return e?e.getJSON():null},areAmbiancesManaged:function(){return this.container.AreAmbiancesManaged&&this.container.AreAmbiancesManaged()},isDefaultAmbiance:function(){return this.container.getIsDefaultAmbiance()},getAmbianceJSON:function(){var e=this.container.getAmbianceJSON();return e?e.getJSON():null},getAmbianceBuffers:function(){return this.container.getAmbianceBuffers()}});var r=function(i){e.__tmpIsA2X=!0,t.call(this,i)};return r.prototype=Object.create(t.prototype),Object.assign(r.prototype,{areViewModesManaged:function(){return!!this.getViewMode()},getViewMode:function(){return this.container.getViewMode()},getViewModeMask:function(){var e=this.container.getViewMode();return e?e.getViewMode():0},getViewModeAppearanceStructure:function(t){if(this.getViewModeMask()&t){var i=this.getViewMode(),r=i.getColor();return{appearanceName:i.getAppearance(),customParams:{shininess:i.getShininess(),opacity:i.getOpacity(),color:(new e.Color).setRGB(r[0],r[1],r[2]),useColorFromGAS:i.getUseObjectColor()}}}return null},getViewpoints:function(){return this.container.getViewpoints()},getCameras2DJSON:function(){if(!this.areCamerasManaged())return null;var e=this.getViewpoints().getCameras2DJSON();return e?e.getJSON():null},getCamerasJSON:function(){if(!this.areCamerasManaged())return null;var e=this.getViewpoints().getCamerasJSON();return e?e.getJSON():null},getChangeType:function(){return this.areCamerasManaged()?this.getViewpoints().getChangeType():null},getViewpointsInfo:function(){return this.areCamerasManaged()?this.getViewpoints().getViewpointsInfo():null},areCamerasManaged:function(){return!!this.getViewpoints()},areLightsManaged:function(){return!1},getLightsJSON:function(){return null},getAmbiance:function(){return this.container.getAmbiance()},areAmbiancesManaged:function(){return!!this.getAmbiance()},isDefaultAmbiance:function(){return!this.getAmbianceJSON()},getAmbianceJSON:function(){if(!this.areAmbiancesManaged())return null;var e=this.getAmbiance().getAmbianceJSON();return e?e.getJSON():null},getAmbianceBuffers:function(){return this.areAmbiancesManaged()?this.getAmbiance().getAmbianceBuffers():null},getSupportParameters:function(){return this.container.getSupportParameters()},areSupportParametersManaged:function(){return!!this.getSupportParameters()},getHighlightRenderingData:function(){return this.areSupportParametersManaged()?this.getSupportParameters().getHighlightRenderingData():null},getPrehighlightRenderingData:function(){return this.areSupportParametersManaged()?this.getSupportParameters().getPrehighlightRenderingData():null},getColorMap:function(){return this.areSupportParametersManaged()&&this.getSupportParameters().getColorMap?this.getSupportParameters().getColorMap():null},getFog:function(){return this.areSupportParametersManaged()?this.getSupportParameters().getFog():null},getClippingPlane:function(){return this.areSupportParametersManaged()?this.getSupportParameters().getSupportClippingPlane():null},getBackground3DViewMode:function(){return this.areSupportParametersManaged()?this.getSupportParameters().getBackground3DViewMode():null},getMainViewpointUID:function(){return this.areSupportParametersManaged()?this.getSupportParameters().getMainViewpointUID():null},getViewerType:function(){return this.areSupportParametersManaged()?this.getSupportParameters().getViewerType():null},get2DMode:function(){return this.areSupportParametersManaged()?this.getSupportParameters().get2DMode():null},getPLMViewMode:function(){return this.container&&this.container.getPLMViewMode()}}),{VisuContextData:r,SceneEnvData:i}}),define("DS/WebVisuParameters/AbstractWebVisuUpdateTransaction",["DS/CSIViewModelWebInterfaces/CSIVMClientTransaction","DS/WebVisuParameters/PathElementRepNodeUtils"],function(e,t){"use strict";var i=function(e,t,i){if(window.newMaterialInheritance=!0,this.clientManager=i,this.viewManager=e,this.treeKeyID=t.getUUID?t.getUUID():null,this.view=null,e)if(t.getViewpointUID&&0!==t.getViewpointUID()){let i=e._viewpointMap.get(t.getViewpointUID());if(i){let t=e.viewer._viewpointManager.getViewpointScenegraph(i);this.view=t?e.addView(this.treeKeyID,t.userRoot):e.getView(this.treeKeyID)}else console.error("no viewpoint correspond to this uid : "+t.getViewpointUID())}else this.view=e.getView(this.treeKeyID)};return(i.prototype=Object.create(e.prototype)).getOperatedObject=function(e){var i=e.getOperatedObject();return t.getProfixiedNodeIfNecessary(i)},i.prototype.getOperandObject=function(e){var i=e.getOperandObject();return t.getProfixiedNodeIfNecessary(i)},i.prototype.doOperation=function(e){throw"Not implemented"},i.prototype.commit=function(){throw"Not implemented"},i.prototype.abort=function(){throw"Not implemented"},i.prototype.executeEnd=function(){throw"Not implemented"},i.prototype.executeInverse=function(){throw"Not implemented"},i}),define("DS/WebVisuParameters/InfiniteGeometryParameterHelper",["UWA/Class","DS/CSIViewModelWebInterfaces/CSIVMClientInfiniteGeometryParameter","DS/CSIViewModelWebInterfaces/CSIVMClientInfiniteDrawGroupParameter","DS/CSIViewModelWebInterfaces/CSIVMClientGraphicPropertyParameter","DS/CSIViewModelWebInterfaces/CSIVMClientImagePixel","DS/SceneGraphNodes/FixedSizeArrowNode","DS/SceneGraphNodes/FixedSizePlaneNode","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/Visualization/GeometryHelper","DS/Mesh/MeshUtils","DS/Visualization/Node3D","DS/Visualization/Mesh3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/TextNode","DS/SceneGraphNodes/RefPlaneNode","DS/Visualization/GraphicAttributeSet","DS/VisuLoaders/ThreeDXResourcesLibrary","DS/Visualization/FontUtils","DS/Visualization/Filters/GASInheritFilter","DS/SceneGraphNodes/AnnotationText","DS/WebVisuParameters/GraphicPropertyParameterHelper","DS/CSIViewModelWebInterfaces/CSIVMClientSelectionObject","DS/CSIViewModelWebInterfaces/CSIVMClientCATVizBasePathElementRep","DS/Visualization/MaterialManager","DS/WebVisuParameters/PathElementRepNodeUtils","DS/WebVisuParameters/ImagePixelHelper"],function(e,t,i,r,n,a,o,s,l,d,c,h,u,g,p,f,m,v,y,S,_,w,I,T,D,C,P,E){"use strict";var M=i.prototype.infiniteGeomTypeValues,A=1/l.getPixelsPerMM(),b=v.DefaultGASs.transition,V=v.DefaultGASs.edge.clone().setParameters({colorIndex:l.COLORMAP_INDEX.BLACK});let O=new y;var N=new l.Color(0),G=new l.Vector3(1,0,0),R=new l.Vector3(0,0,1),x=new Map;function H(e,t,i){for(var r=0;r<e.children.length;r++){var n=e.children[r];n._setGAS(t),H(n,t,i)}e.mesh3js&&e.mesh3js.geometry[0].drawingGroups.forEach(function(e){var t=i.triangle;0===e.glType?t=i.point:1===e.glType&&(t=i.line),e.gas=t})}function F(e,t){e.traverse(function(e){if(void 0===e)return!0;if("Mesh3D"===e.getNodeType()){const i=e.mesh3js.geometry[0];i.drawingGroups.forEach(e=>e._geomType=t)}return!1},t)}const L={json_additional:(e,t)=>({properties:JSON.parse(new TextDecoder("utf-8").decode(t)),itemReadAdditional:t.length}),reference_plane(e,t){let i=0,r=0;const n=e[i++],a=e[i++],o=new l.Vector3(e[i++],e[i++],e[i++]),s=new l.Vector3(e[i++],e[i++],e[i++]),d=new l.Vector3(e[i++],e[i++],e[i++]),c=1===t[r++];let h="";const u=t[r++];if(u>0){const e=[];for(let i=0;i<u;++i)e.push(String.fromCharCode(t[r++]));h=e.join("")}const g=t[r++];let p=null;if(g){p=function(e){const t={},i=e[0];i>>3==0&&(t._wireframeMode=!!(4&i),t._labelVisibility=!!(2&i),t._orientationVisibility=!!(1&i),t._frontColorR=e[1],t._frontColorG=e[2],t._frontColorB=e[3],t._backColorR=e[4],t._backColorG=e[5],t._backColorB=e[6],t._opacity=e[7]);return t}(t.subarray(r,r+=g))}return{properties:{lengthU:n,lengthV:a,origin:o,dirU:s,dirV:d,fixedSize:c,label:h,rendering:p,incLengthBy5PercentIfZoomable:1===t[r++]},itemReadGeom:11,itemReadAdditional:r}},canonical_cuboid(e,t){let i=0;return{properties:{corner:[e[i++],e[i++],e[i++]],firstAxis:[e[i++],e[i++],e[i++]],secondAxis:[e[i++],e[i++],e[i++]],thirdLength:e[i++]},itemReadGeom:10}},canonical_sphere(e,t){let i=0,r=0;return{properties:{center:[e[i++],e[i++],e[i++]],radius:e[i++],sag:e[i++],sagMode:t[r++]},itemReadGeom:5,itemReadAdditional:1}},canonical_partialsphere(e,t){let i=0,r=0;return{properties:{center:[e[i++],e[i++],e[i++]],firstAxis:[e[i++],e[i++],e[i++]],secondAxis:[e[i++],e[i++],e[i++]],meridianStartAngle:e[i++],meridianEndAngle:e[i++],parallelStartAngle:e[i++],parallelEndAngle:e[i++],sag:e[i++],sagMode:t[r++]},itemReadGeom:14,itemReadAdditional:1}},canonical_cylinder(e,t){let i=0,r=0;return{properties:{bottomCenter:[e[i++],e[i++],e[i++]],topCenter:[e[i++],e[i++],e[i++]],radius:e[i++],sag:e[i++],sagMode:t[r++]},itemReadGeom:8,itemReadAdditional:1}},canonical_cone(e,t){let i=0,r=0;return{properties:{bottomCenter:[e[i++],e[i++],e[i++]],topCenter:[e[i++],e[i++],e[i++]],bottomRadius:e[i++],topRadius:e[i++],sag:e[i++],sagMode:t[r++]},itemReadGeom:9,itemReadAdditional:1}},canonical_torus(e,t){let i=0,r=0;return{properties:{center:[e[i++],e[i++],e[i++]],planeNormal:[e[i++],e[i++],e[i++]],minorRadius:e[i++],sag:e[i++],sagMode:t[r++]},itemReadGeom:8,itemReadAdditional:1}},canonical_partialtorus(e,t){let i=0,r=0;return{properties:{center:[e[i++],e[i++],e[i++]],firstAxis:[e[i++],e[i++],e[i++]],secondAxis:[e[i++],e[i++],e[i++]],minorRadius:e[i++],majorAngle:e[i++],sag:e[i++],sagMode:t[r++]},itemReadGeom:12,itemReadAdditional:1}},canonical_curvedpipe(e,t){let i=0,r=0;const n=e[i++],a=[];for(let t=0;t<3*n;t++)a.push(e[i++]);return{properties:{centers:a,startNormal:[e[i++],e[i++],e[i++]],endNormal:[e[i++],e[i++],e[i++]],radius:e[i++],sag:e[i++],sagMode:t[r++]},itemReadGeom:i,itemReadAdditional:1}}};class U{static create(e,t,i){throw new Error("Not implemented")}static update(e,t,i){throw new Error("Not implemented")}}class B extends U{static create(e,t,i){const{params:r,matrix:n}=B.getParams(t),a=new h;let o=B.getNode(r);return a.addChild(o),a.setMatrix(n),F(a,l.GeomTypeEnum.INFINITE_FACE),e.addChild(a),o.cbChange(),{CSINode:a,noZ:!1,alreadyAdded:!0}}static update(e,t,i){const{params:r,matrix:n}=B.getParams(t);let a=e.children[0];e.setMatrix(n),a.parents.length>1?(e.removeChild(a),a=B.getNode(r),e.addChild(a),F(e,l.GeomTypeEnum.INFINITE_FACE)):(a.setNewLook(r.newLook),a.setParameters(r)),a.cbChange()}static getParams(e){let{lengthU:t,lengthV:i}=e;const{origin:r,dirU:n,dirV:a,fixedSize:o,label:s,incLengthBy5PercentIfZoomable:d}=e,c=e.rendering||{};o&&(t*=1/A,i*=1/A),!o&&d&&(t*=1.05,i*=1.05);const h=(new l.Vector3).crossVectors(n,a),u=new l.Matrix4;u.makeBasis(n,a,h),u.setPosition(r);const g=!c||!c._wireframeMode,p=!!c&&c._orientationVisibility,f=!c||c._labelVisibility,m=c?c._opacity/255:.075,v=c?(new l.Color).setRGB(c._frontColorR/255,c._frontColorG/255,c._frontColorB/255):new l.Color("#005686"),y=c?(new l.Color).setRGB(c._backColorR/255,c._backColorG/255,c._backColorB/255):new l.Color("#a3c8dc");return{params:{name:"refPlane",fill:!0,newLook:g,orientationArrow:p,fixedSize:o,size:new l.Vector2(t,i),planeAttributes:{front:{color:v,opacity:m},back:{color:y,opacity:m}},borderAttributes:{front:{color:v,opacity:.8,width:1},back:{color:y,opacity:.8,width:1}},textAttributes:{front:{data:f?s:"",color:v,opacity:.8,size:14},back:{data:f?s:"",color:y,opacity:.8,size:14}}},matrix:u}}static getHash(e){let t=e.newLook?"NL_":"";e.orientationArrow&&(t+="OA_"),e.fixedSize&&(t+="FS_"),t+=e.size.x.toFixed(3)+"_",t+=e.size.y.toFixed(3)+"_";let i=e.planeAttributes;return i&&(i.front&&(i.front.opacity&&(t+="O_",t+=i.front.opacity.toFixed(3)),i.front.color&&(t+="FC_",t+=i.front.color.getHexString())),i.back&&i.back.color&&(t+="BC_",t+=i.back.color.getHexString())),e.textAttributes&&e.textAttributes.front&&(t+="T_",t+=e.textAttributes.front.data),t}static getNode(e){const t=B.getHash(e);let i=B.refPlaneMap.get(t);return i||((i=new m(e)).setPickParent(!0),B.refPlaneMap.set(t,i)),i}}B.refPlaneMap=new Map;class k{static create(e,t,i){const r={lights:[]};i.threeDXLoader.applyLights({json:t,data:r,destinationNode:e});const n=0!==r.lights.length;return{CSINode:n?r.lights[0]:null,alreadyAdded:!!n||void 0}}}function W(e){const t=new u(e);return H(t,b,{triangle:b,line:V,point:b}),{CSINode:t,noZ:!1}}class z{static create(e,t,i){return W(c.createCuboidMesh({corner:t.corner,firstAxis:t.firstAxis,secondAxis:t.secondAxis,thirdLength:t.thirdLength},b))}}class j{static create(e,t,i){return W(c.createCustomSphereMesh({parallelStart:-Math.PI/2,parallelEnd:Math.PI/2,meridianStart:0,meridianEnd:2*Math.PI,center:t.center,firstAxis:[t.radius,0,0],secondAxis:[0,1,0],sag:{sag:t.sag,sagMode:t.sagMode}},b))}}class X{static create(e,t,i){return W(c.createCustomSphereMesh({parallelStart:t.parallelStartAngle,parallelEnd:t.parallelEndAngle,meridianStart:t.meridianStartAngle,meridianEnd:t.meridianEndAngle,center:t.center,firstAxis:t.firstAxis,secondAxis:t.secondAxis,sag:{sag:t.sag,sagMode:t.sagMode}},b))}}class K{static create(e,t,i){return W(c.createCustomCylinderMesh({bottomCenter:t.bottomCenter,topCenter:t.topCenter,bottomRadius:t.radius,topRadius:t.radius,sag:{sag:t.sag,sagMode:t.sagMode}},b))}}class J{static create(e,t,i){return W(c.createCustomCylinderMesh({bottomCenter:t.bottomCenter,topCenter:t.topCenter,bottomRadius:t.bottomRadius,topRadius:t.topRadius,sag:{sag:t.sag,sagMode:t.sagMode}},b))}}class Y{static create(e,t,i){return W(c.createTorusMesh({center:t.center,planeNormal:t.planeNormal,minorRadius:t.minorRadius,sag:{sag:t.sag,sagMode:t.sagMode}},b))}}class Z{static create(e,t,i){return W(c.createPartialTorusMesh({center:t.center,firstAxis:t.firstAxis,secondAxis:t.secondAxis,minorRadius:t.minorRadius,majorAngle:t.majorAngle,sag:{sag:t.sag,sagMode:t.sagMode}},b))}}class q{static create(e,t,i){return W(c.createCurvedPipeMesh({centers:t.centers,radius:t.radius,startN:t.startNormal,endN:t.endNormal,sag:{sag:t.sag,sagMode:t.sagMode}},b))}}function $(e){switch(e){case M.reference_plane:return B;case M.light:return k;case M.canonical_cuboid:return z;case M.canonical_sphere:return j;case M.canonical_partialsphere:return X;case M.canonical_cylinder:return K;case M.canonical_cone:return J;case M.canonical_torus:return Y;case M.canonical_partialtorus:return Z;case M.canonical_curvedpipe:return q;default:return null}}function Q(e){switch(e){case M.reference_plane:return L.reference_plane;case M.light:return L.json_additional;case M.canonical_cuboid:return L.canonical_cuboid;case M.canonical_sphere:return L.canonical_sphere;case M.canonical_partialsphere:return L.canonical_partialsphere;case M.canonical_cylinder:return L.canonical_cylinder;case M.canonical_cone:return L.canonical_cone;case M.canonical_torus:return L.canonical_torus;case M.canonical_partialtorus:return L.canonical_partialtorus;case M.canonical_curvedpipe:return L.canonical_curvedpipe;default:return null}}function ee(e){for(let t in M)if(M[t]===e)return t;return""}return e.extend({init:function(e,t){this.parameter=e,this._threeDXLoader=t,this._sagInfos={sag:.2,sagMode:1},this._options={threeDXLoader:t}},updateInfiniteGeometry:function(e,t){const i=this.parameter.getInfiniteDrawGroups(),r=this.parameter.getInfiniteGeometryAsFloat32Array(),n=this.parameter.getAdditionalDataAsUint8Array();if(r)for(let e=0;e<i.length;e++){const a=i[e],o=a.getInfiniteGeomType(),s=new Uint32Array(this.parameter.getBuffer(),a.getStart(),3*a.getCount());for(let e=0;e<a.getCount();++e){const i=s[3*e];let a=s[3*e+1],l=s[3*e+2];const d=t.getChildById(i),c=$(o),h=Q(o);if(!h||!c)continue;const{properties:u,itemReadGeom:g,itemReadAdditional:p}=h(r.subarray(a),n.subarray(l));c.update(d,u)}}},getInfiniteGeometry:function(e,t){var i=this.parameter.getInfiniteDrawGroups(),o=[],d=[],y=this.parameter.getInfiniteGeometryAsFloat32Array();if(!y)return{geometry:[],primitiveIDs:[]};for(var T=this.parameter.getAdditionalDataAsUint8Array(),C=!1,x=0;x<i.length;x++){var F=i[x],L=F.getInfiniteGeomType();if(L===M.path_element){const e=new D(T);if(!e.isValid())continue;const i=e.createIteratorOverPathElements();if(e.haveTransient){const r=e.createIteratorOverPathElementsTransient();let n=!1;for(const e of i){n=!0;let i=e.externalPath;for(const e of r){const r=e.getLastElement(!1,!0);i=i.concat(e.externalPath);const n=P.buildPathElementRepNode3DFromArray(i,t,r);d.push(n),o.push(n.name+n.id);break}}if(!n)for(const e of r){const i=e.getLastElement(!1,!0),r=e.externalPath,n=P.buildPathElementRepNode3DFromArray(r,t,i);d.push(n),o.push(n.name+n.id)}}else for(const e of i){const i=e.getLastElement(!1,!0),r=e.externalPath,n=P.buildPathElementRepNode3DFromArray(r,t,i);d.push(n),o.push(n.name+n.id)}}else for(var U=new Uint32Array(this.parameter.getBuffer(),F.getStart(),3*F.getCount()),B=0;B<F.getCount();++B){var k,W=U[3*B],z=U[3*B+1],j=U[3*B+2],X=!0;switch(L){case M.origin:var K=[y[z++],y[z++],y[z++]];(re=T[j++])>8&&(re=c.PointSymbolEnum.UNKNOWN);var J={positions:K,number:1,color:N};k=new h;var Y=s.createPointsNode(J),Z=new l.Sphere(new l.Vector3(K[0],K[1],K[2]));Z.pixelRadius=1,Y.forceBoundingSphere(Z),Y.setPickParent(!0),k.addChild(Y),k.traverse(this._CBOnTraversal,l.GeomTypeEnum.FREE_POINT),H(k,b,{triangle:b,line:b,point:b.clone().setParameters({symbolType:re})});break;case M.points:for(var q=y[z++],te=[],ie=0;ie<3*q;++ie)te.push(y[z++]);var re;(re=T[j++])>8&&(re=c.PointSymbolEnum.UNKNOWN);J={positions:te,number:q,color:new l.Color("black")};k=new h,(Y=s.createPointsNode(J)).setPickParent(!0),k.addChild(Y),k.traverse(this._CBOnTraversal,l.GeomTypeEnum.FREE_POINT),H(k,b,{triangle:b,line:b,point:b.clone().setParameters({symbolType:re})});break;case M.axis:var ne=y[z++];ne*=1/A;K=new l.Vector3(y[z++],y[z++],y[z++]);var ae=new l.Vector3(y[z++],y[z++],y[z++]),oe=y[z++];oe*=1/A;var se=y[z++];(se<0||se>.5*Math.PI)&&(se=.1974),0===se&&(oe=0);var le="",de=T[j++];if(de>0){var ce=[];for(ie=0;ie<de;++ie)ce.push(String.fromCharCode(T[j++]));le=ce.join("")}k=new h;var he=Math.abs(ae.z)<.999?R:G,ue=(new l.Vector3).crossVectors(he,ae);ue.normalize();var ge=(new l.Vector3).crossVectors(ae,ue),pe=new l.Matrix4;pe.makeBasis(ue,ge,ae),pe.setPosition(K),k.setMatrix(pe);J={name:"arrow",pickable:!0,color:new l.Color("black"),head:oe>0?a.types.ARROW:a.types.NONE,arrowLength:ne,arrowWidth:1,headLength:oe,headWidthToHeightRatio:2*Math.tan(se),globalSelection:!0};var fe=this.getAxisNode(J,{text:le,length:de});k.addChild(fe.axis),k.addChild(fe.label),k.traverse(this._CBOnTraversal,l.GeomTypeEnum.AXIS_SYSTEM),H(k,b,{triangle:b,line:b,point:b});break;case M.infinite_plane:var me=y[z++];me*=1/A;K=new l.Vector3(y[z++],y[z++],y[z++]);var ve=new l.Vector3(y[z++],y[z++],y[z++]),ye=new l.Vector3(y[z++],y[z++],y[z++]);if(T[j++]){(k=s.createFixedSizeNode({name:"CSIFixedSizeHalfPlaneNode",ratio:1})).setMatrix((new l.Matrix4).setPosition(K));var Se=ve.clone().add(ye).normalize().multiplyScalar(1.4142136*me/2),_e=K.clone().add(Se),we=_e.clone().add(ve.multiplyScalar(me/2)),Ie=_e.clone().add(ye.multiplyScalar(me/2)),Te=s.createLineNode({points:[we,_e,Ie],color:new l.Color("black")});Te.setMaterialMode(!1),Te.setPickParent(!0),Te.setMatrix((new l.Matrix4).setPosition(K.negate())),k.addChild(Te),H(k,b,{triangle:b,line:b,point:b})}else{var De=(new l.Vector3).crossVectors(ve,ye);(Ze=new l.Matrix4).makeBasis(ve,ye,De),Ze.setPosition(K);J={name:"refPlane",fill:!0,fixedSize:!0,size:new l.Vector2(me,me),planeAttributes:{front:{color:new l.Color("#005686"),opacity:.075},back:{color:new l.Color("#a3c8dc"),opacity:.075}},borderAttributes:{front:{color:new l.Color("#005686"),opacity:.8,width:1},back:{color:new l.Color("#a3c8dc"),opacity:.8,width:1}},textAttributes:{fixedSize:!0,front:{data:"",color:new l.Color("#005686"),opacity:1,size:30},back:{data:"",color:new l.Color("#a3c8dc"),opacity:1,size:30}}};X=!1,(k=new m(J)).setMatrix(Ze)}k.traverse(this._CBOnTraversal,l.GeomTypeEnum.INFINITE_FACE);break;case M.text:K=new l.Vector3(y[z++],y[z++],y[z++]);var Ce=y[z++],Pe=[];for(ie=0;ie<4;++ie)Pe.push(T[j++]);le="";if((me=function(e){if(Array.isArray(e)){var t=new ArrayBuffer(e.length),i=new DataView(t);return e.forEach(function(e,t){i.setUint8(t,e)}),i}}(Pe.reverse()).getUint32(0))>0){for(ce=[],ie=0;ie<me;++ie)ce.push(String.fromCharCode(T[j++]));le=ce.join("")}var Ee=new f("CSIText");Ee.setPrimitivePicking(!1),Ee.textMaterial.side=2,Ee.addText({string:le,anchor:new l.Vector3(K.x,K.y,0),color:new l.Color(0),size:Ce,lineLength:500,up:new l.Vector3(0,1,0),right:new l.Vector3(1,0,0)}),Ee.setPickParent(!0),(k=new h).addChild(Ee),H(k,b,{triangle:b,line:b,point:b});break;case M.canonical_cuboid:var Me=[y[z++],y[z++],y[z++]],Ae=[y[z++],y[z++],y[z++]],be=[y[z++],y[z++],y[z++]],Ve=y[z++],Oe=c.createCuboidMesh({corner:Me,firstAxis:Ae,secondAxis:be,thirdLength:Ve},b);X=!1,H(k=new u(Oe),b,{triangle:b,line:V,point:b});break;case M.canonical_sphere:var Ne=[y[z++],y[z++],y[z++]],Ge=y[z++];this._sagInfos.sagMode=T[j++],this._sagInfos.sag=y[z++];Oe=c.createCustomSphereMesh({parallelStart:-Math.PI/2,parallelEnd:Math.PI/2,meridianStart:0,meridianEnd:2*Math.PI,center:Ne,firstAxis:[Ge,0,0],secondAxis:[0,1,0],sag:this._sagInfos},b);X=!1,H(k=new u(Oe),b,{triangle:b,line:V,point:b});break;case M.canonical_partialsphere:Ne=[y[z++],y[z++],y[z++]],Ae=[y[z++],y[z++],y[z++]],be=[y[z++],y[z++],y[z++]];var Re=y[z++],xe=y[z++],He=y[z++],Fe=y[z++];this._sagInfos.sagMode=T[j++],this._sagInfos.sag=y[z++];Oe=c.createCustomSphereMesh({parallelStart:He,parallelEnd:Fe,meridianStart:Re,meridianEnd:xe,center:Ne,firstAxis:Ae,secondAxis:be,sag:this._sagInfos},b);X=!1,H(k=new u(Oe),b,{triangle:b,line:V,point:b});break;case M.canonical_cylinder:var Le=[y[z++],y[z++],y[z++]],Ue=[y[z++],y[z++],y[z++]];Ge=y[z++];this._sagInfos.sagMode=T[j++],this._sagInfos.sag=y[z++];Oe=c.createCustomCylinderMesh({bottomCenter:Le,topCenter:Ue,bottomRadius:Ge,topRadius:Ge,sag:this._sagInfos},b);X=!1,H(k=new u(Oe),b,{triangle:b,line:V,point:b});break;case M.canonical_cone:Le=[y[z++],y[z++],y[z++]],Ue=[y[z++],y[z++],y[z++]];var Be=y[z++],ke=y[z++];this._sagInfos.sagMode=T[j++],this._sagInfos.sag=y[z++];Oe=c.createCustomCylinderMesh({bottomCenter:Le,topCenter:Ue,bottomRadius:Be,topRadius:ke,sag:this._sagInfos},b);X=!1,H(k=new u(Oe),b,{triangle:b,line:V,point:b});break;case M.canonical_torus:Ne=[y[z++],y[z++],y[z++]];var We=[y[z++],y[z++],y[z++]],ze=y[z++];this._sagInfos.sagMode=T[j++],this._sagInfos.sag=y[z++];Oe=c.createTorusMesh({center:Ne,planeNormal:We,minorRadius:ze,sag:this._sagInfos},b);X=!1,H(k=new u(Oe),b,{triangle:b,line:V,point:b});break;case M.canonical_partialtorus:Ne=[y[z++],y[z++],y[z++]],Ae=[y[z++],y[z++],y[z++]],be=[y[z++],y[z++],y[z++]],ze=y[z++];var je=y[z++];this._sagInfos.sagMode=T[j++],this._sagInfos.sag=y[z++];Oe=c.createPartialTorusMesh({center:Ne,firstAxis:Ae,secondAxis:be,minorRadius:ze,majorAngle:je,sag:this._sagInfos},b);X=!1,H(k=new u(Oe),b,{triangle:b,line:V,point:b});break;case M.canonical_curvedpipe:var Xe=y[z++],Ke=[];for(x=0;x<3*Xe;x++)Ke.push(y[z++]);var Je=[y[z++],y[z++],y[z++]],Ye=[y[z++],y[z++],y[z++]];Ge=y[z++];this._sagInfos.sagMode=T[j++],this._sagInfos.sag=y[z++];Oe=c.createCurvedPipeMesh({centers:Ke,radius:Ge,startN:Je,endN:Ye,sag:this._sagInfos},b);X=!1,H(k=new u(Oe),b,{triangle:b,line:V,point:b});break;case M.path_element:break;case M.annotation_text:const i=JSON.parse(new TextDecoder("utf-8").decode(T)),o=i.anchor;if(!i.box)break;const d=i.point,D=i.box.height,P=i.box.width,F=i.box.descent;let U=D,B=d.x,W=d.y,qe=0,$e=0;void 0!==o&&(o!=l.AnchorPoint.BOTTOM_CENTER&&o!=l.AnchorPoint.BASE_CENTER&&o!=l.AnchorPoint.TOP_CENTER||(qe-=.5*P),o!=l.AnchorPoint.BOTTOM_RIGHT&&o!=l.AnchorPoint.BASE_RIGHT&&o!=l.AnchorPoint.TOP_RIGHT||(qe-=P),o!=l.AnchorPoint.BOTTOM_LEFT&&o!=l.AnchorPoint.BOTTOM_CENTER&&o!=l.AnchorPoint.BOTTOM_RIGHT||($e+=F),o!=l.AnchorPoint.TOP_LEFT&&o!=l.AnchorPoint.TOP_CENTER&&o!=l.AnchorPoint.TOP_RIGHT||($e+=F-D)),B+=qe,W+=$e-=F;const Qe=i.font;let et,tt=0,it=!0;Qe&&(tt=Qe.font),k=new h;const rt={type:"Spherical"};(et=it?new g({ratio:3.8}):new h).setVisuFilters({gasInheritFilter:(new _).usingColorInherit(null,!1).usingASMColorInherit(null,!1)});let nt=new p(rt);nt.addChild(et);var Ze=(new l.Matrix4).setPosition({x:d.x,y:d.y,z:0});nt.setMatrix(Ze),k.addChild(nt);const at=function(e){for(var t=0;t<e.length;++t){var i=e[t];et.addChild(i),i.setPickParent(!0)}};let ot=s.createRectangleNode({width:P,height:U,delta:new l.Vector2(qe,$e),fill:!0,color:new c.Color(.5,.5,.2,1)});if(i.contour){const t=i.contour1;if(t&&t.set&&t.rgba){let i=new r(t.set,t.rgba),n=s.createLineNode({points:[new l.Vector3(qe,$e,0),new l.Vector3(qe,$e+U,0),new l.Vector3(qe+P,$e+U,0)]});new I(i,e.clientManager).applyGP(this,n),n.setPickParent(!0),et.addChild(n)}const n=i.contour2;if(n&&n.set&&n.rgba){let t=new r(n.set,n.rgba),i=s.createLineNode({points:[new l.Vector3(qe,$e,0),new l.Vector3(qe+P,$e,0),new l.Vector3(qe+P,$e+U,0)]});new I(t,e.clientManager).applyGP(this,i),i.setPickParent(!0),et.addChild(i)}}ot.setGAS(new v({basic:!0,colorIndex:l.COLORMAP_INDEX.FOREGROUND,inheritance:l.GASEnum.COLOR_INHERITANCE_ON})),ot.setPickParent(!0),et.addChild(ot);const st=3==tt||4==tt,lt=2==tt||4==tt;let dt={text:i.text,bbox:[qe,qe+P,$e,$e+U],fontName:"3ds Regular.ttf",color:{r:0,g:0,b:0},colorIndex:l.COLORMAP_INDEX.BACKGROUND,bold:lt,italic:st,width:P,orientationAngle:0,_noZPriority:4,viewer:e.viewManager.viewer};S.createTexts([dt],{},at);break;case M.image_pixel:const ct=new n(T,j);if(0===ct.nbImages)break;const ht=e.viewManager.viewer;if(X=!1,ct.imageGPInfo||ct.freetypeTextGPInfo){const e=new h;k=e;const t=ct.textureJson,i=ct.imagesBuffer;new Promise((r,n)=>{this._threeDXLoader.load({zipped:!1,json:t,chunks:i,destinationNode:e,doneCallback:r,resourcesLibrary:O,forcePowerOfTwo:!1})}).then(()=>{const t=function(t){if(ct.imageGPInfo){let i=ht&&ht.currentViewpoint&&ht.currentViewpoint,r=E.createImagePixel(ct,i,t);e.addChild(r)}if(ct.freetypeTextGPInfo){let i=ht&&ht.currentViewpoint&&ht.currentViewpoint,r=E.createFreeTypeText(ct,i,t);e.addChild(r)}};Object.values(O.refImages)[0].values().next().value;if(ct.textureJson&&ct.textureJson.images&&ct.textureJson.images[0]){const e=ct.textureJson.images[0].uid,i=O.refImages[e].values().next().value;if(i instanceof l.Texture){if(i.loadEndStatus!==l.AssetLoadingStatus.READY)return void i.onLoadCallbacks.push(t);t(i)}}})}else if(ct.annotationGPInfo){const t=new w({point:ct.point,anchor:ct.annotationGPInfo.anchor,isDepthTestEnabled:ct.annotationGPInfo.isDepthTestEnabled,height:ct.annotationGPInfo.height,contour:ct.annotationGPInfo.contour,contour1:ct.annotationGPInfo.contour1,contour2:ct.annotationGPInfo.contour2,viewer:e.viewManager.viewer});k=t;const i=ct.textureJson,r=ct.imagesBuffer;new Promise((e,n)=>{this._threeDXLoader.load({zipped:!1,json:i,chunks:r,destinationNode:t,doneCallback:e,resourcesLibrary:O,forcePowerOfTwo:!1})}).then(()=>{let e=[];for(var i=0;i<ct.textureJson.images.length;i++){var r=ct.textureJson.images[i].uid;const t=O.refImages[r].values().next();e.push(t.value)}t.setMipmaps(e)})}break;default:console.log(`New infinite geometry creation [geomType: ${ee(L)}]`);const ut=Q(L),gt=$(L),pt=ut(y.subarray(z),T?T.subarray(j):null);z+=pt.itemReadGeom,j+=pt.itemReadAdditional;const ft=gt.create(t,pt.properties,this._options);k=ft.CSINode,void 0!==ft.noZ&&(X=ft.noZ),void 0!==ft.alreadyAdded&&(C=ft.alreadyAdded)}k&&(X&&k.setNoZ(!0),C||t.addChild(k),d.push(k),k.persistentId=W,o.push(W))}}return{geometry:d,primitiveIDs:o}},_CBOnTraversal:function(e,t){if(void 0===e)return!0;"Mesh3D"===e.getNodeType()&&e.mesh3js.geometry[0].drawingGroups.forEach(function(e){e._geomType=t});return!1},getAxisNode:function(e,t){var i="AL_"+e.arrowLength;i+="HL_"+e.arrowHeadLength,i+="SA_"+e.headWidthToHeightRatio,i+="T_"+t.text;var r=x.get(i);if(!r){var n=new a(e);n.setPickParent(!0);var o=new f("myText",!0,{billboard:!0,billboardAxis:!1,fixedSize:!0,allocSize:t.length});o.setPickParent(!0),o.textMaterial.refreshUniforms=function(e,t,i){this.updatePDSFXUniform("invSize",new l.Vector2(1/e.getViewportSize().width,1/e.getViewportSize().height))},o.addText({string:t.text,anchor:new l.Vector3,offset:new l.Vector3(-5,-5,0),color:new l.Color(16777215),size:20*(l.getDevicePixelRatio()||1),lineLength:500,up:new l.Vector3(0,0,1),right:new l.Vector3(0,1,0)}),o.setPrimitivePicking(!1),o.setRatio(1),o.setFixedSizeCenter(new l.Vector3(0,0,8+e.arrowLength),1),r={axis:n,label:o},x.set(i,r)}return r}})}),define("DS/WebVisuParameters/HighlightTransactionUtils/HighlightTransactionHSO",["DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","DS/WebVisuParameters/HighlightTransactionUtils/HighlightTransactionXSO"],function(e,t,i){"use strict";var r=new Map,n=function(e,n){if(i.call(this,n),r.has(n)||r.set(n,{nonColorParameters:{Basic:{},Halo:{},Politeness:{},AdvancedPoliteness:{}},defaultSlotColorParameters:{Basic:{},Halo:{},Politeness:{},AdvancedPoliteness:{}},highlightType:"AdvancedPoliteness",advanced:!0}),this.enabled=!0,this.highlightColor=r.get(n).advanced?new t.AdvancedPoliteHighlightData(t.DefaultHighlightData.advancedpolite):new t.HaloHighlightData(t.DefaultHighlightData.halo),this.highlightColor.priority=8192,e)this.highlightColor._setData(e);else{var a=r.get(n).currentHighlightType;this.highlightColor._setData(r.get(n).defaultSlotColorParameters[a])}this._event="HIGHLIGHT",this._setData(this.highlightColor)};(n.prototype=Object.create(i.prototype))._setData=function(i){if(i){var n=this.viewer,a=r.get(n).advanced?new t.AdvancedPoliteHighlightData(this.highlightColor):new t.HaloHighlightData(this.highlightColor);a._setData(i);var o=r.get(n).currentHighlightType;a._setData(r.get(n).nonColorParameters[o]),e.publish({event:"/VISU/SELECTION/CSI_HIGHLIGHT_UPDATE",data:{eventChannel:"/VISU/SELECTION/CSI_HIGHLIGHT_UPDATE",eventType:"@CSI_HIGHLIGHT_UPDATE",parameters:{highlightColor:this.highlightColor,newColor:a,viewer:n,advanced:r.get(n).advanced}}}),this.highlightColor=a}};var a=new Map,o=null;return e.subscribe({event:"/VISU/SELECTION/CSI_CONTEXT_MULTI_HIGHLIGHT_UPDATE"},function(e){var t=e.parameters.slot+1,i=e.parameters.color,r=e.parameters.viewer,s=i,l=i.clone().multiplyScalar(1.142);l.r=Math.max(Math.min(l.r,1),0),l.g=Math.max(Math.min(l.g,1),0),l.b=Math.max(Math.min(l.b,1),0);var d={color:i,haloColor:s,outlineColor:l,priority:4095+t};(o=a.get(r))||(o=[new n(null,r)],a.set(r,o)),o[t]?o[t]._setData(d):o[t]=new n(d,r)}),e.subscribe({event:"/VISU/SELECTION/CSI_CONTEXT_MULTI_HIGHLIGHT_ACTIVATION"},function(e){var t=e.parameters.enabled,i=e.parameters.viewer;(o=a.get(i))||(o=[new n(null,i)],a.set(i,o));for(var s=1;s<o.length;s++){o[s]||(o[s]=new n({},i)),o[s].enabled=t;var l=i._getHighlightSet(o[s].highlightColor,!1,!!r.get(i).advanced);l&&l.enable(t)}}),e.subscribe({event:"/VISU/SELECTION/CSI_CONTEXT_HIGHLIGHT_ACTIVATION"},function(e){var t=e.parameters.enabled,i=e.parameters.viewer;(o=a.get(i))||(o=[new n(null,i)],a.set(i,o)),o[0]||(o[0]=new n({},i)),o[0].enabled=t;var s=i._getHighlightSet(o[0].highlightColor,!1,!!r.get(i).advanced);s&&s.enable(t)}),e.subscribe({event:"/VISU/SELECTION/CSI_CONTEXT_DEFAULT_HIGHLIGHT_UPDATE"},function(e){var t=e.parameters.viewer;(o=a.get(t))||(o=[new n(null,t)],a.set(t,o));var i=e.parameters.highlightType,s=r.get(t).currentHighlightType;Object.assign(r.get(t).defaultSlotColorParameters[i],e.parameters.colorParameters),o[0]._setData(r.get(t).defaultSlotColorParameters[s])}),e.subscribe({event:"/VISU/SELECTION/CSI_CONTEXT_HIGHLIGHT_NON_COLOR_UPDATE"},function(e){var t=e.parameters.viewer;(o=a.get(t))||(o=[new n(null,t)],a.set(t,o));var i=e.parameters.highlightType;Object.assign(r.get(t).nonColorParameters[i],e.parameters.nonColorParameters);for(var s=0;s<o.length;s++)o[s]&&o[s]._setData({})}),e.subscribe({event:"/VISU/SELECTION/CSI_CONTEXT_HIGHLIGHT_TYPE_UPDATE"},function(e){var t=e.parameters.viewer;(o=a.get(t))||(o=[new n(null,t)],a.set(t,o));var i=e.parameters.highlightType;"AdvancedPoliteness"===i||"Halo"===i?(r.get(t).currentHighlightType=i,r.get(t).advanced="AdvancedPoliteness"===i):i=r.get(t).currentHighlightType;for(var s=0;s<o.length;s++)o[s]&&o[s]._setData(0===s?r.get(t).defaultSlotColorParameters[i]:{})}),e.subscribe({event:"/VISU/VIEWER/VIEWER_DISPOSED"},function(e){var t=e.parameters.viewer;if(a.has(t))for(var i=a.get(t),n=0;n<i.length;n++){var o=i[n];if(o){o._treeKeyToStruct.forEach(function(e,t,i){o._setTreeKey(t),o.removeAll()});var s=t._getHighlightSet(o.highlightColor,!1,!!r.get(t).advanced);s&&t.removeHighlightSet(s)}}a.delete(t),r.delete(t)}),{getXSO:function(e,t,i){if((o=a.get(t))||(o=[new n(null,t)],a.set(t,o)),e>o.length||e<0)throw"Invalid slot";var s=o[e];if(!s)throw"Missing slot";return t.createHighlightSet(s.highlightColor,!1,!!r.get(t).advanced).enable(s.enabled),s._setTreeKey(i),s},clearMultiHighlightColorSlot:function(e){for(var t=1;t<o.length;t++){var i=o[t];i&&(i._setTreeKey(e),i.removeAll())}}}}),define("DS/WebVisuParameters/HighlightTransactionUtils/HighlightTransactionPSO",["DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","DS/WebVisuParameters/HighlightTransactionUtils/HighlightTransactionXSO"],function(e,t,i){"use strict";var r=new Map,n=function(e){i.call(this,e),r.has(e)||r.set(e,{nonColorParameters:{Basic:{},Halo:{},Politeness:{},AdvancedPoliteness:{}},defaultSlotColorParameters:{Basic:{},Halo:{},Politeness:{},AdvancedPoliteness:{}},currentHighlightType:"AdvancedPoliteness",advanced:!0});var n=r.get(e).currentHighlightType;this.highlightColor=r.get(e).advanced?new t.AdvancedPoliteHighlightData(t.DefaultPreHighlightData.advancedpolite):new t.HaloHighlightData(t.DefaultPreHighlightData.halo),this.highlightColor._setData(r.get(e).defaultSlotColorParameters[n]),this._event="PREHIGHLIGHT",this._setData(this.highlightColor)};(n.prototype=Object.create(i.prototype))._setData=function(i){if(i){var n=this.viewer,a=r.get(n).advanced?new t.AdvancedPoliteHighlightData(this.highlightColor):new t.HaloHighlightData(this.highlightColor);a._setData(i);var o=r.get(n).currentHighlightType;a._setData(r.get(n).nonColorParameters[o]),e.publish({event:"/VISU/SELECTION/CSI_PREHIGHLIGHT_UPDATE",data:{eventChannel:"/VISU/SELECTION/CSI_PREHIGHLIGHT_UPDATE",eventType:"@CSI_PREHIGHLIGHT_UPDATE",parameters:{newColor:a,viewer:n,advanced:r.get(n).advanced}}}),this.highlightColor=a}};var a=new Map,o=null;return e.subscribe({event:"/VISU/SELECTION/CSI_CONTEXT_DEFAULT_PREHIGHLIGHT_UPDATE"},function(e){var t=e.parameters.viewer;(o=a.get(t))||(o=[new n(t)],a.set(t,o));var i=e.parameters.highlightType,s=r.get(t).currentHighlightType;Object.assign(r.get(t).defaultSlotColorParameters[i],e.parameters.colorParameters),o[0]._setData(r.get(t).defaultSlotColorParameters[s])}),e.subscribe({event:"/VISU/SELECTION/CSI_CONTEXT_PREHIGHLIGHT_NON_COLOR_UPDATE"},function(e){var t=e.parameters.viewer;(o=a.get(t))||(o=[new n(t)],a.set(t,o));var i=e.parameters.highlightType;Object.assign(r.get(t).nonColorParameters[i],e.parameters.nonColorParameters);for(var s=0;s<o.length;s++)o[s]&&o[s]._setData({})}),e.subscribe({event:"/VISU/SELECTION/CSI_CONTEXT_PREHIGHLIGHT_TYPE_UPDATE"},function(e){var t=e.parameters.viewer;(o=a.get(t))||(o=[new n(t)],a.set(t,o));var i=e.parameters.highlightType;"AdvancedPoliteness"===i||"Halo"===i?(r.get(t).currentHighlightType=i,r.get(t).advanced="AdvancedPoliteness"===i):i=r.get(t).currentHighlightType;for(var s=0;s<o.length;s++)o[s]&&o[s]._setData(0===s?r.get(t).defaultSlotColorParameters[i]:{})}),e.subscribe({event:"/VISU/VIEWER/VIEWER_DISPOSED"},function(e){var t=e.parameters.viewer;if(a.has(t))for(var i=a.get(t),n=0;n<i.length;n++)i[n]&&i[n]._treeKeyToStruct.forEach(function(e,t,r){i[n]._setTreeKey(t),i[n].removeAll()});a.delete(t),r.delete(t)}),{getXSO:function(e,t,i){if((o=a.get(t))||(o=[new n(t)],a.set(t,o)),e>o.length||e<0)throw"Invalid slot";var r=o[e];if(!r)throw"Missing slot";return r._setTreeKey(i),r}}}),define("DS/WebVisuParameters/WebVisuUpdateTransactionHighlight",["DS/WebVisuParameters/AbstractWebVisuUpdateTransaction","DS/CoreEvents/Events","DS/EKEventsWeb/EKEvents","DS/Visualization/ThreeJS_DS","DS/CSIViewModelWebInterfaces/CSIVMClientCATVizBasePathElementRep","DS/CSIViewModelWebInterfaces/CSIVMClientSelectionObject","DS/CSIViewModelWebInterfaces/CSIVMClientInfiniteDrawGroupParameter","DS/WebVisuParameters/PathElementRepNodeUtils","DS/Visualization/PathElement"],function(e,t,i,r,n,a,o,s,l){"use strict";var d=o.prototype.infiniteGeomTypeValues,c=new Map,h=null,u=function(){this._idObject=null,this._pathes=[],this._order=0};u.prototype.setIdentificationObject=function(e){this._idObject=e},u.prototype.getIdentificationObject=function(){return this._idObject},u.prototype._addPath=function(e,t,i){this._pathes.push({key:e,slot:t,linkedRoot:i})};var g=function(t,i,r,n,a){e.call(this,t,i,r),this.multiSelection=!!n,this._transientHighlightRoot=t._sceneEnvRootForTransientHighlight,0===this._transientHighlightRoot.parents.length&&this.viewManager.viewer.addNode(this._transientHighlightRoot),this.transactionUtils=a};return(g.prototype=Object.create(e.prototype))._getCSISelection=function(e){this.multiSelection||(e=0);var t=this.viewManager.viewer;(h=c.get(t))||(h=new Map,c.set(t,h)),this._csiXSO=this.transactionUtils.getXSO(e,t,this.treeKeyID)},g.prototype._updateOrder=function(){var e=this;h.forEach(function(t,i,r){if(t.length){t.sort((e,t)=>e.node._order-t.node.order);for(var n=0;n<t.length;n++){var a=t[n].slot;e._getCSISelection(a),(o=e._csiXSO.getPathFromKey(i))&&e._csiXSO._remove(o)}var o,s=t[t.length-1].slot;e._getCSISelection(s),(o=e._csiXSO.getPathFromKey(i))&&e._csiXSO._add(o)}else r.delete(i)})},g.prototype._insertPathElement=function(e,t,i,r){this._csiXSO.add(t),e._addPath(t.hash(),i,r),this.multiSelection&&(h.has(t.hash())?h.get(t.hash()).push({slot:i,node:e}):h.set(t.hash(),[{slot:i,node:e}]),this._updateOrder())},g.prototype.doOperation=function(e){if(this.transactionUtils){var t=i.Trace.traceStart("techno_webvisu","message_to_highlight"),r=e.getType();switch(r){case e.OperationType.RemoveAll:this.multiSelection?this.transactionUtils.clearMultiHighlightColorSlot(this.treeKeyID):this._csiXSO.removeAll(),h.clear();break;case e.OperationType.CreateRoot:case e.OperationType.AddNode:case e.OperationType.AddBody:var a=new u;e.setCreatedObject(a);break;case e.OperationType.AddCells:if(!(a=this.getOperatedObject(e)))return;var o=e.getGeometricalData(),c=!!o&&o.hasInfiniteGeometry(),g=o?o.getGeometries():null;if(!c||!g){i.Log.error("Unexpected or missing data in Highlight transaction AddCells");break}for(var p=0;p<g.length;p++){var f=g[p],m=f.getInfiniteDrawGroups();if(m&&m.length){if(m[0].getInfiniteGeomType()===d.path_element){const e=f.getAdditionalDataAsUint8Array(),t=new n(e);if(!t.isValid())continue;const i=this.multiSelection?t.multiColorHighlightSlot+1:0;this._getCSISelection(i);const r=t.createIteratorOverPathElements();if(t.haveTransient){const e=this._transientHighlightRoot,n=t.createIteratorOverPathElementsTransient();let o=!1;for(const t of r){let r=t.externalPath;o=!0;for(const t of n){r=r.concat(t.externalPath);const n=s.buildPathElementRepNode3DFromArray(r,e,null),o=new l;o.setFromArray(n._toExternalPathElement(),t.internalPath),this._insertPathElement(a,o,i,n);break}}if(!o)for(const t of n){const r=t.externalPath,n=s.buildPathElementRepNode3DFromArray(r,e,null),o=new l;o.setFromArray(n._toExternalPathElement(),t.internalPath),this._insertPathElement(a,o,i,n)}}else for(const e of r)this._insertPathElement(a,e,i,null)}}else i.Log.error("Missing getInfiniteDrawGroups in Highlight transaction AddCells")}break;case e.OperationType.RemoveExistingNode:if(!(a=this.getOperandObject(e)))return;for(p=0;p<a._pathes.length;p++){var v=a._pathes[p];this._getCSISelection(v.slot);var y=this._csiXSO.getPathFromKey(v.key);if(y&&(this._csiXSO.remove(y),v.linkedRoot&&this._transientHighlightRoot.removeChild(v.linkedRoot),h.has(y.hash())&&this.multiSelection)){var S=h.get(y.hash()),_=S.findLastIndex(e=>e.node===a&&e.slot===v.slot);-1!==_&&(S.splice(_,1),this._updateOrder())}}a._pathes=[];break;case e.OperationType.ApplyGP:break;default:i.Log.error("Unexpected operation token in Highlight transaction "+r)}this.viewManager.viewer.render(),t.End()}},g.prototype.commit=function(){},g.prototype.abort=function(){},g.prototype.executeEnd=function(){},g.prototype.executeInverse=function(){},g}),define("DS/WebVisuParameters/SceneEnvParameterHelper",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events","DS/WebVisuParameters/SceneEnvParameterItem"],function(e,t,i,r){"use strict";var n=r.SceneEnvData,a=(r.VisuContextData,{VIEW_NO_DISPLAY:0,VIEW_MESH:1,VIEW_EDGE:2,VIEW_OUTLINE:4,VIEW_MATERIAL:8,VIEW_HLR:16,VIEW_HRD:32,VIEW_HIDDEN_EDGE:64,VIEW_POLYGON:128,VIEW_ISOPARS:256,VIEW_TOON:512,VIEW_TRANSPARENT:1024,VIEW_REP_OVERLOAD:2048,VIEW_WITH_HALF_SMOOTH_EDGE:4096,VIEW_WITHOUT_SMOOTH_EDGE:8192,VIEW_LINEONLINE:16384,VIEW_WITHOUT_VERTEX:32768,VIEW_COLORED_EDGES_FROM_FACES:65536,VIEW_WITHOUT_WIRES:131072,VIEW_WITHOUT_AXIS:262144,VIEW_WITHOUT_POINTS:524288,VIEW_WITHOUT_CONSTRAINTS:1048576,VIEW_RAYTRACING:2097152,VIEW_WITHOUT_SMALL_CURVATURE_STEP_EDGE:536870912,VIEW_APPEARANCE:1073741824});e.__ViewModeType__=a;var o={Basic:e.DefaultAppearanceMode.BASIC,GASLook:e.DefaultAppearanceMode.GASLOOK,Transparent:e.DefaultAppearanceMode._TRANSPARENT,Clay:e.DefaultAppearanceMode.CLAY,WhiteMatPlaster:e.DefaultAppearanceMode.WHITE_MAT_PLASTER,GreyShinyPlastic:e.DefaultAppearanceMode.GREY_SHINY_PLASTIC,CastAluminum:e.DefaultAppearanceMode.CAST_ALUMINUM,MachinedAluminum:e.DefaultAppearanceMode.MACHINED_ALUMINUM,CastSteel:e.DefaultAppearanceMode.CAST_STEEL,BrushedSteel:e.DefaultAppearanceMode.BRUSHED_STEEL,MachinedStainlessSteel:e.DefaultAppearanceMode.MACHINED_STAINLESS_STEEL,Copper:e.DefaultAppearanceMode.COPPER,Brass:e.DefaultAppearanceMode.BRASS,GenericPlastic:e.DefaultAppearanceMode.GENERIC_PLASTIC,GenericMetal:e.DefaultAppearanceMode.GENERIC_METAL,QAAutomation:null,Count:null};e.__ViewAppearanceMap__=o;var s=new Uint32Array(1),l=new Uint8Array(s.buffer),d=1;function c(t,r,n,a,o){var d=!1,c="Halo",h=t.getHaloData();s[0]=h.color,n.Halo.haloEnabled=!!h.activation,d=d||!!h.activation,n.Halo.haloIntensity=h.intensity,n.Halo.haloThickness=h.size,a.Halo.haloColor=(new e.Color).setRGB(l[3]/255,l[2]/255,l[1]/255);var u=t.getScanData();s[0]=u.color,n.Halo.colorEnabled=!!u.activation,d=d||!!u.activation,n.Halo.intensity=u.intensity,a.Halo.color=(new e.Color).setRGB(l[3]/255,l[2]/255,l[1]/255);var g=t.getOutlineData();s[0]=g.color,n.Halo.outlineEnabled=!!g.activation,d=d||!!g.activation,a.Halo.outlineColor=(new e.Color).setRGB(l[3]/255,l[2]/255,l[1]/255),i.publish({event:"/VISU/SELECTION/CSI_CONTEXT_"+o+"_NON_COLOR_UPDATE",data:{eventChannel:"/VISU/SELECTION/CSI_CONTEXT_"+o+"_NON_COLOR_UPDATE",eventType:"@CSI_CONTEXT_"+o+"_NON_COLOR_UPDATE",parameters:{viewer:r,highlightType:"Halo",nonColorParameters:n.Halo}}}),i.publish({event:"/VISU/SELECTION/CSI_CONTEXT_DEFAULT_"+o+"_UPDATE",data:{eventChannel:"/VISU/SELECTION/CSI_CONTEXT_DEFAULT_"+o+"_UPDATE",eventType:"@CSI_CONTEXT_DEFAULT_"+o+"_UPDATE",parameters:{viewer:r,highlightType:"Halo",colorParameters:a.Halo}}}),(t.getStandardActivation()||t.getPolitnessData().activation)&&(c="AdvancedPoliteness",d=!0);var p=t.getAdvancedPolitnessData();return p.activation&&(c="AdvancedPoliteness",d=!0),n.AdvancedPoliteness.haloIntensity=p.haloIntensity,n.AdvancedPoliteness.outlineThickness=p.faceThickness,n.AdvancedPoliteness.visibleAlpha=p.visibleFaceAlpha/255,n.AdvancedPoliteness.occludedAlpha=p.occludedFaceAlpha/255,s[0]=p.color,a.AdvancedPoliteness.color=(new e.Color).setRGB(l[3]/255,l[2]/255,l[1]/255),s[0]=p.haloColor,a.AdvancedPoliteness.haloColor=(new e.Color).setRGB(l[3]/255,l[2]/255,l[1]/255),s[0]=p.outlineColor,a.AdvancedPoliteness.outlineColor=(new e.Color).setRGB(l[3]/255,l[2]/255,l[1]/255),i.publish({event:"/VISU/SELECTION/CSI_CONTEXT_"+o+"_NON_COLOR_UPDATE",data:{eventChannel:"/VISU/SELECTION/CSI_CONTEXT_"+o+"_NON_COLOR_UPDATE",eventType:"@CSI_CONTEXT_"+o+"_NON_COLOR_UPDATE",parameters:{viewer:r,highlightType:"AdvancedPoliteness",nonColorParameters:n.AdvancedPoliteness}}}),i.publish({event:"/VISU/SELECTION/CSI_CONTEXT_DEFAULT_"+o+"_UPDATE",data:{eventChannel:"/VISU/SELECTION/CSI_CONTEXT_DEFAULT_"+o+"_UPDATE",eventType:"@CSI_CONTEXT_DEFAULT_"+o+"_UPDATE",parameters:{viewer:r,highlightType:"AdvancedPoliteness",colorParameters:a.AdvancedPoliteness}}}),i.publish({event:"/VISU/SELECTION/CSI_CONTEXT_"+o+"_TYPE_UPDATE",data:{eventChannel:"/VISU/SELECTION/CSI_CONTEXT_"+o+"_TYPE_UPDATE",eventType:"@CSI_CONTEXT_"+o+"_TYPE_UPDATE",parameters:{viewer:r,highlightType:c}}}),r.render(),d}var h=function(e,t){this.viewManager=e,this.viewer=this.viewManager?this.viewManager.viewer:null,this.loader=t};return h.prototype={constructor:h,getSceneEnvRootForLights:function(){var e=this.viewManager._sceneEnvRootForLights;return 0===e.parents.length&&this.viewer.addNode(e),e},setViewManager:function(e){this.viewManager=e,this.viewer=this.viewManager?this.viewManager.viewer:null},getSceneEnvRootForAmbiances:function(){var e=this.viewManager._sceneEnvRootForAmbiance;return 0===e.parents.length&&this.viewer.addNode(e),e},tryUpdateAmbiance:function(e){if(!e)return Promise.reject(new Error("Missing data"));if(!e.areAmbiancesManaged())return Promise.resolve(!1);if(this.getSceneEnvRootForAmbiances().removeChildren(),e.isDefaultAmbiance())return this.viewer.removeAmbience(),this.viewer.setVisuEnv("None"),Promise.resolve(!0);var t=e.getAmbianceJSON();if(!t)return Promise.resolve(!1);if(!t.ambiance)return this.viewer.setVisuEnvOCA("Basic"),Promise.resolve(!0);var i=e.getAmbianceBuffers(),r=[];return Array.isArray(i)&&i.length>0&&i.forEach(function(e){r.push({buffer:e.getData()})}),new Promise(function(e){if(this.viewer.removeAmbience(),this.loader.load({zipped:!1,json:t,chunks:r,destinationNode:this.getSceneEnvRootForAmbiances(),doneCallback:e.bind(null,!0)}))return Promise.resolve(!0)}.bind(this))},tryUpdateLights:function(e){if(!e)return Promise.reject(new Error("Missing data"));if(!e.areLightsManaged())return Promise.resolve(!1);var t=e.getLightsJSON();if(!t)return Promise.resolve(!1);this.viewer.useDefaultLights=!1,this.getSceneEnvRootForLights().removeChildren();return this.loader.applyLights({json:t,data:{},destinationNode:this.getSceneEnvRootForLights()}),Promise.resolve(!0)},_mergeCreatedvps(e,t,i){let r=[],n=0,a=0;for(let o=0;o<e.length;o++){let s=e[o];"Main3D"==s.getType()||"3D"==s.getType()?(r.push(t[n]),n++):(r.push(i[a]),a++)}return r},_manageViewpointInfo(e,t,i){let r=null;var n=this.viewManager._viewpointMap;n.has(e.getUID())?r=n.get(e.getUID()):((r=t).createDivCSS(),r.setCsiUID(e.getUID()),n.set(e.getUID(),r),"Main3D"==e.getType()||"Main2D"==e.getType()&&"3DViewer"!=i.getViewerType()?null===this.viewer.currentViewpoint.getCsiUID()?(r._setNode(this.viewer.internalSceneGraph.root),this.viewer.selectViewpoint(null,r)):this.viewer._viewpointManager.addMainViewpoint(r,!0):this.viewer._viewpointManager.addViewpoint(r,!1)),"Main3D"!=e.getType()&&"Main2D"!=e.getType()||this.viewer.getVisibleSpace()!=e.isShowSpace()&&this.viewer.swapVisibleSpace();let a=e.getViewport();if(!a||0==a[0]&&0==a[1]&&0==a[2]&&0==a[3]?this.viewer._viewpointManager.setViewpointViewport(r,!1,0,0,1,1):this.viewer._viewpointManager.setViewpointViewport(r,!0,a[0],a[1],a[2],a[3]),e.MinZoom,e.MaxZoom,e.AaMode,e.IsStretched,e.PLMViewMode,e.IsMainDialog,e.IsV3D,"Main3D"==e.getType()||"3D"==e.getType()){let t=e.getViewpoint3DInfo();r.getControl()&&r.getControl().setNativeGravity(t.areGravityMode(),t.getGravityDirection(),t.getGravityLocked()),t.ClippingMode,t.NearValue,t.FarValue}else{let t=e.getViewpoint2DInfo();r.setNative2DClip(t.getClip(),t.getBottomLeft(),t.getTopRight()),r.setNative2DAnchor(t.getAnchor()),t.areTranslationBoundsDefined()&&setNative2DTranslationBounds(t.getBoundsX(),t.getBoundsY()),r.setNative2DDepthMode(t.getDepth())}},tryUpdateCameras:function(e){if(!e)return Promise.reject(new Error("Missing data"));if(!e.areCamerasManaged())return Promise.resolve(!1);var t=e.getCamerasJSON();if(!t)return Promise.resolve(!1);if(e instanceof n)this.loader.applyCamera({json:t,destinationNode:this.viewer.getRootNode()});else{var i=this.viewManager._viewpointMap;let r=t,n=this.loader.retrieveViewpoints({json:r},this.viewer,!0,!0),a=e.getCameras2DJSON(),o=this.loader.retrieveViewpoints({json:a},this.viewer,!0,!0),s=e.getChangeType(),l=e.getViewpointsInfo();n=this._mergeCreatedvps(l,n,o),"ViewpointListChanged"==s&&i.size>l.length&&i.forEach((e,t,i)=>{let r=!1;for(let e=0;e<l.length;e++)if(l[e].getUID()==t){r=!0;break}r||(this.viewer._viewpointManager.removeViewpoint(e),i.delete(t))});for(let t=0;t<l.length;t++){let r=n[t],a=null;this._manageViewpointInfo(l[t],r,e),r!=(a=i.get(l[t].getUID()))&&(a._nativeTranslationOffset=r._nativeTranslationOffset,a.moveTo({eyePosition:r.position,orientation:r.control.orientation,distanceToTarget:r.control.distanceToTarget}),a.control.update(),a.camera.fov=r.camera.fov,a.setProjectionType(r.getProjectionType(),null,!0),a._nativeZoomType==r._nativeZoomType&&a._nativeZoomRatio==r._nativeZoomRatio||a.setNativeZoom(r._nativeZoomType,r._nativeZoomRatio),a._nativeZoom=r._nativeZoom,r.dispose())}}return Promise.resolve(!0)},tryUpdateViewModes:function(t){if(this.viewer){if(!t)return Promise.reject(new Error("Missing data"));if(!t.areViewModesManaged())return Promise.resolve(!1);var i=t.getViewModeMask(),r="Wireframe";i&a.VIEW_HRD?r="ShadingIllustration":i&a.VIEW_MESH&&(r="Shading",i&a.VIEW_MATERIAL&&(r+="Material"),i&a.VIEW_EDGE&&(r+="Edges",i&a.VIEW_WITHOUT_SMOOTH_EDGE?r+="NoSmoothEdges":i&a.VIEW_WITH_HALF_SMOOTH_EDGE&&(r+="HalfSmoothEdges"),i&a.VIEW_HIDDEN_EDGE&&(r+="HiddenEdges")));var n=i&a.VIEW_REP_OVERLOAD;this.viewer._getCSIOverrideManager().setRepViewMode(n),this.viewer.setVisuShadingMode(r),this.viewer._setVisuOutlineMode((i&a.VIEW_OUTLINE)>0),this.viewer.setLinesFilter(!(i&a.VIEW_WITHOUT_WIRES)),this.viewer.setVerticesFilter(!(i&a.VIEW_WITHOUT_VERTEX)),this.viewer.setPointsFilter(!(i&a.VIEW_WITHOUT_POINTS)),this.viewer.setAxisFilter(!(i&a.VIEW_WITHOUT_AXIS));var s=t.getViewModeAppearanceStructure(a.VIEW_APPEARANCE);if(s){var l=o[s.appearanceName];void 0!==l&&(this.viewer.setVisuAppearanceMode(l),l!==e.DefaultAppearanceMode.GENERIC_PLASTIC&&l!==e.DefaultAppearanceMode.GENERIC_METAL||this.viewer.setCustomMaterialModeParameters(s.customParams))}else this.viewer.setVisuAppearanceMode(o.Basic);return Promise.resolve(!0)}},tryUpdateSupportParameters:function(t,r){var n=Promise.resolve(!0);if(!t)return Promise.reject(new Error("Missing data"));if(!t.areSupportParametersManaged())return Promise.resolve(!1);var a=t.getHighlightRenderingData();a&&function(t,r){for(var n=t.getMultiColorData(),a=n.highlightSlots,o=0;o<a.length;o++){s[0]=a[o];var d=(new e.Color).setRGB(l[3]/255,l[2]/255,l[1]/255);i.publish({event:"/VISU/SELECTION/CSI_CONTEXT_MULTI_HIGHLIGHT_UPDATE",data:{eventChannel:"/VISU/SELECTION/CSI_CONTEXT_MULTI_HIGHLIGHT_UPDATE",eventType:"@CSI_CONTEXT_MULTI_HIGHLIGHT_UPDATE",parameters:{slot:o,color:d,viewer:r}}})}i.publish({event:"/VISU/SELECTION/CSI_CONTEXT_MULTI_HIGHLIGHT_ACTIVATION",data:{eventChannel:"/VISU/SELECTION/CSI_CONTEXT_MULTI_HIGHLIGHT_ACTIVATION",eventType:"@CSI_CONTEXT_MULTI_HIGHLIGHT_ACTIVATION",parameters:{viewer:r,enabled:!!n.activation}}});var h=c(t,r,{Halo:{colorEnabled:e.DefaultHighlightData.halo.colorEnabled,intensity:e.DefaultHighlightData.halo.intensity,haloEnabled:e.DefaultHighlightData.halo.haloEnabled,haloIntensity:e.DefaultHighlightData.halo.haloIntensity,haloThickness:e.DefaultHighlightData.halo.haloThickness,outlineEnabled:e.DefaultHighlightData.halo.outlineEnabled,outlineAlpha:e.DefaultHighlightData.halo.outlineAlpha,outlineThickness:e.DefaultHighlightData.halo.outlineThickness},AdvancedPoliteness:{colorEnabled:e.DefaultHighlightData.advancedpolite.colorEnabled,visibleAlpha:e.DefaultHighlightData.advancedpolite.visibleAlpha,occludedAlpha:e.DefaultHighlightData.advancedpolite.occludedAlpha,haloEnabled:e.DefaultHighlightData.advancedpolite.haloEnabled,haloIntensity:e.DefaultHighlightData.advancedpolite.haloIntensity,haloThickness:e.DefaultHighlightData.advancedpolite.haloThickness,outlineEnabled:e.DefaultHighlightData.advancedpolite.outlineEnabled,outlineAlpha:e.DefaultHighlightData.advancedpolite.outlineAlpha,outlineThickness:e.DefaultHighlightData.advancedpolite.outlineThickness}},{Halo:{color:e.DefaultHighlightData.halo.color,outlineColor:e.DefaultHighlightData.halo.outlineColor,haloColor:e.DefaultHighlightData.halo.haloColor},AdvancedPoliteness:{color:e.DefaultHighlightData.advancedpolite.color,outlineColor:e.DefaultHighlightData.advancedpolite.outlineColor,haloColor:e.DefaultHighlightData.advancedpolite.haloColor}},"HIGHLIGHT");i.publish({event:"/VISU/SELECTION/CSI_CONTEXT_HIGHLIGHT_ACTIVATION",data:{eventChannel:"/VISU/SELECTION/CSI_CONTEXT_HIGHLIGHT_ACTIVATION",eventType:"@CSI_CONTEXT_HIGHLIGHT_ACTIVATION",parameters:{viewer:r,enabled:h}}}),r.internalSceneGraph.selectionHL.enable(h)}(a,this.viewer);var o=t.getPrehighlightRenderingData();o&&function(t,i){var r={Halo:{colorEnabled:e.DefaultPreHighlightData.halo.colorEnabled,intensity:e.DefaultPreHighlightData.halo.intensity,haloEnabled:e.DefaultPreHighlightData.halo.haloEnabled,haloIntensity:e.DefaultPreHighlightData.halo.haloIntensity,haloThickness:e.DefaultPreHighlightData.halo.haloThickness,outlineEnabled:e.DefaultPreHighlightData.halo.outlineEnabled,outlineAlpha:e.DefaultPreHighlightData.halo.outlineAlpha,outlineThickness:e.DefaultPreHighlightData.halo.outlineThickness},AdvancedPoliteness:{colorEnabled:e.DefaultPreHighlightData.advancedpolite.colorEnabled,visibleAlpha:e.DefaultPreHighlightData.advancedpolite.visibleAlpha,occludedAlpha:e.DefaultPreHighlightData.advancedpolite.occludedAlpha,haloEnabled:e.DefaultPreHighlightData.advancedpolite.haloEnabled,haloIntensity:e.DefaultPreHighlightData.advancedpolite.haloIntensity,haloThickness:e.DefaultPreHighlightData.advancedpolite.haloThickness,outlineEnabled:e.DefaultPreHighlightData.advancedpolite.outlineEnabled,outlineAlpha:e.DefaultPreHighlightData.advancedpolite.outlineAlpha,outlineThickness:e.DefaultPreHighlightData.advancedpolite.outlineThickness}},n={Halo:{color:e.DefaultPreHighlightData.halo.color,outlineColor:e.DefaultPreHighlightData.halo.outlineColor,haloColor:e.DefaultPreHighlightData.halo.haloColor},AdvancedPoliteness:{color:e.DefaultPreHighlightData.advancedpolite.color,outlineColor:e.DefaultPreHighlightData.advancedpolite.outlineColor,haloColor:e.DefaultPreHighlightData.advancedpolite.haloColor}};i.internalSceneGraph.selectionPreHL.enable(c(t,i,r,n,"PREHIGHLIGHT"))}(o,this.viewer);var d=t.getColorMap();if(d){for(var h=[],u=0;u<d.length;u+=3){var g=(new e.Color).setRGB(d[u],d[u+1],d[u+2]);h.push(g)}i.publish({event:"/VISU/GRAPHIC_ATTRIBUTE_SET/COLOR_MAP_UPDATE",data:{eventChannel:"/VISU/GRAPHIC_ATTRIBUTE_SET/COLOR_MAP_UPDATE",eventType:"@COLOR_MAP_UPDATE",parameters:{colorMap:h,viewer:this.viewer}}}),n=this.viewer._refreshPLMViewMode(r),this.viewer.renderer.resetGSSOCache(),this.viewer.render()}const p=t.getBackground3DViewMode();if(null!==p){const t=(1&p)>0,i=(2&p)>0,r=(4&p)>0,n=(8&p)>0,a=(16&p)>0,o=(32&p)>0;this.viewer.setBackgroundViewMode(i?e.BackgroundViewMode.NO_DISPLAY:a?e.BackgroundViewMode.GHOST:t?e.BackgroundViewMode.LOWLIGHT:n?e.BackgroundViewMode.FOG:e.BackgroundViewMode.NORMAL),this.viewer.invertNodeBackgroundView(o),this.viewer.pickNodeBackgroundView(!r),this.viewer.render()}const f=t.get2DMode();if(f){let t,i;if(f._plane){const i=(new e.Vector3).copy(f._plane._firstDirection),r=(new e.Vector3).copy(f._plane._secondDirection),n=i.cross(r);t=new e.Plane(n,-n.dot(f._plane._origin))}switch(f._mode){case 1:i=e.PlaneViewMode.NO_DISPLAY;break;case 2:i=e.PlaneViewMode.LOWLIGHT;break;case 4:i=e.PlaneViewMode.LOWLIGHT_NO_PICK;break;default:i=e.PlaneViewMode.NORMAL}this.viewer.setPlaneViewMode({mode:i,plane:t})}else this.viewer.setPlaneViewMode({mode:e.PlaneViewMode.NORMAL});var m=t.getClippingPlane();m&&this.updateClippingPlane(m);let v=t.getMainViewpointUID();if(null==v);else{let e=this.viewManager._viewpointMap.get(v);e?this.viewer._viewpointManager.setManipulatedViewpoint(e):console.error("no viewpoint with provided UID exists")}return n},tryUpdatePLMViewMode:function(e,t){var i,r=e.getViewpointsInfo();if(r)for(i=0;i<r.length;i++)this.viewer._setViewpointPLMViewMode(r[i]._uid,r[i]._plmViewMode);var n=e.getPLMViewMode();return n?this.viewer._updatePLMViewMode(n,t):Promise.resolve(!0)},updateClippingPlane:function(t){var i,r,n=this.viewer.getRootNode();if(n){var a=n.clippingContext,o=a&&a.planes.concat([]);if(o)for(i=0;i<o.length;i++)n.enableClippingPlane(o[i],!1)}var s,l,c,h=t._normal,u=t._point,g=0;for(i=0;i<t._nbPlanes;i++)(s=new e.Vector3(h[g],h[g+1],h[g+2])).normalize(),l=new e.Vector3(u[g],u[g+1],u[g+2]),(r=new e.Plane).setFromNormalAndCoplanarPoint(s,l),n.enableClippingPlane(r,!0),c=t._flags[i],n.clippingContext.setPlaneParams(r,{capping:!!(c&d)}),g+=3},tryUpdateContextData:function(t){if(!t)return Promise.reject(new Error("Missing data"));var r=t.container&&t.container.getVisContextData&&t.container.getVisContextData();if(!r)return Promise.resolve(!1);if(r.VisuStreaming){this.viewer.setupRemoteRender(),this.vpSubscriptionToken&&(i.unsubscribe(this.vpSubscriptionToken),this.vpSubscriptionToken=null),this.streamingInterface&&(this.streamingInterface.destroy(),this.streamingInterface=null);let t=r.VisuStreaming._commonData;r.VisuStreaming._objectsData;if(0==Object.keys(t).length)return Promise.resolve(!0);{let n=this;return new Promise(function(a){require(["DS/VisuStreamingA2X/VisuStreamingInterface","DS/VisuStreamingTypes/VisCSICamera","DS/VisuStreamingTypes/VisCSIVector3"],function(o,s,l){n.viewer.setupRemoteRender(!0);n.streamingInterface=new o(r.VisuStreaming,function(e,i,r){if("JPEG"==t.streamProtocol){var a=e.readBuffer("colorImgBuffer"),o=new Uint8Array(a),s=new Blob([o],{type:"image/jpeg"});n.viewer._onRemoteImageReceived({data:s,format:"blob"},r)}else if("A2X"==t.streamProtocol){let e=!1;n.viewer.setRemoteVideo(i,r,e)}else console.warn("unsupported streaming protocol : "+t.streamProtocol)},function(e){console.log(e)});let d=n.viewManager._viewpointMap,c=function(e){return new l({x:e.x,y:e.y,z:e.z})};n.vpSubscriptionToken=i.subscribe({event:"/VISU/"},function(t){if("@onViewpointChange"===t.eventType){let i=t.viewpoint,r=n.streamingInterface.connections.get(i.getCsiUID());if(r){let n=(new e.Vector3).subVectors(t.cameraTarget,t.cameraEye),a=n.length(),o=new s({orthogonal:1==i.projectionType,position:c(t.cameraEye),direction:c(n.normalize()),upDirection:c(t.cameraUp),focusDistance:a,angle:i.camera.fov/2,aperture:i.camera.aperture});r.connection.updateCamera(o)}}});for(let[e,t]of n.streamingInterface.connections.entries()){d.get(e)}a.bind(null,!0)})})}}return Promise.resolve(!1)},tryUpdateSceneEnv:function(e,t){var i=this.tryUpdateAmbiance(e),r=this.tryUpdateLights(e),n=this.tryUpdateCameras(e),a=this.tryUpdateViewModes(e),o=this.tryUpdateSupportParameters(e),s=this.tryUpdatePLMViewMode(e,t),l=this.tryUpdateContextData(e);return Promise.all([i,r,n,a,o,s,l]).then(function(e){return Promise.resolve({ambianceUpdated:e[0],lightsUpdated:e[1],cameraUpdated:e[2],viewModesUpdated:e[3],supportParametersUpdated:e[4]})})}},h}),define("DS/WebVisuParameters/WebVisuUpdateTransaction",["DS/WebVisuParameters/AbstractWebVisuUpdateTransaction","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIVMClientVisRepViewModeFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisClippingFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisAnnotation","DS/CSIViewModelWebInterfaces/CSIVMClientVisAnnotationValue","DS/CSIViewModelWebInterfaces/CSIVMClientVisCircularScissorFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisLayerFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisGASInheritFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisPolygonOffsetFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisPolygonalScissorFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisCurveClippingFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisZModeFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisFurtiveFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisContextFilter","DS/Visualization/MaterialManager","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/Mesh3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/CGRNode","DS/Visualization/SceneGraphFactory","DS/Visualization/PathElement","DS/VisuLoaders/ThreeDXLoader","DS/WebVisuParameters/BoundingSphereParameterHelper","DS/WebVisuParameters/CustomDataParameterHelper","DS/WebVisuParameters/GeometryParameterHelper","DS/WebVisuParameters/InfiniteGeometryParameterHelper","DS/WebVisuParameters/GraphicPropertyParameterHelper","DS/WebVisuParameters/SceneEnvParameterHelper","DS/WebVisuParameters/SceneEnvParameterItem","DS/Mesh/MeshUtils","DS/Visualization/GraphicAttributeSet","DS/Visualization/ClippingContext","DS/Visualization/RenderStyle","DS/EKEventsWeb/EKEvents","DS/Visualization/Filters/GeomTypeFilter","DS/Visualization/Filters/GASInheritFilter","DS/Visualization/Filters/PolygonOffsetFilter","DS/Visualization/Filters/ZModeFilter","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/CoreEvents/Events","DS/Visualization/RenderMode","DS/SceneGraphOverrides/GenericOverride"],function(e,t,i,r,n,a,o,s,l,d,c,h,u,g,p,f,m,v,y,S,_,w,I,T,D,C,P,E,M,A,b,V,O,N,G,R,x,H,F,L,U,B,k,W,z){"use strict";var j=null,X=null,K={volume:m.MaterialUtils.createShinyFaceMaterial({side:m.FrontSide,color:new m.Color(16777215)}),surface:m.MaterialUtils.createShinyFaceMaterial({side:m.DoubleSide,color:new m.Color(16777215)}),line:new m.LineBasicMaterial({color:new m.Color(0)}),point:new m.ParticleBasicMaterial({size:1,color:new m.Color(0),blending:m.NormalBlending,depthTest:!1,sizeAttenuation:!1,transparent:!1})};K.volume.line=K.line,K.volume.point=K.point,K.surface.line=K.line,K.surface.point=K.point;var J=new D,Y=new b(null,J),Z=1,q=2,$=4,Q=8,ee=32,te=64,ie=4096,re=8192,ne=32768,ae=131072,oe=262144,se=524288;const le=536870912,de=536870913,ce=536870914,he=[0,0],ue=[1,1.1],ge=[3,2.2];class pe{constructor(e,t){this.prim=e,this.isMixedGP=!0,this.mesh=t,this._idObject=null}setIdentificationObject(e){this._idObject=e}getIdentificationObject(){return this._idObject}_setGAS(e){this.mesh._setGAS([this.prim],e)}}var fe=function(e,t){if(t)for(var i=0;i<e.meshList.length;i++){var r=e.meshList[i]._occurrence.node;if(r&&2===r._bodyDim)return}for(i=0;i<e.drawingGroups.length;i++){var n=e.drawingGroups[i];n.gas,n.material;4===n.glType&&(n.getPrimitivesCount()&&(n.getPrimitiveRep(0).solid=t))}},me=function(e){return e?e.children[0]instanceof y?e.children[0]:e.children[1]:null},ve=function(e){return e?e.children[0]instanceof y?e.children[1]:e.children[0]:null},ye=function(e){var t=null;if(e)switch(e.getType()){case 1:case 2:t=new H(-1);break;case 3:t=new H(m.GeomTypeEnum.AXIS_SYSTEM);break;case 4:t=new H(m.GeomTypeEnum.WIRE_EDGE);break;case 5:t=new H(m.GeomTypeEnum.FREE_POINT);break;default:t=new H(-1)}return t},Se=function(t,i,r){e.call(this,t,i,r),this._dialogBag=null,this._onTopBag=null,this._furtiveBag=null,this._transientBag=null,this.annotationFilters=[],this.contextFilters=[],this.nodesToRemove=[],this.nodesToOptimize={},this.inverseAction={adds:[],removes:[],overrides:{}},this.commitAction={adds:[],removes:[]}};function _e(e,t,i){function r(e,r){e&&e.hasInfiniteGeometry()?i(e):t(e,r)}const n=e.getGeometricalData(),a=e.getInfiniteGeometricalData();a?(r(n,!0),r(a,!1)):r(n,!1)}(Se.prototype=Object.create(e.prototype)).getParentNode=function(e){var t=this.getOperatedObject(e);let i=e.getTreeKey();if(!t&&i){switch(i.getView3DType()){case i.View3DType.View3D_Dialog:this._dialogBag||(this._dialogBag=new v,this.view.addChild(this._dialogBag),this._dialogBag.setAsNativeDialog(!0)),t=this._dialogBag;break;case i.View3DType.View3D_OnTop:this._onTopBag||(this._onTopBag=new v,this.view.addChild(this._onTopBag),this._onTopBag.setAsNativeOnTop(!0)),t=this._onTopBag;break;case i.View3DType.View3D_Furtive:this._furtiveBag||(this._furtiveBag=new v,this.view.addChild(this._furtiveBag),this._furtiveBag.setAsNativeFurtive(!0)),t=this._furtiveBag;break;case i.View3DType.View3D_Transient:this._transientBag||(this._transientBag=new v),t=this._transientBag;break;case i.View3DType.View3D_Highlight:case i.View3DType.View3D_MultiColorHighlight:case i.View3DType.View3D_PreHighlight:t=this.view;break;case i.View3DType.View3D_Unknown:case i.View3DType.View3D_Main:default:t=this.view}}return t},Se.prototype.doOperation=function(e){var t=x.Trace.traceStart("techno_webvisu","message_to_scenegraph");this.setDefaultMaterials(this.viewManager.getDefaultMaterials()),X!==this&&(X&&X.executeInverse(),X=this);var i=this,r=e.getType();switch(r){case e.OperationType.RemoveTextureFromCache:var n=e.getTextureUids();if(n.length>0)for(var a=new A(void 0,this.clientManager),o=0;o<n.length;o++)a.removeTextureFromCache(n[o]);break;case e.OperationType.RemoveAll:this.view&&this.view.removeChildren();break;case e.OperationType.AddNode:case e.OperationType.AddBody:case e.OperationType.CreateRoot:var s=null,l=!1,d=null,c=e.getAttributes(),h=null,u=null,g=(Pe=this.getParentNode(e))instanceof v,p=Pe instanceof THREEDS.Nodes.CGRNode,f=g&&!p,m=e.getGeometricalData(),S=e.getInfiniteGeometricalData();const t=e.getVisData();var _=null,I=null;let x=null,X=null,xe=null;if(c){let e=c.getISOData();I=c.get2DTo3DData(),e&&(_=e.getDrawLayer()),h=c.getPositionMatrix(),h=this.unstreamMatrix(h),u=c.getFilters&&c.getFilters(),x=c.getFixedSizeData(),X=c.getBillboardData(),d={matrix:h||void 0},xe=ye(c.getSemanticData())}if(r===e.OperationType.AddNode||r===e.OperationType.CreateRoot)if(f)s=x?this.nodeFromFixedSizeData(x):I?this.createNodeFromData2Dto3D(I):X?this.nodeFromBillboardData(X):new v,xe&&s.setVisuFilters({geomTypeFilter:xe});else{s=new O.SGBag(d);var T=p?Pe.internalSceneGraph:Pe;s.parents.push(T),T.children.push(s)}else if(f)S||m&&m.hasInfiniteGeometry()?s=new v:(l=!0,(s=new y).setShadow(!0,!0),s.mesh3js.fromLoadedModel=!0,s._occurrences[0].renderable.fromLoadedModel=!0,s.mesh3js.geometry=s._occurrences[0].renderable.geometry);else{s=m&&m.hasInfiniteGeometry()?new O.SGBag(d):new O.SGRep(d);T=p?Pe.internalSceneGraph:Pe;s.parents.push(T),T.children.push(s)}if(!s)return;e.setCreatedObject(s);var D=null;if(f&&(c&&h&&s.setMatrix(h),D=m?C.getBoundingSphere(m.getBoundingSphere()):null,this.applyBEToBody(s,D),null!=_&&s.setAsNativeIsoBag(_),I&&this.apply2DTo3DData(s,I),Pe.addChild(s),u&&this.setFilters(s,u),m)){if(m.getDimension){s._bodyDim=m.getDimension();for(var b=0;b<s._occurrences.length;b++){(U=s._occurrences[b].renderable)&&(U._bodyDim=s._bodyDim)}}m.getTerminalRepWithPrimitivesWithoutGas()&&l&&s._setNoGASOnPrimitives(!!m.getTerminalRepWithPrimitivesWithoutGas()),m.getUseParentForPixelCulling()&&l&&s._setPixelCullingFromParent(!!m.getUseParentForPixelCulling())}if(t){const e=s.mesh3js.geometry.boundingBox,i=s.mesh3js.geometry.boundingSphere;s.mesh3js.geometry=E.createGeometryBuffersV6(t),s.mesh3js.geometry.boundingBox=e,s.mesh3js.geometry.boundingSphere=i}var N=m?m.getInitializers():null;if(N&&N.length)for(o=0;o<N.length;o++){var G=N[o];if(G instanceof y){if(!G||!G._occurrences[0].renderable){console.warn("Error during initializers of AddBody operation");continue}for(var R=G._occurrences[0].renderable,H=0;H<R.geometry.length;H++){var F=R.geometry[H],L=R.layer?R.layer.getIntervals(F,null,!0):null;for(b=0;b<s._occurrences.length;b++)s._occurrences[b].renderable.addGeometry(F,!D,L);s._bodyDim&&fe(F,3===s._bodyDim)}if(he=R.selectionGroups)for(b=0;b<s._occurrences.length;b++)for(var U=s._occurrences[b].renderable,B=0;B<he.length;B++)U.addSelectionGroup(he[B].clone())}else if(G instanceof v){var k=G.getChildren();for(H=0;H<k.length;H++)s.addChild(k[H])}}if(D)for(b=0;b<s._occurrences.length;b++){var W=s._occurrences[b].renderable;this.applyBEToRenderable(W,s)}this.inverseAction.removes.push({parentNode:Pe,node:s}),s&&c&&c._PLMData&&this.viewManager.viewer._setNodePLMViewMode(s,c._PLMData,e.getTreeKey().getViewpointUID());break;case e.OperationType.AddCustomNode:s=null;if((z=new P(e.getCustomData(),function(){i.viewManager._publishVisuAnswer(!1)}))&&(s=z.getNode()),!s)return;if(e.setCreatedObject(s),c=e.getAttributes()){h=c.getPositionMatrix();(h=this.unstreamMatrix(h))&&s.setMatrix(h)}(Pe=this.getParentNode(e)).addChild(s),this.inverseAction.removes.push({parentNode:Pe,node:s});break;case e.OperationType.ModifyCustomNode:s=this.getOperatedObject(e);var z=new P(e.getCustomData(),function(){i.viewManager._publishVisuAnswer(!1)});s&&z.modifyNode(s);break;case e.OperationType.AddExistingNode:case e.OperationType.RemoveExistingNode:if(!(s=this.getOperandObject(e)))return;(p=(Pe=this.getParentNode(e))instanceof THREEDS.Nodes.CGRNode)&&(Pe=Pe.internalSceneGraph);var j=e.getBatchParentObject(),K=e.getBatchParentSharedObject();if(Pe instanceof O.SGBag){if(!j)return;this.addExistingNode(K,j,Pe,s)}else r===e.OperationType.AddExistingNode?Pe.addChild(s):this.nodesToRemove.push({parentNode:Pe,node:s}),r===e.OperationType.AddExistingNode?this.inverseAction.removes.push({parentNode:Pe,node:s}):this.inverseAction.adds.push({parentNode:Pe,node:s});break;case e.OperationType.AddExistingCells:var Z=this.getOperatedObject(e),q=(j=e.getBatchParentObject(),e.getBatchParentCellObject()),$=e._ExistingCells._noContext;if(void 0===e.getOperandSubElements)return;var Q=e.getOperandSubElements(),ee=this.addExistingCells(j,q,$,Z,Q);(Z instanceof y||Z instanceof v)&&ee&&Z.show(Q);break;case e.OperationType.RemoveExistingCells:Z=this.getOperatedObject(e);if(void 0===e.getOperandSubElements)return;Q=e.getOperandSubElements();this.removeExistingCells(Z,Q);break;case e.OperationType.AddCells:this.AddCells(e);break;case e.OperationType.ApplyGP:var te=e.getGraphicProperties();if(!te)return;s=this.getOperatedObject(e),j=e.getBatchParentObject();if(!s&&!j)return;var ie=s&&s instanceof O.SGBag,re=s&&s instanceof O.SGRep,ne=function(e){var t=[];if(e instanceof O.SGRep)return t.push(e),t;for(var i=0;i<e.children.length;i++)for(var r=ne(e.children[i]),n=0;n<r.length;n++)t.push(r[n]);return t};if(!s||(re||ie)){var ae=ve(j),oe=me(j),se=e.getOperatedSubElements(),le=se&&se.length?se.slice():[];if(ie){var de=ne(s);for(o=0;o<de.length;o++)le.push(de[o])}else re&&le.push(s);var ce=function(e,t){for(var i=e.children.length,r=[],n=[],a=0;a<t.length;a++){var o=t[a];if(o instanceof O.SGPrimitiveHelper)n.push(o);else if(o instanceof O.SGRep){var s,l=o.getIdentificationObject().getLocalId();for(s=0;s<i;s++){var d=e.children[s];if(l===d.persistentId){r.push(d);break}}if(s===i)for(var c=0;c<o.getPrimitivesCount();c++){var h=new O.SGPrimitiveHelper;h.set(o,c),n.push(h)}}}return{finiteSubElements:n,infiniteSubElements:r}}(ae,le);a=new A(te,this.clientManager);ce.finiteSubElements.length>0&&a.applyGP(this,oe,ce.finiteSubElements,e.getOperatedGeomTypes&&e.getOperatedGeomTypes()),ce.infiniteSubElements.length>0&&a.applyGP(this,ae,ce.infiniteSubElements,e.getOperatedGeomTypes&&e.getOperatedGeomTypes())}else{(a=new A(te,this.clientManager)).applyGP(this,s,e.getOperatedSubElements(),e.getOperatedGeomTypes&&e.getOperatedGeomTypes())}break;case e.OperationType.ApplyAttributes:if(!((s=this.getOperatedObject(e))&&s instanceof v))return;if(c=e.getAttributes()){let e=c.getISOData();e&&(_=e.getDrawLayer(),s.setAsNativeIsoBag(_)),(h=c.getPositionMatrix())&&(h=this.unstreamMatrix(h))&&s.setMatrix(h);u=c.getFilters&&c.getFilters();this.setFilters(s,u),(I=c.get2DTo3DData())&&this.apply2DTo3DData(s,I),c.getFixedSizeData()&&this.nodeFromFixedSizeData(x,s);const t=c.getBillboardData();t&&this.nodeFromBillboardData(t,s);let i=ye(c.getSemanticData());i&&s.setVisuFilters({geomTypeFilter:i})}break;case e.OperationType.AddGroups:if(!(s=this.getOperatedObject(e)))return;if(s instanceof w||s instanceof O.SGRep)(j=e.getBatchParentObject())&&2===j.children.length&&(s=me(j));if(!(s instanceof y))return;m=e.getGeometricalData();var he=e._Groups;for(o=0;o<he.length;o++){var ue=he[o].getGroupedElements(),ge=new O.SelectionGroup;for(H=0;H<ue.length;H++)ge.addPrimitive(ue[H]);for(H=0;H<s._occurrences.length;H++){(W=s._occurrences[H].renderable).addSelectionGroup(ge)}}break;case e.OperationType.ModifyBody:this.ModifyBody(e);break;case e.OperationType.ModifyBatch:if(!((s=this.getOperatedObject(e))&&s instanceof w))return;if(!(m=e.getGeometricalData()))return;var pe={version:Te};if(Ee=m?m.getGeometries():void 0){var Se=me(s);for(o=0;o<Ee.length;o++){var _e=new E(Ee[o],pe);F=_e.getGeometry(this,!0,Se&&Se._getNoGASOnPrimitives());_e.updateGeometry(Se)}}break;case e.OperationType.AddBatchNode:case e.OperationType.CreateRootBatch:h=null,d=null;if(c=e.getAttributes()){h=c.getPositionMatrix();d={matrix:(h=this.unstreamMatrix(h))||void 0}}var we=new O.SGBag(d);(s=new THREEDS.Nodes.CGRNode(we)).productType="3DSyncBatch";m=e.getGeometricalData(),S=e.getInfiniteGeometricalData();var Ie=!!m&&m.hasGeomDecorations(),Te=m?m.getVersion():null,De=new y;De.setShadow(!0,!0),De.mesh3js.fromLoadedModel=!0,De._occurrences[0].renderable.fromLoadedModel=!0,De.mesh3js.geometry=De._occurrences[0].renderable.geometry;D=m?C.getBoundingSphere(m.getBoundingSphere()):null;if(this.applyBEToBody(De,D),m&&m.getDimension)De._bodyDim=m.getDimension(),(U=De._occurrences[0].renderable)&&(U._bodyDim=De._bodyDim);var Ce=new v;c&&h&&s.setMatrix(h),e.setCreatedObject(s);var Pe=this.getParentNode(e),Ee=m?m.getGeometries():void 0,Me=S?S.getGeometries():void 0;pe={version:Te,hasGeomDecorations:Ie};if(Ee)for(o=0;o<Ee.length;o++){var Ae=(Ge=new E(Ee[o],pe).getGeometry(this,!0,De._getNoGASOnPrimitives())).geometry,be=Ge.primitiveIDs;(W=De._occurrences[0].renderable).addGeometry(Ae,!1),W.geometry.boundingSphere.copy(Ae.boundingSphere),W.geometry.boundingBox.copy(Ae.boundingBox);var Ve=Ae.drawingGroups;for(H=0;H<Ve.length;H++)for(b=0;b<Ve[H].getPrimitivesCount();b++){var Oe=new O.SGPrimitiveHelper;Oe.set(Ve[H],b),e.addCreatedObjectWithID(Oe,be[H][b])}}if(D){W=De._occurrences[0].renderable;this.applyBEToRenderable(W,De)}if(Me){var Ne=function(e){var t=[];if(e instanceof y)t=e.getPrimitives();else if(e instanceof v)for(var i=0;i<e.children.length;i++)for(var r=Ne(e.children[i]),n=0;n<r.length;n++)t.push(r[n]);return t};for(o=0;o<Me.length;o++){var Ge;for(Ae=(Ge=new M(Me[o],J).getInfiniteGeometry(this,Ce)).geometry,be=Ge.primitiveIDs,H=0;H<Ae.length;H++){for(Q=Ne(Ae[H]),b=0;b<Q.length;b++)Q[b]=Q[b].sgNode._getSGPrimitive(!0);if(Q.length){var Re=new O.SGRep({primitives:Q});for(b=0;b<Q.length;b++)Q[b].rep=Re;e.addCreatedObjectWithID(Re,be[H])}else{Re=new O.SGRep({});e.addCreatedObjectWithID(Re,be[H])}}}}s.addChild(De),s.addChild(Ce),Pe.addChild(s),this.inverseAction.removes.push({parentNode:Pe,node:s});break;case e.OperationType.ModifySceneEnv:Y.setViewManager(this.viewManager);Y.tryUpdateSceneEnv(new V.SceneEnvData(e.getSceneEnvData()),this.clientManager);break;case e.OperationType.VisuContextUpdate:Y.setViewManager(this.viewManager);Y.tryUpdateSceneEnv(new V.VisuContextData(e.getVisuContext()),this.clientManager)}t.End()},Se.prototype.commit=function(){this.executeInverse({commits:!0,overrides:!0,optimize:!0}),X=null,this.executeEnd()},Se.prototype.abort=function(){this.executeInverse({inverses:!0,overrides:!0}),X=null,this.executeEnd()},Se.prototype.executeEnd=function(){this.setAnnotationFilters(),this.annotationFilters=[],this.setContextFilters(),this.contextFilters=[];for(var e=0;e<this.nodesToRemove.length;e++){var t=this.nodesToRemove[e];t.parentNode.removeChild(t.node)}this.nodesToRemove=[],this.optimizeMeshes(),this.viewManager._publishVisuAnswer(!0)},Se.prototype.executeInverse=function(e){if(e){if(e.inverses){for(var t=0;t<this.inverseAction.adds.length;t++){(o=this.inverseAction.adds[t]).parentNode.addChild(o.node)}for(t=0;t<this.inverseAction.removes.length;t++){var i=(o=this.inverseAction.removes[t]).parentNode,r=o.node;if(i instanceof v)i.removeChild(r);else{var n=i instanceof w?i.internalSceneGraph:i,a=n.children.indexOf(r);-1!==a&&n.children.splice(a,1)}}}if(e.commits)for(t=0;t<this.commitAction.removes.length;t++){var o;(o=this.commitAction.removes[t]).parentNode.removeChild(o.node)}if(e.optimize&&this.optimizeMeshes(),e.overrides){var s=this.getDefaultMaterials();for(var l in this.inverseAction.overrides){var d=this.inverseAction.overrides[l];d.node.setMaterial(s.face),d.node.setPickable(O.PICKTHROUGH),d.node.setNoZ(!1)}}}},Se.prototype.optimizeMeshes=function(){for(var e in this.nodesToOptimize)this.nodesToOptimize[e];this.nodesToOptimize={}},Se.prototype.applyBEToBody=function(e,t){if(e&&t){var i=e instanceof y;t.radius||t.pixelRadius||(t.radius=1e3,e.exludeFromBounding(!0),i&&e.setFrustumCulled(!1)),e.forceBoundingElements(!0,{sphere:t,box:t.getBoundingBox()},null)}},Se.prototype.applyBEToRenderable=function(e,t){e&&(e.boundingSphere.copy(t.bSphere),e.boundingBox.copy(t.bBox),e.geometry&&(e.geometry.boundingSphere=e.boundingSphere,e.geometry.boundingBox=e.boundingBox))},Se.prototype.unstreamMatrix=function(e){if(!e)return null;var t=e.getArray(1);if(!t)return null;var i=new m.Matrix4;return i.set(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],0,0,0,1),i},Se.prototype.getStaticMaterial=function(e){return this.viewManager?this.viewManager.getStaticMaterial(e):null},Se.prototype.getStaticLook=function(e){return this.viewManager?this.viewManager.getStaticLook(e):null},Se.prototype.setDefaultMaterials=function(e){if(e.surface||e.face){var t=e.surface?e.surface:e.face;K.surface=t}e.volume?K.volume=e.volume:e.face&&(K.volume=e.face),e.line&&(K.line=e.line,K.surface.line=K.surface.line,K.volume.line=K.volume.line),e.point&&(K.point=e.point,K.surface.point=K.surface.point,K.volume.point=K.volume.point)},Se.prototype.getDefaultMaterials=function(){return K},Se.prototype.getMaterialManager=function(){return j||(j=new f),j},Se.prototype.findAssociatedInfiniteNode3D=function(e,t){var i=e.persistentId;if(i&&i===t)return e;for(var r=e.children,n=0;n<r.length;n++){var a=this.findAssociatedInfiniteNode3D(r[n],t);if(a)return a}return null},Se.prototype.addExistingNode=function(e,t,i,r){if(i.children.push(r),r.parents.push(i),!e||t===e)return!0;var n=me(e),a=function(e){var t=[];if(e instanceof O.SGRep){for(var i=0;i<e.getPrimitivesCount();i++){var r=new O.SGPrimitiveHelper;r.set(e,i),t.push(r)}return t}for(i=0;i<e.children.length;i++)for(var n=a(e.children[i]),o=0;o<n.length;o++)t.push(n[o]);return t},o=a(r);this.addPrimitivesToMesh3D(o,n,e)&&n.show(o)},Se.prototype.AddCells=function(e){let t=this.getOperatedObject(e);if(!t)return;this.nodesToOptimize[t.id]=t;const i=this;_e(e,function(r,n){const a=r&&r.getGeometries();if(!a)return;if(!(t instanceof y)){if(!n)return;const e=new y;e.forceBoundingElements(!0,{sphere:t.bSphere,box:t.bBox}),t.addChild(e),e._setGAS(N.DefaultGASs.transition),e._bodyDim=t._bodyDim,t=e}const o=3===t._bodyDim,s={version:r.getVersion(),hasGeomDecorations:r.hasGeomDecorations()};for(let r=0;r<a.length;r++){const l=new E(a[r],s).getGeometry(i,o,t._getNoGASOnPrimitives()),d=l.geometry,c=l.primitiveIDs;if(!d)continue;for(let e=0;e<t._occurrences.length;e++){const i=t._occurrences[e].renderable;if(i.addGeometry(d,!1),l.is2Din3D&&(i.fromLoadedModel=!1),t.bSphere){const e=i.geometry;e.boundingSphere||(e.boundingSphere=new m.Sphere,e.boundingBox=new m.Box3),e.boundingSphere.copy(t.bSphere),e.boundingBox.copy(t.bBox)}}const h=d.drawingGroups;for(let i=0;i<h.length;i++)for(let r=0;r<h[i].getPrimitivesCount();r++){const a=new O.SGPrimitiveHelper;a.set(h[i],r),e.addCreatedObjectWithID(n?new pe(a,t):a,c[i][r])}}},function(r){const n=r&&r.getGeometries();if(!n)return;for(let r=0;r<n.length;r++){const a=new M(n[r],J).getInfiniteGeometry(i,t),o=a.geometry,s=a.primitiveIDs;for(let t=0;t<o.length;t++)e.addCreatedObjectWithID(o[t],s[t])}})},Se.prototype.ModifyBody=function(e){const t=this.getOperatedObject(e);if(!t)return;const i=this;_e(e,function(e){if(!(t instanceof y))return;const i=e&&e.getGeometries();if(!i)return;const r={version:e.getVersion()};for(let e=0;e<i.length;e++){const n=new E(i[e],r);n.updateGeometry(t)}},function(e){const r=e&&e.getGeometries();if(!r)return;for(let e=0;e<r.length;e++)new M(r[e],J).updateInfiniteGeometry(i,t)})},Se.prototype.addExistingCells=function(e,t,i,r,n){if(!r)return!1;if(r instanceof O.SGRep){for(var a=0;a<n.length;a++)if(n[a]instanceof O.SGPrimitiveHelper){var o=n[a]._getSGPrimitive(),s=n[a].index;n[a].container._primitives[s].rep=r,r._primitives.push(o)}if(i)return!0;if(e===t)return!0;r=me(e)}else if(r instanceof O.SGBag){for(a=0;a<n.length;a++){if(n[a]instanceof v&&!i)return console.warn("Primitives can't come from a non batched body"),!1;n[a]instanceof O.SGRep&&(n[a].parents.push(r),r.children.push(n[a]))}if(i)return!0;if(e===t)return!0;var l=ve(e),d=ve(t);for(a=0;a<n.length;a++){null!=(c=this.findAssociatedInfiniteNode3D(d,n[a].modelIdentification.getLocalId()))&&l.addChild(c)}return!0}if(!r.getNodeType||"Mesh3D"!==r.getNodeType()){for(a=0;a<n.length;a++)if(n[a])if(n[a]instanceof v)r.addChild(n[a]);else{var c;d=ve(t);(c=this.findAssociatedInfiniteNode3D(d,n[a].getIdentificationObject().getLocalId()))&&r.addChild(c)}return!1}return this.addPrimitivesToMesh3D(n,r,e)},Se.prototype.addPrimitivesToMesh3D=function(e,t,i){for(var r=[],n=0;n<e.length;n++)e[n]instanceof O.SGPrimitiveHelper&&r.push(e[n]);if(!r.length)return!1;var a={},o=[];for(n=0;n<r.length;n++){var s=r[n].getGroup(),l=s.geometry;if(l){var d=a[l.id];if(d)d.hasFace=d.hasFace||4===s.glType;else{var c={geometry:l,hasFace:4===s.glType};o.push(c),a[l.id]=c}}}this.nodesToOptimize[t.id]=t;for(var h=t._occurrences[0].renderable,u=[],g=0;g<o.length;g++){var p=!0,f=o[g].geometry;for(n=0;n<h.geometry.length;n++)if(f===h.geometry[n]){p=!1;break}p&&u.push(o[g])}var m=3===t._bodyDim;for(n=0;n<u.length;n++)u[n].hasFace&&fe(u[n].geometry,m);if(u.length)for(var v=0;v<t._occurrences.length;v++){(h=t._occurrences[v].renderable).initLayers(1);for(g=0;g<u.length;g++)h.addGeometry(u[g].geometry,!!i),h._initLayersForGeometry(0,u[g].geometry);i&&(t.bSphere.copy(h.geometry.boundingSphere),t.bBox.copy(h.geometry.boundingBox))}return!0},Se.prototype.addExistingCell=function(e,t){if(!e)return!1;if(!t)return!1;if(e instanceof v&&t instanceof v)return e.addChild(t),!1;if(!(e instanceof y&&t instanceof O.SGPrimitiveHelper))return!1;var i=t.getGroup().geometry;if(!i)return!1;this.nodesToOptimize[e.id]=e;for(var r=e._occurrences[0].renderable,n=!0,a=0;a<r.geometry.length;a++)if(i===r.geometry[a]){n=!1;break}if(t.getGroup()&&4===t.getGroup().glType){var o=3===e._bodyDim;fe(i,o)}if(n)for(var s=0;s<e._occurrences.length;s++)(r=e._occurrences[s].renderable).initLayers(1),r.addGeometry(i),r._initLayersForGeometry(0,i);return!0},Se.prototype.removeExistingCells=function(e,t){if(!e)return!1;if("Mesh3D"!==e.getNodeType()){for(var i=0;i<t.length;i++)t[i]&&t[i]instanceof v&&e.removeChild(t[i]);return!1}var r=[];for(i=0;i<t.length;i++)t[i]instanceof O.SGPrimitiveHelper&&r.push(t[i]);if(!r.length)return!1;this.nodesToOptimize[e.id]=e;for(var n=0;n<e._occurrences.length;n++){var a=e._occurrences[n].renderable;a.initLayers(1),a.layer.addPrimitivesToLayers(r,0);for(var o=0;o<r.length;o++)a.removeSelectionGroup(r[o])}return!0},Se.prototype.removeExistingCell=function(e,t){if(!e)return!1;if(!t)return!1;if(e instanceof v&&t instanceof v)return e.removeChild(t),!1;if(!(e instanceof y&&t instanceof O.SGPrimitiveHelper))return!1;this.nodesToOptimize[e.id]=e;for(var i=0;i<e._occurrences.length;i++){var r=e._occurrences[i].renderable;r.initLayers(1),r.layer.addPrimitivesToLayers([t],0),r.removeSelectionGroup(t)}return!0},Se.prototype.nodeFromFixedSizeData=function(e,t=null){const i=this.viewManager.viewer.currentViewpoint.getMMInSupportUnit(),r=.5*(e.getMinSize()+e.getMaxSize())*i,n=e.getInvariantPoint();return t?(t.setRatio&&t.setRatio(r),t.setInvariantPoint&&t.setInvariantPoint(n)):t=new S({ratio:r,invariantPoint:n}),t},Se.prototype.nodeFromBillboardData=function(e,t=null){const i=e.getType(),r=i===e.BillboardTypes.Cylindrical?"Cylindrical":(e.BillboardTypes.Spherical,"Spherical");return t?t.setBillboardType&&t.setBillboardType(r):t=new _({type:r,constraintAxis:new m.Vector3(0,1,0)}),t},Se.prototype.createNodeFromData2Dto3D=function(e){if(e.getStaticMode()){var t=e.getAttachPoint(),i=e.getSphericalMode(),r=new _({type:i?"Spherical":"cylindrical"});if(void 0!==t){var n=(new m.Matrix4).setPosition(t);r.applyMatrix(n)}return r}return new v},Se.prototype.apply2DTo3DData=function(e,t){var i=t.getAdvancedPriority(),r=t.getZDepthMode();i&&e.setAdvancedPriority(i),r&&e.setZDepthMode(r)},Se.prototype.setFilters=function(e,t){if(t){this.removeAllFilters(e);for(var a=0;a<t.length;a++){var f=t[a];if(f instanceof r){var y=f.getClippingPlane(),S=y.getFlags(),_=y.getSectionning(),w=y.getPoint(),I=y.getNormal();this.addClippingPlaneFilter(e,w,I,S,_)}else if(f instanceof i){var T=f.getRepViewMode();this.addViewModeFilter(e,T)}else if(f instanceof n)this.annotationFilters.push({filter:f,node:e});else if(f instanceof o){var D=f.getRadius(),C=f._origin,P=f.getDirectionX(),E=f.getDirectionY(),M=f.getCenter(),b=f.getBoundariesVisible(),V=f.getGas();this.addScissorFilter(e,D,M,C,P,E,b,V)}else if(f instanceof s){f.getLayers();var O=f.getMode();e.setLayerFilter(f._layers,O)}else if(f instanceof l){var N=new F,G=(f.getColorInheritance()&m.GASEnum.COLOR_INHERITANCE_ON)>0||!((f.getColorInheritance()&m.GASEnum.COLOR_INHERITANCE_OFF)>0)&&null,R=(f.getAsmInheritance()&m.GASEnum.ASMCOLOR_INHERITANCE_ON)>0||!((f.getColorInheritance()&m.GASEnum.COLOR_INHERITANCE_OFF)>0)&&null,x=f.getGas(),H=null;if(x){var B=new v;new A(x,this.clientManager).applyGP(this,B),(H=B._gas)._inheritanceInternal=0}e.setVisuFilters({gasInheritFilter:N.usingColorInherit(H,G).usingASMColorInherit(H,R)})}else if(f instanceof d){var k=1,W=1;switch(O=f.getPolygonOffsetMode()){case le:[k,W]=he;break;case de:[k,W]=ue;break;case ce:[k,W]=ge;break;default:continue}e.setVisuFilters({polygonOffsetFilter:new L(W,k)})}else f instanceof c?this.addPolygonalScissorFilter(e,f):f instanceof h?this.addCurveClippingFilter(e,f):f instanceof u?e.setVisuFilters({zModeFilter:new U(!!f.getZMode())}):f instanceof g?f._skipDrawFurtive?e.setVisuFilters({furtiveFilter:!0}):e.setVisuFilters({furtiveFilter:null}):f instanceof p&&this.contextFilters.push({filter:f,node:e})}}},Se.prototype.removeAllFilters=function(e){e.setVisuFilters({gasInheritFilter:null,polygonOffsetFilter:null,zModeFilter:null,furtiveFilter:null}),this.viewManager.viewer._getCSIOverrideManager().deleteViewModeFilterOverride(e),e.setClippingCylinder(null),e.setScissoringPolyLine(null),this.viewManager.viewer._setOutlineNode(e,!1,null),e.setClippingProfile(null);for(var t=0;t<e.children.length;t++){var i=e.children[t];if("__ScissorBoundary__"===i.name){e.removeChild(i);break}}var r=e.getOverrideSetManager();if(r){var n=r.getSceneGraphOverrideSetsByPrefix("__3DSyncFilters__");for(t=0;t<n.length;t++)r.removeSceneGraphOverrideSet(n[t])}},Se.prototype.setAnnotationFilters=function(){if(0!==this.annotationFilters.length)for(var e=0;e<this.annotationFilters.length;e++){var t=this.annotationFilters[e].filter,i=this.annotationFilters[e].node,r=t.getMode(),a=t.getAnnotationPaths();if(a)if(a.length>0)for(var o=0;o<a.length;o++){var s=a[o].getPaths(),l=a[o].getValue(),d=this.truncatePaths(s,i);this.addAnnotationFilter(i,d,l,e,r)}else r!==n.Mode.ModeInvertInvisibilityAndNoPick&&r!==n.Mode.ModeInvertNoPick||this.addAnnotationFilter(i,[],null,e,r)}},Se.prototype.truncatePath=function(e,t){var i=!1,r=[t];if(void 0!==e&&(e.externalPath.forEach(function(e){i&&r.push(e),e===t&&(i=!0)}),1!==r.length))return e.externalPath=r,e},Se.prototype.truncatePaths=function(e,t){var i=[];return e.forEach(e=>{var r=this.truncatePath(e,t);void 0!==r?i.push(r):console.warn("[Annotation] A path is not valid")}),i},Se.prototype._createOverride=function(e,t,i,r){var a=e.createOverrideSetManager();if(a){var o=null;o=t?"__3DSyncFilters__annot"+i:"__3DSyncFilters__";var s=a.getSceneGraphOverrideSetByName(o);if(!s){var l=null;r&&(r===n.Mode.ModeNormal?l=B.normal:r===n.Mode.ModeForceShow?l=B.forceShow:r===n.Mode.ModeInvertInvisibilityAndNoPick?l=B.invert:r===n.Mode.ModeInvertNoPick&&(l=B.invertPick)),s=a.createSceneGraphOverrideSet({name:o,mode:l,asmInherit:!1,materialModeSensitive:!0,noOpacityOnLines:!0}),a.pushSceneGraphOverrideSet(s)}return t?s.createOverride({pathes:t,depthPriority:!0}):s.createOverride({pathes:[new T([e])],depthPriority:!0})}},Se.prototype.addAnnotationFilter=function(e,t,i,r,o){var s=this._createOverride(e,t,r,o);if(i){if(i.isRGBOverloaded()){var l=i.GetRGBA(),d=I(i.getRGBInheritance()),c=(new m.Color).setRGB(l.R/255,l.G/255,l.B/255);s.setColorAttribute({value:c,inheritance:d})}if(i.isAlphaOverloaded()){l=i.GetRGBA(),d=I(i.getAlphaInheritance());s.setOpacityAttribute({value:l.A/255,inheritance:d})}if(i.isInvisibilityOverloaded()){var h=!i.isInvisible();s.setVisibility(h)}else o!==n.Mode.ModeForceShow&&o!==n.Mode.ModeInvertInvisibilityAndNoPick||s.setVisibility(!0);if(i.isNoPickOverloaded()){var u=!i.isNotPickable();s.setPickability(u?"PICKABLE":"IGNORED")}if(i.isUncutOverloaded()){i.isUncutEnabled(),d=i.getUncutInheritance()===a.InheritanceMode.ModeForceInherit;var g=new G;s.setClippingContext(g)}if(i.isViewModeOverloaded()){d=I(i.getViewModeInheritance());var p=new R({combineRenderMode:"REPLACE",faceMode:null});p.setRenderMode("Face",i.isViewMeshEnabled()),p.setRenderMode("@Edge",i.isViewEdgeEnabled()),p.setRenderMode("WireEdge",!i.isViewWithoutWiresEnabled()),p.setRenderMode("AxisSystem",!i.isViewWithoutAxisEnabled());var f=!i.isViewWithoutPointsEnabled();p.setRenderMode("BoundaryPoint",f),p.setRenderMode("SharpPoint",f),p.setRenderMode("SmoothPoint",f),p.setRenderMode("Outline",!i.isViewWithoutOutlineEnabled()),s.setRenderStyleAttribute({value:p,inheritance:d})}if(i.isMaterialOverloaded()&&i.getMaterial()){var v=i.getMaterial(),y=v.getMaterialJSON()._json,S=v.getMaterialBuffers(),_=(d=I(i.getMaterialInheritance()),new D),w=[];Array.isArray(S)&&S.length>0&&S.forEach(function(e){w.push({buffer:e.getData()})}),_.load({json:y,zipped:!1,chunks:w,doneCallback:e=>{var t=e.materialApplications[0];s.setMaterialAttribute({value:t,inheritance:d})}})}}function I(e){var t=[z.InheritMode.INHERIT,z.InheritMode.FORCE_INHERIT,z.InheritMode.GRAPH_SCENE];return t[e]||t[0]}},Se.prototype.addViewModeFilter=function(e,t){var i=this.viewManager.viewer._getCSIOverrideManager();if(t){var r=i.getViewModeFilterOverride(e),n=new R({combineRenderMode:"REPLACE",faceMode:null});n.setFaceMode("COLOR"),n.setMaterialMode(t&Q),n.setRenderMode("Face",t&Z),n.setRenderMode("Outline",t&$),t&ee&&(n.setRenderMode("Face",!0),n.setRenderMode("Outline",!0),n.setFaceMode("BACKGROUND")),n.setRenderMode("@Edge",t&q),n.setRenderMode("InternalSmoothEdge",!(t&re)),n.setRenderMode("WireEdge",!(t&ae));var a=!(t&ne);n.setRenderMode("BoundaryPoint",a),n.setRenderMode("SharpPoint",a),n.setRenderMode("SmoothPoint",a),n.setRenderMode("FreePoint",!(t&se));var o=t&ie;n.setHalfVisibleSmoothEdges(o?1:0);var s=t&te;n.setHiddenEdges(s?1:0);var l=!(t&oe);n.setRenderMode("AxisSystem",l),n.setRenderMode("InfiniteFace",l),r.setRenderStyle(n,!0)}else i.deleteViewModeFilterOverride(e)},Se.prototype.addClippingPlaneFilter=function(e,t,i,r,n){for(var a=this._createOverride(e),o=[],s=0;s<t.length/3;s++){var l=new m.Plane;l.setFromNormalAndCoplanarPoint(new m.Vector3(i[3*s],i[3*s+1],i[3*s+2]),new m.Vector3(t[3*s],t[3*s+1],t[3*s+2])),o.push(l)}var d=new G;d.setPlanes(o),d._setUseLocalCoordinates();for(s=0;s<o.length;s++)d.setPlaneParams(o[s],{capping:!!(r[s]&we.fCapping),sectionLines:!!n[s]});a.setClippingContext(d)},Se.prototype.addScissorFilter=function(e,t,i,r,n,a,o,s){var l=new m.Vector3(r.x,r.y,r.z);if(i&&(l.x+=i.x*n.x+i.y*a.x,l.y+=i.x*n.y+i.y*a.y,l.z+=i.x*n.z+i.y*a.z),e.setClippingCylinder({center:l,axisU:new m.Vector3(t*n.x,t*n.y,t*n.z),axisV:new m.Vector3(t*a.x,t*a.y,t*a.z),clipOutside:!0}),o){var d=I.createCircleNode({radius:t,segments:32,fill:!1});d.name="__ScissorBoundary__";var c=new m.Vector3(n.x,n.y,n.z),h=new m.Vector3(a.x,a.y,a.z);c.normalize(),h.normalize();var u=new m.Vector3;u.crossVectors(c,h);var g=(new m.Matrix4).makeBasis(c,h,u);g.setPosition(l),d.setMatrix(g),e.addChild(d),new A(s,this.clientManager).applyGP(this,d),d.setGAS(new N.IncrementalGraphicAttributeSet({inheritance:m.GASEnum.RGBA_INHERITANCE_ON|m.GASEnum.LINEWIDTH_INHERIT|m.GASEnum.LINETYPE_INHERIT}))}},Se.prototype.addPolygonalScissorFilter=function(e,t){var i,r=[],n=[],a=t.getNbVertex(),o=t.getVertices();for(i=0;i<a.length;i++)r.push(a[i]);for(i=0;i<o.length;i++)n.push(o[i]);e.setScissoringPolyLine({nbPolygon:t.getNbPolygon(),nbVertices:r,vertices:n,point:new m.Vector3(t.getPoint().x,t.getPoint().y,t.getPoint().z),dirX:new m.Vector3(t.getDirectionX().x,t.getDirectionX().y,t.getDirectionX().z),dirY:new m.Vector3(t.getDirectionY().x,t.getDirectionY().y,t.getDirectionY().z)});var s=null;if(t.getBoundariesVisible()){var l,d,c,h=t.getGas(),u=[],g=0,p=e.clippingContext._scissor.polyLines[0].points3D;for(l=0;l<t.getNbPolygon();l++){for(c=g,d=0;d<r[l]-1;d++)u.push(p[g]),u.push(p[g+1]),g++;u.push(p[g]),u.push(p[c])}var f=(s=I.createLineNode({points:u})).createOverrideSetManager(),v=f.createSceneGraphOverrideSet();f.pushSceneGraphOverrideSet(v);var y=v.createOverride(new T([s])),S=new G([]);S.setUncut(!0),y.setClippingContext(S),s.setNoZ(!0),s.name="outlineNode",new A(h,this.clientManager).applyGP(this,s),s.setGAS(new N.IncrementalGraphicAttributeSet({inheritance:m.GASEnum.RGBA_INHERITANCE_ON|m.GASEnum.LINEWIDTH_INHERIT|m.GASEnum.LINETYPE_INHERIT}))}this.viewManager.viewer._setOutlineNode(e,t.getBoundariesVisible(),s)},Se.prototype.addCurveClippingFilter=function(e,t){e.setClippingProfile({csiParams:{curveCount:t.getCurveCount(),vertexCounts:t.getVertexCounts(),vertices:t.getVertices(),normals:t.getNormals(),transform:t.getTransformFromVertices()}})},Se.prototype.setContextFilters=function(){var e,t,i;for(e=0;e<this.contextFilters.length;e++){i=this.contextFilters[e].node;var r,n,a=(t=this.contextFilters[e].filter).getNegativeVisibilityMode(),o=t.getPaths();for(r=0;r<o.length;r++)n=o[r],this.applyContextFilterPath(i,n,a)}},Se.prototype.applyContextFilterPath=function(e,t,i){var r=t.getPaths(),a=this.truncatePaths(r,e),o=i?n.Mode.ModeInvertInvisibilityAndNoPick:n.Mode.ModeNormal,s=this._createOverride(e,a,void 0,o);if(t._overloadColor){var l=t.getRGBA(),d=(new m.Color).setRGB(l.R/255,l.G/255,l.B/255);s.setColor(d,!1)}if(t._overloadTransparency){l=t.getRGBA();s.setOpacity(l.A/255,!1)}if(t.isLowIntensified()){var c=this.viewManager.viewer.getRenderer();d=N.getLowLightColor(c);s.setColor(d),function(e,t){Ie||(Ie=new WeakMap);var i=Ie.get(e);i||(i=[],Ie.set(e,i));i.push(t)}(c,s)}if((t.isInvisible()||i)&&s.setVisibility(!t.isInvisible()),t.isNotPickable()&&s.setPickability("IGNORED"),t.isViewMeshOverloaded()||t.isViewEdgeOverloaded()||t.isViewLineOverloaded()||t.isViewAxisOverloaded()||t.isViewPointOverloaded()){var h,u=new W;t.isViewMeshOverloaded()&&u.setRenderMode("Face",!0),t.isViewEdgeOverloaded()&&(u.setRenderMode("InternalSharpEdge",!0),u.setRenderMode("InternalSmoothEdge",!0),u.setRenderMode("Edge",!0),u.setRenderMode("BoundaryEdge",!0)),t.isViewLineOverloaded()&&u.setRenderMode("WireEdge",!0),t.isViewAxisOverloaded()&&u.setRenderMode("AxisSystem",!0),t.isViewPointOverloaded()&&(u.setRenderMode("SharpPoint",!0),u.setRenderMode("SurfacicPoint",!0),u.setRenderMode("SmoothPoint",!0),u.setRenderMode("BoundaryPoint",!0),u.setRenderMode("FreePoint",!0));var g=new R;g.setReplaceMask(u.getMask()),t.isViewMeshOverloaded()&&(h=t.getViewMesh(),g.setRenderMode("Face",h)),t.isViewEdgeOverloaded()&&(h=t.getViewEdge(),g.setRenderMode("InternalSharpEdge",h),g.setRenderMode("InternalSmoothEdge",h),g.setRenderMode("Edge",h),g.setRenderMode("BoundaryEdge",h)),t.isViewLineOverloaded()&&(h=t.getViewLine(),g.setRenderMode("WireEdge",h)),t.isViewAxisOverloaded()&&(h=t.getViewAxis(),g.setRenderMode("AxisSystem",h)),t.isViewPointOverloaded()&&(h=t.getViewPoint(),g.setRenderMode("SharpPoint",h),g.setRenderMode("SurfacicPoint",h),g.setRenderMode("SmoothPoint",h),g.setRenderMode("BoundaryPoint",h),g.setRenderMode("FreePoint",h)),s.setRenderStyle(g,!0)}};var we={fCapping:1,fHiddenElements:4,fPriority:8,fNonZParticipants:16,fFurtive:32,fUncutting:64,fDefault:0},Ie=null;return k.subscribe({event:"/VISU/AFTER_GRAPHIC_ATTRIBUTE_SET/AFTER_COLOR_MAP_UPDATE"},e=>{var t=e.viewer.getRenderer(),i=Ie?Ie.get(t):null;if(i){var r,n=N.getLowLightColor(t);for(r=0;r<i.length;r++)i.setColor(n,!1)}}),Se}),define("DS/WebVisuParameters/WebVisuSceneGraphUpdater",["DS/CSIViewModelWebInterfaces/CSIVMClientDelegateInterface","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey","DS/WebVisuParameters/WebVisuUpdateTransaction","DS/WebVisuParameters/WebVisuUpdateTransactionHighlight","DS/Visualization/ViewManager","DS/Mesh/MeshUtils","DS/Visualization/Node3D","DS/Visualization/Mesh3D","DS/Visualization/PathElement","DS/Visualization/SubElement","DS/Visualization/CGRNode","DS/WebVisuParameters/HighlightTransactionUtils/HighlightTransactionHSO","DS/WebVisuParameters/HighlightTransactionUtils/HighlightTransactionPSO"],function(e,t,i,r,n,a,o,s,l,d,c,h,u){"use strict";var g=function(e){this.viewManager=new n(e)};return(g.prototype=Object.create(e.prototype)).createTransaction=function(e){if(e.getViewType()!=t.prototype.ViewType.View3D)return console.warn("Unsupported view type"),new i(this.viewManager,e,this.getManager&&this.getManager());switch(e.getView3DType()){case t.prototype.View3DType.View3D_Highlight:return new r(this.viewManager,e,this.getManager&&this.getManager(),!1,h);case t.prototype.View3DType.View3D_MultiColorHighlight:return new r(this.viewManager,e,this.getManager&&this.getManager(),!0,h);case t.prototype.View3DType.View3D_PreHighlight:return new r(this.viewManager,e,this.getManager&&this.getManager(),!1,u);default:return new i(this.viewManager,e,this.getManager&&this.getManager())}},g.prototype.createPathElement=function(e){if(!e||!e.length)return null;var t=e[0];if(!(t instanceof o))return null;var i=t,r=!1,n=i instanceof THREEDS.Nodes.CGRNode,c=n?i:void 0;if(i.parents.length>1){for(var h=0;h<i.parents.length;h++)if(!i.parents[h].notAllowedInPathElement)return null;r=!0}var u,g=[i],p=[];if(!r)for(var f=i.parents[0];f&&!(i=f).notAllowedInPathElement;){if(g.unshift(i),i.parents.length>1){for(h=0;h<i.parents.length;h++)if(!i.parents[h].notAllowedInPathElement)return null;break}f=i.parents[0]}var m=null;for(u=1;u<e.length&&((i=e[u])instanceof THREEDS.Nodes.CGRNode&&(n=!0,c=i),i instanceof o);u++)g.push(i),i instanceof s&&(m=i._occurrences[0].renderable);for(var v=u;v<e.length;v++){var y=e[v];if(y instanceof a.SGPrimitiveHelper){var S=y;if(m){var _=m.getSelectionGroup(y);_&&(S=_)}p.push(d.getFromSGNode(S))}else n&&(y instanceof a.SGBag||y instanceof a.SGRep)&&p.push(d.getFromSGNode(y))}if(n&&p.length>0){var w=p[p.length-1].sgNode,I=!1;if(w instanceof a.SGRep&&(I=!0),w instanceof a.SGBag){var T=w.children;1===T.length&&T[0]instanceof a.SGRep&&(w=T[0],I=!0)}if(I){var D=function e(t,i){var r,n=t.persistentId;if(n&&n===i&&(r=[t]),!r)for(var a=t.children,o=0;o<a.length;o++){var s=e(a[o],i);if(s){(r=s).unshift(t);break}}return r}(c.children[1]instanceof o?c.children[1]:c.children[0],w.modelIdentification.getLocalId());D&&(g=g.concat(D))}}var C=new l;return C.setFromArray(g,p),C},g.prototype.createIdentifiedObjectsArray=function(e){if(!e)return null;for(var t=[],i=0;i<e.externalPath.length;i++){var r=e.externalPath[i];r&&r.getIdentificationObject()&&t.push(r)}for(i=0;i<e.internalPath.length;i++){var n=e.internalPath[i];n&&n.sgNode&&n.sgNode.getIdentificationObject()&&t.push(n.sgNode)}return t},g});