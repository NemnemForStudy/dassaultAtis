define("DS/DELWebPPROpen/ProcessContextHelper",[],function(){"use strict";const e={getMfgContext:function(t,n,o){var r={context:[],ids:[]},i={},s=e.getProcessContext(t,n);if(s&&s.context)for(let e of s.context)if(e.scope===o&&e.implementedScope){r.context=e.implementedScope,e.implementedScope.forEach(e=>{i[e.id]||(i[e.id]=!0,r.ids.push(e.id))});break}return r},getMfgInstallOccurrences:function(t,n,o,r){var i={context:[],ids:[]},s=e.getMfgContext(t,n,o);if(s)for(let e of s.context)r===e.id&&e.context&&(i.context=e.context,i.ids=i.ids.concat(e.context.map(e=>`${e.parent}_${e.instance}_${r}`)));return i},getProcessContext:function(t,n){var o={context:[],ids:[]},r=e.getContextScope(t,n);return r&&(o.context=r,o.ids=r.map(e=>e.scope)),o},getProcessContextOccurrences:function(t,n,o){var r={context:[],ids:[]},i=e.getProcessContext(t,n);if(i&&i.context)for(let e of i.context)if(e.scope===o){r.context=i.context,r.ids=e.contextOccurrence.slice();break}return r},getContextScope:function(e,t){var n,o;return e&&UWA.is(e.member,"array")&&t&&e.member.forEach(e=>{(o=e.find(function(e){return e.refid===t}))&&(n=o.contextScope)}),n},getAllPhysicalIds:function(t,n){var o=n?[n]:[],r=e.getContextScope(t,n);return r&&r.forEach(e=>{o.push(e.scope),e.contextOccurrence&&e.contextOccurrence.forEach(e=>{o=o.concat(e.split("_"))}),e.implementedScope&&e.implementedScope.forEach(e=>{o.push(e.id),e.context&&e.context.forEach(e=>{o.push(e.parent),o.push(e.instance)})})}),o}};return e}),define("DS/DELWebPPROpen/ProcessModel",["DS/Logger/Logger","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DELWebComponentManager/DELWebComponentManager","text!DS/DELWebPPROpen/assets/json/WebServices.json"],function(e,t,n,o,r){"use strict";return function(){var i,s,c=e.getLogger("ProcessModel"),l=JSON.parse(r),a=new t,u={};const d={init:function(e){var t=o.getComponent("Utils"),n=l.getContextScope,r=n.payload;return i=e.process,r&&(r.refid=e.process.id),t.executeRequestPromise(`${t.get3DSpaceUrl()}${n.url}`,{method:n.method,payload:r}).then(function(e){s=e})},fetchAttributes:function(e,t,n){return o.getComponent("Utils").getAttributeForIds(e,t,n).then(function(e){u=e})},getAttributeValue:function(e,t){return u&&u[e]?u[e][t]:{}},getProcess:function(){return i},getContext:function(){return s},getCapableResource:function(e){var t,n,r;return(t=o.getComponent("Utils"),n=l.fetchCapableResource,r=n.payload,r.input_physical_ids.push(e),t.executeRequestPromise(`${t.get3DSpaceUrl()}${n.url}`,{method:n.method,payload:r})).then(function(t){let n,o,r=[];return t&&t.result&&(n=t.result.find(t=>t.input_object&&t.input_object.physicalid===e))&&n.outputs&&n.outputs.resourceArea_pathSR&&(r=(o=n.outputs.resourceArea_pathSR.find(t=>t.owner&&t.owner.physicalid===e)).elements),r})},getInstallPredecessors:function(e,t){var n=o.getComponent("Utils"),r=l.getMfgItemInstallDependencies,i=r.payload;return i.assemblyid=e,i.installinstids.push(t),n.executeRequestPromise(`${n.get3DSpaceUrl()}${r.url}`,{method:r.method,payload:i}).then(function(e){var n=UWA.Promise.resolve();return e&&e[t]&&e[t].predecessors&&e[t].predecessors.length>0&&(n=o.getComponent("Utils").getAttributeForIds(e[t].predecessors,["from.physicalid","to.physicalid"],[])),n}).then(function(e){var t=[];return e&&(t=Object.keys(e).map(t=>[e[t]["from.physicalid"],t,e[t]["to.physicalid"]])),t}).fail(function(e){!function(e,t){c.error(t),c.debug(e.toString())}(e,"Error occurred while fetching predecessors for mfg ")})},getModel:function(){return a},removeRootNode:function(e){let t,n=a.getRoots();n&&n.length>0&&(t=n.find(function(t){return t.options.fieldId===e}))&&a.removeRoot(t)},createRootNode:function(e,t){var o=new n({label:t?t.label:null,fieldId:e,grid:{className:"oer-form-expander"}});return d.removeRootNode(e),a.addRoot(o),o},getNode:function(e){let t,n=a.search({match:function(t){if(e&&t.nodeModel.options.fieldId===e)return!0}});return n&&n.length>0&&(t=n.find(t=>t.options.fieldId===e)),t},createFieldNode:function(e,t,o){var r,i,s={label:t?t.label:null,fieldId:e,grid:{value:void 0,fieldValue:"",typeRepresentation:"string",semantics:{}}},c=t?t.possibleValues:[];return c&&(1===c.length&&UWA.merge(s.grid,c[0]),s.grid.semantics=function(e){return e&&e.length>1?{possibleValues:e,displayStyle:"combo",allowResetToUndefinedByUIFlag:!0}:{possibleValues:e,displayStyle:"combo",disabled:!0}}(c)),d.removeFieldNode(e),i=new n(s),o&&((r=a.getRoots().find(e=>e&&e.options&&e.options.fieldId===o)).addChild(i),r.expandAll()),i},removeFieldNode:function(e){var t,n=d.getNode(e);n&&(t=n.getParent())&&t.removeChild(n)},empty:function(){i=null,s=null,a.removeRoots(),u={}},destroy:function(){a.destroy(),i=null,s=null,u={}}};return d}}),define("DS/DELWebPPROpen/ProcessFormColumns",[],function(){"use strict";return[{dataIndex:"tree",typeRepresentation:"string",alignment:"near",width:"175",minWidth:"15",alwaysVisibleFlag:!0,editableFlag:!1,getCellClassName:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("className"):""}},{dataIndex:"value",getCellTypeRepresentation:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("typeRepresentation"):"string"},getCellSemantics:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("semantics"):void 0},getCellEditableState:function(e){return!e.nodeModel||!e.nodeModel.getAttributeValue("readOnly")},allowUnsafeHTMLContent:!1,width:"250",minWidth:"10",alwaysVisibleFlag:!0,editableFlag:!0,editionPolicy:"EditionInPlace"},{dataIndex:"withFilter",width:"5",typeRepresentation:"functionIcon",hasCellValue:function(e){return e.nodeModel&&!0===e.nodeModel.getAttributeValue("withFilter")},getCellSemantics:function(e){if(e.nodeModel&&!0===e.nodeModel.getAttributeValue("withFilter"))return{icon:{iconName:"filter",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},disabled:!0}}}]}),define("DS/DELWebPPROpen/Controller",["DS/Logger/Logger","DS/PlatformAPI/PlatformAPI","DS/Controls/Button","DS/UIKIT/Mask","DS/DELWebComponentManager/DELWebComponentManager","DS/DELWebComponentManager/DELWebTypesUtil","DS/DELWebPPROpen/ProcessModel","DS/DELWebPPROpen/ProcessContextHelper","DS/DELWebPPROpen/ProcessFormColumns","DS/DELWebCommonControls/Form","text!DS/DELWebPPROpen/assets/json/ProcessFieldsConfig.json","i18n!DS/DELWebPPROpen/assets/nls/DELWebPPROpen","css!DS/DELWebPPROpen/assets/css/DELWebPPROpen.css"],function(e,t,n,o,r,i,s,c,l,a,u,d){"use strict";return function(p){const f="ProcessContext",g="ProcessContextOccurrence",m="MfgScopedItem",h="MfgInstallOccurrence",b="fieldValue",P="_",x={label:"ds6w:label",iconUrl:"type_icon_url",type:"ds6w:type",taxonomies:"taxonomies"},C={icon:"icon"},y="dsprcs:ItemSpecifications",S="dsprcs:CapableResources",O=JSON.parse(u);var v=e.getLogger("OpenController"),w=function(e,...t){v.error.apply(v,t),v.log(e)},E=function(e,t){r.getComponent("ModelEvents").publish({event:e,data:{data:t,origin:"OpenController"}})},R=function(e){var u=r.getComponent("Utils"),v=function(){o.mask(widget.body,d.get("WaitingPage.Title"))},R=function(){o.unmask(widget.body)},D=new s;u.markStart("openProcess"),v(),E("empty"),r.getComponent("Viewer").empty().then(function(){return D.init({process:e})}).then(function(){var e,o,s=D.getContext(),u=D.getProcess(),M=r.getComponent("Utils"),I=r.getComponent("LandingPage"),F=r.getComponent("Viewer"),V=r.getComponent("ModelEvents"),A={},L={},U=function(){var e,t,n=[];v(),n.push(D.getCapableResource(A.process.context).then(function(e){UWA.is(e,"array")&&e.length>0&&(A.rsc={context:e[0].physicalid,type:e[0][x.type],pprType:i.PPRTYPES.RESOURCE})}).fail(e=>{w(e,"Error occurred while fetching resources for process ",A.process.context)})),n.push((t=UWA.Promise.resolve(),A.mfg&&(e=A.mfg.contextOccurrence)&&e.length>1&&(t=D.getInstallPredecessors(A.mfg.context,e[e.length-2]).then(function(e){A.mfg.predecessors=e}).fail(e=>{w(e,"Error occurred while fetching predecessors for mfg",A.mfg.contextOccurrence)})),t)),UWA.Promise.all(n).then(function(){R(),I.hideLandingPage(),F.showViewer(),M.markEnd("openProcess","Process opened in"),E("onOpen",function(e){var t=function(e){var t,n;return e&&(n=e.contextOccurrence&&e.contextOccurrence.length>0?e.contextOccurrence[e.contextOccurrence.length-1]:e.context,Object.assign(e,{id:n,pathFilter:e.contextOccurrence?1===e.contextOccurrence.length?[]:e.contextOccurrence:[],type:D.getAttributeValue(n,x.type)}),delete e.context,delete e.contextOccurrence,t=e),t},n=t(e.process),o=t(e.mfg),r=t(e.rsc);return n[y]=o?[o]:[],n[S]=r?[r]:[],n}(A))}).fail(e=>{R(),w(e,"Error occurred while fetching resource/predecessors for mfg",A.mfg.context)}).finally(()=>{D.destroy(),o&&o.destroy()})},W=function(){I.showLandingPage(),F.hideViewer(),!0===D.getProcess().withFilter&&F.empty(),D.destroy(),o&&(T(),o.destroy()),M.markEnd("openProcess","Process Opened")},T=function(){o.removeEventListener("onClose",W)},N=new n({onClick:U}),k=new n({onClick:W}),j=function(e){N&&e&&Object.assign(N,e)},$=function(){o?j({disabled:!1}):U()},_=function(e){let n,r,i=function(e,t,n){let r;o&&(r=D.getNode(e))&&r.setAttribute(t,n)},s=function(){n&&t.unsubscribe(n),r&&V.unsubscribe(r)};n=t.subscribe("onApplyNGFilter/"+M.getSharedAppId(),function(t){let n;t.filterRootIds&&1===t.filterRootIds.length&&(s(),n=t.filterRootIds[0],A.mfg.context===n&&(A.mfg.filter=t.CVQueryV2.filter,A.mfg.withFilter=!0,A.process.filter=t.CVQueryV2.filter,i(e,"withFilter",!0),$()))}),r=V.subscribe({event:"onFilterCancel"},function(t){s(),t&&t.data&&t.data.result?(A.mfg.filter=null,A.mfg.withFilter=!1,A.process.filter=null,A.process.withFilter=!1,i(e,"withFilter",!1),U()):W()}),E("onOpenFilter",{id:A.mfg.context,type:A.mfg.type,pprType:A.mfg.pprType,withFilter:!0})},Y={identifier:"oer-process-form",formOptions:{maxVisibleRowCount:Object.keys(O).length,treeDocument:D.getModel(),columns:l},dialogOptions:{title:d.get("Dialog.Process.Title"),position:{my:"bottom",at:"center",offsetY:-100},buttons:{Open:N,Cancel:k}},frameContainer:p.container},B=function(e){return e&&O[e]?O[e].parent:null},q=function(e){var t=[];return e&&e.length>0&&(t=e.map(e=>{let t;return t=function(e){let t;return(e?e.split(P):[]).forEach(e=>{t?t+=`, ${D.getAttributeValue(e,x.label)}`:t=`${D.getAttributeValue(e,x.label)}`}),t}(e),{[b]:e,value:t,label:t,withFilter:void 0,icon:{iconPath:function(e){let t=e?e.split(P):[""];return D.getAttributeValue(t[t.length-1],x.iconUrl)}(e)}}})),t},H=function(e){var t,n,r=D.getModel(),i=[];r.prepareUpdate(),o?(t=B(e),D.getNode(t)||i.push(t),i.push(e)):((o=new a(Y)).addEventListener("onClose",W),i=function(e){var t=[],n=0;return O[e]&&(n=O[e].position,t=Object.keys(O).filter(e=>O[e].position<=n)),t.sort((e,t)=>O[e].position-O[t].position)}(e)),j({disabled:!0}),(n=i)&&n.forEach(e=>{var t=B(e);e&&(t?D.createFieldNode(e,{label:d.get(O[e].label),possibleValues:L[e]},t):D.createRootNode(e,{label:d.get(O[e].label)}))}),r.pushUpdate()},Q=function(e,t,n){t&&t.ids&&t.ids.length>0&&(L[e]=q(t.ids),1===t.ids.length?(o&&H(e),n(t.ids[0])):H(e))},G=function(e){var t,n,o=(n=[],(t=[e])&&(n=t.map(e=>e.split(P)[0])),n);o&&1===o.length&&(A.mfg={context:o[0],contextOccurrence:e.split(P),type:D.getAttributeValue(o[0],x.type),pprType:i.PPRTYPES.MBOM},!0===u.withFilter?_(h):$())},J=function(e){var t=D.getContext(),n=D.getProcess();A.mfg={context:e,type:D.getAttributeValue(e,x.type),pprType:i.PPRTYPES.MBOM},c.getMfgInstallOccurrences(t,n.id,A.process.context,e).ids.length>0?function(){var e=D.getProcess(),t=D.getContext(),n=c.getMfgInstallOccurrences(t,e.id,A.process.context,A.mfg.context);Q(h,n,G)}():!0===n.withFilter?_(m):$()},z=function(e){var t,n,o;A.process.contextOccurrence=e.split(P),A.process.context,t=D.getProcess(),n=D.getContext(),o=c.getMfgContext(n,t.id,A.process.context),Q(m,o,J)},K=function(e){var t,n,o;A.process={context:e,type:D.getAttributeValue(e,x.type),pprType:i.PPRTYPES.PROCESS,withFilter:D.getProcess().withFilter},t=D.getProcess(),n=D.getContext(),o=c.getProcessContextOccurrences(n,t.id,A.process.context),Q(g,o,z)};e={ProcessContext:K,ProcessContextOccurrence:z,MfgScopedItem:J,MfgInstallOccurrence:G},D.fetchAttributes(c.getAllPhysicalIds(s,u.id),Object.values(x),Object.values(C)).then(R).then(function(){var e=D.getProcess(),t=D.getContext(),n=c.getProcessContext(t,e.id);n&&n.ids.length>0?Q(f,n,K):(A.process={context:e.id,type:e.type,pprType:i.PPRTYPES.PROCESS,withFilter:e.withFilter},$())}),D.getModel().onNodeModelUpdate(function(t){var n,o=t.data?t.data.nodeModel:{};if(D.getModel().prepareUpdate(),o&&o.options&&o.options.fieldId){if(n=e[o.options.fieldId],o.options.grid.semantics&&o.options.grid.semantics.possibleValues){let e=o.options.grid.semantics.possibleValues.find(function(e){return o.getAttributeValue("value")===e.value});o.setAttribute(b,e[b])}n&&t.data.attributes.value&&n(o.getAttributeValue(b))}D.getModel().pushUpdate()})}).fail(function(t){R(),w(t,`Error occurred while fetching context scope for process ${e.id}`)})};return{open:function(e){if(e)switch(e.pprType){case i.PPRTYPES.PROCESS:R(e);break;default:!function(e){var n=r.getComponent("LandingPage"),o=r.getComponent("Viewer"),i=r.getComponent("ModelEvents"),s=r.getComponent("Utils");s.markStart("openItem"),E("empty"),o.empty().then(function(){n.hideLandingPage(),o.showViewer()}).then(function(){let c,l;!0===e.withFilter?(c=t.subscribe("onApplyNGFilter/"+r.getComponent("Utils").getSharedAppId(),function(n){let o;n.filterRootIds&&1===n.filterRootIds.length&&(t.unsubscribe(c),i.unsubscribe(l),o=n.filterRootIds[0],e.id===o&&(e.filter=n.CVQueryV2.filter,E("onOpen",e)))}),l=r.getComponent("ModelEvents").subscribe({event:"onFilterCancel"},function(e){t.unsubscribe(c),i.unsubscribe(l),e&&e.data&&e.data.result&&e.data.filterData?(e.data.filterData.withFilter=!1,E("onOpen",e.data.filterData)):(o.hideViewer(),n.showLandingPage())}),E("onOpenFilter",e)):(s.markEnd("openItem","Item opened in"),E("onOpen",e))})}(e)}}}}});