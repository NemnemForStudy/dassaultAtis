/*!  COPYRIGHT DASSAULT SYSTEMES 2016   */
define("DS/ENXNav/models/AdditionalRelDummyInfo",[],function(){function e(e,t){-1===e.indexOf(t)&&e.push(t)}function t(e){switch(e){case"hasDO":case"hasSync":return"NA";default:return" "}}function n(e){this.options=e,this._relationNodes=[],this._otherKeys=[]}return n.prototype={addRelationNode:function(e){this._relationNodes.push(e)},addOtherKeys:function(t){for(let n=0;n<t.length;n++)e(this._otherKeys,t[n])},applyMerger:function(n){if(this._relationNodes.length){let o=[],i=Object.keys(n.pids),s=Object.keys(n.relids);for(let t=0;t<i.length;t++){let s=Object.keys(n.pids[i[t]]);for(let t=0;t<s.length;t++)e(o,s[t])}for(let t=0;t<s.length;t++){let i=Object.keys(n.relids[s[t]]);for(let t=0;t<i.length;t++)e(o,i[t])}for(let t=0;t<this._otherKeys.length;t++)e(o,this._otherKeys[t]);let r={grid:{}};for(let e=0;e<o.length;e++){let n=o[e],i=t(n);r.grid[n]=i}for(let e=0;e<this._relationNodes.length;e++){this._relationNodes[e].updateOptions(r)}}}},n}),define("DS/ENXNav/models/Algos",[],function(){return{extractGridChanges:function(e,t){var n={grid:{}},o=!1;let i=[];for(var s=Object.keys(e.grid),r=0;r<s.length;r++){var a=s[r];i.push(a);var l=e.grid[a];l!==t.grid[a]&&(o=!0),n.grid[a]=l}return{updatedProps:i,hasChanged:o,finalResults:n}}}}),define("DS/ENXNav/commands/view/_xNavCollapseAll",[],function(){"use strict";return{execute:function(e){require(["DS/Utilities/Data"],function(t){var n=e.model,o=n.getSelectedNodes();n.prepareUpdate(),t.forEach(o,function(e){e.hasChildren()&&e.collapseAll()},10,function(){n.pushUpdate()})})}}}),define("DS/ENXNav/commands/view/xNavRightSidePanel",["DS/PADUtils/commands/RightSidePanel","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalModelEvents"],function(e,t,n){"use strict";return e.extend({getXSO:function(){return t.get().options.model.getXSO()},getID:function(e){return e.getID()},getTriptych:function(){return t.get().elements.padshell},onTriptychReady:function(e){var o=n.subscribe({event:"on2DTriptychReady"},function(i){e.call(t.get().elements.padshell),n.unsubscribe(o)})},isNodeValid:function(e){return!0!==e.isGroupingNode}})}),define("DS/ENXNav/commands/ExpandAllGroups",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/ExpandAllGroups",data:{}})}})}),define("DS/ENXNav/views/xNavGraphView",["css!DS/ENXNav/ENXNav","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/etree/syncwidget","css!egraph/views","css!etree/syncviews","css!DS/etree/overviewui.css"],function(e,t,n,o,i,s,r,a){"use strict";return n.extend(o,i,{_treegraph:null,defaultOptions:{fittingArea:{paddingLeft:15,paddingRight:0,paddingTop:0,paddingBottom:80},layout:s.LayoutMode.LAYERED,viewport:null},init:function(e){this._parent(e),this._buildSkeleton(),this.getOption("renderTo")&&!0===e.isActiveView&&this.render().inject(this.getOption("renderTo"))},getThumbnailState:function(e){return this._treegraph.getThumbnailState(e)},swapThumbnailState:function(e){this._treegraph.swapThumbnailState(e)},setGroupThumbnailState:function(e){for(var t=e.expanded?s.ThumbnailState.COLLAPSED:s.ThumbnailState.EXPANDED,n=0;n<e.nodes.length;n++){var o=e.nodes[n];this._treegraph.setThumbnailState(o,t)}},setAllThumbnailsState:function(e){this._treegraph.setAllThumbnailsState(e)},setLayout:function(e){this._treegraph.setLayout(e)},getContainer:function(){return this.elements.container},render:function(){return this},setModel:function(e){this.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this._treegraph.setSize(),this._treegraph.setModel(e),null!==e.options.viewport.graph&&this._treegraph.setViewport(e.options.viewport.graph)},unsetModel:function(){var e=this._treegraph.getModel();e&&(e.options.viewport.graph=this._treegraph.getViewport()),this.options.isActiveView=!1,this._treegraph.setModel(null),this.getOption("renderTo").removeChild(this.elements.container)},setSize:function(){this._treegraph.setSize()},reframeOn:function(){this._treegraph.reframeOn()},reframeAll:function(){this._treegraph.reframeAll()},toggleOverview:function(){this._treegraph.swapOverviewVisibility()},toggleLayout:function(e){switch(e){case"LayoutRight":this._treegraph.setRootPosition(s.OrientationMode.ROOT_ON_LEFT);break;case"LayoutDown":this._treegraph.setRootPosition(s.OrientationMode.ROOT_ON_TOP);break;case"LayoutLeft":this._treegraph.setRootPosition(s.OrientationMode.ROOT_ON_RIGHT);break;case"LayoutUp":this._treegraph.setRootPosition(s.OrientationMode.ROOT_ON_BOTTOM);break;default:this._treegraph.swapLayoutOrientation()}},toggleActionBar:function(e){this.options.fittingArea.paddingBottom=e?80:10,this._treegraph.setFittingArea(this.options.fittingArea)},_buildSkeleton:function(){t.is(this.elements.container)||(this.elements.container=UWA.createElement("div",{class:"xnav_graph"}),this._treegraph=new s.SyncEGraphTree(this.elements.container,this.options),this._treegraph.createOverview(),this._treegraph.setAutogroups&&this._treegraph.setAutogroups(!0),this._treegraph.setFittingArea(this.options.fittingArea),UWA.is(this._treegraph.setHTML5DnD,"function")&&(this._treegraph.setHTML5DnD(!0),this._treegraph.setMultiSelectionDrag(!0)))},updateView:function(){this._treegraph.updateUnlock()}})}),define("DS/ENXNav/mixins/_xNavBIFilter",["i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json","UWA/Class","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSession","DS/PADUtils/views/PADAlert","DS/Utilities/Utils","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/settings/AppSettings","DS/PADUtils/Utility","DS/ENOXParser/modules/ColorMapParser","DS/ENOXParser/modules/common/Helpers","DS/PADServices/utils/Iterator","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/utilsWS/CVServletServices","DS/ENOXParser/modules/TwoDParser","DS/PADServices/utils/Batches","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/private/TreeDocUpdate","DS/PADServices/utils/PromiseHook"],function(e,t,n,o,i,s,r,a,l,d,c,u,p,h,g,f,v,m,b,_,D){"use strict";const S="rgba(255, 255, 255, 0.3)",x={colorInstance:S},y={};function C(e,t,n,o){let i=e.get(t);i?(i.nodes.push(n),e.set(t,i)):(i={nodes:[n],isByResId:o},e.set(t,i))}return s.softInit(),n.extend({_biFilter:null,_biSlave3D:!0,_id2removeFromFilterProxy:[],_filterAlreadyTreatedRoot:[],_isRootAddedFromFilter:!1,initializeBI:function(){var e=this;o.addEvent("onX3dPlatformId",function(e){this._biFilter&&this._biFilter.updateTenant(e)}.bind(this)),o.addEvent("onPad_security_ctx",function(e){this._biFilter&&this._biFilter.setDefaultSecurityContext&&this._biFilter.setDefaultSecurityContext(e)}.bind(this)),this._createProxy(),s.subscribe({event:"authoringStateModified"},function(t){if(e._biFilter&&!0===t.authored&&e.options.model.getRoots().length){var n=[],o=e.options.model.getRoots();for(let t=0;t<o.length;t++){let i=e.HasFilter(o[t].getID());i&&!0===i.hasFilter&&n.push(o[t].getID())}e._biFilter.resetNGFilterUI({widgetId:i.getWidgetId(),NGFUXId:i.getWidgetId(),appId:i.getAppId(),rootIds:n}),e.removeNGFilter(n)}else e._biFilter&&!1===t.authored&&e.options.model.getRoots().length&&e._biFilter.setTagsWithExpandSynthesis&&e._filterAlreadyTreatedRoot.length>0&&e._biFilter.setTagsWithExpandSynthesis(e._filterAlreadyTreatedRoot)})},removeRootFromFilterProxy:function(e){var t=this;this._biFilter&&(this.__doRemoveOnBI=this.__doRemoveOnBI?this.__doRemoveOnBI:a.debounce(function(){t._id2removeFromFilterProxy.length&&(t._biFilter.resetNGFilterUI({widgetId:i.getWidgetId(),NGFUXId:i.getWidgetId(),appId:i.getAppId(),rootIds:t._id2removeFromFilterProxy}),t._id2removeFromFilterProxy=[])},250),-1===t._id2removeFromFilterProxy.indexOf(e.rootId2remove)&&t._id2removeFromFilterProxy.push(e.rootId2remove),this._filterAlreadyTreatedRoot.indexOf(e.rootId2remove)>-1&&this._filterAlreadyTreatedRoot.splice(this._filterAlreadyTreatedRoot.indexOf(e.rootId2remove),1),this.__doRemoveOnBI())},addFilter:function(n){var o=this;if(!0===s.determineAuthoredFlag()){r.displayNotification({msg:e.filterInAuthoring,eventID:"warning",key:"enxNav-addFilter"});var i=g.getModelEvents();0===o.options.model.getRoots().length?o.dropInvitContainer.show("drop"):o.dropInvitContainer&&(o.dropInvitContainer.hide(),i.publish({event:"ENXViews/WelcomePanel/closeLandingPage"}))}else{if(!this._biFilter)return void(this._filterLoadQueue=n);var a=require("DS/PADServices/utils/Storage"),l=a.buildKey("ENXNav","pendingFilters");if(n.fromProxy){var d,u=a.sess.get(l);if(u&&(d=u.filter_objects),UWA.equals(d,n.filter_objects))return;var p={filter_objects:n.filter_objects};a.sess.setWithExpire(l,p,3500)}else{p={filter_objects:n.filter_objects};a.sess.setWithExpire(l,p,3500)}if(this.beginBlockingTransaction(t.retrieveFilter),n.filter_objects){var h="fromDropOnFilter"===n.behavior,f="fromDrop"===n.behavior,v=n.filter_objects.length>1,m=function(t){if(t.success.length&&(!0===(h=t.success[0].fromDropOnFilter?t.success[0].fromDropOnFilter:h)&&(n.behavior="fromDropOnFilter"),o._isRootAddedFromFilter=!0,o.add({content:"filters",rootsWithFilters:t.success,broadcast:!0!==n.fromWP&&(UWA.is(n.broadcast,"boolean")?n.broadcast:h),loadWithFilter:h,fromProxy:n.fromProxy,callback:function(i,a){if(i){for(var l=a&&a.alreadyLoadedRoots?a.alreadyLoadedRoots:[],d=!1,c=0;c<i.length;c++)if(-1===l.indexOf(i[c].rootId))if(d=!0,"fromDropOnFilter"===n.behavior){if(s.isAuthoring())o.disableFilterWaiting(),r.displayNotification({msg:e.noFilterOnAuthoring,eventID:"warning",key:"enxNav-NoFilterOnAuthoring"}),o.disableFilterWaiting();else if(!0!==n.fromProxy){var u=i[c].rootId;require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("DefineFilter");t&&(t.setOpenFilterNow(u),t.begin(),o._filterRootIds=[u],o._filterPanelOpen=!0)})}else if(!0===n.fromProxy){u=i[c].rootId;o._filterRootIds=[u],o._filterPanelOpen=!0}}else{var p=UWA.clone(i[c].filter);if(p){if(p.filterRootIds=[i[c].rootId],void 0===p.CVQuery)if(p.union)p.CVQuery={union:p.union},delete p.union;else{for(var h=0;h<p.union.expand.length;h++){var g=p.union.expand[h];g.root_path_physicalid[0][0]===i[c].rootId&&(p.sequence_filter=g.sequence_filter,p.config_filter=g.config_filter)}var f=[[i[c].rootId]];p.root_path_physicalid&&(f=p.root_path_physicalid),p.CVQuery={root_path_physicalid:f,sequence_filter:p.sequence_filter,config_filter:p.config_filter,expand_iter:"-1"},delete p.sequence_filter,delete p.config_filter}o.applyFilter(p)}else console.error("No filter pass")}!1===d&&"fromDropOnFilter"===n.behavior&&o.disableFilterWaiting(),o._isRootAddedFromFilter=!1}if(n.callback){var v=[];t.success.forEach(function(e){v.push(e.rootId)}),n.callback(v)}}})),t.failure.length){for(var i=0;i<t.failure.length;i++){var a={msg:t.failure[i].msg,eventID:t.failure[i].eventID};r.displayNotification(a)}o._commandProxy.retrieveFilterFailure(t),0===o.options.model.getRoots().length?o.dropInvitContainer.show("drop"):o.dropInvitContainer&&o.dropInvitContainer.hide(),0===t.success.length&&(("fromDropOnFilter"===n.behavior||void 0===n.behavior&&n.filter_objects.length>0)&&(o.disableFilterWaiting(),o.endBlockingTransaction()),n.callback&&n.callback(t))}f&&o.endBlockingTransaction()};if(v){var b=n.callback,_=c.createStepper(n.filter_objects,null,function(e,t){o._biFilter.retrieveFilters({filterObjects:[e],filterIds:[e.objectId],fromDropOnFilter:h,callback:function(e){n.callback=function(){b&&b.apply(null,arguments),_()},m(e)}})},function(){});_()}else this._biFilter.retrieveFilters({filterObjects:n.filter_objects,fromDropOnFilter:h,callback:m})}}},HasFilter:function(e){return this._biFilter&&UWA.is(this._biFilter.HasFilter,"function")?this._biFilter.HasFilter(e):void 0},GetFilterSpec:function(e,t){return this._biFilter&&UWA.is(this._biFilter.GetFilterSpec,"function")?this._biFilter.GetFilterSpec(e,t):void 0},RetrievePrdFromFilterId:function(e){return this._biFilter&&UWA.is(this._biFilter.RetrievePrdFromFilterId,"function")?this._biFilter.RetrievePrdFromFilterId(e):void 0},getCtxForSharing:function(){return this._biFilter&&UWA.is(this._biFilter.getCtxForSharing,"function")?this._biFilter.getCtxForSharing():void 0},onSynthesisModeOnInstance:function(e){this._biFilter&&(!0===e?this._biFilter.setSynthesisMode("flat"):this._biFilter.setSynthesisMode("occurrence"),this.getPADTreeDocument().colorizeActivated&&(this.onUnColorize(),setTimeout(function(){this.onColorize(null,!0)}.bindt(this),10)))},onApplyNGFilter:function(t){if(s.determineAuthoredFlag())t&&!t.empty&&r.displayNotification({msg:e.filterInAuthoring2,eventID:"warning",key:"EnxNav-applyNGFilterFilterInAuthoring"});else{var n=t||null;n=UWA.is(n,"string")?JSON.parse(n):n,this.applyFilter(n)}},removeNGFilter:function(e){var t=this.getPADTreeDocument();if(delete t._hideChildrenFilter,e.length){let n=e.reduce(function(e,n){return e.concat(t.getNodesById(n))},[]);t.withTransactionUpdate(function(){for(var e=0;e<n.length;e++){var o=n[e];if(o.options.filtered){delete o.options.filtered,o.options.CVQuery=null,o.options.sequence_filter=null,o.options.config_filter=null,p.node.clearBadges(o);var i=o.getState();o.setState({state:"partiallyExpanded"}),o.options.padstate="partiallyExpanded",p.node.clearChildComputed(t),"collapsed"===i?o.options.children=[]:(o.processDescendants({processNode:function(){var e=this.getState();this.setState({state:"partiallyExpanded"}),this.options.padstate="partiallyExpanded",null===this.options.children&&(this.options.children=[]),"collapsed"===e&&(this.options.children=[])}}),null===o.options.children&&(o.options.children=[]))}}})}},onSetTagsWithExpandSynthesis:function(){if(this._biFilter&&!0!==this.addInProgressFlag&&!this._wait4Filter){var e=this;this.__debounceSetTags=this.__debounceSetTags?this.__debounceSetTags:a.debounce(()=>{setTimeout(function(){let t=function(e,t){for(var n=[],o=e.length,i=0;i<o;i+=t)n.push(e.slice(i,i+t));return n}(e.options.model.getRoots(),1e3),n=c.createStepper(t,null,function(t){let o=[];for(let n=0;n<t.length;n++){let i=t[n].getID();-1===e._filterAlreadyTreatedRoot.indexOf(i)&&(e._filterAlreadyTreatedRoot.push(i),o.push(i))}if(e._biFilter.setTagsWithExpandSynthesis&&o.length>0){e._biFilter.setTagsWithExpandSynthesis(o,{"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',no_type_filter_rel:["XCADBaseDependency","Reference Document"]})}setTimeout(n,100)},function(){console.log("batches complete")});n()})},250),this.__debounceSetTags()}},onColorize:function(e,n){let i=this,s=function(){!0===i._biSlave3D&&b._colorize3D(b)};var r=!1,a=setTimeout(()=>{r=!0,this.beginBlockingTransaction(t.applyColor)},750);let d=function(){!0===r?i.endBlockingTransaction():clearTimeout(a)},g="",f={};if(e){this.getPADTreeDocument().colorizeActivated=!0;let t=new u(e);this.colorMapAll=t.data,g=this.predicateKind=t.data.predicateKind,f=this.colorMap=t.data.colorMap}else n?(f=this.colorMapAll.colorMap,g=this.colorMapAll.predicateKind):console.warn("xNavFilter:onColorize: Invalid Input");let v=[],m=[],b=this.options.model,_=o.getSetting("synthesisModeOnInstance"),D=f.predicate+"-alreadyRetrieved",w=f.predicate+"-Instance",P=f.predicate+"-Instance-alreadyRetrieved",N=[f.predicate],A=function(e){let t=e.model,n=e.colorMap,o=e.predicateKind,i=e.nodes2Update,s=e.nodes43DSlave,r=e.synthesisFlag,a=e.namePred,d=e.instPred,u=e.instRetrieved,g=(e.thisPtr,e.nodeArray),f=new Map,v=p.divideAndConquer(g,{},{notRoots:function(e){let t=!e.isRoot();return l.addBIColumn(n.predicate,!0),t},everything:function(e){return!0}});return t.withTransactionUpdate(function(){var e=[];h.iterate(v.everything,function(r){var l=r.getPLMValue(n.predicate);if(null!==l){var d=c.getBIColor(o,n,l),u={color:d,isBeingCut:!1,grid:{bi_color:d}};r.ghostMode=!1,d===S&&(e.push(r),u.isBeingCut=!0,r.ghostMode=!0),r.updateOptions(u),t.options.shouldBeSelected(r),s.push(r)}else if(!0!==r.getReferenceValue(a)){r.options.grid[a]=!0;let e=r.getID();i.push(e),C(f,e,r,!0)}else e.push(r)}),r&&h.iterate(v.notRoots,function(e){var t=e.getPLMValue(d);if(null!==t){var r={colorInstance:c.getBIColor(o,n,t)};e.ghostMode=!1,e.updateOptions(r),s.push(e)}else if(!0!==e.getReferenceValue(u)){e.options.grid[u]=!0;let t=e.getRelationID();i.push(t),C(f,t,e,!1)}});for(let t=0;t<e.length;t++)e[t].options.color===S&&e[t].options.colorInstance===S&&(e[t].ghostMode=!0,delete e[t].options.color,delete e[t].options.colorInstance,e[t].updateOptions({isBeingCut:!0}))}),f}({nodeArray:b.getAllDescendants().filter(function(e){return e.isVisible()&&!0!==e.isGroupingNode&&!0!==e.isRelationsObjectNode}),thisPtr:this,model:b,predicateKind:g,colorMap:f,nodes2Update:v,nodes43DSlave:m,synthesisFlag:_,namePred:D,instPred:w,instRetrieved:P});if(m.length&&s(),v.length){let e=[],t=b.updateNodesAttributesValue(v,N);h.iterate(t,function(t){t.then(function(t){e.push(new Promise(function(e,n){!function(e){let t=e.model,n=e.nodeIds,o=e.colorMap,i=e.predicateKind,s=(e.synthesisFlag,e.namePred,e.instPred),r=e.nodes43DSlave,a=e.finalNodeMap,l=n.map(function(e){let t=a.get(e);return t.plmValue=t.nodes[0].getPLMValue(o.predicate),t}).filter(function(e){return null!==e}),d=p.divideAndConquer(l,y,{references:function(e){return e.isByResId},instances:function(e){return!1===e.isByResId}});t.withTransactionUpdate(function(){var e=[];h.iterate(d.references,function(n){let s=n.plmValue;if(null!==s){var a=c.getBIColor(i,o,s),l={color:a,isBeingCut:!1,grid:{bi_color:a}};h.iterate(n.nodes,function(n){n.ghostMode=!1,a===S&&e.push(n),n.updateOptions(l),t.options.shouldBeSelected(n),r.push(n)})}else l={grid:{bi_color:S}},h.iterate(n.nodes,function(n){delete n.options.color,e.push(n),n.updateOptions(l),t.options.shouldBeSelected(n),r.push(n)})}),h.iterate(d.instances,function(t){h.iterate(t.nodes,function(t){let n=s?t.getReferenceValue(s):null;if(null!==n){var r=c.getBIColor(i,o,n),a={colorInstance:r};r===S&&(delete t.options.colorInstance,e.push(t)),t.updateOptions(a)}else t.updateOptions(x)})});for(let t=0;t<e.length;t++)e[t].isRoot()?e[t].options.color&&e[t].options.color!==S||(e[t].ghostMode=!0,delete e[t].options.color,e[t].updateOptions({isBeingCut:!0})):e[t].options.color&&e[t].options.color!==S||e[t].options.colorInstance&&e[t].options.colorInstance!==S||(e[t].ghostMode=!0,delete e[t].options.color,delete e[t].options.colorInstance,e[t].updateOptions({isBeingCut:!0}))})}({model:b,nodeIds:t.localIds,colorMap:f,predicateKind:g,synthesisFlag:_,namePred:D,instPred:w,nodes43DSlave:m,finalNodeMap:A}),e()}))})}),Promise.all(t).then(function(){Promise.all(e).then(function(){s(),d()})})}else d()},onUnColorize:function(){this.getPADTreeDocument().colorizeActivated=!1;var e=this;e.options.model.withTransactionUpdate(function(){var t={color:"rgba(255, 255, 255, 0.3)",colorInstance:"rgba(255, 255, 255, 0.3)",isBeingCut:!1,grid:{bi_color:"rgba(255, 255, 255, 0.3)"}};e.options.model.getAllDescendants().forEach(function(n){n.isGroupingNode||(delete n.options.color,!0===o.getSetting("synthesisModeOnInstance")&&delete n.colorInstance,n.ghostMode=!1,n.updateOptions(t),e.getPADTreeDocument().options.shouldBeSelected(n))})}),l.removeBIColumn(this.colorMap.predicate),delete this.colorMap,delete this.predicateKind,this.options.views.treelistview&&!0!==this.options.views.treelistview.getManager().isColumnHidden("bi_color")&&this.options.views.treelistview.getManager().hideColumn("bi_color"),!0===e._biSlave3D&&void 0!==e._commandProxy&&e._commandProxy.padFilterBI({filterBIUnColorize:!0})},onBroadcastColor:function(){var e=this,t=[];!0===e._biSlave3D&&UWA.is(e.colorMap)&&(e.options.model.getAllDescendants().forEach(function(n){n.isVisible()&&!0!==n.isGroupingNode&&(null!==n.getPLMValue(e.colorMap.predicate)?t.push(n):-1!==e.options.model.getRoots().indexOf(n)&&t.push(n))}),t.length&&e.colorizeSlave3D(t))},onFilterClose:function(e){if("dataFilterPanelCtn"===e.tag){var t=e||{};if(void 0===t.rootIds){t.rootIds=[];for(var n=this.options.model.getRoots(),o=0;o<n.length;o++)t.rootIds.push(n[o].getID())}this.disableFilterWaiting(t)}},onGroupingEvent:function(e){var t=this;t.options.fromGroupingEvent=!0,e.fromGroupingEvent=!0,g.publish({event:"ENXModel/Model/ApplyGrouping",data:e});var n=g.subscribe({event:"ENXModel/Model/ApplyGrouping/Done"},function(e){g.unsubscribe(n),t.options.fromGroupingEvent&&(t._biFilter.setGroupingStatus(e),delete t.options.fromGroupingEvent)})},onSelectEvent:function(n){var o=s.determineAuthoredFlag();if(o)return r.displayNotification({msg:e.taggerSelectAuth,eventID:"warning",key:"enxNav-selectFromTaggerAuth"}),void this._biFilter.setSelectStatus({status:!0});let i={eventData:n,authored:o,doNotBroacast:!0};g.publish({event:"ENXViews/Model/SelectFromTagger",data:i});var a=g.subscribe({event:"ENXViews/Model/SelectFromTagger/Failure"},function(n){if(g.unsubscribe(l),g.unsubscribe(a),n&&n.reason)switch(n.reason){case"requestFailure":r.displayNotification({title:t.select_from_tagger_errorTitle,subtitle:t.select_from_tagger_error,eventID:"error",key:"enxNav-selectFromTagger-failure"});break;case"requestTimeout":r.displayNotification({title:t.select_from_tagger_errorTitle,subtitle:t.select_from_tagger_error,eventID:"error",key:"enxNav-selectFromTagger-timeout"});break;case"tooManyResults":r.displayNotification({msg:e.replace(e.tooManyResultSelectInApp,{maxResult:d.getSetting("maxPathsForSearch")}),eventID:"warning",key:"enxNav-selectFromTaggerTooManyResults"});break;case"noResults":r.displayNotification({msg:e.tagger_select_no_result,eventID:"info"})}}),l=g.subscribe({event:"ENXViews/Model/SelectFromTagger/Success"},function(t){g.unsubscribe(l),g.unsubscribe(a),t&&t.nbSelected&&r.displayNotification({msg:e.replace(e.get("tagger_select_success"),{nbSelected:t.nbSelected}),eventID:"info"})})},_createProxy:function(){var e=this;require(["DS/ENOFilterBIUX/FilterBIComponentProxy","DS/PADServices/utils/GlobalUtils"],function(t,n){var s=!0===o.getSetting("activateGrouping")||"true"===n.getURLParameter("activateGrouping")?{}:void 0;let r;r=o.getSetting("activateWidgetLink")?i.getWidgetId():i.getSharedId();var a={tenant:i.getPlatformId(),processingMode:"appProcessing",colorize:!0,selection:{},widgetId:i.getWidgetId(),NGFUXId:r,appId:i.getAppId(),volumeFilterAvailable:0,ExpandSynthesisON:!0,appQueryParam:{},synthesis_priority:1,shareFilterSpec:!0,enableGrouping:s};UWA.is(e.onFilterFilteringEvent,"function")&&(a.events={addFilterChangeListener:e.onFilterFilteringEvent.bind(e)}),o.getSetting("activateGraph")?a.appQueryParam={graph:o.getSetting("structureGraph")}:a.appQueryParam={"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',no_type_filter_rel:["XCADBaseDependency","Reference Document"]},e._biFilter=new t(a),e._biFilter.resetNGFilterUI({widgetId:a.widgetId}),e._biFilter.addEvent("NGFilter_Close",e.onFilterClose,e),e._biFilter.addEvent("FilterBIColorize",e.onColorize,e),e._biFilter.addEvent("FilterBIUnColorize",e.onUnColorize,e),e._biFilter.addEvent("FilterBIGroupingEvent",e.onGroupingEvent,e),e._biFilter.addEvent("FilterBISelectionEvent",e.onSelectEvent,e),e.options.model.getModelEvents().subscribe({event:"onRootAdded"},e.onSetTagsWithExpandSynthesis.bind(e)),g.subscribe({event:"ENXModel/Root/AllAdded"},e.onSetTagsWithExpandSynthesis.bind(e)),e.options.model.getModelEvents().subscribe({event:"broadcastColor"},e.onBroadcastColor.bind(e));var l={expandServices:"expand",NGFUXId:i.getWidgetId(),appId:i.getAppId()};if(e._biFilter.setNGFilterOptions(l),e._biFilter.addEvent("ApplyNGFilter",e.onApplyNGFilter,e),"function"==typeof e.options.model.setFBIProxyOptions?e.options.model.setFBIProxyOptions({FBIProxy:e._biFilter}):"function"==typeof e.options.model.setFilterBIProxy?e.options.model.setFilterBIProxy(e._biFilter):e.options.model._isVolumeFilter=!0,!0===o.getSetting("synthesisModeOnInstance")?e._biFilter.setSynthesisMode("flat"):e._biFilter.setSynthesisMode("occurrence"),o.addEvent("onSynthesisModeOnInstance",e.onSynthesisModeOnInstance.bind(e)),e._filterLoadQueue){var c=e._filterLoadQueue;delete e._filterLoadQueue,e.addFilter(c)}e._biFilter.setDefaultSecurityContext&&e._biFilter.setDefaultSecurityContext(o.getSetting("pad_security_ctx")),!0===d.getSetting("splitActivation")&&e._biFilter.setHighDepthTagsAvailability(!0),null!==n.getURLParameter("redirectQueryToSGI")&&"function"==typeof e._biFilter._addURLParam&&e._biFilter._addURLParam({services:"progressive",param:"redirectQueryToSGI=true"}),g.publish({event:"ENXModel/Root/FBIProxy",data:{HasFilter:e._biFilter.HasFilter.bind(e._biFilter),getCtxForSharing:e._biFilter.getCtxForSharing.bind(e._biFilter)}})})},colorizeSlave3D:function(e){for(var t,n=this,o=[],i=[],s=[],r=function(e){var t;-1===o.indexOf(e)&&((t=n.options.model.getNodesById(e)).length?(o.push(e),s.push({color:t[0].options.color?t[0].options.color:"rgba(255, 255, 255, 0.3)",pid:e,ghostMode:t[0].ghostMode})):(t=n.options.model.getNodesByRelId(e)).length?(o.push(e),s.push({color:t[0].options.color?t[0].options.color:"rgba(255, 255, 255, 0.3)",pid:e,ghostMode:t[0].ghostMode})):console.error("Unknown node with id ["+e+"]"))},a=0;a<e.length;a++){var l=e[a];if(-1===o.indexOf(l.getID())&&(o.push(l.getID()),s.push({color:l.options.color?l.options.color:"rgba(255, 255, 255, 0.3)",pid:l.getID(),ghostMode:l.ghostMode,metaType:"reference"})),!1===l.isRoot()&&-1===o.indexOf(l.getRelationID())&&(o.push(l.getRelationID()),s.push({color:l.options.colorInstance?l.options.colorInstance:"rgba(255, 255, 255, 0.3)",pid:l.getRelationID(),ghostMode:l.ghostMode,metaType:"instance"})),"collapseState"===l._expandState||"partiallyExpandedState"===l._expandState){var d=l.getOccurencePath(l.options.resourceid);i.push(d.map(function(e){return r(e),o.indexOf(e)}))}else{var c=l.getOccurencePath(l.options.resourceid);i.push(c.map(function(e){return r(e),o.indexOf(e)}))}}t={nodes:s,path:i},void 0!==n._commandProxy&&0!==t.nodes.length&&n._commandProxy.padFilterBI({filterBIColorize:t})},_checkIfFilterAvailable:function(t,n){var o=this;return new Promise(function(i){var a=[],l={rootsWithFilter:void 0,objectsWithoutFilterDrop:t},d=UWA.clone(t);if(t.paths)for(let e=0;e<t.paths.length;e++)1===t.paths[e].length&&a.push(t.paths[e][0]);else t.rootIds&&(a=[].concat(t.rootIds));for(var c=o.options.model.getRoots(),u=[],p=0;p<c.length;p++){var h=a.indexOf(c[p].getID());-1!==h&&(a.splice(h,1),u.push(c[p].getID()))}if(u.length){r.displayNotification({msg:e.root_already_loaded});for(var g=0;g<u.length;g++){var f=u[g];if(l.objectsWithoutFilterDrop.paths)for(let e=0;e<l.objectsWithoutFilterDrop.paths.length;e++)if(1===l.objectsWithoutFilterDrop.paths[e].length&&l.objectsWithoutFilterDrop.paths[e][0]===f){l.objectsWithoutFilterDrop.paths.splice(e,1);break}l.objectsWithoutFilterDrop.rootIds&&-1!==l.objectsWithoutFilterDrop.rootIds.indexOf(f)&&l.objectsWithoutFilterDrop.rootIds.splice(l.objectsWithoutFilterDrop.rootIds.indexOf(f),1),l.objectsWithoutFilterDrop.pids&&-1!==l.objectsWithoutFilterDrop.pids.indexOf(f)&&l.objectsWithoutFilterDrop.pids.splice(l.objectsWithoutFilterDrop.pids.indexOf(f),1)}}if(a.length){var v=s.determineAuthoredFlag(),m=!1;o._biFilter.areRootsSharable(a,n).then(function(t){for(var o=0;o<t.length;++o)if(!0===t[o].hasFilter){if(!1!==v){m=!0;break}if(l.rootsWithFilter||(l.rootsWithFilter=d,l.rootsWithFilter.biProxyCtx=n,l.rootsWithFilter.filteredRoots=[]),l.rootsWithFilter.filteredRoots.push(t[o].rootId),l.objectsWithoutFilterDrop.paths)for(let e=0;e<l.objectsWithoutFilterDrop.paths.length;e++)if(1===l.objectsWithoutFilterDrop.paths[e].length&&l.objectsWithoutFilterDrop.paths[e][0]===t[o].rootId){l.objectsWithoutFilterDrop.paths.splice(e,1);break}l.objectsWithoutFilterDrop.rootIds&&-1!==l.objectsWithoutFilterDrop.rootIds.indexOf(t[o].rootId)&&l.objectsWithoutFilterDrop.rootIds.splice(l.objectsWithoutFilterDrop.rootIds.indexOf(t[o].rootId),1),l.objectsWithoutFilterDrop.pids&&-1!==l.objectsWithoutFilterDrop.pids.indexOf(t[o].rootId)&&l.objectsWithoutFilterDrop.pids.splice(l.objectsWithoutFilterDrop.pids.indexOf(t[o].rootId),1)}l.objectsWithoutFilterDrop.pids&&0===l.objectsWithoutFilterDrop.pids.length&&(l.objectsWithoutFilterDrop=void 0),v&&m&&r.displayNotification({msg:e.dropFilteredRootAuth,eventID:"warning",key:"enxNav-dropFilteredRootAuth"}),i(l)})}else l.objectsWithoutFilterDrop.pids&&0===l.objectsWithoutFilterDrop.pids.length&&(l.objectsWithoutFilterDrop=void 0),i(l)})},_addDroppedRootsWithFilter:function(n){var o=this;return new Promise(function(i){o.beginBlockingTransaction(t.retrieveFilter);var a=n.filteredRoots,l=n.biProxyCtx,d="fromDropOnFilter"===n.behavior||!0===n.loadWithFilter;(function(i){return i.reduce((i,a)=>i.then(()=>(function(i){return new Promise(function(a){var c=setTimeout(function(){r.displayNotification({msg:e.noShareFilterTimeout,eventID:"warning",key:"EnxNav-noShareFilterTimeout"});var t=UWA.clone(n);delete t.biProxyCtx,delete t.filteredRoots,t.content="idslist",t.callback=function(){console.log("Root without filter added")},o.add(t),a()}.bind(i),5e3);o._biFilter.shareFilterSpec({fromRootId:i,fromSourceCtx:l,fromDropOnFilter:d,callback:function(i){if(clearTimeout(c),i.success.length&&(o._isRootAddedFromFilter=!0,o.add({content:"filters",rootsWithFilters:i.success,broadcast:UWA.is(n.broadcast,"boolean")?n.broadcast:d,loadWithFilter:d,behavior:n.behavior,fromProxy:n.fromProxy,noNotif:!0,callback:function(i,a){if(i){for(var l=a&&a.alreadyLoadedRoots?a.alreadyLoadedRoots:[],d=!1,c=0;c<i.length;c++)if(-1===l.indexOf(i[c].rootId))if(d=!0,"fromDropOnFilter"===n.behavior)if(s.isAuthoring())o.disableFilterWaiting(),r.displayNotification({msg:e.noFilterOnAuthoring,eventID:"warning",key:"EnxNav-noFilterOnAuthoringBIFilter"}),o.disableFilterWaiting();else if(!0!==n.fromProxy){var u=i[c].rootId;require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("DefineFilter");t&&(t.setOpenFilterNow(u),t.begin(),o._filterRootIds=[u],o._filterPanelOpen=!0)})}else!0===n.fromProxy&&(u=i[c].rootId,o._filterRootIds=[u],o._filterPanelOpen=!0);else{var p=UWA.clone(i[c].filter);if(p){if(p.filterRootIds=[i[c].rootId],void 0===p.CVQuery)if(p.union)p.CVQuery={union:p.union},delete p.union;else{for(var h=0;h<p.union.expand.length;h++){var f=p.union.expand[h];f.root_path_physicalid[0][0]===i[c].rootId&&(p.sequence_filter=f.sequence_filter,p.config_filter=f.config_filter)}var v=[[i[c].rootId]];p.root_path_physicalid&&(v=p.root_path_physicalid),p.CVQuery={root_path_physicalid:v,sequence_filter:p.sequence_filter,config_filter:p.config_filter,expand_iter:"-1"},delete p.sequence_filter,delete p.config_filter}var m=g.subscribe({event:"ENXModel/SyncModel"},function(e){e&&"applyFilter"===e.what&&(m=g.unsubscribe(m),r.displayNotification({eventID:"success",msg:t.addRootWithFilterSuccessNotif}))});o.applyFilter(p)}else console.error("No filter pass")}!1===d&&"fromDropOnFilter"===n.behavior&&o.disableFilterWaiting(),o._isRootAddedFromFilter=!1}}})),i.failure.length){for(var l=0;l<i.failure.length;l++){var u={msg:i.failure[l].msg,eventID:i.failure[l].eventID};r.displayNotification(u)}0===o.options.model.getRoots().length?o.dropInvitContainer.show("drop"):o.dropInvitContainer&&o.dropInvitContainer.hide()}a()}})})})(a)),Promise.resolve())})(a).then(function(){o.endBlockingTransaction(),i()})})}})}),define("DS/ENXNav/mixins/_xNavRefresh",["UWA/Class","DS/PADUtils/PADSettingsMgt"],function(e,t){"use strict";var n=e.extend({});return!0===t.getSetting("refresh_v2")&&(n.prototype.refresh=function(e){e=void 0===e||e,require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("Uncut");t&&t.begin()}),e&&this._commandProxy.refreshModel();let t=this.getPADDGVView();t.options.shouldClearSort=!1,t&&t.removeFilterView(),this.getPADTreeDocument().refresh()}),n}),define("DS/ENXNav/commands/FocusOnGroups",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/FocusOnGroups",data:{}})}})}),define("DS/ENXNav/commands/view/_xNavSelectLeaves",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,n=t.getSelectedNodes();require(["DS/ENXNav/commands/view/_xNavSelectCmdsUtils"],function(e){var o=e._filterParentsOnly(n);t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();var i=[];o.forEach(function(e){e.processDescendants({processNode:function(){this.isVisible()&&(!1===this.hasChildren()?i.push(this):"collapsed"===this.getState()&&i.push(this))}})}),t.multiselect(i),t.pushUpdate(),t.pushBroadcastSelect()})}}}),define("DS/ENXNav/commands/view/_xNavSelectCmdsUtils",[],function(){"use strict";return{_filterParentsOnly:function(e){for(var t=[],n=e.length-1;n>=0;n--){var o=e[n];!1===this._isAParentSelected(o,e)&&t.push(o)}return t},_isAParentSelected:function(e,t){for(var n=!1,o=0;o<t.length&&!1===n;o++)e.getID()!==t[o].getID()&&(n=e.isDescendantOf(t[o]));return n}}}),define("DS/ENXNav/views/customize_views/positionMatrix",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","text!DS/ENXNav/assets/templates/positionMatrixTooltip.html","DS/Handlebars/Handlebars","DS/PADServices/views/ENXModal","DS/Controls/Button"],function(e,t,n,o,i,s){"use strict";var r=o.compile(n);function a(e,t,n){var o=e.split(","),i={className:n,x1:Number(o[0]).toFixed(t).toString(10).substring(0,t+3),x2:Number(o[1]).toFixed(t).toString(10).substring(0,t+3),x3:Number(o[2]).toFixed(t).toString(10).substring(0,t+3),y1:Number(o[3]).toFixed(t).toString(10).substring(0,t+3),y2:Number(o[4]).toFixed(t).toString(10).substring(0,t+3),y3:Number(o[5]).toFixed(t).toString(10).substring(0,t+3),z1:Number(o[6]).toFixed(t).toString(10).substring(0,t+3),z2:Number(o[7]).toFixed(t).toString(10).substring(0,t+3),z3:Number(o[8]).toFixed(t).toString(10).substring(0,t+3),t1:Number(o[9]).toFixed(t).toString(10).substring(0,t+3),t2:Number(o[10]).toFixed(t).toString(10).substring(0,t+3),t3:Number(o[11]).toFixed(t).toString(10).substring(0,t+3)};return r(i)}return{getTypeRepresentation:function(){return{"positionMatrix-Instance":{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-position",fontIconFamily:1}}},blankPositionMatrix:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"",fontIconFamily:1}}}}},"positionMatrix-Instance":{getCellTooltip:function(e,n){let o;if(-1===e.rowID)o={shortHelp:t.columnsDef.instanceMatrix,updateModel:!1};else{let n=e.nodeModel.getReferenceValue("positionMatrix-Instance");if(n&&"Position Matrix"!==n){let e=a(n,6);o={title:t.columnsDef.instanceMatrix,shortHelp:e,allowUnsafeHTMLShortHelp:!0,wrapThreshold:315,updateModel:!1}}}return o},buildColumn:function(e){return Object.assign({dataIndex:"positionMatrix-Instance",kind:"functionIcon",width:40,minWidth:40,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!1}},getCellTypeRepresentation:function(e){if(e.nodeModel&&"Position Matrix"!==e.nodeModel.getReferenceValue("positionMatrix-Instance"))return e.nodeModel.getReferenceValue("positionMatrix-Instance")?"positionMatrix-Instance":"blankPositionMatrix"},getCellValueForExport:function(e){var n="";return-1===e.rowID?n=t.columnsDef.instanceMatrix:e&&e.nodeModel&&e.nodeModel.getReferenceValue("positionMatrix-Instance")&&(n=e.nodeModel.options.grid["positionMatrix-Instance"]),n}},e)},actionOnClick:function(e,t){if(e.nodeModel){let o=e.nodeModel.getReferenceValue("positionMatrix-Instance");if(void 0!==o&&"Position Matrix"!==o){let r=a(o,16,"large"),l=document.querySelector(".enx-appMainBody"),d=e.cellView.getContent().getBoundingClientRect(),c={of:l,my:"top left",at:"top left",offsetX:d.x,offsetY:d.y};var n=new i({target:l,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!0,title:t.getPADDGVView().options.dgv.getColumnOrGroup(e.columnID).text,titleBarVisibleFlag:!0,width:"auto",height:"auto",content:r,position:c,buttons:{Close:new s({onClick:function(){n.close()}})},events:{onClickOutsideContent:function(){n.close()}}})}}}}}}),define("DS/ENXNav/commands/_xNavGraphCmds",[],function(){"use strict";var e=null;return{execute:function(t){var n=t.xnav_app.options.views.graphview;switch(t.command_id){case"ReframeAll":n.reframeAll();break;case"ReframeOn":n.reframeOn();break;case"ToggleOverview":n.toggleOverview();break;case"LayoutDown":case"LayoutRight":case"LayoutUp":case"LayoutLeft":n.toggleLayout(t.command_id);break;case"SwapThumbState":require(["DS/etree/syncwidget"],function(t){null===e&&(e=t.ThumbnailState.EXPANDED);var o=!1;e===t.ThumbnailState.EXPANDED?(e=t.ThumbnailState.COLLAPSED,o=!0):e===t.ThumbnailState.COLLAPSED&&(e=t.ThumbnailState.EXPANDED,o=!0),!0===o&&n.setAllThumbnailsState(e)})}}}}),define("DS/ENXNav/models/RefreshHandler",["UWA/Core","UWA/Class"],function(e,t){return t.extend({init:function(e){this.options=e,this.treeDocument=e.treeDocument},complete:function(e){this._clearAllHidden(this.treeDocument),this.treeDocument.getXSO().empty()},_clearAllHidden:function(e){!function(e,t){for(var n=e.getRoots(),o=0;o<n.length;o++){var i=n[o];t(i),i.processDescendants({processNode:function(e){t(this)}})}}(e,function(e){!0===e.options.isPADHiddenBackEnd?delete e.options.isPADHiddenBackEnd:e.options.isPADHidden=!1})}})}),define("DS/ENXNav/commands/view/_xNavSelectAll",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,n=t.getRoots();if(n.length){t.prepareBroadcastSelect(),t.prepareUpdate(),t._selected_paths=[];var o=[];n.forEach(function(e){e.select(),e.processDescendants({processNode:function(){this.isVisible()&&o.push(this)}})}),t.multiselect(o),t.pushUpdate(),t.pushBroadcastSelect()}}}}),define("DS/ENXNav/models/mixins/TreeDocProxy",["DS/PADServices/utils/CommandProxy","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/ENOXParser/modules/common/Constants","DS/ENOXParser/modules/Numbers","i18n!DS/PADServices/assets/nls/PADServices"],function(e,t,n,o,i,s){"use strict";function r(){}return r.prototype={_cmdProxy:null,_pagerview:null,initProxy:function(){this._cmdProxy=e.create({events:{onSelect:this._onSelectProxy.bind(this),onFocus:this._onFocus.bind(this),onFocusChange3D:this._onFocusChange3D.bind(this),onShow:this._onShow.bind(this),onHide:this._onHide.bind(this),onUpdate2DPosMatrix:this._onUpdate2DPosMatrix.bind(this),onUpdateViewPoint:this._onUpdateViewPoint.bind(this),onSendFilterInfo:this._onSendFilterInfo.bind(this),onReframeSelection:this._onReframeSelection.bind(this),onUpdateViewPoint:this._onUpdateViewPoint.bind(this)}})},_onReframeSelection:function(){this.closePager()},_onFocus:function(e,t){var n=this;"focus"===e.intent&&!0!==e.findInCtx&&("graphview"!==n.options.active_view&&"datagridview"!==n.options.active_view||require(["DS/PADUtils/views/PADPager"],function(t){n._doNotBroadcastSelect=!0,n._selectedIdx=0;var i=!1;if(n._selection=[],e.paths.forEach(function(e){var t=n.getNodeByOccurencePath(e);if(t){var s=t.getRoot().options.filtered;s&&(t.options.retrievedFromFocus=!0);let r=t.getParent();for(;r&&("expanded"!==r.getState()&&r.setState(o.NODE_STATES.PARTIALLY_EXPANDED),!r.isRoot());)s&&(r.options.retrievedFromFocus=!0),r=r.getParent();if(t.getID()===e[e.length-1]&&!0!==t.options.isPADHidden)n._selection.push(e);else if(t.getID()===e[0]&&!0!==t.filtered)n._selection.push(e),i=!0;else if(-1!==e.indexOf(t.getID())){!0!==t.getRoot().options.filtered&&(n._selection.push(e),i=!0)}}}),n.originalSelection=n._selection,n._selection.length>1){let e=Promise.resolve();null===n._pagerview&&(e=n.displayPager()),n.insertBranches(n._selection,{node_state:"partiallyExpanded",onComplete:function(){n._doNotBroadcastSelect=!0,n._checkColorize3D()}}),!0===i&&n._cmdProxy.padExpand({paths:n._selection,expand_level:"1",updatePager:!0}),e.then(()=>{n._reframeOn({idx:n._selectedIdx})})}else n.closePager(),n.insertBranches(n._selection,{node_state:"partiallyExpanded",onComplete:function(){n._doNotBroadcastSelect=!0,n._checkColorize3D()}}),!0===i&&n._cmdProxy.padExpand({paths:n._selection,expand_level:"1",updatePager:!0}),n._reframeOn({idx:n._selectedIdx})}))},_onFocusChange3D:function(e){e.sharedID===t.getSharedId()&&this._focusChange(e)},_focusChange:function(e){this._selection&&("previous"==e.event&&(this._selectedIdx--,this._reframeOn()),"next"==e.event&&(this._selectedIdx++,this._reframeOn()))},_reframeOn:function(){-1===this._selectedIdx&&(this._selectedIdx=this._selection.length-1);var e=this._selectedIdx%this._selection.length;if(this._pagerview){var t=e+1+"/"+this._selection.length;this._pagerview.setLabel(t)}var n=this.getNodeByOccurencePath(this._selection[e]);n&&(this._focusOn=!0,n.select(!0),this.getModelEvents().publish({event:"onCenterGraph",data:n}),this._selection.length>1&&this._pagerview.show(),this._focusOn=!1)},_onShow:function(e){var t=[];this.withTransactionUpdate(function(){for(var n=0;n<e.paths.length;n++){var o=this.getNodeByOccurencePath(e.paths[n]);if(o){o.updateOptions({isPADHidden:!1}),t=t.concat(o)}}}.bind(this)),n.publish({event:"ENXModel/hideShowState",target:t,data:{toggle:"show",fromUI:e.fromUI}}),n.publish({event:"ENXModel/HideShowTriggered",data:{name:"show"}})},_onHide:function(e){var t=this,o=[];this._doNotBroadcastSelect=!0,this.insertBranches(e.paths,{node_state:"collapsed",forceCollapsed:!0,novalidation:!0,onComplete:function(){t.withTransactionUpdate(function(){e.paths.forEach(function(e){var n=t.getNodeByOccurencePath(e);if(n){n.updateOptions({isPADHidden:!0}),o=o.concat(n)}})}),t._doNotBroadcastSelect=!1,n.publish({event:"ENXModel/hideShowState",target:o,data:{toggle:"hide",fromUI:e.fromUI}}),n.publish({event:"ENXModel/HideShowTriggered",data:{name:"hide"}})}})},_onUpdate2DPosMatrix:function(e){if(!this.getXSO().isEmpty()){this.prepareUpdate();for(var n=0;n<e.instances.length;n++)for(var o=this.getNodesByRelId(e.instances[n].instance),r=0;r<o.length;r++){var a=e.instances[n].hasPositioningMatrix.join(),l={relationId:e.instances[n].instance,grid:{"positionMatrix-Instance":i.checkNotIdentity(a)?a:null}};o[r].updateOptions(l)}t.displayNotif({message:s.infos.pastePositionSucceeded,level:"info"}),this.pushUpdate()}},_onUpdateViewPoint:function(e){this._viewPointCallback&&(this._viewPointCallback(e),this._viewPointCallback=null,this._viewPointTimer&&(clearTimeout(this._viewPointTimer),this._viewPointTimer=null))},_onSendFilterInfo:function(){this._cmdProxy.receiveFilterInfo({filterAvailable:!0})},displayPager:function(){this._selectedIdx=0;let e=this;return new Promise(function(t,n){"graphview"===e.options.active_view||"datagridview"===e.options.active_view?require(["DS/PADUtils/views/PADPager"],function(n){null===e._pagerview?(e._pagerview=new n({renderTo:document.body,injectNow:!0,callbacks:{onSelectAll:function(){e._doNotBroadcastSelect=!0,e.restoreSelection(!0),e._doNotBroadcastSelect=!1},onPrevious:function(){e._focusChange({event:"previous"})},onNext:function(){e._focusChange({event:"next"})},onClose:function(){e.closePager(),e._focusOn=!1,e.searchProgress=!1}}}),t()):t()}):t()})},closePager:function(){this._pagerview&&(this._pagerview.hide(),this._focusOn=!1,delete this._pagerview)},reframeOn:function(e){-1===this._selectedIdx&&(this._selectedIdx=this._selection.length-1);var t=this._selectedIdx%this._selection.length;if(this._pagerview){var n=t+1+"/"+this._selection.length;this._pagerview.setLabel(n)}var o=this.getNodeByOccurencePath(this._selection[t]);o&&(this._focusOn=!0,e&&!0===e.noSelect||o.select(!0),this.getModelEvents().publish({event:"onCenterGraph",data:o}),this._pagerview&&this._selection.length>1&&this._pagerview.show(),this._focusOn=!1)},_getLastViewpoint:function(e){let t=this;this._pendingViewPoint=e,this._viewPointTimer=setTimeout(function(){t._pendingViewPoint&&(t._pendingViewPoint({success:!1}),delete t._pendingViewPoint)},500),this._cmdProxy.requestViewPoint()},_onUpdateViewPoint:function(e){this._viewPointTimer&&clearTimeout(this._viewPointTimer),this._pendingViewPoint&&(this._pendingViewPoint({success:!0,viewpoint:e}),delete this._pendingViewPoint)}},r}),define("DS/ENXNav/models/mixins/TreeDocSupport",["DS/PADServices/utils/Iterator","DS/PADServices/ws/WSAccess","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Helpers","DS/PADUtils/views/PADAlert","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,o,i,s){function r(){}return r.prototype={},r}),define("DS/ENXNav/views/xNavResponsiveTilesView",["UWA/Controls/Abstract","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/ApplicationFrame/CommandsManager","DS/CollectionView/ResponsiveTilesCollectionView"],function(e,t,n,o,i,s){"use strict";return e.extend(n,o,{name:"xNavResponsiveTileView",defaultOptions:{grid:null,model:null},init:function(e){this._parent(e),this.options=UWA.extend(this.options,e,!0),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var t=UWA.extend(e,{height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"],useDragAndDrop:!0,allowUnsafeHTMLContent:!1},!0),n=this.options.grid=new s(t);e.onContextualEvent&&(n.onContextualEvent=e.onContextualEvent),n.getContent().inject(this.elements.container),this.getOption("renderTo")&&!0===e.isActiveView&&this.elements.container.inject(this.getOption("renderTo")),n.onCellsCopy(function(e){i.getCommand("Copy").begin()}),n.onCellsPaste(function(e){i.getCommand("Paste").begin()}),n.onCellsCut(function(e){i.getCommand("Cut").begin()}),UWA.is(n.onCellsEscape,"function")&&n.onCellsEscape(function(e){i.getCommand("Uncut").begin()}),n.selectionBehavior=UWA.extend({enableFeedbackForActiveCell:!0},n.selectionBehavior),n.onPostCellRequest(function(e){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut")})},setModel:function(e){this.options.model=e,this.options.grid.loadGridViewModel(e),this.elements.container.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this.options.grid.layout.invalidate(),null!==e.options.viewport.thumbnails&&void 0!==e.options.viewport.thumbnails&&this.options.grid.setScrollerPosition(e.options.viewport.thumbnails)},unsetModel:function(){this.getScrollerPosition&&(this.options.model.options.viewport.thumbnails=this.getScrollerPosition()),this.getOption("renderTo").removeChild(this.elements.container),this.options.isActiveView=!1,this.options.grid.unloadGridViewModel()},updateView:function(){this.options.grid.layout.invalidate({updateCellContent:!0})}})}),define("DS/ENXNav/mixins/_xNavDnD",["UWA/Class","DS/PADUtils/PADUtilsServices","DS/PADUtils/views/PADAlert","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADDropTooltip","DS/PADUtils/Utility","DS/ApplicationFrame/CommandsManager","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,o,i,s,r,a,l,d){"use strict";return e.extend({setDnD_onGraph:function(){this.options.views.graphview.getContainer().addEventListener("dragover",this.onDragOverGraph.bind(this)),this.options.views.graphview.getContainer().addEventListener("drop",this.onDropBlankGraph.bind(this)),this.options.views.graphview.getContainer().addEventListener("dragenter",this.onDragLeaveGraph.bind(this)),this.options.views.graphview.getContainer().addEventListener("dragleave",this.onDragLeaveGraph.bind(this)),this.options.views.graphview.getContainer().addEventListener("dragend",this.onDragLeaveGraph.bind(this))},doDnDDragStart:function(e,n,o){var i=t.dropdata_from_selected_nodes(n);return this._updateWithBIProxyInfos(n,i),e.setData("Text",JSON.stringify(i)),!0},shouldAcceptDnDDrop:function(e,t,n,o){var i={shiftKey:2===o.modifiers};return this._add_drop_invite(i),!0},doDnDDrop:function(e,t,n,o){var i={dataTransfer:e,preventDefault:function(){},stopPropagation:function(){},shiftKey:o.modifiers};this._onDropContent(i)},onDragOverGraph:function(e){return e.dataTransfer&&("copyMove"!==e.dataTransfer.effectAllowed&&"copy"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect="copy",e.preventDefault())),this.options.views.graphview.getContainer().addClassName("bordered"),!0},onDragLeaveGraph:function(e){return this.options.views.graphview.getContainer().removeClassName("bordered"),this.onDragLeaveBlank(e)},onDropBlankGraph:function(e){this.options.views.graphview.getContainer().removeClassName("bordered")},onDragEnterBlank:function(e,t){return this.onDragOverBlank(e,t)},onDragOverBlank:function(e,t){return e.preventDefault(),!0!==this.options.layout.dndEvo&&e.stopPropagation(),e.dataTransfer&&("copyMove"!==e.dataTransfer.effectAllowed&&"copy"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect="copy",e.preventDefault())),!!this._isDroppableInBody()&&(this._add_drop_invite(e),!0)},onDragEndBlank:function(e,t){return this.onDragLeaveBlank(e,t)},onDragLeaveBlank:function(e,t){if(!this._isDroppableInBody())return!1;var n=e.relatedTarget,o=n?n.className:"";if(!(!o||-1===o.indexOf("paddnd_invite_")))return e.preventDefault(),e.stopPropagation(),!1;if(this.dropInvitContainer){var i=this.options.model.detachedRoots?this.options.model.detachedRoots.length:0;if(0===this.options.model.getRoots().length&&0===i)this.dropInvitContainer.show("drop");else{if(this.dropInvitContainer.isEventInside(e))return e.preventDefault(),e.stopPropagation(),!1;this.dropInvitContainer.hide(this.dropInvitContainer.active_invite)}}return!0},onDropBlank:function(e,t){return this._onDropContent(e),!0},onDragEnterCell:function(e,t){return this.onDragOverBlank(e,t)},onDragEndCell:function(e,t){return this.onDragLeaveCell(e,t)},onDragStartCell:function(e,n){(t.isTouchDevice()||t.isSurface())&&(this._dnd_startCell=!0,this._dnd_start_target=e.target);var o=n.nodeModel;if(!o.isGroupingNode){var i=this.options.model.getXSO().get().slice(0);if(i[0]!==o){var s=i.indexOf(o),r=i[0];i[0]=o,i[s]=r}var a=t.dropdata_from_selected_nodes(n.draggedNodes);return this._updateWithBIProxyInfos(n.draggedNodes,a),e.dataTransfer.setData("Text",JSON.stringify(a)),e.stopPropagation(),!1}e.preventDefault()},onDragOverCell:function(e,t){return e.dataTransfer&&("copyMove"!==e.dataTransfer.effectAllowed&&"copy"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect="copy",e.preventDefault())),!!this._isDroppableInBody()&&(this.dropInvitContainer&&"find_in_ctx"===t.dataIndex&&this.dropInvitContainer.show("find"),e.preventDefault(),!0)},onDragLeaveCell:function(e,n){if((t.isTouchDevice()||t.isSurface())&&this._dnd_startCell&&(this._dnd_leaveCell=!0),this.dropInvitContainer){var o=e.relatedTarget,i=o?o.className:" ";if(!(!i||-1===i.indexOf("paddnd_invite_"))||this.dropInvitContainer.isEventInside(e))return e.stopPropagation(),e.preventDefault(),!1;this.dropInvitContainer.hide(this.dropInvitContainer.active_invite)}return!0},onDropCell:function(e,i){if(this.onDragLeaveCell(e),e.preventDefault(),!0!==this.options.layout.dndEvo&&e.stopPropagation(),(t.isTouchDevice()||t.isSurface())&&(this._dnd_leaveCell||this._dnd_startCell)&&(this._dnd_leaveCell=!1,this._dnd_startCell=!1,a.elementIsOrIsWithin(e.target,this._dnd_start_target)))return this._dnd_start_target=null,void(this.dropInvitContainer&&this.dropInvitContainer.hide(this.dropInvitContainer.active_invite));function s(){return r}if("top"!==i.dropPosition&&"bottom"!==i.dropPosition){var r=[];"find_in_ctx"===i.dataIndex&&o.retrieveAuthorizedObjects({dnd_event:e,isFindInCtx:!0,callback:function(e){var t=0;for(t=0;t<e.authorized_objects.length;t++)r.push([e.authorized_objects[t].objectId]);r.length&&(i.nodeModel.options.partialPreExpand=s,i.nodeModel.expand())}})}else n.displayNotification({msg:d.drop_between_lines,eventID:"warning",key:"enxNav-dropBetweenLines"});return!1},onDragEnterColumnHeader:function(e,t){},onDragEndColumnHeader:function(e,t){return delete sessionStorage.isNotDroppableInBody,this.onDragLeaveColumnHeader(e,t)},onDragOverColumnHeader:function(e,t){return this._isDroppableInBody()&&(this._add_drop_invite(e),e.preventDefault()),!0},onDragLeaveColumnHeader:function(e,t){var n=this.options.model.detachedRoots?this.options.model.detachedRoots.length:0;return this.dropInvitContainer&&(0===this.options.model.getRoots().length&&0===n?this.dropInvitContainer.show("drop"):this.dropInvitContainer.hide(this.dropInvitContainer.active_invite)),!0},onDropColumnHeader:function(e,n){if("bi_color"==n.dataIndex)return!1;var o=!0;switch(t.retrieveDroppedDataType(e)){case"3DXContent":this.options.model.unselectAll(),this._onDropContent(e),o=!1;break;default:this.dropInvitContainer&&(0===this.options.model.getRoots().length?this.dropInvitContainer.show("drop"):this.dropInvitContainer.hide())}return o},onDragStartColumnHeader:function(e,t){return sessionStorage.isNotDroppableInBody="true",!0},_add_drop_invite:function(e){this.dropInvitContainer&&(e.shiftKey?this.dropInvitContainer.show("add_as_object"):(this.dropInvitContainer.show("add_in_context"),this.dropInvitContainer&&this.dropInvitContainer.elements&&this.dropInvitContainer.elements.container&&this.dropInvitContainer.elements.container.filterDiv&&(this.dropInvitContainer.elements.container.filterDiv.style.display="none",this.dropInvitContainer.elements.container.classList.remove("withFilterOpen"))))},_onDropContent:function(e){var i=this;if(e.preventDefault(),!0!==this.options.layout.dndEvo&&e.stopPropagation(),this.dropInvitContainer&&e.dataTransfer.files&&e.dataTransfer.files.length>0)return 0===i.options.model.getRoots().length?i.dropInvitContainer.show("drop"):i.dropInvitContainer.hide(),!1;function s(o){if(0===o.authorized_objects.length)i.dropInvitContainer&&(0===i.options.model.getRoots().length?i.dropInvitContainer.show("drop"):i.dropInvitContainer.hide()),!0===o.unsupportedDropNotified&&(0===o.authorized_objects.length&&0===o.unauthorized_objects.length?n.displayNotification({msg:d.root_already_loaded}):n.displayNotification({msg:d.invalidDropOperation,eventID:"error",key:"enxNav-onDropContent-invalid-drop"}));else{var s=e.shiftKey||!0===i.options.layout.dndEvo?"WITHOUT_CONTEXT":"WITH_CONTEXT",r=i.options.model.getRoots();t.multiTenantMgt(o.authorized_objects,r,function(e){e.isMultiTenant?e.isMultiTenant&&e.invalidTenant&&i.dropInvitContainer&&(0===i.options.model.getRoots().length?i.dropInvitContainer.show("drop"):i.dropInvitContainer.hide()):o.authorizedWithKind?(o.authorizedWithKind.Product&&o.authorizedWithKind.Product.length>0&&i.add({content:"3DXContent",authorized_objects:o.authorizedWithKind.Product,callback:void 0,behavior:s,isDrop:!0,biProxyCtx:o.source_data.biProxyCtx}),o.authorizedWithKind.Filter&&o.authorizedWithKind.Filter.length>0&&i.addFilter({content:"3DXContent",filter_objects:o.authorizedWithKind.Filter,broadcast:!0,callback:void 0,behavior:"fromDrop"}),o.authorizedWithKind.Change&&o.authorizedWithKind.Change.length>0&&i.loadChange&&i.loadChange({content:"3DXContent",objects:o.authorizedWithKind.Change,callback:void 0,behavior:s}),o.authorizedWithKind.DesignEnv&&o.authorizedWithKind.DesignEnv.length>0&&require("DS/PADServices/utils/GlobalModelEvents").publish({event:"ENXModel/DesignEnv/add",data:{designEnv:o.authorizedWithKind.DesignEnv,resolve:function(e){i.dropInvitContainer&&i.dropInvitContainer.hide()}}})):i.add({content:"3DXContent",authorized_objects:o.authorized_objects,callback:void 0,behavior:s})})}}return e.dataTransfer.params?s(e.dataTransfer.params):o.retrieveAuthorizedObjects({notifPerObjects:!0,displayNotif:!1,dnd_event:e,callback:s,version:"2.0"}),!1},dropOnInvite:function(e){if(this._onDropContent(e),this.dropInvitContainer){var t=this.options.model.detachedRoots?this.options.model.detachedRoots.length:0;0===this.options.model.getRoots().length&&0===t?this.dropInvitContainer.show("drop"):this.dropInvitContainer.hide(this.dropInvitContainer.active_invite),"treelistview"===this.options.active_view&&this.getPADTreeListView().getManager().getScroller().getContent().removeClassName("wux-ui-state-drag-over")}},_isDroppableInBody:function(){return null===sessionStorage.isNotDroppableInBody||"true"!==sessionStorage.isNotDroppableInBody},_updateWithBIProxyInfos:function(e,t){var n=!1;for(let t=0;t<e.length&&!1===n;t++)e[t].isRoot()&&!0===e[t].options.filtered&&(n=!0);if(this._biFilter&&n){var o=this._biFilter.getCtxForSharing();o&&(t.biProxyCtx=o)}}})}),define("DS/ENXNav/utils/FindInCtx",["i18n!DS/ENXNav/assets/nls/ENXNav","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this)}return n.prototype.launchFindWithDialog=function(t){var n=this;require(["DS/ENXNav/views/private/SearchView"],function(o){new o({placeholder:e.searchview.searchPlaceholder,target:t.dgvView?t.dgvView:t.renderTo,position:t.position,events:{onSearch:function(e){n.launchFind({nodes:[t.node],searchFts:e.searchFts,rscId:e.rscId})}}})})},n.prototype.launchFind=function(e){require(["DS/PADServices/utils/PredefinedQueryUtils"],function(n){e.searchFts?n.isPredefinedQry(e.searchFts).then(function(n){t.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:e.nodes,searchFts:n,searchFtsOriginal:e.searchFts,rscId:e.rscId,doNotBroacast:e.doNotBroacast}})}):t.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:e.nodes,searchFtsOriginal:e.searchFts,rscId:e.rscId,doNotBroacast:e.doNotBroacast}})})},new n}),define("DS/ENXNav/views/private/externalColumnsViews/UtilsColumns",[],function(){"use strict";var e=null;const t=-1;function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this)}return n.prototype.getURLParameter=function(t){return null===e&&((e=decodeURIComponent((new RegExp("[?|&]widgetDomain=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null)||(e=location.search.length?location.search:null)),e&&decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(e)||[null,""])[1].replace(/\+/g,"%20"))||null},n.prototype.createCSSClass=function(e,t,n){if(null===document.getElementById(e)){var o=document.createElement("style");o.type="text/css",o.id=e;let i=n||"."+e;o.innerHTML=i+t,document.getElementsByTagName("head")[0].appendChild(o)}},n.prototype.executeGenericTooltip=function(e,n){let o;return o=e.rowID===t?n.getCellDefaultTooltip(e):function(e,t){return{shortHelp:e.nodeModel.options.grid[t],updateModel:!1}}(e,e.dataIndex)},new n}),define("DS/ENXNav/commands/tools/_xNavColumnParam",[],function(){"use strict";return{execute:function(e){var t=require("DS/PADUtils/PADSettingsMgt");!0===t.getSetting("activateTXO")?require(["DS/PADServices/views/AttributesCustomization","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/AttributesMgtV2"],function(t,n,o){var i=n.getModelEvents(),s=[];if(e.dgv&&e.dgv.options.dgvLayout)for(var r=e.dgv.options.dgvLayout.getOrderedColumnsIndexes(),a=0;a<r.length;a++){var l=e.dgv.options.dgv.getColumnOrGroup(r[a]);s.push(l)}else s=e.tree.options.columns;var d=e.dgv?e.dgv.options.viewMode:e.tree.options.viewMode,c=!!e.dgv,u=e.dgv?e.dgv.options.dgvLayout.rowsHeader:void 0,p=o.getDefaultTypesAndExtensions();e.dgv.columnOrdering=!0,new t({modelEvents:i,viewMode:d,appColumns:s,baseTypes:o.getBaseTypes(),baseInstanceTypes:o.getBaseInstanceTypes(),selectedTypes:o.getSelectedTypes(),selectedExtensions:o.getSelectedExtensions(),defaultTypes:p.defaultTypes,defaultExtensions:p.defaultExtensions,withDgv:c,dgvInfo:e.dgv,rowHeaderActivated:u,attributesToIgnore:o.getAttributesToIgnore()});var h=[];h.push(i.subscribe({event:"ENXViews/AttributesCustomization/columnModification"},function(t){switch(t.what){case"addRemoveColumns":t.removedColumns&&(e.tree&&e.tree.removeColumnCB(t.removedColumns),e.dgv&&e.dgv.removeColumnCB(t.removedColumns)),t.addedColumns&&(e.tree&&e.tree.addColumnCB(UWA.clone(t.addedColumns)),e.dgv&&e.dgv.addColumnCB(UWA.clone(t.addedColumns)));break;case"visibilityColumn":e.tree&&e.tree.changeVisibilityCB(t.modifiedColumn,t.visibilityFlag),e.dgv&&e.dgv.changeVisibilityCB(t.modifiedColumn,t.visibilityFlag);break;case"exportColumn":e.tree&&e.tree.changeExportCB(t.modifiedColumn,t.exportFlag),e.dgv&&e.dgv.changeExportCB(t.modifiedColumn,t.exportFlag);break;case"moveColumn":e.tree&&e.tree.moveColumnCB(t),e.dgv&&e.dgv.moveColumnCB(t);break;case"changeTitle":e.tree&&e.tree.changeTitleCB(t.modifiedColumn,t.newTitle),e.dgv&&e.dgv.changeTitleCB(t.modifiedColumn,t.newTitle);break;case"pinChange":e.dgv.changePinCB(t.modifiedColumn,t.pin);break;case"rowsHeaderModification":e.dgv.changeDgvLayout({rowsHeader:t.rowsHeader});break;case"changeColor":e.tree&&e.tree.changeColorCB(t.modifiedColumns,{"background-color":t["background-color"],color:t.color}),e.dgv&&e.dgv.changeColorCB(t.modifiedColumns,{"background-color":t["background-color"],color:t.color});break;case"changeViewMode":e.tree&&e.tree.compactMode(t),e.dgv&&e.dgv.compactMode(t);break;case"close":t.selectedExtensions&&t.selectedTypes&&o.updateSelectedParams({selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes}),e.dgv?e.dgv.saveCustoView(t.applyOnlyToThisApp):e.tree&&e.tree.saveCustoView(t.applyOnlyToThisApp),h.forEach(function(e){i.unsubscribe(e)});break;case"reset":o.resetSelectedParams(),e.dgv&&e.dgv.reset(t.parameters),e.tree&&e.tree.reset(t.parameters),h.forEach(function(e){i.unsubscribe(e)});break;default:console.warn("Unknown column modification kind:"+t.what)}}))}):require(["DS/PADUtils/views/parametrization/TreeListParametrization","DS/PADUtils/PADWebInWinServices","DS/PADServices/utils/GlobalModelEvents"],function(n,o,i){var s,r=!1;o.isWebInWinContext()||!0!==t.getSetting("activateTreeOptionsInWidgetBody")||(s=i.getModelEvents(),r=!0),new n({columns:e.tree.getColumnsForParametrization(),cmd:e.cmd,viewMode:e.tree.options.viewMode,inMainView:r,modelEvts:s,render_div:".xnav_body",events:{modifyColumRendering:e.tree.modifyColumRendering.bind(e.tree),custoViewChange:e.tree.custoViewChange.bind(e.tree),saveAsTemplate:e.tree.saveAsTemplate.bind(e.tree),reset:e.tree.reset.bind(e.tree),addColumn:e.tree.addColumnCB.bind(e.tree),removeColumn:e.tree.removeColumnCB.bind(e.tree),moveColumn:e.tree.moveColumnCB.bind(e.tree),compactMode:e.tree.compactMode.bind(e.tree)}})})}}}),define("DS/ENXNav/commands/GroupsLayoutCompact",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/GroupsLayout",data:{mode:"compact"}})}})}),define("DS/ENXNav/views/private/ExpandChecker",["i18n!DS/ENXNav/assets/nls/ENXNav","DS/PADUtils/PADSettingsMgt","DS/Controls/Toggle","DS/PADServices/utils/GlobalUtils"],function(e,t,n,o){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this.storageKey=o.getAppId()+"-NoCheckExpanAll",this)}return i.prototype.check=function(n){var o=this;return new Promise(function(i){for(var s=function(e){i({performExpandAll:e})},r=!1,a=0;a<n.roots.length;a++){var l=n.roots[a];l.hasSynthesis()&&(t.getSetting("maxNumberOfLeaves")<=l.getSynthesis("leafSynthesis")?(r=!0,console.log("Too many leaves (>"+t.getSetting("maxNumberOfLeaves")+")")):t.getSetting("maxNumberOfOcc")<=l.getSynthesis("occSynthesis")?(r=!0,console.log("Too many occurences (>"+t.getSetting("maxNumberOfOcc")+")")):t.getSetting("maxNumberOfObj")<=l.getSynthesis("flatSynthesis")&&(r=!0,console.log("Too many objects (>"+t.getSetting("maxNumberOfObj")+")")))}r?"TRUE"!==localStorage.getItem(o.storageKey)?require(["DS/PADServices/views/ENXModal","DS/Controls/Button"],function(t,i){o.modalStop=new t({target:n.targetDiv,title:e.expandChecker.title,content:o.buildContent(),modalFlag:!0,resizableFlag:!1,closeButtonFlag:!1,width:"auto",height:"auto",position:{my:"center",at:"center"},buttons:{No:new i({touchMode:!0,onClick:function(){s(!1),o.modalStop.close()}}),Yes:new i({touchMode:!0,onClick:function(){var e=o.toggleAskAgain.checkFlag;localStorage.setItem(o.storageKey,e?"TRUE":null),s(!0),o.modalStop.close()}})}})}):s(!0):s(!0)})},i.prototype.buildContent=function(){var t=new UWA.Element("div",{class:"enx-expandchecker-content"});new UWA.Element("div",{class:"enx-expandchecker-text"}).inject(t).setHTML(e.expandChecker.content);var o=new UWA.Element("div",{class:"enx-expandchecker-checker"}).inject(t),i=this.toggleAskAgain=new n({type:"checkbox",label:e.expandChecker.askAgain}).inject(o);return i.getContent().addClassName("enx-expandchecker-toggle"),i.addEventListener("change",function(e){e.dsModel.checkFlag?this.helpCheckerDiv.removeAttribute("hidden"):this.helpCheckerDiv.setAttribute("hidden","")}.bind(this)),(this.helpCheckerDiv=new UWA.Element("div",{class:"enx-expandchecker-checkerhelp"}).inject(t)).setText(e.expandChecker.checkerhelp),this.helpCheckerDiv.setAttribute("hidden",""),t},new i}),define("DS/ENXNav/commands/_xNavActionBar",["UWA/Core","DS/ApplicationFrame/ActionBar","DS/RuntimeView/NLSManager","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt"],function(e,t,n,o,i,s){"use strict";function r(r){this.options={action_bar:{file:null,module:null,context:null,hidden:null,language:"en"},renderTo:null,callback:{onactionbarcb:null}},o.set(r.xnav_app),this.options=e.extend(this.options,r,!0),n.DEFAULT_LANGUAGE=this.options.action_bar.language;var a=new t(this.options.action_bar),l=this;if(UWA.is(this.options.callback.onactionbarcb,"function")){if(UWA.is(a.onActionBarDisplay,"function"))var d=a.onActionBarDisplay(function(){a._modelEvents.unsubscribe(d),l.options.callback.onactionbarcb.call(null,"onActionBarDisplay")});var c=a.onActionBarReady(function(){a._modelEvents.unsubscribe(c),l.options.callback.onactionbarcb.call(null,"onActionBarReady")})}a.elements.container.addClassName("xnav_actionbar"),s.getSetting("activateCustomScrollPaddingBottom")&&a.elements.container.addEventListener("click",function(e){const t=e.currentTarget.getAttribute("data-open");l.options.action_bar.hidden?l.options.action_bar.hidden!==t&&(l.options.action_bar.hidden=t,i.publish({event:"ENXViews/ActionBar/status",data:{dataOpen:t}})):(l.options.action_bar.hidden=t,i.publish({event:"ENXViews/ActionBar/status",data:{dataOpen:t}}))}),a.inject(this.options.renderTo),this.options.xnav_ab=a,i.subscribe({event:"ENXViews/ActionBar/hide"},function(){l.options.xnav_ab.close()})}return r.prototype={mergeGraphSection:function(){this.options.xnav_ab.loadModel({merge:!0,file:"GraphViewAB.xml",module:"ENXNav"})}},r}),define("DS/ENXNav/mixins/xNavWidgetLink",["UWA/Class","DS/ENOXInterWdgCom/LinkManager","DS/PlatformAPI/PlatformAPI","DS/PADServices/utils/GlobalUtils","DS/PADUtils/PADPromise","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADUtilsServices","DS/ENOXParser/modules/common/Helpers"],function(e,t,n,o,i,s,r,a,l){return e.extend({setupWidgetLink:function(){window.__karma__?console.warn("We are in karma test environment, thus preventing the use of WidgetLink."):(t.subscribe("DS/ExternalWdgtCom/LoadData",this._onLoadData.bind(this)),t.subscribe("DS/ExternalWdgtCom/RemoveAll",this._onRemoveAll.bind(this)),t.subscribe("DS/ExternalWdgtCom/RemoveRoot",this._onRemoveRoots.bind(this)),t.subscribe("DS/ExternalWdgtCom/GetInfosForSync",this._onGetInfosForSync.bind(this)),t.subscribe("DS/ExternalWdgtCom/SyncContent",this._onSyncContent.bind(this)),t.subscribe("DS/ExternalWdgtCom/EndSync",this._endSync.bind(this)))},_isEventSourceCorrect:function(e,n,o){let i=!0;if(e&&"Widgets"===n){t.getLinked().filter(t=>t.id===e).length>0&&(console.warn("Please use WidgetLink instead of PlatformAPI to publish this "+o+" event if your widget "+e+" is linked to a Product Structure app"),i=!1)}return i},_onLoadData:function(e,n){this._isEventSourceCorrect(e.fromWidgetId,n.channel,"LoadData")&&(e.dropData.broadcast=!1,e.dropData.behavior="WITHOUT_CONTEXT",t.addWidgetLinkHit("event-2d","DS/ExternalWdgtCom/LoadData"),this.openDroppedObjects(e.dropData))},_onRemoveAll:function(e,n){this._isEventSourceCorrect(e.fromWidgetId,n.channel,"RemoveAll")&&(t.addWidgetLinkHit("event-2d","DS/ExternalWdgtCom/RemoveAll"),this.empty(!1))},_onRemoveRoots:function(e,n){this._isEventSourceCorrect(e.fromWidgetId,n.channel,"RemoveRoot")&&(t.addWidgetLinkHit("event-2d","DS/ExternalWdgtCom/RemoveRoot"),delete e.fromWidgetId,this._onRemoveRoot(e))},_onApplyFilter:function(e){this._onApplyNGFilter(e.filterData)},_onLinkExternalWidget:function(e){let n=e.fromWidgetId,o=t.getLinked().filter(e=>e.id===n);o&&0!==o.length||t.setLinked({[n]:!0})},_onGetInfosForSync:function(){this.disableUX(),t.setWidgetSynchronizing(!0);let e=widget.getValue("x3dSharedId"),o=!1;void 0!==e&&(o=t.isLinkedWithPartnerApp(e)),n.publish("DS/ExternalWdgtCom/GetInfosForSync",{id:widget.id,sharedID:e,isLinkedWithPartnerApp:o})},_onGetContentForSync:function(){this.disableUX();let e=this.getRoots(),t=[];return e&&e.length>0&&(t=e.map(e=>{const t=e.getID();return{rootID:t,serviceID:null,filterId:this._biFilter.HasFilter(t).filterId}})),t},_onSyncContent:function(e){var o=this;if(t.setSourceWidgetId(e.srcWidgetID),e.srcWidgetID===widget.id&&"function"==typeof this._biFilter.linkWith)return void this._biFilter.linkWith({srcWgtId:e.srcWidgetID,callback:function(){console.log("Linked BIProxy of "+widget.id+" with "+e.srcWidgetID),n.publish("DS/ExternalWdgtCom/FinishedSync")}});let s=t.createView(t=>t.id===e.srcWidgetID);var a=function(){console.log("Linked BIProxy of "+widget.id+" with "+e.srcWidgetID);let t=[];if(e.rootsToSync.forEach(e=>{t.push({rootId:e.rootID,filterId:e.filterId})}),o.empty(!1,!1,!0),t.length>0)if(e.widgetsOnlyRemove.includes(widget.id))s.publish("DS/ExternalWdgtCom/FinishedSync");else{var n=i.getPromises();Promise.all(n).then(function(){o.add({rootsWithFilters:t,content:"filters",callback:function(){s.publish("DS/ExternalWdgtCom/FinishedSync"),t.forEach(function(e){if(o._biFilter.HasFilter(e.rootId).hasFilter){var t=o.options.model.searchRootById(e.rootId);t&&l.node.setFilterBadge(t)}})}})})}else s.publish("DS/ExternalWdgtCom/FinishedSync")};"function"==typeof this._biFilter.linkWith?this._biFilter.linkWith({srcWgtId:e.srcWidgetID,callback:a}):r.subscribe({event:"ENXModel/Root/FBIProxy"},()=>{this._biFilter.linkWith({srcWgtId:e.srcWidgetID,callback:a})})},_unLinkBIProxy:function(e,t){"function"==typeof this._biFilter.unlink&&this._biFilter.unlink({widgetId:widget.id,srcWgtId:e,NGFUXId:t,callback:()=>{console.log("Unlinked BIProxy of"+widget.id+" from "+e)}})},_linkBIProxy:function(e){"function"==typeof this._biFilter.linkWith&&this._biFilter.linkWith({srcWgtId:e,callback:()=>{console.log("Linked BIProxy of "+widget.id+" with "+e)}})},_endSync:function(){var e=this,n=i.getPromises();Promise.all(n).then(function(){t.setWidgetSynchronizing(!1),e.enableUX(),o.displayNotif({level:"success",message:s.syncSuccessNotif,sticky:!1})})}})}),define("DS/ENXNav/commands/view/_xNavSelectInversion",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,n=t.getRoots(),o=t.getSelectedNodes();require(["DS/ENXNav/commands/view/_xNavSelectCmdsUtils"],function(e){var i=[],s=[];n.length&&(t.prepareBroadcastSelect(),t.prepareUpdate(),n.forEach(function(t){t.isSelected()&&s.push(t),t.processDescendants({processNode:function(){this.isSelected()?s.push(this):e._isAParentSelected(this,o)?s.push(this):i.push(this)}})}),o.forEach(function(e){if(!e.isRoot()){let t=e.getParent();for(;t&&(s.push(t),!t.isRoot());)t=t.getParent()}}),t.multiselect(i),t.multiunselect(s),t.pushUpdate(),t.pushBroadcastSelect())})}}}),define("DS/ENXNav/commands/xNavActionBarCmds",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/PADTrackerManager","DS/PADUtils/PADSettingsMgt"],function(e,t,n,o,i){"use strict";var s=["ExpandAll","CollapseAll","ExpandN","SelectChildren","SelectParent","SelectSiblings","SelectLeaves","ReframeOn"],r=["ReframeAll","ReframeOn","ToggleOverview","LayoutDown","LayoutRight","LayoutUp","LayoutLeft","SwapThumbState"],a=["RootPanel","Home","Print","PrintOptions","ExportCSV","ExportCSVOptions","CleanAll"],l=["Print","PrintOptions","ExportCSV","ExportCSVOptions"],d=["ExpandAll","CollapseAll","ExpandN"],c=["Print","ExportCSV","CleanAll"],u=["ColumnVisibility"],p=["Print","PrintOptions","ExportCSV","ExportCSVOptions"],h=["ProductToPart"],g=["ProductToPart"];function f(e,t){return-1!==e.indexOf(t)}return e.extend({init:function(e){this._parent(e);var o=this,i=(v=t.get()).options.model?v.options.model:v.getPADTreeDocument();if(n.isMobileDevice()&&-1!==p.indexOf(this.options.ID))this.disable();else if(-1!==s.indexOf(this.options.ID)&&-1!==r.indexOf(this.options.ID))this._check_view(!0),v.addEvent("onToggleView",function(){o._check_view(!0)}),i.getXSO().onPostAdd(function(){o._check_view(!0)}),i.getXSO().onPostRemove(function(){o._check_view(!0)}),i.getXSO().onEmpty(function(){o._check_view(!0)});else if(-1!==s.indexOf(this.options.ID))this._check_select(),i.getXSO().onPostAdd(this._check_select.bind(this)),i.getXSO().onPostRemove(this._check_select.bind(this)),i.getXSO().onEmpty(this._check_select.bind(this));else if(-1!==r.indexOf(this.options.ID))this._check_view(),v.addEvent("onToggleView",this._check_view.bind(this));else if(-1!==a.indexOf(this.options.ID)){this._check_roots();var d=this._check_roots.bind(this);i.addEventListener("addChild",d),i.addEventListener("removeChild",d),f(l,this.options.ID)&&(this._check_roots(),v.addEvent("onRootsVisibility",this._check_roots.bind(this)))}else if(c.indexOf(this.options.ID)&&-1!==c.indexOf(this.options.ID)){this._parent(e);var v;i=(v=t.get()).options.model?v.options.model:v.getPADTreeDocument();this.disable(),v.getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},this._check_added_roots.bind(this))}else if(f(u,this.options.ID))this._check_if_treeview(),UWA.is(v.addEvent,"function")&&v.addEvent("onToggleView",this._check_if_treeview.bind(this));else if(-1!==h.indexOf(this.options.ID)){var m=-1!==g.indexOf(this.options.ID);this._check_mono_select(m),m&&t.get().addEvent("editModeModified",function(){o._check_mono_select(m)}),i.getXSO().onPostAdd(function(){o._check_mono_select(m)}),i.getXSO().onPostRemove(function(){o._check_mono_select(m)}),i.getXSO().onEmpty(function(){o._check_mono_select(m)})}},execute:function(){var e=this,n=t.get(),i=n.options.model?n.options.model:n.getPADTreeDocument();switch(this.options.ID){case"treelistview":case"graphview":case"tileview":case"thumbnailview":case"treeview":require(["DS/ENXNav/commands/_xNavSwitchView"],function(t){t.execute({command_id:e.options.ID,xnav_app:n})});break;case"ExpandAll":require(["DS/ENXNav/commands/view/_xNavExpandAll"],function(e){e.execute({xnav_app:n,model:i})});break;case"CollapseAll":require(["DS/ENXNav/commands/view/_xNavCollapseAll"],function(e){e.execute({xnav_app:n,model:i})});break;case"ExpandN":require(["DS/ENXNav/commands/view/_xNavExpandN"],function(t){t.execute({xnav_app:n,model:i,position:e.options.position}),delete e.options.position});break;case"SelectAll":require(["DS/ENXNav/commands/view/_xNavSelectAll"],function(e){e.execute({xnav_app:n,model:i})});break;case"SelectChildren":require(["DS/ENXNav/commands/view/_xNavSelectChildren"],function(e){e.execute({xnav_app:n,model:i})});break;case"SelectInversion":require(["DS/ENXNav/commands/view/_xNavSelectInversion"],function(e){e.execute({xnav_app:n,model:i})});break;case"SelectParent":require(["DS/ENXNav/commands/view/_xNavSelectParent"],function(e){e.execute({xnav_app:n,model:i})});break;case"SelectSiblings":require(["DS/ENXNav/commands/view/_xNavSelectSiblings"],function(e){e.execute({xnav_app:n,model:i})});break;case"SelectLeaves":require(["DS/ENXNav/commands/view/_xNavSelectLeaves"],function(e){e.execute({xnav_app:n,model:i})});break;case"CleanAll":require(["DS/ENXNav/commands/view/_xNavCleanAll"],function(e){e.execute({xnav_app:n})});break;case"ProductToPart":require(["DS/ENXNav/commands/ProductToPart"],function(t){t.execute({command_id:e.options.ID,xnav_app:n,model:i})});break;case"ReframeAll":case"ReframeOn":case"ToggleOverview":case"LayoutDown":case"LayoutRight":case"LayoutUp":case"LayoutLeft":case"SwapThumbState":require(["DS/ENXNav/commands/_xNavGraphCmds"],function(t){t.execute({command_id:e.options.ID,xnav_app:n,model:i})});break;case"RelationIPExplorer":require(["DS/ENXNav/commands/tools/_xNavRelationIPExplorer"],function(t){t.execute({command_id:e.options.ID,xnav_app:n,model:i})});break;case"ColumnVisibility":require(["DS/ENXNav/commands/tools/_xNavColumnParam"],function(t){var o=n.options.views?n.options.views.treelistview:n.getPADTreeListView(),i=n.options.views?n.options.views.datagridview:void 0;t.execute({command_id:e.options.ID,cmd:e,xnav_app:n,tree:o,dgv:i})});break;default:throw new Error("Unknown command")}if(!0===this.options.fromCtx)delete this.options.fromCtx;else{var s=o.getPADTracker({eventCategory:"usage",eventAction:"command-2D"});s.setEventData({eventLabel:this.options.ID}),s.trackPageEvent()}},_check_roots:function(){t.get().getPADTreeDocument().getRoots().length>0?this.enable():this.disable()},_check_added_roots:function(e){t.get().getPADTreeDocument();0===e.data.nb_root?this.disable():this.enable()},_check_select:function(){if(!0===!!t.get().getPADTreeDocument().getXSO().get().length){var e=t.get().getPADTreeDocument().getXSO().get();f(d,this.options.ID)&&!function(e){for(var t=0,n=0;n<e.length;n++)null!==e[n].getChildren()&&t++;return t>0}(e)?this.disable():this.enable()}else this.disable()},_check_mono_select:function(e){if(e&&!0!==t.get().getEditMode())this.disable();else{var n=t.get().getPADTreeDocument().getXSO().get();1===n.length&&!0!==n[0].isRelationsObjectNode?this.enable():this.disable()}},_check_edit_mode:function(){1==t.get().getEditMode()&&this.disable()},_check_view:function(e){if(!0===e){var n=!!t.get().getPADTreeDocument().getXSO().get().length;"graphview"===t.get().options.active_view&&!0===n?this.enable():this.disable()}else{switch(t.get().options.active_view){case"tileview":case"thumbnailview":t.get().getPADTreeDocument()._pagerview&&t.get().getPADTreeDocument()._pagerview.hide();break;case"treelistview":case"graphview":t.get().getPADTreeDocument()._pagerview&&t.get().getPADTreeDocument()._pagerview.show()}"graphview"===t.get().options.active_view?this.enable():this.disable()}},_check_if_treeview:function(){switch(t.get().getPADTreeDocument().options.active_view){case"treelistview":case"datagridview":this.enable();break;case"graphview":case"tileview":case"thumbnailview":this.disable()}}})}),define("DS/ENXNav/views/private/externalColumnsViews/responsible",["css!DS/ENXNav/ENXNav.css","text!DS/ENXNav/assets/templates/responsibleTooltip.html","DS/PADServices/utils/AttributesMgtV2","DS/i3DXCompassServices/i3DXCompassServices","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/ApplicationFrame/CommandsManager","DS/Handlebars/Handlebars","DS/PADUtils/Configuration"],function(e,t,n,o,i,s,r,a,l){"use strict";var d=a.compile(t),c=null,u=function(e,t){let n;return c&&(n=c+"/api/user/getpicture/login/"+e,t&&(n+="/format/"+t)),n},p={"ds6w:responsible":{getCellTooltip:function(e,t){let n;if(-1===e.rowID)n=t.getCellDefaultTooltip(e);else{var o=e.nodeModel?e.nodeModel.options.grid.owner:void 0;if(o&&c){n={shortHelp:d({responsible:e.nodeModel.getReferenceValue("ds6w:responsible"),url:u(o,"normal")}),allowUnsafeHTMLShortHelp:!0,updateModel:!1}}else n={shortHelp:e.nodeModel.getReferenceValue("ds6w:responsible")}}return n},buildColumn:function(e){n.addBIColumn("owner",!1);var t=!0;return!l.getConfig("readOnlyApp")&&(t=!1),Object.assign({dataIndex:"ds6w:responsible",kind:"user",minWidth:150,editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.isGroupingNode?"string":"user"},getCellValue:function(e){var n=e.nodeModel&&e.nodeModel.options.grid.owner?e.nodeModel.options.grid.owner:void 0,o=n?u(n):void 0;let i;i=o?{iconPath:"url("+o+")",className:"dgv-user-thumbnail"}:{iconName:"topbar-user",fontIconFamily:1};var s=e.nodeModel?e.nodeModel.options.grid["ds6w:responsible"]:void 0;if(s){let n={icon:i,label:s};return!1===t&&(n.module="DS/ENXNav/views/private/externalColumnsViews/responsible",n.func="launchCmd",n.argument={nodeModel:e.nodeModel}),n}},getCellValueForExport:function(e){return e&&e.nodeModel?e.nodeModel.options.grid["ds6w:responsible"]:void 0}},e)}},launchCmd:function(e){if(e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{var e=r.getCommand("ActionBar_TransferOwnership");e&&e.begin()},t)}}};return new Promise(e=>{c?e(!0):void 0===c?e(!1):o.getServiceUrl({serviceName:"3DSwym",platformId:s.getPlatformId(),onComplete:t=>{e(void 0!==(c=t))},onFailure:()=>{c=void 0,e(!1)}})}),p}),define("DS/ENXNav/mixins/xNavLeftSidePanel",["DS/PADServices/views/ENXLeftSidePanel","DS/PADServices/utils/GlobalModelEvents","DS/Utilities/Utils"],function(e,t,n){"use strict";function o(){}var i=0;return o.prototype.createRootListSlidder2=function(){var o=this;return this.leftsidepanel=new e,this.options.model.onNodeModelUpdate(function(e){var o=[],s=[];e.data.nodeModel.isRoot()&&(-1===s.indexOf(e.data.nodeModel.getID())&&(s.push(e.data.nodeModel.getID()),o.push(e.data.nodeModel)),this.__debounceRootSync=this.__debounceRootSync?this.__debounceRootSync:n.debounce(()=>{console.log("xNavLeftSidePanel.onNodeModelUpdate debounce: "+i),i++;for(let e=0;e<o.length;e++)t.publish({event:"ENXModel/Root/sync",data:o[e]})},350),this.__debounceRootSync())}),t.subscribe({event:"ENXModel/Root/select"},this._onTileSelect.bind(this)),t.subscribe({event:"ENXModel/Root/addTile"},this.openDroppedObjects.bind(this)),t.subscribe({event:"ENXModel/Root/removeTile"},this._onRemoveTile.bind(this)),t.subscribe({event:"ENXModel/DesignEnv/added"},function(){o.openPanel("left")}),this.leftsidepanel.getContent()},o.prototype._onTileSelect=function(e){if(!UWA.is(e.tile_ids,"array"))throw new Error("Invalid input param, no params.tile_ids defined");var t=this;t.options.model.withBroadcastSelect(function(){t.options.model.unselectAll(),e.tile_ids.forEach(function(n){var o=t.options.model.searchRootById(n);o&&!0!==o.isFiltered()?(o.select(),1===e.tile_ids.length&&t.options.model.getModelEvents().publish({event:"onCenterGraph",data:o})):console.log("Cannot find ["+n+"] in the TreeDocument")})})},o.prototype._onRemoveTile=function(e){if(!e.all){if(!UWA.is(e.tile_id))throw new Error("Invalid input parameter");var t=this.options.model.searchRootById(e.tile_id);return UWA.is(t)&&this.options.model.removeRoot(t),!1}this.options.model.empty()},o}),define("DS/ENXNav/views/customize_views/_xNavDGVUtils",["DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/HideShowController","i18n!DS/ENXNav/assets/nls/ENXNav"],function(e,t,n,o,i){"use strict";function s(e){e.typeRepresentation=void 0===e.typeRepresentation?"string":e.typeRepresentation;const t=e.dataIndex;e.filterOptions={mapPossibleValues:function(e){return new Promise(function(o){let i={};i[t]=e,n.retrieveNLS({nlsData:i}).then(function(e){const n=Object.values(e[t]);o(n)})})}}}function r(e){}return r.prototype.buildColumns=function(t){return new Promise(function(t,o){var i=[],s=0,r=e.getColumnsOrder(void 0);e.updateAttributesWithKind(void 0).then(function(){for(s=0;s<r.length;s++){var o=e.getColumn(r[s],void 0);if(o){let e=null;o.ds6w&&this.options.columnViews[o.ds6w]?e=this.options.columnViews[o.ds6w].AMD[o.ds6w].buildColumn(o):o.dataIndex&&this.options.columnViews[o.dataIndex]&&(e=this.options.columnViews[o.dataIndex].AMD[o.dataIndex].buildColumn(o)),null===e&&(e=this.buildColumnFromSetting(o)),null!==e&&i.push(e)}}var a=UWA.clone(i);n.updateColumnsWithNLS(a,function(e){var n={};n.columns=a,"success"===e.status&&(n.columns=e.columns),t(n)})}.bind(this)).catch(o)}.bind(this))},r.prototype.buildColumnFromSetting=function(t){var n=Object.assign({minWidth:50,editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}}},t);if(!UWA.is(n.dataIndex)&&"actualIndex"!==n.dataIndex){if(!UWA.is(n.ds6w))throw new Error("Wrong column definition for ["+JSON.stringify(t)+"]");n.dataIndex=n.ds6w}!UWA.is(n.ds6w)&&!0!==n.isAdditionalColumn&&e.isAttributeColumn(n.dataIndex)&&(n.ds6w=n.dataIndex,UWA.is(n.kind)||(n.kind=null),"actualIndex"!==n.dataIndex&&console.warn(n.dataIndex+" column attribute missing ds6w"));switch(-1!==["hide_show","find_in_ctx","actualIndex"].indexOf(n.dataIndex)&&(n.customisation=UWA.extend(n.customisation,{exportable:{lock:!0,value:!1}})),n.kind&&("timestamp"===n.kind||"dateTime"==n.kind?n.typeRepresentation="datetime":n.typeRepresentation||(n.typeRepresentation=n.kind)),n.typeRepresentation||(n.typeRepresentation="string"),n.dataIndex){case"thumbnail":n.ds6w=void 0,n.alignment="center",n.typeRepresentation="image";break;case"tree":n.getCellKPIColor=function(e){if(!e.isHeader&&e.nodeModel){if(e.nodeModel.options.color)return e.nodeModel.options.color;if(e.nodeModel.options.grid.bi_color)return e.nodeModel.options.grid.bi_color}};break;case"ds6w:label-Instance":n.getCellKPIColor=function(e){if(!e.isHeader&&e.nodeModel&&e.nodeModel.options.colorInstance)return e.nodeModel.options.colorInstance},n.getCellValueForExport=function(e){var t="";return-1===e.rowID?t=i.instanceName:e&&e.nodeModel&&e.nodeModel.options.grid&&e.nodeModel.options.grid["ds6w:label-Instance"]&&(t=e.nodeModel.options.grid["ds6w:label-Instance"]),t}}return"rel"===n.ds6wFrom&&(n.icon={iconName:"flow-cascade dgv-header-icon",fontIconFamily:WUXManagedFontIcons.Font3DS}),"boolean"!==n.typeRepresentation||n.getCellValue||(n.getCellValue=function(e){if(e.nodeModel){let i=this.getColumnOrGroup(e.columnID);var t=e.nodeModel.getReferenceValue(i.dataIndex);return o=!1,"boolean"==typeof(n=t)?o=n:"string"==typeof n?o="true"===n.toLowerCase():void 0===n&&(o=void 0),t=o}var n,o}),n},r.prototype.buildColumnsFromStorage=function(t){var n=this;return new Promise(function(o,i){var s=[],r=0;t=function(e){for(var t=[],n=!1,o=0;o<e.length;o++)"instanceName"===e[o].dataIndex?e[o].dataIndex="ds6w:label-Instance":"instanceMatrix"===e[o].dataIndex&&(e[o].dataIndex="positionMatrix-Instance"),"findinctx"===e[o].dataIndex&&(n=!0),t.push(e[o]);return!1===n&&t.push({dataIndex:"findinctx",alignment:"center",typeRepresentation:"findInCtx",width:40,minWidth:40,maxWidth:40,hasNLS:!1,noTitleColumn:!0,pinned:"right",kind:"functionIcon",visibleFlag:!1,getCellSemantics:function(e){return!0===e.nodeModel.isRelationsObjectNode?null:{}},customisation:{exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!1}}}),t}(t),e.updateAttributesWithKind(void 0,t).then(function(t){e.updateAttributesWithKind().then(function(){var i=[];for(r=0;r<t.length;r++)i.push(new Promise(function(o){var i=t[r].dataIndex;e.addAvailableColumn(i,t[r]).then(function(e){var t=null;e.ds6w&&n.options.columnViews[e.ds6w]?t=n.options.columnViews[e.ds6w].AMD[e.ds6w].buildColumn(e):e.dataIndex&&n.options.columnViews[e.dataIndex]&&(t=n.options.columnViews[e.dataIndex].AMD[e.dataIndex].buildColumn(e)),null===t&&(t=n.buildColumnFromSetting(e)),t&&s.push(t),o()})}));Promise.all(i).then(function(){var e=UWA.clone(s);o(e)})})})})},r.prototype.getTypeRepresentations=function(){return JSON.stringify(this.options.typeRepresentations)},r.prototype._exportAsCmd=function(e){if("csv"===e.exportAs){var n=this.getColumnsForExport(),o=this.options.dgv.getAsCSV({columnKeys:n,addLevelInformation:!0});t.downloadfile(o,t.getAppId()+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv","text/csv")}else this.options.dgv.openPrintableViewWindow(!0)},r.prototype.__addFilterModel=function(e){return new Promise(t=>{this.options.filterModel={};for(const t of e.columns){const e=this.options.columnsDefaultfilterDefinition;!0!==t.neverVisible&&!0!==t.isAdditionalColumn&&-1===e.excluded.indexOf(t.dataIndex)&&(-1!==e.set.indexOf(t.dataIndex)?(this.options.filterModel[t.dataIndex]={filterId:"set"},-1!==e.keyWithTranslation.indexOf(t.dataIndex)&&s(t)):"tree"===t.dataIndex?this.options.filterModel.label={filterId:"stringRegexp",filterModel:{condition1:{type:"contains",filter:""}}}:"string"===t.typeRepresentation?this.options.filterModel[t.dataIndex]={filterId:"stringRegexp",filterModel:{condition1:{type:"contains",filter:""}}}:"boolean"===t.typeRepresentation&&(this.options.filterModel[t.dataIndex]={filterId:"set"}))}t()})},r}),define("DS/ENXNav/commands/view/_xNavExpandAll",["DS/PADUtils/Utility","DS/PADUtils/PADSettingsMgt","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,n){"use strict";return{execute:function(o){var i,s=o.model.getSelectedNodes().filter(function(e){return e.isVisible()}).sort(function(e,t){return e._getRowID()>t._getRowID()}),r=[];let a=s.filter(function(e){return e.getChildren()}),l=a.map(function(e){return e.getRoot()}).filter(function(e,t,n){return n.indexOf(e)===t});i=l;var d=function(){let t=5;r.length>2e3&&(t=1e3);var i,s,a,l=function(e,t){for(var n=[],o=e.length,i=o-1,s=[],r=0;r<o;r++)s.push(e[r]),0===r||(r+1)%t!=0&&r!==i||(n.push(s),s=[]);return n}(r,t);i=o.model,o.xnav_app,(s=l).length,n.loadingText,(a=e.createStepper(s,i,function(e,t){t.expandMultiSelect({nodes2Expand:e,expandAll:!0,tagger:!1,callback:function(){a()}})},function(){i.notifyTagger()}))()};(r=a).length>1?!0===t.getSetting("activateSynthesisOnRoot")?require(["DS/ENXNav/views/private/ExpandChecker"],function(e){var t=document.getElementsByClassName("enx-appMainBody");t&&1===t.length?(t=t[0],e.check({targetDiv:t,roots:i}).then(function(e){!0===e.performExpandAll&&d()})):d()}):d():1===r.length&&r[0].expandAll()}}}),define("DS/ENXNav/views/xNavResponsiveThumbnailsView",["UWA/Controls/Abstract","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/ApplicationFrame/CommandsManager"],function(e,t,n,o,i,s){"use strict";return e.extend(n,o,{name:"xNavResponsiveThumbnailView",defaultOptions:{grid:null,model:null},init:function(e){this._parent(e),this.options=UWA.extend(this.options,e,!0),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var t=UWA.extend(e,{height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"],useDragAndDrop:!0,allowUnsafeHTMLContent:!1},!0),n=this.options.grid=new i(t);e.onContextualEvent&&(n.onContextualEvent=e.onContextualEvent),this._originalApplyAttributes=n._applyAttributesOnCell.bind(n),n._applyAttributesOnCell=this._applyAttributesOnCell.bind(this),n.getContent().inject(this.elements.container),this.getOption("renderTo")&&!0===e.isActiveView&&this.elements.container.inject(this.getOption("renderTo")),n.onCellsCopy(function(e){s.getCommand("Copy").begin()}),n.onCellsPaste(function(e){s.getCommand("Paste").begin()}),n.onCellsCut(function(e){s.getCommand("Cut").begin()}),UWA.is(n.onCellsEscape,"function")&&n.onCellsEscape(function(e){s.getCommand("Uncut").begin()}),n.selectionBehavior=UWA.extend({enableFeedbackForActiveCell:!0},n.selectionBehavior),n.onPostCellRequest(function(e){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut")})},setModel:function(e){this.options.model=e,this.options.grid.loadGridViewModel(e),this.elements.container.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this.options.grid.layout.invalidate(),null!==e.options.viewport.thumbnails&&void 0!==e.options.viewport.thumbnails&&this.options.grid.setScrollerPosition(e.options.viewport.thumbnails)},unsetModel:function(){this.getScrollerPosition&&(this.options.model.options.viewport.thumbnails=this.getScrollerPosition()),this.getOption("renderTo").removeChild(this.elements.container),this.options.isActiveView=!1,this.options.grid.unloadGridViewModel()},updateView:function(){this.options.grid.layout.invalidate({updateCellContent:!0})},_applyAttributesOnCell:function(e){var t=e;void 0===e.nodeModel&&(t.nodeModel=this.options.grid._getModelAt(e.cellID),t.cellView=this.options.grid._getViewAt(e.cellID)),t.nodeModel.options.isBeingCut?t.cellView.getContent().addClassName("pad-state-is-being-cut"):t.cellView.getContent().removeClassName("pad-state-is-being-cut"),this._originalApplyAttributes(e)}})}),define("DS/ENXNav/utils/xNavKindProcessor",["UWA/Class"],function(e){return e.singleton({loadKinds:function(e,t,n,o,i){t.authorizedWithKind?(t.authorizedWithKind.Product&&t.authorizedWithKind.Product.length>0&&e.add({content:"3DXContent",authorized_objects:t.authorizedWithKind.Product,callback:i,behavior:n,initLoad:!0}),t.authorizedWithKind.Filter&&t.authorizedWithKind.Filter.length>0&&e.addFilter({content:"3DXContent",filter_objects:t.authorizedWithKind.Filter,callback:i,behavior:n,initLoad:!0}),t.authorizedWithKind.Change&&t.authorizedWithKind.Change.length>0&&e.loadChange&&e.loadChange({content:"3DXContent",objects:t.authorizedWithKind.Change,callback:i,behavior:n,initLoad:!0})):e.add({content:"3DXContent",authorized_objects:t.authorized_objects,behavior:n,kindProcessor:!0})}})}),define("DS/ENXNav/commands/RemoveGroupColor",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/RemoveGroupColor",data:{}})}})}),define("DS/ENXNav/commands/view/_xNavSelectSiblings",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,n=t.getSelectedNodes();t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();var o=[],i=[];n.forEach(function(e){var t=e.getParent(),n=JSON.stringify(e.getOccurencePath());o.push(n),t.getChildren().forEach(function(e){var t=JSON.stringify(e.getOccurencePath());-1===o.indexOf(t)&&n!==t&&(i.push(e),o.push(t))})}),t.multiselect(i),t.pushUpdate(),t.pushBroadcastSelect()}}}),define("DS/ENXNav/views/private/externalColumnsViews/cadMaster",["DS/WebappsUtils/WebappsUtils"],function(e){"use strict";const t=new Map,n=["CATIAV5","SOLIDWORKS","NX","CREO","SOLIDEDGE","ALTIUM","INVENTOR","AUTOCAD","CAAUPSAPP","CADENCEALLEGRO","3DEXPERIENCE","EPLAN","SURPAC","CADENCEPULSE","XPEDITIONEDM","ZUKENDSCR"];for(var o=0;o<n.length;o++)t.set(n[o],e.getWebappsAssetUrl("PADServices","icons/cadmasters/I_CADMaster"+n[o]+".png"));return{"ds6w:cadMaster":{getCellTooltip:function(e,t){let n;return n=-1===e.rowID?t.getCellDefaultTooltip(e):{shortHelp:e.nodeModel.getReferenceValue("ds6w:cadMaster"),updateModel:!1}},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:cadMaster",kind:"image",width:40,minWidth:40,editableFlag:!1,typeRepresentation:"image",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellValue:function(e){var n;if(!0!==e.isHeader&&e&&e.nodeModel&&e.nodeModel.options.grid)return e.nodeModel.options.grid["ds6w:cadMaster"]?n=t.get(e.nodeModel.options.grid["ds6w:cadMaster"]):e.nodeModel.isRelationsObjectNode||(n=t.get("3DEXPERIENCE")),n?{iconPath:n,iconSize:{height:"22px"}}:""},getCellValueForExport:function(e){if(-1===e.rowID)return null;var t="";return e&&e.nodeModel&&e.nodeModel.options.grid&&e.nodeModel.options.grid["ds6w:cadMaster"]&&(t=e.nodeModel.options.grid["ds6w:cadMaster"]),t}},e)}}}}),define("DS/ENXNav/views/xNavInitError",["css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options"],function(e,t,n,o,i){"use strict";return o.extend(i,{name:"pad_bigerror",init:function(e){this._parent(e),this.elements.container=UWA.createElement("div",{class:"pad_error_all"}),this.elements.errormsg=UWA.createElement("span",{class:"pad_error_msg"}),this.elements.errormsg.innerHTML=e.msg,this.elements.errormsg.inject(this.elements.container)}})}),define("DS/ENXNav/mixins/EventHooks",["UWA/Class","DS/ApplicationFrame/CommandsManager","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/views/PADProgressBar","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,n,o,i){function s(e){var n=t.getCommand("ExpandAll");n&&(e?n.enable():n.disable())}return e.extend({setupEventHooks:function(e){let t=this;n.subscribe({event:"ENXNav/parser/expandAll/begin"},function(){s(!1),t.beginBlockingTransaction(i.expand.expandPending)}),n.subscribe({event:"ENXNav/parser/expandAll/complete"},function(){s(!0),t.endBlockingTransaction()}),n.subscribe({event:"ENXModel/refresh/begin"},function(){t.beginBlockingTransaction(i.refresh_ongoing)}),n.subscribe({event:"ENXModel/refresh/complete"},function(e){t.endBlockingTransaction(),setTimeout(function(){n.publish({event:"ENXModel/SyncModel",data:{refresh:!0}})},100)}),n.subscribe({event:"ENXModel/Model/ApplyGrouping"},function(e){(e.fromGroupingEvent||e.fromApplyFilter||e.fromLayoutChange)&&t.beginBlockingTransaction(i.groupingNode.applyGrouping)}),n.subscribe({event:"ENXModel/Model/ApplyGrouping/Done"},function(e){e.fromEvent&&t.endBlockingTransaction()})}})}),define("DS/ENXNav/commands/CmdUtils",["DS/PADUtils/PADContext","DS/ApplicationFrame/CommandsManager","DS/PADServices/utils/GlobalModelEvents","DS/etree/syncwidget"],function(e,t,n,o){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this.context=e.get(),this.model=this.context.options.model,this.availabilities={managedCommands:[],selection:{sensitiveToselection:[],monoselection:[],onlyRoot:[],atleastonehidden:[],atleastonevisible:[],lessExpandedThumbs:[],moreExpandedThumbs:[]},notInView:{sensitiveToView:[],dgv:[],graph:[],thumbs:[],tiles:[]},onlyInCtxMenu:[]},this.model.getXSO().onPostAdd(this._checkCommands.bind(this)),this.model.getXSO().onPostRemove(this._checkCommands.bind(this)),this.model.getXSO().onEmpty(this._checkCommands.bind(this)),n.subscribe({event:"ENXModel/HideShowTriggered"},this._checkCommands.bind(this)),this.context.addEvent("onToggleView",this._checkCommands.bind(this)),this)}return i.prototype.checkAvailability=function(){this._checkCommands()},i.prototype.selectionMgt=function(e,t){-1===this.availabilities.managedCommands.indexOf(e)&&this.availabilities.managedCommands.push(e),this.availabilities.selection.sensitiveToselection.push(e),!0===(t=t||{}).monoselection&&this.availabilities.selection.monoselection.push(e),!0===t.onlyRoot&&this.availabilities.selection.onlyRoot.push(e),!0===t.atleastonehidden&&this.availabilities.selection.atleastonehidden.push(e),!0===t.atleastonevisible&&this.availabilities.selection.atleastonevisible.push(e),!0===t.lessExpanded&&this.availabilities.selection.lessExpandedThumbs.push(e),!0===t.moreExpanded&&this.availabilities.selection.moreExpandedThumbs.push(e)},i.prototype.viewMgt=function(e,t){-1===this.availabilities.managedCommands.indexOf(e)&&this.availabilities.managedCommands.push(e),this.availabilities.notInView.sensitiveToView.push(e),!0===(t=t||{}).nodgv&&this.availabilities.notInView.dgv.push(e),!0===t.nograph&&this.availabilities.notInView.graph.push(e),!0===t.nothumbs&&this.availabilities.notInView.thumbs.push(e),!0===t.notiles&&this.availabilities.notInView.tiles.push(e)},i.prototype._checkCommands=function(){for(var e=this.model.getXSO().get(),n=!0,o=!0,i=!0,s=0;s<e.length;s++){var r=!!e[s].options.isPADHidden;e[s].isRoot()||(n=e[s].isRoot()),r?i=!1:o=!1}var a=this.context.getCurrentView();for(s=0;s<this.availabilities.managedCommands.length;s++){var l=this.availabilities.managedCommands[s],d=t.getCommand(l,this.context.action_bar_opts&&this.context.action_bar_opts.context?this.context.action_bar_opts.context:null);d&&this._checkCmdView(l,d,a,n,o,i,e.length)}},i.prototype._checkCmdView=function(e,t,n,o,i,s,r){if(-1!==this.availabilities.notInView.sensitiveToView.indexOf(e))switch(n){case"datagridview":-1===this.availabilities.notInView.dgv.indexOf(e)?this._checkCmdSelection(e,t,o,i,s,r):t.disable();break;case"graphview":-1===this.availabilities.notInView.graph.indexOf(e)?-1!==this.availabilities.selection.lessExpandedThumbs.indexOf(e)||-1!==this.availabilities.selection.moreExpandedThumbs.indexOf(e)?this._checkCmdThumb(e,t,o,i,s,r):this._checkCmdSelection(e,t,o,i,s,r):t.disable();break;case"thumbnailview":-1===this.availabilities.notInView.thumbs.indexOf(e)?this._checkCmdSelection(e,t,o,i,s,r):t.disable();break;case"tileview":-1===this.availabilities.notInView.tiles.indexOf(e)?this._checkCmdSelection(e,t,o,i,s,r):t.disable()}else this._checkCmdSelection(e,t,o,i,s,r)},i.prototype._checkCmdThumb=function(e,t,n,i,s,r){var a=this.model.getXSO().get(),l=function(e,t){for(var n=t.length,i=0,s=0,r=0;r<n;r++){var a=t[r];e.getThumbnailState(a)===o.ThumbnailState.EXPANDED?i++:s++}return i>s}(this.context.options.views.graphview,a);-1===this.availabilities.selection.lessExpandedThumbs.indexOf(e)?l?t.disable():this._checkCmdSelection(e,t,n,i,s,r):-1===this.availabilities.selection.moreExpandedThumbs.indexOf(e)&&(l?this._checkCmdSelection(e,t,n,i,s,r):t.disable())},i.prototype._checkCmdSelection=function(e,t,n,o,i,s){if(-1!==this.availabilities.selection.sensitiveToselection.indexOf(e))if(s)if(!1===n&&-1!==this.availabilities.selection.onlyRoot.indexOf(e))t.disable();else{var r=!0;-1!==this.availabilities.selection.atleastonevisible.indexOf(e)&&(r=!1,!1===o?this._checkCmdVisibility(e,t,o,i):t.disable()),-1!==this.availabilities.selection.atleastonehidden.indexOf(e)&&(r=!1,!1===i?this._checkCmdVisibility(e,t,o,i):t.disable()),r&&(1===s?this._checkCmdVisibility(e,t,o,i):-1===this.availabilities.selection.monoselection.indexOf(e)?this._checkCmdVisibility(e,t,o,i):t.disable())}else t.disable();else this._checkCmdVisibility(e,t,o,i)},i.prototype._checkCmdVisibility=function(e,t,n,o){var i=!0;-1!==this.availabilities.selection.atleastonevisible.indexOf(e)&&(i=!1,!1===n?t.enable():t.disable()),-1!==this.availabilities.selection.atleastonehidden.indexOf(e)&&(i=!1,!1===o?t.enable():t.disable()),i&&t.enable()},new i}),define("DS/ENXNav/commands/_xNavSwitchView",[],function(){"use strict";return{execute:function(e){e.xnav_app.toggleView(e.command_id)}}}),define("DS/ENXNav/commands/view/_xNavSelectChildren",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,n=t.getSelectedNodes();require(["DS/ENXNav/commands/view/_xNavSelectCmdsUtils"],function(e){var o=e._filterParentsOnly(n);t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();var i=[];o.forEach(function(e){i.push(e),e.processDescendants({processNode:function(){i.push(this)}})}),t.multiselect(i),t.pushUpdate(),t.pushBroadcastSelect()})}}}),define("DS/ENXNav/utils/OpenWithMenuBuilder",["DS/i3DXCompassPlatformServices/OpenWith","UWA/Promise","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/PADTrackerManager"],function(e,t,n,o){function i(){}var s;return i.prototype={openWithApps:function(i,s){return new t(function(t,r){n.contentOpenWith(i,function(n){var i=new e;i.set3DXContent(n,!0),UWA.is(i.retrieveCompatibleApps,"function")?i.retrieveCompatibleApps(function(e){var n=[],i=[];if(e.forEach(function(e){i.push({type:"PushItem",title:e.text,fonticon:e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:e.icon?e.icon:"",action:{callback:function(){var t=o.getPADTracker({eventCategory:"usage",eventAction:"command-2D"});t?(t.setEventData({eventLabel:"Ctx-openWith-"+e.name}),t.trackPageEvent()):console.warn("tracker not defined"),e.handler()}}})}),i.length>0){var r={type:"PushItem",icon:s.iconOpenWith,title:s.nlsOpenWith,submenu:i};n.push(r),n.push({type:"SeparatorItem"})}t(n)}):t([])})})}},s||(s=new i),s}),define("DS/ENXNav/commands/GroupsLayoutPath",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/GroupsLayout",data:{mode:"structured"}})}})}),define("DS/ENXNav/utils/TwoDAppEvents",["DS/PADServices/utils/GlobalModelEvents"],function(e){const t="ENX2DApp/Model/Expand",n="ENX2DApp/Model/addRoot",o="ENX2DApp/Model/addChild",i="ENX2DApp/Model/removeRoot",s="ENX2DApp/View/clearSort",r="ENX2DApp/View/refresh",a="ENXViews/WelcomePanel/closeLandingPage";function l(){}let d;return l.prototype={expand:function(n){e.publish({event:t,data:n})},addRoot:function(t){e.publish({event:n,data:t})},addChild:function(t){e.publish({event:o,data:t})},removeRoot:function(t){e.publish({event:i,data:t})},clearSort:function(t){e.publish({event:s,data:t})},refresh:function(t){e.publish({event:r,data:t})},onClearSort:function(t){e.subscribe({event:s},t)},onExpand:function(n){e.subscribe({event:t},n)},onAddRoot:function(t){e.subscribe({event:n},t)},onAddChild:function(t){e.subscribe({event:o},t)},onRemoveRoot:function(t){e.subscribe({event:i},t)},onRefresh:function(t){e.subscribe({event:r},t)},onLandingPageClosed:function(t){e.subscribe({event:a},t)}},d||(d=new l),d}),define("DS/ENXNav/commands/ColorizeGroup",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/ColorizeGroup",data:{}})}})}),define("DS/ENXNav/utils/OFW",["UWA/Core","DS/PADServices/utils/Iterator","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/PADServices/settings/AppSettings","DS/i3DXCompassServices/i3DXCompassPubSub","DS/PADServices/ws/WSAccess","DS/ENOXParser/modules/TwoDParser"],function(e,t,n,o,i,s,r,a){const l={version:"2.2",results:[],structures:[],viewpoint:[]},d="resetTypes",c="setTypes",u="setTypesCallback",p="setObject",h="launchApp",g="launchAppCallback";var f,v=!1;var m,b=0;function _(e,t,n){let o=e.search({match:function(e){let o=e.nodeModel.options;return n?o.relationid===t:o.resourceid===t},shouldStop:function(){return!1},useTransaction:!1});if(o.length)return o[0]}function D(e,n,o,i,s){b++,i.id=""+b;let r=!1,a=!0,l=i.resourceid;if(i.isInstance){l=i.relationid;let e=_(o,l,!0);e&&(a=!e.options.isPADHidden)}else{let e=_(o,l,!1);e&&(r=e.isSelected(),a=!e.options.isPADHidden)}var d={id:i.id,phid:l,CADOrigin:i.grid["ds6w:cadMaster"]?i.grid["ds6w:cadMaster"]:i.grid["ds6w:cadmaster"]},c={id:i.id,show:a,select:r,children:[]};if(s)n.results.push(d),s.children.push(c);else{n.results.push(d);var u={structure:[c]};n.structures.push(u)}i.children&&t.iterate(i.children,function(t){D(e,n,o,t,c)})}function S(e,t,n,o){b++,e.id=""+b;let i=e.resourceid;var s={id:e.id,phid:i,CADOrigin:"3DEXPERIENCE"};let r=t.getNodeByOccurencePath(n);if(!r&&o){let e=t.getNodesById(n[0]);for(let t=0;t<e.length&&!r;t++)!0===e[t].isRelationsObjectNode&&(r=e[t])}let a=!1,l=!0;if(r){(function(e,t){if(e instanceof Array&&t instanceof Array){var n=e.length;if(n===t.length){for(var o=0;o<n;o++)if(e[o]!==t[o])return!1;return!0}return!1}return!1}(r.getOccurencePath(),n)||o)&&(s.CADOrigin=r.options.grid["ds6w:cadMaster"],e.isEndOfPath&&(a=r.isSelected()),l=!r.options.isPADHidden)}return{entry:s,struct:{id:e.id,show:l,select:a,children:[]}}}function x(){}return x.prototype={setTypesForOFW:function(e){if(!v){var t=this;s.subscribe(u,function(o){if(o.widgetId===n.getWidgetId()){var i=e.getSelectedNodesForOFW();if(i.length){var r,a;try{var l=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");r=l.get()}catch(e){console.warn("CfgAuthoringContext throw an error")}if("MAP-CATCDVEAP"===o.appId&&1===i.length&&i[0].relatedCADDocs&&(a=i[0].relatedCADDocs.getSelectedNodes()),!t._checkDirectOpen(o,i,a,r)){let n=Promise.resolve();if("function"==typeof e.isGroupingApplied&&e.isGroupingApplied()){let t=[];for(let e=0;e<i.length;e++)!0===i[e].isGroupingNode&&t.push(i[e]);t.length&&(n=new Promise(t=>{e.focusOnGroups().then(()=>{let n=e.getSelectedNodesForOFW();i=[];for(let e=0;e<n.length;e++)!0!==n[e].isGroupingNode&&i.push(n[e]);t()})}))}n.then(function(){var n="SWXCSWK_AP"!==o.appId&&"ENOUSWC_AP"!==o.appId;t.buildDataForSetTypes(i,e,n).then(function(n){e._getLastViewpoint(function(i){i.success&&n.viewpoint.push(i.viewpoint),r&&(n.workUnder=r),"function"==typeof e.isGroupingApplied&&e.isGroupingApplied()&&(n.grouping=e.getGroupingForOpen()),a&&t._appendCADDocs(n,a);var l=JSON.stringify(n),d={appId:o.appId,widgetId:o.widgetId,fileName:"-file",fileContent:l};s.publish(h,d)})})})}}else{s.publish(d);var u={appId:o.appId,widgetId:o.widgetId};s.publish(h,u,function(e){s.publish(c,f)})}}}),v=!0}f||(f={widgetId:n.getWidgetId()}),s.publish(c,f)},buildDataForSetTypes:function(n,o,i){i=void 0===i||i;var s=e.clone(l);return new Promise(function(e,r){let l={};if(t.iterate(n,function(e){var t=e.getRoot().getID();l[t]||(l[t]={paths:[],isFiltered:!1}),!0===e.isRelationsObjectNode?(l[e.options.resourceid]||(l[e.options.resourceid]={paths:[],isFiltered:!1}),l[e.options.resourceid].paths.push([e.options.resourceid]),l[e.options.resourceid].isRelationsObjectNode=!0,i=!1):l[t].paths.push(e.getOccurencePath())}),i){var d=[];let t=Object.keys(l);for(var c=0;c<t.length;c++)d=d.concat(l[t[c]].paths);b=0,(u=d,p=t,h=o,new Promise(function(e,t){let n={pathIds:u,data:{expandLevel:"-1"},FBIProxy:h.options.FBIProxy,timeout:3e4};h._getExpandFunc(h._getAuthoringFlag())(n).then(function(t){let n="string"==typeof t?JSON.parse(t):t;a.ofwPrep({wsResponse:n,expandLevel:-1,rootIds:p}).then(function(t){e(t)})}).catch(t)})).then(function(t){for(let e=0;e<t.length;e++)D(n,s,o,t[e]);e(s)})}else{let n={};t.iterateObj(l,function(e,i){let r,a=e.paths,l=e.isRelationsObjectNode;t.iterate(a,function(e){let i=e.length-1;t.iterate(e,function(t,a){let d=n[t];void 0===d&&(d=S({resourceid:t,isEndOfPath:a===i},o,e,l),s.results.push(d.entry),n[t]=d),r?r.children.push(d.struct):s.structures.push({structure:[d.struct]}),r=d.struct})})}),e(s)}var u,p,h})},_checkDirectOpen:function(t,r,a,l){if((!a||0===a.length)&&"MAP-CATCDVEAP"===t.appId&&1===r.length&&r[0].isRoot()&&!r[0].options.filtered&&(!e.is(l)||""===l.change.id)&&!0===i.getSetting("directOpenPCS")){var d={objectId:r[0].getID(),envId:o.getPlatformId(),contextId:n.getSecurityContext(),serviceId:"3DSpace"};s.publish(p,d),s.subscribe(g,function(e){e.appId===t.appId&&e.widgetId===t.widgetId&&s.publish(p,{objectId:"",envId:o.getPlatformId(),contextId:"",serviceId:"3DSpace"})});var u={appId:t.appId,widgetId:t.widgetId};return s.publish(h,u,function(e){s.publish(c,f)}),!0}return!1},_appendCADDocs:function(e,t){let n,o,i;for(o=(new Date).valueOf(),n=0;n<t.length;n++)"XCADNonPSBaseRepReference"!==t[n].options.type&&"Drawing"!==t[n].options.type||(o++,i=""+t[n].options.physicalid,e.results.push({id:""+o,phid:i}),e.structures.push({structure:[]}),e.structures[e.structures.length-1].structure.push({id:""+o,show:!0,select:!1,children:[]}))}},m||(m=new x),m}),define("DS/ENXNav/utils/xNavCustoStorageOptim",["UWA/Core","DS/PADUtils/PADSettingsMgt"],function(e,t){"use strict";var n={dataIndex:void 0,text:void 0,isDraggable:!0,width:150,minWidth:10,maxWidth:999,visibleFlag:!0,isHidden:!1,isSortable:void 0,type:void 0,isAdditionalColumn:void 0,xnav_options:{name:void 0,dataIndex:void 0,tree:void 0,hardcoded:void 0,exportable:{lock:!1,value:!0},layout:{removable:void 0,hidden:void 0,width:150,minWidth:void 0,maxWidth:void 0},kind:void 0}},o={dataIndex:void 0,text:void 0,isDraggable:!0,width:150,minWidth:10,maxWidth:999,visibleFlag:void 0,sortableFlag:void 0,pinned:void 0,kind:void 0,isAdditionalColumn:void 0,customisation:{layout:{width:200,minWidth:100,maxWidth:300,removable:!0,pinEditable:!0},exportable:{lock:!1,value:!0},titleModified:void 0}};function i(e,t){var n={};if(void 0===t)n=e;else for(var o=Object.getOwnPropertyNames(e),s=0;s<o.length;s++)if(UWA.is(e[o[s]],"object")){var r=i(e[o[s]],t[o[s]]);Object.getOwnPropertyNames(r).length>0&&(n[o[s]]=r)}else e[o[s]]!==t[o[s]]&&"text"!==o[s]&&"label"!==o[s]&&(n[o[s]]=e[o[s]]);return n}function s(e,t,n){var o={};if(void 0===e)o=t;else{for(var i=Object.getOwnPropertyNames(t),r=Object.getOwnPropertyNames(e),a=0;a<i.length;a++)if(UWA.is(t[i[a]],"object")){if("bi_color"!==n){var l=s(e[i[a]],t[i[a]],n);Object.getOwnPropertyNames(l).length>0&&(o[i[a]]=l)}}else void 0===e[i[a]]?o[i[a]]=t[i[a]]:o[i[a]]=e[i[a]];for(var d=0;d<r.length;d++)void 0===o[r[d]]&&(o[r[d]]=e[r[d]])}return o}return{convertCusto4Preference:function(e,s,r){var a={custoOptimized:!0,viewMode:e.viewMode,defaultCellHeight:e.defaultCellHeight,rowsHeader:e.rowsHeader,selectedTypes:e.selectedTypes,selectedExtensions:e.selectedExtensions,columnsOptimized:[],lang:t.getSetting("lang")};"treelistview"===r?a.custoFromTree=!0:"datagridview"===r&&(a.custoFromDGV=!0);for(var l=0;l<e.columns.length;l++){var d=e.columns[l],c=n;if("datagridview"===r&&(c=o),"ContextualMenuColumn"!==d.dataIndex){var u=i(d,c);s&&s[d.dataIndex]&&(u.text=d.text),a.columnsOptimized.push(u)}else a.ctxMenuColumn={pinned:d.pinned,columnIdx:d.columnIdx,visibleFlag:d.visibleFlag}}return a},convertPreference2Custo:function(i,r){var a={viewMode:i.viewMode,defaultCellHeight:i.defaultCellHeight,rowsHeader:i.rowsHeader,selectedTypes:i.selectedTypes,selectedExtensions:i.selectedExtensions,columns:[],ctxMenuColumn:i.ctxMenuColumn};i.custoFromTree||"treelistview"===r?a.custoFromTree=!0:"datagridview"===r&&(a.custoFromDGV=!0),i.lang&&i.lang!==t.getSetting("lang")&&function(e){for(var t=0;t<e.columnsOptimized.length;t++){var n=e.columnsOptimized[t];n.xnav_options&&n.xnav_options.titleModified&&(delete n.text,delete n.xnav_options.titleModified)}}(i);for(var l=0;l<i.columnsOptimized.length;l++){var d=i.columnsOptimized[l],c=n;"datagridview"===r&&(c=o);var u=s(d,e.clone(c),d.dataIndex);u.typeRepresentation&&u.typeRepresentation.startsWith("enum")&&delete u.typeRepresentation,a.columns.push(u)}let p=a.columns.map(function(e){return e.dataIndex});if(p.filter(function(e,t,n){return n.indexOf(e)===t}).length!==p.length){let e={},t=a.columns.reduce(function(t,n){let o=n.dataIndex;return e[o]||(e[o]=!0,t=t.concat(n)),t},[]);a.columns=t}return a}}}),define("DS/ENXNav/commands/view/_xNavRootInfoPanel",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalModelEvents"],function(e,t,n,o){"use strict";return t.extend({_context:null,_callbackAdd:!1,init:function(e){this._parent(e,{}),this._context=n.get(),this._change_state_from_close=!1;var t=this;t._context.elements.padshell&&t._context.elements.padshell._modelEvents&&t.addCallback(),t=this,this.onStateChange(function(){t._change_state_from_close?t._change_state_from_close=!1:t._context.togglePanel("left")})},addCallback:function(){var e=this;!1===this._callbackAdd&&(this._context.elements.padshell._modelEvents.subscribe({event:"triptych-hide-panel"},function(t){"left"===t&&(e._change_state_from_close=!0,e.setState(!1,!1))}),o.subscribe({event:"ENXViews/Triptych/onOverlayClick"},function(t){t&&"left"===t&&!0===e.getState()&&(e._change_state_from_close=!0,e.toggleState(!1,!1))}),e._callbackAdd=!0)}})}),define("DS/ENXNav/commands/tools/_xNavRelationIPExplorer",[],function(){"use strict";return{execute:function(e){require(["DS/PADUtils/PADUtilsServices","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(t,n){t.setObject_on_compass({nodes_2_open:e.xnav_app.options.model.getSelectedNodes()}),t.launchApp({appId:"ENORIPE_AP",widgetId:t.getWidgetId()})})}}}),define("DS/ENXNav/commands/view/_xNavCleanAll",[],function(){"use strict";return{execute:function(e){e.xnav_app.empty()}}}),define("DS/ENXNav/views/customize_views/commands",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADServices/utils/HideShowController","DS/PADServices/views/ENXModal","DS/Controls/Button","DS/Utilities/Dom","DS/PADServices/utils/GlobalUtils"],function(e,t,n,o,i,s,r){"use strict";return{getTypeRepresentation:function(){return{findInCtx:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"find dgv-find",fontIconFamily:1}}}}},hide_show:{getCellTooltip:function(e){let o={shortHelp:t.columnsDef.hide_show,updateModel:!1};-1!==e.rowID&&(o=n.determineTooltip(e.nodeModel,t),!0===require("DS/PADUtils/PADSettingsMgt").getSetting("DebugPGPFromServer")&&(o.allowUnsafeHTMLShortHelp=!0,o.shortHelp+="<br>",o.shortHelp+="Status from server:["+e.nodeModel.options.hsStatusOn+"]<br>","none"!==e.nodeModel.options.hsStatusOn&&void 0!==e.nodeModel.options.hsStatusOn&&(o.shortHelp+="Hide Server reference status:["+e.nodeModel.options.isPADHiddenBackEndReference+"]<br>",o.shortHelp+="Hide Server instance status:["+e.nodeModel.options.isPADHiddenBackEndInstance+"]<br>",o.shortHelp+="Hide Server occurence status:["+e.nodeModel.options.isPADHiddenBackEndOcc+"]<br>")));return o},buildColumn:function(e){return Object.assign({dataIndex:"hide_show",kind:"functionIcon",width:50,minWidth:50,editableFlag:!1,typeRepresentation:"functionIcon",alignment:"center",customisation:{exportable:{lock:!0,value:!1}},getCellSemantics:function(e){return n.determineIcon(e.nodeModel)}},e)},actionOnClick:function(e,t){var o=e.nodeModel;void 0!==o.options.isPADHidden&&!0===o.options.isPADHidden||o.options.isHiddenState===n.STATES.HIDDEN?t.onShow({paths:[o.getOccurencePath()],fromUI:!0}):t.onHide({paths:[o.getOccurencePath()],fromUI:!0})}},findinctx:{getCellTooltip:function(e){return{shortHelp:t.columnsDef.find,updateModel:!1}},buildColumn:function(e){return Object.assign({dataIndex:"findinctx",kind:"findInCtx",width:50,minWidth:50,editableFlag:!1,typeRepresentation:"findInCtx",alignment:"center",customisation:{exportable:{lock:!0,value:!1}}},e)},actionOnClick:function(e,t){require(["DS/ApplicationFrame/CommandsManager"],function(t){var n=e.cellView.getContent().getBoundingClientRect(),o=t.getCommand("FindCmd",null);o&&(n&&(o.options.position=n),o.options.fromCtx=!0,o.begin())})}},thumbnail:{getCellTooltip:function(e){let n=null;return n=-1===e.rowID?{shortHelp:t.columnsDef.thumbnail,updateModel:!1}:{title:t.columnsDef.thumbnail,shortHelpImage:e.nodeModel.getReferenceValue("thumbnail"),shortHelpImageDimension:{x:120,y:100}}},buildColumn:function(e){return Object.assign(e,{dataIndex:"thumbnail",kind:"image",width:50,minWidth:50,editableFlag:!1,typeRepresentation:"image",alignment:"center",hasNLS:!1,noTitleColumn:!0,customisation:{exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!1}}})},actionOnClick:function(e,n){if(e.nodeModel){let n=e.nodeModel.getReferenceValue("thumbnail");if(void 0!==n){let a=s.createElement("div",{class:"enx-thumbnail-pop-up"});a.style.backgroundImage="url('"+n+"')";let l=document.querySelector(".enx-appMainBody"),d=e.cellView.getContent().getBoundingClientRect(),c={of:l,my:"top left",at:"top left",offsetX:d.x,offsetY:d.y};var r=new o({target:l,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!0,title:t.columnsDef.thumbnail,titleBarVisibleFlag:!0,width:"auto",height:"auto",content:a,position:c,buttons:{Close:new i({onClick:function(){r.close()}})},events:{onClickOutsideContent:function(){r.close()}}})}}}}}}),define("DS/ENXNav/models/SmartNodeOptions",["DS/PADServices/utils/Iterator","DS/PADServices/utils/NlsCache"],function(e,t){const n=["label","display","type","icons","relcount","thumbnail","isPADHidden","isHiddenState","grid","padgrid","ensureNLS"];var o=new Map([["label","value"],["display","value"],["type","value"],["relcount","value"],["thumbnail","value"],["isPADHidden","value"],["isHiddenState","value"],["grid","object"],["padgrid","object"],["icons","array"],["ensureNLS","value"]]);var i=new Map([["array",function(e,t){return function(e,t){if(e instanceof Array&&t instanceof Array){var n=e.length;if(n===t.length){for(var o=0;o<n;o++)if(typeof e[o]!=typeof t[o]&&"object"==typeof e[o]){if(void 0!==e[o]&&void 0!==t[o]&&e[o].iconPath!==t[o].iconPath)return!1}else if(e[o]!==t[o])return!1;return!0}return!1}return!1}(e,t)?{change:!0,value:t}:{change:!1}}],["value",function(e,t){return e!==t?{change:!0,value:t}:{change:!1}}],["object",function(n,o){let i=!1;if(!n&&!o)return!1;if(n&&!o)return!1;let s={};return e.iterateObj(o,function(e,o){let r=n[o];if(r){if(e!==r){let n=t.hasChange(o,r,e);n.found?n.hasChange&&(i||(i=!0),s[o]=e):(i||(i=!0),s[o]=e)}}else i||(i=!0),s[o]=e}),{change:i,value:s}}]]);function s(e){this.node=e}return s.prototype={update:function(t){if(!t)return void console.error("You passed NULL");let s=this.node.options,r={},a=!1,l=0,d=!1;e.iterateObj(s,function(e,s){if(-1!==n.indexOf(s)){let n=function(e,t,n){let s=o.get(e);return i.get(s)(t,n)}(s,e,t[s]);if(n.change){r[s]=n.value;let e=r[s];null==e||"thumbnail"===s&&0===e.length?delete r[s]:("ensureNLS"===s&&(a=!0),d=!0,l++)}}}),d&&(this.doUpdate=d,this.specifics=r,a&&1===l&&(this.doUpdate=!1))},execute:function(){this.doUpdate&&this.node.updateOptions(this.specifics)}},s}),define("DS/ENXNav/views/private/LevelSelector",["i18n!DS/ENXNav/assets/nls/ENXNav","UWA/Core","DS/Utilities/Utils","DS/Controls/Abstract","DS/Controls/SpinBox","DS/Core/PointerEvents","DS/Utilities/Dom"],function(e,t,n,o,i,s,r){"use strict";return o.inherit({name:"LevelSelector",markForRecordFlag:!0,publishedProperties:{expandLevel:{defaultValue:"1",type:"string",category:"Appearance"},onLevelSelectorSet:{defaultValue:void 0,type:"function"},onLevelSelectorClose:{defaultValue:void 0,type:"function"}},buildView:function(){var n=this;this.elements.container.addClassName("enx-controls-levelselector"),this.elements.levelSelContainer=new t.Element("div",{class:"enx-controls-levelselector-container"}).inject(this.elements.container),this.elements.spinBox=new i({value:1,minValue:1,stepValue:1,pageStepValue:1,typingFilter:!0,decimals:0}).inject(this.elements.levelSelContainer),this.elements.spinBox.getContent().addClassName("enx-controls-levelselector-spinbox"),r.addEventOnElement(this,this.elements.spinBox.getContent(),"keydown",function(e){var o=t.Event.whichKey(e);"return"===o?n._levelSelected():"esc"===o&&n.close()}),this.elements.separator=new t.Element("div",{class:"enx-controls-levelselector-separator",html:"|"}).inject(this.elements.levelSelContainer),this.elements.checkSelBtn=new t.Element("div",{class:"enx-controls-levelselector-checkSel-btn",title:e.levelselector.checkLevel}).inject(this.elements.levelSelContainer),r.generateIcon("check",{target:this.elements.checkSelBtn}),r.addEventOnElement(this,this.elements.checkSelBtn,s.POINTERHIT,function(e){n._levelSelected(),e.stopPropagation()})},close:function(){this.visibleFlag=!1,this.onLevelSelectorClose&&this.onLevelSelectorClose()},_levelSelected:function(){var e=this.elements.spinBox.value;this.onLevelSelectorSet&&this.onLevelSelectorSet(e)}})}),define("DS/ENXNav/commands/view/_xNavSelectParent",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,n=t.getSelectedNodes();if(n.length){t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();var o=[];n.forEach(function(e){var t=e.getParent();t.options._isTrueRoot||o.push(t)}),t.multiselect(o),t.pushUpdate(),t.pushBroadcastSelect()}}}}),define("DS/ENXNav/views/private/Search",["i18n!DS/ENXNav/assets/nls/ENXNav","UWA/Core","DS/Utilities/Utils","DS/Controls/Abstract","DS/Controls/LineEditor","DS/Core/PointerEvents","DS/Utilities/Dom"],function(e,t,n,o,i,s,r){"use strict";return o.inherit({name:"Search",markForRecordFlag:!0,publishedProperties:{findStr:{defaultValue:"",type:"string",category:"Appearance"},disableSelectProxy:{defaultValue:!1,type:"boolean"},onSearchRequest:{defaultValue:void 0,type:"function"},onSearchIdRequest:{defaultValue:void 0,type:"function"},onSearchClose:{defaultValue:void 0,type:"function"},placeholder:{defaultValue:"",type:"string",category:"Appearance"}},buildView:function(){var n=this;this.elements.container.addClassName("enx-controls-search"),this.elements.findContainer=new t.Element("div",{class:"enx-controls-search-container"}).inject(this.elements.container),this.elements.findEditor=new i({selectAllOnFocus:!0,sizeInCharNumber:22,displayClearFieldButtonFlag:!0,displayStyle:"lite"}).inject(this.elements.findContainer),this.elements.findEditor.getContent().addClassName("enx-controls-search-editor"),r.addEventOnElement(this,this.elements.findEditor.getContent(),"keydown",function(e){var o=t.Event.whichKey(e);"return"===o?n.elements.findEditor.valueToCommit===n.findStr&&n._launchSearch():"esc"===o&&n.elements.findEditor.valueToCommit===n.findStr&&n.close()}),this.elements.separator=new t.Element("div",{class:"enx-controls-search-separator",html:"|"}).inject(this.elements.findContainer),this.elements.checkSelBtn=new t.Element("div",{class:"enx-controls-checkSel-btn",title:e.searchview.check}).inject(this.elements.findContainer),r.generateIcon("check",{target:this.elements.checkSelBtn}),this.elements.checkSelBtn.setAttributeNode(document.createAttribute("disabled")),this._applySelectProxy(this.disableSelectProxy),this.elements.searchBtn=new t.Element("div",{class:"enx-controls-search-btn",title:e.searchview.searchBtn}).inject(this.elements.findContainer),r.generateIcon("search-filter",{target:this.elements.searchBtn}),this.elements.searchBtn.setAttributeNode(document.createAttribute("disabled"))},_launchSearch:function(e,t){var o=this;this.findStr=this.elements.findEditor.valueToCommit;var i=function(){o.onSearchRequest&&o.onSearchRequest(o.findStr,o.matchCase,e)},s=n.debounce(i,500);t?s():i()},_launchSearchId:function(){this.onSearchIdRequest&&this.rscIdToSearch&&(this.onSearchIdRequest(this.rscIdToSearch),delete this.rscIdToSearch)},_applyProperties:function(e){this._parent(e),this.isDirty("placeholder")&&this._applyPlaceholder(e.placeholder),this.isDirty("disableSelectProxy")&&this._applySelectProxy(e.disableSelectProxy)},_applySelectProxy:function(){if(this.disableSelectProxy)this._cmdProxy&&(this._cmdProxy.destroy(),this._cmdProxy=null),this.elements.checkSelBtn.style.display="none";else{var t=this;require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADTypesMgt"],function(n,o){this._cmdProxy=n.create({events:{onSelect:function(i,s){var r=function(n){function i(e){t.rscIdToSearch=e.rscId,t.elements.findEditor.value=e["ds6w:label"],t.elements.checkSelBtn.removeAttribute("disabled")}if(1===n.paths.length){var s=n.paths[0],r=s[s.length-1],a=[];a.push({type:n.attributes[r].type}),o.isTypesAuthorized(a,function(o){if(o.length>0){var s={rscId:r,"ds6w:type":n.attributes[r].type,"ds6w:label":n.attributes[r].label};void 0===s["ds6w:label"]?(t.elements.findEditor.value=e.searchview.loadingLabel,t.loadingInProgress=!0,require(["DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/ParserUtils","DS/PADServices/utils/GlobalUtils"],function(n,o,r,a){(n.fetch?Promise.resolve():o.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0})).then(function(){var o={pids:[s.rscId],data:{select_predicate:["ds6w:label","ds6w:type"],select_file:[]}};n.fetch(o).then(function(n){var o="string"==typeof n?JSON.parse(n):n;if(o.results&&1===o.results.length){var l=o.results[0],d=r.parseAttributes(l.attributes);s["ds6w:label"]=d.label,delete t.loadingInProgress,i(s)}else a.displayNotif({message:e.searchview.cannotRetrieveLabel,level:"error",key:"Search-cannotRetrieveLabel"})}).catch(function(){a.displayNotif({message:e.searchview.cannotRetrieveLabel,level:"error",key:"Search-cannotRetrieveLabel"})})})})):i(s)}})}else t.rscIdToSearch="",t.elements.findEditor.value=""};s.appid!==n.appId()&&(t.timeoutSelect?(clearTimeout(t.timeoutSelect),t.timeoutSelect=setTimeout(function(){r(i),delete t.timeoutSelect},200)):t.timeoutSelect=setTimeout(function(){r(i)},200))}}}),this.elements.checkSelBtn.style.display=""}.bind(this))}},_applyFindStr:function(e){this.findStr!==e&&(this.elements.findEditor.valueToCommit!==this.findStr&&(this.elements.findEditor.value=this.findStr),this.findStr.length&&!0!==this.loadingInProgress?this.elements.searchBtn.removeAttribute("disabled"):(this.elements.searchBtn.setAttributeNode(document.createAttribute("disabled")),this.elements.checkSelBtn.setAttributeNode(document.createAttribute("disabled"))))},_applyPlaceholder:function(){this.elements.findEditor&&(this.elements.findEditor.placeholder=this.placeholder)},handleEvents:function(){var e=this;r.addEventOnElement(this,this.elements.findEditor,"uncommittedChange",function(t){e.findStr=e.elements.findEditor.valueToCommit}),r.addEventOnElement(this,this.elements.checkSelBtn,s.POINTERHIT,function(t){e._launchSearchId(),t.stopPropagation()}),r.addEventOnElement(this,this.elements.searchBtn,s.POINTERHIT,function(t){e._launchSearch(),t.stopPropagation()}),r.addEventOnElement(this,this.elements.findContainer,s.POINTERHIT,function(t){e._giveFocus()})},setCurrentValue:function(e){this.currentValue=e},close:function(){this.visibleFlag=!1,this.onSearchClose&&this.onSearchClose()},focus:function(){this._giveFocus()},_giveFocus:function(){this._parent(),this.elements.findEditor&&document.activeElement!==this.elements.findEditor._myInput&&this.elements.findEditor._giveFocus()}})}),define("DS/ENXNav/commands/FilterDropObjects",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt"],function(e,t,n,o){"use strict";return e.extend({execute:function(e,i){var s=t.get(),r=s.options.model?s.options.model:s.getPADTreeDocument(),a=!(!i||!i.fromWP)&&i.fromWP,l=!(!i||!i.fromProxy)&&i.fromProxy,d=!a&&!l,c=e.biProxyCtx;require(["DS/PADUtils/PADTypesMgt","DS/PADUtils/views/PADAlert","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/PADSession"],function(t,u,p,h){t.retrieveAuthorizedObjects({notifPerObjects:!0,displayNotif:!1,unserializedData:e,callback:function(e){var t=e.authorizedWithKind.Product?e.authorizedWithKind.Product.length:0;if(t+=e.authorizedWithKind.Filter?e.authorizedWithKind.Filter.length:0,(0!==e.authorized_objects.length||0!==t)&&0!==t){var g=r.getRoots();n.multiTenantMgt(e.authorized_objects,g,function(t){if(t.isMultiTenant)t.isMultiTenant&&t.invalidTenant;else{var n="WITHOUT_CONTEXT";i&&i.behavior&&(n=i.behavior);var r=[];e.authorizedWithKind&&(e.authorizedWithKind.Product&&e.authorizedWithKind.Product.length>0&&(1===e.authorized_objects.length?r.push(new Promise(function(t){s.add({content:"3DXContent",authorized_objects:e.authorizedWithKind.Product,loadWithFilter:1===e.authorizedWithKind.Product.length,biProxyCtx:c,dropOnFilter:!0,callback:function(n){if(h.isAuthoring())s.disableFilterWaiting(),u.displayNotification({msg:p.filterInAuthoring,eventID:"warning",key:"enxNav-filterInAuthoring"}),t();else if("error"!==n)if(!0!==l)if(1===e.authorized_objects.length){var o=e.authorizedWithKind.Product[0].objectId;require(["DS/ApplicationFrame/CommandsManager"],function(e){var n=e.getCommand("DefineFilter");n&&(n.setOpenFilterNow(o),n.begin(),s._filterRootIds=[o],s._filterPanelOpen=!0),t()})}else t();else!0===l&&(s._filterRootIds=[o],s._filterPanelOpen=!0);else s.disableFilterWaiting(),t()},behavior:n,broadcast:d})})):r.push(new Promise(function(t){s.add({content:"3DXContent",authorized_objects:e.authorizedWithKind.Product,biProxyCtx:c,callback:function(){t()},behavior:n,broadcast:d,fromWP:a})}))),e.authorizedWithKind.Filter&&e.authorizedWithKind.Filter.length>0)&&(n=1===e.authorizedWithKind.Filter.length?"fromDropOnFilter":void 0,(e.authorizedWithKind.Filter.length>1||e.authorized_objects.length>1)&&(n="fromDrop"),r.push(new Promise(function(t){s.addFilter({content:"3DXContent",filter_objects:e.authorizedWithKind.Filter,callback:t,behavior:n,broadcast:d,fromWP:a,fromProxy:l})}))),Promise.all(r).then(function(){o.getSetting("welcomeonempty")&&require("DS/PADServices/utils/GlobalModelEvents").getModelEvents().publish({event:"ENXViews/WelcomePanel/closeLandingPage"})})}})}},version:"2.0"})})}})}),define("DS/ENXNav/commands/tools/xNavFilterCmds",["DS/ENONextGenFilterCmd/commands/ENONextGenFilterCmd","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADContext","DS/PADUtils/PADSession","DS/ENOXInterWdgCom/LinkManager"],function(e,t,n,o,i,s){"use strict";return n.getSetting("activateFUN087933")?e.extend({_openFilterPanelNow:!1,_selectionId:-1,init:function(e){this._parent(e);var t=this;o.get().getPADTreeDocument().getModelEvents().subscribe({event:"onRemoveRoot"},function(e){o.get()._biFilter&&!s.isWidgetSynchronizing()&&o.get()._biFilter.removeRoot(e.data.pid),0===o.get().getPADTreeDocument().getRoots().length&&t.disable()}),o.get().getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},function(e){t.enable()}),i.subscribe({event:"authoringStateModified"},function(e){t.hasSelection()&&!e.authored?t.enable():t.disable()})},setOpenFilterNow:function(e){this._openFilterPanelNow=!0,this._selectionId=e},hasSelection:function(){var e=this.getSelection();return!!(e&&e.path.length>0)},getAppParams:function(){let e,o=t.getWidgetId();return{widgetId:o,NGFUXId:e=n.getSetting("activateWidgetLink")?s.getSourceWidgetId()?s.getSourceWidgetId():o:t.getSharedId(),appId:t.getAppId(),shareFilterSpec:!0}},getSelectorManager:function(){return o.get().getPADTreeDocument().getXSO()||null},getRoots:function(){if(!1!==this._openFilterPanelNow){this._openFilterPanelNow=!1;var e=[],t=o.get().options.model.getNodesById(this._selectionId)[0],n={};return t.isRoot()?n=t:(n=t.getRoot()).select(),e.push({id:n.getID(),label:n.getLabel(),filtered:n.options.sequence_filter||n.options.config_filter?1:0}),e}return o.get().getPADTreeDocument().getRoots().map(function(e){return{id:e.getID(),label:e.getLabel(),filtered:e.options.sequence_filter||e.options.config_filter?1:0,revision:e.getReferenceValue("ds6wg:revision")}})},getSelection:function(){var e={path:[],label:[],revision:[],directSelection:o.get().getPADTreeDocument().isDirectSelection()};return o.get().getPADTreeDocument().getSelectedNodes().forEach(function(t){e.path.push(t.getOccurencePath()),e.label.push([t.getLabel()]),e.revision.push([t.getReferenceValue("ds6wg:revision")])}),e}}):e.extend({init:function(e){this._parent(e);var t=this;o.get().getPADTreeDocument().getModelEvents().subscribe({event:"onRemoveRoot"},function(e){UWA.is(t.removeFilter,"function")&&t.removeFilter({widgetId:t.getWidgetId(),rootIds:[e.data.pid]}),o.get()._biFilter&&!s.isWidgetSynchronizing()&&o.get()._biFilter.removeRoot(e.data.pid),0===o.get().getPADTreeDocument().getRoots().length&&t.disable()}),o.get().getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},function(e){t.enable()}),i.subscribe({event:"authoringStateModified"},function(e){t.getAvailability()&&!e.authored?t.enable():t.disable()})},getWidgetId:function(){return t.getWidgetId()},getAppParams:function(){let e,o=t.getWidgetId();return{widgetId:o,NGFUXId:e=n.getSetting("activateWidgetLink")?s.getSourceWidgetId()?s.getSourceWidgetId():o:t.getSharedId(),appId:t.getAppId()}},getSelectorManager:function(){return o.get().getPADTreeDocument().getXSO()||null},getSelectionId:function(){var e,t=[],n=o.get().getPADTreeDocument().getSelectedNodes(),i=n.length;for(e=0;e<i;e++)if(n[e].isRoot()){var s={id:n[e].getID(),alias:n[e].getLabel(),filterId:n[e].options.filterId,filterName:n[e].options.filterName};t.push(s)}return t},getSelectedOccurence:function(){var e=[],t=this.getSelectorManager();if(!1===t.isEmpty()){for(var n=[],o=t.get(),i=o.length,s=0;s<i;s++)n.push({path:o[s].getOccurencePath(),alias:o[s].getLabel()});e.occurences=n}return e},getCommandState:function(){var e=1;return i.determineAuthoredFlag()&&(e=0),e}})}),define("DS/ENXNav/commands/view/_xNavExpandN",[],function(){"use strict";return{execute:function(e){!0===e.xnav_app.isDynamicCtx()?require(["DS/ENXNav/views/private/ExpandLevelSelector"],function(t){new t({position:e.position,events:{onLevelSelectorSet:function(t){var n=e.model,o=n.getSelectedNodes();o.length>1?n.expandMultiSelect({nodes2Expand:o,numberOfLevelsToExpand:t}):1===o.length&&o[0].expandNLevels({numberOfLevelsToExpand:t})}}})}):require(["DS/PADUtils/views/PADLevelSel"],function(t){var n=e.model,o=n.getSelectedNodes();new t({events:{onApply:function(e){o.length>1?n.expandMultiSelect({nodes2Expand:o,numberOfLevelsToExpand:parseInt(e)}):1===o.length&&o[0].expandNLevels({numberOfLevelsToExpand:parseInt(e)})}}})})}}}),define("DS/ENXNav/utils/LocalStorageForAppState",["DS/PADServices/utils/Storage","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PersistBlob"],function(e,t,n){function o(){this._appKey=e.buildKey(t.getUserLogin()+"."+t.getAppId(),"AppState"),this._blob=new n({key:this._appKey,version:1,storageWrapper:e.local})}let i;return o.prototype={get:function(e){let t=this._getAll();if(t)return t[e]},set:function(e,t){let n=this._getAll();n||(n={}),n[e]=t,this._setAll(n)},del:function(e){let t=this._getAll();t||(t={}),delete t[e],this._setAll(t)},_getAll:function(){return e.local.get(this._appKey)},_setAll:function(t){e.local.set(this._appKey,t)}},i||(i=new o),i}),define("DS/ENXNav/commands/ShowIn3DCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,n){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{atleastonehidden:!0})},execute:function(){var e=n.get().getPADTreeDocument().getSelectedNodes(),t=[];e.length>=1&&e.forEach(function(e){t.push(e.getOccurencePath())}),n.get().onShow({paths:t})}})}),define("DS/ENXNav/commands/FindCmd",["i18n!DS/ENXNav/assets/nls/ENXNav","DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/Tree/TreeNodeModel","DS/ENOXParser/modules/common/Helpers","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/Storage"],function(e,t,n,o,i,s,r,a,l,d){"use strict";return n.extend({init:function(e){this._parent(e),t.viewMgt(this.options.ID,{nograph:!0,notiles:!0,nothumbs:!0})},execute:function(){var t=this;require(["DS/ENOXFindUX/FindView","DS/ENOXFindUX/ENOXFindUtils"],function(n,c){t.findView=null;var u,p,h=t.dgv=o.get().getPADDGVView()?o.get().getPADDGVView().options.dgv:void 0,g=t.model=o.get().getPADTreeDocument(),f=t.getArguments();if(1!==f.length)return;if(t.targetDiv=document.querySelector("."+f[0].Value),!t.targetDiv)return;null!==t.findView&&t.findView.closePanel(),a.subscribeOnce({event:"ENXViews/Model/FindInCtx/ui/close"},function(){r.node.clearChildComputed(g)}),a.subscribe({event:"ENXModel/toggleView"},t.end.bind(t)),a.subscribe({event:"ENXModel/Root/remove"},t._handleRemovalOfRoot.bind(t));var v=g.getSelectedNodes();0===v.length?u=e.find.title:1===v.length?(u=e.replace(e.find.title1Node,{label:v[0].getLabel()}),p=v[0].options.resourceid):u=e.replace(e.find.titleNNodes,{nbNodes:v.length});let m=t.options.position;delete t.options.position;let b,_=h.layout.getVisibleOrderedColumnsIndexes(),D=[],S=[];for(b=0;b<_.length;b++){var x=h.getColumnOrGroup(_[b]);!0!==l.isAttributeColumn(x.dataIndex)||"matrixtxt"===x.ds6w||"string"!==x.typeRepresentation&&"tag"!==x.typeRepresentation&&"url"!==x.typeRepresentation||!x.ds6w||-1!==D.indexOf(x.ds6w)||(D.push(x.ds6w),S.push(x))}let y=d.buildKey("ENXFindCmd","selectedColKey",!0),C=d.local.get(y),w=d.buildKey("ENXFindCmd","selectedMatchKey",!0),P=d.local.get(w),N=d.buildKey("ENXFindCmd","selectedNavigateModeKey",!0),A=d.local.get(N),I=d.buildKey("ENXFindCmd","includeType3dShapeKey",!0),E=d.local.get(I),O=d.buildKey("ENXFindCmd","includeTypeInstanceKey",!0),M=d.local.get(O),F=[];if(C)F=JSON.parse(C);else for(b=0;b<S.length;b++)F.push(S[b].ds6w);t.findView=new n({placeholder:e.find.placeholder,title:u,renderTo:t.targetDiv,position:m,listenSelect:!0,authorizedTypes:["VPMReference","VPMRepReference"],associatedNodeResourceId:p,availableCols:{withChooser:!0,selectedCols:F,allCols:S,selectedMatch:P,selectedNavigateMode:A,includeType3dShape:E,includeTypeInstance:M},events:{onSearch:function(e){var n;h&&h.closeFind(),n=v&&v.length?v:t.model.getRoots(),e.searchFts.length?(t._selectMatch=e.selectMatch,d.local.set(w,t._selectMatch),t._selectNavigateMode=e.selectNavigateMode,d.local.set(N,t._selectNavigateMode),t._includeType3dShape=e.includeType3dShape,d.local.set(I,t._includeType3dShape),t._includeTypeInstance=e.includeTypeInstance,d.local.set(O,t._includeTypeInstance),t._selectedPredicates=e.selectedPredicates,d.local.set(y,JSON.stringify(t._selectedPredicates)),t._launchFind({nodes:n,searchFts:e.searchFts,rscId:e.rscId,selectedPredicates:e.selectedPredicates}).then(function(n){t.foundNodes=n.foundNodes;let o=0;if(h){h.findWidget=t.findView,h.getNodeModelToProcessForFind=function(e,t){return n.foundNodes},h.findNavigationMode=t._selectNavigateMode?"row":"substring";let s=void 0;if(Array.isArray(e.findInContentSelected)&&e.findInContentSelected.length){s=[];let t=h.layout.getVisibleOrderedColumnsIndexes(),n=[];for(let e=0;e<t.length;e++){var i=h.getColumnOrGroup(t[e]);!0===l.isAttributeColumn(i.dataIndex)&&"matrixtxt"!==i.ds6w&&("string"===i.typeRepresentation||"tag"===i.typeRepresentation||"url"===i.typeRepresentation)&&i.ds6w&&i.text&&n.push(i.text)}for(let t=0;t<e.findInContentSelected.length;t++)s.push(e.findInContentSelected[t]),-1!==n.indexOf(e.findInContentSelected[t]+" ")&&s.push(e.findInContentSelected[t]+" ")}h.onFindRequest({findStr:e.searchFts,matchCase:!1,navigationMode:"row",findInContentSelected:s}),o=h.matchingStringCount,t._selectNodeFromMatchCell()}t.findView.setMatchingStringCount(o)})):(t.foundNodes=[],t.findView.setMatchingStringCount(0))},onSelect:function(){if(t.foundNodes&&t.foundNodes.length){var e=t.model;e.prepareUpdate();for(var n=0;n<t.foundNodes.length;n++)t.foundNodes[n].select();e.pushUpdate()}},onClose:function(){h&&h.closeFind(),t.dgv.getNodeModelToProcessForFind=void 0,h.findWidget=null,t.findView=null,a.publish({event:"ENXViews/Model/FindInCtx/ui/close"})},onListenSelect:function(n,o){var r=t.findView;function a(n){var i,r=t.findView,a=r.options.autocompleteModel.search({match:function(e){return e.nodeModel.getReferenceValue("rscId")===n.rscId}});if(0===a.length){var l=r.options.autocompleteModel.getRoots();l.length===o&&(r.options.autocompleteModel.removeRoot(l[o-1]),l=r.options.autocompleteModel.getRoots());var d=n.label;d||(d=e.find.selectNodeWithoutLabel);var c=new s({label:d,grid:{rscId:n.rscId},icons:[{iconName:"3d-object",fontIconFamily:1}]});0===l.length?r.options.autocompleteModel.addRoot(c):r.options.autocompleteModel.insertBefore(c,l[0]),i=c,r.__storeAutocompleteModel()}else i=a[0];r.elements.wuxautocomplete._editor.value=i.getLabel(),r.elements.findBtn.disabled=!1}if(0===r.options.strString.length&&1===n.paths.length){var l=n.paths[0],d=l[l.length-1],u={};n.attributes&&(u=n.attributes[d]);let e=Object.assign({rscId:d},u);c.getTypeTaxonomies({typesToSearch:[{rscId:e.rscId,type:e.type}]}).then(t=>{var o=t[e.type]?t[e.type]:t.XP_VPMReference_Ext,s=!1;if(r.options.authorizedTypes)for(let e=0;e<r.options.authorizedTypes.length;e++)if(-1!==o.indexOf(r.options.authorizedTypes[e])){s=!0;break}s?(e.label=n.attributes[e.rscId].label,UWA.is(e.label)?a(e):require(["DS/PADUtils/PADWSAccess"],function(t){var n=i.getWebAPI_Options("fetch");t.fetch({enopad_webapis:i.getSetting("enopad_webapis"),data:n,pids:[e.rscId],onComplete:function(t){var n=UWA.is(t,"string")?JSON.parse(t):t;if(n.results&&1===n.results.length){var o,i=n.results[0],s=null,r=i.attributes.length;for(o=0;o<r&&!s;o++)"ds6w:label"===i.attributes[o].name&&(s=i.attributes[o].value);e.label=s,a(e)}else e.label=null,a(e)},onFailure:function(){e.label=null,a(e)}})})):console.log("FindView## type ["+e.type+"] not authorized")})}},onFindPreviousResult:t._goToPreviousMatchingCell.bind(t),onFindNextResult:t._goToNextMatchingCell.bind(t),onResetFindResult:t._resetFindResult.bind(t)}})})},_resetFindResult:function(){this.dgv&&this.dgv.closeFind(),this.foundNodes=[],this.findView.setMatchingStringCount(void 0)},_handleRemovalOfRoot:function(e){var t=this.model.getRoots();if(this.findView)if(t.length){if(this.findView.options.associatedNodeResourceId){this.model.getNodesById(this.findView.options.associatedNodeResourceId).length||this.end()}}else this.end()},end:function(){this.findView&&(this.model._doNotBroadcastSelect=!1,this.findView.closePanel()),this._parent()},_should3DFocusChange:function(){var e=this.dgv._matchingAllNodeModelsArray[this.dgv._currentMatchingCellIDIndex].options.resourceid;return e!==this._currentResId&&(this._currentResId=e,!0)},_goToPreviousMatchingCell:function(){this.dgv.goToPreviousMatchingCell(),this._selectNodeFromMatchCell()},_goToNextMatchingCell:function(){this.dgv.goToNextMatchingCell(),this._selectNodeFromMatchCell()},_selectNodeFromMatchCell:function(){if(this._selectMatch){let e=this.dgv.getNodeModelAt(this.dgv._getMatchingCellID(this.dgv._currentMatchingCellIDIndex));!0!==e.isSelected()&&e.select(!0)}},_launchFind:function(e){var t=this;return new Promise(function(n){require(["DS/PADServices/utils/PredefinedQueryUtils"],function(o){var i=!0;if(e.searchFts?o.isPredefinedQry(e.searchFts,{version:2}).then(function(n){var o=n.realQry;!1===n.isPredefinedQry&&(o=t._buildQryRestrictedToColumns(o)),t._includeType3dShape&&t._includeTypeInstance||(o=t._filterTypeFromSearch(o)),a.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:e.nodes,searchFts:o,searchFtsOriginal:e.searchFts,rscId:e.rscId,noPager:!0,doNotBroacast:!0}})}):e.rscId?a.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:e.nodes,rscId:e.rscId,noPager:!0,doNotBroacast:!0}}):i=!1,i)var s=a.subscribe({event:"ENXViews/Model/FindInCtx/complete"},function(e){a.unsubscribe(s),n(e)})})})},_filterTypeFromSearch:function(e){let t="";return`(${e}) AND ${t=this._includeType3dShape||this._includeTypeInstance?this._includeType3dShape?"(([ds6w:type]:VPMReference OR [ds6w:type]: 3DShape) AND (NOT([ds6w:type]:VPMInstance)))":"(([ds6w:type]:VPMInstance OR [ds6w:type]:VPMReference) AND (NOT([ds6w:type]: 3DShape)))":"(([ds6w:type]:VPMReference) AND (NOT([ds6w:type]: 3DShape AND [ds6w:type]:VPMInstance)))"}`},_buildQryRestrictedToColumns:function(e){var t="";e.includes(" ")&&(e=`"${e}"`);for(let n=0;n<this._selectedPredicates.length;n++){this._selectedPredicates[n].endsWith("-Instance")&&(this._selectedPredicates[n]=this._selectedPredicates[n].replace("-Instance","")),0!==n&&(t+=" OR "),t=t+("["+this._selectedPredicates[n]+"]")+":*"+e+"*"}return t}})}),define("DS/ENXNav/views/private/SearchView",["css!DS/ENXNav/ENXNav.css","DS/ENXNav/views/private/Search","DS/PADServices/views/ENXModal","DS/PADServices/utils/GlobalModelEvents"],function(e,t,n,o){"use strict";function i(e){return this.elements={},this.options=e||{},this.options=Object.assign({},this.options),this.__buildView(),this}return i.prototype.getContent=function(){return this.elements.container},i.prototype.__buildView=function(){var e=this;this.elements.findContainer=new t({placeholder:this.options.placeholder,onSearchRequest:function(t,n){e.options.events.onSearch&&e.options.events.onSearch({searchFts:t,matchCase:n}),e.close()},onSearchIdRequest:function(t){e.options.events.onSearch&&e.options.events.onSearch({rscId:t}),e.close()},onSearchClose:function(){e.close()}});var i=this.options.position.x-250;i<0&&(i=this.options.position.x);var s=this.options.target.getBoundingClientRect(),r=this.options.position.y+30;r>s.bottom-75&&(o.publish({event:"ENXViews/ActionBar/hide"}),r>s.bottom&&(r=this.options.position.y-40));var a=document.querySelector(".enx-appMainBody");e.elements.modalFts=new n({target:a,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!1,titleBarVisibleFlag:!1,width:"auto",height:"auto",content:this.elements.findContainer.getContent(),position:{of:this.options.target,my:"top left",at:"top left",offsetX:i,offsetY:r},events:{onClickOutsideContent:function(){e.close()}}}),e.elements.modalFts.getContent().addClassName("enx-searchviewModal"),e.elements.modalFts.getContent().querySelector(".wux-windows-window-content").setStyle("padding","3px")},i.prototype.close=function(){this.options.events.onClose&&this.options.events.onClose(),this.elements.modalFts.close()},i}),define("DS/ENXNav/commands/ExpandThumbsCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,n){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{moreExpanded:!0}),e.viewMgt(this.options.ID,{nodgv:!0,notiles:!0,nothumbs:!0})},execute:function(){var t=n.get(),o=t.getSelectedNodes();t.options.views.graphview.setGroupThumbnailState({nodes:o,expanded:!1}),e.checkAvailability()}})}),define("DS/ENXNav/views/private/externalColumnsViews/lifecycleCols",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/ENXNav/views/private/externalColumnsViews/UtilsColumns","DS/PlatformAPI/PlatformAPI","DS/PADUtils/Configuration","DS/PADServices/utils/MaturityUtils","DS/ApplicationFrame/CommandsManager"],function(e,t,n,o,i,s,r){"use strict";var a=null;function l(e){if("string"==typeof e)return"TRUE"===e.toUpperCase()}function d(){return null==a&&(a=o.getUser()),a}function c(e,t){var n,o,i,s,r=!1;if(t?(n=void 0!==e.nodeModel.options.grid["ds6w:reserved-Instance"]?e.nodeModel.options.grid["ds6w:reserved-Instance"]:void 0,o=e.nodeModel.options.grid["ds6w:reservedBy-Instance"]?e.nodeModel.options.grid["ds6w:reservedBy-Instance"]:""):(n=void 0!==e.nodeModel.options.grid["ds6w:reserved"]?e.nodeModel.options.grid["ds6w:reserved"]:void 0,o=e.nodeModel.options.grid["ds6w:reservedBy"]?e.nodeModel.options.grid["ds6w:reservedBy"]:""),void 0!==n){Array.isArray(o)&&(o=o.join(","));var a=e.nodeModel.options.grid["ds6w:displayName"]?e.nodeModel.options.grid["ds6w:displayName"]:"";r="boolean"==typeof n?n:"TRUE"===n.toUpperCase();var l="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key lc_dgv_lock";if(l)if(r){var c=(i=d(),s="",void 0!==i&&(s=i.login),s),u=function(){var e=d(),t="";return void 0!==e&&(t=e.firstName+" "+e.lastName),t}(),p=!0;o.trim().length>0?(p=o.toUpperCase().trim()===c.toUpperCase().trim()||!1)||(p=o.toUpperCase().trim()===u.toUpperCase().trim()||!1):a.trim().length>0&&(p=u.toUpperCase().trim()===a.toUpperCase().trim()||!1),l=p?"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key lc_dgv_lock":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock lc_dgv_lock_other"}else l="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock-open lc_dgv_unlock";return{icon:{iconClasses:l},label:a}}return e.cellView.getContent().empty()}function u(e){var n=e.nodeModel.options.grid["ds6w:reserved"]?e.nodeModel.options.grid["ds6w:reserved"]:"";if(void 0!==n)return("boolean"==typeof n?n:"TRUE"===n.toUpperCase())?t.columnsDef.tooltipReserved:t.columnsDef.tooltipUnreserved}var p=[];return{"ds6w:reserved":{getCellTooltip:function(e,n){let o="";if(-1===e.rowID)o=n.getCellDefaultTooltip(e);else if(void 0!==e.cellModel){o=("boolean"!=typeof e.cellModel?l(e.cellModel):e.cellModel)?{shortHelp:t.columnsDef.tooltipReserved}:{shortHelp:t.columnsDef.tooltipUnreserved}}return o},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:reserved",kind:"functionIcon",minWidth:50,editableFlag:!1,typeRepresentation:"functionIcon",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellSemantics:function(e){if(!e.isHeader)return c(e,!1)},getCellValueForExport:function(e){return-1===e.rowID?null:u(e)}},e)},actionOnClick:function(e,t){if(e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{let t=e.nodeModel.getReferenceValue("ds6w:reserved");var n="ActionBar_ReserveCmd";!0===("boolean"==typeof t?t:"TRUE"===t.toUpperCase())&&(n="ActionBar_UnreserveCmd");var o=r.getCommand(n);o&&o.isEnabled()?o.begin():setTimeout(function(){o&&o.isEnabled()&&o.begin()},600)},t)}}},"ds6w:reserved-Instance":{getCellTooltip:function(e,n){let o="";if(-1===e.rowID)o=n.getCellDefaultTooltip(e);else if(void 0!==e.cellModel){o=("boolean"!=typeof e.cellModel?l(e.cellModel):e.cellModel)?{shortHelp:t.columnsDef.tooltipReserved}:{shortHelp:t.columnsDef.tooltipUnreserved}}return o},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:reserved-Instance",kind:"functionIcon",minWidth:50,editableFlag:!1,typeRepresentation:"functionIcon",alignment:"center",icon:{iconName:"flow-cascade dgv-header-icon",fontIconFamily:1},customisation:{exportable:{lock:!1,value:!0}},getCellSemantics:function(e){if(!e.isHeader)return c(e,!0)},getCellValueForExport:function(e){return-1===e.rowID?null:u(e)}},e)},actionOnClick:function(e,t){if(e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{let t=e.nodeModel.getReferenceValue("ds6w:reserved-Instance");var n="ActionBar_ReserveCmd";!0===("boolean"==typeof t?t:"TRUE"===t.toUpperCase())&&(n="ActionBar_UnreserveCmd");var o=r.getCommand(n);o&&o.isEnabled()?o.begin():setTimeout(function(){o&&o.isEnabled()&&o.begin()},600)},t)}}},"ds6wg:PLMReference.V_isLastVersion":{getCellTooltip:function(e,n){let o;return o=-1===e.rowID?n.getCellDefaultTooltip(e):e.cellModel?{shortHelp:t.columnsDef.lastRevision}:{shortHelp:t.columnsDef.notlastRevision}},buildColumn:function(e){return Object.assign({dataIndex:"ds6wg:PLMReference.V_isLastVersion",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(e.nodeModel&&void 0!==e.nodeModel.options.grid["ds6wg:PLMReference.V_isLastVersion"]){var t=e.nodeModel.options.grid["ds6wg:PLMReference.V_isLastVersion"];return("boolean"==typeof t?t:"TRUE"===t.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}},e)}},"ds6w:isLastRevision":{getCellTooltip:function(e,n){let o;return o=-1===e.rowID?n.getCellDefaultTooltip(e):e.cellModel?{shortHelp:t.columnsDef.lastRevision}:{shortHelp:t.columnsDef.notlastRevision}},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:isLastRevision",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(e.nodeModel&&void 0!==e.nodeModel.options.grid["ds6wg:PLMReference.V_isLastVersion"]){var t=e.nodeModel.options.grid["ds6wg:PLMReference.V_isLastVersion"];return("boolean"==typeof t?t:"TRUE"===t.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}},e)}},"ds6w:isLastRevisionPerState":{getCellTooltip:function(e,n){let o;if(-1===e.rowID)o=n.getCellDefaultTooltip(e);else{o=("boolean"!=typeof e.cellModel?l(e.cellModel):e.cellModel)?{shortHelp:t.columnsDef.lastRevision}:{shortHelp:t.columnsDef.notlastRevision}}return o},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:isLastRevisionPerState",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(e.nodeModel&&void 0!==e.nodeModel.options.grid["ds6w:isLastRevisionPerState"]){var t=e.nodeModel.options.grid["ds6w:isLastRevisionPerState"];return("boolean"==typeof t?t:"TRUE"===t.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}},e)}},"ds6w:status":{buildColumn:function(e){return s.addCSSMaturityClasses(void 0,"wux-controls-label"),Object.assign({dataIndex:"ds6w:status",kind:"tag",minWidth:50,editableFlag:!1,typeRepresentation:"tag",className:"lc-maturity-state",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(e.nodeModel){var t,n=e.nodeModel.getReferenceValue("ds6w:status-original")?e.nodeModel.getReferenceValue("ds6w:status-original"):e.nodeModel.getReferenceValue("ds6w:status");if(n){if(!1===n.contains(".")){let t=e.nodeModel.getReferenceValue("ds6w:policy-original")?e.nodeModel.getReferenceValue("ds6w:policy-original"):e.nodeModel.getReferenceValue("ds6w:policy");t&&(n=t+"."+n)}t=s.getAndCreateMaturityClass(n,"wux-controls-label")}return t}}},e)},actionOnClick:function(e,t){if(e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{var e=r.getCommand("MaturityHdr");e&&e.begin()},t)}},updateAttributesDelayed:function(e,t,n){let o=[];for(let t=0;t<e.length;t++){var i=e[t].getReferenceValue("ds6w:status-original")?e[t].getReferenceValue("ds6w:status-original"):e[t].getReferenceValue("ds6w:status");if(i){let n;n=!1===i.contains(".")?e[t].getReferenceValue("ds6w:policy-original")?e[t].getReferenceValue("ds6w:policy-original"):e[t].getReferenceValue("ds6w:policy"):i.split(".")[0],-1===p.indexOf(n)&&o.push(n)}}o.length&&s.addCSSMaturityClasses(o,"wux-controls-label")}},"ds6wg:revision":{buildColumn:function(e){var t=null;let n=!0,o="string";return!i.getConfig("readOnlyApp")&&(n=!1,o="url"),(t=Object.assign({dataIndex:"ds6wg:revision",kind:o,minWidth:50,editableFlag:!1,typeRepresentation:"url",customisation:{exportable:{lock:!1,value:!0}},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.isGroupingNode?"string":"url"},getCellValue:function(e){var t=e&&e.nodeModel?e.nodeModel.options.grid["ds6wg:revision"]:void 0;return t?{label:t,func:function(){console.log("Revision Column Value: "+t)}}:void 0},getCellValueForExport:function(e){return e&&e.nodeModel?e.nodeModel.options.grid["ds6wg:revision"]:void 0}},e)).kind=o,t},actionOnClick:function(e,t){if(e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{var e=r.getCommand("HistoryHdr");e&&e.begin()},t)}}}}}),define("DS/ENXNav/commands/Download",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalUtils","DS/ENXNav/commands/CmdUtils"],function(e,t,n,o,i){"use strict";return e.extend({init:function(e){this._parent(e),i.selectionMgt(this.options.ID,{})},execute:function(){var e=n.get().getPADTreeDocument().getSelectedNodes();require(["DS/DocumentManagement/DocumentManagement","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CoreEvents/ModelEvents","DS/DocumentCommands/DocumentCommandsV2"],function(t,n,i,s){let r=e.map(e=>e.getID());r=r.filter((e,t)=>r.indexOf(e)===t),n.getPlatformServices({platformId:widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",onComplete:function(e){t.getDocuments(r,{tenant:e.platformId,tenantUrl:e["3DSpace"],additionalURLParams:"$fields=isDocumentType",onComplete:function(t){if(t.success){var n=new i;n.subscribe({event:"docv2-show-notification"},function(e){var t={title:e.title,subtitle:e.subtitle,message:e.message,className:e.lable};o.displayNotif(t)}),new s({fetchSecurityContext:function(){},getSelectedNodes:function(){return t.data},getDocumentFromNodeModel:function(e){return e},platformUrls:e,isFromContextMenu:!0,events:n}).commands.Download.execute()}},onFailure:function(e){console.log(e)}})}})})}})}),define("DS/ENXNav/commands/HideIn3DCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,n){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{atleastonevisible:!0})},execute:function(){var e=n.get().getPADTreeDocument().getSelectedNodes(),t=[];e.length>=1&&e.forEach(function(e){t.push(e.getOccurencePath())}),n.get().onHide({paths:t})}})}),define("DS/ENXNav/commands/CloseSelectedCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,n){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{onlyRoot:!0})},execute:function(){var e=n.get().getPADTreeDocument(),t=e.getSelectedNodes();e.withTransactionUpdate(function(){for(var n=0;n<t.length;n++)e.removeRoot(t[n])})}})}),define("DS/ENXNav/models/RefreshMask",["DS/ENXNav/utils/TwoDAppEvents","DS/PADServices/utils/PromiseCompletion","DS/PADServices/utils/GlobalModelEvents"],function(e,t,n){return{}}),define("DS/ENXNav/views/private/externalColumnsViews/classification",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","text!DS/ENXNav/assets/templates/bookmarksTemplate.html","DS/ENXNav/views/private/externalColumnsViews/UtilsColumns","UWA/Utils","DS/Handlebars/Handlebars","DS/PADServices/views/ENXModal","DS/Controls/Button"],function(e,t,n,o,i,s,r,a){"use strict";var l=s.compile(n);function d(e,t){return l({className:t,bookmarks:e})}return{"ds6w:bookmarks":{getCellTooltip:function(e,t){let n=null;if(-1===e.rowID)n=t.getCellDefaultTooltip(e);else{let o=e.nodeModel.getReferenceValue("ds6w:bookmarks");if(o){let s=d(o=i.splat(o));n={title:t.getColumnOrGroup(e.columnID).text,shortHelp:s,allowUnsafeHTMLShortHelp:!0,wrapThreshold:315,updateModel:!1}}}return n},buildColumn:function(e){return Object.assign(e,{dataIndex:"ds6w:bookmarks",width:100,minWidth:40,editableFlag:!1,kind:"url",typeRepresentation:"url",customisation:{exportable:{lock:!1,value:!0}},getCellValue:function(e){var n=e.nodeModel?e.nodeModel.options.grid["ds6w:bookmarks"]:void 0,o=void 0;return n&&(o=1===(n=i.splat(n)).length?{label:n[0]}:{label:t.replace(t.columnsDef.bookmarks,{nbBookmarks:n.length})}),o},getCellValueForExport:function(e){var t="";if(-1===e.rowID)t=e.cellModel;else if(e.nodeModel){var n=e.nodeModel?e.nodeModel.options.grid["ds6w:bookmarks"]:void 0;n&&(t=(n=i.splat(n)).join(","))}return t}})},actionOnClick:function(e,t){if(e.nodeModel){let o=e.nodeModel.getReferenceValue("ds6w:bookmarks");if(void 0!==o){let s=d(o=i.splat(o)),l=document.querySelector(".enx-appMainBody"),c=e.cellView.getContent().getBoundingClientRect(),u={of:l,my:"top left",at:"top left",offsetX:c.x,offsetY:c.y};var n=new r({target:l,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!0,title:t.getPADDGVView().options.dgv.getColumnOrGroup(e.columnID).text,titleBarVisibleFlag:!0,width:"auto",height:"auto",content:s,position:u,buttons:{Close:new a({onClick:function(){n.close()}})},events:{onClickOutsideContent:function(){n.close()}}})}}}}}}),define("DS/ENXNav/commands/tools/ExportAs",["i18n!DS/ENXNav/assets/nls/ENXNav","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADUtils/Utility","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/views/ProgressDialog","DS/PADUtils/views/PADAlert","DS/PADUtils/PADSettingsMgt","i18n!DS/PADServices/assets/nls/PADServices","DS/UIKIT/Mask","DS/ENXNav/utils/LocalStorageForAppState"],function(e,t,n,o,i,s,r,a,l,d,c,u,p){"use strict";return t.extend({init:function(e){this._parent(e);var t=n.get();t.options.model?t.options.model:t.getPADTreeDocument();this._checkIfTreeView(),UWA.is(t.addEvent,"function")&&t.addEvent("onToggleView",this._checkIfTreeView.bind(this)),o.isMobileDevice()&&this.disable()},_checkIfTreeView:function(){switch(n.get().getPADTreeDocument().options.active_view){case"treelistview":case"datagridview":this.enable();break;case"graphview":case"tileview":case"thumbnailview":this.disable()}},execute:function(){this.disable();for(var e=this.getArguments(),t="csv",n=0;n<e.length;n++)"ExportAs"===e[n].ID?t=e[n].Value:"TargetDiv"===e[n].ID&&(this.targetDiv=document.querySelector("."+e[n].Value));var o=this;r.getModelEvents().subscribeOnce({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete"},function(e){e.cancelPrintOrExport||r.publish({event:"ENXViews/DatagridView/ExportAs",data:{exportAs:t}}),o.enable()}),this._populateBeforeExport(t)},_populateBeforeExport:function(t){var o=this,h=n.get().getPADTreeDocument(),g=this._getAllVisibleNodes(h),f=[],v=d.getSetting("printobjectslimit");if("Print"===o._id&&g.length>v)return l.displayNotification({msg:e.replace(e.PrinteLargeDataLimit,{maxResult:v}),eventID:"warning",key:"EnxNav-printeLargeDataLimit"}),r.publish({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete",data:{cancelPrintOrExport:!0}}),void o.enable();(g.length>1e3&&!p.get("")?this.__askStopOrContinue():Promise.resolve(!1)).then(function(l){if(null!=o.modalStop&&o.modalStop.options.checkboxInfos.checkFlag&&p.set("",!0),!0===l)console.log("Launch real Export/Print without update"),r.publish({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete",data:{cancelPrintOrExport:!1}});else{this._progressDiag=new a({target:o.targetDiv,title:e["ExportAs-"+t],progressBar:{displayStyle:"normal"}}),this._progressDiag.setProgress(0),this._progressDiag.setProgress(5);var d=function(e,t){for(var n=[],o=e.length,i=0;i<o;i+=t)n.push(e.slice(i,i+t));return n}(g,500);h.setUseChangeTransactionMode(!0);var v=n.get().getPADDGVView().getColumnsForExport(),m=85/d.length,b=1,_=!1;console.log("Nb Batches:"+d.length+"\n Step:"+m),r.subscribeOnce({event:"ENXViews/ExportAs/CancelExportOrPrint"},function(){u.mask(o._progressDiag.options.target,c.documentsList.masks.cancelExport),o.disable(),_=!0}),f.push(new Promise(function(e,t){var n=i.createStepper(d,{model:h},function(t,i){s.updateNLSforexport(h,t).then(function(){_?e():i.model.fillAdditionalColumns(t,v,"ExportAs").then(function(){var e=Math.floor(b*m)+5;console.log("Progress:"+e+"\n"),o._progressDiag.setProgress(e),b++,n()})})},e);n()})),Promise.all(f).then(function(){u.unmask(o._progressDiag.options.target),_?r.publish({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete",data:{cancelPrintOrExport:!0}}):(h.setUseChangeTransactionMode(!1),console.log("Launch real Export/Print"),o._progressDiag.setProgress(100),r.publish({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete",data:{cancelPrintOrExport:!1}})),setTimeout(function(){o._progressDiag.close(),delete o._progressDiag},200),o.enable()}),o.enable()}u.unmask(o._progressDiag.options.target)}.bind(this))},__askStopOrContinue:function(){var t=this;return new Promise(function(n){require(["DS/PADServices/views/ENXModal","DS/Controls/Button"],function(o,i){t.modalStop=new o({target:t.targetDiv,title:e.ExportAsContinueTitle,width:310,content:e.replace(e.ExportAsContinueContent,{nbNodes:1e3}),buttons:{No:new i({label:e.ExportSkip,onClick:function(){n(!0),t.modalStop.close()}}),Yes:new i({label:e.ExportContinue,onClick:function(){n(!1),t.modalStop.close()}})},checkboxInfos:{label:e.DonotShowAgain,checkFlag:!1},closeCB:function(){n(!0)}}),document.querySelector(".wux-windows-window-content").style.background="white"})})},_getAllVisibleNodes:function(e){var t=[],n=e.getRoots();return n.length&&n.forEach(function(e){e.isVisible()&&(t.push(e),e.processDescendants({processNode:function(){this.isVisible()&&t.push(this)}}))}),t}})}),define("DS/ENXNav/commands/FocusOnCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,n){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID)},execute:function(){var e=n.get().getPADTreeDocument().getSelectedNodes(),t=require("DS/PADUtils/PADUtilsServices"),o=[];e.length>=1&&e.forEach(function(e){o.push(e.getOccurencePath())}),n.get()._commandProxy.focus({intent:"focus",paths:o,widget:"2D",sharedID:t.getSharedId(),appID:t.getAppId()})}})}),define("DS/ENXNav/commands/FindInCtxCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,n){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{monoselection:!0})},execute:function(){var e=this;require(["DS/ENXNav/utils/FindInCtx"],function(t){var o=n.get().getSelectedNodes(),i=e.getArguments();1===i.length&&(e.targetDiv=document.querySelector("."+i[0].Value),t.launchFindWithDialog({position:e.options.position,renderTo:e.targetDiv,node:o[0]}))})}})}),define("DS/ENXNav/commands/CopyLink",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents","DS/ENXNav/commands/CmdUtils"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e),n.selectionMgt(this.options.ID,{monoselection:!0})},execute:function(){t.publish({event:"ENXModel/Model/CopyLink",data:{}})}})}),define("DS/ENXNav/commands/CollapseThumbsCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,n){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{lessExpanded:!0}),e.viewMgt(this.options.ID,{nodgv:!0,notiles:!0,nothumbs:!0})},execute:function(){var t=n.get(),o=t.getSelectedNodes();t.options.views.graphview.setGroupThumbnailState({nodes:o,expanded:!0}),e.checkAvailability()}})}),define("DS/ENXNav/views/private/ExpandLevelSelector",["css!DS/ENXNav/ENXNav.css","DS/ENXNav/views/private/LevelSelector","DS/PADServices/views/ENXModal","DS/PADServices/utils/GlobalModelEvents"],function(e,t,n,o){"use strict";function i(e){return this.elements={},this.options=e||{},this.options=Object.assign({},this.options),this.__buildView(),this}return i.prototype.getContent=function(){return this.elements.container},i.prototype.__buildView=function(){var e=this;this.elements.levelSelectorContainer=new t({onLevelSelectorSet:function(t){"function"==typeof e.options.events.onLevelSelectorSet&&e.options.events.onLevelSelectorSet(t),e.close()},onLevelSelectorClose:function(){e.close()}});var o={of:this.options.target,my:"bottom center",at:"bottom center",offsetX:0,offsetY:-80};if(this.options.position&&this.options.position.x){var i=this.options.position.x-250;i<0&&(i=this.options.position.x);var s=this.options.position.y+30;o={of:this.options.target,my:"top left",at:"top left",offsetX:i,offsetY:s}}var r=document.querySelector(".enx-appMainBody");e.elements.modalFts=new n({target:r,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!1,titleBarVisibleFlag:!1,width:"auto",height:"auto",content:this.elements.levelSelectorContainer.getContent(),position:o,events:{onClickOutsideContent:function(){e.close()}}}),e.elements.modalFts.getContent().addClassName("enx-ExpandLevelSelectorModal"),e.elements.modalFts.getContent().querySelector(".wux-windows-window-content").setStyle("padding","3px")},i.prototype.close=function(){this.options.events&&this.options.events.onClose&&this.options.events.onClose(),this.elements.modalFts.close()},i}),define("DS/ENXNav/models/xNavNodeModel",["DS/Tree/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/ENXNav/views/private/externalColumnsViews/UtilsColumns","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADServices/utils/AttributesMgtV2","DS/ENOXParser/modules/common/Helpers"],function(e,t,n,o,i,s){"use strict";function r(e){e._getFilterInfo||(e._getFilterInfo=l.prototype._getFilterInfo.bind(e),e._getChildrenFilterInfo=l.prototype._getChildrenFilterInfo.bind(e),e._removeChildrenFilterInfo=l.prototype._removeChildrenFilterInfo.bind(e),e.filterInChild=l.prototype.filterInChild.bind(e),e.filterOutChild=l.prototype.filterOutChild.bind(e))}var a={label:"",icons:[],grid:{},padgrid:{},resourceid:"",type:"",relationid:"",relationtype:"",relationOrder:-1,did:"",relcount:null,isPADHidden:!1,padstate:"collapsed",children:[],thumbnail:null,useAsyncPreExpand:!0,contextualMenu:[{type:"SeparatorItem"}],synthesis:{},excludedOccurences:[]};function l(n){if(!0===n.isGroupingNode)return function(t){this.options=UWA.clone(d),this.options=UWA.extend(this.options,t),e.call(this,this.options),this.isGroupingNode=!0,this.isRelationsObjectNode=!0}.call(this,n);if(this.options=UWA.clone(a),n&&n.grid){this.options.subLabel=n.grid["ds6w:responsible"],this.options.description=n.grid["ds6w:identifier"],this.options.thumbnail=n.thumbnail?n.thumbnail:t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png");var s=n.grid["ds6w:reserved"]?n.grid["ds6w:reserved"]:n.padgrid&&n.padgrid["ds6w:reserved"]?n.padgrid["ds6w:reserved"]:null;if(null!==s)if("boolean"==typeof s?s:"TRUE"===s.toUpperCase())this._isLockedByMe(n)?(this.options.statusbarIcons=["key"],this.options.statusbarIconsTooltips=[o.tooltip_reserved]):(this.options.statusbarIcons=["lock"],this.options.statusbarIconsTooltips=[o.tooltip_reserved]);else this.options.statusbarIcons=["lock-open"],this.options.statusbarIconsTooltips=[o.tooltip_unreserved]}n&&UWA.is(n.relcount)&&0===n.relcount&&(n.children=null),this.options.acceptNodeDropAt=function(e,t){return this.isRoot()?0===t:-1===t||1===t},this.options=UWA.extend(this.options,n),this.options.relationOrder||(this.options.relationOrder=-1),this.options.grid||(this.options.grid={}),this.options.grid.instanceName&&(console.warn("xNavNodeModel: Please use ds6w:label-Instance instead of instanceName"),this.options.grid["ds6w:label-Instance"]=this.options.grid.instanceName,delete this.options.grid.instanceName);for(var r=this.options,l=i.getColumnsOrder(),c=Object.keys(r.grid),u=0;Array.isArray(l)&&u<l.length;u++)"tree"!==l[u]&&-1===c.indexOf(l[u])&&(r.grid[l[u]]=void 0);var p=i.getAdditionalColumns();for(u=0;Array.isArray(p)&&u<p.length;u++)r.grid&&void 0===r.grid[p[u]]&&(r.grid[p[u]]="");r.getAttributeValueForFiltering=function(t){return r.grid[t+"-original"]?r.grid[t+"-original"]:e.prototype.getAttributeValue.call(this,t)}.bind(this),e.call(this,this.options)}var d={kind:"groupingNode",label:"",resourceid:"",icons:[{iconName:"group"}],grid:{},children:[],thumbnail:null,useAsyncPreExpand:!0,parentNode:null,contentRetrieved:!1,ds6w:"",grp:"",uql:null,grpSelected:!1};return l.prototype=Object.create(e.prototype),l.prototype.queueNls=function(){let e=this;require(["DS/PADServices/utils/DictionaryAccess"],function(t){t.updateNLS(e)})},l.prototype.reverseExpand=function(t){var n=t||{},o={ids:[],relids:[]};if(n.state&&"partiallyExpanded"===n.state)for(var i=this;i&&!i.isRoot();)!0===i.options.waiting4validation&&(-1===o.ids.indexOf(i.getID())&&o.ids.push(i.getID()),-1===o.relids.indexOf(i.getRelationID())&&o.relids.push(i.getRelationID())),(i=i.getParent()).isExpanded()||i.setState({state:n.state});else e.prototype.reverseExpand.call(this);return o},l.prototype.getFarthestParent=function(){for(var e=this;e&&!e.isRoot();)if(!(e=e.getParent())){e=this;break}return e},l.prototype.getOccurencePath=function(e){if(!0===this.options.isGroupingNode)return this.getParent().getOccurencePath(e);if(UWA.is(e,"function")&&e(this),!this.isRoot()&&this.getParent()){var t=this.getParent().getOccurencePath(e);return this.options.relationid&&t.push(this.options.relationid),this.options.resourceid&&!this.options.resourceid.includes("fakeNode")&&t.push(this.options.resourceid),t}return[this.options.resourceid]},l.prototype.getOccurencePathWithType=function(){if(!0===this.options.isGroupingNode)return this.getParent().getOccurencePathWithType();if(!this.isRoot()&&this.getParent()){var e=this.getParent().getOccurencePathWithType();return e.push({resourceid:this.options.relationid,type:this.options.relationtype}),e.push({resourceid:this.options.resourceid,type:this.options.type}),e}return[{resourceid:this.options.resourceid,type:this.options.type}]},l.prototype.getNodeByPath=function(e,t,n,o){("number"!=typeof t||t<0)&&(t=0),("number"!=typeof n||n<0||n>=e.length)&&(n=e.length-1);var i=e.indexOf(this.options.resourceid),s=function(){if(t!==n&&(this.isExpanded()||this.childComputed||void 0!==o&&!1!==o)){var i=e[t+1],s=this.getChildren();if(s&&0!==s.length){for(var r=null,a=0;a<s.length&&null===r;a++){var l=s[a];!0===l.isGroupingNode?r=l.getNodeByRelIDInGroup(i):i===l.options.relationid&&(r=l)}return null===r?this:r.getNodeByPath(e,t+2,n,o)}return this}return this}.bind(this);return this.options.resourceid instanceof Array&&this.options.resourceid.indexOf(e[t])>=0||this.options.resourceid===e[t]?s():void 0!==typeof i&&-1!==i?(e=e.slice(i,e.length),s()):void 0},l.prototype.getFirstNodeInPath=function(e,t,n){var o={node:null,find_in_ctx_path:[]};if(("number"!=typeof t||t<0)&&(t=0),("number"!=typeof n||n<0||n>=e.length)&&(n=e.length-1),this.options.resourceid instanceof Array&&this.options.resourceid.indexOf(e[t])>=0||this.options.resourceid===e[t]){if(t===n||!this.isExpanded())return o.node=this,t!==n&&(o.find_in_ctx_path=e.slice(t,e.length)),o;var i=e[t+1],s=this.getChildren();if(0===s.length)return o.node=this,o.find_in_ctx_path=e.slice(t,n-t+1),o;for(var r=!0,a=0;a<s.length;a++){var l=s[a];if(i===l.options.relationid)return r=!1,l.getFirstNodeInPath(e,t+2,n)}if(!0===r)return o.node=this,o.find_in_ctx_path=e.slice(t,n-t+1),o}},l.prototype.getID=function(){return this.options.resourceid},l.prototype.getRelationID=function(){return!0===this.isRelationsObjectNode?null:this.options.relationid},l.prototype.setRelationID=function(e,t){this.options.relationid=e,this.options.relationtype=t},l.prototype.getNodesById=function(e){var t={listOfFoundNodes:[]};return this._getNodesById(e,t),t.listOfFoundNodes},l.prototype.getChildById=function(e){var t,n=this.getChildren();if(n)for(var o=0;o<n.length;o++)if(n[o].getID()===e){t=n[o];break}return t},l.prototype.getChildByIds=function(e,t){if(!0===this.options.isGroupingNode)return function(e,t,n){var o,i=e.getChildren();for(let e=0;i&&e<i.length;e++){var s=i[e];if(!0===s.isGroupingNode){if(void 0!==(o=s.getChildByIds(t,n)))break}else if(void 0===t){if(s.getID()===n){o=s;break}}else if(s.getRelationID()===t){o=s;break}}return o}(this,e,t);var n,o=this.getChildren();if(o)for(var i=0;i<o.length&&void 0===n;i++){var s=o[i];if(!0===s.isGroupingNode){var r=s.getChildren();for(let o=0;r&&o<r.length&&void 0===n;o++){var a=r[o];if(!0===a.isGroupingNode){if(void 0!==(n=a.getChildByIds(e,t)))break}else if(void 0===e){if(a.getID()===t){n=a;break}}else if(a.getRelationID()===e){n=a;break}}}else if(void 0===e){if(s.getID()===t){n=s;break}}else if(s.getRelationID()===e){n=s;break}}return n},l.prototype.getChildNodesByRelId=function(e){let t=this.getChildren(),n=null;if(t&&t.length)for(let o=0;null===n&&o<t.length;o++){let i=t[o];i.getRelationID()===e&&(n=i)}return n?[n]:[]},l.prototype.getNodesByRelId=function(e){var t={listOfFoundNodes:[],foundId:void 0};return this._getNodesByRelId(e,t),t.listOfFoundNodes},l.prototype._removeFilterInfo=function(){delete this.options._filterInfo},l.prototype._removeChildrenFilterInfo=function(){delete this.options._childrenFilterInfo},l.prototype._getFilterInfo=function(e){return!this.options._filterInfo&&Boolean(e)&&(this.options._filterInfo={}),this.options._filterInfo},l.prototype._getChildrenFilterInfo=function(e){return!this.options._childrenFilterInfo&&Boolean(e)&&(this.options._childrenFilterInfo={}),this.options._childrenFilterInfo},l.prototype.filterOut=function(){var e=this.isRoot()?this.getTreeDocument():this.getParent();null!==e&&(r(e),e.filterOutChild(this))},l.prototype.filterIn=function(e){var t=this._getFilterInfo();if(t&&t.parentBeforeFiltering){var n=t.parentBeforeFiltering;r(n),n.filterInChild(this)}if(Boolean(e)){var o,i=this._getChildrenFilterInfo();(o=i&&i.childrenBeforeFiltering?i.childrenBeforeFiltering:this.getChildren())&&o.forEach(function(t){t.filterIn(e)})}},l.prototype.filterOutChild=function(e){var t=this.getChildren();if(t.indexOf(e)<0)throw"Not a child";var n=this._getChildrenFilterInfo(!0);if(!n.childrenBeforeFiltering){n.childrenBeforeFiltering=t&&t.length>0?t.slice(0):[];UWA.is(this._expandState)&&(n.expandStateBeforeFiltering={noExpandState:"noChildren",expandingState:"expanding",partiallyExpandedState:"partiallyExpanded",collapseState:"expanded",expandState:"collapsed"}[this._expandState])}e._getFilterInfo(!0).parentBeforeFiltering=this,UWA.is(this.removeChild,"function")?this.removeChild(e):this.removeRoot(e,!0,!0),UWA.is(this.setState,"function")&&this.setState({state:n.expandStateBeforeFiltering}),n.filteredOutChildren||(n.filteredOutChildren=[]),n.filteredOutChildren.push(e)},l.prototype.filterInChild=function(e){var t=this._getChildrenFilterInfo();if(t){var n=t.childrenBeforeFiltering;if(n){var o=n.indexOf(e);if(o>=0){var i=e._getFilterInfo();if(i&&i.parentBeforeFiltering===this){var s,r=this.getChildren();if(r)for(var a=0;a<r.length;a++){var l=r[a];if(n.indexOf(l)>o){s=l;break}}delete i.parentBeforeFiltering,void 0!==e.options.isRootAttached?!0===e.options.isRootAttached&&this.insertBefore(e,s):this.insertBefore(e,s),UWA.is(this.setState,"function")&&this.setState({state:t.expandStateBeforeFiltering}),e._removeFilterInfo();var d=t.filteredOutChildren.indexOf(e);t.filteredOutChildren.splice(d,1),0===t.filteredOutChildren.length&&this._removeChildrenFilterInfo()}}}}},l.prototype._getNodesById=function(e,t){var n=!1;if(this.getID()===e)t.listOfFoundNodes.push(this),n=!0;else{var o=this.getChildren();if(o)for(var i=0;o&&i<o.length;i++)n="function"==typeof o[i]._getNodesById&&o[i]._getNodesById(e,t)||n}return n},l.prototype._getNodesByRelId=function(e,t){var n=this.options.relationid,o=this.getID();if(n===e)t.listOfFoundNodes.push(this),t.foundId=o;else if(o!==t.foundId){var i=this.getChildren();if(i)for(var s=0;s<i.length;s++)!0!==i[s].isGroupingNode?i[s]._getNodesByRelId(e,t):i[s]._getNodesByRelIdInGroup(e,t)}},l.prototype._getNodesByRelIdInGroup=function(e,t){this.getID();var n=this.getChildren();if(n)for(var o=0;o<n.length;o++)!0!==n[o].isGroupingNode?n[o]._getNodesByRelId(e,t):n[o]._getNodesByRelIdInGroup(e,t)},l.prototype.updateFromFetch=function(e,t){this.updateAttributes(e.attributes,t)},l.prototype.updateAttributes=function(e,t){if(!UWA.is(e,"array")||!UWA.is(t,"array"))throw new Error("Invalid argument(s)");var n=t,o=t.tree?t.tree:i.getTreeColumn(),s={};e.forEach(function(e){UWA.is(e.value)&&UWA.is(e.value.replace,"function")&&(e.value=e.value.replace(/\\n/g," ")),"ds6w:type"===e.name&&(s.type=e.value),e.name===o?s.label=e.value:"type_icon_url"===e.name?(s.icons=[],s.icons.push(e.value)):"preview_url"===e.name||"thumbnail_2d"===e.name?(s.thumbnail=e.value,s.grid||(s.grid={}),s.grid.thumbnail="url("+e.value+")"):-1!==n.indexOf(e.name)?(s.grid||(s.grid={}),s.grid[e.name]=e.value):-1!==n.indexOf(e.name)||"ds6w:reservedBy-Instance"!==e.name&&"ds6w:reservedBy"!==e.name||(s.grid||(s.grid={}),s.grid[e.name]=e.value)}),this.updateOptions(s)},l.prototype.updateNlsAttributes=function(e){var t={};for(var n in e)for(var o in t.grid||(t.grid={}),e[n])this.options.grid[n]===o&&(t.grid[n]=e[n][o]);t.grid=UWA.extend(this.options.grid,t.grid,!0),this.updateOptions(t)},l.prototype.getFirstCommonAncestor=function(e){if(this===e)return e;for(var t,n,o=this.getPath(),i=e.getPath(),s=Math.min(o.length,i.length),r=0;r<s;r++)if(o[r]!==i[r]){t=r;break}return t>0?n=o[t-1]:void 0===t&&(n=o[s-1]),n},l.prototype.isDescendantOf=function(e){if(!0===this.options.isGroupingNode)return this.getParent().isDescendantOf(e);var t;if(t=e instanceof l?e.getID():e,this.getID()===t)return!0;if(!this.isRoot()){var n=this.getParent();if(n)return n.isDescendantOf(t)}return!1},l.prototype.getDepth=function(){for(var e=this,t=0;!e.isRoot();){var n=e.getParent();if(null===n)break;!0!==n.isGroupingNode&&t++,e=n}return t},l.prototype.getLeaves=function(){var e=[];return this.processDescendants({processNode:function(){!1===this.hasChildren()&&e.push(this)}}),e},l.prototype.getAttribute=function(e){var t;return this.options.grid[e]&&(t=this.options.grid[e]),t},l.prototype.updateOptions=function(n){if(n.grid){this.options.thumbnail||n.thumbnail||(n.thumbnail=t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png")),n.subLabel=n.grid["ds6w:responsible"]?n.grid["ds6w:responsible"]:this.options.grid&&this.options.grid["ds6w:responsible"]?this.options.grid["ds6w:responsible"]:"",n.description=n.grid["ds6w:identifier"]?n.grid["ds6w:identifier"]:this.options.grid&&this.options.grid["ds6w:identifier"]?this.options.grid["ds6w:identifier"]:"";var i=void 0!==n.grid["ds6w:reserved"]?n.grid["ds6w:reserved"]:n.padgrid&&void 0!==n.padgrid["ds6w:reserved"]?n.padgrid["ds6w:reserved"]:null;if(null!==i)if("boolean"==typeof i?i:"TRUE"===i.toUpperCase())this._isLockedByMe(n)?(this.options.statusbarIcons=["key"],this.options.statusbarIconsTooltips=[o.tooltip_reserved]):(this.options.statusbarIcons=["lock"],this.options.statusbarIconsTooltips=[o.tooltip_reserved]);else n.statusbarIcons=["lock-open"],n.statusbarIconsTooltips=[o.tooltip_unreserved]}if(this.options.edit&&(n.edit=this.options.edit),n.grid){let e=Object.keys(this.options.grid);for(let t=0;t<e.length;t++)e[t].contains("-original")&&n.grid[e[t].replace("-original","")]&&delete this.options.grid[e[t]]}e.prototype.updateOptions.call(this,n)},l.prototype.childValidationChecker=function(){if(void 0===this.childValidationCheckerToken){this.childValidationCheckerToken=null;var e=this;this.childValidationCheckerToken=this.addEventListener("expandStateChange",function(t){"expanded"===t.data.state&&(e.removeEventListener(e.childValidationCheckerToken),e.withTransactionUpdate(function(){var t=e.getChildren().filter(function(e){return!0===e.options.waiting4validation});if(t.length>0)for(var n=0;n<t.length;n++)console.warn("NavNodeModel# Remove node to the unvalidated child "+JSON.stringify(t[n].getOccurencePath())),e.removeChild(t[n])}))})}},l.prototype._isLockedByMe=function(e){var t=!0,n=e.grid["ds6w:reservedBy"]?e.grid["ds6w:reservedBy"]:e.padgrid&&e.padgrid["ds6w:reservedBy"]?e.padgrid["ds6w:reservedBy"]:"";Array.isArray(n)&&(n=n.join(","));var o=e.grid["ds6w:displayName"]?e.grid["ds6w:displayName"]:e.padgrid&&e.padgrid["ds6w:displayName"]?e.padgrid["ds6w:displayName"]:"",i=require("DS/PADUtils/PADUtilsServices"),s=i.getUserLogin()?i.getUserLogin():"",r=i.getUserName()?i.getUserName():"";t=!0;return n.trim().length>0?(t=n.toUpperCase().trim()===s.toUpperCase().trim()||!1)||(t=n.toUpperCase().trim()===r.toUpperCase().trim()||!1):o.trim().length>0&&(t=r.toUpperCase().trim()===o.toUpperCase().trim()||!1),t},l.prototype.childValidationChecker=function(){if(void 0===this.childValidationCheckerToken){this.childValidationCheckerToken=null;var e=this;this.childValidationCheckerToken=this.addEventListener("expandStateChange",function(t){"expanded"===t.data.state&&(e.removeEventListener(e.childValidationCheckerToken),e.withTransactionUpdate(function(){var t=e.getChildren().filter(function(e){return!0===e.options.waiting4validation});if(t.length>0)for(var n=0;n<t.length;n++)console.warn("NavNodeModel# Remove node to the unvalidated child "+JSON.stringify(t[n].getOccurencePath())),e.removeChild(t[n])}))})}},l.prototype.getPLMValue=function(e){var t=null;return i.getTreeColumn()===e?t=this.getLabel():void 0!==this.options.grid[e]?t=this.options.grid[e]:this.options.padgrid&&void 0!==this.options.padgrid[e]&&(t=this.options.padgrid[e]),t},l.prototype.hasSynthesis=function(){return!0===this.options.filtered?void 0!==this.options.synthesis.filteredSynthesis:void 0!==this.options.synthesis.global},l.prototype.setSynthesis=function(e){!0===this.options.filtered?this.options.synthesis.filteredSynthesis=e:this.options.synthesis.global=e},l.prototype.getSynthesis=function(e){return!0===this.options.filtered?this.options.synthesis.filteredSynthesis[e]:this.options.synthesis.global[e]},l.prototype.setExcludedOccurrences=function(e){this.options.excludedOccurences=e},l.prototype.getExcludedOccurrences=function(){return this.options.excludedOccurences},l.prototype.cleanUpPathes=function(){if(this.options.excludedOccurences&&this.options.excludedOccurences.length)for(let e=0;e<this.options.excludedOccurences.length;e++){let t=this.options.excludedOccurences[e],n=t[t.length-1],o=this.getNodesById(n);for(let e=0;e<o.length;e++)s.array.compare(t,o[e].getOccurencePath())&&o[e].remove()}},l.prototype.getGroupID=function(){return this.getGroups().join("/")},l.prototype.getGroupObjID=function(){return!0===this.getParent().isGroupingNode?this.getParent().getGroupObjID():this.getParent().getID()},l.prototype.getPredicate=function(){return this.options.ds6w},l.prototype.getGroups=function(){var e;!0===this.options.merged?e=this.options.grp:e=require("UWA/Utils").splat(this.options.grp);return e},l.prototype.getFilterUQL=function(){if(null===this.options.uql){var e=this.getGroups().join("/");this.options.uql="["+this.options.ds6w+"]=("+e+")"}return this.options.uql},l.prototype.getNodeByRelIDInGroup=function(e){var t=null,n=this.getChildren();for(let o=0;o<n.length&&null===t;o++)!0===n[o].isGroupingNode?t=n[o].getNodeByRelIDInGroup(e):n[o].getRelationID()===e&&(t=n[o]);return t},l.prototype.isGrpSelected=function(){var e=this.options.grpSelected;if(!1===e){var t=this.getParent();!0===t.isGroupingNode&&(e=t.isGrpSelected())}return e},l.prototype.getCellTooltip=function(e){var t,o=e.nodeModel.getTreeDocument(),i=!1;if(o&&"structured"===o.getGroupLayout()&&(i=!0),this.options.dispText)t={shortHelp:this.options.dispText,updateModel:!1};else if(!0===i||!0===this.options.isOther)t={shortHelp:this.getLabel(),updateModel:!1};else{let o=this.getTreeDocument();if(o&&o.isGroupingApplied())t=0===(t=this.getGroups().join("/")).length?{shortHelp:this.getLabel(),updateModel:!1}:{shortHelp:t,updateModel:!1};else{let o=e.cellView.collectionView;t=n.executeGenericTooltip(e,o)}}return t},l}),define("DS/ENXNav/models/_xNavCVParser",["i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENXNav/models/xNavNodeModel","DS/PADServices/utils/HideShowController","DS/PADServices/utils/AttributesMgtV2","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADProbes","DS/PADUtils/PADCommandProxy","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADPredicatesNls","i18n!DS/ENXNav/assets/nls/ENXNav.json","UWA/Utils"],function(e,t,n,o,i,s,r,a,l,d,c,u){"use strict";var p={COLLAPSED:{state:"collapsed"},NO_CHILDREN:{state:"noChildren"},PARTIALLY_EXPANDED:{state:"partiallyExpanded"},EXPANDED:{state:"expanded"}};Object.freeze(p);var h,g,f,v="ds6w:Document",m=r.create(),b={},_={};function D(e,t){var n=!1;if(UWA.is(e,"object")&&UWA.is(t,"array")){var o=0,i=t.length,s=e.getID();do{s===t[o].getID()&&(n=!0),o++}while(!1===n&&o<i)}return n}function S(e,t){for(var n={},o=e||{},i=Object.getOwnPropertyNames(o),s=0;s<i.length;s++)t[i[s]]?t[i[s]]!==e[i[s]]&&(n[i[s]]=e[i[s]]):n[i[s]]=e[i[s]];return n}function x(e,t,n){var o=!1,i=null,s={};t.label!==e.options.label&&(s.label=t.label,!0===require("DS/PADUtils/PADSettingsMgt").getSetting("tree_order_in_label")&&(s.label+="(treeorder="+t.relationOrder+")"),o=!0);if(function(e,t){if(e instanceof Array&&t instanceof Array){var n=e.length;if(n===t.length){for(var o=0;o<n;o++)if(typeof e[o]!=typeof t[o]&&"object"==typeof e[o]){if(void 0!==e[o]&&void 0!==t[o]&&e[o].iconPath!==t[o].iconPath)return!1}else if(e[o]!==t[o])return!1;return!0}return!1}return!1}(t.icons,e.options.icons)||(s.icons=t.icons,o=!0),t.thumbnail!==e.options.thumbnail&&(s.thumbnail=t.thumbnail,o=!0),t.display!==e.options.display&&(s.display=t.display,o=!0),t.type!==e.options.type&&(s.type=t.type,o=!0),t.relcount!==e.options.relcount){s.relcount=t.relcount,o=!0;var r=e.getChildren();0===s.relcount&&null!==r&&(s.children=null,i=p.NO_CHILDREN),s.relcount>0&&null===r&&(s.children=[],i=p.COLLAPSED)}null!==i||"expanding"!==e.getState()||n&&!1===n.changeState||(i=p.EXPANDED),t.relationOrder!==e.options.relationOrder&&(s.relationOrder=t.relationOrder,o=!0),!UWA.is(t.isPADHidden,"boolean")&&!UWA.is(t.isPADHiddenBackEnd,"boolean")||t.isPADHidden===e.options.isPADHidden&&e.options.isPADHidden===t.isPADHiddenBackEnd||(s.isPADHidden=t.isPADHidden,s.isPADHiddenBackEnd=t.isPADHiddenBackEnd,s.isPADHiddenBackEndReference=t.isPADHiddenBackEndReference,s.isPADHiddenBackEndInstance=t.isPADHiddenBackEndInstance,s.isPADHiddenBackEndOcc=t.isPADHiddenBackEndOcc,s.hsStatusOn=t.hsStatusOn,o=!0),void 0!==t.isHiddenState&&t.isHiddenState!==e.options.isHiddenState&&(s.isHiddenState=t.isHiddenState,o=!0),e.isRoot()&&(t.grid||(t.grid={}),t.grid.instanceName||(t.grid.instanceName=""));var a=S(t.grid,e.options.grid);if(UWA.equals(a,{})||(s.grid=a,o=!0),t.padgrid){var l=S(t.padgrid,e.options.padgrid);UWA.equals(l,{})||(s.padgrid=l,o=!0)}o&&(n&&!0===n.deleteTempOptions&&(delete e.options.waiting4validation,delete e.options.alternText),e.updateOptions(s),e._manageNLS=!0,n&&n.needRequestNls&&e.isVisible()&&d.updateNLS(e)),i&&e.setState(i)}function y(e,t,o,i,s,r,a,l){var d=e.getID(),c=[];if(!0===r&&C(e),o.nodes[d]){var u=UWA.clone(o.nodes[d]);UWA.is(u.isPADHiddenBackEnd,"boolean")&&(u.isPADHidden=u.isPADHiddenBackEnd,u.isPADHiddenBackEnd=u.isPADHiddenBackEnd,u.isPADHiddenBackEndReference=u.isPADHiddenBackEnd,u.hsStatusOn="reference",e.options.isPADHidden=void 0);var p=e.getRelationID(),h=o.nodes[p];h&&(u.relationOrder=h.relationOrder,u.grid=UWA.extend(h.grid,u.grid),UWA.is(h.isPADHiddenBackEnd,"boolean")&&(u.isPADHidden=h.isPADHiddenBackEnd,u.isPADHiddenBackEnd=h.isPADHiddenBackEnd,u.isPADHiddenBackEndInstance=h.isPADHiddenBackEnd,u.hsStatusOn="instance",e.options.isPADHidden=void 0)),n.defaultHiddenState(u),l&&l.needRequestNls?x(e,u,l):x(e,u),n.gatherParentsIfHidden(c,e),n.calculateParents(c);for(var g=e.getChildren(),f=0;g&&f<g.length;f++){var v=g[f].getRelationID(),m=a&&o.nodes[v]&&o.nodes[v].did?a[o.nodes[d].did][o.nodes[v].did]:void 0;l&&l.needRequestNls?y(g[f],e,o,i,s,r,m,l):y(g[f],e,o,i,s,r,m)}void 0!==a&&UWA.is(a[o.nodes[d].did].isPADHiddenBackEndOcc,"boolean")&&(e.options.hsStatusOn="occurence",e.options.isPADHidden=a[o.nodes[d].did].isPADHiddenBackEndOcc,e.options.isPADHiddenBackEnd=a[o.nodes[d].did].isPADHiddenBackEndOcc,e.options.isPADHiddenBackEndOcc=a[o.nodes[d].did].isPADHiddenBackEndOcc)}else{for(var b,_=!1,D=0;D<i.length&&!1===_;D++)(_=i[D].node.isDescendantOf(e))&&(b=i[D].root);if(!0===_){var S=e.getLeaves();if(S.length)for(var w=0;w<S.length;w++){var P=S[w];(t=P.getParent()).removeChild(P),s.push({node:t,root:b})}else t.removeChild(e)}}}function C(e){e.getState()===p.EXPANDED.state&&e.setState(p.PARTIALLY_EXPANDED)}function w(e){return UWA.is(e,"string")?"true"===e.toLowerCase():UWA.is(e,"boolean")?e:void 0}function P(e,t,n,o,i){n===t.length?e[o]=i:e[t[n]]&&P(e[t[n]],t,n+1,o,i)}function N(e,t,n){e[t]?e[t].push(n):(e[t]=[],e[t].push(n))}function A(e,t){if(void 0!==e&&Date.now()-t>e)throw{type:"TimeoutError"}}return b.buildStructure=function(e){var t={nodes:{},did_to_resourceid:{},structure:{}},n=[],o=[],i=[];e.results.forEach(function(e){if(e.attributes){var s={};e.attributes.forEach(function(e){"resourceid"===e.name||"physicalid"===e.name?s.resourceid=e.value:"did"===e.name&&(s.did=e.value)}),t.nodes[s.resourceid]=s,s.did&&(t.did_to_resourceid[s.did]=s.resourceid)}if(e.path){var r=e.path,a=r.length,l=r[0];if(3===a){r[1];var d=r[2];-1===o.indexOf(d)&&o.push(d)}-1===i.indexOf(l)&&i.push(l),n.push(r)}});var s=[],r=[],a={};try{i.forEach(function(e){0===o.length||-1===o.indexOf(e)?s.push(e):r.push(e),a[e]={children:[]},n.forEach(function(t){3===t.length&&e===t[0]&&a[e].children.push(t)})})}catch(e){console.error(e)}var l={};try{var d=function(e,n){var o=n[1],i=n[2],s=t.did_to_resourceid[o],r=t.did_to_resourceid[i];if(e&&void 0===e[s]&&(e[s]={},e[s][r]={},a[i])){var l=a[i].children;l&&l.forEach(function(t){d(e[s][r],t)})}};s.forEach(function(e){var n=t.did_to_resourceid[e],o={};a[e].children.forEach(function(e){d(o,e)}),l[n]=o})}catch(e){console.error(e)}return l},b.parse_expand=function(e,t,n,o,i){var r=s.createProbe("parse_expand"),a={nodes:{},did_to_resourceid:{},structure:{}},l=require("DS/PADUtils/PADSettingsMgt");void 0===f&&(f=l.getSetting("activateDGV"));let d=e.length;for(let s=0;s<d;s++){let r=e[s];if(r.attributes){var c=_.parse_attributes(r.attributes,t,n);a.nodes[c.resourceid]=c,UWA.is(c.did)&&(a.did_to_resourceid[c.did]=c.resourceid)}else if(r.path){var u;if(!1===o){u=r.path.length;var p=function(e){if(e){for(var t=Object.getOwnPropertyNames(e),n=0;n<t.length;n++)a.nodes[t[n]]&&(e[a.nodes[t[n]].did]=e[t[n]],delete e[t[n]],UWA.is(e[a.nodes[t[n]].did],"object")&&p(e[a.nodes[t[n]].did]),void 0===e.order&&(e.order=[]),e.order.push(a.nodes[t[n]].did));void 0===e.order&&(e.order=[])}};p(i),a.structure=i}else{var h=a.structure;u=r.path.length,1===Math.abs(u%2)?r.path.forEach(function(e,t){h.hasOwnProperty(e)||(h[e]={},u===t+1&&(h[e].pathLeaf=!0),0===Math.abs(t%2)&&(h[e].order=[])),h.order&&-1===h.order.indexOf(e)&&h.order.push(e),h=h[e]}):!0}}else if(r.icon__default_thumbnail_2d)r.icon__default_thumbnail_2d.forEach(function(e){e.did.forEach(function(t){var n=a.did_to_resourceid[t],o=a.nodes[n];o.icons&&0!==o.icons.length||(o.icons||(o.icons=[]),!0===f?o.icons.push({iconPath:"url("+e.icon+")"}):o.icons.push(e.icon)),o.thumbnail&&0!==o.thumbnail.length||(o.thumbnail=e.thumbnail_2d,o.grid||(o.grid={}),o.grid.thumbnail=!0===f?e.thumbnail_2d:"url("+e.thumbnail_2d+")")})});else if(r.pgp_overload)for(var g=Object.getOwnPropertyNames(r.pgp_overload),v=0;v<g.length;v++){var m=g[v],b=(m=m.replace(/[\[\]']+/g,"")).split(",").map(function(e){return e.trim()});r.pgp_overload[g[v]]["PGPShowExtension.V_PGP_Show"]&&P(a.structure,b,0,"isPADHiddenBackEndOcc",!w(r.pgp_overload[g[v]]["PGPShowExtension.V_PGP_Show"]))}else r.status&&"EXPAND_WAS_CUT_MAX_OUTPUT_PATHS"===r.status&&(a.status={expandTooLarge:!0})}return r.end(),a},_.internalsForTestAccess=function(e){return b.buildStructure(e)},_.parse_attributes=function(e,t,n){var o=require("DS/PADUtils/PADSettingsMgt");void 0===h&&(h=!0===o.getSetting("pgpFromServer")||!0===o.getSetting("supportPgpBasedOnDescription"))&&(g=o.getSetting("pgpFromServer")?["bo.pgpshowextension.v_pgp_show","ro.pgpshowextension.v_pgp_show"]:["ro.plminstance.V_description"]),void 0===f&&(f=o.getSetting("activateDGV"));for(var i={},s=void 0,r=0;void 0===s&&r<e.length;r++)"ds6w:globaltype"===e[r].name.toLowerCase()&&(s=e[r].value);if("ds6w:Instance"!==s&&""!==s&&void 0!==s){let r=e.length;for(let m=0;m<r;m++){let r=e[m];if("type"===r.name)r.name="ds6w:type";else if(-1!==r.name.indexOf("/")){var a=r.name.split("/");r.name=a[a.length-1]}if(UWA.is(r.value)&&UWA.is(r.value.replace,"function")&&(r.value=r.value.replace(/\n/g," ")),"ds6w:type"===r.name&&(i.type=r.value),"FALSE"!==r.value&&"TRUE"!==r.value||(r.value="TRUE"===r.value),r.value&&UWA.is(r.value,"string")&&-1!==r.value.indexOf("[")&&-1!==r.value.indexOf("]")){r.value=JSON.parse(r.value);var d=/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+)?(([+-]\d\d:\d\d)|Z)?$/i,c=[];Array.isArray(r.value)&&r.value.length>0&&(r.value.forEach(function(e){if(d.test(e)){var t=e.slice(0,10).replace(/-/g,"/");c.push(t)}}),c.length>0&&(r.value=c))}if(""===r.value){var p=require("DS/PADServices/utils/AttributesMgtV2").getColumn(r.name);!p||"boolean"!=p.kind&&"boolean"!=p.typeRepresentation||(r.value=void 0)}if("resourceid"===r.name||"physicalid"===r.name)i.resourceid=r.value;else if("did"===r.name)i.did=r.value;else if("TreeOrder"===r.name||"ro.plminstance.V_treeorder"===r.name)i.relationOrder=parseFloat(r.value),isNaN(i.relationOrder)&&(i.relationOrder=-1);else if("matrixtxt"===r.name)l.checkNotIdentity(r.value)&&(i.grid||(i.grid={}),i.grid["positionMatrix-Instance"]=r.value);else if("type_icon_url"===r.name)i.icons||(i.icons=[]),!0===f?i.icons.push({iconPath:"url("+r.value+")",className:"dgv-icons"}):i.icons.push(r.value);else if("preview_url"===r.name||"thumbnail_2d"===r.name)i.thumbnail=r.value,i.grid||(i.grid={}),i.grid.thumbnail=!0===f?r.value:"url("+r.value+")";else if("svg"===r.name){var v=r.value;v&&v.length>0&&(i.grid||(i.grid={}),i.grid.svg||(i.grid.svg=[]),i.grid.svg.push({format:r.name,id:r.value}))}else if("relcount"===r.name)i.relcount=parseInt(r.value),0===i.relcount&&(i.children=null);else if("ds6w:kind"===r.name)i.grid||(i.grid={}),i.grid["ds6w:kind"]||(i.grid["ds6w:kind"]=[]),i.grid["ds6w:kind"].push(r.value);else if(n&&r.name===n&&"ds6w:Instance"!==s)i.label=r.value,i.display=i.label;else if(t&&-1!==t.indexOf(r.name))i.grid||(i.grid={}),void 0!==i.grid[r.name]?(i.grid[r.name]=u.splat(i.grid[r.name]),i.grid[r.name].push(r.value)):i.grid[r.name]=r.value;else if(i.padgrid||(i.padgrid={}),h&&-1!==g.indexOf(r.name.toLowerCase()))i.isPADHiddenBackEnd=!w(r.value);else{i.grid||(i.grid={});let e=r.dispValue?r.dispValue:r.value;void 0!==i.grid[r.name]?(i.grid[r.name]=u.splat(i.grid[r.name]),i.grid[r.name].push(e)):i.grid[r.name]=e,i.padgrid[r.name]=e}o.getSetting("activateFUN085903")&&"ds6w:globalType"===r.name&&(i.grid||(i.grid={}),i.grid.globaltype=r.value)}}else{let n=e.length;for(let s=0;s<n;s++){let n=e[s];if("ds6w:type"===n.name&&(i.type=n.value),"resourceid"===n.name||"physicalid"===n.name)i.resourceid=n.value;else if("did"===n.name)i.did=n.value;else if("TreeOrder"===n.name||"ro.plminstance.V_treeorder"===n.name)i.relationOrder=parseFloat(n.value),isNaN(i.relationOrder)&&(i.relationOrder=-1);else if("matrixtxt"===n.name)l.checkNotIdentity(n.value)&&(i.grid||(i.grid={}),i.grid["positionMatrix-Instance"]=n.value);else if(t&&-1!==t.indexOf(n.name+"-Instance"))i.grid||(i.grid={}),void 0!==i.grid[n.name+"-Instance"]?(i.grid[n.name+"-Instance"]=u.splat(i.grid[n.name+"-Instance"]),i.grid[n.name+"-Instance"].push(n.value)):i.grid[n.name+"-Instance"]=n.value;else if(i.padgrid||(i.padgrid={}),h&&-1!==g.indexOf(n.name.toLowerCase()))i.isPADHiddenBackEnd=!w(n.value);else{i.grid||(i.grid={});let e=n.dispValue?n.dispValue:n.value;void 0!==i.grid[n.name+"-Instance"]?(i.grid[n.name+"-Instance"]=u.splat(i.grid[n.name+"-Instance"]),i.grid[n.name+"-Instance"].push(e)):i.grid[n.name+"-Instance"]=e,i.padgrid[n.name+"-Instance"]=e}o.getSetting("activateFUN085903")&&"ds6w:globalType"===n.name&&(i.grid||(i.grid={}),i.grid.globaltypeInstance=n.value)}}return i.relationOrder||(i.relationOrder=-1),i.grid||(i.grid={}),i},_.update_instances=function(e){var t=[];e.treedocument.withTransactionUpdate(function(){e.response.results.forEach(function(n){if(n.attributes){for(var i="",s=0;s<n.attributes.length;s++){var r=n.attributes[s];if("resourceid"===r.name){i=r.value;break}}e.newRelIds&&-1!==e.newRelIds.indexOf(i)&&e.treedocument.getRoots().forEach(function(s){var r=s.getNodesByRelId(i);r.length&&r.forEach(function(s){var r=function(t,n){var i=_.parse_attributes(n.attributes,o.getAvailableColumns(),o.getTreeColumn());return UWA.is(e.treedocument.filterAttributesForUpdate,"function")&&(i=e.treedocument.filterAttributesForUpdate({node:t,node_opts:i})),i&&0===i.relcount&&(i.children=null),i}(s,n),a=s.getLabel();delete r.resourceid,r&&"VPMInstance"===r.type&&delete r.type,r.display=a,r.label=a,r.instanceMatrix&&(r.relationid=i,r.grid.instanceMatrix=r.instanceMatrix);var l=s.getState();s.updateOptions(r),d.updateNLS(s),l===p.EXPANDED&&s.setState({state:p.PARTIALLY_EXPANDED}),t.push(s)})})}})}),e.editCfg?e.treedocument.refreshCfgValues({relids:e.newRelIds}):t.length&&e.treedocument.fillAttributesAsync4VisibleNodes(t)},_.process={fetch:function(e){s.createProbe("process_fetch");if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");require("DS/PADUtils/PADSettingsMgt");e.treedocument.withTransactionUpdate(function(){var s=[],r=[],a=function(e){for(var t=[],n=[],o={},i=e.length,s=0;s<i;s++)for(var r=e[s],a=r.attributes,l=a.length,d=0;d<l;d++){var c=a[d],u=c.name,p=u.split("/");if("ds6w:type"===(u=p[p.length-1])||"type"===u){var h=c.value;-1===n.indexOf(h)?(n.push(h),t.push({type:h,displayType:c.dispValue}),N(o,h,r)):N(o,h,r)}}return{types:t,resultsByType:o}}(e.response.results);0===a.types.length&&console.error("No types to validate"),i.isTypesAuthorized(a.types,function(i){i.forEach(function(i){var r=a.resultsByType[i];UWA.is(r,"array")&&r.forEach(function(i){if(UWA.is(i.attributes,"array")){var r=_.parse_attributes(i.attributes,o.getAvailableColumns(),o.getTreeColumn());UWA.is(r.isPADHiddenBackEnd,"boolean")&&(r.isPADHidden=r.isPADHiddenBackEnd,r.isPADHiddenBackEndReference=r.isPADHiddenBackEnd,r.hsStatusOn="reference"),n.defaultHiddenState(r);var a=new t(r);if(e.rootsWithFilters){var l=function(e,t){for(var n,o=0;o<t.length;o++)if(e===t[o].rootId&&t[o].filter){(n=t[o].filter).filterId=t[o].filterId,n.filterName=t[o].filterName;break}return UWA.is(n,"string")?JSON.parse(n):n}(a.getID(),e.rootsWithFilters);l&&(a.options.config_filter=l.config_filter,a.options.sequence_filter=l.sequence_filter,a.options.filterId=l.filterId,a.options.filterName=l.filterName)}if(e.config_filter&&e.config_filter[r.resourceid]&&(a.options.config_filter=e.config_filter[r.resourceid]),a.options.config_filter||a.options.sequence_filter)if(!0===f){if(a.options.icons&&a.options.icons.length){var c=UWA.clone(a.options.icons[0]);c.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},a.updateOptions({icons:[c]})}}else{a.setBadges({bottomRight:"filter"})}e.treedocument.addRoot(a),s.push(a);var u=e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&(u+=e.treedocument.detachedRoots.length),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:u,added_node:a}}),d.updateNLS(a)}else e.onFailure&&e.onFailure(new Error("Invalid result format - attributes isn't an array"))})}),e.onComplete&&e.onComplete({toselect:s,hidden:r})},!0)})},expand:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.root_nodes,"array")&&!0!==e.root2Create||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results should be an array");e.starting_from_root=void 0===e.starting_from_root||e.starting_from_root;var i=require("DS/PADServices/utils/GlobalModelEvents"),r=Date.now(),a=e.treedocument.isGroupingApplied();A(e.parseTimeout,r);var l=[],c=require("DS/PADUtils/PADSettingsMgt"),u=c.getSetting("activateFUN085903")&&(-1===e.expand_level||e.expand_level>1),h=(c.getURLParameter("filter3DPartRep"),!0===c.getSetting("alwaysExpandPath")||c.getSetting("pgpFromServer")),g=s.createProbe("transactionWithUpdate_expand"),f=e.selectPathLeaf;e.treedocument.prepareBroadcastSelect(),e.treedocument.withTransactionUpdate(function(){var g;if("refresh"===e.mode&&!1===e.response.full_path)if(e.needNewStructure)g=b.buildStructure(e.response);else{g={};for(var _=function(e,t){if(void 0===e[t.getRelationID()]){e[t.getRelationID()]={},e[t.getRelationID()][t.getID()]={};for(var n=t.getChildren(),o=0;n&&o<n.length;o++)_(e[t.getRelationID()][t.getID()],n[o])}},S=e.treedocument.getRoots(),y=0;y<S.length;y++){g[S[y].getID()]={};for(var C=S[y].getChildren(),w=0;C&&w<C.length;w++)_(g[S[y].getID()],C[w])}}var P=b.parse_expand(e.response.results,o.getAvailableColumns(),o.getTreeColumn(),e.response.full_path,g);A(e.parseTimeout,r);var N,I="expanded",E=!1,O=!1,M=!1,F=e.expand_level;switch(e.mode){case"find_in_ctx":I="partiallyExpanded",E=!0,F=-1,N=[],u=!1;break;case"insert":I="partiallyExpanded",O=!0,f="boolean"!=typeof f||f,u=c.getSetting("activateFUN085903");break;case"refresh":F=-1,M=!0,u=!1;break;case"filter":!0,u=!1}var R=!1;P.status&&(i.publish({event:"ENXModel/Expand/expandStatus",data:{mode:e.mode,status:P.status}}),!0===P.status.expandTooLarge&&(R=!0,I="partiallyExpanded","function"==typeof e.setExpandStatus&&e.setExpandStatus({expandTooLarge:!0})));var T=function(t){for(var n=[],o=0;e.root_nodes&&o<e.root_nodes.length;o++){if(e.root_nodes[o].getID()===t){n=[e.root_nodes[o]];break}var i=e.root_nodes[o].getNodesById(t);void 0!==i&&i.length>0&&(n=n.concat(i))}return n},k=function(e,t){var n=!1;t&&t.length>0&&(t=(t=t.trim().split("*").join("")).toLowerCase());try{var o=[];o.push(e.options.label),o.push(e.options.subLabel),o.push(e.options.description),o.push(e.options.type),o.push(e.options.grid["ds6w:cadMaster"]),o.push(e.options.grid["ds6wg:revision"]),e.options.grid["ds6w:status"]&&(-1!==e.options.grid["ds6w:status"].toLowerCase().indexOf("work")?(o.push("In Work"),o.push("IN_WORK")):o.push(e.options.grid["ds6w:status"])),o.push(e.options.grid.globaltype),e.options.grid["ds6w:description"]&&o.push(e.options.grid["ds6w:description"]),e.options.grid["ds6w:label-Instance"]&&o.push(e.options.grid["ds6w:label-Instance"]),e.options.relationtype&&o.push(e.options.relationtype);for(var i=0;i<o.length;i++)if(o[i]&&o[i].length>0&&-1!==o[i].trim().toLowerCase().indexOf(t)){n=!0;break}}catch(e){console.error(e)}return n},U=e.findInCtx_query,B=[],V=function(o,i,s,l,d){var c=i.getChildren(),g=M&&null!==c?[].concat(c):void 0,b=[],_=!1,S=[];A(e.parseTimeout,r);var y=!1;!0===o.pathLeaf&&(U&&0!==U.length?(y=k(i,U),f&&y&&i.select(),UWA.is(e.addedPaths,"function")&&N.push(i.getOccurencePath())):(f&&i.select(),UWA.is(e.addedPaths,"function")&&N.push(i.getOccurencePath())));var C,w,F,T=o.order;if(T.length>0){var W,X=-1,L=[];if(c&&c.length>0)for(W=0;W<c.length;W++)L.push(c[W].options.relationOrder),c[W].options.relationOrder>X&&(X=c[W].options.relationOrder);-1===X&&(_=!0);var G=i.hasChildren();for(!1===G&&i.options._childrenFilterInfo&&i.options._childrenFilterInfo.filteredOutChildren.length&&(G=!0),W=0;W<T.length;W++){var j=T[W];if(void 0!==P.did_to_resourceid[j]){var H=P.did_to_resourceid[j],q=P.nodes[H].type,z=P.nodes[H].relationOrder,K=P.nodes[H],J=Object.getOwnPropertyNames(o[j])[0],Q=P.did_to_resourceid[J],Y=null;G&&(Y=i.getChildByIds(H,Q));var $=!1;if(UWA.is(Y,"object")){if(!0===M||!0===Y.options.waiting4validation){var Z=UWA.clone(P.nodes[Q]);Z.relationOrder=z,Z.grid=UWA.extend(K.grid,Z.grid);var ee=!1;Y.options.isPADHidden=void 0,UWA.is(Z.isPADHiddenBackEnd,"boolean")&&(Z.isPADHidden=Z.isPADHiddenBackEnd,Z.isPADHiddenBackEndReference=Z.isPADHiddenBackEnd,Z.hsStatusOn="reference",ee=!0),UWA.is(K.isPADHiddenBackEnd,"boolean")&&(Z.isPADHidden=K.isPADHiddenBackEnd,Z.isPADHiddenBackEndInstance=K.isPADHiddenBackEnd,Z.hsStatusOn="instance",ee=!0),void 0!==Y.options.isPADHiddenBackEndOcc&&(Z.isPADHidden=Y.options.isPADHiddenBackEndOcc,ee=!0),!1===ee&&(Z.isPADHidden=void 0,Z.isPADHiddenBackEnd=void 0,Z.isPADHiddenBackEndReference=void 0,Z.isPADHiddenBackEndInstance=void 0,Z.hsStatusOn=void 0),delete Y.options.waiting4validation,delete Y.options.alternText;var te={};!0===M&&(Z.isPADHiddenBackEndInstance||Z.isPADHiddenBackEndReference||n.defaultHiddenState(Z),te.needRequestNls=!0),!0===h&&D(Y,e.realExpandedNodes)&&(te.changeState=!1),x(Y,Z,te),!0===Y.options.isPADHidden&&m.hide({paths:[Y.getOccurencePath()]}),b.push(Y);let t=!1,o=Y.getReferenceValue("ds6w:kind");!o||-1===o.indexOf("3DPart")||Y.getReferenceValue("ds6w:globalType")!==v&&Y.getReferenceValue("ds6w:globaltype")!==v||(t=!0),!0===t?(Y.setState({state:"noChildren"}),Y.options.children=null):("noChildren"===Y.getState()||"expanded"===Y.getState()&&(Y.options.children&&0===Y.options.children.length||null===Y.options.children))&&(Y.setState({state:"collapsed"}),Y.options.children=[])}g&&(w=Y,F=void 0,-1!==(F=(C=g).indexOf(w))&&C.splice(F,1))}else{$=!0;var ne=UWA.clone(P.nodes[Q]);ne.relationid=H,ne.relationtype=q,ne.relationOrder=z,ne.grid=UWA.extend(K.grid,ne.grid,!0),UWA.is(ne.isPADHiddenBackEnd,"boolean")&&(ne.isPADHidden=ne.isPADHiddenBackEnd,ne.isPADHiddenBackEndReference=ne.isPADHiddenBackEnd,ne.hsStatusOn="reference"),UWA.is(K.isPADHiddenBackEnd,"boolean")&&(ne.isPADHidden=K.isPADHiddenBackEnd,ne.isPADHiddenBackEndInstance=K.isPADHiddenBackEnd,ne.hsStatusOn="instance"),n.defaultHiddenState(ne),!0===require("DS/PADUtils/PADSettingsMgt").getSetting("tree_order_in_label")&&(ne.label+="(treeorder="+z+")"),Y=new t(ne);var oe=null,ie=!1;if(a&&i.isRoot()){var se="refresh"!==e.mode&&e.stateGrouping!==p.COLLAPSED.state;if(oe=e.treedocument.getGroupingNode(i,Y),e.realExpandedNodes&&!0===e.realExpandedNodes[0].isGroupingNode&&e.realExpandedNodes[0].getGroupID()!==oe.getGroupID()){if(!0!==oe.options.isOther){console.warn("Ignore node ["+Y.getLabel()+"] because it doesn't belong to the expected classification node");continue}ie=!0}else!0===se&&e.treedocument.setGrpPartialExpandState(oe)}if(d&&d[Y.options.relationid]){var re=d[Y.options.relationid];if(re.before){var ae=null;if((Ce=i.getChildren())&&Ce.length)for(var le=0;le<Ce.length;le++){var de=Ce[le].options.relationid;if(de&&de===re.before){ae=Ce[le],L.splice(le,0,z);break}}oe?oe.insertBefore(Y,ae):i.insertBefore(Y,ae)}else oe?oe.addChild(Y):i.addChild(Y),X=z,L.push(z)}else if(z>=X)oe?oe.addChild(Y):i.addChild(Y),X=z,L.push(z);else{ae=null;if(Ce=i.getChildren()){le=0;for(var ce=Ce.length;le<ce;le++)if(L[le]>z){ae=Ce[le],L.splice(le,0,z);break}}oe?oe.insertBefore(Y,ae):i.insertBefore(Y,ae)}n.gatherParentsIfHidden(S,Y),B=B.concat(S),Y.options.grid.globaltype===v&&(Y.setState({state:"noChildren"}),Y.options.padstate="noChildren",Y.childComputed=!R),!0===_&&b.push(Y),Y._manageNLS=!0,!0===ie&&oe.setState(p.PARTIALLY_EXPANDED)}n.calculateParents(S);var ue=-1===l?l:l-1;(ue>0||-1===ue)&&($||Y.getTreeDocument())?V(o[j][J],Y,s,ue):O&&Y.select()}else console.error("Invalid CV id ["+j+"]")}var pe=D(i,e.realExpandedNodes),he=function(e,t,n){var o=!1;if(e&&Array.isArray(t)){var i=0,s=t.length,r=!1;do{if(e.isDescendantOf(t[i])){if(-1===n)o=!0;else{var a=e.getOccurencePath(),l=a.indexOf(t[i].getID());(a.length-l)%2<=n&&(o=!0)}r=!0}i++}while(!1===r&&i<s)}return o}(i,e.realExpandedNodes,s),ge=i.getState(),fe=i.getRoot();if(E||O?i.childComputed=!1:!0===h&&!1===pe&&!1===he&&("filter"!==fe.options.badges.bottomRight||fe.options.icons&&fe.options.icons[0].badges&&"filter"!==fe.options.icons[0].badges.bottomRight)&&R?i.childComputed=!1:i.childComputed=!R&&("expandingState"!==ge&&"expandState"!==ge&&"partiallyExpanded"!==ge),!0!==M){let e=i.getReferenceValue("ds6w:kind");u&&e&&-1!==e.indexOf("3DPart")&&1===i.getChildren().length?(i.setState({state:"collapsed"}),i.options.padstate="collapsed"):!0===h?(pe||he||O||E)&&(i.setState({state:I}),i.options.padstate=I):(i.setState({state:I}),i.options.padstate=I)}}else if(!0!==M){var ve=i.getDepth();s&&(-1===s||s>ve)?E||O?(i.childComputed=!1,O?i.select():U&&0!==U.length?i.isSelected()||(y=k(i,U))&&i.select():i.select()):!0===h?-1===s?null!=c&&0!==c.length||(i.childComputed=!R,i.options.children=null,i.setState({state:"noChildren"}),i.options.padstate="noChildren",i._expandState="noExpandState"):T.length&&(i.setState({state:I}),i.options.padstate=I):(i.childComputed=!R,i.options.children=null,i.setState({state:"noChildren"}),i.options.padstate="noChildren",0!==ve&&-1!==s||(i._expandState="noExpandState")):null!==i.options.relcount&&0===i.options.relcount&&(i.setState({state:"noChildren"}),i.options.padstate="noChildren",i.childComputed=!R,i.options.children=null,O&&i.select(),E&&(U&&0!==U.length?i.isSelected()||(y=k(i,U))&&i.select():i.select()))}if(null!=g&&g.length>0&&g.forEach(function(e){null!=e&&!0===M&&!0!==e.isGroupingNode&&i.removeChild(e)}),b.length>0&&!0!==e.treedocument.isGroupingApplied()&&!0!==M){var me=!1;if(!e.noCheckOrder)for(var be=0;be<b.length;be++)for(var _e=b[be].getParent().getChildren(),De=1;De<_e.length;De++){var Se=_e[De-1],xe=_e[De];if(Se.options.relationOrder>xe.options.relationOrder){me=!0,console.warn("Wrong order between "+Se.getLabel()+" with order "+Se.options.relationOrder+" and "+xe.getLabel()+" with order "+xe.options.relationOrder);break}}if(me)for(var ye=0;ye<b.length;ye++){var Ce,we=b[ye],Pe=we.getParent(),Ne=we.getBrothers();if((Ce=Pe.getChildren()).length>1)for(var Ae=0;Ae<Ne.length;Ae++)if(Ne[Ae].options.relationOrder>we.options.relationOrder){var Ie=Ce.indexOf(we);if(Ce.indexOf(Ne[Ae])<Ie){var Ee=Pe.removeChild(we);Pe.insertBefore(Ee,Ne[Ae]);break}}}}UWA.is(o.isPADHiddenBackEndOcc,"boolean")&&(i.options.hsStatusOn="occurence",i.options.isPADHidden=o.isPADHiddenBackEndOcc,i.options.isPADHiddenBackEndOcc=o.isPADHiddenBackEndOcc,n.defaultHiddenState(i.options),n.gatherParentsIfHidden(S,i),B=B.concat(S),n.calculateParents(S))},W=Object.getOwnPropertyNames(P.structure),X=UWA.clone(e.root_nodes?e.root_nodes:[],!1),L=s.createProbe("treat_expand");if(e.occurencePaths&&e.occurencePaths.length>0)e.occurencePaths.forEach(function(t){var n,o=e.treedocument.getNodeByOccurencePath(t);if(e.pathOrdering&&(n=e.pathOrdering),o){var i=P.nodes[o.getID()];UWA.is(i.isPADHiddenBackEnd,"boolean")&&(i.isPADHidden=i.isPADHiddenBackEnd,i.isPADHiddenBackEndReference=i.isPADHiddenBackEnd,i.hsStatusOn="reference");for(var s,r=Object.keys(P.did_to_resourceid),a=0;a<r.length;a++)if(P.did_to_resourceid[r[a]]===o.getID()){s=r[a];break}var l=P.structure[s];V(l,o,F,F,n),x(o,i)}});else if(W.length>0)for(var G=0;G<W.length;G++){var j=W[G];if(P.did_to_resourceid.hasOwnProperty(j)){var H=T(P.did_to_resourceid[j]);if(0===H.length&&!0===e.root2Create){var q=P.nodes[P.did_to_resourceid[j]];UWA.is(q.isPADHiddenBackEnd,"boolean")&&(q.isPADHidden=q.isPADHiddenBackEnd,q.isPADHiddenBackEndReference=q.isPADHiddenBackEnd,q.hsStatusOn="reference");var z=new t(q);e.treedocument.addRoot(z),z._manageNLS=!0;var K=e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&(K+=e.treedocument.detachedRoots.length),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:K,added_node:z}}),H.push(z)}0!==H.length?(H.forEach(function(t){if(void 0!==t){var o=X.indexOf(t);o>-1&&X.splice(o,1);var i=P.nodes[P.did_to_resourceid[j]];t.options.isPADHidden=void 0,UWA.is(i.isPADHiddenBackEnd,"boolean")&&(i.isPADHidden=i.isPADHiddenBackEnd,i.isPADHiddenBackEndReference=i.isPADHiddenBackEnd,i.hsStatusOn="reference"),!0===M&&(delete i.relationOrder,i.isPADHiddenBackEndReference||n.defaultHiddenState(i));var s,r=P.structure[j];V(r,t,F,F),!0===h&&D(t,e.realExpandedNodes)&&(s={changeState:!1}),x(t,i,s),!0===M&&("noChildren"===t.getState()||"expanded"===t.getState()&&(t.options.children&&0===t.options.children.length||null===t.options.children))&&(t.setState({state:"collapsed"}),t.options.children=[]),d.updateNLS(t)}}),n.calculateParents(B,!0),UWA.is(e.addedPaths,"function")&&e.addedPaths(N),UWA.is(e.hideToggleNodes,"function")&&e.hideToggleNodes(l),i.publish({event:"ENXModel/Expand/parseDone"})):console.error("Invalid root id: "+j)}}e.treedocument.pushBroadcastSelect(),L.end()}),g.end()},insert_temporary_branches:function(n){if(!UWA.is(n.treedocument,"object")||!UWA.is(n.branches,"array"))throw new Error("Invalid input parameters");var o=[],i=[],s=[],r=[],l=[],d=n.treedocument,u=n.node_state?n.node_state:"partiallyExpanded",p=n.branches;return d.withTransactionUpdate(function(){p.forEach(function(p){var h,g=null,v=n.treedocument.getRoots(),m=n.treedocument.getDetachedRoots(),b=0;for(h=0;h<v.length&&null===g;h++)if(p[0]===v[h].getID()){r.push(p[0]);var _=(g=v[h]).getNodeByPath(p,void 0,void 0,!0);_&&(g=_,b=p.indexOf(g.getID()))}for(h=0;h<m.length&&null===g;h++)if(p[0]===m[h].getID()){r.push(p[0]);var D=(g=m[h]).getNodeByPath(p,void 0,void 0,!0);if(D)if(g=D,b=p.indexOf(g.getID()),!0===n.temporary_root)require("DS/PADUtils/views/PADAlert").displayNotification({msg:e.detachRootFound,eventID:"info"})}if(!0===n.temporary_root&&null===g){var S={resourceid:p[0],label:c.loadingText,icons:[{iconPath:"url("+a.getWebappsAssetUrl("ENXNav","icons/32/loading22x22.gif")+")"}],thumbnail:a.getWebappsAssetUrl("ENXNav","icons/32/loading.gif"),alternText:c.loadingText,waiting4validation:!0};if(g=new t(S),n.config_filter&&n.config_filter[p[0]]&&(g.options.config_filter=n.config_filter[p[0]]),g.options.config_filter||g.options.sequence_filter)if(!0===f){if(g.options.icons&&g.options.icons.length){var x=UWA.clone(g.options.icons[0]);x.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},g.updateOptions({icons:[x]})}}else{g.setBadges({bottomRight:"filter"})}d.addRoot(g),-1===o.indexOf(p[0])&&o.push(p[0]);var y=d.getRoots().length;UWA.is(d.detachedRoots,"array")&&(y+=d.detachedRoots.length),d.getModelEvents().publish({event:"onRootAdded",data:{nb_root:y,added_node:g}})}if(g)if(g.getID()===p[p.length-1]){if(!0!==n.forceCollapsed&&null!==g.getRoot()){var C=g.reverseExpand({state:u});C.ids.length&&(o=o.concat(C.ids)),C.relids.length&&(l=l.concat(C.relids))}}else for(var w=b+1;w<p.length;w+=2){var P=p[w],N=p[w+1],A={resourceid:N,relationid:P,label:c.loadingText,icons:[{iconPath:"url("+a.getWebappsAssetUrl("ENXNav","icons/32/loading22x22.gif")+")"}],thumbnail:a.getWebappsAssetUrl("ENXNav","icons/32/loading.gif"),alternText:c.loadingText,waiting4validation:!0},I=new t(A),E=g.getState();d.isGroupingApplied()&&g.isRoot()&&I.hide(),g.addChild(I),"collapsed"===E?(u!==E&&(g.setState({state:u}),g.options.padstate=u),g.childValidationChecker()):"partiallyExpanded"===E&&(g.setState({state:E}),g.options.padstate=E,-1===i.indexOf(N)&&i.push(N),-1===s.indexOf(P)&&s.push(P)),g=I,-1===o.indexOf(N)&&o.push(N),-1===l.indexOf(P)&&l.push(P)}})}),{ids_to_fetch:o,relationids:l,rootsAlreadyLoaded:r,visibleNodesIds:i,visibleNodesRelIds:s}},refresh_nodes:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object")||!UWA.is(e.refresh_parameters,"object"))throw new Error("Invalid input parameters");var n=[],i=[],s=function(t,n){var i=_.parse_attributes(n.attributes,o.getAvailableColumns(),o.getTreeColumn());return UWA.is(e.treedocument.filterAttributesForUpdate,"function")&&(i=e.treedocument.filterAttributesForUpdate({node:t,node_opts:i})),i&&0===i.relcount&&(i.children=null),i},r=require("DS/PADUtils/PADSettingsMgt");return e.treedocument.withTransactionUpdate(function(){e.response.results.forEach(function(a){for(var l="",c=0;c<a.attributes.length;c++){var u=a.attributes[c];if("resourceid"===u.name){l=u.value;break}}if(""===l)throw new Error("Resourceid not found in fetch result for "+JSON.stringify(a));if(e.refresh_parameters.created&&-1!==e.refresh_parameters.created.indexOf(l)){var p=_.parse_attributes(a.attributes,o.getAvailableColumns(),o.getTreeColumn()),h=new t(p);e.treedocument.addRoot(h),d.updateNLS(h);e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&e.treedocument.detachedRoots.length,e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.treedocument.getRoots().length,added_node:h}}),i.push(h),n.push(h.getID())}else if(e.refresh_parameters.modified&&(-1!==e.refresh_parameters.modified.indexOf(l)||e.ids_modified&&-1!==e.ids_modified.indexOf(l))){e.treedocument.getRoots().forEach(function(e){var t=e.getNodesById(l);if(t.length)t.forEach(function(e){e.updateOptions(s(e,a)),d.updateNLS(e),null===e.options.children&&e.setState({state:"noChildren"}),i.push(e)});else{var n=e.getNodesByRelId(l);n.length&&n.forEach(function(e){var t=s(e,a);delete t.resourceid,e.updateOptions(t),d.updateNLS(e),i.push(e)})}});var g=e.treedocument.searchRootById(l);g&&(g.updateOptions(s(g,a)),d.updateNLS(g),0===g.options.relcount&&g.setState({state:"noChildren"}),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.treedocument.getRoots().length,added_node:g}}),i.push(g))}else e.refresh_parameters.relationids&&-1!==e.refresh_parameters.relationids.indexOf(l)&&e.treedocument.getRoots().forEach(function(e){e.getNodesByRelId(l).forEach(function(e){var t=_.parse_attributes(a.attributes,o.getAvailableColumns(),o.getTreeColumn()),n=e.getLabel();!0===r.getSetting("tree_order_in_label")&&(n+="(treeorder="+t.relationOrder+")"),e.updateOptions({label:n,relationOrder:t.relationOrder}),d.updateNLS(e);var s=e.getParent(),l=e.getBrothers(),c=s.getChildren();if(c.length>1)for(var u=0;u<l.length;u++)if(l[u].options.relationOrder>e.options.relationOrder){var p=c.indexOf(e);if(c.indexOf(l[u])<p){var h=s.removeChild(e);s.insertBefore(h,l[u]);break}}i.push(e)})})})}),i.length&&e.treedocument.fillAttributesAsync4VisibleNodes(i),n},validateAndUpdateBranches:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results should be an array");var t=s.createProbe("transactionWithUpdate_validateBranch"),i=e.selectPathLeaf,r=e.forcePartiallyExpanded;e.treedocument.withTransactionUpdate(function(){var t=b.parse_expand(e.response.results,o.getAvailableColumns(),o.getTreeColumn(),e.response.full_path),a=function(t){for(var n=null,o=e.treedocument.getRoots(),i=e.treedocument.getDetachedRoots(),s=0;s<o.length;s++)if(o[s].getID()===t){n=[o[s]];break}for(var r=0;r<i.length&&null===n;r++)if(i[r].getID()===t){n=[i[r]];break}return n},l=[],c=function(e,o,s){var a=o.getChildren(),u=(null!==a&&[].concat(a),[]);!0===e.pathLeaf&&i&&o.select();var p=e.order;if(p.length>0){for(var h=-1,g=[],f=0;null!==a&&f<a.length;f++)g.push(a[f].options.relationOrder),a[f].options.relationOrder>h&&(h=a[f].options.relationOrder);for(var v=0;v<p.length;v++){var m=p[v];if(t.did_to_resourceid.hasOwnProperty(m)){var b=t.did_to_resourceid[m],_=(t.nodes[b].type,t.nodes[b].relationOrder),D=t.nodes[b],S=Object.getOwnPropertyNames(e[m])[0],y=t.did_to_resourceid[S],C=o.getChildByIds(b,y);if(!UWA.is(C,"object")){console.error("All nodes should have been created");break}var w=UWA.clone(t.nodes[y]);w.grid=UWA.extend(D.grid,w.grid),UWA.is(w.isPADHiddenBackEnd,"boolean")&&(w.isPADHidden=w.isPADHiddenBackEnd,w.isPADHiddenBackEndReference=w.isPADHiddenBackEnd,w.hsStatusOn="reference"),UWA.is(D.isPADHiddenBackEnd,"boolean")&&(w.isPADHidden=D.isPADHiddenBackEnd,w.isPADHiddenBackEndInstance=D.isPADHiddenBackEnd,w.hsStatusOn="instance"),n.defaultHiddenState(w),x(C,w,{deleteTempOptions:!0}),C.isVisible()&&(C._manageNLS=!0,d.updateNLS(C)),!0===r&&"expanded"===C.getState()&&C.setState({state:"partiallyExpanded"});var P=C.getLabel();!0===require("DS/PADUtils/PADSettingsMgt").getSetting("tree_order_in_label")&&(P+="(treeorder="+opts_2_modified.relationOrder+")"),C.updateOptions({label:P,relationOrder:_}),n.gatherParentsIfHidden(u,C),l=l.concat(u);var N=C.getParent(),A=C.getBrothers(),I=N.getChildren();if(I.length>1)for(var E=0;E<A.length;E++)if(A[E].options.relationOrder>C.options.relationOrder){var O=I.indexOf(C);if(I.indexOf(A[E])<O){var M=N.removeChild(C);N.insertBefore(M,A[E]);break}}n.calculateParents(u,!1,!0),c(e[m][S],C,-1)}else console.error("Invalid CV id ["+m+"]")}}UWA.is(e.isPADHiddenBackEndOcc,"boolean")&&(o.options.hsStatusOn="occurence",o.options.isPADHidden=e.isPADHiddenBackEndOcc)},u=Object.getOwnPropertyNames(t.structure),p=s.createProbe("treat_expand");if(u.length>0)for(var h=0;h<u.length;h++){var g=u[h];if(t.did_to_resourceid.hasOwnProperty(g)){var f=a(t.did_to_resourceid[g]);void 0!==f?f.forEach(function(n){if(void 0!==n){var o=t.nodes[t.did_to_resourceid[g]];n.options.isPADHidden=void 0,UWA.is(o.isPADHiddenBackEnd,"boolean")&&(o.isPADHidden=o.isPADHiddenBackEnd,o.isPADHiddenBackEndReference=o.isPADHiddenBackEnd,o.hsStatusOn="reference"),x(n,o,{deleteTempOptions:!0}),n.childComputed=!0,d.updateNLS(n),!0===r&&"expanded"===n.getState()&&n.setState({state:"partiallyExpanded"});var i=e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&(i+=e.treedocument.detachedRoots.length),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:i,added_node:n}});var s=t.structure[g];c(s,n,-1)}}):console.error("Invalid root id: "+g)}}n.calculateParents(l,!0,!0),p.end()}),t.end()},validateMultiExpand:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results should be an array");e.selectPathLeaf;var t=e.forcePartiallyExpanded,n={nodes2relaunch:[]};e.treedocument.withTransactionUpdate(function(){var i;if(!1===e.forcePartiallyExpanded){i={};for(var s=function(e,t){if(void 0===e[t.getRelationID()]){e[t.getRelationID()]={},e[t.getRelationID()][t.getID()]={};for(var n=t.getChildren(),o=0;n&&o<n.length;o++)s(e[t.getRelationID()][t.getID()],n[o])}},r=e.treedocument.getRoots(),a=0;a<r.length;a++){i[r[a].getID()]={};for(var l=r[a].getChildren(),d=0;l&&d<l.length;d++)s(i[r[a].getID()],l[d])}}for(var c=b.parse_expand(e.response.results,o.getAvailableColumns(),o.getTreeColumn(),e.response.full_path,i),u=(r=e.treedocument.getRoots(),0);u<r.length;u++){var p=r[u],h=p.getID();if(c.nodes[h]){var g=c.nodes[h];UWA.is(g.isPADHiddenBackEnd,"boolean")&&(g.isPADHidden=g.isPADHiddenBackEnd,g.isPADHiddenBackEnd=g.isPADHiddenBackEnd,g.isPADHiddenBackEndReference=g.isPADHiddenBackEnd,g.hsStatusOn="reference");var f={needRequestNls:!0};if(x(p,g,f),!0===t&&C(p),l=p.getChildren()){l=l.slice();for(var v=0;l&&v<l.length;v++){var m=c.structure[c.nodes[h].did],_=l[v].getRelationID(),D=m&&c.nodes[_]&&c.nodes[_].did?m[c.nodes[_].did]:void 0;y(l[v],p,c,e.treatedNodes,n.nodes2relaunch,t,D,f)}}}else for(var S=0;S<e.treatedNodes.length;S++)if(e.treatedNodes[S].root.getID()===p.getID()&&!e.isFilter){if(e.treatedNodes[S].node.getID()===p.getID()){e.treedocument.removeRoot(p);break}var w=e.treatedNodes[S].node.getParent();w&&(w.removeChild(e.treatedNodes[S].node),n.nodes2relaunch.push({node:w,root:p}))}}e.onComplete(n)})}},_}),define("DS/ENXNav/commands/ProductToPart",["i18n!DS/ENXNav/assets/nls/ENXNav","DS/Controls/Button","DS/Controls/ComboBox","DS/PADServices/utils/PlatformURL","DS/PADServices/ws/WSAccess","DS/WebappsUtils/WebappsUtils","DS/ENXNav/models/_xNavCVParser","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/PADUtils/PADWSAccess","DS/PADUtils/PADSession","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/views/PADAlert","DS/PADUtils/PADContext"],function(e,t,n,o,i,s,r,a,l,d,c,u,p,h){"use strict";return{execute:function(e){this.targetDiv=document.querySelector(".pse-root");var t=this;if(t.elements={},t.parameters=e,t.selectedProductID=t.parameters.model.getSelectedNodes()[0].options.resourceid,t.displayTitle=e.model.getSelectedNodes()[0].options.display,1==e.model.getSelectedNodes().length&&null!=e.model.getSelectedNodes()[0].options.grid["ds6w:cadMaster"]){var n=e.model.getSelectedNodes()[0].options.grid["ds6w:cadMaster"];t._buildContent(n).then(function(e){t._chooseTemplate(e).then(function(e){e&&t._productToPart(e)})})}},_buildContent:function(t){var r=this;return r.selectedCAD=t,new Promise(function(t){(i.getTemplates?Promise.resolve():o.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0})).then(function(){i.getTemplatesV2().then(function(o){if("success"===o.status&&o.result)var i=function(e,t){for(var n=new a({shouldBeSelected:function(e){return e.options.selectable}}),o=t[0].attributes.volatileAttributes[0].rangeGroup,i=o.filter(function(e,t,n){return n.indexOf(e)==t&&"3DEXPERIENCE"!==e}).sort(),r=t[0].attributes.volatileAttributes[0].range,d=t[0].attributes.volatileAttributes[0].rangeNLS,c=0;c<i.length;c++)if("3DEXPERIENCE"==e||e==i[c].split(" ").join("")){var u=new l({label:i[c],selectable:!1});n.addRoot(u);for(var p=0;p<o.length;p++)o[p]===i[c]&&n.addRoot(new l({label:"      "+d[p],template:r[p],icons:[{iconPath:s.getWebappsAssetUrl("PADServices","icons/cadmasters/I_CADMaster"+o[p].toUpperCase().split(" ").join("")+".png")}],selectable:!0}))}return n.expandAll(),n}(r.selectedCAD,o.result);r.elements.container=document.createElement("div"),r.elements.container.classList.add("product-to-part-container"),r.elements.text=document.createElement("div"),r.elements.text.classList.add("prod-to-part-label"),r.elements.text.innerText=e.productToPartCmd.templateLabel,r.elements.container.appendChild(r.elements.text);var d=r.elements.comboBox=new n({enableSearchFlag:!1,elementsTree:i});d.getContent().classList.add("prod-to-part-combobox"),d.inject(r.elements.container),r.elements.text=document.createElement("div"),r.elements.text.classList.add("prod-to-part-description-text"),r.elements.text.innerText=e.productToPartCmd.descriptionText,r.elements.container.appendChild(r.elements.text),t(d)})})}.bind(this))},_chooseTemplate:function(t){var n=this;return n.combobox=t,new Promise(function(t){require(["DS/PADServices/views/ENXModal","DS/Controls/Button"],function(o,i){n.modalStop=new o({target:n.targetDiv,title:e.productToPartCmd.title+"  -  "+n.displayTitle,resizableFlag:!1,height:"auto",width:"auto",touchMode:!0,position:{my:"center",at:"center"},content:n.elements.container,buttons:{Cancel:new i({label:e.productToPartCmd.cancel,touchMode:!0,onClick:function(){t(!1),n.modalStop.close()}}),Ok:new i({label:e.productToPartCmd.convert,touchMode:!0,onClick:function(){var e={template:n.combobox.elementsTree.getAllDescendants()[n.combobox.selectedIndex].options.template,pid:[n.selectedProductID]};t(e),n.modalStop.close()}})},closeCB:function(){}})})})},_productToPart:function(t){var n=this;n.data=t,(i.findInCtx?Promise.resolve():o.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0})).then(function(){i.productToPart({enopad_webapis:!0,data:{intent:"explore_2D",select_predicate:["ds6w:type"],select_file:["icon","thumbnail_2d"]},pids:n.data.pid,template:n.data.template,onComplete:function(t){n.parameters.model.invalidateViewPort();var i=UWA.is(t,"string")?JSON.parse(t):t;i.results&&1===i.results.length?1==i.results.length&&n.parameters.model.wrapInTransaction(function(){c.setAuthoringState(!0,u.PADSession_disabling_index_from_server),r.process.fetch({treedocument:n.parameters.model,response:i,onComplete:function(t){p.displayNotification({eventID:"info",msg:e.productToPartCmd.successNotif});var i=h.get(),s=t.toselect[0].getOccurencePath();t&&t.toselect&&t.toselect.length>0&&i.dispatchEvent("onAddPaths",{addedPaths:[s]});var r={tenant:o.getPlatformId(),pids:s};i._commandProxy.drop(r),n.parameters.model.unselectAll(),n.parameters.model.getNodeByOccurencePath(s).select()},onFailure:function(e){console.error(e)}})}):(p.displayNotification({msg:u.object_not_found_in_db,eventID:"error",key:"enxNav-productToPart-object-not-found-in-db"}),parameters.callback&&parameters.callback("error"))},onTimeout:function(){p.displayNotification({msg:u.timeout,eventID:"error",key:"enxNav-productToPart-timeout"}),n.parameters.callback&&n.parameters.callback("error")},onFailure:function(t,n){var o=e.productToPartCmd.err_generic_server;if((n=UWA.is(n,"string")?JSON.parse(n):n)&&n.attributeMap&&n.attributeMap.error_code)switch(n.attributeMap.error_code.value){case 3:o=e.productToPartCmd.err_product_under_change;break;case 4:o=e.productToPartCmd.err_product_with_conf}p.displayNotification({msg:o,eventID:"error",key:"enxNav-productToPart-err-product"}),t.callback&&t.callback("error")}})})}}}),define("DS/ENXNav/models/_xNavGrouping",["i18n!DS/ENXNav/assets/nls/ENXNav.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","text!DS/PADServices/assets/init/DefaultColorStream.json","DS/ENXNav/models/xNavNodeModel","DS/ENXNav/models/_xNavCVParser","DS/ENOXParser/modules/TwoDParser","UWA/Class","UWA/Utils","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/GlobalUtils","DS/Utilities/UUID"],function(e,t,n,o,i,s,r,a,l,d,c,u,p,h,g,f){"use strict";function v(e){for(var t=e;t&&!t.isRoot()&&!0===t.isGroupingNode;)"collapsed"===t.getState()&&t.setState({state:"partiallyExpanded"}),t=t.getParent()}function m(e,t){return e&&e.hasOwnProperty(t)?e[t]:e.grid[t]}function b(e){for(var t=e;t&&!t.isRoot()&&!0===t.isGroupingNode;)t.expand(),t=t.getParent()}function _(e){var t=e.getChildren();for(let e=0;e<t.length;e++)!0===t[e].isGroupingNode?_(t[e]):t[e].select()}function D(e){var t=[],n=e.getChildren();for(let e=0;e<n.length;e++)!0===n[e].isGroupingNode?t=t.concat(D(n[e])):t.push(n[e]);return t}function S(e){let t=null;for(;e.getParent()&&null===t;)(e=e.getParent()).isGroupingNode?t=e:S(e);return t}var x="true"!==g.getURLParameter("noFlatGrouping"),y=0;const C=JSON.parse(n),w=180*(3-Math.sqrt(5));var P=r.extend({});return P.prototype.getGroupLayout=function(){return x?"compact":"structured"},P.prototype.isGroupingApplied=function(){return this.options.isGroupingApplied},P.prototype.isGroupColorApplied=function(){return!!this.options.coloredGroups},P.prototype.getGroupingNode=function(e,t,n){var o,i=e.getID(),s=this.options.mapGrpNodes[i];if(s){var r=this.__getKeyFromNode(t);r||(r="other"),this.options.mergedMap[r]&&(r=this.options.mergedMap[r]),(o=s[r])||(o=s.other?s.other:this.__createOtherNode(s,e,"",[])),n&&v(o)}return o},P.prototype.getGroupingNodeV2=function(e,t,n){var o;let i=!1;var s=this.options.mapGrpNodes[e];if(s){var r=this.__getKeyFromNodeV2(t);r||(r="other"),this.options.mergedMap[r]&&(r=this.options.mergedMap[r]),(o=s[r])||("other"!==r&&(i=!0),o=s.other?s.other:this.__createOtherNode(s,this.getNodesById(e)[0],"",[])),n&&v(o)}let a={shouldBeNewGroup:!1,groupNode:o,actualGroupKey:r};return i&&(a.shouldBeNewGroup=!0),a},P.prototype.setGrpPartialExpandState=function(e){v(e)},P.prototype.cleanGrouping=function(){this.options.mapGrpNodes={},this.options.isGroupingApplied=!1,this.options.groupPredicates=[],this.options.selectedTags=[],this.options.realSelectedTags=[],this.options.mergedMap={},this.options.groupingFilterInProgress=!1;for(var e=this.getRoots(),t=0;t<e.length;t++)e[t].options.childComputed=!1},P.prototype.cleanGroupingForRoots=function(e){let t=e.rootIds?e.rootIds:[];for(let e=0;e<t.length;e++)delete this.options.mapGrpNodes[t[e]]},P.prototype.getGroupingForOpen=function(){let e=void 0;if(this.options.isGroupingApplied){console.log("Groups:\n"+JSON.stringify(this.options.groups,null,2)),e=[];for(let t=0;t<this.options.groups.length;t++){let n=[];for(let e=0;e<this.options.groups[t].object.length;e++)n.push(this.options.groups[t].object[e].object);e.push({predicate:this.options.groups[t].predicate,tags:n})}}return e},P.prototype.clearCachedHiddenNodes=function(){delete this.options.hiddenNodes},P.prototype.__applyGrouping=function(e){var t=this;return this.isGroupColorApplied()&&this.__removeColorGroupCmd(),!0===this.options.groupingFilterInProgress?(console.debug("Grouping with filter in progress"),Promise.resolve()):new Promise(n=>{var o=e.fromGroupingEvent||e.fromApplyFilter||e.fromLayoutChange;if(o)if(e.roots){let n=[];for(let t=0;t<e.roots.length;t++)n.push(e.roots[t]);t.cleanGroupingForRoots({rootIds:n})}else t.cleanGrouping();this.options.groupingFilterInProgress=!0,this.options.hiddenNodes=new Map;let i=Array.isArray(e.roots)&&e.roots.length?e.roots:this.getRoots();for(let e=0;e<i.length;e++){let t=i[e],n=t.getAllDescendants().filter(e=>0===e.options.isHiddenState);n.length>0&&this.options.hiddenNodes.set(t,n)}t.__collapseAllRoots({roots:e.roots,noGroupUpdate:e.noGroupUpdate}).then(i=>{var s=[];if(e.groups.length){t.options.groups=e.groups;for(let e=0;e<t.options.groups.length;e++)for(let n=0;n<t.options.groups[e].object.length;n++)if(Array.isArray(t.options.groups[e].object[n].object)){var r="",a=t.options.groups[e].object[n].object;for(let e=0;e<a.length;e++)r+=a[e],-1===t.options.selectedTags.indexOf(r)&&t.options.selectedTags.push(r),r+="/";let o=t.options.groups[e].object[n].object.join("/");t.options.realSelectedTags.push(o)}else{let o=[t.options.groups[e].object[n].object];if(Array.isArray(t.options.groups[e].object[n].merged))for(let i=0;i<t.options.groups[e].object[n].merged.length;i++)o.push(t.options.groups[e].object[n].merged[i].object),t.options.mergedMap[t.options.groups[e].object[n].merged[i].object]=t.options.groups[e].object[n].object;t.options.selectedTags=t.options.selectedTags.concat(o),t.options.realSelectedTags=t.options.realSelectedTags.concat(o)}t.options.selectedTags=t.options.selectedTags.filter(function(e,n){return t.options.selectedTags.indexOf(e)===n}),t.options.realSelectedTags=t.options.realSelectedTags.filter(function(e,n){return t.options.realSelectedTags.indexOf(e)===n});var l=Promise.resolve();if(!0!==e.noGroupUpdate&&(l=t.__retrieveGrps(e)),i.length){var u=t.__fetchChildren({lstRemoveChildren:i,groupingPromise:l,noGroupUpdate:e.noGroupUpdate}).then(()=>{t.options.isGroupingApplied=!0});s.push(u)}else t.options.isGroupingApplied=!0;s.push(l)}else{for(let e=0;e<t.options.groupPredicates.length;e++)d.removeBIColumn(t.options.groupPredicates[e]);t.options.groupPredicates=[]}Promise.allSettled(s).then(()=>{c.publish({event:"ENXModel/Model/ApplyGrouping/Done",data:{fromEvent:o,status:!0}}),t.options.groupingFilterInProgress=!1,n()})})})},P.prototype.__groupsLayoutCmd=function(e){let t=!0;switch(e.mode){case"structured":t=!1;break;default:case"compact":t=!0}t!==x&&(x=t,this.__applyGrouping({groups:this.options.groups,fromLayoutChange:!0}))},P.prototype.__collapseAllRoots=function(e){var t=this;return new Promise(n=>{var o=Array.isArray(e.roots)&&e.roots.length?e.roots:t.getRoots();this.prepareUpdate();var i=[];for(let t=0;t<o.length;t++){var s=o[t];if(s){var r=s.getState(),a=[],l=0;let t=s.getChildren();for(;t.length-l;){var d=!0;if(!0===t[l].isRelationsObjectNode&&(d=!1,!0!==e.noGroupUpdate&&!0===t[l].isGroupingNode&&(d=!0)),d){var c=s.removeChild(t[l]);a.push({rootID:s.getID(),node:c})}else l++}!0!==e.noGroupUpdate&&(s.setState({state:"collapsed"}),s.options.padstate="collapsed",s.childComputed=!1),"expanded"!==r&&"partiallyExpanded"!==r||(i=i.concat(a))}}this.pushUpdate({updateType:WUXModelUpdateTypes.Removal}),n(i)})},P.prototype.__retrieveGrps=function(e){var t=this;return new Promise(n=>{var o=Array.isArray(e.roots)?e.roots:t.getRoots();o=Array.isArray(e.roots)?e.roots:t.getRoots();let i=[];for(let n=0;n<o.length;n++)i.push(t.__retrieveGrpsOnNode(o[n],e));Promise.allSettled(i).then(n)})},P.prototype.__retrieveGrpsOnNode=function(e,t){var n=this;return new Promise((o,i)=>{var s;console.log("Apply grouping on node "+e.getLabel()),s=u.getGroupingNodes?Promise.resolve():p.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0});var r=n.options.groupPredicates=[];for(let e=0;e<t.groups.length;e++)r.push(t.groups[e].predicate),d.addBIColumn(t.groups[e].predicate,!0);s.then(()=>{var s={filterBI:n.options.filterBI?n.options.filterBI:n.options.FBIProxy._biFilter,data:{},pathIds:[e.getOccurencePath()],grouping:t,is2D:!0,filter_facets:r};u.getGroupingNodes(s).then(i=>{n.__buildGrpsOnNode(e,i,t.groups).then(o)}).catch(i)})})},P.prototype.__buildGrpsOnNode=function(e,t,n){var o=this;return new Promise(i=>{t="string"==typeof t?JSON.parse(t):t;var s={},r=o.options.mapGrpNodes[e.getID()]={},a=[],l=!1;for(let i=0;i<t.results.length;i++)if(t.results[i].synthesis){var d=t.results[i].synthesis&&t.results[i].synthesis.facets?t.results[i].synthesis.facets:[];let h=n[0].object.map(e=>e.object);if((d=d.slice().sort(function(e,t){return h.indexOf(e.object)-h.indexOf(t.object)})).length)for(let t=0;t<d.length;t++){var c=d[t];if(c.sixw){var u=c.sixw.split("/"),p=u[u.length-1];-1!==o.options.groupPredicates.indexOf(p)&&(!0===x?o.__buildFlatGrping(c,e,s,a,r,n):o.__buildStructuredGrping(c,e,s,a,r,n))}}else t.results[i].synthesis.name.contains("Other")&&t.results[i].synthesis.value>0&&(l=!0)}if(!0===l||o.isEditor()){let t=o.__createOtherNode(r,e,p,a);l||t.hide()}e.setState({state:"expanded"}),i()})},P.prototype.__createOtherNode=function(t,n,i,s){var r=new o({isGroupingNode:!0,resourceid:"xnav-groupingNode-other-"+f.v4(),label:e.groupingNode.other,grid:{groupValue:e.groupingNode.other},parentNode:n,isOther:!0,ds6w:i,grp:s,groupingIntent:this.options.groups});return r.onPreExpand(this._expandGrpNode.bind(this)),t.other=r,n.addChild(r),r},P.prototype.__buildStructuredGrping=function(e,t,n,i,s){var r=e.sixw.split("/"),l=r[r.length-1],d=a.splat(e.object),c=t,u="",p="";for(let e=0;e<d.length&&(u+=d[e],-1!==this.options.selectedTags.indexOf(u)||!0===c.isGroupingNode&&c.isGrpSelected());e++){if(this.options.mergedMap[u]&&(p=u,u=this.options.mergedMap[u]),n[u])c=n[u],this.options.mergedMap[p]&&(c.options.merged=!0,c.options.grp=c.options.grp.concat(d),i.push(d));else{var g=new o({isGroupingNode:!0,resourceid:"xnav-groupingNode-"+d[e]+"-"+f.v4(),label:d[e],grid:{groupValue:d[e]},parentNode:c,ds6w:l,grp:d.slice(0,e+1),groupingIntent:this.options.groups});i.push(d.slice(0,e+1)),h.updateNLSGroupingNode(g),g.onPreExpand(this._expandGrpNode.bind(this)),c.addChild(g),(-1!==this.options.realSelectedTags.indexOf(u)||!0===c.isGroupingNode&&c.isGrpSelected())&&(-1!==this.options.realSelectedTags.indexOf(u)&&(g.options.grpSelected=!0,!0===c.isGroupingNode&&(c.options.contentRetrieved=!0,b(c))),s[u]=g),n[u]=g,c=g}u+="/"}},P.prototype.__buildFlatGrping=function(e,t,n,i,s,r){var l=e.sixw.split("/"),d=l[l.length-1],c=a.splat(e.object),u=t,p=c.join("/");this.options.mergedMap[p]&&(p=this.options.mergedMap[p]);var g,v=null;for(let e=0;r&&e<r.length;e++){let t=r[e];if(t.object)for(let e=0;e<t.object.length&&null===v;e++)t.object[e].object===p&&(v=t.object[e])}if(-1!==this.options.realSelectedTags.indexOf(p)||!0===u.isGroupingNode&&u.isGrpSelected())if(n[p])(g=n[p]).options.merged=!0,g.options.grp=g.options.grp.concat(c),i.push(c);else{var m=c[c.length-1];g=new o({isGroupingNode:!0,resourceid:"xnav-groupingNode-"+m+"-"+f.v4(),label:v?v.dispText:m,dispText:v?v.dispText:void 0,grid:{groupValue:m},parentNode:u,ds6w:d,grp:c,groupingIntent:this.options.groups}),i.push(c),h.updateNLSGroupingNode(g),g.onPreExpand(this._expandGrpNode.bind(this)),u.addChild(g),g.options.grpSelected=!0,s[p]=g,n[p]=g}else if(function(e,t){for(var n=null,o=e.length-1;o>=0;o--){var i=e.slice(0,o);if(-1!==t.indexOf(i.join("/"))){n=i;break}}return n}(c,this.options.realSelectedTags)){var b=e.object.slice(0,e.object.length-1);if(!(u=s[b.join("/")])){var _=UWA.clone(e);_.object=b,u=this.__buildFlatGrping(_,t,n,i,s)}g=this.__buildFlatGrping(e,u,n,i,s)}return g},P.prototype.grpGetOtherNode=function(e){let t=this.options.mapGrpNodes[e.getID()].other;if(t)return t.isHidden()&&t.show(),t},P.prototype._expandGrpNode=function(e){var n=this;return new Promise(o=>{var i=e.data,r=i.nodeModel,a=!!i.expandAll&&i.expandAll,c=i.state?i.state:"expanded",p=[];if(!0===r.options.contentRetrieved){if(r.setState({state:c}),e.target&&e.target.preExpandDone({preventExpandAll:!0}),a){let e=r.getChildren();for(let t=0;t<e.length;t++)!0===e[t].isGroupingNode&&p.push(n._expandGrpNode({data:{nodeModel:e[t],expandAll:!0,state:c}}))}Promise.all(p).then(o)}else{var h=parseInt("1"),f=d.createOutputsRequest(),v=l.getWebAPI_Options("navigate"),m=!1,b=[];b[0]={},b[0].predicate=r.options.groupingIntent[0].predicate,b[0].predLevel=r.options.groupingIntent[0].predLevel,b[0].other=r.options.isOther;var _,D,S=r.getGroups();if(r.options.isOther){var x=[];for(let e=0;e<S.length;e++)x.push({object:S[e]});0==x.length&&(m=!0),b[0].object=x}else r.options.merged?b[0].object=r.options.groupingIntent[0].object:b[0].object=[{object:S}];if(m?(_={pathIds:[r.getParent().getOccurencePath()],FBIProxy:n.options.FBIProxy,data:{expandLevel:h},select_relation:["ro.plminstance.v_treeorder"]},D=u.expandv2(_)):(_={filterBI:n.options.filterBI?n.options.filterBI:n.options.FBIProxy._biFilter,expandLevel:h,data:{select_bo:f.select_object,select_rel:f.select_relation,compute_select_bo:f.select_file},pathIds:[r.getOccurencePath()],iterativeFilter:v["q.iterative_filter_query_bo"],filterRel:v.no_type_filter_rel,groupingFilter:b},D=u.expandGroupingNodeV2(_)),n.prepareUpdate(),a){let e=r.getChildren();for(let t=0;t<e.length;t++)!0===e[t].isGroupingNode&&p.push(n._expandGrpNode({data:{nodeModel:e[t],expandAll:!0,state:c}}))}var y=new Promise(function(e,o){D.then(function(o){try{var i=UWA.is(o,"string")?JSON.parse(o):o;if(!0===i.timeoutOccurs)r.setState({state:"collapsed"}),g.displayNotif({message:t.find_in_context_timeout,level:"error",key:"expandGroup-timeout"});else{var a=r,d=l.getSetting("parse_timeout");d&&parseInt(d);s.parseExpandLoadModel({treeDoc:n,expandedNodes:[a],FBIProxy:n.options.FBIProxy._biFilter,wsResponse:i,nodeModelClass:n.options.nodeModelClass,expandLevel:h})}}catch(e){e.type&&"TimeoutError"===e.type?g.displayNotif({message:t.parseTimeout,level:"warning",key:"expandGroup-parse-timeout"}):g.displayNotif({message:t.generic_service_failure,level:"error",key:"expandGroup-generic-error"})}finally{if(!0!==i.timeoutOccurs&&(r.options.contentRetrieved=!0,r.setState({state:c}),!0===a.options.filtered)){var u=UWA.clone(a.options.icons[0]);u.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},a.updateOptions({icons:[u]})}e()}}).catch(function(e){r.setState({state:"collapsed"}),o()})});p.push(y),Promise.all(p).then(()=>{n.pushUpdate(),e.target&&e.target.preExpandDone({preventExpandAll:!0}),o()})}})},P.prototype.__getKeyFromNode=function(e){var t=null;if(this.options.groupPredicates.length>1)throw new Error("Too many grouping predicates");for(let i=0;i<this.options.groupPredicates.length;i++){var n=e.getReferenceValue(this.options.groupPredicates[i]+"-Instance"),o=e.getReferenceValue(this.options.groupPredicates[i]);n?"boolean"==typeof o?(!1!==n&&"FALSE"!==n||!0!==o||(n=!0),t=n.toString().toUpperCase()):t=n:t="boolean"==typeof o?o.toString().toUpperCase():o,t&&!0===Array.isArray(t)&&(1===t.length?t=t[0]:console.warn("Node ["+e.getLabel()+"] is defined in several group. Will be displayed in Other group"))}return t},P.prototype.__getKeyFromNodeV2=function(e){var t=null;if(this.options.groupPredicates.length>1)throw new Error("Too many grouping predicates");for(let i=0;i<this.options.groupPredicates.length;i++){var n=m(e,this.options.groupPredicates[i]+"-Instance"),o=m(e,this.options.groupPredicates[i]);n?"boolean"==typeof o?(!1!==n&&"FALSE"!==n||!0!==o||(n=!0),t=n.toString().toUpperCase()):t=n:t="boolean"==typeof o?o.toString().toUpperCase():o,t&&!0===Array.isArray(t)&&(1===t.length?t=t[0]:console.warn("Node ["+actualNode.getLabel()+"] is defined in several group. Will be displayed in Other group"))}return t},P.prototype.getGroupingNodesList=function(e){return this.options.mapGrpNodes&&this.options.mapGrpNodes[e]?Object.values(this.options.mapGrpNodes[e]):[]},P.prototype.__expandAllGroups=function(e){var t=this.options.mapGrpNodes[e.getID()];if(t){var n=Object.keys(t);this.withTransactionUpdate(()=>{for(let o=0;o<n.length;o++){(!0===e.isGroupingNode?e.options.parentNode.getID():e.getID())===t[n[o]].getGroupObjID()&&(t[n[o]].expandAll(),t[n[o]].options.contentRetrieved=!0,t[n[o]].setState({state:"expanded"}))}})}},P.prototype.__fetchChildren=function(e){var t=this;return new Promise(n=>{e.groupingPromise.then(()=>{var o=[],i={},s=[],r=[];for(let n=0;n<e.lstRemoveChildren.length;n++){let c=e.lstRemoveChildren[n].node;if(!0!==c.isGroupingNode&&!0!==c.isRelationsObjectNode){var a=!1;for(let e=0;!1===a&&e<t.options.groupPredicates.length;e++){var l=c.getReferenceValue(t.options.groupPredicates[e]);l?console.log("Predicate value ["+l+"] found on node "+c.getLabel()):(o.push(c.getID()),i[c.getID()]=c,a=!0);var d=c.getReferenceValue(t.options.groupPredicates[e]+"-Instance");d?console.log("Predicate value on instance ["+d+"] found on node "+c.getLabel()):(o.push(c.getRelationID()),a=!0,i[c.getRelationID()]=c)}a&&(s.push(c),r.push(e.lstRemoveChildren[n].rootID))}}var c=Promise.resolve();o.length?(console.log("Fetch the predicates values for the grouping on "+o.length+" objects"),c=new Promise(e=>{var n={pids:o,data:{select_predicate:t.options.groupPredicates.concat(["ds6w:globalType"]),select_file:[]}};u.fetch(n).then(t=>{t="string"==typeof t?JSON.parse(t):t;for(let e=0;e<t.results.length;e++){var n,o=t.results[e],s={},r=!1,a="ds6w:Part"!==s["ds6w:globalType"]&&"ds6w:Document"!==s["ds6w:globalType"];for(let e=0;e<o.attributes.length;e++)"resourceid"===o.attributes[e].name?n=i[o.attributes[e].value]:"ds6w:globalType"===o.attributes[e].name?a="ds6w:Part"!==o.attributes[e].value&&"ds6w:Document"!==o.attributes[e].value:(s[o.attributes[e].name]=o.attributes[e].value,r=!0);if(!0===r&&n){var l={grid:{}},d=Object.keys(s);for(let e=0;e<d.length;e++)a?l.grid[d[e]+"-Instance"]=s[d[e]]:l.grid[d[e]]=s[d[e]];n.updateOptions(l)}}e()})})):console.log("No Id to fetch"),c.then(()=>{for(let n=0;n<s.length;n++){var o=s[n],i=t.searchRootById(r[n]),a=t.getGroupingNode(i,o);a&&(o.show(),a.addChild(o),!0!==e.noGroupUpdate&&(a.options.contentRetrieved=!0))}n()})})})},P.prototype.__expandAllGroupsCmd=function(){var t=this;return new Promise(n=>{t.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.expandAllGroupsCmd,context:t});let o=t.getSelectedNodes();var i=[];t.withTransactionUpdate(()=>{for(let e=0;e<o.length;e++)!0===o[e].isGroupingNode&&i.push(t._expandGrpNode({data:{nodeModel:o[e],expandAll:!0,state:"expanded"}}))}),Promise.all(i).then(()=>{t.getModelEvents().publish({event:"endBlockingTransaction",context:t}),n()})})},P.prototype.focusOnGroups=function(){return this.__focusOnGroupsCmd()},P.prototype.__focusOnGroupsCmd=function(){var t=this;return new Promise(n=>{t.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.focusOnGroupsCmd,context:t});let o=t.getSelectedNodes(),i=[];var s=[];t.withTransactionUpdate(()=>{for(let e=0;e<o.length;e++)if(!0===o[e].isGroupingNode){i.push(o[e]);let n="expanded"===o[e].getState()?"expanded":"collapsed";s.push(t._expandGrpNode({data:{nodeModel:o[e],expandAll:!0,state:n}}))}}),Promise.all(s).then(()=>{t.withBroadcastSelect(()=>{for(let e=0;e<i.length;e++)_(i[e]);t.getModelEvents().publish({event:"endBlockingTransaction",context:t}),n()})})})},P.prototype.__colorizeGroupCmd=function(){var t=this;return new Promise(n=>{t.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.colorizeGroupCmd,context:t});let o=t.getSelectedNodes(),i=[];var s=[];t.withTransactionUpdate(()=>{for(let e=0;e<o.length;e++)if(!0===o[e].isGroupingNode){i.push(o[e]);let n="expanded"===o[e].getState()?"expanded":"collapsed";s.push(t._expandGrpNode({data:{nodeModel:o[e],expandAll:!0,state:n}}))}}),Promise.all(s).then(()=>{var e=[];for(let t=0;t<i.length;t++){var o=D(i[t]);e.push({groupNode:i[t],groupedPhysNode:o})}t.__buildEnrich3DColorize({colorizedGroups:e}).then(function(e){t._cmdProxy.enrich3D(e),t.getModelEvents().publish({event:"endBlockingTransaction",context:t}),n()})})})},P.prototype.__buildEnrich3DColorize=function(e){var t=this;return new Promise(function(n,o){var i;if(e.colorizedGroups){t.options.coloredGroups||(t.options.coloredGroups={});for(let n=0;n<e.colorizedGroups.length;n++){var s=e.colorizedGroups[n];if(!t.options.coloredGroups[s.groupNode.getID()]){var r=Object.keys(t.options.coloredGroups),a=s.groupedPhysNode.map(e=>e.getOccurencePath());if(void 0!==typeof a&&a.length>0){let e=t.__getNextColor();s.groupNode.updateOptions({color:e});var l=s.groupNode.getLabel(),d=(r=Object.keys(t.options.coloredGroups))?r.length+1:1;t.options.coloredGroups[s.groupNode.getID()]={coloredGprNode:s.groupNode,groupLabel:l,paths:a,style:s.style?s.style:{color:e,opacity:1,forceInherit:!0,label:l,id:d}}}}}}else delete t.options.coloredGroups;if(t.options.coloredGroups){var c=t.options.coloredGroups,u=(r=Object.keys(c),c[r[0]].coloredGprNode.getPredicate());h.retrieveDS6WNLS([u]).then(function(e){var o=e&&e[u]?e[u].label:u;i={graphicProperties:{layers:[]}};var s={label:o,id:r[0],styles:[{color:"#FFFFFF",opacity:.5,forceInherit:!1,label:"no match",id:0}],colorMap:[{resourceid:c[r[0]].paths[0][0],style:0}]};for(let e=0;e<r.length;e++){let n=c[r[e]];s.styles.push(n.style);for(let e=0;e<n.paths.length;e++){let o=n.paths[e],i=S(t.getNodeByOccurencePath(o)),r=i.options.color;!i||i.getID()!==n.coloredGprNode.getID()&&r||s.colorMap.push({path:o,style:n.style.id})}}i.graphicProperties.layers.push(s),n(i)})}})},P.prototype.__getNextColor=function(){let e;if(this.options.usedColor||(this.options.usedColor=[]),this.options.usedColor.length+1<C.colorStream.length)e=C.colorStream[this.options.usedColor.length],this.options.usedColor.push(e);else{e=function(e,t,n){n/=100;const o=t*Math.min(n,1-n)/100,i=t=>{const i=(t+e/30)%12,s=n-o*Math.max(Math.min(i-3,9-i,1),-1);return Math.round(255*s).toString(16).padStart(2,"0")};return`#${i(0)}${i(8)}${i(4)}`}(y*w,100,75),y++}return e},P.prototype.__removeColorGroupCmd=function(){this._cmdProxy.enrich3D({});let e=Object.keys(this.options.coloredGroups);for(let t=0;t<e.length;t++)this.options.coloredGroups[e[t]].coloredGprNode.updateOptions({color:null});y=0,delete this.options.coloredGroups,delete this.options.usedColor},P}),define("DS/ENXNav/utils/CtxMenuUtils",["i18n!DS/ENXNav/assets/nls/ENXNav.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ApplicationFrame/CommandsManager","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADWebInWinServices","DS/ENXNav/utils/OpenWithMenuBuilder","DS/etree/syncwidget"],function(e,t,n,o,i,s,r,a){"use strict";var l={};return l.buildMenu=function(e){var t;switch(e.view){case"datagridview":t=l.buildDGVCtx(e);break;case"treelistview":t=l.buildTreeLstCtx(e);break;case"graphview":t=l.buildGraphCtx(e);break;case"tilesthumbview":t=l.buildOtherViewCtx(e);break;default:t=Promise.resolve([])}return t},l.buildDGVCtx=function(t){return new Promise(function(n){var o=[],s=t.params.cellInfos,r=t.context,a=t.params;if(s){var d=t.params.collectionView.getColumnOrGroup(s.columnID);if(-1===s.rowID){var c={pin:!0,sizeColumnToFit:!0,firstColumnsVisibility:!1,columnsManagement:!1,view:"datagridview"};if("tree"===d.dataIndex&&(c.pin=!1),o=t.params.collectionView.buildDefaultContextualMenu(t.params,c),d.customisation&&d.customisation.layout&&!1===d.customisation.layout.removableFromView||o.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-eye-off"},title:e.PAD_CMDColumnHide,action:{context:{collectionView:t.params.collectionView,dataIndex:d.dataIndex},callback:function(e){e.context.collectionView.layout.setColumnVisibleFlag(e.context.dataIndex,!1,{isUserInteraction:!1})}}}),!0===i.getSetting("activateGroupByCtx")){var u=[],p=t.params.collectionView.layout.getVisibleOrderedColumnsIndexes();u.push({type:"PushItem",title:"None",action:{context:{dataIndex:"none",collectionView:t.params.collectionView},callback:function(e){e.context.collectionView.groupRows({dataIndexesToGroup:[]})}}});for(var h=0;h<p.length;h++){var g=t.params.collectionView.layout.getDataIndexFromColumnIndex(p[h]),f=t.params.collectionView.layout.getColumnOptionValue(g,"text");f&&u.push({type:"PushItem",title:f,action:{context:{dataIndex:g,collectionView:t.params.collectionView},callback:function(e){e.context.collectionView.groupRows({dataIndexesToGroup:[e.context.dataIndex]})}}})}o.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-group-add"},title:e.PAD_CMDColumnGroupby,submenu:u})}o.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-cog"},title:e.PAD_CMDColumnCusto,action:{context:t.context,callback:function(e){l.launchCommand({context:e.context,command:"ColumnVisibility"})}}}),l.addAdditionalColumnsCtx({context:r,menu:o,node:v,cellInfos:s,params:t.params,view:"datagridview"}).then(function(e){n(e.menu)})}else{var v=s.nodeModel;if(v)if(!1===v.isSelected()&&v.select(!0),!0===v.isRelationsObjectNode)!0===v.isRelationsObjectGroupingNode?n(null):l.addNONPSCtx({context:r,menu:o,node:v}).then(function(e){n(e.menu)});else{var m={available:!1};"positionMatrix-Instance"===d.dataIndex&&UWA.is(l.psePositionCtxCmd,"function")&&(m=l.psePositionCtxCmd(r,a)),!0===m.available?(o=m.menu,n(o)):l.addOpenWithMenu({context:r,menu:o,node:v,cellInfos:s,params:t.params,view:"datagridview"}).then(l.addTreeMenu).then(l.addCommonMenu).then(l.addAdditionalColumnsCtx).then(function(e){n(e.menu)})}else n(o)}}else n(o)})},l.buildTreeLstCtx=function(t){return new Promise(function(n){var i=[],s=t.context,r=t.params,a=t.params.treeview;if(a.isHeader){var d=a.manager,c=a.dataIndex,u=a.manager._instance._parentObject.thumbnail_size,p={type:"PushItem",icon:"url("+o.getWebappsAssetUrl("ENXNav","icons/32/I_FitToColumn.png")+")",title:e.PAD_CMDColumnToFit,action:{context:c,callback:function(e){"thumbnail"===e.context?function(e,t,n){for(var o=e.getColumnIDFromDataIndex(t),i=e.getContent().querySelectorAll('.wux-datagrid-cell[virtual-column-id="'+o+'"]'),s=0,r=0;r<i.length;r++){var a=i[r].clientWidth;a>s&&(s=a)}if(s>n){var l=function(){e.prepareUpdateView(),e.setColumnWidth(o,n),e.pushUpdateView()};e.onPostUpdateViewOnce(l),l()}}(d,e.context,u):d.sizeColumnToFit(e.context)}}};i.push(p),l.addAdditionalColumnsCtx({context:s,menu:i,params:t.params,view:"treelistview"}).then(function(e){n(e.menu)})}else{var h=a.cellView?a.cellView.getCellInfos():null,g=a.nodeModel?a.nodeModel:a.cellModel;if(g){!1===g.isSelected()&&g.select(!0);var f={available:!1};h&&"positionMatrix-Instance"===h.dataIndex&&UWA.is(l.psePositionCtxCmd,"function")&&(f=l.psePositionCtxCmd(s,r)),!0===f.available?(i=f.menu,n(i)):l.addOpenWithMenu({context:s,menu:i,node:g,cellInfos:h,params:t.params,view:"treelistview"}).then(l.addTreeMenu).then(l.addCommonMenu).then(l.addAdditionalColumnsCtx).then(function(e){n(e.menu)})}else n(i)}})},l.buildGraphCtx=function(e){return new Promise(function(t){var n=[],o=e.context,i=e.params.graphview.node;i?(!1===i.isSelected()&&i.select(!0),!0===i.isRelationsObjectNode?!0===i.isRelationsObjectGroupingNode?t(null):l.addNONPSCtx({context:o,menu:n,node:i}).then(function(e){t(e.menu)}):l.addOpenWithMenu({context:o,menu:n,node:i,params:e.params}).then(l.addGraphMenu).then(l.addCommonMenu).then(l.addAdditionalColumnsCtx).then(function(e){t(e.menu)})):t(n)})},l.buildOtherViewCtx=function(e){return new Promise(function(t){var n=[],o=e.context,i=e.params.cellInfos?e.params.cellInfos.nodeModel?e.params.cellInfos.nodeModel:e.params.cellInfos.cellModel:null;i?(!1===i.isSelected()&&i.select(!0),!0===i.isRelationsObjectNode?!0===i.isRelationsObjectGroupingNode?t(null):l.addNONPSCtx({context:o,menu:n,node:i}).then(function(e){t(e.menu)}):l.addOpenWithMenu({context:o,menu:n,node:i,params:e.params}).then(l.addCommonMenu).then(l.addAdditionalColumnsCtx).then(function(e){t(e.menu)})):t(n)})},l.addOpenWithMenu=function(t){return new Promise(function(n){var o=t.context.getPADTreeDocument().getSelectedNodes();o.length>0&&r.openWithApps(o,{iconOpenWith:{iconName:"open",fontIconFamily:1},nlsOpenWith:e.OpenWith}).then(function(e){t.menu=t.menu.concat(e),n(t)})})},l.addTreeMenu=function(e){return new Promise(function(t){UWA.is(l.pseTreeMenu,"function")&&l.pseTreeMenu(e.context,e.menu,e.node,e.cellInfos,e.view),t(e)})},l.addGraphMenu=function(t){return new Promise(function(n){var i=t.context,s=i.getPADTreeDocument().getSelectedNodes(),r=function(e,t){for(var n=t.length,o=0,i=0,s=0;s<n;s++){var r=t[s];e.getThumbnailState(r)===a.ThumbnailState.EXPANDED?o++:i++}return o>i}(i.options.views.graphview,s);t.menu.push({icon:r?"url("+o.getWebappsAssetUrl("ENXNav","icons/32/I_Collapse-thumbnail.png")+")":"url("+o.getWebappsAssetUrl("ENXNav","icons/32/I_Expand-thumbnail.png")+")",title:r?e.PAD_CMDCollapseThumb:e.PAD_CMDExpandThumb,type:"PushItem",action:{this:i,context:{nodes:s,expanded:r},callback:function(e){this.options.views.graphview.setGroupThumbnailState(e.context)}}}),n(t)})},l.addCommonMenu=function(r){return new Promise(function(a){var d=r.menu,c=r.context,u=r.node,p=n.getCommand("OpenInCADHdr",c.options.action_bar_opts&&c.options.action_bar_opts.context?c.options.action_bar_opts.context:null);p&&p.isAvailable()&&(d.push({title:t.PAD_CMDOpenInCAD,icon:"url("+o.getWebappsAssetUrl("PADUtils","icons/32/I_OpenInCAD.png")+")",type:"PushItem",action:{context:c,callback:function(e){l.launchCommand({context:e.context,command:"OpenInCADHdr"})}}}),d.push({type:"SeparatorItem"}));var h=!!u.options.isPADHidden,g=!0,f=!0,v=c.options.model.getSelectedNodes();if(v.length>1)for(var m=v[0].options.isPADHidden,b=0;b<v.length;b++)m!==v[b].options.isPADHidden&&(g=!1),v[b].isRoot()||(f=!1);else u.isRoot()||(f=!1);if(!s.isWebInWinContext()){var _={type:"PushItem",icon:"url("+o.getWebappsAssetUrl("ENXNav","icons/32/I_SsmCtxHideShow.png")+")",title:e.PAD_CMDShow,action:{callback:function(e){var t=[];v.length>1?v.forEach(function(e){t.push(e.getOccurencePath())}):t.push(u.getOccurencePath()),c._commandProxy.show({paths:t})}}},D={type:"PushItem",icon:"url("+o.getWebappsAssetUrl("ENXNav","icons/32/I_HideShow.png")+")",title:e.PAD_CMDHide,action:{callback:function(e){var t=[];v.length>1?v.forEach(function(e){t.push(e.getOccurencePath())}):t.push(u.getOccurencePath()),c._commandProxy.hide({paths:t})}}};!0===g?h?d.push(_):d.push(D):(d.push(_),d.push(D)),!0===i.getSetting("FocusCtxCommandAvailable")&&d.push({type:"PushItem",title:e.PAD_CMDFocusOn,icon:"url("+o.getWebappsAssetUrl("ENXNav","icons/32/I_FocusOn.png")+")",action:{callback:function(){var e=require("DS/PADUtils/PADUtilsServices"),t=[];v.length>1?v.forEach(function(e){t.push(e.getOccurencePath())}):t.push(u.getOccurencePath()),c._commandProxy.focus({intent:"focus",paths:t,widget:"2D",sharedID:e.getSharedId(),appID:e.getAppId()})}}}),d.push({type:"SeparatorItem"})}if(1===v.length){var S=c.render(),x=r.params.infos?r.params.infos.position:r.params.info?r.params.info.position:{x:0,y:0};d.push({type:"PushItem",title:e.PAD_CMDFindInCtx,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search-filter",family:WUXManagedFontIcons.Font3DS},action:{context:{position:x,renderTo:S,node:u},callback:function(e){require(["DS/ENXNav/utils/FindInCtx"],function(t){t.launchFindWithDialog(e.context)})}}})}"noExpandState"!==u._expandState&&(d.push({title:e.PAD_CMDExpandAll,icon:"url("+o.getWebappsAssetUrl("ENXNav","icons/32/I_ExpandAll.png")+")",state:!0===u._expandAllPending?"disabled":"enabled",type:"PushItem",action:{context:c,callback:function(e){l.launchCommand({context:e.context,command:"ExpandAll"})}}}),d.push({title:e.PAD_CMDCollapseAll,icon:"url("+o.getWebappsAssetUrl("ENXNav","icons/32/I_CollapseAll.png")+")",type:"PushItem",action:{context:c,callback:function(e){l.launchCommand({context:e.context,command:"CollapseAll"})}}})),d.push({title:e.PAD_CMDProperties,icon:"url("+o.getWebappsAssetUrl("ENOCollabSharingCmds","icons/32/I_CATSSEditorDisplayProperties.png")+")",type:"PushItem",state:c.getEditMode?c.getEditMode()?"enabled":"disabled":"enabled",action:{context:c,callback:function(e){l.launchCommand({context:e.context,command:"ActionBar_Attributes"})}}}),UWA.is(l.ccpMenu,"function")&&l.ccpMenu(c,d,u),f&&(d.push({type:"SeparatorItem"}),!0!==i.getSetting("removeDetachRoot")&&d.push({title:e.detachRoot,icon:"url("+o.getWebappsAssetUrl("ENXNav","icons/32/I_HideShow.png")+")",type:"PushItem",action:{callback:function(){for(var e=c.options.model.getSelectedNodes(),t=0;t<e.length;t++)c.toggleRoot(e[t])}}}),d.push({type:"PushItem",title:e.removeRoot,icon:{iconName:"open wux-ui-3ds-flip-vertical",fontIconFamily:1},action:{callback:function(e){for(var t=c.options.model.getSelectedNodes(),n=0;n<t.length;n++)c.options.model.removeRoot(t[n])}}})),a(r)})},l.addAdditionalColumnsCtx=function(e){return new Promise(function(t){var n=e.context;if(n.options.additionalColumnsModules&&n.options.additionalColumnsModules.length){for(var o=[],i=[],s=[],r=0;r<n.options.additionalColumnsModules.length;r++)if(n.options.additionalColumnsModules[r].getAdditionalCtxMenu){var a=new Promise(function(t){n.options.additionalColumnsModules[r].getAdditionalCtxMenu({treeDocument:n.getPADTreeDocument(),ctxParams:e.params,view:e.view,callback:function(e,n){e&&-1===s.indexOf(e)&&(s.push(e),UWA.is(n,"object")&&(i.push({type:"SeparatorItem"}),i.push(n))),t()}})});o.push(a)}Promise.all(o).then(function(){e.menu=e.menu.concat(i),t(e)})}else t(e)})},l.addNONPSCtx=function(t){return new Promise(function(n){var i=t.context;t.menu=[{title:e.PAD_CMDProperties,icon:"url("+o.getWebappsAssetUrl("ENOCollabSharingCmds","icons/32/I_CATSSEditorDisplayProperties.png")+")",type:"PushItem",state:i.getEditMode?i.getEditMode()?"enabled":"disabled":"enabled",action:{context:i,callback:function(e){l.launchCommand({context:e.context,command:"ActionBar_Attributes"})}}}],n(t)})},l.launchCommand=function(e){var t=n.getCommand(e.command,e.context.action_bar_opts&&e.context.action_bar_opts.context?e.context.action_bar_opts.context:null);t&&t.begin()},l}),define("DS/ENXNav/views/ViewLoader",["UWA/Class","UWA/Promise","DS/ENXNav/utils/CtxMenuUtils"],function(e,t,n){"use strict";var o={treelistview:"treelistview",graphview:"graphview",tileview:"tileview",thumbnailview:"thumbnailview",datagridview:"datagridview"};Object.freeze(o);var i=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],s=["onDragOverGraph","onDropBlankGraph","onDragLeaveGraph"],r=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],a=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],l=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDragStartRowHeader","onDragEndRowHeader","onDragEnterRowHeader","onDragLeaveRowHeader","onDragRowHeader","onDragOverRowHeader","onDropRowHeader","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"];return e.extend({init:function(e){this.options=e},loadView:function(e,t){var n=this;this.options.component.options.views[e]?t():this.buildOptions(e,t).then(function(o){n.requireView(e,o,t)})},requireView:function(e,t,n){var i=this,s=this.options.amd[e],r=function(){i.postLoad(e),e!==o.treelistview&&n&&n()};require([s],function(n){var s=i.options.component;s.options.views[e]=new n(t),e===o.datagridview?s.options.views[e].initialize().then(function(){r()}):r()})},postLoad:function(e){var t=this.options.component;switch(t.options.views[e].isActiveView=t.options.active_view===e,e){case o.graphview:var n=!1;t.options.views.graphview.isActiveView&&(n=!0,t.options.views.graphview.setModel(t.options.model)),t.setDnD_onGraph(),!0===t.options.layout.keyboard_inputs&&t.setKeyboardListenerOnGraph&&t.setKeyboardListenerOnGraph(),t.options.isReady.graphview=!0,n&&t.options.views.graphview.reframeAll();break;case o.treelistview:break;case o.thumbnailview:t.options.views.thumbnailview.isActiveView&&t.options.views.thumbnailview.setModel(t.options.model),t.options.isReady.thumbnailview=!0;break;case o.datagridview:t.options.views.datagridview.isActiveView&&(t.options.views.datagridview.setModel(t.options.model),t.options.views.datagridview.options.dgv.onDragStartRowHeader=function(e,n){t.onDragStartRowHeader(e,n)},t.options.views.datagridview.options.dgv.onDropRowHeader=function(e,n){t.onDropRowHeader(e,n)}),t.options.isReady.datagridview=!0;break;case o.tileview:t.options.views.tileview.isActiveView&&t.options.views.tileview.setModel(t.options.model),t.options.isReady.tileview=!0}t.options.model.applyActiveView(e)},buildOptions:function(e,t){switch(e){case o.treelistview:return this._buildTreeListViewOptions(t);case o.graphview:return this._buildGraphViewOptions();case o.tileview:return this._buildTileViewOptions();case o.thumbnailview:return this._buildThumbnailViewOptions();case o.datagridview:return this._builddatagridViewOptions();default:throw new Error("Invalid View Trying to load")}},mapCallbacks:function(e,t){var n=t,o={};return e.forEach(function(e){UWA.is(n.options.views_cb[e],"function")?o[e]=n.options.views_cb[e]:UWA.is(n[e],"function")&&(o[e]=n[e].bind(n))}),o},_buildTreeListViewOptions:function(e){var s=this;return new t(function(t,r){var a=s.options.component,l={x3dAppId:s.options.x3dAppId,renderTo:s.options.renderTo};l.active_view=UWA.clone(a.options.active_view),l.isActiveView=l.active_view===o.treelistview,l.view_customization=a.options.layout.view_customization,l.specific_columns=a.options.layout.specific_columns;var d=s.mapCallbacks(i,a);l=UWA.extend(l,d,!0),UWA.is(a.getOnContextualEvent)?l.onContextualEvent=a.getOnContextualEvent():l.onContextualEvent={this:a,callback:function(e){return n.buildMenu({view:"treelistview",context:this,params:e})}},l.events={onComplete:function(){a.options.views.treelistview=this,"treelistview"===a.options.active_view&&a.options.views.treelistview.setModel(a.options.model),a.options.isReady.treelistview=!0,e&&e()},onCustoViewChange:function(e){a.dispatchEvent("onCustoViewChange",e)},onTenantChange:function(e){a.dispatchEvent("onTenantChange",e)},onSaveAsTemplate:function(e){a.dispatchEvent("onSaveAsTemplate",e)}},a.options.additionalColumnsModules&&(l.additionalColumnsModules=a.options.additionalColumnsModules),t(l)})},_buildGraphViewOptions:function(){var e=this;return new t(function(t,n){var o=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo};i.active_view=UWA.clone(o.options.active_view),i.isActiveView="graphview"===i.active_view;var r=e.mapCallbacks(s,o);i=UWA.extend(i,r,!0),UWA.is(o.getOnContextualEvent)?i.onContextualEvent=o.getOnContextualEvent():i.onContextualEvent={this:o,callback:function(t){return e._onContextualMenuEvent({view:"graphview",context:this,params:t})}},t(i)})},_buildTileViewOptions:function(){var e=this;return new t(function(t,n){var o=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo};i.active_view=UWA.clone(o.options.active_view),i.isActiveView="tileview"===i.active_view;var s=e.mapCallbacks(r,o);i=UWA.extend(i,s,!0),UWA.is(o.getOnContextualEvent)?i.onContextualEvent=o.getOnContextualEvent():i.onContextualEvent={this:o,callback:function(t){return e._onContextualMenuEvent({view:"tilesthumbview",context:this,params:t})}},t(i)})},_buildThumbnailViewOptions:function(){var e=this;return new t(function(t,n){var o=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo};i.active_view=UWA.clone(o.options.active_view),i.isActiveView="thumbnailview"===i.active_view;var s=e.mapCallbacks(a,o);i=UWA.extend(i,s,!0),UWA.is(o.getOnContextualEvent)?i.onContextualEvent=o.getOnContextualEvent():i.onContextualEvent={this:o,callback:function(t){return e._onContextualMenuEvent({view:"tilesthumbview",context:this,params:t})}},t(i)})},_builddatagridViewOptions:function(){var e=this;return new t(function(t,n){var o=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,context:o};i.active_view=UWA.clone(o.options.active_view),i.isActiveView="datagridview"===i.active_view,i.view_customization=o.options.layout.view_customization,i.callbacks=e.mapCallbacks(l,o),o.options.additionalColumnsModules&&(i.additionalColumnsModules=o.options.additionalColumnsModules),i.onTenantChange=function(e){o.dispatchEvent("onTenantChange",e)},t(i)})},_onContextualMenuEvent:function(e){return new t(function(o){var i=n,s=t.resolve();e.context.isDynamicCtx()&&(s=new t(function(e){require(["DS/ENXNav/utils/CtxMenuUtilsV2"],function(t){i=t,e()})})),s.then(function(){i.buildMenu({view:e.view,context:e.context,params:e.params}).then(o)})})}})}),define("DS/ENXNav/models/mixins/TreeDocShared",["DS/PADServices/settings/AppSettings","DS/PADServices/utils/Batches","DS/PADServices/utils/Iterator","DS/ENOXParser/modules/TwoDParser","DS/ENXNav/models/SmartNodeOptions","DS/ENOXParser/modules/common/Helpers","DS/PADServices/ws/WSAccess"],function(e,t,n,o,i,s,r){function a(){}return a.prototype={updateNodesAttributesValue:function(n,i){for(var a=this,l=require("DS/PADServices/utils/AttributesMgtV2"),d=0;d<i.length;d++)l.addBIColumn(i[d],e.getSetting("synthesisModeOnInstance"));var c=i.slice();-1===c.indexOf("ds6w:globaltype")&&c.push("ds6w:globaltype");var u={select_predicate:c,select_file:[]};let p=e.getSetting("webapi_timeout");p<=3e4&&n.length>=1e3&&(p=6e4);return t.waiting(n,1e3,1e3,function(e,t){return new Promise(function(n,i){u.physicalid=e;let l=function(){console.log(`>> complete ${t}`),n({batchId:t,localIds:e})};r.fetch({data:u,enopad_webapis:!1,pids:e,noCompletion:!0,timeout:p}).then(function(t){var n=s.data.jsonParse(t);o.parseMultiFetch({treeDoc:a,results:n.results,refresh_parameters:{modified:e}}).then(function(){setTimeout(l,50)})}).catch(function(e){console.error(e),i({err:e})})})})},additionalColumnUpdateByModule:function(e,t){let o=this;if(!t.pids&&!t.relids)return void console.error("no to refresh");let r=new Map;t.pids&&n.iterate(t.pids,function(e){r.set(e,o.getNodesById(e))});let a=new Map;t.relids&&n.iterate(t.relids,function(e){a.set(e,o.getNodesByRelId(e))});let l=this.getVisibleAdditionalColumns(),d=null;if(n.iterate(l,function(t){t.module.getName()===e&&(d=t.module)}),d){let l={pids:t.pids,relids:t.relids};function c(e){n.iterate(e,function(e){n.iterate(e.nodeArray,function(t){let n=new i(t);n.update(e.attrUpdate),n.execute()})})}l.pids||(l.pids=[]),l.relids||(l.relids=[]),new Promise(function(t,n){console.time(e),d.updateAttributes(l,function(n){console.timeEnd(e);let o=s.data.jsonParse(n);t(o)})}).then(function(e){o.setUseChangeTransactionMode(!0),o.withTransactionUpdate(function(){if(e.pids&&t.pids){c(t.pids.map(function(t){return{attrUpdate:{grid:e.pids[t]},nodeArray:r.get(t)}}))}if(e.relids&&t.relids){c(t.relids.map(function(t){return{attrUpdate:{grid:e.relids[t]},nodeArray:a.get(t)}}))}}),o.setUseChangeTransactionMode(!1)})}}},a}),define("DS/ENXNav/features/xNavPersistPanel",["DS/ENXNav/utils/LocalStorageForAppState","DS/ENXNav/utils/TwoDAppEvents","DS/ApplicationFrame/CommandsManager"],function(e,t,n){function o(){t.onLandingPageClosed(this._restoreSidePanelsOriginalState.bind(this))}return o.prototype={setup:function(e){e&&(this.triptych=e,this._sidePanelState={left:{},right:{}},this.triptych._modelEvents.subscribe({event:"triptych-resized"},this._onPanelResized.bind(this)),this.triptych._modelEvents.subscribe({event:"triptych-panel-hidden"},this._onPanelHidden.bind(this)),this.triptych._modelEvents.subscribe({event:"triptych-panel-visible"},this._onPanelVisible.bind(this)))},_onPanelResized:function(t){this._sidePanelState[t.side].width=t.width,e.set("sidePanelState",this._sidePanelState)},_onPanelVisible:function(t){this._sidePanelState[t].isOpen=!0,e.set("sidePanelState",this._sidePanelState)},_onPanelHidden:function(t){this._sidePanelState[t].isOpen=!1,e.set("sidePanelState",this._sidePanelState)},_restoreSidePanelsOriginalState:function(){var t=n.getCommandCheckHeader("RootPanel"),o=n.getCommandCheckHeader("RightSidePanel"),i=e.get("sidePanelState");i&&(t&&i.left.isOpen&&!this.triptych._isLeftOpen&&(t.toggleState(),i.left.width&&this.triptych._modelEvents.publish({event:"triptych-set-size",data:{side:"left",size:i.left.width}})),o&&i.right.isOpen&&!this.triptych._isRightOpen&&(o.toggleState(),i.right.width&&this.triptych._modelEvents.publish({event:"triptych-set-size",data:{side:"right",size:i.right.width}})))}},Object.defineProperties(o.prototype,{name:{get:function(){return"persistPanels"}}}),o}),define("DS/ENXNav/models/mixins/TreeDocSelect",["i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADServices/utils/CompassUtils","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/CommandProxy","DS/ENXNav/utils/OFW"],function(e,t,n,o,i,s){"use strict";function r(e,t){if(e instanceof Array&&t instanceof Array){var n=e.length;if(n===t.length){for(var o=0;o<n;o++)if(e[o]!==t[o])return!1;return!0}return!1}return!1}function a(){}return a.prototype={_broadcastSelect:!0,_selected_paths:!0,initSelectCB:function(){var e=this,n=function(){e._doNotBroadcastSelect||(e._directSelection=!0,e._selected_paths=[],e._cmdProxy.select(e._buildSelectData()),!0===e._broadcastSelect&&!0===e.options.authorize_setStructure&&(t.setObject({nodes:e.getXSO().get()}),s.setTypesForOFW(e))),0===e.getSelectedNodes().length&&null!==e._pagerview&&!0!==e._focusOn&&!0!==e._reframeFocus&&(e._pagerview.hide(),delete e._pagerview,e._reframeFocus=!1),s.setTypesForOFW(e)};this.getXSO().onPostAdd(function(){n()}),this.getXSO().onPostRemove(n),this.getXSO().onEmpty(function(){!1===e._emptyFromProxy?e._pagerview?(e.searchProgress||!0===e._focusOn||e.closePager(),!0!==e._focusOn&&e.closePager()):e._inBatchingForUpdate||(e._doNotBroadcastSelect=!1):e._emptyFromProxy=!1,n()}),this.getXSO().onPreEmpty(function(){!1===e._emptyFromProxy&&(e._doNotBroadcastSelect=!0)}),document.addEventListener("keyup",function(t){27===t.keyCode&&(e.getXSO().empty(),e.restoreSelection())})},broadcastSelect:function(e){this._broadcastSelect=e,!0===this._broadcastSelect&&!0===this.options.authorize_setStructure&&(t.setObject({nodes:this.getSelectedNodes()}),s.setTypesForOFW(this))},withBroadcastSelect:function(e){this.prepareBroadcastSelect(),e(),this.pushBroadcastSelect()},prepareBroadcastSelect:function(){this._doNotBroadcastSelect=!0},pushBroadcastSelect:function(){this._cmdProxy.select(this._buildSelectData()),this.broadcastSelect(!0),this._doNotBroadcastSelect=!1},restoreSelection:function(e){if(this.originalSelection){let t=this,n=function(){t._selected_paths=t.originalSelection,t._selectOccurence("FocusOn")};e?n():this.withBroadcastSelect(n)}},isDirectSelection:function(){return this._directSelection},_onSelectProxy:function(e,t){let o=this;if(!this._insertFlag&&!0!==e.searchDone){if(1==e.focusOn&&e.sharedID&&e.sharedID!==n.getSharedId())return;var s=!1,a=e.paths;this._selected_paths=UWA.clone(a);var l=function(){try{this._doNotBroadcastSelect=!0,this._selected_paths.length?this._selectOccurence("",!0,!0):t.appid===i.appId()&&(this._emptyFromProxy=!0,this.unselectAll(),this._directSelection=!1);for(var e=[],n=0;n<this._selected_paths.length;n++){var l=this.getNodeByOccurencePath(this._selected_paths[n]);if(l){r(l.getOccurencePath(),this._selected_paths[n])&&e.push(this._selected_paths[n])}}if(e.length===a.length&&e.length>0)for(var d=0;d<e.length&&!s;d++){var c=e[d],u=c.length;if(u>2){var p=o.getNodesById(c[u-1]);p&&p.length>0&&(s=!0)}}this._selected_paths=e}finally{setTimeout(function(){this._doNotBroadcastSelect=!1}.bind(this),500)}}.bind(this);l(),!0!==e.doNotSetOnCompass&&a.length&&t.appid===i.appId()&&!0!==this._hideChildrenFilter&&!s&&(this._selected_paths=a,this.insertBranches(e.paths,{node_state:"collapsed",forceCollapsed:!0,novalidation:!0,skipDrop:!0,onComplete:function(){l()}}))}},_selectOccurence:function(e,t,n){var o=this.getRoots(),i=this._selected_paths,s=0;if(i.length>0){var r=!1;"FocusOn"!==e&&(this._doNotBroadcastSelect=!0),this.prepareUpdate();var a=[];for(s=0;s<o.length;s++){let e=o[s];for(let t=0;t<i.length;t++){var l=e.getNodeByPath(i[t]);if(l&&(r=!0,a.push(l),!l.isVisible())){for(var d=l.getParent();!d.isVisible();)d=d.getParent();d&&-1===a.indexOf(d)&&a.push(d)}}}var c=!1;if(!0!==t||!0===r){var u=this.getSelectedNodes();for(s=0;s<u.length;s++){var p=u[s];a.indexOf(p)<0&&(p.unselect(),c=!0)}}var h=a.filter(function(e){return!e.isSelected()});c=h.length>0,this.multiselect(h),!0===n&&c&&(this._directSelection=!1),this.pushUpdate(),this._doNotBroadcastSelect=!1}},_buildSelectData:function(){var e=[],t=this._selected_paths;t.length&&this.getXSO().get().length?this.getRoots().forEach(function(n){for(var o=0;o<t.length;o++){var i=n.getNodeByPath(t[o],void 0,void 0,!0);i&&e.push(i)}}):e=this.getXSO().get();this.isGroupingApplied()&&(e=e.filter(function(e){return!0!==e.isGroupingNode}));var i,s={paths:[],tenant:o.getPlatformId()};s.attributes={},s.version="1.1";i=function(e){var t=e.getID();this.attributes.hasOwnProperty(t)||(this.attributes[t]={type:e.options.type,label:e.options.label})}.bind(s),s.paths=e.map(function(e){return e.getOccurencePath(i)});var r=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");try{s.changeControl=r.get()}catch(e){console.warn("No Change")}return this._currentApp=n.getSharedId(),s.sharedID=this._currentApp,null===this._pagerview&&!0!==this._focusOn?s.focusOn=!1:s.focusOn=!0,s},getSelectedNodesForOFW:function(){var e=[],t=this._selected_paths;t&&t.length&&this.getXSO().get().length?this.getRoots().forEach(function(n){for(var o=0;o<t.length;o++){var i=n.getNodeByPath(t[o],void 0,void 0,!0);i&&e.push(i)}}):e=this.getXSO().get();return e},multiselect:function(e){var t=this,n=t.getXSO();this.prepareUpdate(),e=e.filter(function(e){return t.options.shouldBeSelected(e)}),n.add(e),this.pushUpdate()},multiunselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.remove(e),this.pushUpdate()},notifyTagger:function(){this.getModelEvents().publish({event:"setPathTags",context:this})},__copyLink:function(){let i=o.getPlatformURL("3DDashboard"),s="#app:"+n.getAppId()+"/content:X3DContentId=",r=t.buildX3DContent(this.getSelectedNodes());var a=i+s+encodeURIComponent(JSON.stringify(r));n.copyTexttoCLipboard(a)?n.displayNotif({message:e.replace(e.msg_success_copyLink,{label:this.getSelectedNodes()[0].getLabel()}),level:"success"}):n.displayNotif({title:e.msg_error_copyLinkTitle,message:e.msg_error_copyLink,level:"error",key:"xNavDoc-copy-link-error"})}},a}),define("DS/ENXNav/utils/CtxMenuUtilsV2",["i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/ApplicationFrame/CommandsManager","DS/ENXNav/utils/OpenWithMenuBuilder","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/PADTrackerManager","UWA/Utils"],function(e,t,n,o,i,s,r){"use strict";function a(){return"object"==typeof a.instance?a.instance:(a.instance=this,this)}return a.prototype.initializeCmdMap=function(e){return new Promise(function(t){this.context=e.context,this.menuMap=e.commandMap,this.context.getDynamicCtxDef().then(function(e){this.toolbarDefinition=e,this._enrichCtxDefinition().then(t)}.bind(this))}.bind(this))},a.prototype.buildMenu=function(e){return new Promise(function(t){var n;switch(e.view){case"datagridview":n=this._buildDGVCtx(e);break;case"graphview":case"tilesthumbview":n=this._buildCtxCmdMenuInView(e);break;case"toolbar":n=this._buildCtxCmdMenu(e);break;default:n=Promise.resolve([])}n.then(function(e){t(e)})}.bind(this))},a.prototype._buildDGVCtx=function(e){var t=this;return new Promise(function(n){var o=e.params.cellInfos;if(o)if(-1===o.rowID)t._buildHeaderMenu(e).then(n);else if("positionMatrix-Instance"===e.params.collectionView.getColumnOrGroup(o.columnID).dataIndex&&"function"==typeof t.psePositionCtxCmd){var i=t.psePositionCtxCmd(e.context,e.params);i.isRoot?t._buildCtxCmdMenuInView(e).then(function(t){e.menu=t,n(e.menu)}):n(i.menu)}else t._buildCtxCmdMenuInView(e).then(function(t){e.menu=t,n(e.menu)});else n([])})},a.prototype._buildHeaderMenu=function(t){var n=this;return new Promise(function(o){var s=t.params.cellInfos,r=t.params.collectionView.getColumnOrGroup(s.columnID),a=t.params.collectionView.buildDefaultContextualMenu(t.params,{pin:!0,sizeColumnToFit:!0,firstColumnsVisibility:!1,columnsManagement:!1,view:"datagridview"});if(r.customisation&&r.customisation.layout&&!1===r.customisation.layout.removableFromView||a.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-eye-off"},title:e.headerDGVCtxMenu.columnHide,action:{context:{collectionView:t.params.collectionView,dataIndex:r.dataIndex},callback:function(e){e.context.collectionView.layout.setColumnVisibleFlag(e.context.dataIndex,!1,{isUserInteraction:!1})}}}),i.getSetting("activateFUN104935")){t.params.collectionView;var l=t.context.options.views.datagridview;a.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-clear"},state:l.isClearSortEnabled()?"enabled":"disabled",title:e.headerDGVCtxMenu.clearSort,action:{context:{ourdgv:l},callback:function(e){e.context.ourdgv.clearSort()}}})}var d=t.params.data.listenerPosition?t.params.data.listenerPosition:{x:0,y:0};n.context.position=d,n._addCommandMenu({cmdId:"ColumnVisibility",menu:a}),n._addAdditionalColumnsCtxHdr({menu:a,cellInfos:s,params:t.params,view:"datagridview"}).then(function(e){o(e.menu)})})},a.prototype._addCommandMenu=function(e){var n,o=this.menuMap.get(e.cmdId),i=this;if(o&&!0!==o.deactivated){var s=!0;if(!1===o.isEnabled&&(o.toggle||!0===o.enforceAvailability)&&(s=!1),o.availableInView&&this.context.options.active_view!==o.availableInView&&(s=!1),!0===s){var r=t.getCommand(o.id,this.context.action_bar_opts&&this.context.action_bar_opts.context?this.context.action_bar_opts.context:null);if(r&&"function"==typeof r.isCommandAvailable&&!r.isCommandAvailable(e))return;var a=void 0;a=!0===o.isEnabled?"enabled":"disabled",r&&"function"==typeof r.currentState&&(a=r.currentState()),!0===o.selected&&(a+="|selected");var l=!0,d=r.getArguments();let s=d.length;if(s){var c,u;for(let e=0;e<s;e++){let t=d[e];switch(t.ID){case"ShowInViews":c=t.Value.split(",");break;case"ShowInColumns":u=t.Value.split(",")}}if(c&&(l=-1!==c.indexOf(e.view)),u&&e.params.collectionView){let t=e.params.collectionView.getColumnOrGroup(e.params.cellInfos.columnID).dataIndex;l=-1!==u.indexOf(t)}}!0===l&&(n={type:e.type?e.type:o.type?o.type:"PushItem",id:o.id,title:o.label,HelpResourceFile:o.HelpResourceFile,icon:o.icon,state:!0===o.isEnabled?"enabled":"disabled",state:a,accelerator:o.accelerator,action:{context:{cmdId:o.id,updateDefault:e.updateDefault,params:e.params},callback:function(e){e.context.updateDefault&&e.context.updateDefault.withDefaultCmd&&e.context.updateDefault.withDefaultCmd!==e.context.cmdId&&(e.context.updateDefault.withDefaultCmd=e.context.cmdId),i._launchCommand({command:e.context.cmdId,params:e.context.params})}}},e.menu.push(n))}}return n},a.prototype._launchCommand=function(e){var n=t.getCommand(e.command,this.context.action_bar_opts&&this.context.action_bar_opts.context?this.context.action_bar_opts.context:null);if(n){this.context.position&&(n.options.position=this.context.position,delete this.context.position),e.params&&"function"==typeof n.setViewParams&&n.setViewParams(e.params);var o=s.getPADTracker({eventCategory:"usage",eventAction:"command-2D"});o?(o.setEventData({eventLabel:n.options.ID+"-Ctx"}),o.trackPageEvent()):console.warn("tracker not defined"),n.options.fromCtx=!0,n.begin()}},a.prototype._addNONPSCtx=function(e){var t=this;return new Promise(function(n){var o,i=[],s=e.params&&e.params.data&&e.params.data.listenerPosition?e.params.data.listenerPosition:{x:0,y:0};t.context.position=s;e.params&&("graphview"===e.view?o=e.params.graphview.node:e.params.cellInfos&&(o=e.params.cellInfos.nodeModel)),!0!==o.isRelationsObjectGroupingNode&&t._addOpenWithMenu(0).then(function(o){o.openWithMenu.length&&(i=i.concat(o.openWithMenu)),t._addCommandMenu({view:e.view,params:e.params,cmdId:"ActionBar_Attributes",menu:i}),t.context.getPADTreeDocument().getSelectedNodes().filter(e=>{return"Document"!==(e.options.grid["ds6w:type-original"]?e.options.grid["ds6w:type-original"]:e.options.grid["ds6w:type"])}).length||t._addCommandMenu({view:e.view,params:e.params,cmdId:"Download",menu:i}),n(i)})})},a.prototype._addGroupingCtx=function(e){var t=this;return new Promise(function(n){var o=[],i=e.params&&e.params.data&&e.params.data.listenerPosition?e.params.data.listenerPosition:{x:0,y:0};t.context.getPADTreeDocument().getSelectedNodes();switch(t.context.position=i,t._addCommandMenu({view:e.view,params:e.params,cmdId:"FocusOnGroups",menu:o}),o.push({type:"SeparatorItem"}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"ColorizeGroup",menu:o}),t.context.getPADTreeDocument().isGroupColorApplied()&&t._addCommandMenu({view:e.view,params:e.params,cmdId:"RemoveGroupColor",menu:o}),o.push({type:"SeparatorItem"}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"ExpandAllGroups",menu:o}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"CollapseAll",menu:o}),t.context.getPADTreeDocument().getGroupLayout()){case"compact":o.push({type:"SeparatorItem"}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"GroupsLayoutPath",menu:o});break;case"structured":o.push({type:"SeparatorItem"}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"GroupsLayoutCompact",menu:o})}n(o)})},a.prototype._buildCtxCmdMenuInView=function(e){var t=this;return new Promise(function(n){var o;e.params&&("graphview"===e.view?o=e.params.graphview.node:e.params.cellInfos&&(o=e.params.cellInfos.nodeModel)),o?(!1===o.isSelected()&&o.select(!0),!0===o.isRelationsObjectNode?!0!==o.isGroupingNode?t._addNONPSCtx(e).then(n):t._addGroupingCtx(e).then(n):t._buildCtxCmdMenu(e).then(n)):n([])})},a.prototype._buildCtxCmdMenu=function(n){var o=this;return new Promise(function(i){var s=[],r=[],a={x:0,y:0};n.params&&(n.params.data&&n.params.data.listenerPosition?a=n.params.data.listenerPosition:n.params.info&&n.params.info.position&&(a=n.params.info.position)),o.context.position=a;var l=t.getCommand("OpenInCADHdr",o.context.options.action_bar_opts&&o.context.options.action_bar_opts.context?o.context.options.action_bar_opts.context:null);l&&l.isAvailable()&&(s.push({title:e.PAD_CMDOpenInCAD,icon:{iconName:"open",fontIconFamily:1},type:"PushItem",action:{context:o.context,callback:function(e){o._launchCommand({context:e.context,command:"OpenInCADHdr"})}}}),s.push({type:"SeparatorItem"}));var d=n.dynamicCtxMenu?n.dynamicCtxMenu:o.toolbarDefinition;setTimeout(()=>{for(var e=0;e<d.length;e++)if("string"==typeof d[e])"OpenWith"===d[e]?r.push(o._addOpenWithMenu(e).then(function(e){if(e.openWithMenu.length){var t=e.menuPosition;if(s.length!==d.length){for(var n=!1,o=0,i=0,r=0;r<d.length&&!1===n;r++)"OpenWith"===d[r]?n=!0:"object"==typeof d[r]?d[r].id!==s[i].id?o+=1:i+=1:d[r]!==s[i].id?o+=1:i+=1;t-=o}s.splice.apply(s,[t,0].concat(e.openWithMenu))}})):"SeparatorItem"===d[e]?s.push({type:"SeparatorItem"}):o._addCommandMenu({view:n.view,params:n.params,cmdId:d[e],menu:s});else if("object"==typeof d[e]){for(var t={type:"PushItem",id:d[e].id,title:d[e].title,icon:d[e].icon,HelpResourceFile:d[e].HelpResourceFile,submenu:[]},a=0;a<d[e].cmds.length;a++){var l=o._addCommandMenu({view:n.view,params:n.params,cmdId:d[e].cmds[a],menu:t.submenu,updateDefault:d[e],type:"RadioItem"});l&&l.id===d[e].withDefaultCmd&&(t.icon=l.icon,t.title=l.title,t.HelpResourceFile=l.HelpResourceFile,t.tooltip=l.title,t.state=l.state,t.action={context:{cmdId:l.id},callback:function(e){o._launchCommand({command:e.context.cmdId})}},l.state="selected")}if(t.submenu.length>=1){if(d[e].withDefaultCmd&&"disabled"===t.state){var c=null;for(a=0;a<t.submenu.length;a++)"enabled"===t.submenu[a].state&&(c=t.submenu[a]),t.submenu[a].id===d[e].withDefaultCmd&&(t.submenu[a].state="disabled");null!==c&&(t.icon=c.icon,t.title=c.title,t.HelpResourceFile=c.HelpResourceFile,t.tooltip=c.title,t.state=c.state,t.action={context:{cmdId:c.id},callback:function(e){o._launchCommand({command:e.context.cmdId})}},c.state="selected")}s.push(t)}}Promise.all(r).then(function(){i(s)})},300)})},a.prototype._addOpenWithMenu=function(t){var o=this;return new Promise(function(i){var s=o.context.getPADTreeDocument().getSelectedNodes();s.length>0?n.openWithApps(s,{iconOpenWith:{iconName:"open-menu-dot",fontIconFamily:1},nlsOpenWith:e.OpenWith}).then(function(e){i({openWithMenu:e,menuPosition:t})}):i({openWithMenu:[],menuPosition:t})})},a.prototype._enrichCtxDefinition=function(){var e=this;return new Promise(function(t){for(var n=function(t){return new Promise(function(n){t.icon&&t.icon.module&&t.icon.path&&(t.icon=o.getWebappsAssetUrl(t.icon.module,t.icon.path)),(t.HelpResourceFile&&!0!==t.deactivated?new Promise(function(n){e.retrieveHlpRsc(t.HelpResourceFile).then(function(e){this.label=e[this.id+".Title"],this.title=e[this.id+".Title"],n()}.bind(t))}):Promise.resolve()).then(n)})},i=e.toolbarDefinition,s=[],r=0;r<i.length;r++)i[r],s.push(n(i[r]));Promise.all(s).then(t)})},a.prototype._addAdditionalColumnsCtxHdr=function(e){var t=this;return new Promise(function(n){var o=t.context;if(o.options.additionalColumnsModules&&o.options.additionalColumnsModules.length){for(var i=[],s=[],a=[],l=0;l<o.options.additionalColumnsModules.length;l++)if("function"==typeof o.options.additionalColumnsModules[l].getAdditionalCtxMenu){var d=new Promise(function(t){o.options.additionalColumnsModules[l].getAdditionalCtxMenu({treeDocument:o.getPADTreeDocument(),ctxParams:e.params,view:e.view,callback:function(e,n){e&&-1===a.indexOf(e)&&(a.push(e),n&&(n=r.splat(n)).length>0&&(s.push({type:"SeparatorItem"}),s=s.concat(n))),t()}})});i.push(d)}Promise.all(i).then(function(){e.menu=e.menu.concat(s),n(e)})}else n(e)})},a.prototype.retrieveHlpRsc=function(e){return new Promise(function(t){var n=e.split("/"),o="i18n!"+n[0];o+="/assets/help/"+n.splice(1,1).join("/"),require([o],t)})},new a}),define("DS/ENXNav/utils/xNavCmdsMap",["DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADContext","DS/WebappsUtils/WebappsUtils","DS/ENXNav/utils/CtxMenuUtilsV2","DS/ApplicationFrame/CommandFactory","DS/ApplicationFrame/CommandsManager","DS/CoreEvents/Events"],function(e,t,n,o,i,s,r){"use strict";function a(e){return this.options={context:null,toolbarActivated:!1,cmdsDefinition:null,commandMap:null,subscriptionWUX:[]},this.options=Object.assign(this.options,e),!0===this.options.toolbarActivated&&t.set(this.options.context),this}a.prototype.destroy=function(){that.options.subscriptionWUX.forEach(function(e){r.unsubscribe(e)})},a.prototype.initialize=function(e){var t=this;return new Promise(function(e,n){null!==t.options.cmdsDefinition&&t.options.cmdsDefinition.definition||n("Invalid input parameters"),require(["text!"+t.options.cmdsDefinition.definition],function(n){t.options.commandMap=new Map,t.options.cmdsJSON=JSON.parse(n),t.options.version=t.options.cmdsJSON.version,t._createCommands(t.options.cmdsJSON.commands).then(function(){t.options.subscriptionWUX.push(r.subscribe({event:l+"/ENABLE"},t._enableCommand.bind(t))),t.options.subscriptionWUX.push(r.subscribe({event:l+"/DISABLE"},t._disableCommand.bind(t))),e()})})})},a.prototype.getMap=function(){return this.options.commandMap},a.prototype._createCommands=function(e){var t=this;return new Promise(function(r){var l=[];Array.isArray(e)&&l.push(new Promise(function(o){for(var r=[],l=0;l<e.length;l++)r.push(new Promise(function(o){var r=this;(r.afr&&r.afr.AMD&&!0!==r.deactivated?new Promise(function(n){require([r.afr.AMD],function(e){if(e){var o=r.afr.args?r.afr.args:{};switch(r.afr.behavior){case"CATCommandHeader":var a=s.getCommand(r.id);a?r.isEnabled=a.isEnabled():i._createCommand(e,{context:null,ID:r.id,isEnabled:"boolean"!=typeof r.isEnabled||r.isEnabled,arguments:o});break;case"CATAfrHeaderCheck":var l=s.getCommandCheckHeader(r.id);l?r.isEnabled=l.isEnabled():l=i._createCommandCheckHeader(e,{context:null,ID:r.id,isEnabled:"boolean"!=typeof r.isEnabled||r.isEnabled,arguments:o}),l.onStateChange(function(){var e=t.options.commandMap.get(this._id);t._updateCheckHdr(this,e)})}}n()},function(e){console.warn("Cannot load ["+this.afr.behavior+"] of the command ["+this.id+"] with the AMD ["+this.afr.AMD+"]"),console.groupCollapsed("load failed with following error:"+e.message),console.log(e.stack),console.groupEnd(),n()}.bind(e[l]))}.bind(e[l])):Promise.resolve()).then(function(){r.icon&&r.icon.module&&r.icon.path&&(r.icon=n.getWebappsAssetUrl(r.icon.module,r.icon.path)),(r.HelpResourceFile&&!0!==r.deactivated?new Promise(function(e){r.HelpResourceFile.length?a.retrieveHlpRsc(r.HelpResourceFile).then(function(t){r.label=t[r.id+".Title"],r.unchecked&&r.unchecked.idNLS&&(r.labelUnchecked=t[r.unchecked.idNLS+".Title"]),r.checked&&r.unchecked.idNLS&&(r.labelChecked=t[r.checked.idNLS+".Title"]),r.tooltip={rscId:r.id,HelpResourceFile:r.HelpResourceFile},e()}):e()}):Promise.resolve()).then(function(){if(!0!==r.noUXAvailable){var e=t.options.commandMap.get(r.id);e||(e={isEnabled:!0}),e=UWA.extend(e,r,!0),t.options.commandMap.set(r.id,e)}o()})}.bind(e[l]))}.bind(e[l])));Promise.all(r).then(o)})),l.push(o.initializeCmdMap({context:t.options.context,commandMap:t.options.commandMap})),Promise.all(l).then(r)})},a.prototype._updateCheckHdr=function(e){if(e.checked&&e.unchecked){var t=s.getCommandCheckHeader(e.id);t&&(!0===t.getState()?(e.checked.icon&&(e.icon=UWA.clone(e.checked.icon,!0)),e.state="selected",e.labelChecked&&(e.label=UWA.clone(e.labelChecked))):(e.unchecked.icon&&(e.icon=UWA.clone(e.unchecked.icon,!0)),e.state="",e.labelUnchecked&&(e.label=UWA.clone(e.labelUnchecked))))}},a.prototype._enableCommand=function(t){var n=t.getId(),o=this.options.commandMap.get(n);o&&!1===o.isEnabled&&(o.isEnabled=!0,this.options.commandMap.set(n,o),e.publish({event:"ENXCmds/Update",data:n}))},a.prototype._disableCommand=function(t){var n=t.getId(),o=this.options.commandMap.get(n);o&&!0===o.isEnabled&&(o.isEnabled=!1,this.options.commandMap.set(n,o),e.publish({event:"ENXCmds/Update",data:n}))};var l="/WUX/AFR/CMD/";return a.retrieveHlpRsc=function(e){return new Promise(function(t){var n=e.split("/"),o="i18n!"+n[0];o+="/assets/help/"+n.splice(1,1).join("/"),require([o],t)})},a}),define("DS/ENXNav/models/NodeUtils",["DS/PADServices/utils/Iterator","DS/ENXNav/models/SmartNodeOptions","DS/PADServices/utils/HideShowController","DS/ENOXParser/modules/common/Constants"],function(e,t,n,o){function i(e,t){t.doUpdate&&e.push(t)}function s(r,a,l,d){a.options.isHiddenState=n.STATES.SHOWN,a.options.isPADHidden=void 0;let c=!1;d||(c=!0,d=[]);let u=new t(a);if(u.update(l),i(d,u),l.children){let n=[];e.iterate(l.children,function(l){var c=a.getChildNodesByRelId(l.relationid);c.length?function(n,o,r,a,l,d,c){e.iterate(o,function(e){if(e){let o=new t(e);o.update(n),i(c,o),s(a,e,n,c),r.push(e)}})}(l,c,n,r,0,0,d):function(e,t,n,i,r,a){e.children||(e.children=[],e.expandState=o.NODE_STATES.COLLAPSED.state);let l=i.addChild(e);s(n,l,e,a),t.push(l)}(l,n,r,a,0,d)});var p=a.getChildren();let c=[];p&&(c=p.filter(function(e){return-1===n.indexOf(e)})),e.iterate(c,function(e){a.removeChild(e)})}else a.hasChildren()&&a.removeChildren(!1);c&&e.iterate(d,function(e){e.execute()}),a.getExcludedOccurrences().length>0&&a.cleanUpPathes()}return{calculateRefresh:function(e){let t=-1;return e.processDescendants({processNode:function(){let e=this.getDepth();e>t&&(t=e)}}),t},setStateAndPad:function(e,t){e.setState(t),e.options.padgrid.state=t.state},refreshForRoot:function(e,n){let o=new t(e);o.update(n),o.execute()},recursiveUpdateForRefresh:s}}),define("DS/ENXNav/models/mixins/TreeDocPopulate",["i18n!DS/PADServices/assets/nls/PADServices","i18n!DS/ENXNav/assets/nls/ENXNav.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADServices/settings/AppSettings","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/PromiseHook","DS/PADServices/utils/PromiseCompletion","DS/PADServices/ws/WSAccess","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Helpers","DS/PADServices/utils/Iterator","DS/PADServices/utils/Meas","DS/PADServices/utils/Generics","DS/PADServices/utils/Batches","DS/PADServices/utils/private/TreeDocUpdate","DS/ENOXParser/modules/common/Constants","DS/PADUtils/utilsWS/CVServletServices","DS/PADServices/utils/AttributesMgtV2","DS/PADUtils/Utility","DS/PADUtils/PADSettingsMgt","DS/ENXNav/utils/TwoDAppEvents","DS/PADUtils/PADSession","DS/Selection/HSOManager","DS/ENOXInterWdgCom/LinkManager","DS/PADServices/utils/PADTrackerManager","DS/Utilities/UUID"],function(e,t,n,o,i,s,r,a,l,d,c,u,p,h,g,f,v,m,b,_,D,S,x,y,C,w,P){"use strict";const N="rgba(255, 255, 255, 0.3)";function A(e,t){this._completion=new a({before:function(){e._parseLoadModel=!0},after:function(){e._parseLoadModel=!1},promise:t})}function I(e){if(e.options.childComputed){var t=e.getChildren();if(t&&1===t.length)return t[0].options.globaltype===v.GLOBALTYPE_DOC}}function E(e,t,n,o){e.isRoot()&&e.options.filtered;return function e(t,n,o,i){if(-1===n||o<n){if(t.options.childComputed||!0===t.isGroupingNode){if(t.hasChildren()){for(var s=t.getChildren(),r=!0,a=0;a<s.length&&!0===r;a++){var l=s[a];if(!(l.options.childComputed&&i&&I(l))&&(l.options.childComputed&&"noExpandState"!==l._expandState&&(l.getDepth()<n||-1===n)?l.getState()!==v.NODE_STATES.EXPANDED.state&&l.setState(v.NODE_STATES.EXPANDED):!0===l.isGroupingNode&&(l.setState(v.NODE_STATES.EXPANDED),-1!==n&&n++),l.options.childComputed&&"noChildren"===l.options.padstate&&!l.hasChildren()&&l.setState(v.NODE_STATES.NOCHILDREN),void 0===(r=e(l,n,o+1,i))))throw new Error("Undefined no_expand_needed flag")}return r}return!0}return!(!t.options.type||"Document"!==t.options.type)||!(-1===n||n>o)}return!0}(e,t,n,o)}function O(e,t){let n=e.indexOf(t);-1!==n&&e.splice(n,1)}function M(e,t,n,o,i,s){return new Promise(function(r,a){var l=[];let d=[],c=n.predicate+"-Instance",u=!0===D.getSetting("synthesisModeOnInstance"),p=!1===s.getConfig("readOnlyApp");e.withTransactionUpdate(function(){for(var i=0;i<t.length;i++){var s=t[i];if(!0!==s.isGroupingNode){var r;if(null!==(r=s.getPLMValue(n.predicate))){var a={color:h=_.getBIColor(o,n,r),isBeingCut:!1,grid:{bi_color:h}};s.ghostMode=!1,h===N&&(delete s.options.color,s.ghostMode=!0,a.isBeingCut=!0),s.updateOptions(a),e.options.shouldBeSelected(s),d.push(s)}else if(p)l.push(s.getID());else{a={color:N,grid:{bi_color:N}};s.updateOptions(a),e.options.shouldBeSelected(s)}if(u)if(!1===s.isRoot())if(null!==(r=s.getPLMValue(c))){var h;a={colorInstance:h=_.getBIColor(o,n,r)};s.updateOptions(a),O(l,s.getID())}else if(p)-1===d.indexOf(s)&&l.push(s.getID());else{a={colorInstance:N};s.updateOptions(a)}if(s.options.color===N&&s.options.colorInstance===N){a={isBeingCut:!0,grid:{bi_color:N}};delete s.options.color,delete s.options.colorInstance,s.ghostMode=!0,s.updateOptions(a)}}}}),0===l.length?(!0===e.fromTransactionEnd&&delete e.fromTransactionEnd,!0===i&&e._colorize3D(e),r()):e.updateNodesAttrValue(l,[n.predicate],function(t){e.withTransactionUpdate(function(){for(var t=0;t<l.length;t++){var i=e.getNodesById(l[t]);if(i.length>0){var s=i[0].getPLMValue(n.predicate);if(null!==s)for(var r=_.getBIColor(o,n,s),a={color:r,isBeingCut:!1,grid:{bi_color:r}},d=0;d<i.length;d++)i[d].ghostMode=!1,r===N&&(delete i[d].options.color,i[d].ghostMode=!0,a.isBeingCut=!0),i[d].updateOptions(a),e.options.shouldBeSelected(i[d]);else for(a={grid:{bi_color:N}},d=0;d<i.length;d++)delete i[d].options.color,a.isBeingCut=!0,i[d].ghostMode=!0,i[d].updateOptions(a),e.options.shouldBeSelected(i[d])}}}),!0===i&&e._colorize3D(that),r()})})}var F;function R(){if(F)return F;{let e=require("DS/PADUtils/PADContext");return F=e.get()}}function T(){let e=R();return!(!e||!e.colorMap)}function k(e){if(e.isRelationsObjectNode&&e.childComputed){if(e.options.childComputed=!0,e.hasChildren()){let t=e.getChildren();for(let e=0;e<t.length;e++){k(t[e])}}return!0}}function U(e,t){if(e.getDepth()<t){e.options.childComputed=!0;let n=e.getChildren();u.iterate(n,function(e){U(e,t)})}}function B(){}return B.prototype={add:function(t){var s=this;return new Promise(function(r,a){s._directSelection=!0;var l=[],u={alreadyLoadedRoots:[]};if(!0!==Array.isArray(t.pids)||0===t.pids.length){var p=e.replace(e.errors.wrongInputParameter,{functionCalled:"xNavTreeDoc.add",param:"pids"});throw i.displayNotif({level:"error",message:p,key:"xNavDoc-add-invalid-input"}),new Error(p)}t.pids.forEach(function(e){-1===l.indexOf(e)&&l.push(e)});for(var h=s.getRoots(),g=l.length,v=0;v<h.length;v++){var m=l.indexOf(h[v].options.resourceid);-1!==m&&(l.splice(m,1),u.alreadyLoadedRoots.push(h[v].options.resourceid))}if(l.length===g||C.isWidgetSynchronizing()||i.displayNotif({message:e.infos.rootAlreadyLoaded}),l.length>0){var b=s._getAuthoringFlag();s._getFetchFunc(b)({data:{physicalid:l},autoAttSelection:!0}).then(function(a){let p=c.data.jsonParse(a);s.invalidateViewPort();var h=!1;if(!p.results||p.results.length<l.length)if(!1===o.getSetting("enopad_webapis"))i.displayNotif({message:e.errors.objectNotFoundInDB,level:"error",key:"xNavDoc-add-obj-not-found"}),!h&&t.callback&&t.callback("error");else if(b)i.displayNotif({message:e.errors.objectNotFoundInDB,level:"error",key:"xNavDoc-add-obj-not-found"}),!h&&t.callback&&(t.callback.call(null,u),r(u));else if(p.infos&&p.infos.sources&&p.infos.sources.length>0&&p.infos.sources[0].error){var g=p.infos.sources[0],v=g.error.errorMessage||"An error has occurred in "+g.name;i.displayNotif({message:v,level:"error",key:"xNavDoc-add-error-in-response"}),!h&&t.callback&&t.callback.call(null,u)}else x.setAuthoringState(!0,n.PADSession_disabling_index_object_not_found),s.add(t),h=!0;else if(p.results.length>l.length)i.displayNotif({message:e.errors.tooManyResults,level:"error",key:"xNavDoc-add-too-many-results"}),!h&&t.callback&&t.callback.call(null,u);else{!0!==o.getSetting("authoringModeNotSupported")&&!1===x.isAuthoring()&&p.authoringMode&&!0===p.authoringMode&&x.setAuthoringState(!0,e.warnings.disablingIndexFromServer);let n="ENOSCEN_AP"===i.getAppId()?p.results:function(e,t){return e.length>1?e.map(e=>t.results.filter(t=>(function(e){let t;for(let n=0;n<e.length&&!t;n++){let o=e[n];"resourceid"===o.name&&(t=o.value)}return t})(t.attributes)==e)[0]):t.results}(l,p),a=d.parseFetch({treeDoc:s,results:n,nodeModelClass:s.options.nodeModelClass});s._pendingCompletion=new f(s,a),a.then(function(){if(!h&&t.callback&&t.callback.call(null,u),S.addRoot(),s.isGroupingApplied()){for(var e=[],n=[],o=0;o<l.length;o++)if(-1===n.indexOf(l[o])){n.push(l[o]);var i=s.searchRootById(l[o]);i&&e.push(i)}s.__applyGrouping({roots:e,groups:s.options.groups})}r(u)})}})}else t.callback&&t.callback.call(null,u),r(u)})},addPaths:function(e){console.log("addPaths:"+JSON.stringify(e));let t=this,s={alreadyLoadedRoots:[]};var r,a;function l(o){for(var s=[],r=0;r<e.paths.length;r++){if(-1===s.indexOf(e.paths[r][0])){var a=t.searchRootById(e.paths[r][0]);UWA.is(a)&&!0===a.options.waiting4validation&&s.push(e.paths[r][0])}for(var l=0;l<e.paths[r].length;l+=2){var d=e.paths[r][l],c=t.getNodesById(d);UWA.is(c,"array")&&c.forEach(function(e){if(!0===e.options.waiting4validation){var t=e.getParent();if(e.remove(),t&&!t.hasChildren()&&"noChildren"!==t.getState()&&UWA.is(t.setState,"function"))try{t.setState({state:"collapsed"}),t.options.children=[]}catch(e){console.error(e)}}})}}if(o&&o.removedByFilter?i.displayNotif({message:n.cannot_insert_branch_filtered,eventID:"info",key:"xNavDoc-addPaths-cannot-add-branch-filtered"}):i.displayNotif({message:n.cannot_insert_branch,eventID:"error",key:"xNavDoc-addPaths-cannot-add-branch"}),e.callback){var u={};u.idleRootIds=s,u.success=!1,e.callback.call(t,u,"error")}}function u(){!0!==o.getSetting("authoringModeNotSupported")&&!1===t._getAuthoringFlag()?(x.setAuthoringState(!0,n.PADSession_disabling_index_object_not_found),t.addPaths(e)):l()}let p;this.isGroupingApplied()&&(r=!0,a=v.NODE_STATES.COLLAPSED),e.addedBranches&&(p=e.addedBranches),p||(p=d.buildTemporaryBranches({treeDoc:this,paths:e.paths,temporaryRoot:!0,nodeModelClass:this.options.nodeModelClass,forceCollapsed:r,state:a}),e.addedBranches=p),s.alreadyLoadedRoots=p.rootsAlreadyLoaded;let h=!1;if(s.alreadyLoadedRoots.length){let e=s.alreadyLoadedRoots.filter(function(e){return t.options.FBIProxy.HasFilter(e).hasFilter});h=e.length>0}let g={pathIds:e.paths,data:{expandLevel:"0"},FBIProxy:this.options.FBIProxy},m=t._getAuthoringFlag(),b=t._getExpandFunc(m)(g);t._pendingCompletion=new f(t,b),b.then(function(n){let o=c.data.jsonParse(n),i=o.results&&0===o.results.length;o.errors&&o.errors.length||i?i&&h?l({removedByFilter:!0}):u():d.addPathsUpdateTempNodes({treeDoc:t,FBIProxy:t.options.FBIProxy,wsResponse:o,nodeModelClass:t.options.nodeModelClass,idsToFetch:p.ids_to_fetch,expandLevel:0}).then(function(n){S.addRoot();for(let e=0;e<n.nodesId.length;e++){var o=t.getNodesById(n.nodesId[e])[0];o.isRoot()&&t.getModelEvents().publish({event:"onRootAdded",data:{nb_root:n.nodesId.length,added_node:o}})}if(e.callback){var i={success:!0};if(t.isGroupingApplied()){for(var r=[],a=[],l=e.paths,d=0;d<l.length;d++)if(-1===a.indexOf(l[d][0])){a.push(l[d][0]);var c=t.searchRootById(l[d][0]);c&&r.push(c)}t.__applyGrouping({roots:r,groups:t.options.groups,noGroupUpdate:!0}).then(()=>{e.callback(i,s)})}else e.callback(i,s)}})}).catch(function(e){u()})},onPreExpandChecker:function(e){if("true"===i.getURLParameter("deactivateFUN131056")){let t=!0;if(e.data.nodeModel.options.filtered)e.data.expandAll&&(e.data.numberOfLevelsToExpand="-1"),e.data.performingFilter=!0,e.data.expandAll=!0,t=!1;else if(!e.data.nodeModel.isRoot()&&function(e){return!e.isRelationsObjectNode}(e.data.nodeModel)){let t=e.data.nodeModel.getRoot();t&&t.options&&t.options.filtered&&(e.data.skpChildComputed=!0)}e.data.expandAll&&t&&(e.data.numberOfLevelsToExpand="-1")}else e.data.expandAll&&(e.data.numberOfLevelsToExpand="-1");var t=e.data,n=t.nodeModel,s=!!t.expandAll&&t.expandAll;if(this._parseLoadModel)e.target.preExpandDone({preventExpandAll:!1});else if(s&&!0===o.getSetting("activateSynthesisOnRoot")){var r=document.getElementsByClassName("enx-appMainBody");if(r&&1===r.length){r=r[0];var a=n.isRoot()?n:n.getRoot(),l=this;require(["DS/ENXNav/views/private/ExpandChecker"],function(t){t.check({targetDiv:r,roots:[a]}).then(function(t){!0===t.performExpandAll?l.onPreExpandCB(e):e.target.preExpandDone({preventExpandAll:!0,state:"collapsed"})})})}else this.onPreExpandCB(e)}else this.onPreExpandCB(e)},onPreExpandCB:function(t){let r=p.addOrGetSection("populate"),a=this,l=t.data,u=l.nodeModel,h=!!l.expandAll&&l.expandAll,g=l.performingFilter,m=!l.skpChildComputed&&!g||this.isGroupingApplied(),b=l.numberOfLevelsToExpand?l.numberOfLevelsToExpand.toString():o.getSetting("expand_iter");if(!0===u.isGroupingNode||void 0!==u.options.fakeNodesTable)return void t.target.preExpandDone();let _=u.options.filtered,D=!1;"partiallyExpanded"!==u.options.padstate||_||(D=!0),h&&(u._expandAllPending=!0,s.publish({event:"ENXNav/parser/expandAll/begin"}),this.isGroupingApplied()&&this.__expandAllGroups(u));let x=b;this.invalidateViewPort(),h&&(b="-1");var y=parseInt(b),C=-1===y||y>1;if(m&&(function(e){if(k(e),e.hasChildren()){let t=e.getChildren();for(let e=0;e<t.length;e++)k(t[e])}}(u),u.options.childComputed||u.isRoot()&&a.isGroupingApplied())){r.start("validateExistingTree",{stats:!0});var w=u.getDepth();if(u.isRoot()&&a.isGroupingApplied()||E(u,h?y:w+y,w,C))return t.target.preExpandDone({preventExpandAll:!0}),a._selectOccurence(),T()&&a._colorize3D(a),delete u._expandAllPending,h&&s.publish({event:"ENXNav/parser/expandAll/complete"}),void r.end("validateExistingTree");r.end("validateExistingTree")}let P=u,N=!1,I=0;u.isRoot()||(P=u.getRoot());let O=u.getOccurencePath();I=O.length-1;let M={pathIds:[O],data:{expandLevel:b},FBIProxy:this.options.FBIProxy,timeout:o.getSetting("webapi_timeout"),select_relation:["ro.plminstance.v_treeorder"]};N=o.getSetting("enopad_webapis");let F,R=a._getAuthoringFlag();r.start("performExpand-"+y,{stats:!0}),r.start("progressiveExpand",{stats:!0});let B=a._getExpandFunc(R)(M);a._pendingCompletion=new f(a,B),B.then(function(o){r.end("progressiveExpand");var l=c.data.jsonParse(o);if(l.timeoutOccurs)throw l;if(l.results)if(0===l.results.length)_?i.displayNotif({message:n.find_in_context_no_result,eventID:"info"}):i.displayNotif({message:n.generic_service_failure,eventID:"error",key:"xNavDoc-expand-generic-error"}),h&&s.publish({event:"ENXNav/parser/expandAll/complete"}),t.target.preExpandDone({preventExpandAll:!0,state:"collapsed"});else{a._parseLoadModel=!0,!0===D&&a._cmdProxy.padExpand({paths:[u.getOccurencePath()],expand_level:y});let e=d.parseExpandLoadModel({treeDoc:a,expandedNodes:[u],FBIProxy:a.options.FBIProxy,wsResponse:l,nodeModelClass:a.options.nodeModelClass,expandLevel:y,expandLevelRequest:parseInt(x),filter:P.options.filtered});new A(a,e);a._pendingCompletion=new f(a,e),e.then(function(e){!h&&y>1&&U(u,u.getDepth()+y),S.expand(),a._parseLoadModel=!1,u.options.childComputed=!0,t.target.preExpandDone({preventExpandAll:!0,state:"expanded"}),s.publish({event:"ENXNav/parser/expandAll/complete"}),r.end("performExpand-"+y)}).catch(function(e){a._parseLoadModel=!1,F=e}).finally(function(){F&&F.parseTimeout&&(t.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete u._expandAllPending,s.publish({event:"ENXNav/parser/expandAll/complete"}),i.displayNotif({message:n.parseTimeout,eventID:"warning",key:"xNavDoc-expand-parse-timeout"})),a._selectOccurence()})}if(l.errors){let n=!1,o="",r="",a=[];for(let e=0;e<l.errors.length;e++)if("UNKNOWN_META"===l.errors[e].code)if(console.log("== UNKNOWN_META V2 Mgt"),n=!0,void 0!==l.errors[e].unknownmetas)unknownmetas=a.concat(l.errors[e].unknownmetas),r=l.errors[e].unknownmetas;else{let t=l.errors[e].reason,n="com.exalead.expand.progressive.ProgressiveExpandException: [",i=t.indexOf(n)+n.length;o=t.substring(i,t.length-1),r=o,o=o.replace(/,\s+/g,","),a=a.concat(o.split(","))}!0===n?(s.subscribeOnce({event:"ENXViews/DatagridView/CheckColumns/Done"},()=>{t.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete u._expandAllPending,u.setState({state:"collapsed"}),s.publish({event:"ENXNav/parser/expandAll/complete"});var n=require("DS/PADServices/utils/PlatformURL");i.displayNotif({title:e.replace(e.warnings.unknownMeta2.title,{metaName:r,envId:n.getPlatformId()}),subtitle:e.warnings.unknownMeta2.subtitle})}),s.publish({event:"ENXViews/DatagridView/CheckColumns",data:{colsToRemove:a}})):(t.target.preExpandDone({preventExpandAll:!1,state:v.NODE_STATES.COLLAPSED.state}),delete u._expandAllPending,u.setState(v.NODE_STATES.COLLAPSED),i.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:u.getLabel(),expandLevel:"-1"===b?"all":b}),level:"error",key:"xNavDoc-expand-api-error"}))}}).catch(function(n){if(r.end("progressiveExpand"),n.timeoutOccurs)return t.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete u._expandAllPending,s.publish({event:"ENXNav/parser/expandAll/complete"}),void i.displayNotif({message:e.errors.requesttimeout,level:"error",key:"xNavDoc-expand-request-timeout"});t.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete u._expandAllPending,u.setState({state:"collapsed"}),s.publish({event:"ENXNav/parser/expandAll/complete"}),i.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:u.getLabel(),expandLevel:"-1"===b?"all":b}),level:"error",key:"xNavDoc-expand-parse-error"}),r.end("performExpand-"+y)})},expandZeroForFilterRoots:function(e){let t=this,n=parseInt("0"),i=require("DS/PADServices/utils/AttributesMgtV2").createOutputsRequest("expandV2");g.promStepper(e.filteredRoots,1,1,function(s,r){let a=s[0],u=a.getOccurencePath(),p=a.options.filtered,h={pathIds:[u],data:{expandLevel:"0",select_bo:i.select_object,select_rel:i.select_relation,compute_select_bo:i.select_file},FBIProxy:t.options.FBIProxy,timeout:o.getSetting("webapi_timeout")};var g=Promise.resolve();t.isGroupingApplied()&&(t.cleanGroupingForRoots({rootIds:e.filteredRoots.map(function(e){return e.getID()})}),g=t.__applyGrouping({roots:e.filteredRoots,groups:t.options.groups,fromApplyFilter:!0})),g.then(function(){l.expandv2(h).then(function(e){let o=c.data.jsonParse(e);if(o.results&&o.results.length){let e=d.parseExpandLoadModel({treeDoc:t,expandedNodes:[a],FBIProxy:t.options.FBIProxy,wsResponse:o,filter:p,expandLevel:n,expandLevelRequest:n});t._parseFlagMgr=new A(t,e),t._pendingCompletion=new f(that,e),e.then(function(e){a.options.childComputed=!1,t.options.groupingFilterInProgress=!1,r()}).catch(function(e){r()})}}).catch(function(e){r()})})},function(){s.publish({event:"ENXModel/SyncModel",data:{what:"applyFilter",method:"expandZeroForFilterRoots"}})})()},updateSpecificColumnViews:function(e,t,n){c.node.updateSpecificColumnViews(e,t,n)},_selectFromTagger:function(e){var t=this,n=[];let i=v.NODE_STATES.EXPANDING;const a=function(e){e.setState({state:i})};e.doNotBroacast&&(t._doNotBroadcastSelect=!0,t._inBatchingForUpdate=!0),t.getXSO().empty(),y.empty();const c=function(e,t){s.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"requestTimeout"}}),a(e),t()};g.promStepper(t.getRoots(),1,1,function(n,u){let p=n[0];i=p.getState(),p.setState(v.NODE_STATES.COLLAPSED);var h=b.createOutputsRequest();const g={rootPhID:p.getOccurencePath(),select_bo:h.select_object,select_rel:h.select_relation,compute_select_bo:h.select_file,max_count_path:o.getSetting("maxPathsForSearch"),boundingbox:!1,taggerSelect:e.eventData};l.selectFromTagger({data:g,FBIProxy:t.options.FBIProxy}).then(function(e,n,o){t.options.FBIProxy.setSelectStatus({status:!0});const i=UWA.is(o,"string")?JSON.parse(o):o;if(i.results&&i.results.length){t._parseLoadModel=!0;let o=d.parseExpandLoadModel({treeDoc:t,expandedNodes:[e],FBIProxy:t.options.FBIProxy,wsResponse:i,nodeModelClass:t.options.nodeModelClass,selectPaths:!0,selectFromTagger:!0,findInCtx:!1,isFindDialog:!1,mode:"noChildComputed"});t._pendingCompletion=new f(t,o),new r(o,t.boundClearFlag),o.then(function(){t._parseLoadModel=!1,e.setState({state:"partiallyExpanded"}),n()})}else i.timeoutOccurs?(t._parseLoadModel=!1,c(e,n)):(t._parseLoadModel=!1,a(e),n())}.bind(this,p,u),function(e,n){t.options.FBIProxy.setSelectStatus({status:!0}),s.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"requestFailure"}}),a(e),n()}.bind(this,p,u))},function(){e.doNotBroacast&&(t._doNotBroadcastSelect=!1,t._inBatchingForUpdate=!1),(n=t.getXSO().get()).length>o.getSetting("maxPathsForSearch")?s.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"tooManyResults"}}):0===n.length?s.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"noResults"}}):s.publish({event:"ENXViews/Model/SelectFromTagger/Success",data:{nbSelected:n.length}})})()},_findInCtx:function(e){var i=this,a=function(){e.doNotBroacast&&(i._doNotBroadcastSelect=!0,i._inBatchingForUpdate=!0)},u=function(){e.doNotBroacast&&(i._doNotBroadcastSelect=!1,i._inBatchingForUpdate=!1)};let p=e.nodes.length>1,h=[],m=[];this.closePager(),require(["DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalUtils","DS/PADUtils/Utility"],function(b,_,D){i._selection=[],i.searchProgress=!0,a(),i.prepareBroadcastSelect(),i.getXSO().empty(),u(),i._getAuthoringFlag()&&_.displayNotif({message:t.find_in_ctx_after_authoring,level:"warning",key:"xNavDoc-find-in-ctx-after-auth"});var S=b.createOutputsRequest();-1===S.select_object.indexOf("bo.plmentity.v_usage")&&S.select_object.push("bo.plmentity.v_usage"),g.promStepper(e.nodes,1,1,function(n,c){let g=n[0],b=g.getState(),D=function(){g.setState({state:b})};g.setState(v.NODE_STATES.EXPANDING);var x={FBIProxy:i.options.FBIProxy,data:{rootPhID:g.getOccurencePath(),select_bo:S.select_object,select_rel:S.select_relation,compute_select_bo:S.select_file,ftsString:e.searchFts,rscIdToSearch:e.rscId,max_count_path:o.getSetting("maxPathsForSearch")},iterativeFilter:e.iterativeFilter,filterRel:e.no_type_filter_rel};x.data.select_rel.push("ds6w:type"),l.findInCtxV2(x).then(function(e){var n="string"==typeof e?JSON.parse(e):e;if(n.results&&n.results.length){i._parseLoadModel=!0,a();let e=d.parseExpandLoadModel({treeDoc:i,expandedNodes:[g],FBIProxy:i.options.FBIProxy,wsResponse:n,nodeModelClass:i.options.nodeModelClass,selectPaths:!0,findInCtx:!0,isFindDialog:!0,mode:"noChildComputed"});i._pendingCompletion=new f(i,e);new r(e,i.boundClearFlag),new r(e,u);e.then(function(e){i._parseLoadModel=!1;var n=i.getXSO().get();n.length>o.getSetting("maxPathsForSearch")&&(n.pop(),_.displayNotif({message:t.replace(t.tooManyResultFound,{maxResult:o.getSetting("maxPathsForSearch")}),level:"warning",key:"FindInCtx-tooManyResult"}));let r=m.slice(),a=n.filter(function(e){return-1===r.indexOf(e)});m=m.concat(a),i._selection.length&&p&&(i._selection.length=0),a.forEach(function(e){i._selection.push(e.getOccurencePath())}),i.originalSelection=i._selection,h=h.concat(i._selection);g.setState({state:"partiallyExpanded"}),s.publish({event:"ENXModel/SyncModel",data:{what:"FindInCtx"}}),c()})}else i._parseLoadModel=!1,console.error("Find in Ctx failed - No Results"),D(),c()}).catch(function(e){i._parseLoadModel=!1,console.error("Find in Ctx failed"),D(),c()})},function(){e.doNotBroacast||i.pushBroadcastSelect();for(var t=[],o=0;o<h.length;o++){var r=i.getNodeByOccurencePath(h[o]);r&&t.push(r)}i._selection=h,0===i._selection.length?_.displayNotif({message:n.find_in_context_no_result,level:"info"}):(a(),i.unselectAll(),u()),c.node.clearChildComputed(i),!0!==e.noPager&&i._selection.length&&i.displayPager().then(function(){a(),i.reframeOn({idx:i._selectedIdx}),u()}),s.publish({event:"ENXViews/Model/FindInCtx/complete",data:{foundNodes:t}}),i.searchProgress=!1})()})},insertBranches:function(e,t){var n={};let o={treeDoc:this,paths:e,temporaryRoot:!1,nodeModelClass:this.options.nodeModelClass};if(t.node_state&&(o.state=t.node_state),t.forceCollapsed&&(o.forceCollapsed=t.forceCollapsed),n=d.buildTemporaryBranches(o),!0===t.novalidation&&!0===t.forceCollapsed&&e.length>20&&!0!==D.getSetting("forcePathValidationOnSelect"))n.visibleNodesIds.length>0?this.refreshNodeById({modified:n.visibleNodesIds,relationids:n.visibleNodesRelIds,skipDrop:void 0!==t.skipDrop&&t.skipDrop,onComplete:t.onComplete?t.onComplete:void 0}):n.ids_to_fetch.length?this.refreshNodeById({modified:n.ids_to_fetch,relationids:n.relationids,skipDrop:void 0!==t.skipDrop&&t.skipDrop,onComplete:function(){let e=n.ids_to_fetch.map(function(){return that.getNodesById(rootId)}).concat(function(e,t){e=e.concat(t)},[]);u.iterate(e,function(e){e.getParent().setState(v.NODE_STATES.COLLAPSED)}),t.onComplete&&t.onComplete(!0)}}):t.onComplete&&t.onComplete.call(!0);else if(n.ids_to_fetch.length>0||n.relationids.length>0)if(n.ids_to_fetch.length>0||n.relationids.length>0){let o=this;this.addPaths({addedBranches:n,paths:e,callback:function(e,n){e.success&&(n&&n.alreadyLoadedRoots&&u.iterate(n.alreadyLoadedRoots,function(e){o.getNodesById(e)}),t.onComplete&&t.onComplete())}})}else t.onComplete&&t.onComplete.call(!0);else n.ids_to_fetch.length>0?this.refreshNodeById({modified:n.ids_to_fetch,relationids:n.relationids,skipDrop:void 0!==t.skipDrop&&t.skipDrop,onComplete:t.onComplete?t.onComplete:void 0}):t.onComplete&&t.onComplete.call(!0)},updateColorForNodes:function(e,t,n){var o=require("DS/PADUtils/Configuration");let i=this;var s=e.length<1e3?100:200;M(i,e,t,n,!0,o).then(function(){setTimeout(function(){let s=i.getAllDescendants();(function(e,t){let n=e.length,o=t.length,i=!1;if(n===o){let n=!1;for(let i=0;i<o;i++){let o=t[i];if(-1===e.indexOf(o)){n=!0;break}}return n||(i=!0),i}return!1})(e,s)||M(i,i.getAllDescendants(),t,n,!0,o)},s)})},_colorChildren:function(e,t,n,o,i){var s=this;e.getChildren().forEach(function(e){if(t.push(e.options.resourceid),t.push(e.options.relationid),n.push({color:e.options.color?e.options.color:N,pid:e.options.resourceid,ghostMode:e.ghostMode,metaType:"reference"}),n.push({color:e.options.colorInstance?e.options.colorInstance:N,pid:e.options.relationid,ghostMode:e.ghostMode,metaType:"instance"}),"collapseState"==e._expandState||"partiallyExpandedState"==e._expandState)if(e.hasChildren())s._colorChildren(e,t,n,o,i);else{var r=e.getOccurencePath(e.options.resourceid);o.push(r.map(function(e){return t.indexOf(e)}))}else{var a=e.getOccurencePath(e.options.resourceid);o.push(a.map(function(e){return t.indexOf(e)}))}})},_checkColorize3D:function(){T()&&this._colorize3D(this)},_colorize3D:function(e){if(!0!==this._collapseRepDuringExpandAll){let t=this,n=[],o={},i=[],s=[];t.getRoots().forEach(function(o){if(o.options.color||(o.options.color=N),o.options.color)if(n.push(o.options.resourceid),s.push({color:o.options.color?o.options.color:N,pid:o.options.resourceid,ghostMode:o.ghostMode}),"collapseState"==o._expandState||"partiallyExpandedState"==o._expandState)if(null!==o.getChildren())t._colorChildren(o,n,s,i,e);else{var r=node.getOccurencePath(o.options.resourceid);i.push(r.map(function(e){return n.indexOf(e)}))}else{var a=o.getOccurencePath(o.options.resourceid);i.push(a.map(function(e){return n.indexOf(e)}))}}),o={nodes:s,path:i},void 0!==t._cmdProxy&&0!==o.nodes.length&&t._cmdProxy.padFilterBI({filterBIColorize:o})}},refreshNodeById:function(e){var t=[],n=this,o=[],i=[],r=[],a=[];if(UWA.is(e.created)&&(t=t.concat(e.created)),UWA.is(e.modified)&&UWA.is(e.modified,"array")&&this.withTransactionUpdate(function(){e.modified.forEach(function(e){if(h.checks.object(e)){var s=e.physicalid;if(h.checks.array(e.attributes)){var l=require("DS/PADServices/utils/AttributesMgtV2"),d=n.getNodesById(s);0===d.length&&(d=n.getNodesByRelId(s)),d.forEach(function(t){t.updateAttributes(e.attributes,l.getAvailableColumns()),t._manageNLS=!0,!0})}else{if(-1===t.indexOf(s))(c=n.getNodesById(s))&&c.length>0&&(t.push(s),o.push(s));"ownerChanged"===e.key&&i.push(s)}}else{var c,u;if(-1===t.indexOf(e))if((c=n.getNodesById(e))&&c.length>0)t.push(e),o.push(e);else(c=n.getNodesByRelId(e)).length>0&&c.forEach(function(e){a.push(e),(u=e.options.relationid)&&r.push(u)})}})}),t.length>0){D.getWebAPI_Options("fetch").include_param_Attributes=!1;let i=function(){return t.filter(function(e){let t=n.getNodesById(e);return!(1!==t.length||!t[0].isRoot())})},r=i();e.relationids&&e.relationids.length>0&&(t=t.concat(e.relationids));n._getFetchFunc(n._getAuthoringFlag())({data:{physicalid:t},autoAttSelection:!0}).then(function(a){let l=c.data.jsonParse(a);var u=[];for(var p of l.results)if(p.attributes.find(e=>"#DENIED!"===e.value)){let e=p.attributes.find(e=>"resourceid"===e.name).value;n.removeRoot(n.getNodesById(e)[0]),u.push(e)}u.length&&s.publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:u}}),c.array.compare(t,o)?d.parseMultiFetch({results:l.results,treeDoc:n,FBIProxy:n.options.FBIProxy}):d.refreshNodes({wsResponse:l,treeDoc:n,refreshParameters:e,FBIProxy:n.options.FBIProxy}).then(function(){if(e.created&&e.created.length&&(r=i()),!e.skipDrop&&r.length){var t={pids:r,already_added_in_PS:!0};n._commandProxy.drop(t)}for(var o=[],s=0;s<r.length;s++){var a=n.getNodesById(r[s]);a.length&&o.push(a[0])}var l=o.map(function(e){return e.getOccurencePath()});e.onAddPaths&&e.onAddPaths(l)})})}else if(r.length>0){var u={lIds:r,attributes:"true"},p={},g={};l.read({data:u}).then(function(e){var t=UWA.is(e,"string")?JSON.parse(e):e;t.results&&(t.results.forEach(function(e){var t=e.physicalID,n={instanceName:[],instanceDesc:[],modified:[]};e.data.forEach(function(e){e.path&&"PLMInstance.PLM_ExternalID"===e.path?n.instanceName=e.value:e.path&&"PLMInstance.V_description"===e.path?n.instanceDesc=e.value:e.path&&!e.path.includes("PLMInstance")&&(n["ds6wg:"+e.path+"-Instance"]=e.value,g["ds6wg:"+e.path+"-Instance"]=e.value)}),e.basicData.forEach(function(e){"modified"===e.name&&(n.modified=e.value)}),p[t]=n}),a&&a.length>0&&n.wrapInTransaction(function(){a.forEach(function(e){var t={grid:{}};for(var n in t.grid["ds6w:modified"]=p[e.options.relationid].modified[0],t.grid["ds6w:label-Instance"]=p[e.options.relationid].instanceName[0],Array.isArray(p[e.options.relationid].instanceDesc)&&(t.grid["ds6w:description-Instance"]=p[e.options.relationid].instanceDesc[0]),g)p[e.options.relationid]&&p[e.options.relationid][n][0]&&(t.grid[n]=p[e.options.relationid][n][0]);e.updateOptions(t)})}))}).catch(function(e){console.error("failure with error",e)})}},refresh:function(e){let n=P.v4();window.top.performance.mark("app_refresh_start-"+n),s.publish({event:"ENXModel/refresh/begin"});var r=function(){S.refresh(),window.top.performance.mark("app_refresh_end-"+this);var e=w.getPADTracker({eventCategory:"performance",eventAction:"refresh"});if(e){window.top.performance.measure("app_refresh_measure-"+this,"app_refresh_start-"+this,"app_refresh_end-"+this);var t=window.top.performance.getEntriesByName("app_refresh_measure-"+this),n=t.length>0?t[t.length-1].duration:void 0,o=t.length>0?t[t.length-1].startTime:void 0;e.addMultivaluedEventData("2d_app_refresh",{call_refresh_start:o,call_refresh_duration:n}),e.trackPageEvent()}s.publish({event:"ENXModel/refresh/complete"})}.bind(n);let a=e&&e.roots;if(a||(a=this.getRoots()),0===a.length)return i.displayNotif({message:t.refresh_ok}),void r();var l=a.map(function(e){return e.getOccurencePath()}),u=function(e){let t=-1;return e.processDescendants({processNode:function(){let e=this.getDepth();e>t&&(t=e)}}),t}(this);if(this.unselectAll(),0===u){let e=a.map(function(e){return e.getID()}),n=this._getAuthoringFlag(),o=this._getFetchFunc(n),s=this;o({data:{physicalid:e},autoAttSelection:!0}).then(function(e){let n=c.data.jsonParse(e);d.refreshFetch({wsResponse:n,roots:a,treeDoc:s,FBIProxy:s.options.FBIProxy}).then(()=>{i.displayNotif({message:t.refresh_ok}),r()})})}else{let e={pathIds:l,data:{expandLevel:u},FBIProxy:this.options.FBIProxy,timeout:o.getSetting("webapi_timeout")},n=this._getAuthoringFlag(),s=this._getExpandFunc(n);n&&(e.data.expandLevel=""+u);let p=this;s(e).then(function(e){let n=c.data.jsonParse(e);n.results&&n.results.length?d.refresh({roots:a,treeDoc:p,FBIProxy:p.options.FBIProxy,wsResponse:n,expandLevel:-1}).then(function(){p.isGroupingApplied()&&p.__applyGrouping({roots:a,groups:p.options.groups}),i.displayNotif({message:t.refresh_ok}),r()}):r()}).catch(function(e){i.displayNotif({message:t.refresh_failure,eventID:"error",key:"xNavDoc-refresh-error"}),r()})}},updateNodesAttrValue:function(e,t,n){let i=this;for(var s=require("DS/PADServices/utils/AttributesMgtV2"),r=0;r<t.length;r++)s.addBIColumn(t[r],o.getSetting("synthesisModeOnInstance"));var a=t.slice();-1===a.indexOf("ds6w:globaltype")&&a.push("ds6w:globaltype");var l={select_predicate:a,select_file:[],timeout:o.getSetting("webapi_timeout")},c=[];if(e.length>=1e3){var u=Math.trunc(e.length/1e3);e.length%1e3>0&&u++;for(var p=0;p<u;p++)c.push(e.splice(0,e.length>=1e3?1e3:e.length))}else c.push(e);var h;(h=c,h.reduce((e,t)=>e.then(()=>(function(e){return new Promise(function(t,n){l.physicalid=e,i._getFetchFunc(i._getAuthoringFlag())({data:l,enopad_webapis:!1,pids:e,noCompletion:!0}).then(function(n){var o=UWA.is(n,"string")?JSON.parse(n):n;o.results?d.parseMultiFetch({treeDoc:i,results:o.results,refresh_parameters:{modified:e}}).then(function(){t()}):t()}).catch(function(e){console.error(e),n()})})})(t)),Promise.resolve())).then(()=>{n&&n({allNodesProcessed:!0})})},expandMultiSelect:function(t){var a=!!t.expandAll&&t.expandAll,l=t.numberOfLevelsToExpand?t.numberOfLevelsToExpand.toString():o.getSetting("expand_iter"),p=(o.getSetting("enopad_webapis"),!0===o.getSetting("alwaysExpandPath")||isNGFilter||o.getSetting("pgpFromServer"));a&&(l="-1");for(var h=parseInt(l),g=-1===h||h>1,m=[],b=0;b<t.nodes2Expand.length;b++){var _=t.nodes2Expand[b];if(_.isRoot()){let e=!0;for(var D=1;D<t.nodes2Expand.length;D++)t.nodes2Expand[D].isGroupingNode||(e=!1);e&&(_.options.childComputed=!0)}if(_.options.childComputed){var S=_.getDepth();E(_,a?parseInt(l):S+parseInt(l),S,g)?_.setState(v.NODE_STATES.EXPANDED):m.push(_)}else m.push(_)}var x=this;if(0===m.length)x.prepareUpdate(),T()&&x._colorize3D(x),x.forceSyncModel4TreeListView(),x.pushUpdate(),t.callback&&t.callback();else{var y=0,C=[],w=[],P=[];this.withTransactionUpdate(function(){u.iterate(m,function(e){e.setState(v.NODE_STATES.EXPANDING);var t=e;if(t.isRoot()||(t=t.getRoot()),p){var n=e.getOccurencePath();t&&-1===P.indexOf(t.getID())&&(P.push(t.getID()),w.push(t)),y=Math.max(n.length-1,y),C.push(n)}else C.push([e.getID()]),-1===P.indexOf(e.getID())&&(P.push(e.getID()),w.push(e))})});let o=x._getAuthoringFlag(),a=x._getExpandFunc(o);var N=[];N.push(new Promise(function(t,o){let s={pathIds:C,data:{expandLevel:l},FBIProxy:x.options.FBIProxy,timeout:3e4};a(s).then(function(e){var s=c.data.jsonParse(e);if(s.timeoutOccurs)throw s;if(0===s.results.length)i.displayNotif({message:n.generic_service_failure,eventID:"error",key:"xNavDoc-expand-multi-select-generic-error"}),u.iterate(m,function(e){e.setState(v.NODE_STATES.NOCHILDREN)}),o();else{x._parseLoadModel=!0;let e=d.parseExpandLoadModel({treeDoc:x,expandedNodes:m,FBIProxy:x.options.FBIProxy,wsResponse:s,nodeModelClass:x.options.nodeModelClass,expandLevel:h});new f(x,e),new r(e,x.boundClearFlag);e.then(function(e){u.iterate(m,function(e){e.options.childComputed=!0,e.setState(v.NODE_STATES.EXPANDED)}),t()})}}).catch(function(n){if(n.timeoutOccurs)return i.displayNotif({message:e.errors.requesttimeout,level:"error",key:"xNavDoc-expand-multi-select-request-timeout"}),void t();i.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:_.getLabel(),expandLevel:"-1"===l?"all":l}),level:"error",key:"xNavDoc-expand-multi-select-parse-error"}),x.pushUpdate()})}));var A=Promise.all(N);t.callback&&A.then(t.callback);new f(x,A);A.then(function(){s.publish({event:"ENXModel/SyncModel",data:{what:"expandMultiSelect"}})})}},clearLoadModelFlag:function(){this._parseLoadModel=!1},_getAuthoringFlag:function(){return!1},_getExpandFunc:function(e){let t=void 0!==window.jasmine;return(!this._boundExpandIndex&&!this._boundExpandDB||t)&&(this._boundExpandDB=l.expandv2DBprogressive.bind(l),this._boundExpandIndex=l.expandv2.bind(l)),e?this._boundExpandDB:this._boundExpandIndex},_getFetchFunc:function(e){let t=void 0!==window.jasmine;return(!this._boundFetchIndex&&!this._boundFetchDB||t)&&(this._boundFetchDB=l.fetchDB.bind(l),this._boundFetchIndex=l.fetch.bind(l)),e?this._boundFetchDB:this._boundFetchIndex},callForODT_applyChildComputedFlag:function(e,t){U(e,t)}},B}),define("DS/ENXNav/models/mixins/TreeDocAccess",["DS/Tree/TreeDocument","DS/ENXNav/utils/TwoDAppEvents"],function(e,t){"use strict";const n=[];function o(){}return o.prototype={forceSyncModel4TreeListView:function(){},getNodesById:function(e){var t=[];return this.getRoots().forEach(function(n){var o=n.getNodesById(e);t=t.concat(o)}),t},getNodeByOccurencePath:function(e){for(var t=this.getRoots(),n=0;n<t.length;n++){var o=t[n].getNodeByPath(e,void 0,void 0,!0);if(o)return o}},removeRoot:function(e,n,o){if(this._doNotBroadcastSelect=!0,this.invalidateViewPort(),this._parent(e),t.removeRoot(),this._doNotBroadcastSelect=!1,!UWA.is(n,"boolean")||!n){var i=this.getRoots().length;if(this.getModelEvents().publish({event:"onRemoveRoot",data:{pid:e.getID(),remainingRoots:i}}),i>0){var s=null;this.getRoots().length>0&&(s=this.getRoots()[0]),this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:s,nb_root:i}})}}},searchRootById:function(e){for(var t,n=this.getRoots(!0),o=0;o<n.length;o++)if(n[o].options.resourceid===e){t=n[o];break}return t},getNodesByRelId:function(e){var t=[];return this.getRoots().forEach(function(n){var o=n.getNodesByRelId(e);t=t.concat(o)}),t},getNodesByIDPath:function(e){var t=[];return this.getRoots().forEach(function(n){!function e(t,n,o,i){if(t.getID()===n[o])if(o===n.length-1)i.push(t);else{var s=t.getChildren();s&&s.length>0&&(o+=1,s.forEach(function(t){e(t,n,o,i)}))}}(n,e,0,t)}),t},deleteNodes:function(e,t){var n=this;n.withTransactionUpdate(function(){var o={detach:{deleted:[]}};e.forEach(function(e){if(e.isRoot())n.removeRoot(e);else{var t=e.getParent(),i=t.getState();e.remove(),o.detach.deleted.push(e.getID()),"partiallyExpanded"!==i||t.options.children||(t.options.children=[],t.setState({state:"collapsed"}))}}),!0===t&&n._cmdProxy.padRefresh(o)})},getSelectedNodesForOFW:function(){var e=[],t=this._selected_paths;t&&t.length&&this.getXSO().get().length?this.getRoots().forEach(function(n){for(var o=0;o<t.length;o++){var i=n.getNodeByPath(t[o],void 0,void 0,!0);i&&e.push(i)}}):e=this.getXSO().get();return e},getDetachedRoots:function(){return n},getVisibleNodes:function(){let e=[];return this.processDescendants({processNode:function(){this.isHidden()||e.push(this)}}),e},wrapInTransaction:function(e){try{e()}catch(e){}}},o}),define("DS/ENXNav/models/_xNavDocumentRefresh",["UWA/Class","UWA/Promise","DS/ENXNav/models/_xNavCVParser","DS/ENXNav/models/RefreshHandler","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADProgressBar","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,n,o,i,s,r,a,l,d,c){"use strict";var u=e.extend({});if(!0===s.getSetting("refresh_v2")){u.prototype.refresh=function(e){var t=c.refresh_ongoing,n=(e=e||{}).roots||this.getRoots();if((n=n.concat(this.getDetachedRoots())).length>0){var o=this;o._directSelection=!0,l.on(t),this.doRefreshCV(n).then(function(t){var n;l.off(),n=n||{msg:c.refresh_ok},void 0===e.cb?a.displayNotification(n):e.cb(n),setTimeout(function(){i.publish({event:"ENXModel/SyncModel",data:{refresh:!0}})},100)}).then(function(){o.getModelEvents().publish({event:"titleRecalc"})})}}}return u.prototype.doRefreshCV=function(e,n){var o=this;return new t(function(i,s){for(var r,a={},l={},d=[],c=0,u=0,p=0;p<e.length;p++)!0===e[p].options.filtered&&(l["BlockFilter_"+u]=[],l["BlockFilter_"+u].push({node:e[p],root:e[p]}),d.push(e[p].getID()),u++);for(p=0;p<e.length;p++){var h=e[p];!0!==e[p].options.filtered&&(0===p?r=a["Block_"+c]=[]:p>0&&p%8==0&&(r=a["Block_"+ ++c]=[]),!0===e[p].hasChildren()?e[p].processDescendants({processNode:function(){!1===this.hasChildren()&&r.push({node:this,root:h})}}):a["Block_"+c].push({node:h,root:h}))}for(var g=[],f=Object.getOwnPropertyNames(a),v=0,m=0;m<f.length;m++){(D=new t(function(t){v++;var i=a[f[m]],s=0;1===Math.floor(v/5)&&(s=2e3),setTimeout(function(){o._validateExpand(i,t,n,e)},s)})).name="Validate branch from root of "+f[m],g.push(D)}var b=Object.getOwnPropertyNames(l),_=0;for(m=0;m<b.length;m++){var D;(D=new t(function(e){_++;var t=l[b[m]],n=0;1===Math.floor(_/5)&&(n=2e3),setTimeout(function(){o._validateWithMultiExpandFiltered(t,e,!1)},n)})).name="Validate branch from root of "+b[m],g.push(D)}var S=new t(function(e){t.all(g).then(function(){[],[],i()})});S.name="Synchronisation of Validation",g.push(S)})},u.prototype._validateExpand=function(e,t,i,l){var d=this,u=new o({app_context:s.app_context,treeDocument:this}),p=[];if(null!=l&&l.forEach(function(e){for(var t=[e];t.length;){var n=t.pop();null!=n&&!0!==n.isRelationsObjectNode&&(p.push(n.getOccurencePath()),t=t.concat(n.getChildren()))}}),0!==p.length){d.prepareUpdate();var h=UWA.extend({intent:"explore_2D"},s.getWebAPI_Options("navigate"),!0),g=s.getSetting("enopad_webapis"),f={root_path_physicalid:p,expand_iter:"1",deepRefresh:!0,intent:h.intent,select_bo:h.select_bo,select_rel:h.select_rel,compute_select_bo:h.compute_select_bo,enopad_webapis:g,find_in_ctx:!1};r.refresh({data:f,onComplete:function(e){var o=UWA.is(e,"string")?JSON.parse(e):e;o.full_path=!0,n.process.expand({treedocument:d,root_nodes:l,starting_from_root:o.full_path,response:o,mode:"refresh",expand_level:1,security_counts_HTML:null}),u.complete(!0),t(),d.pushUpdate()},onFailure:function(n){for(var o=e.map(function(e){return e.root}).filter(function(e,t,n){return n.indexOf(e)==t}),i=!0,s=0;s<o.length;s++){var r=o[s],l=c.replace(c.refresh_node_failure,{name:r.getLabel()});a.displayNotification({msg:l,eventID:"warning",key:"enxNav-refresh"}),i=!1}i&&a.displayNotification({msg:c.refresh_failure,eventID:"error",key:"enxNav-refresh-failure"}),u.complete(!1),t(),d.pushUpdate()}})}},u.prototype._validateRefresh=function(e,t,i,l){var d=this,u=new o({app_context:s.app_context,treeDocument:this}),p=[];null!=l&&l.forEach(function(e){for(var t=[],n=[e];n.length;){var o=n.pop();null!=o&&(t.push(o.getOccurencePath()),n=n.concat(o.getChildren()))}p.push(t)});var h=UWA.extend({intent:"explore_2D"},s.getWebAPI_Options("navigate"),!0),g=s.getSetting("enopad_webapis");d.prepareUpdate();var f={session:p,intent:h.intend,debug:!1,include_param_Attributes:!0,select_bo:h.select_bo,select_rel:h.select_rel,compute_select_bo:h.compute_select_bo,enopad_webapis:g,find_in_ctx:!1,type_filter_bo:s.getSetting("type_filter_bo")};r.refresh({data:f,onComplete:function(e){var o=UWA.is(e,"string")?JSON.parse(e):e;n.process.expand({treedocument:d,root_nodes:l,starting_from_root:o.full_path,response:o,mode:"refresh",expand_level:1,security_counts_HTML:null}),u.complete(!0),t(),d.pushUpdate()},onFailure:function(n){for(var o=e.map(function(e){return e.root}).filter(function(e,t,n){return n.indexOf(e)==t}),i=!0,s=0;s<o.length;s++){var r=o[s],l=c.replace(c.removeNodeWithRefresh,{name:r.getLabel()});a.displayNotification({msg:l,eventID:"warning",key:"enxNav-refresh"}),i=!1,d.removeRoot(r,!1)}i&&a.displayNotification({msg:c.refresh_failure,eventID:"error",key:"enxNav-refresh-failure"}),u.complete(!1),t(),d.pushUpdate()}})},u.prototype._validateWithMultiExpandFiltered=function(e,t,i){for(var l=this,u=UWA.extend({intent:"explore_2D"},s.getWebAPI_Options("navigate"),!0),p=s.getSetting("enopad_webapis"),h={select_bo:u.select_bo,select_rel:u.select_rel,compute_select_bo:u.compute_select_bo,union:{expand:[]}},g=new o({app_context:s.app_context,treeDocument:this}),f=[],v=[],m=0;m<e.length;m++){var b,_=e[m],D=_.root;-1===f.indexOf(D.getID())?(f.push(D.getID()),v.push(D),b={root_path_physicalid:[],no_type_filter_rel:u.no_type_filter_rel,"q.iterative_filter_query_bo":u["q.iterative_filter_query_bo"]},D&&D.options.sequence_filter&&(b.sequence_filter=D.options.sequence_filter),D&&D.options.config_filter&&(b.config_filter=D.options.config_filter),b.expand_iter="-1",h.union.expand.push(b)):b=h.union.expand[f.indexOf(D.getID())],b.root_path_physicalid.push(_.node.getOccurencePath())}l.prepareUpdate(),r.multiexpand({enopad_webapis:p,data:h,onComplete:function(o){try{var s=UWA.is(o,"string")?JSON.parse(o):o;n.process.validateMultiExpand({treedocument:l,response:s,forcePartiallyExpanded:"boolean"!=typeof i||i,treatedNodes:e,isFilter:!0,onComplete:function(e){e.nodes2relaunch.length?l._validateWithMultiExpandFiltered(e.nodes2relaunch,t,i):(g.complete(!0),t())}})}catch(e){a.displayNotification({msg:d.generic_service_failure,eventID:"error",key:"enxNav-generic-service-failure"})}finally{v.forEach(function(e){e.childComputed=!0;var t=UWA.clone(e.options.icons[0]);t.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},e.updateOptions({icons:[t]})}),l.pushUpdate()}},onFailure:function(){for(var n=e.map(function(e){return e.root}).filter(function(e,t,n){return n.indexOf(e)==t}),o=!0,i=0;i<n.length;i++){var s=n[i],r=c.replace(c.removeNodeWithRefresh,{name:s.getLabel()});a.displayNotification({msg:r,eventID:"warning",key:"enxNav-refresh"}),o=!1,l.removeRoot(s,!1)}o&&a.displayNotification({msg:c.refresh_failure,eventID:"error",key:"enxNav-refresh-failure"}),g.complete(!1),t(),l.pushUpdate()}})},u}),define("DS/ENXNav/models/xNavDocument",["UWA/Core","DS/Logger/Logger","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/Tree/TreeDocument","DS/ENXNav/models/_xNavGrouping","DS/ENXNav/models/_xNavDocumentRefresh","DS/ENXNav/models/xNavNodeModel","DS/ENXNav/models/_xNavCVParser","DS/PADServices/utils/HideShowController","DS/ENXNav/models/AdditionalRelDummyInfo","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPredicatesNls","DS/PADUtils/views/PADAlert","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADTransactionManager","DS/PADUtils/PADSession","DS/PADUtils/PADProbes","DS/PADUtils/views/PADPager","DS/PADUtils/Utility","DS/PADServices/utils/GlobalModelEvents","DS/ENXNav/models/mixins/TreeDocShared","DS/ApplicationFrame/CommandsManager","DS/ENXNav/utils/TwoDAppEvents","DS/ENOXParser/modules/common/Helpers","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,n,o,i,s,r,a,l,d,c,u,p,h,g,f,v,m,b,_,D,S,x,y,C,w,P){"use strict";function N(e){e.preExpandDone({preventExpandAll:!1,state:"collapsed"})}function A(e){var t=x.getCommand("ExpandAll");t&&(e?t.enable():t.disable())}function I(e){e.hasChildren()&&e.setState({state:"partiallyExpanded"})}function E(e){for(var t=0;t<e.length;t++){var n=e[t];I(n),n.childComputed=!1,n.processDescendants({processNode:function(e){I(this),this.childComputed=!1}})}}var O={add_objects_when_select:void 0,authorizeChangeControl:void 0,CfgAuthoringContext:void 0};function M(){}return M.prototype=Object.assign(M.prototype,S.prototype),i.extend(f,r,s,M,{_broadcastSelect:!0,_selected_paths:[],id:"mainNodeModel",_insertFlag:!1,_pagerview:null,_selection:[],_selectedIdx:null,_focusOn:!1,_reframeFocus:!1,_currentApp:null,_emptyFromProxy:!1,_isVolumeFilter:!1,init:function(i){var s=i||{},r=this;if(s.shouldBeSelected=function(e){return!0!==e.isRelationsObjectGroupingNode},this._logger=t.getLogger("DS/ENXNav/models/xNavDocument"),e.is(s.shouldAcceptDrop)||(s.shouldAcceptDrop=this._shouldAcceptDrop.bind(this)),e.is(s.shouldAcceptDrag)||(s.shouldAcceptDrag=this._shouldAcceptDrag.bind(this)),r.renderTo=i.renderTo?i.renderTo:document.body,s.nodeModelClass=a,this._parent(s),this.options.viewport={graph:null,tree:null},this.onPreExpand(this.innerExpandChecker.bind(this)),this.isAdditionalColumnsVisible=function(){return!1},this.forceSyncModel4TreeListView=function(){},this.addEvent("onTransactionEnd",function(e,t){t||(r.getModelEvents().publish({event:"setPathTags",context:r}),r.fromTransactionEnd=!0)}),this.onPostCollapse(this._colorize3D.bind(this)),!e.is(s.remove_broadcast)||!0===s.remove_broadcast){r._commandProxy=g.create({events:{onSelect:function(t,i){if(!r._insertFlag&&!0!==t.searchDone){if(1==t.focusOn&&t.sharedID&&t.sharedID!==o.getSharedId())return;var s=!1,a=t.paths;r._selected_paths=e.clone(a);var l=function(){try{r._doNotBroadcastSelect=!0,r._selected_paths.length?r._selectOccurence("",!0,!0):i.appid===g.appId()&&(r._emptyFromProxy=!0,r.unselectAll(),r._directSelection=!1);for(var e=[],t=0;t<r._selected_paths.length;t++){r.getNodeByOccurencePath(r._selected_paths[t])&&e.push(r._selected_paths[t])}if(e.length===a.length&&e.length>0)for(var n=0;n<e.length&&!s;n++){var o=e[n].length;if(o>2){var l=r.getNodesById(e[n][o-3]);l&&l.length>0&&(s=!0)}}r._selected_paths=e}finally{setTimeout(function(){r._doNotBroadcastSelect=!1},500)}};l(),!0!==t.doNotSetOnCompass&&!0===n.getSetting("add_objects_when_select")&&a.length&&i.appid===g.appId()&&!0!==r._hideChildrenFilter&&!s&&(r._selected_paths=a,r.insertBranches(t.paths,{node_state:"collapsed",forceCollapsed:!0,novalidation:!0,onComplete:function(){let e=t.paths;for(let t=0;t<e.length;t++){let n=e[t],o=r.getNodesById(n[0]);o.length&&(o[0].childComputed=!1)}l()}}))}},onChangeControlDlgOpen:function(e){"3D"===e.widget&&n.setSetting("changeControlDlgOpen",e.isOpen)},onReframeSelection:function(){null!==r._pagerview&&(r._pagerview.hide(),delete r._pagerview)},onFocus:r._onFocus.bind(r),onFocusChange3D:function(e){e.sharedID===o.getSharedId()&&r.focusChange(e)},onShow:function(e){r._logger.log("_commandProxy.onShow");var t=[];r.withTransactionUpdate(function(){e.paths.forEach(function(e){var n=r.getNodeByOccurencePath(e);if(n){n.updateOptions({isPADHidden:!1}),t.push(n)}})}),D.publish({event:"ENXModel/hideShowState",target:t,data:{toggle:"show",nobroadcast:!e.from2D}}),D.publish({event:"ENXModel/HideShowTriggered",data:{name:"show"}})},onHide:function(e){var t=[];r._doNotBroadcastSelect=!0,r.insertBranches(e.paths,{node_state:"collapsed",forceCollapsed:!0,novalidation:!0,onComplete:function(){r.withTransactionUpdate(function(){e.paths.forEach(function(e){var n=r.getNodeByOccurencePath(e);if(n){n.updateOptions({isPADHidden:!0}),t.push(n)}})}),D.publish({event:"ENXModel/hideShowState",target:t,data:{toggle:"hide",nobroadcast:!e.from2D}})}}),r._doNotBroadcastSelect=!1,D.publish({event:"ENXModel/HideShowTriggered",data:{name:"hide"}})},onUpdate2DPosMatrix:function(e){if(!r.getXSO().isEmpty()){r.prepareUpdate();for(var t=0;t<e.instances.length;t++)for(var n=r.getNodesByRelId(e.instances[t].instance),i=0;i<n.length;i++){var s=e.instances[t].hasPositioningMatrix.join(),a={relationId:e.instances[t].instance,grid:{"positionMatrix-Instance":o.checkNotIdentity(s)?s:null}};n[i].updateOptions(a)}h.displayNotification({msg:w.pastePositionSucceeded,eventID:"info"}),r.pushUpdate()}},onUpdateViewPoint:function(e){r._viewPointCallback&&(r._viewPointCallback(e),r._viewPointCallback=null,this._viewPointTimer&&(clearTimeout(this._viewPointTimer),this._viewPointTimer=null))},onSendFilterInfo:function(){var e={filterAvailable:!1};!0===r._isVolumeFilter&&(e={filterAvailable:!0}),r._commandProxy.receiveFilterInfo(e)},onPadRefresh:function(e){if(!0===n.getSetting("activateFUN076708")){var t=function(t){var n=Object.getOwnPropertyNames(t);for(var o in n)"insertExisting"===n[o]?e.origin&&"CCP"===e.origin||r._viewInsertExisting(t.insertExisting):"detach"===n[o]?r._viewDetach(t.detach):"reParent"===n[o]?r._viewReParent(t.reParent):"replaceInstances"===n[o]?r.splitInstance(t.replaceInstances):"updateRevision"===n[o]&&r.updateRevision(t)};e.transactions?e.transactions.forEach(function(e){t(e)}):t(e)}}}});var l=function(){var e=r.getSelectedNodes();if(r.isGroupingApplied()){var t=[];for(let n=0;n<e.length;n++)!0!==e[n].isGroupingNode&&t.push(e[n]);e=t}r._doNotBroadcastSelect||(r._directSelection=!0,r._selected_paths=[],!0!==r.searchProgress&&!0!==r._focusOn&&!0!==r._insertOnFocus&&r._commandProxy.select(r._buildSelectData()),!0===r._broadcastSelect&&!0===r.options.authorize_setStructure&&(o.setObject_on_compass({nodes_2_open:e}),!1===n.getSetting("settypes")?o.setStructure_4_open_in_cv5({nodes_2_open:e,selected_paths:r._selected_paths}):o.setTypesForOFW(r))),0===e.length&&null!==r._pagerview&&!0!==r._focusOn&&!0!==r._reframeFocus&&(r._pagerview.hide(!0),delete r._pagerview,r._reframeFocus=!1)};this.getXSO().onPostAdd(function(){l(),r._focusOn=!1}),this.getXSO().onPostRemove?this.getXSO().onPostRemove(l):this.getXSO().onRemove(l),this.getXSO().onEmpty(function(){!1===r._emptyFromProxy?(!0!==r._forceDoNotBroadcastSelect?r._doNotBroadcastSelect=!1:delete r._forceDoNotBroadcastSelect,!0!==r._focusOn&&r.closePager()):r._emptyFromProxy=!1,l()}),this.getXSO().onPreEmpty(function(){!1===r._emptyFromProxy&&(r._doNotBroadcastSelect=!0)}),document.addEventListener("keyup",function(e){27===e.keyCode&&(r.getXSO().empty(),r.restoreSelection())})}n.getSetting("activateFUN104935")&&this.getModelEvents().subscribe({event:"addChild"},function(e){var t=e.data.nodeModel,n=e.parent.getChildren();t.options.grid.actualIndex=n.indexOf(t)}),D.subscribe({event:"ENXViews/Model/FindInCtx"},this._findInCtx.bind(this)),D.subscribe({event:"ENXViews/Model/remove"},l),D.subscribe({event:"ENXModel/Model/ApplyGrouping"},this.__applyGrouping.bind(this)),D.subscribe({event:"ENXModel/Model/ExpandAllGroups"},this.__expandAllGroupsCmd.bind(this)),D.subscribe({event:"ENXModel/Model/FocusOnGroups"},this.__focusOnGroupsCmd.bind(this)),D.subscribe({event:"ENXModel/Model/GroupsLayout"},this.__groupsLayoutCmd.bind(this)),o.subscribeCfgModifyEvent({handler:function(e){var t=e.commandName,n=e.response.results,o=[];switch(t){case"cfgExtendEvolutionEffectivity":(n=e.response.resources).forEach(function(e){"SUCCESS"===e.status&&e.identifier&&o.push(e.identifier)}),o.length&&r.refreshCfgValues({relids:o});break;case"cfgEditEvolution":case"cfgPasteEvolution":n.forEach(function(e){e.existing&&"SUCCESS"===e.status&&o.push(e.existing.pid)}),o.length&&r.refreshCfgValues({relids:o});break;case"cfgEditConfigurationContext":r.additionalColumnUpdateByModule("CfgConfigurationContextColumn",{pids:e.data.pids});break;default:var i,s=[];n.forEach(function(e){"SUCCESS"===e.status&&(e.new?(i={oldId:e.existing.pid,newId:e.new.pid},s.push(i)):o.push(e.existing.pid))}),s.length&&r.splitInstance({couples:s,editVariant:!0}),o.length&&r.refreshCfgValues({relids:o})}}}),D.subscribe({event:"ENXModel/Model/CopyLink"},this.__copyLink.bind(this))},broadcastSelect:function(e){this._broadcastSelect=e,!0===this._broadcastSelect&&!0===this.options.authorize_setStructure&&(o.setObject_on_compass({nodes_2_open:this.getSelectedNodes()}),!1===n.getSetting("settypes")?o.setStructure_4_open_in_cv5({nodes_2_open:this.getSelectedNodes(),selected_paths:this._selected_paths}):o.setTypesForOFW(this))},withBroadcastSelect:function(e){this.prepareBroadcastSelect(),e(),this.pushBroadcastSelect()},prepareBroadcastSelect:function(){this._doNotBroadcastSelect=!0},pushBroadcastSelect:function(){!0!==this.searchProgress&&this._commandProxy.select(this._buildSelectData()),this.broadcastSelect(!0),this._doNotBroadcastSelect=!1},setFilterBIProxy:function(e){this.options.filterBI=e},add:function(t){var o=this;o._directSelection=!0;var i=[],s={alreadyLoadedRoots:[]};e.is(t.pids,"array")&&t.pids.forEach(function(e){-1===i.indexOf(e)&&i.push(e)});for(var r=this.getRoots(),a=i.length,d=0;d<r.length;d++){var c=i.indexOf(r[d].options.resourceid);-1!==c&&(i.splice(c,1),s.alreadyLoadedRoots.push(r[d].options.resourceid))}if(o.detachedRoots&&o.detachedRoots.length>0)for(var p=0;p<o.detachedRoots.length;p++){var g=o.detachedRoots[p],f=i.indexOf(g.options.resourceid);f>-1&&(i.splice(f,1),s.alreadyLoadedRoots.push(g.options.resourceid))}if(i.length!==a&&h.displayNotification({msg:w.root_already_loaded}),i.length>0){var m=n.getWebAPI_Options("fetch");-1===m.select_predicate.indexOf("ds6w:type")&&m.select_predicate.push("ds6w:type"),-1===m.select_predicate.indexOf("ds6w:created")&&m.select_predicate.push("ds6w:created"),-1===m.select_predicate.indexOf("ds6w:modified")&&m.select_predicate.push("ds6w:modified");var b=v.isAuthoring();console.time("add-fetch"),u.fetch({enopad_webapis:n.getSetting("enopad_webapis"),data:m,pids:i,onComplete:function(r){console.timeEnd("add-fetch"),o.invalidateViewPort();var a=!1,d=e.is(r,"string")?JSON.parse(r):r;if(!d.results||d.results.length<i.length)if(!1===n.getSetting("enopad_webapis"))h.displayNotification({msg:w.object_not_found_in_db,eventID:"error",key:"enxNav-add-object-not-found-in-db"}),!a&&t.callback&&t.callback("error");else if(b)h.displayNotification({msg:w.object_not_found_in_db,eventID:"error",key:"enxNav-add-object-not-found-in-db"}),!a&&t.callback&&t.callback.call(null,s);else if(d.infos&&d.infos.sources&&d.infos.sources.length>0&&d.infos.sources[0].error){var c=d.infos.sources[0],u=c.error.errorMessage||"An error has occurred in "+c.name;h.displayNotification({msg:u,eventID:"error",key:"enxNav-add-error"}),!a&&t.callback&&t.callback.call(null,s)}else v.setAuthoringState(!0,w.PADSession_disabling_index_object_not_found),o.add(t),a=!0;else d.results.length>i.length?(h.displayNotification({msg:w.tooManyResults,eventID:"error",key:"enxNav-add-too-many-results"}),!a&&t.callback&&t.callback.call(null,s)):o.wrapInTransaction(function(){d.authoringMode&&!0===d.authoringMode&&v.setAuthoringState(!0,w.PADSession_disabling_index_from_server),l.process.fetch({treedocument:o,response:d,config_filter:t.config_filter,rootsWithFilters:t.rootsWithFilters,onComplete:function(){if(y.addRoot(),!a&&t.callback&&(t.callback.call(null,s),D.publish({event:"ENXModel/SyncModel",data:{what:"add"}})),o.isGroupingApplied()){for(var e=[],n=[],r=0;r<i.length;r++)if(-1===n.indexOf(i[r])){n.push(i[r]);var l=o.searchRootById(i[r]);l&&e.push(l)}o.__applyGrouping({roots:e,groups:o.options.groups})}},onFailure:function(e){console.error(e)}})})},onFailure:function(){h.displayNotification({msg:w.generic_service_failure,eventID:"error",key:"enxNav-add-generic-service-failure"}),t.callback&&t.callback("error")}})}else t.callback&&t.callback.call(null,s)},addPaths:function(t){var o=n.getWebAPI_Options("navigate");-1===o.select_bo.indexOf("ds6w:created")&&o.select_bo.push("ds6w:created"),-1===o.select_bo.indexOf("ds6w:modified")&&o.select_bo.push("ds6w:modified");var i=e.extend({root_path_physicalid:t.paths,expand_iter:"0",intent:"explore_2D"},o,!0),s={alreadyLoadedRoots:[]},r=this;r._directSelection=!0,i["q.iterative_filter_query_bo"]&&!0!==n.getSetting("globalTypeFiltering")&&delete i["q.iterative_filter_query_bo"];var a,d,c={};this.isGroupingApplied()&&(a=!0,d="collapsed"),c=!0===t.fromIndexFailure?t.ids:l.process.insert_temporary_branches({temporary_root:!0,treedocument:this,branches:t.paths,node_state:d,forceCollapsed:a}),s.alreadyLoadedRoots=c.rootsAlreadyLoaded;var p=t.paths.length;function g(){var n=function(){for(var n=[],o=0;o<t.paths.length;o++){if(-1===n.indexOf(t.paths[o][0])){var i=r.searchRootById(t.paths[o][0]);e.is(i)&&!0===i.options.waiting4validation&&n.push(t.paths[o][0])}for(var s=0;s<t.paths[o].length;s+=2){var a=t.paths[o][s],l=r.getNodesById(a);e.is(l,"array")&&l.forEach(function(t){if(!0===t.options.waiting4validation){var n=t.getParent();if(t.remove(),n&&!n.hasChildren()&&"noChildren"!==n.getState()&&e.is(n.setState,"function"))try{n.setState({state:"collapsed"}),n.options.children=[]}catch(e){console.error(e)}}})}}return n}();if(h.displayNotification({msg:w.allObjectCannotBeFound,eventID:"error",key:"enxNav-addPaths-all-object-not-found"}),t.callback){var o={};o.idleRootIds=n,o.success=!1,t.callback.call(r,o)}}function f(n){for(var o=[],i=0;i<t.paths.length;i++){if(-1===o.indexOf(t.paths[i][0])){var s=r.searchRootById(t.paths[i][0]);e.is(s)&&!0===s.options.waiting4validation&&o.push(t.paths[i][0])}for(var a=0;a<t.paths[i].length;a+=2){var l=t.paths[i][a],d=r.getNodesById(l);e.is(d,"array")&&d.forEach(function(t){if(!0===t.options.waiting4validation){var n=t.getParent();if(t.remove(),n&&!n.hasChildren()&&"noChildren"!==n.getState()&&e.is(n.setState,"function"))try{n.setState({state:"collapsed"}),n.options.children=[]}catch(e){console.error(e)}}})}}if(n&&n.removedByFilter?h.displayNotification({msg:w.cannot_insert_branch_filtered,eventID:"info"}):h.displayNotification({msg:w.cannot_insert_branch,eventID:"error",key:"enxNav-addPaths-cannot-insert-branch"}),t.callback){var c={};c.idleRootIds=o,c.success=!1,t.callback.call(r,c,"error")}}if(0===c.ids_to_fetch.length&&0===c.relationids.length){if(h.displayNotification({msg:w.root_already_loaded}),t.callback){t.callback.call(r,{sucess:!0},s)}}else{let o=s.alreadyLoadedRoots.map(function(e){return r.getNodesById(e)[0]}).filter(function(e){return!0===e.options.filtered}),a=o.length>0;if(a)for(let e=0;e<o.length;e++){let t=o[e];t.options&&t.options.sequence_filter&&(i.sequence_filter=t.options.sequence_filter),t.options&&t.options.config_filter&&(i.config_filter=t.options.config_filter)}var m=v.isAuthoring();console.time("addPaths"),u.navigate({enopad_webapis:n.getSetting("enopad_webapis"),data:i,onComplete:function(o){var i,d,u;try{console.timeEnd("addPaths");var h=e.is(o,"string")?JSON.parse(o):o;if(h.results)if(h.results.length>0&&!h.error){if(i=r.startTransaction("expand"),h.authoringMode&&!0===h.authoringMode&&v.setAuthoringState(!0,w.PADSession_disabling_index_from_server),l.process.validateAndUpdateBranches({treedocument:r,response:h,forcePartiallyExpanded:!0}),a)for(let e=0;e<roots.length;e++)C.node.setFilterBadge(roots[e]);if(y.addRoot(),(d=h.results,u=0,d.forEach(function(e){e.attributes&&u++}),u)<p)return t.fromIndexFailure?void g():!0!==n.getSetting("authoringModeNotSupported")&&!1===v.isAuthoring()?(v.setAuthoringState(!0,w.PADSession_disabling_index_object_not_found),t.fromIndexFailure=!0,t.ids=c,void r.addPaths(t)):void g();if(t.callback){var b={success:!0};if(t.callback.call(r,b,s),D.publish({event:"ENXModel/SyncModel",data:{what:"addPaths"}}),r.isGroupingApplied()){for(var _=[],S=[],x=t.paths,P=0;P<x.length;P++)if(-1===S.indexOf(x[P][0])){S.push(x[P][0]);var N=r.searchRootById(x[P][0]);N&&_.push(N)}r.__applyGrouping({roots:_,groups:r.options.groups})}}}else{if(a)return void f({removedByFilter:!0});!0!==n.getSetting("authoringModeNotSupported")&&!1===m?(v.setAuthoringState(!0,w.PADSession_disabling_index_object_not_found),t.fromIndexFailure=!0,t.ids=c,r.addPaths(t)):f()}else f()}catch(e){f()}finally{i&&i.end()}},onFailure:function(e){!0!==n.getSetting("authoringModeNotSupported")&&!1===v.isAuthoring()?(v.setAuthoringState(!0,w.PADSession_disabling_index_object_not_found),t.fromIndexFailure=!0,t.ids=c,r.addPaths(t)):f()}})}},innerExpandChecker:function(e){var t=e.data,o=t.nodeModel;if(!!t.expandAll&&t.expandAll&&!0===n.getSetting("activateSynthesisOnRoot")){var i=document.getElementsByClassName("enx-appMainBody");if(i&&1===i.length){i=i[0];var s=o.isRoot()?o:o.getRoot(),r=this;require(["DS/ENXNav/views/private/ExpandChecker"],function(t){t.check({targetDiv:i,roots:[s]}).then(function(t){!0===t.performExpandAll?r.xnav_expand(e):e.target.preExpandDone({preventExpandAll:!0,state:"collapsed"})})})}else this.xnav_expand(e)}else this.xnav_expand(e)},xnav_expand:function(t){var o=t.data,i=o.nodeModel,s=!!o.expandAll&&o.expandAll,r=null,a=!1,d="default",c=o.numberOfLevelsToExpand?o.numberOfLevelsToExpand.toString():n.getSetting("expand_iter");if(!0!==i.isGroupingNode&&void 0===i.options.fakeNodesTable){s&&(i._expandAllPending=!0,A(!1),this.isGroupingApplied()&&this.__expandAllGroups(i)),this.invalidateViewPort(),s&&(c="-1");var p=parseInt(c),g=n.getSetting("activateFUN085903")&&(-1===p||p>1),f=this;if((r=t.target.options.partialPreExpand)&&(a=!0,d="find_in_ctx",this.getXSO().empty()),i.childComputed&&!1===a){var m=i.getDepth();if(function(e,t,n){function o(e){if(e.childComputed&&e.hasChildren()){var t=e.getChildren();if(1===t.length){let n=!1,o=e.getReferenceValue("ds6w:kind");return!o||-1===o.indexOf("3DPart")||"ds6w:Document"!==t[0].getReferenceValue("ds6w:globalType")&&"ds6w:Document"!==t[0].getReferenceValue("ds6w:globaltype")||(n=!0),n}}}var i=function(e,t,n){if(-1===t||n<t){if(e.childComputed||!0===e.isGroupingNode){if(e.hasChildren()){for(var s=e.getChildren(),r=!0,a=0;a<s.length&&!0===r;a++){var l=s[a];if(!(l.childComputed&&g&&o(l))&&(l.childComputed&&"noExpandState"!==l._expandState&&(l.getDepth()<t||-1===t)?l.setState({state:"expanded"}):!0===l.isGroupingNode&&(l.setState({state:"expanded"}),-1!==t&&t++),l.childComputed&&"noChildren"===l.options.padstate&&!l.hasChildren()&&l.setState({state:"noChildren"}),void 0===(r=i(l,t,n+1))))throw new Error("Undefined no_expand_needed flag")}return r}return!0}return!(-1===t||t>n)}return!0};return i(e,t,n)}(i,s?parseInt(c):m+parseInt(c),m))return t.target.preExpandDone({preventExpandAll:!0}),f._selectOccurence(),delete i._expandAllPending,void A(!0)}var b=e.extend({root_physicalid:i.getID(),expand_iter:c,intent:"explore_2D"},n.getWebAPI_Options("navigate"),!0);!0!==n.getSetting("globalTypeFiltering")&&(b["q.iterative_filter_query_bo"]&&delete b["q.iterative_filter_query_bo"],!0===n.getSetting("dynamic_authorized_types")?b.no_type_filter_bo=n.getSetting("no_type_filter_bo"):b.type_filter_bo=n.getSetting("type_filter_bo")),!0===a?(a=!0,t.target.options.partialPreExpand=null,b.find_path_filter=[{option:["cut"],path_physicalid:r()}],delete b.expand_iter,v.isUsingIndex()||h.displayNotification({msg:P.find_in_ctx_after_authoring,eventID:"warning",key:"enxNav-findInCtxAfterAuthoring"})):t.target.options.findInCtxFTS&&(a=!0,d="find_in_ctx",this.getXSO().empty(),b.find_in_context=[{"q.query":t.target.options.findInCtxFTS}],t.target.options.findInCtxFTS,delete t.target.options.findInCtxFTS,delete b.expand_iter,v.isUsingIndex()||h.displayNotification({msg:P.find_in_ctx_after_authoring,eventID:"warning",key:"enxNav-findInCtxAfterAuthoring"}));var _=i,S=!1,x=!1,C=0;i.isRoot()||(_=i.getRoot()),_.options&&_.options.sequence_filter&&(b.sequence_filter=_.options.sequence_filter,x=!0),_.options&&_.options.config_filter&&(b.config_filter=_.options.config_filter,x=!0);var I=!0===n.getSetting("alwaysExpandPath")||x||n.getSetting("pgpFromServer");if(I){var O=i.getOccurencePath();C=O.length-1,b.paths=[O],delete b.root_physicalid}a?(S=!1,b.max_output_paths=300):S=n.getSetting("enopad_webapis"),f.prepareUpdate(),u.navigate({find_in_ctx:a,enopad_webapis:S,data:b,onComplete:function(o){var s,r=!1;try{s=f.startTransaction("expand");var u=!1,p=e.is(o,"string")?JSON.parse(o):o;if(0===p.results.length)a?h.displayNotification({msg:w.find_in_context_no_result,eventID:"info"}):h.displayNotification({msg:w.generic_service_failure,eventID:"error",key:"enxNav-xnav_expand-generic-service-failure"});else{"partiallyExpanded"!==i.options.padstate||a||f._commandProxy.padExpand({paths:[i.getOccurencePath()],expand_level:c});var g=i,v=parseInt(c);I&&(g=_,-1!==v&&(v+=C));var m=n.getSetting("parse_timeout"),b=m?parseInt(m):void 0;console.time(">> expand_parse"),l.process.expand({treedocument:f,root_nodes:[g],response:p,mode:d,expand_level:v,selectPathLeaf:a,noCheckOrder:!0,parseTimeout:b,realExpandedNodes:[i],setExpandStatus:function(e){u=e.expandTooLarge}}),y.expand(),console.timeEnd(">> expand_parse"),r=!0}}catch(e){e.type&&"TimeoutError"===e.type?(h.displayNotification({msg:w.parseTimeout,eventID:"warning",key:"enxNav-xnav_expand-parse-timeout"}),E([i])):h.displayNotification({msg:w.generic_service_failure,eventID:"error",key:"enxNav-xnav_expand-generic-service-failure"})}finally{if(a){for(var S=f.getXSO().get(),x={paths:[],reframe:!0,expand_level:-1},P=0;P<S.length;P++)x.paths.push(S[P].getOccurencePath());x.paths.length>0&&f._commandProxy.padExpand(x)}else r&&(i.childComputed=!0,f._selectOccurence());var N;s&&s.end(),a?0===i.options.relcount?(i.options.children=null,N="noChildren"):N="partiallyExpanded":!0===u&&(N="partiallyExpanded"),delete i._expandAllPending,A(!0),t.target.preExpandDone({preventExpandAll:!0,state:N}),D.publish({event:"ENXModel/SyncModel",data:{what:"expand"}}),f.pushUpdate()}},onFailure:function(){N(t.target),delete i._expandAllPending,A(!0),h.displayNotification({msg:w.generic_service_failure,eventID:"error",key:"enxNav-xnav_expand-generic-service-failure"}),f.pushUpdate()},onTimeout:function(){N(t.target),delete i._expandAllPending,A(!0),h.displayNotification({msg:w.timeout,eventID:"error",key:"enxNav-xnav_expand-timeout"}),f.pushUpdate()}})}},applyFilter:function(t){for(var i=this,s=[],r=0;r<t.filterRootIds.length;r++){var a=i.searchRootById(t.filterRootIds[r]);a&&(a.options.CVQuery=t.CVQuery,s.push(a))}if(void 0!==t.CVQuery.union||void 0!==t.CVQuery.intersection||void 0!==t.CVQuery.minus){var d=e.clone(t.CVQuery);if(d.union&&d.union.expand&&d.union.expand.length>1){for(var c=[],p=0;p<d.union.expand.length;p++){d.union.expand[p].volume_filter&&c.push(p)}for(var g=0;g<c.length;g++)d.union.expand.splice(c[g],1)}var f=n.getWebAPI_Options("navigate");d.select_bo=f.select_bo,d.select_rel=f.select_rel,d.compute_select_bo=f.compute_select_bo;var v=!1;if(!0===t.structCollapse){v=!0;var m=P.applyingFilter;i.getModelEvents().publish({event:"beginBlockingTransaction",data:m,context:i})}d.label=o.getRequestLabel();var b=Promise.resolve();i.isGroupingApplied()&&(i.cleanGroupingForRoots({rootIds:t.filterRootIds}),b=i.__applyGrouping({roots:s,groups:i.options.groups,fromApplyFilter:!0})),b.then(()=>{i.prepareUpdate(),u.multiexpand({enopad_webapis:!1,data:d,onComplete:function(t){var n;try{n=i.startTransaction("expand");var o=e.is(t,"string")?JSON.parse(t):t;void 0===o.results||0===o.results.length?h.displayNotification({msg:w.sequence_filter_error,eventID:"info"}):l.process.expand({treedocument:i,root_nodes:s,response:o,mode:"filter",expand_level:-1,selectPathLeaf:!1,realExpandedNodes:s,noCheckOrder:!0})}catch(e){h.displayNotification({msg:w.generic_service_failure,eventID:"error",key:"enxNav-applyFilter-generic-service-failure"})}finally{s.forEach(function(t){t.childComputed=!0;var n=e.clone(t.options.icons[0]);if(n.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},t.updateOptions({icons:[n]}),!0===v&&t.collapseAll(),!0===i.isGroupingApplied()){t.setState({state:"expanded"});let e=t.getChildren();for(let t=0;t<e.length;t++){e[t].options.contentRetrieved=!0}}}),i._selectOccurence(),n&&n.end(),i.pushUpdate(),i.options.groupingFilterInProgress=!1,D.publish({event:"ENXModel/SyncModel",data:{what:"applyFilter"}}),i.getModelEvents().publish({event:"endBlockingTransaction",context:i})}},onFailure:function(e,t){i.getModelEvents().publish({event:"endBlockingTransaction",context:i}),e&&console.error(e),h.displayNotification({msg:w.generic_service_failure,eventID:"error",key:"enxNav-applyFilter-generic-service-failure"}),i.pushUpdate(),i.getModelEvents().publish({event:"setTags",data:{facets:{}}})}})})}},expandMultiSelect:function(t){var o=!!t.expandAll&&t.expandAll,i=t.numberOfLevelsToExpand?t.numberOfLevelsToExpand.toString():n.getSetting("expand_iter"),s=n.getSetting("enopad_webapis");let r={};t.entryMsg?(r.parseTimeout=t.entryMsg+" "+w.parseTimeout,r.timeout=t.entryMsg+" "+w.timeout,r.failure=t.entryMsg+" "+w.generic_service_failure):(r.parseTimeout=w.parseTimeout,r.timeout=w.timeout,r.failure=w.generic_service_failure),this.invalidateViewPort(),o&&(i="-1");var a=this,d=!0===n.getSetting("alwaysExpandPath")||isNGFilter||n.getSetting("pgpFromServer");a.prepareUpdate();for(var c=[],p=0;p<t.nodes2Expand.length;p++){if((C=t.nodes2Expand[p]).childComputed){var g=C.getDepth();this._expandChildren(C,o?parseInt(i):g+parseInt(i),g)||c.push(C)}else c.push(C)}if(0===c.length)a._colorize3D(a),a.forceSyncModel4TreeListView(),a.pushUpdate(),t.callback&&t.callback();else{var f=[],v=0,m=[],b=[],_=[];this.withTransactionUpdate(function(){for(var e=0;e<c.length;e++){c[e].setState({state:"expanding"});var t=c[e];if(t.isRoot()||(t=c[e].getRoot()),!0===d){var n=c[e].getOccurencePath();-1===_.indexOf(t.getID())&&(_.push(t.getID()),b.push(t)),v=Math.max(n.length-1,v),m.push(n)}else m.push([c[e].getID()]),-1===_.indexOf(c[e].getID())&&(_.push(c[e].getID()),b.push(c[e]))}}),a.pushUpdate();var S=[],x=new Promise(function(o){a.prepareUpdate();var p=e.extend({paths:m,expand_iter:i,intent:"explore_2D"},n.getWebAPI_Options("navigate"),!0);u.navigate({find_in_ctx:!1,enopad_webapis:s,data:p,timeout:n.getSetting("expand_multisel_timeout"),onComplete:function(s){var u;try{!1!==t.tagger&&(u=a.startTransaction("expand"));var p=e.is(s,"string")?JSON.parse(s):s;if(0===p.results.length)h.displayNotification({msg:r.failure,eventID:"error",key:"enxNav-expandMultiSelect-no-results"});else{var g=parseInt(i);!0===d&&-1!==g&&(g+=v);var f=n.getSetting("parse_timeout"),m=f?parseInt(f):void 0;l.process.expand({treedocument:a,root_nodes:b,response:p,mode:"default",expand_level:g,selectPathLeaf:!1,noCheckOrder:!0,parseTimeout:m,realExpandedNodes:c})}}catch(e){e.type&&"TimeoutError"===e.type?(h.displayNotification({msg:r.parseTimeout,eventID:"error",key:"enxNav-expandMultiSelect-parse-timeout"}),E(b)):h.displayNotification({msg:r.failure,eventID:"error",key:"enxNav-expandMultiSelect-failure"})}finally{a.pushUpdate(),!0===d?c.forEach(function(e){e.isRoot()&&(e.childComputed=!0)}):b.forEach(function(e){e.childComputed=!0}),a._selectOccurence(),u&&u.end(),o()}},onTimeout:function(){for(let e=0;e<b.length;e++)N(b[e]);h.displayNotification({msg:r.timeout,eventID:"error",key:"enxNav-expandMultiSelect-timeout"}),a.pushUpdate(),o()},onFailure:function(){for(let e=0;e<b.length;e++)N(b[e]);h.displayNotification({msg:r.failure,eventID:"error",key:"enxNav-expandMultiSelect-failure"}),a.pushUpdate(),o()}})});S.push(x);for(var y=0;y<f.length;y++){var C=f[y],P=new Promise(function(o){var d,c=e.extend({expand_iter:i,intent:"explore_2D"},n.getWebAPI_Options("navigate"),!0),p=C;C.isRoot()||(p=C.getRoot()),p.options.sequence_filter&&(c.sequence_filter=p.options.sequence_filter),p.options.config_filter&&(c.config_filter=p.options.config_filter),p.options.CVQuery&&(p.options.CVQuery.sequence_filter&&(c.sequence_filter=p.options.CVQuery.sequence_filter),p.options.CVQuery.config_filter&&(c.config_filter=p.options.CVQuery.config_filter));var g=C.getOccurencePath();d=g.length-1,c.paths=[g],a.prepareUpdate(),u.navigate({find_in_ctx:!1,enopad_webapis:s,data:c,onComplete:function(n){var s;try{!1!==t.tagger&&(s=a.startTransaction("expand"));var c=e.is(n,"string")?JSON.parse(n):n;if(0===c.results.length)h.displayNotification({msg:r.failure,eventID:"error",key:"enxNav-expandMultiSelect-failure"});else{var u=parseInt(i);-1!==u&&(u+=d),l.process.expand({treedocument:a,root_nodes:[p],response:c,mode:"default",expand_level:u,selectPathLeaf:!1})}}catch(e){h.displayNotification({msg:r.failure,eventID:"error",key:"enxNav-expandMultiSelect-failure"})}finally{p.childComputed=!0,a._selectOccurence(),s&&s.end(),o()}},onTimeout:function(){for(let e=0;e<b.length;e++)N(b[e]);h.displayNotification({msg:r.timeout,eventID:"error",key:"enxNav-expandMultiSelect-timeout"}),a.pushUpdate(),o()},onFailure:function(){for(let e=0;e<b.length;e++)N(b[e]);h.displayNotification({msg:r.failure,eventID:"error",key:"enxNav-expandMultiSelect-failure"}),a.pushUpdate(),o()}})});S.push(P)}var A=Promise.all(S);t.callback&&A.then(t.callback),A.then(function(){D.publish({event:"ENXModel/SyncModel",data:{what:"expandMultiSelect"}})})}},_findInCtx:function(t){var i=this;require(["DS/PADServices/utils/AttributesMgtV2","DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils"],function(s,r,a,d){i.searchProgress=!0,i._selection=[],i.rootFound=[],i.prepareUpdate(),i.prepareBroadcastSelect(),i.getXSO().empty(),v.determineAuthoredFlag()&&d.displayNotif({message:P.find_in_ctx_after_authoring,level:"warning",key:"xNavDocument-find-in-ctx-after-auth"});var c,u=s.createOutputsRequest(),p=n.getWebAPI_Options("navigate");c=r.findInCtx?Promise.resolve():a.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0});t.nodes.length;let h=[];var g=function(e){return new Promise(function(n,o){e<t.nodes.length?f(e).then(function(){g(e+1).then(n).catch(o)}):n()})},f=function(s){return new Promise(function(a,c){var g=t.nodes[s];g.setState({state:"expanding"});var f={filterBI:i.options.filterBI,data:{select_bo:u.select_object,select_rel:u.select_relation,compute_select_bo:u.select_file},pathIds:[g.getOccurencePath()],iterativeFilter:p["q.iterative_filter_query_bo"],filterRel:p.no_type_filter_rel,ftsString:t.searchFts,rscIdToSearch:t.rscId,max_output_paths:n.getSetting("maxPathsForSearch")};f.data.select_rel.push("ds6w:type");r.findInCtx(f).then(function(s){try{var r=e.is(s,"string")?JSON.parse(s):s;if(!0===r.timeoutOccurs)N(g),delete g._expandAllPending,A(!0),g.setState({state:"collapsed"}),d.displayNotif({message:w.find_in_context_timeout,level:"error",key:"xNavDocument-find-in-ctx-timeout"});else{var c=g;c.isRoot()||(c=c.getRoot());var u=n.getSetting("parse_timeout"),p=u?parseInt(u):void 0;let t=null;if(c.options.filtered){t=c.getIcons()[0].badges}if(l.process.expand({treedocument:i,root_nodes:[c],response:r,mode:"find_in_ctx",expand_level:-1,selectPathLeaf:!0,noCheckOrder:!0,parseTimeout:p,realExpandedNodes:[g],setExpandStatus:function(e){e.expandTooLarge}}),t){var f=e.clone(c.options.icons[0]);void 0===f&&(f={}),f.badges=t,c.updateOptions({icons:[f]})}}}catch(e){e.type&&"TimeoutError"===e.type?(d.displayNotif({message:w.parseTimeout,level:"warning",key:"xNavDocument-find-in-ctx-parse-timeout"}),E([g])):d.displayNotif({message:w.generic_service_failure,level:"error",key:"xNavDocument-find-in-ctx-generic-error"})}finally{if(!0!==r.timeoutOccurs){var v,m=i.getXSO().get();if((m=m.filter(function(e){return-1===h.indexOf(e)})).forEach(function(e){var t,n;n=e,-1===(t=h).indexOf(n)&&t.push(n),1===e.getOccurencePath().length?-1===i.rootFound.indexOf(e.getOccurencePath()[0])&&(i.rootFound.push(e.getOccurencePath()[0]),i._selection.push(e.getOccurencePath())):i._selection.push(e.getOccurencePath())}),!0!==t.noPager&&(i.originalSelection=i._selection),i._selection.length>1?(i._doNotBroadcastSelect=!0,!0!==t.doNotBroacast&&i._commandProxy.focus({intent:"focus",paths:i._selection,widget:"2D",sharedID:o.getSharedId(),appID:o.getAppId()}),i._forceDoNotBroadcastSelect=!0,i.unselectAll(),!0!==t.noPager&&(i.displayPager(),i.reframeOn({idx:i._selectedIdx}))):i._pagerview?(i._pagerview.hide(),delete i._pagerview):!0===t.noPager&&i.unselectAll(),!0!==t.doNotBroacast){for(var b={paths:[],reframe:!0,expand_level:-1},_=0;_<m.length;_++)b.paths.push(m[_].getOccurencePath());i._commandProxy.padExpand(b)}0===g.options.relcount?(g.options.children=null,v="noChildren"):v="partiallyExpanded",delete g._expandAllPending,g.setState({state:v}),A(!0)}D.publish({event:"ENXModel/SyncModel",data:{what:"FindInCtx"}}),a()}}).catch(function(e){N(g),delete g._expandAllPending,A(!0),g.setState({state:"collapsed"}),c()})})};c.then(function(){g(0).then(function(){i.searchProgress=!1}).catch(function(e){console.log("Find in Context finished with error"),i.searchProgress=!1}).finally(function(){0===i._selection.length&&d.displayNotif({message:w.find_in_context_no_result,level:"info"}),i.pushUpdate();for(var e=[],t=0;t<i._selection.length;t++){var n=i.getNodeByOccurencePath(i._selection[t]);n&&e.push(n)}D.publish({event:"ENXViews/Model/FindInCtx/complete",data:{foundNodes:e}})})})})},fillAttributesAsync4VisibleNodes:function(t,o,i){var s=this,r=function(){o&&o()},a=function(){s.fillAttributesAsync4VisibleNodes([],o,i)};if(this._pendingNodes||(this._pendingNodes=[]),this._pendingAttr)return void(this._pendingNodes=this._pendingNodes.concat(t));t=t.concat(this._pendingNodes),this._pendingNodes.length=0,this._pendingAttr=!0;let l=new c({});var d=function(t,o){var i=o;return e.is(s.filterAttributesForUpdate,"function")&&(i=s.filterAttributesForUpdate({node:t,node_opts:i})),-1===i.relationOrder&&(i.relationOrder=t.options.relationOrder),!0===n.getSetting("tree_order_in_label")&&i.label&&(i.label+="(treeorder="+i.relationOrder+")"),i};function u(e,t){if(!0!==e.isRelationsObjectNode){for(var n=0;n<s.options.additionalColumnsModules.length;n++)if("SyncModelNodes"!==i||"function"==typeof s.options.additionalColumnsModules[n].hasStructureModelUpdate){for(var o=s.options.additionalColumnsModules[n],r=o.getManagedColumnNames(),a={},d=0;d<r.length;d++)a[r[d]]=e.options.grid[r[d]];var c="function"==typeof o.getAutoReloadNames?o.getAutoReloadNames():[];for(d=0;d<c.length;d++)a[c[d]]=e.options.grid[c[d]];if(!o.toBeUpdated(a,i)||"SyncModelRefresh"!==i&&"SyncModelNodes"!==i&&"OnReady"!==i&&"OnSyncModel"!==i&&"OnScrollEnd"!==i){if("SyncModelRefresh"===i||"SyncModelNodes"===i||"OnReady"===i||"OnSyncModel"===i||"OnScrollEnd"===i){let e=o.getName();"ENODOFormatStatus_Col"!==e&&"ENOXCADSyncStatus_Col"!==e||l.addOtherKeys(r)}}else{void 0===t[o.getName()]&&(t[o.getName()]={pids:[],relids:[],pairs:{}});var u=e.getID();-1===t[o.getName()].pids.indexOf(u)&&t[o.getName()].pids.push(u);var p=e.getRelationID();p&&-1===t[o.getName()].relids.indexOf(p)&&(t[o.getName()].relids.push(p),t[o.getName()].pairs[u]=p)}}}else l.addRelationNode(e)}if(this.options.additionalColumnsModules&&this.options.additionalColumnsModules.length){var p=this.getVisibleAdditionalColumns();p.length?require(["UWA/Promise","DS/ENXNav/models/Algos"],function(n,o){var i={};new n(function(e){for(var n=m.createProbe("VisitNodes For additional columns"),o=0;o<t.length;o++)u(t[o],i);e(),n.end()}).then(function(){for(var c=[],u=0;u<p.length;u++){var h=p[u],g=h.module.getName();if(i[g]){var f=new n(function(t){h.module.updateAttributes(i[g],function(n){var o=e.is(n,"string")?JSON.parse(n):n;t(o)},s)});c.push(f)}}c.length?n.all(c).then(function(n){for(var i={},c=!1,u=0;u<n.length;u++){let t=n[u];if(!c){let e=Object.keys(t.pids),n=Object.keys(t.relids);c=e.length>0&&0===n.length}e.extend(i,n[u],!0)}s.setUseChangeTransactionMode(!0),s.withTransactionUpdate(function(){var e=0,t=Object.getOwnPropertyNames(i.pids),n=Object.getOwnPropertyNames(i.relids),r=[];if(n)for(var a=0;a<n.length;a++){if((h=s.getNodesByRelId(n[a]))&&h.length)for(e=0;e<h.length;e++){var l=o.extractGridChanges(d(h[e],{grid:i.relids[n[a]]}),h[e].options);l.hasChanged&&h[e].updateOptions(l.finalResults);var u=h[e].getID();-1!==t.indexOf(u)&&r.push(u)}else console.warn("Should not happen. The node should be found")}if(c||r.length>0&&r.forEach(function(e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}),t&&t.length>0)for(var p=0;p<t.length;p++){var h;if((h=s.getNodesById(t[p]))&&h.length)for(e=0;e<h.length;e++){var g=o.extractGridChanges(d(h[e],{grid:i.pids[t[p]]}),h[e].options);g.hasChanged&&h[e].updateOptions(g.finalResults)}else console.warn("Should not happen. The node should be found")}}),l.applyMerger(i),s.setUseChangeTransactionMode(!1),r();var p=s._pendingNodes.filter(function(e){return-1===t.indexOf(e)});s._pendingNodes=p,s._pendingAttr=!1,s._pendingNodes.length&&setTimeout(a,0)}):(s._pendingAttr=!1,r())})}):(s._pendingAttr=!1,r())}},fillAttributesAsync4VisibleNodes_rearch:function(e){if(this._pendingNodes||(this._pendingNodes=[]),this._pendingAttr)this._pendingNodes=this._pendingNodes.concat(e);else{e=e.concat(this._pendingNodes),this._pendingNodes.length=0,this._pendingAttr=!0;var t=this;this.fillAdditionalColumns(e).then(function(){t._pendingAttr=!1})}},fillAdditionalColumns:function(t,n){var o=this,i=Array.isArray(n),s=function(e,t){var n=t;return-1===n.relationOrder&&(n.relationOrder=e.options.relationOrder),n};function r(e,t){if(!0!==e.isRelationsObjectNode)for(var s=0;s<o.options.additionalColumnsModules.length;s++){for(var r=o.options.additionalColumnsModules[s],a=r.getManagedColumnNames(),l={},d=!1,c=0;c<a.length;c++)l[a[c]]=e.options.grid[a[c]];var u="function"==typeof r.getAutoReloadNames?r.getAutoReloadNames():[];for(c=0;c<u.length;c++)l[u[c]]=e.options.grid[u[c]];var p=Object.keys(l);if(i){for(var h={},g=0;g<p.length;g++)-1!==n.indexOf(p[g])&&(h[p[g]]=l[p[g]],d=!0);l=h}else p.length&&(d=!0);if(!0===d&&!0===r.toBeUpdated(l)){void 0===t[r.getName()]&&(t[r.getName()]={pids:[],relids:[],pairs:{},ocps:[]});var f=e.getID();-1===t[r.getName()].pids.indexOf(f)&&t[r.getName()].pids.push(f);var v=e.getRelationID();v&&-1===t[r.getName()].relids.indexOf(v)&&(t[r.getName()].relids.push(v),t[r.getName()].pairs[f]=v)}}}return new Promise(function(n,a){if(o.options.additionalColumnsModules&&o.options.additionalColumnsModules.length){var l=o.getVisibleAdditionalColumns(i);l.length?require(["DS/ENXNav/models/Algos"],function(i){var a={};new Promise(function(e){for(var n=m.createProbe("VisitNodes For additional columns"),o=0;o<t.length;o++)r(t[o],a);e(),n.end()}).then(function(){for(var t=[],r=0;r<l.length;r++){var d=l[r],c=d.module.getName();if(a[c]){var u=new Promise(function(t){d.module.updateAttributes(a[c],function(n){var o=e.is(n,"string")?JSON.parse(n):n;t(o)},o)});t.push(u)}}t.length?Promise.all(t).then(function(t){for(var r={},a=!1,l=0;l<t.length;l++){let n=t[l];if(!a){let e=Object.keys(n.pids),t=Object.keys(n.relids);a=e.length>0&&0===t.length}e.extend(r,t[l],!0)}o.setUseChangeTransactionMode(!0),o.withTransactionUpdate(function(){var e=0,t=Object.getOwnPropertyNames(r.pids),n=Object.getOwnPropertyNames(r.relids),l=[];if(n)for(var d=0;d<n.length;d++){if((h=o.getNodesByRelId(n[d]))&&h.length)for(e=0;e<h.length;e++){var c=i.extractGridChanges(s(h[e],{grid:r.relids[n[d]]}),h[e].options);c.hasChanged&&h[e].updateOptions(c.finalResults);var u=h[e].getID();-1!==t.indexOf(u)&&l.push(u)}else console.warn("Should not happen. The node should be found")}if(a||l.length>0&&l.forEach(function(e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}),t&&t.length>0)for(var p=0;p<t.length;p++){var h;if((h=o.getNodesById(t[p]))&&h.length)for(e=0;e<h.length;e++){var g=i.extractGridChanges(s(h[e],{grid:r.pids[t[p]]}),h[e].options);g.hasChanged?h[e].updateOptions(g.finalResults):g.finalResults.grid&&void 0!==g.finalResults.grid.v6_specdoc_to&&h[e].updateOptions(g.finalResults)}else console.warn("Should not happen. The node should be found")}}),o.setUseChangeTransactionMode(!1),n()}):n()})}):n()}})},updateColorForNodes:function(e,t,o){var i=this,s=require("DS/PADUtils/Configuration"),r=function(e,r){return new Promise(function(a){var l=[];i.withTransactionUpdate(function(){for(var r=0;r<e.length;r++){var a=e[r];if(!0!==a.isGroupingNode){var d;if(null!==(d=a.getPLMValue(t.predicate))){var c={color:u=_.getBIColor(o,t,d),isBeingCut:!1,grid:{bi_color:u}};a.ghostMode=!1,"rgba(255, 255, 255, 0.3)"===u&&(delete a.options.color,a.ghostMode=!0,c.isBeingCut=!0),a.updateOptions(c),i.options.shouldBeSelected(a)}else if(!1===s.getConfig("readOnlyApp"))l.push(a.getID());else{c={color:"rgba(255, 255, 255, 0.3)",isBeingCut:!0,grid:{bi_color:"rgba(255, 255, 255, 0.3)"}};delete a.options.color,a.ghostMode=!0,a.updateOptions(c),i.options.shouldBeSelected(a)}if(!0===n.getSetting("synthesisModeOnInstance"))if(!1===a.isRoot())if(null!==(d=a.getPLMValue(t.predicate+"-Instance"))){var u;c={colorInstance:u=_.getBIColor(o,t,d)};a.updateOptions(c)}else if(!1===s.getConfig("readOnlyApp"))l.push(a.getID());else{c={colorInstance:"rgba(255, 255, 255, 0.3)"};a.updateOptions(c)}}}}),0===l.length?(!0===i.fromTransactionEnd&&delete i.fromTransactionEnd,!0===r&&i._colorize3D(i),a()):i.updateNodesAttrValue(l,[t.predicate],function(e){i.withTransactionUpdate(function(){for(let d=0;d<l.length;d++){var e=i.getNodesById(l[d]);if(e.length>0){var n=e[0].getPLMValue(t.predicate);if(null!==n)for(var s=_.getBIColor(o,t,n),r={color:s,isBeingCut:!1,grid:{bi_color:s}},a=0;a<e.length;a++)e[a].ghostMode=!1,"rgba(255, 255, 255, 0.3)"===s&&(delete e[a].options.color,e[a].ghostMode=!0,r.isBeingCut=!0),e[a].updateOptions(r),i.options.shouldBeSelected(e[a]);else for(r={grid:{bi_color:"rgba(255, 255, 255, 0.3)"}},a=0;a<e.length;a++)delete e[a].options.color,r.isBeingCut=!0,e[a].ghostMode=!0,e[a].updateOptions(r),i.options.shouldBeSelected(e[a])}}}),!0===r&&i._colorize3D(i),a()})})},a=e.length<1e3?100:200;r(e).then(function(){setTimeout(function(){r(i.getAllDescendants(),!0)},a)})},updateSpecificColumnViews:function(e,t,n){let o=Object.keys(t);for(let i=0;i<o.length;i++)t[o[i]].updateAttributesDelayed(e,n,this)},refreshCfgValues:function(t){var n=this;if(t.relids&&t.relids){var o=[];t.relids.forEach(function(e){var t=n.getNodesByRelId(e);t&&t.length&&t.forEach((e,t)=>{o.push(e.getID())})});var i,s={relids:t.relids,pids:o};if(n.options.additionalColumnsModules&&n.options.additionalColumnsModules.length){var r=n.getVisibleAdditionalColumns();if(r.length){for(var a=[],l=0;l<r.length;l++){var d=r[l];if("CfgEffectivityColumns"===d.module.getName()){i=d.module,console.count("Cfg_updateAttributes_A");var c=new Promise(function(t,o){i.updateAttributes(s,function(n){var i=e.is(n,"string")?JSON.parse(n):n;console.log("updateAttributes_A response==>",i),t(i),o("Error in Cfg_updateAttributes")},n)});a.push(c)}}a.length?Promise.all(a).then(function(e){n.setUseChangeTransactionMode(!0),n.withTransactionUpdate(function(){t.relids.forEach(function(t){var o=n.getNodesByRelId(t);o&&o.length&&o.forEach(n=>{e&&e.length&&e.forEach(e=>{if(e.relids){var o=e.relids[t];o&&n.updateOptions({grid:o})}})})})}),n.setUseChangeTransactionMode(!1)}).catch(e=>{console.log("An Error Occured")}):console.info("No cfg to update")}else console.info("No cfg Columns Module")}else console.info("No cfg Module")}else console.error("no relids to refresh")},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,tiles:null,thumbnails:null,datagrid:null}},getNodesById:function(e){var t=[];return this.getRoots().forEach(function(n){var o=n.getNodesById(e);t=t.concat(o)}),t},getNodeByOccurencePath:function(e){for(var t=this.getRoots(),n=0;n<t.length;n++){var o=t[n].getNodeByPath(e,void 0,void 0,!0);if(o)return o}},getRoots:function(t){var n=this._parent();if(Boolean(t)&&e.is(this._getChildrenFilterInfo,"function")){var o=this._getChildrenFilterInfo();if(o&&e.is(o.childrenBeforeFiltering,"array")){var i=n;n=o.childrenBeforeFiltering.slice(0),i.forEach(function(e){n.indexOf(e)<0&&n.push(e)})}}return n},getDetachedRoots:function(){var e=[];return this.hasOwnProperty("detachedRoots")&&this.detachedRoots.forEach(function(t){-1===e.indexOf(t)&&e.push(t)}),e},removeRoot:function(t,n,o){var i=this;if(this.wrapInTransaction(function(){i._doNotBroadcastSelect=!0;var n=i.hasOwnProperty("detachedRoots")?i.detachedRoots.indexOf(t):-1;if(n>=0)i.detachedRoots.splice(n,1);else{if(i.invalidateViewPort(),i.getRoots().indexOf(t)>=0&&i._parent(t),(!e.is(o,"boolean")||!o)&&e.is(i._getChildrenFilterInfo,"function")){var s=i._getChildrenFilterInfo();if(s&&e.is(s.childrenBeforeFiltering,"array")){var r=s.childrenBeforeFiltering.indexOf(t);r>=0&&s.childrenBeforeFiltering.splice(r,1)}if(s&&e.is(s.filteredOutChildren,"array")){var a=s.filteredOutChildren.indexOf(t);a>=0&&s.filteredOutChildren.splice(a,1)}}y.removeRoot()}i._doNotBroadcastSelect=!1}),!e.is(n,"boolean")||!n){var s=this.getRoots().length;e.is(this.detachedRoots,"array")&&(s+=this.detachedRoots.length),this.getModelEvents().publish({event:"onRemoveRoot",data:{pid:t.getID(),remainingRoots:s}});var r=void 0;this.getRoots().length>0?r=this.getRoots()[0]:e.is(this.detachedRoots,"array")&&this.detachedRoots.length>0&&(r=this.detachedRoots[0]),this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:r,nb_root:s}})}},attachRoot:function(e,t){var n=this.hasOwnProperty("detachedRoots")?this.detachedRoots.indexOf(e):-1;if(n<0)throw new Error("Invalid state");this.detachedRoots.splice(n,1);var o=this;this.wrapInTransaction(function(){e.options.isRootAttached=!0,void 0===t?o.addChild(e):o.insertBefore(e,t),o.invalidateViewPort()})},detachRoot:function(e){if((this.hasOwnProperty("detachedRoots")?this.detachedRoots.indexOf(e):-1)>=0)throw new Error("Invalid state");var t=this,n=null;this.wrapInTransaction(function(){e.options.isRootAttached=!1;var o=t.getRoots();if(o.length>0)for(var s=0;s<o.length;s++)if(o[s].options.resourceid===e.options.resourceid){n=o[s],i.prototype.removeRoot.call(t,n);break}t.hasOwnProperty("detachedRoots")||(t.detachedRoots=[]),t.detachedRoots.push(e)})},searchRootById:function(e){var t,n=this.getRoots(!0);this.hasOwnProperty("detachedRoots")&&(n=n.concat(this.detachedRoots));for(var o=0;o<n.length;o++)if(n[o].options.resourceid===e){t=n[o];break}return t},restoreSelection:function(e){var t=this;if(t.originalSelection){let n=function(){t._selected_paths=t.originalSelection,t._selectOccurence("FocusOn")};e?n():t.withBroadcastSelect(n)}},insertBranches:function(e,t){var o,i=!!this.isGroupingApplied()||t.forceCollapsed;o=l.process.insert_temporary_branches({treedocument:this,branches:e,node_state:t.node_state,forceCollapsed:i,novalidation:t.novalidation});var s=t.onComplete,r=this;this.isGroupingApplied()&&(t.onComplete=function(t){for(var n=[],o=[],i=0;i<e.length;i++)if(-1===o.indexOf(e[i][0])){o.push(e[i][0]);var a=r.searchRootById(e[i][0]);a&&n.push(a)}r.__applyGrouping({roots:n,groups:r.options.groups,noGroupUpdate:!0}),"function"==typeof s&&s(t)}),!0===t.novalidation&&!0===t.forceCollapsed&&e.length>20&&!0!==n.getSetting("forcePathValidationOnSelect")?o.visibleNodesIds.length>0?this.refreshNodeById({modified:o.visibleNodesIds,relationids:o.visibleNodesRelIds,onComplete:t.onComplete?t.onComplete:void 0}):t.onComplete&&t.onComplete.call(!0):o.ids_to_fetch.length>0||o.relationids.length>0?o.ids_to_fetch.length>0||o.relationids.length>0?this.validateBranches_with_Expand(e,t):t.onComplete&&t.onComplete.call(!0):o.ids_to_fetch.length>0?this.refreshNodeById({modified:o.ids_to_fetch,relationids:o.relationids,onComplete:t.onComplete?t.onComplete:void 0}):t.onComplete&&t.onComplete.call(!0)},refreshNodeById:function(t){var o=[],i=this,s=[],r=[],a=[],d=[],c=function(){o.forEach(function(t){var n=i.getNodesById(t);e.is(n,"array")&&n.forEach(function(e){var t=e.getParent();e.remove(),!1===t.hasChildren()&&(t.setState({state:"collapsed"}),t.options.children=[])})});var t=w.cannot_insert_branch,n="enxNav-refreshNodeById-cannot-insert-branch";0!==r.length&&(t=w.cannot_access_after_changeowner,n="enxNav-refreshNodeById-cannot-access-after-changeowner"),h.displayNotification({msg:t,eventID:"error",key:n})};if(e.is(t.created)&&(o=o.concat(t.created)),e.is(t.modified)&&e.is(t.modified,"array")&&this.withTransactionUpdate(function(){t.modified.forEach(function(t){if(e.is(t,"object")){var n=t.physicalid;if(e.is(t.attributes,"array")){var l=require("DS/PADServices/utils/AttributesMgtV2");i.getNodesById(n).forEach(function(e){e.updateAttributes(t.attributes,l.getAvailableColumns()),e._manageNLS=!0,!0})}else{if(-1===o.indexOf(n))(c=i.getNodesById(n))&&c.length>0&&(o.push(n),s.push(n));"ownerChanged"===t.key&&r.push(n)}}else{var c,u;if(-1===o.indexOf(t))if((c=i.getNodesById(t))&&c.length>0&&!0!==c[0].isRelationsObjectNode)o.push(t),s.push(t);else(c=i.getNodesByRelId(t)).length>0&&c.forEach(function(e){d.push(e),(u=e.options.relationid)&&a.push(u)})}})}),o.length>0){var p=n.getWebAPI_Options("fetch");p.include_param_Attributes=!1,t.relationids&&t.relationids.length>0&&(o=o.concat(t.relationids)),u.fetch({enopad_webapis:n.getSetting("enopad_webapis"),data:p,pids:o,onComplete:function(n){i.invalidateViewPort();var r=e.is(n,"string")?JSON.parse(n):n;r.results.length!==o.length&&(console.error("Inconsistent number of results"),c()),i.wrapInTransaction(function(){var n=l.process.refresh_nodes({treedocument:i,response:r,refresh_parameters:t,ids_modified:s});if(e.is(n,"array")&&n.length>0){var o={pids:n,already_added_in_PS:!0};i._commandProxy.drop(o);for(var a=[],d=0;d<n.length;d++){var c=i.getNodesById(n[d]);c.length&&a.push(c[0])}var u=a.map(function(e){return e.getOccurencePath()});t.onAddPaths&&t.onAddPaths(u)}D.publish({event:"ENXModel/Nodes/modified",data:{modifiedIds:s,fetchAnswer:r}})}),void 0!==t.onComplete&&t.onComplete()},onFailure:function(){c()}})}else if(a.length>0){var g={lIds:a,attributes:"true"},f={},v={};u.read({data:g,onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;n.results&&(n.results.forEach(function(e){var t=e.physicalID,n={instanceName:[],modified:[]};e.data.forEach(function(e){e.path&&"PLMInstance.PLM_ExternalID"===e.path?n.instanceName=e.value:e.path&&!e.path.includes("PLMInstance")&&(n["ds6wg:"+e.path+"-Instance"]=e.value,v["ds6wg:"+e.path+"-Instance"]=e.value)}),e.basicData.forEach(function(e){"modified"===e.name&&(n.modified=e.value)}),f[t]=n}),d&&d.length>0&&i.wrapInTransaction(function(){d.forEach(function(e){var t={grid:{}};for(var n in t.grid["ds6w:modified"]=f[e.options.relationid].modified[0],t.grid["ds6w:label-Instance"]=f[e.options.relationid].instanceName[0],v)f[e.options.relationid]&&f[e.options.relationid][n][0]&&(t.grid[n]=f[e.options.relationid][n][0]);e.updateOptions(t)})}))},onFailure:function(e){console.error("failure with error",e)}})}},getNodesByRelId:function(e){var t=[];return this.getRoots().forEach(function(n){var o=n.getNodesByRelId(e);t=t.concat(o)}),t},getNodesByIDPath:function(e){var t=[];return this.getRoots().forEach(function(n){!function e(t,n,o,i){if(t.getID()===n[o])if(o===n.length-1)i.push(t);else{var s=t.getChildren();s&&s.length>0&&(o+=1,s.forEach(function(t){e(t,n,o,i)}))}}(n,e,0,t)}),t},deleteNodes:function(e,t){var n=this;this.wrapInTransaction(function(){n.withTransactionUpdate(function(){var o={detach:{deleted:[]}};n._doNotBroadcastSelect=!0,e.forEach(function(e){if(e.isRoot())n.removeRoot(e);else{var t=e.getParent(),i=t.getState();e.remove(),o.detach.deleted.push(e.getID()),"partiallyExpanded"!==i||t.options.children||(t.options.children=[],t.setState({state:"collapsed"}))}}),n._doNotBroadcastSelect=!1,!0===t&&n._commandProxy.padRefresh(o)})})},_shouldAcceptDrop:function(e){var t=e.dropPosition;return"top"!==t&&"bottom"!==t},_shouldAcceptDrag:function(e,t){return!0!==e.isGroupingNode},_selectOccurence:function(e,t,n){var o=this.getRoots(),i=this._selected_paths;if(i.length>0){var s=!1;"FocusOn"!==e&&(this._doNotBroadcastSelect=!0),this.prepareUpdate();var r=[];o.forEach(function(e){for(var t=0;t<i.length;t++){var n=e.getNodeByPath(i[t]);if(n&&(s=!0,r.push(n),!n.isVisible())){for(var o=n.getParent();!o.isVisible();)o=o.getParent();o&&-1===r.indexOf(o)&&r.push(o)}}});var a=!1;if(!0!==t||!0===s)for(var l=this.getSelectedNodes(),d=0;d<l.length;d++){var c=l[d];r.indexOf(c)<0&&(c.unselect(),a=!0)}var u=r.filter(function(e){return!e.isSelected()});a=u.length>0,this.multiselect(u),!0===n&&a&&(this._directSelection=!1),this.pushUpdate(),this._doNotBroadcastSelect=!1}},_buildSelectData:function(){var e=[],t=this._selected_paths;void 0===O.add_objects_when_select&&(O.add_objects_when_select=n.getSetting("add_objects_when_select"),O.authorizeChangeControl=n.getSetting("authorizeChangeControl"),O.CfgAuthoringContext=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"));var i=this.getSelectedNodes();if(this.isGroupingApplied()){var s=[];for(let e=0;e<i.length;e++)!0!==i[e].isGroupingNode&&s.push(i[e]);i=s}!0===O.add_objects_when_select&&t.length&&i.length?this.getRoots().forEach(function(n){for(var o=0;o<t.length;o++){var i=n.getNodeByPath(t[o],void 0,void 0,!0);i&&e.push(i)}}):e=i;var r,a={paths:[],tenant:o.getPlatformId()};a.attributes={},a.version="1.1";if(r=function(e){var t=e.getID();this.attributes.hasOwnProperty(t)||(this.attributes[t]={type:e.options.type,label:e.options.label})}.bind(a),a.paths=e.map(function(e){return e.getOccurencePath(r)}),O.authorizeChangeControl)try{a.changeControl=O.CfgAuthoringContext.get()}catch(e){console.warn("No Change")}return this._currentApp=o.getSharedId(),a.sharedID=this._currentApp,null===this._pagerview&&!0!==this._focusOn?a.focusOn=!1:a.focusOn=!0,a},_colorChildren:function(e,t,n,o,i){var s=this;e.getChildren().forEach(function(e){if(t.push(e.options.resourceid),t.push(e.options.relationid),n.push({color:e.options.color?e.options.color:"rgba(255, 255, 255, 0.3)",pid:e.options.resourceid,ghostMode:e.ghostMode}),n.push({color:e.options.color?e.options.color:"rgba(255, 255, 255, 0.3)",pid:e.options.relationid,ghostMode:e.ghostMode}),"collapseState"==e._expandState||"partiallyExpandedState"==e._expandState)if(e.hasChildren())s._colorChildren(e,t,n,o,i);else{var r=e.getOccurencePath(e.options.resourceid);o.push(r.map(function(e){return t.indexOf(e)}))}else{var a=e.getOccurencePath(e.options.resourceid);o.push(a.map(function(e){return t.indexOf(e)}))}})},_colorize3D:function(e){if(!0!==this._collapseRepDuringExpandAll&&1==this.colorizeActivated){var t,n=this,o=[],i=[],s=[];n.getRoots().forEach(function(t){if(t.options.color||(t.options.color="rgba(255, 255, 255, 0.3)"),t.options.color)if(o.push(t.options.resourceid),s.push({color:t.options.color?t.options.color:"rgba(255, 255, 255, 0.3)",pid:t.options.resourceid,ghostMode:t.ghostMode}),"collapseState"==t._expandState||"partiallyExpandedState"==t._expandState)if(null!==t.getChildren())n._colorChildren(t,o,s,i,e);else{var r=node.getOccurencePath(t.options.resourceid);i.push(r.map(function(e){return o.indexOf(e)}))}else{var a=t.getOccurencePath(t.options.resourceid);i.push(a.map(function(e){return o.indexOf(e)}))}}),t={nodes:s,path:i},void 0!==n._commandProxy&&0!==t.nodes.length&&n._commandProxy.padFilterBI({filterBIColorize:t})}},_getLastViewpoint:function(e){var t=this;this._viewPointCallback=e,this._commandProxy.requestViewPoint(),this._viewPointTimer=setTimeout(function(){t._viewPointCallback&&(t._viewPointCallback(null),t._viewPointCallback=null)},500)},applyActiveView:function(e){this.options.active_view=e},validateBranches_with_Expand:function(t,o){var i=e.extend({root_path_physicalid:e.clone(t),expand_iter:"0",intent:"explore_2D"},n.getWebAPI_Options("navigate"),!0),s=this;function r(){for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i+=2){var r=t[n][i],a=s.getNodesById(r);e.is(a,"array")&&a.forEach(function(e){if(!0===e.options.waiting4validation)if(!0===e.isRoot())s.removeRoot(e);else{var t=e.getParent();e.remove(),!1===t.hasChildren()&&(t.setState({state:"collapsed"}),t.options.children=[])}})}h.displayNotification({msg:w.cannot_insert_branch,eventID:"error",key:"enxNav-validateBranches-cannot-insert-branch"}),o.onFailure&&o.onFailure()}u.navigate({enopad_webapis:n.getSetting("enopad_webapis"),data:i,onComplete:function(t){var n;try{n=s.startTransaction("expand");var i=e.is(t,"string")?JSON.parse(t):t;o&&o.onFocus&&(s._insertOnFocus=!0),l.process.validateAndUpdateBranches({treedocument:s,response:i}),delete s._insertOnFocus,o.onComplete&&o.onComplete()}catch(e){r()}finally{n&&n.end()}},onFailure:function(e){r()}})},_onFocus:function(e,t){var o=this;if(!0===n.getSetting("focusonPublic")&&"focus"===e.intent&&!0!==e.findInCtx&&("treelistview"===o.options.active_view||"graphview"===o.options.active_view||"datagridview"===o.options.active_view)){var i=[];o._doNotBroadcastSelect=!0;var s=!1;if(o._selection=[],e.paths.forEach(function(e){var t=o.getNodeByOccurencePath(e);if(t)if(t.getID()===e[e.length-1]&&!0!==t.options.isPADHidden)o._selection.push(e);else if(t.getID()===e[0]&&"filter"!==t.getBadges().bottomRight)o._selection.push(e),s=!0;else if(-1!==e.indexOf(t.getID())){!0!==t.getRoot().options.filtered&&(o._selection.push(e),s=!0)}}),o.originalSelection=o._selection,o._selection.length>1){o.displayPager();var r=o.startTransaction("focusOn"),a=0,l=0;o.withTransactionUpdate(function(){o._selection.forEach(function(e){a++,l++,i.push(e),a!==o._selection.length&&300!==l||(l=0,o._reframeFocus=!0,o.insertBranches(i,{onFocus:!0,onComplete:function(){o._doNotBroadcastSelect=!0,o._colorize3D(this),o._reframeFocus=!1,o.getNodeByOccurencePath(o._selection[o._selectedIdx]).select()}}),i=[]),a===o._selection.length&&r.end()}),!0===s&&o._commandProxy.padExpand({paths:o._selection,expand_level:"1",updatePager:!0}),o._insertOnFocus=!0,o.reframeOn({idx:o._selectedIdx}),delete o._insertOnFocus})}else o._pagerview&&(o._pagerview.hide(),delete o._pagerview),o.insertBranches(o._selection,{onComplete:function(e){o._doNotBroadcastSelect=!0,!0===e&&o._colorize3D(this)}}),!0===s&&o._commandProxy.padExpand({paths:o._selection,expand_level:"1",updatePager:!0}),o.reframeOn({idx:o._selectedIdx})}},focusChange:function(e){this._selection&&null!==this._pagerview&&("previous"==e.event&&(this._selectedIdx--,this.reframeOn()),"next"==e.event&&(this._selectedIdx++,this.reframeOn()))},displayPager:function(){var e=this;e._selectedIdx=0,null===e._pagerview&&(e._pagerview=new b({renderTo:document.body,injectNow:!0,callbacks:{onSelectAll:function(){e._doNotBroadcastSelect=!0,e.restoreSelection(!0),e._doNotBroadcastSelect=!1},onPrevious:function(){e.focusChange({event:"previous"})},onNext:function(){e.focusChange({event:"next"})},onClose:function(){e.closePager(),e._focusOn=!1,e.searchProgress=!1}}}))},closePager:function(){this._pagerview&&(this._pagerview.hide(),delete this._pagerview)},reframeOn:function(e){-1===this._selectedIdx&&(this._selectedIdx=this._selection.length-1);var t=this._selectedIdx%this._selection.length;if(this._pagerview){var n=t+1+"/"+this._selection.length;this._pagerview.setLabel(n)}var o=this.getNodeByOccurencePath(this._selection[t]);o&&(this._focusOn=!0,e&&!0===e.noSelect||o.select(!0),this.getModelEvents().publish({event:"onCenterGraph",data:o}),this._pagerview&&this._selection.length>1&&this._pagerview.show())},getSelectedNodesForOFW:function(){var e=[],t=this._selected_paths;t&&t.length&&this.getXSO().get().length?this.getRoots().forEach(function(n){for(var o=0;o<t.length;o++){var i=n.getNodeByPath(t[o],void 0,void 0,!0);i&&e.push(i)}}):e=this.getXSO().get();return e},updateInstance:function(e){console.count("updateInstances")},_viewInsertExisting:function(t){if(!(t.modified&&t.inserted&&t.created))throw new Error("Invalid input parameters "+JSON.stringify(t));var o,i=[];for(o=0;o<t.modified.length;o++)i.push(this.getNodesById(t.modified[o]));var s=n.getWebAPI_Options("fetch"),r=this;u.fetch({enopad_webapis:n.getSetting("enopad_webapis"),data:s,pids:t.inserted,onComplete:function(n){r.invalidateViewPort();var s=e.is(n,"string")?JSON.parse(n):n;!s.results||s.results.length<t.inserted.length?h.displayNotification({msg:w.object_not_found_in_db,eventID:"error",key:"enxNav-viewInsertExisting-object-not-found-on-db"}):s.results.length>t.inserted.length?h.displayNotification({msg:w.tooManyResults,eventID:"error",key:"enxNav-viewInsertExisting-too-many-results"}):r.wrapInTransaction(function(){var e=require("DS/PADServices/utils/AttributesMgtV2");for(o=0;o<s.results.length;o++){var n=l.parse_attributes(s.results[o].attributes,e.getAvailableColumns(),e.getTreeColumn()),r=t.inserted.indexOf(n.resourceid);n.relationid=t.created[r],void 0===n.children&&(n.children=[]);var d=new a(n),c=i[r];c&&c.forEach(function(e){e.getChildById(n.resourceid)||(e.addChild(d),e.setState({state:"partiallyExpanded"}),e.options.padstate="partiallyExpanded",p.updateNLS(d))})}})},onFailure:function(){h.displayNotification({msg:w.generic_service_failure,eventID:"error",key:"enxNav-viewInsertExisting-generic-service-failure"}),t.callback&&t.callback.call()}})},_viewDetach:function(e){if(!e.deleted)throw new Error("Invalid input parameters "+JSON.stringify(e));var t=this;this.withTransactionUpdate(function(){for(var n=0;n<e.deleted.length;n++){t.getNodesByRelId(e.deleted[n]).forEach(function(e){e.getParent().removeChild(e)})}})},_viewReParent:function(e){this._viewInsertExisting(e),this._viewDetach(e)},_viewReplaceInstance:function(e){if(!e.couples)throw new Error("Invalid input parameters "+JSON.stringify(e));var t=this;this.withTransactionUpdate(function(){for(var n=0;n<e.couples.length;n++){t.getNodesByRelId(e.couples[n].oldId).forEach(function(t){t.options.relationid=e.couples[n].newId})}})},_viewSplitInstance:function(t){var n=this;function o(e){if(!e.hasChildren())return e.getDepth();var t=1;return e.getChildren().forEach(function(e){var n=o(e);n>t&&(t=n)}),t}var i,s,r,l,d,c,u,p,h=[],g=[],f=[];this._insertFlag=!0,this.withTransactionUpdate(function(){try{for(var v=0;v<t.couples.length;v++){var m=n.getNodesByRelId(t.couples[v].oldId);if(m&&m.length>0)for(var b=0;b<m.length;b++)if(i=m[b]){if((p=i.getOccurencePath())&&p.length&&h.push(p),i.isExpanded()){var _=o(i)-i.getDepth();_=parseInt(_),f.push(_)}if(g.push(i.getRelationID()),r=i.getParent()){l=r.getChildren(),s=i.options.relationtype,d=l.indexOf(i)+1,c=e.clone(i.options,!1);var D=e.clone(i.options.grid,!1);c.grid=D,c.children&&(c.children=[]),c.relationid=t.couples[v].newId,(u=new a(c)).setRelationID(t.couples[v].newId,s),g.push(t.couples[v].newId),d===l.length?r.addChild(u):t.editVariant?r.insertBefore(u,i):r.insertBefore(u,l[d]),r.isExpanded()||r.options.padstate&&"partiallyExpanded"===r.options.padstate||(r.setState({state:"partiallyExpanded"}),r.options.padstate="partiallyExpanded"),u.isSelected()||u.select(),(p=u.getOccurencePath())&&p.length&&h.push(p)}}}}catch(e){console.error("error >>:",e)}finally{console.info("splitInstance done")}}),n.invalidateViewPort(),t.editVariant&&n.updateInstance({occurencePaths:h,expandStates:f,newRelIds:g,editCfg:!0}),t.cb&&t.cb({occurencePaths:h,expandStates:f,newRelIds:g})},splitInstance:function(t){var n=this;t.editVariant||t.cb||(t.cb=function(t){e.is(n.updateInstance,"function")&&n.updateInstance(t)}),this._viewSplitInstance(t)},multiselect:function(e){var t=this,n=t.getXSO();this.prepareUpdate(),e=e.filter(function(e){return t.options.shouldBeSelected(e)}),n.add(e),this.pushUpdate()},multiunselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.remove(e),this.pushUpdate()},_expandChildren:function(e,t,o){var i=n.getSetting("activateFUN085903")&&(-1===t||t>1);function s(e){if(e.childComputed&&e.hasChildren()){var t=e.getChildren();if(1===t.length)return"ds6w:Document"===t[0].options.grid.globaltype}}var r=function(e,t,n){if(-1===t||n<t){if(e.childComputed){if(e.getState("collapsed")&&e.setState({state:"expanded"}),e.hasChildren()){for(var o=e.getChildren(),a=!0,l=0;l<o.length&&!0===a;l++){var d=o[l];if(!(d.childComputed&&i&&s(d))&&(d.childComputed&&"noExpandState"!==d._expandState&&(d.getDepth()<t||-1===t)&&d.setState({state:"expanded"}),void 0===(a=r(d,t,n+1))))throw new Error("Undefined no_expand_needed flag")}return a}return!0}return!(-1===t||t>n)}return!0};return r(e,t,o)},updateNodesAttrValue:function(t,o,i){for(var s=this,r=require("DS/PADServices/utils/AttributesMgtV2"),a=0;a<o.length;a++)r.addBIColumn(o[a],n.getSetting("synthesisModeOnInstance"));var d=o.slice();-1===d.indexOf("ds6w:globaltype")&&d.push("ds6w:globaltype");var c={select_predicate:d,select_file:[]},p=[];if(t.length>=1e3){var h=Math.trunc(t.length/1e3);t.length%1e3>0&&h++;for(var g=t.slice(0,t.length-1),f=0;f<h;f++)p.push(g.splice(0,g.length>=1e3?1e3:g.length))}else p.push(t);var v;(v=p,v.reduce((t,n)=>t.then(()=>(function(t){return new Promise(n=>{u.fetch({enopad_webapis:!1,data:c,pids:t,noCompletion:!0,onComplete:function(o){var i=e.is(o,"string")?JSON.parse(o):o;l.process.refresh_nodes({treedocument:s,response:i,refresh_parameters:{modified:t}}),n()},onFailure:function(e){console.error(e),n()}})})})(n)),Promise.resolve())).then(()=>{i&&i({allNodesProcessed:!0})})},isDirectSelection:function(){return this._directSelection},hasHiddenGroupingNodes:function(){return this._hiddenGroupingNodes&&this._hiddenGroupingNodes.length},_addGroupingNodes:function(e){var t=e.groupingNode;t&&(this._groupingNodes||(this._groupingNodes=[]),this._groupingNodes.push(t))},_showGroupingNodes:function(){if(this._groupingNodes){var e=this;this.withTransactionUpdate(function(){for(let t=0;t<e._groupingNodes.length;t++)e._groupingNodes[t].show()})}a.groupingNodeHidden=!1},_hideGroupingNodes:function(){if(this._groupingNodes){var e=this;this.withTransactionUpdate(function(){for(let t=0;t<e._groupingNodes.length;t++)e._groupingNodes[t].hide()})}a.groupingNodeHidden=!0},__copyLink:function(){require(["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/CompassUtils"],(e,t,n)=>{let o=e.getPlatformURL("3DDashboard"),i="#app:"+t.getAppId()+"/content:X3DContentId=",s=n.buildX3DContent(this.getSelectedNodes());var r=o+i+encodeURIComponent(JSON.stringify(s));t.copyTexttoCLipboard(r)?t.displayNotif({message:P.replace(P.msg_success_copyLink,{label:this.getSelectedNodes()[0].getLabel()}),level:"success"}):t.displayNotif({title:P.msg_error_copyLinkTitle,message:P.msg_error_copyLink,level:"error",key:"xNavDocument-copy-link-error"})})}})}),define("DS/ENXNav/models/mixins/TreeDocAdditionals",["UWA/Core","DS/PADServices/settings/AppSettings","DS/PADServices/utils/Iterator","DS/ENXNav/models/AdditionalRelDummyInfo"],function(e,t,n,o){const i=["SyncModelRefresh","SyncModelNodes","OnReady","OnSyncModel","OnScrollEnd","ExportAs"],s=["ENODOFormatStatus_Col","ENOXCADSyncStatus_Col"];function r(e,t,n,o,r,a){let l=Array.isArray(o);if(!0!==e.isRelationsObjectNode)for(var d=0;d<n.length;d++){var c=n[d],u=c.getManagedColumnNames(),p={};let D=!1;for(var h=0;h<u.length;h++)p[u[h]]=e.options.grid[u[h]];var g="function"==typeof c.getAutoReloadNames?c.getAutoReloadNames():[];for(h=0;h<g.length;h++)p[g[h]]=e.options.grid[g[h]];var f=Object.keys(p);if(l){for(var v={},m=0;m<f.length;m++)-1!==o.indexOf(f[m])&&(v[f[m]]=p[f[m]],D=!0);p=v}else f.length&&(D=!0);if(!0===D&&c.toBeUpdated(p,a)&&i.includes(a)){void 0===t[c.getName()]&&(t[c.getName()]={pids:[],relids:[],pairs:{}});var b=e.getID();-1===t[c.getName()].pids.indexOf(b)&&t[c.getName()].pids.push(b);var _=e.getRelationID();_&&-1===t[c.getName()].relids.indexOf(_)&&(t[c.getName()].relids.push(_),t[c.getName()].pairs[b]=_)}else i.includes(a)&&s.includes(c.getName())&&r.addOtherKeys(u)}else r.addRelationNode(e)}function a(n,o,i){var s=i;return e.is(n.filterAttributesForUpdate,"function")&&(s=n.filterAttributesForUpdate({node:o,node_opts:s})),-1===s.relationOrder&&(s.relationOrder=o.options.relationOrder),!0===t.getSetting("tree_order_in_label")&&s.label&&(s.label+="(treeorder="+s.relationOrder+")"),s}function l(e){this.name=e,console.time(this.name)}function d(){}return l.prototype={end:function(){console.timeEnd(this.name)}},d.prototype={fillAttributesAsync4VisibleNodes:function(e,t,n){this.fillAttributesAsync(e,n)},fillAttributesAsync:function(e,t){if(this._pendingNodes||(this._pendingNodes=[]),this._pendingAttr)return void(this._pendingNodes=this._pendingNodes.concat(e));e=e.concat(this._pendingNodes),this._pendingNodes.length=0,this._pendingAttr=!0;let n=this;var o=function(){n._pendingAttr=!1},i=function(){n.fillAttributesAsync([],t)};this.fillAdditionalColumns(e,null,t).then(function(t){var s,r;o(),t&&t.updates&&(n._pendingNodes=(s=n._pendingNodes,r=e,s.filter(function(e){return-1===r.indexOf(e)})),n._pendingNodes.length&&setTimeout(i,0))}).catch(o)},fillAdditionalColumns:function(t,i,s){let d=this;return new Promise(function(c,u){let p=new o;if(t.length)if(d.options.additionalColumnsModules&&d.options.additionalColumnsModules.length){let o=!1;"ExportAs"===s&&(o=!0);var h=d.getVisibleAdditionalColumns(o);h.length?require(["DS/ENXNav/models/Algos"],function(o){var u={};new Promise(function(e){for(var n=0;n<t.length;n++)r(t[n],u,d.options.additionalColumnsModules,i,p,s);e()}).then(function(){for(var t=[],i=0;i<h.length;i++){var s=h[i],r=s.module.getName();if(u[r]){let n=new l(r+"...updateAttributes");var g=new Promise(function(t){s.module.updateAttributes(u[r],function(o){var i=e.is(o,"string")?JSON.parse(o):o;t(i),n.end()},d)});t.push(g)}}t.length?Promise.all(t).then(function(t){let i=function(t){var n={},o=!1,i=!1;let s=[];for(var r=0;r<t.length;r++){let i=t[r],a=Object.keys(i.pids),l=Object.keys(i.relids),d=a.length>0&&0===l.length;s.push(d),!o&&d&&(o=d),e.extend(n,i,!0)}return s.filter(function(e){return!1===e}).length!==s.length&&(i=!0),{merger:n,hasPidOnlyUpdate:o,isMixed:i}}(t),s=i.merger,r=i.hasPidOnlyUpdate,l=i.isMixed;d.setUseChangeTransactionMode(!0),d.withTransactionUpdate(function(){var e=0,t=Object.keys(s.pids),i=Object.keys(s.relids),c=[];if(i)for(var u=0;u<i.length;u++){if((f=d.getNodesByRelId(i[u]))&&f.length)for(e=0;e<f.length;e++){let r=f[e];var p=o.extractGridChanges(a(d,f[e],{grid:s.relids[i[u]]}),r.options);p.hasChanged&&r.updateOptions(p.finalResults);var h=r.getID();if(-1!==t.indexOf(h)&&(c.push(h),l)){let e=s.pids[h];n.iterate(p.updatedProps,function(t){delete e[t]})}}else console.warn("Should not happen. The node should be found")}if(r||c.length&&n.iterate(c,function(e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}),t&&t.length>0)for(var g=0;g<t.length;g++){var f;if((f=d.getNodesById(t[g]))&&f.length)for(e=0;e<f.length;e++){var v=o.extractGridChanges(a(d,f[e],{grid:s.pids[t[g]]}),f[e].options);v.hasChanged&&f[e].updateOptions(v.finalResults)}else console.warn("Should not happen. The node should be found")}}),p.applyMerger(s),d.setUseChangeTransactionMode(!1),c({updates:!0})}):c()})}):c()}else c();else c()})}},d}),define("DS/ENXNav/models/xNavTreeDoc",["DS/Tree/TreeDocument","DS/ENXNav/models/xNavNodeModel","DS/ENOXParser/modules/TwoDParser","DS/ENXNav/models/NodeUtils","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/ENXNav/models/mixins/TreeDocSelect","DS/ENXNav/models/mixins/TreeDocProxy","DS/ENXNav/models/mixins/TreeDocPopulate","DS/ENXNav/models/mixins/TreeDocAccess","DS/ENXNav/models/mixins/TreeDocShared","DS/ENXNav/models/mixins/TreeDocSupport","DS/ENXNav/models/mixins/TreeDocAdditionals","DS/ENXNav/models/_xNavGrouping","DS/PADUtils/PADTransactionManager","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils"],function(e,t,n,o,i,s,r,a,l,d,c,u,p,h,g,f){"use strict";function v(){}return v.prototype=Object.assign(v.prototype,r.prototype),v.prototype=Object.assign(v.prototype,s.prototype),v.prototype=Object.assign(v.prototype,a.prototype),v.prototype=Object.assign(v.prototype,l.prototype),v.prototype=Object.assign(v.prototype,d.prototype),v.prototype=Object.assign(v.prototype,c.prototype),v.prototype=Object.assign(v.prototype,u.prototype),v.prototype=Object.assign(v.prototype,p.prototype),v.prototype=Object.assign(v.prototype,{setFBIProxyOptions:function(e){this.options.FBIProxy=e.FBIProxy},applyActiveView:function(e){this.options.active_view=e},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,tiles:null,thumbnails:null,datagrid:null}},_shouldAcceptDrop:function(e){var t=e.dropPosition;return"top"!==t&&"bottom"!==t},_shouldAcceptDrag:function(e,t){return!0},createNodeModel:function(e){return new this.options.nodeModelClass(e)}}),e.extend(h,v,{init:function(e){this.version="2.0";var s=e||{};s.shouldBeSelected=function(e){return!0!==e.isRelationsObjectGroupingNode},UWA.is(s.shouldAcceptDrop)||(s.shouldAcceptDrop=this._shouldAcceptDrop.bind(this)),UWA.is(s.shouldAcceptDrag)||(s.shouldAcceptDrag=this._shouldAcceptDrag.bind(this)),s.nodeModelClass=t,s.showModelChanges=!1,this._parent(s),n.setup({nls:{loadingText:i.loadingText},modules:{NodeUtils:o,_xNavGrouping:p}}).then(function(){console.log("parser is setup")}),this.options.viewport={},this.boundClearFlag=this.clearLoadModelFlag.bind(this),this.initProxy(),this.initSelectCB(),g.subscribe({event:"ENXViews/Model/FindInCtx"},this._findInCtx.bind(this)),this.onPreExpand(this.onPreExpandChecker.bind(this)),g.subscribe({event:"ENXViews/Model/SelectFromTagger"},this._selectFromTagger.bind(this)),this.getModelEvents().subscribe({event:"addChild"},function(e){var t=e.data.nodeModel,n=e.parent.getChildren();t.options.grid.actualIndex=n.indexOf(t)}),g.subscribe({event:"ENXModel/Model/ApplyGrouping"},this.__applyGrouping.bind(this)),g.subscribe({event:"ENXModel/Model/ExpandAllGroups"},this.__expandAllGroupsCmd.bind(this)),g.subscribe({event:"ENXModel/Model/FocusOnGroups"},this.__focusOnGroupsCmd.bind(this)),g.subscribe({event:"ENXModel/Model/ColorizeGroup"},this.__colorizeGroupCmd.bind(this)),g.subscribe({event:"ENXModel/Model/RemoveGroupColor"},this.__removeColorGroupCmd.bind(this)),g.subscribe({event:"ENXModel/Model/GroupsLayout"},this.__groupsLayoutCmd.bind(this)),g.subscribe({event:"ENXModel/Model/CopyLink"},this.__copyLink.bind(this))},isEditor:function(){return!1}})}),define("DS/ENXNav/features/xNavSaveSort",["DS/ENXNav/utils/LocalStorageForAppState","DS/ENXNav/utils/TwoDAppEvents"],function(e,t){function n(e){this.options=e,this._boundPersist=this.persist.bind(this),this._boundReapply=this._reapplySortModel.bind(this),t.onExpand(this._boundReapply),t.onAddRoot(this._boundReapply),t.onAddChild(this._boundReapply),t.onRemoveRoot(this._boundReapply),t.onClearSort(this._onClearSort.bind(this)),t.onRefresh(this._boundReapply)}return n.prototype={initialize:function(){return new Promise(function(e,t){e()})},setup:function(e){this.setupOptions=e,this.setupOptions.dgv&&(this.options.dgv=this.setupOptions.dgv,this.options.actual=this.setupOptions.dgv.options.dgv,this.options.dgv.options.shouldClearSort=!0,this.options.actual.addEventListener("sortModelChange",this._boundPersist),widget.hasPreference("sortColumns")&&!widget.getValue("sortColumns")||this.restore())},restore:function(){let t=e.get("sortModel");t&&(this._cachedSortModel=t,this.options.actual.sortModel=t)},_onClearSort:function(t){"begin"===t?(this._clearSortOccurring=!0,delete this._cachedSortModel,e.del("sortModel")):this._clearSortOccurring=!1},_reapplySortModel:function(e){this.options.actual&&(!this.options.actual.sortModel&&this._cachedSortModel?this.options.actual.sortModel=this._cachedSortModel:(!1===widget.getValue("sortColumns")&&this.options.dgv.options.shouldClearSort&&(this.options.dgv.options.shouldClearSort=!1),this.options.actual.reapplySortModel()))},persist:function(){if(!this._clearSortOccurring&&this.options.dgv.isClearSortEnabled()){let t=this.options.actual.sortModel;t&&e.set("sortModel",t)}}},Object.defineProperties(n.prototype,{name:{get:function(){return"saveSorts"}}}),n}),define("DS/ENXNav/views/customize_views/_xNavDGVParametrization",["i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/Utilities/Utils","DS/ENXNav/utils/xNavCustoStorageOptim","DS/ENXNav/utils/CtxMenuUtils","DS/PADUtils/Configuration","DS/PADUtils/Utility","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/DictionaryAccess","DS/ENXNav/utils/TwoDAppEvents","DS/PADServices/utils/Iterator","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/UIKIT/Mask"],function(e,t,n,o,i,s,r,a,l,d,c,u,p){"use strict";var h;function g(e){for(var t={},n=0;n<e.length;n++){var o=e[n];t[o.dataIndex]=void 0!==o.visibleFlag&&!o.visibleFlag}return t}function f(e){this.exportFlags={};for(let t=0;t<e.length;t++){let n=e[t];n.customisation&&n.customisation.exportable&&(this.exportFlags[n.dataIndex]=n.customisation.exportable.value)}}function v(e){return-1===e.rowID?e.cellModel:s.convertDateTime(e.cellModel)}function m(e,t){let n,o=0,i=!1;for(o=0;o<e.length;o++)if((n=e[o]).dataIndex===t){i=!0;break}return i?{index:o,column:n}:null}function b(e){}return f.prototype={reapply:function(e){for(let t=0;t<e.length;t++){let n=e[t];n.customisation&&n.customisation.exportable&&void 0!==this.exportFlags[n.dataIndex]&&(n.customisation.exportable.value=this.exportFlags[n.dataIndex])}}},b.prototype.buildDGVOpts=function(e){var t=this;return e=e||{},new Promise(function(o){var s,l=function(n){var s=UWA.clone(i.getConfig("dgvOptions")),l=s&&s.dgv?s.dgv:{};if(n=UWA.extend(l,n),t.options.additionalColumnsModules){let o=n.columns.reduce(function(e,t,n){return t.isAdditionalColumn&&e.push({column:t,dataIndex:t.dataIndex,currentIndex:n}),e},[]);var d=[],c=g(n.columns);let i=new f(n.columns);for(var m=0;m<t.options.additionalColumnsModules.length;m++)UWA.is(t.options.additionalColumnsModules[m].getAdditionalColumnsUXDGV,"function")&&(t.options.additionalColumnsModules[m].getAdditionalColumnsUXDGV(n.columns),d=d.concat(t.options.additionalColumnsModules[m].getManagedColumnNames())),UWA.is(t.options.additionalColumnsModules[m].setupCallback,"function")&&t.options.additionalColumnsModules[m].setupCallback({treeDocModelEvents:t.options.context.getPADTreeDocument().getModelEvents(),globalModelEvents:u.getModelEvents()}),n.columns=n.columns.filter(function(e){return void 0!==e});if(d.length){let t=o.filter(function(e){return-1===d.indexOf(e.dataIndex)});if(t.length)for(let e=t.length-1;e>=0;e--){let o=t[e];n.columns.splice(o.currentIndex,1)}!0===e.reset?c=g(n.columns):i.reapply(n.columns),function(e,t,n){for(var o=0;o<e.length;o++){var i=e[o];-1!==t.indexOf(i.dataIndex)&&(i.isAdditionalColumn=!0),void 0!==n[i.dataIndex]&&(i.visibleFlag=!n[i.dataIndex])}}(n.columns,d,c),i.reapply(n.columns),function(e){for(var t=0;t<e.length;t++){var n=e[t],o=n.customisation;o&&o.layout&&void 0!==o.layout.hidden&&n.visibleFlag!==!o.layout.hidden&&(o.layout.hidden=!n.visibleFlag)}}(n.columns)}}let b=n.columns.filter(function(e){return"dateTime"===e.kind});for(let e=0;e<b.length;e++){b[e].getCellValueForExport=v}if(n.onContextualEvent=t._onContextualEvent.bind(t),n.onDelayedModelDataRequest=t.options.context.updateAttributesDelayed.bind(t.options.context),n.getCellTooltip=t._getCellTooltip.bind(t),t.options.callbacks){var _=Object.keys(t.options.callbacks);for(m=0;m<_.length;m++)n[_[m]]=t.options.callbacks[_[m]]}u.getModelEvents().subscribe({event:"container-to-unmask"},function(e){h=e.container}),a.updateColumnsWithNLS(n.columns,function(e){"success"===e.status&&(n.columns=e.columns);var i=!1;for(let e=n.columns.length-1;e>=0;e--)if("actualIndex"===n.columns[e].dataIndex){i=!0;break}!1===i&&n.columns.push({dataIndex:"actualIndex",kind:"integer",neverVisible:!0,visibleFlag:!1}),r.updateAttributesList(n.columns).then(()=>{let e=Promise.resolve();!0===t.options.activateFilterView&&(e=t.__addFilterModel(n)),e.then(()=>{t.completeDGVOptions(n).then(o)})}),h&&p.unmask(h)})};t.options.typeRepresentations={},t.__initColumnViews().then(()=>{t.options.view_customization&&!0!==e.reset&&!0===t.options.view_customization.custoFromDGV?(!0===t.options.view_customization.custoOptimized&&(t.options.view_customization=n.convertPreference2Custo(t.options.view_customization,"datagridview")),s=t.options.view_customization,t.__roleRelatedColumns(s).then(function(){t.buildColumnsFromStorage(s.columns).then(function(e){s.columns=e,l(s)})})):(s={},t.buildColumns("datagridview").then(function(e){t.__roleRelatedColumns(e).then(function(){s.columns=e.columns,l(s)})}))})})},b.prototype.__buildRoleMap=function(){let e=new Map;return new Promise(function(t,n){require(["DS/PADUtils/PADUtilsServices"],function(n){n.getGrantedRoles(function(n){for(let t=0;t<n.length;t++){let o=n[t];e.set(o.id,o)}t(e)})})})},b.prototype.__roleRelatedColumns=function(e){let t=this;return new Promise(function(n,o){let s=i.getConfig("roleBased"),r=[],a=[];s?(d.iterateObj(s.attributes,function(e,t){e.enabled&&(e.dataIndex=t,r.push(e))}),r.length?t.__buildRoleMap().then(function(t){d.iterate(r,function(e){a.push(function(e,t,n){return new Promise(function(o,i){let s=!1;d.iterate(n.roles,function(t){!s&&e.has(t)&&(s=!0)}),o({dataIndex:t,enabled:s,data:n})})}(t,e.dataIndex,e))}),Promise.allSettled(a).then(function(t){let o=t.map(function(e){return e.value});d.iterate(o,function(t){if(t.enabled){if(!m(e.columns,t.dataIndex)){let n=t.data;n.dataIndex=t.dataIndex,n.ds6w=n.dataIndex,e.columns.push(n)}}else{let n=m(e.columns,t.dataIndex);n&&e.columns.splice(n.index,1)}}),n()})}):n()):n()})},b.prototype.__initColumnViews=function(){return new Promise(e=>{this.options.columnViews={};var t=i.getConfig("columnViews"),n=[];if(t)for(let e=0;e<t.length;e++)-1===n.indexOf(t[e].AMD)&&n.push(t[e].AMD);n.length?c.loadAMDs(n).then(n=>{let o=[];for(let e=0;e<t.length;e++)if(-1!==n.loadedAMDs.indexOf(t[e].AMD)){let n=require(t[e].AMD);-1===o.indexOf(t[e].AMD)&&"function"==typeof n.getTypeRepresentation&&(this.options.typeRepresentations=Object.assign(this.options.typeRepresentations,n.getTypeRepresentation()),o.push(t[e].AMD)),this.options.columnViews[t[e].dataIndex]={AMD:n}}e()}):e()})},b.prototype.completeDGVOptions=function(e){return Promise.resolve(e)},b.prototype.completeCB=function(){return Promise.resolve()},b.prototype.getColumnViewsForUpdate=function(){var e;let t=this.options.columnViews?Object.keys(this.options.columnViews):[];for(let n=0;n<t.length;n++)if("function"==typeof this.options.columnViews[t[n]].AMD[t[n]].updateAttributesDelayed){!0===this.options.dgv.layout.getColumnVisibleState(t[n])&&(e||(e={}),e[t[n]]=this.options.columnViews[t[n]].AMD[t[n]])}return e},b.prototype.addColumnCB=function(e){var t=this;this.options.dgv.prepareUpdateView();var n=[];e.forEach(function(e){n.push(new Promise(function(n){r.addAvailableColumn(e.dataIndex,e).then(function(e){var o=null;e.ds6w&&t.options.columnViews[e.ds6w]?o=t.options.columnViews[e.ds6w].AMD[e.ds6w].buildColumn(e):e.dataIndex&&t.options.columnViews[e.dataIndex]&&(o=t.options.columnViews[e.dataIndex].AMD[e.dataIndex].buildColumn(e)),null===o&&(o=t.buildColumnFromSetting(e)),o&&("real"!=o.kind&&"real"!=o.typeRepresentation||(o.kind="float",o.typeRepresentation="float"),"dateTime"===o.kind&&(o.getCellValueForExport=v),t.options.dgv.addColumnOrGroup(o)),n()})}))}),Promise.all(n).then(function(){this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)}.bind(this))},b.prototype.removeColumnCB=function(e){var t=this;this.options.dgv.prepareUpdateView(),e.forEach(function(e){var n=UWA.is(e,"string")?JSON.parse(e):e,o=t.options.dgv.getColumnOrGroup(n.dataIndex);o&&void 0!==o.dataIndex&&(t.options.dgv.removeColumnOrGroup(n.dataIndex),r.removeAvailableColumn(n.dataIndex))}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},b.prototype.removeColumns=function(e){this.options.dgv.prepareUpdateView(),e.forEach(e=>{var t=this.options.dgv.getColumnOrGroup(e);t&&void 0!==t.dataIndex&&(this.options.dgv.removeColumnOrGroup(e),r.removeAvailableColumn(e))}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},b.prototype.changeTitleCB=function(e,t){var n=this.options.dgv.getColumnOrGroup(e);n&&(this.options.dgv.prepareUpdateView(),n.text=t,n.customisation.titleModified=!0,this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0))},b.prototype.changeVisibilityCB=function(e,t){this.options.dgvLayout.setColumnVisibleFlag(e,t,{isUserInteraction:!1})},b.prototype.changePinCB=function(e,t){this.options.dgvLayout.setColumnPinned(e,t,{isUserInteraction:!1})},b.prototype.moveColumnCB=function(e){e.move2perform&&(e.move2perform.from&&(e.move2perform.fromID=this.options.dgvLayout.getColumnIndex(e.move2perform.from),e.move2perform.toID=this.options.dgvLayout.getColumnIndex(e.move2perform.to)),this.options.dgvLayout.moveColumn(e.move2perform.fromID,e.move2perform.toID,{isUserInteraction:!1}))},b.prototype.changeDgvLayout=function(e){void 0!==typeof e.rowsHeader&&(this.options.dgvLayout.rowsHeader=e.rowsHeader)},b.prototype.changeExportCB=function(e,t){this.options.dgv.prepareUpdateView();var n=this.options.dgv.getColumnOrGroup(e);n&&(n.customisation||(n.customisation={}),n.customisation.exportable||(n.customisation.exportable={}),!1===n.customisation.exportable.lock&&(n.customisation.exportable.value=t)),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},b.prototype.compactMode=function(e){this.options.dgvLayout.layoutDensity=e.viewMode,this.options.viewMode=e.viewMode},b.prototype.saveCustoView=function(e,t){var n=this;this._prepareOptsToStore({onComplete:function(o){var i=e?"onCustoViewChange":"onSaveAsTemplate";n.options.context.dispatchEvent(i,o),!0===t&&n.options.context.dispatchEvent("onSaveAsTemplate",o)}})},b.prototype.modifyColumRendering=function(e){var t=UWA.is(e,"string")?JSON.parse(e):e,n=this.getColumnOrGroup(t.dataIndex);n&&(void 0===n.xnav_options&&(n.xnav_options=n.customisation),void 0!==t.exportable&&t.exportable!==n.xnav_options.exportable.value&&(n.xnav_options.exportable.value=t.exportable,n.customisation&&n.customisation.exportable&&(n.customisation.exportable.value=t.exportable)))},b.prototype.reset=function(e){var t=this;delete t.options.view_customization,this.buildDGVOpts({reset:!0}).then(function(n){var o=i.getConfig("dgvOptions")?i.getConfig("dgvOptions"):{};t.options.dgv.prepareUpdateView(),o.dgvLayout&&(o.dgvLayout.cellHeight&&(t.options.dgvLayout.cellHeight=o.dgvLayout.cellHeight),o.viewMode&&(t.options.dgvLayout.layoutDensity=o.viewMode)),t.options.dgvLayout.deleteDataGridViewPreferences(),t.options.dgvLayout.rowsHeader=o.rowsHeader,t.options.dgvLayout.columns=n.columns,t.options.dgv.columns=n.columns,t.options.viewMode=o.viewMode,t.options.dgvLayout.applyColumns(),t.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!1},!0),t.saveCustoView(e)})},b.prototype.removeSort=function(e){this.options.dgv.prepareUpdateView(),this.options.dgv.sortModel=null,this.options.dgv.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)},b.prototype.clearSort=function(e){l.clearSort("begin"),this.options.dgv.prepareUpdateView(),this.options.dgv.sortModel=null,this.options.dgv.sortModel=[{dataIndex:"actualIndex",sort:"asc"}],this.options.dgv.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0),l.clearSort("end")},b.prototype.isClearSortEnabled=function(e){if(!this.options.dgv)return!1;var t=this.options.dgv.sortModel;return null!==t&&(t.length>=1?"actualIndex"!==t[0].dataIndex:void 0)},b.prototype._onContextualEvent=function(e){var t=this;return new Promise(function(n){var i=o,s=Promise.resolve();t.options.context.isDynamicCtx()&&(s=new Promise(function(e){require(["DS/ENXNav/utils/CtxMenuUtilsV2"],function(t){i=t,e()})})),s.then(function(){require(["DS/PADUtils/PADUtilsServices"],function(e){(e.isTouchDevice()||e.isSurface())&&i.context&&i.context.dropInvitContainer&&i.context.dropInvitContainer.hide()}),i.buildMenu({view:"datagridview",context:t.options.context,params:e}).then(n)})})},b.prototype._getCellTooltip=function(t){var n=null,o=this.options.dgv.getColumnOrGroup(t.columnID),i=o.dataIndex;return t.dataIndex=i,this.options.columnViews[i]&&this.options.columnViews[i].AMD&&this.options.columnViews[i].AMD[i].getCellTooltip&&(n=this.options.columnViews[i].AMD[i].getCellTooltip(t,this.options.dgv)),null===n&&(-1===t.rowID?n="rel"===o.ds6wFrom?{shortHelp:e.replace(e.instanceColHeader,{label:o.text}),updateModel:!1}:this.options.dgv.getCellDefaultTooltip(t):"ContextualMenuColumn"===i?n={shortHelp:e.columns.ContextualMenuColumn,updateModel:!1}:"thumbnail"===i?n={shortHelp:e.tooltip_thumbnail,updateModel:!1}:(n=null,this.options.additionalColumnsModules&&(n=null,n=function(e,t){let n=null;if(t.cellModel&&t.nodeModel.options){let o=e.filter(function(e){return!!e.provideDisplayTooltip}).filter(function(e){return-1!==e.getManagedColumnNames().indexOf(t.dataIndex)});return d.iterate(o,function(e){null!==(n=e.provideDisplayTooltip(t))&&"object"!=typeof n&&(n={shortHelp:n,updateModel:!1})}),n}return null}(this.options.additionalColumnsModules,t)),null===n&&t.nodeModel&&"function"==typeof t.nodeModel.getCellTooltip&&(n=t.nodeModel.getCellTooltip(t))),null===n&&(n=this.options.dgv.getCellDefaultTooltip(t))),n},b.prototype.selectSingleInstance=function(e){this.options.dgv.treeDocument.getSelectedNodes().length>=1&&this.options.dgv.treeDocument.unSelectAll(),e.nodeModel.select()},b.prototype.eventHandlerOnGridView=function(e){var t=this;return new Promise(function(n){e.addEventListener("change",function(e,t){t&&t.nodeModel&&-1!==t.columnID&&(t.nodeModel.isSelected()?t.nodeModel.unselect():t.nodeModel.select())}),e.addEventListener("columnOrderChange",function(e){t.saveCustoView(!0,!0)}),e.addEventListener("userPreferencesChange",function(e){t.saveCustoView(!0,!0)}),e.addEventListener("click",function(e,n){if(void 0!==n&&-1!==n.rowID){var o=e.dsModel.layout.getDataIndexFromColumnIndex(n.columnID);if(t.options.columnViews[o]&&t.options.columnViews[o].AMD&&t.options.columnViews[o].AMD[o].actionOnClick&&n.nodeModel&&!n.nodeModel.isGroupingNode)t.options.columnViews[o].AMD[o].actionOnClick(n,t.options.context);else if(t.options.clickEvent[o])t.options.clickEvent[o](n);else if(t.options.additionalColumnsModules&&!0===e.dsModel.layout.getColumnOptionValue(n.columnID,"isAdditionalColumn"))for(var i=0;i<t.options.additionalColumnsModules.length;i++){let e=t.options.additionalColumnsModules[i],r=e.getOnCellClickCB;if(r){var s=r.call(e,o);if(s){s(n);break}}}}}),t.completeCB(e).then(n)})},b.prototype._prepareOptsToStore=function(e){var o=this;t.debounce(function(e){o.options.dgvLayout.columns=o.options.dgv.columns;for(var t=o.options.dgvLayout.getOrderedColumnsIndexes(),i=[],s={},a=0;a<t.length;a++){var l=o.options.dgv.getColumnOrGroup(t[a]);l.columnIdx=a,i.push(l),l.customisation&&!0===l.customisation.titleModified&&(s[l.dataIndex]=!0)}o.options.dgv.columns=i;var d={viewMode:o.options.viewMode,rowsHeader:o.options.dgvLayout.rowsHeader,columns:i,selectedTypes:r.getSelectedTypes(),selectedExtensions:r.getSelectedExtensions()},c=n.convertCusto4Preference(d,s,"datagridview");e.onComplete(c)},500)(e)},b}),define("DS/ENXNav/views/xNavDataGridView",["css!DS/ENXNav/ENXNav","UWA/Core","DS/DataGridView/DataGridView","DS/PADUtils/PADCommandProxy","DS/ENXNav/views/customize_views/_xNavDGVParametrization","DS/ENXNav/views/customize_views/_xNavDGVUtils","DS/ENXNav/features/xNavSaveSort","DS/PADUtils/Configuration","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents"],function(e,t,n,o,i,s,r,a,l,d,c){"use strict";function u(){return l.getSetting("saveSorts")||"true"===d.getURLParameter("saveSorts")}function p(e){this.name="xnav-dgv",this._version=.1,this._additionalColumnsAMD=e.additionalColumnsAMD,this._cbDefinition=e.callbacksDefinition||{},this.options={renderTo:null,context:null,viewMode:"",view_customization:null,modelEvents:null,subscribeTokens:[],dgv:null,dgvLayout:null,isActiveView:!1,clickEvent:{},doubleClickEvent:{}},this.options=Object.assign(this.options,e)}return p.prototype=Object.assign(p.prototype,i.prototype),p.prototype=Object.assign(p.prototype,s.prototype),p.prototype.initialize=function(){var e=this;return new Promise(function(i){var s=t.clone(a.getConfig("dgvOptions"));e.options.viewMode=s.viewMode,e.options.useAsyncPreExpand=s.useAsyncPreExpand,e.options.activateFilterView=s.activateFilterView||"true"===d.getURLParameter("activateFilterView"),e.options.columnsDefaultfilterDefinition=s.columnsDefaultfilterDefinition,u()&&(e._saveSortsHandler=new r({})),e.buildDGVOpts().then(function(r){var a=t.extend({identifier:"DataGridView-"+e.name+"-"+d.uid()},r);if("undefined"!==s.dgvLayout){var p=t.clone(s.dgvLayout);void 0!==r.defaultCellHeight&&(p.cellHeight=r.defaultCellHeight,delete r.defaultCellHeight),void 0!==r.rowsHeader&&(p.rowsHeader=r.rowsHeader,delete r.rowsHeader),a.layoutOptions=p}else a.layoutOptions={};e.options.viewMode=r.viewMode?r.viewMode:"comfortable",a.layoutOptions.layoutDensity=e.options.viewMode,"undefined"!==s.useAsyncPreExpand&&(a.useAsyncPreExpand=s.useAsyncPreExpand),a.showContextualMenuColumnFlag=!0;var h=e.options.dgv=new n(a);u()&&e._saveSortsHandler.setup({dgv:e}),e.options.dgvLayout=h.layout;var g=h.getColumnOrGroup("ContextualMenuColumn");if(g){if(e.options.dgv.prepareUpdateView(),void 0!==r.ctxMenuColumn){h.onReady(function(){void 0!==r.ctxMenuColumn.pinned&&e.changePinCB("ContextualMenuColumn",r.ctxMenuColumn.pinned);var t=e.options.dgvLayout.getColumnIndex("ContextualMenuColumn");t!==r.ctxMenuColumn.columnIdx&&e.moveColumnCB({move2perform:{fromID:t,toID:r.ctxMenuColumn.columnIdx}}),void 0!==r.ctxMenuColumn.visibleFlag&&!1===r.ctxMenuColumn.visibleFlag&&e.hideColumn("ContextualMenuColumn")})}g.customisation={exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!1}},e.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0)}var f=h._keymapManager,v=function(){var e=require("DS/ApplicationFrame/CommandsManager").getCommand("ActionBar_Attributes");e&&e.isEnabled()&&e.begin()};["alt+return","alt+enter"].forEach(function(e){f.unregisterKeymap(e),f._commandsRegistry.registerCommand("enxdgv:"+e,v),f.registerKeymap(e,void 0,"enxdgv:"+e)});var m=["ctrl+shift+f"];if(f.unregisterKeymap(m),f._commandsRegistry.registerCommand("enxdgv:"+m,function(){var e=require("DS/ApplicationFrame/CommandsManager").getCommand("FindCmd");e&&e.isEnabled()&&e.begin()}),f.registerKeymap(m,void 0,"enxdgv:"+m),e.options.additionalColumnsModules)for(var b=0;b<e.options.additionalColumnsModules.length;b++){if(e.options.additionalColumnsModules[b].getTypeRepresentations){var _=e.options.additionalColumnsModules[b].getTypeRepresentations();h.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(_))}e.options.additionalColumnsModules[b].setupDGVManipulation&&e.options.additionalColumnsModules[b].setupDGVManipulation({onAddColumn:function(n){e.addColumnCB(t.clone(n.addedColumns))},onRemoveColumn:function(n){e.removeColumnCB(t.clone(n.removedColumns))}})}h.getTypeRepresentationFactory().registerTypeRepresentations(e.getTypeRepresentations()),e._commandProxy=o.create(),e.eventHandlerOnGridView(h).then(function(){h.getContent().addClassName(e.name),e.options.renderTo&&!0===e.options.isActiveView&&h.inject(e.options.renderTo),e.options.subscribeTokens.push(c.subscribe({event:"ENXViews/DatagridView/ExportAs"},e._exportAsCmd.bind(e))),l.getSetting("activateCustomScrollPaddingBottom")&&e.options.subscribeTokens.push(c.subscribe({event:"ENXViews/ActionBar/status"},t=>{t&&"true"===t.dataOpen?e.options.dgvLayout.scrollPaddingBottom=60:e.options.dgvLayout.scrollPaddingBottom=0})),e.options.subscribeTokens.push(c.subscribe({event:"ENXViews/Model/FindInCtx"},e.removeFilterView.bind(e))),e.options.subscribeTokens.push(c.subscribe({event:"ENXModel/Root/remove"},t=>{e.removeFilterView()})),e.options.subscribeTokens.push(c.subscribe({event:"ENXViews/DatagridView/CheckColumns"},t=>{e.removeColumns(t.colsToRemove),e.saveCustoView(!0,!1),c.publish({event:"ENXViews/DatagridView/CheckColumns/Done"})})),i()}),require(["DS/PADUtils/PADUtilsServices"],function(n){e.options.currentTenant=n.getPlatformId(),l.addEvent("onX3dPlatformId",function(n){e.options.currentTenant!==n&&(e.options.currentTenant=n,"function"==typeof e.options.onTenantChange&&e.options.onTenantChange({updateTreeView:function(n){t.is(n)&&""!==n?console.warn("Modification of columns during Tenant modification must be done"):e.reset()}}))})})})})},p.prototype.destroy=function(){for(var e=0;e<this.options.subscribeTokens.length;e++)c.unsubscribe(this.options.subscribeTokens[e])},p.prototype.setModel=function(e){this.options.dgv.getContent().inject(this.options.renderTo),this.options.isActiveView=!0,this.options.dgv.treeDocument=e,!0===this.options.activateFilterView&&this.options.dgv.treeDocument.setFilterModel(this.options.filterModel)},p.prototype.completeDGVOptions=function(e){return new Promise(function(t){for(var n=0;n<e.columns.length;n++)void 0===e.columns[n].getCellClassName&&(e.columns[n].getCellClassName=function(e){var t=[];return e.nodeModel&&!0===e.nodeModel.options.isBeingCut&&t.push("dgv-cutNode"),t.join(" ")});t(e)})},p.prototype.unsetModel=function(){this.options.isActiveView&&(this.options.renderTo.removeChild(this.options.dgv.getContent()),this.options.isActiveView=!1,this.options.dgv.treeDocument=null)},p.prototype.isColumnHidden=function(e){var t=!0;return this.options.dgv&&this.options.dgv.getColumnOrGroup(e)&&"boolean"==typeof this.options.dgv.getColumnOrGroup(e).visibleFlag&&(t=!this.options.dgv.getColumnOrGroup(e).visibleFlag),t},p.prototype.isColumnExportable=function(e){var t=!0;if(this.options.dgv&&this.options.dgv.getColumnOrGroup(e)){var n=this.options.dgv.getColumnOrGroup(e);n.customisation&&n.customisation.exportable&&(t="boolean"!=typeof n.customisation.exportable.value||n.customisation.exportable.value)}return t},p.prototype.showColumn=function(e){this.changeVisibilityCB(e,!0)},p.prototype.hideColumn=function(e){this.changeVisibilityCB(e,!1)},p.prototype.updateView=function(){this.options.dgv.updateView(!0)},p.prototype.changeColumnTitle=function(e,t){this.changeTitleCB(e,t)},p.prototype.setUseClipboardFlag=function(e){this.options.dgv.setUseClipboardFlag(e)},p.prototype.getColumnsForExport=function(){for(var e=[],t=this.options.dgvLayout.getOrderedColumnsIndexes(),n=0;n<t.length;n++){var o=this.options.dgvLayout.getColumnOptionValue(t[n],"customisation");o&&o.exportable&&!0===o.exportable.value&&e.push(this.options.dgvLayout.getDataIndexFromColumnIndex(t[n]))}return e},p.prototype.removeFilterView=function(){const e=this.options.dgv.getFilterViewManager(),t=e.getFilterViews();(!e.isEmpty()||this.options.dgv.treeDocument&&0===this.options.dgv.treeDocument.getRoots().length)&&(console.debug("DGV: Reset View Filter"),Object.keys(t).forEach(e=>{t[e].filter.filterModel=void 0}))},p}),define("DS/ENXNav/mixins/xNavChangeAction",["UWA/Class","DS/ENXNav/models/_xNavCVParser","DS/PADUtils/views/PADAlert","DS/PADUtils/PADWSProxy","DS/PADUtils/PADChangeActionHandler","DS/PADUtils/PADSettingsMgt","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,o,i,s,r){return e.extend({loadChange:function(e){var t=this;t.beginBlockingTransaction(r.retrieveChangeAction);var n=this.getPADTreeDocument(),o=n.getRoots();o=o.concat(n.getDetachedRoots());var a=e.objects.map(function(e){return e.objectId});i.getInfos(a,function(n){t.beginBlockingTransaction(r.loadChangeAction);var o=-1,i=function(){if(++o<n.length){var r=n[o];t._processCA(r,i)}else{t.endBlockingTransaction(),t._checkIfEmpty(),e.callback&&e.callback();var a=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");!0===s.getSetting("changeControlDlgOpen")?(t._commandProxy.changeControlDlgOpen({isOpen:!1,widget:"2D"}),UWA.is(a.setFromDrop,"function")&&a.setFromDrop(n,function(){console.log("Change set on Singleton from 2D")})):s.setSetting("changeControlDlgOpen",!0)}};i()},function(e){t.endBlockingTransaction(),t._checkIfEmpty()})},_checkIfEmpty:function(){0===this.options.model.getRoots().length&&0===this.options.model.getDetachedRoots().length&&this.dispatchEvent("onEmptyView")},_processCA:function(e,t){var o=this;i.determineExecution(e,{addAndFind:function(e){var s=i.extractIds(e.changeaction.context),a=i.extractRealizedAndProposed(e),l=o.getPADTreeDocument(),d=l.getRoots(),c=(d=d.concat(l.getDetachedRoots())).map(function(e){return e.getID()});d.length&&o.dropInvitContainer.hide(o.dropInvitContainer.active_invite);var u=s.filter(function(e){return-1===c.indexOf(e)});u.length!==s.length&&(n.displayNotification({msg:r.root_already_loaded}),0===u.length&&t&&t()),u.length>0&&o.performCAFindInContext({rootIds:u,findIds:a},t)},add:function(e){var i=t||void 0,s=o.getPADTreeDocument(),a=s.getRoots(),l=(a=a.concat(s.getDetachedRoots())).map(function(e){return e.getID()});a.length&&o.dropInvitContainer.hide(o.dropInvitContainer.active_invite);var d=e.filter(function(e){return-1===l.indexOf(e)});0===d.length?(n.displayNotification({msg:r.root_already_loaded}),t&&t()):o.add({content:"idslist",pids:d,callback:i})},wasEmpty:function(){0==o.getPADTreeDocument().getRoots().length?o.dropInvitContainer.show("drop"):o.dropInvitContainer.hide(),t&&t()}})},performCAFindInContext:function(e,i){var s=this,a=e.rootIds,l=e.findIds,d=s.getPADTreeDocument();new Promise(function(e,t){s.add({content:"idslist",pids:a,broadcast:!1,callback:function(){e()}})}).then(function(){for(var e=[],c=0;c<a.length;c++){var u=o.find_in_ctx({rootId:a[c],findids:l});e.push(u),u.then(function(e){if(0===e.results.results.length){n.displayNotification({msg:r.find_in_context_no_result,eventID:"info"});var o=require("DS/PADUtils/PADUtilsServices"),i={pids:[e.params.rootId],tenant:o.getPlatformId()};s._commandProxy.drop(i)}else t.process.expand({starting_from_root:!0,root_nodes:d.getRoots(),treedocument:d,response:e.results,mode:"find_in_ctx",expand_level:1,selectPathLeaf:!0,addedPaths:function(e){var t={paths:e,tenant:require("DS/PADUtils/PADUtilsServices").getPlatformId()};s._commandProxy.drop(t)}}),s.dropInvitContainer.hide(s.dropInvitContainer.active_invite)}).catch(function(e){console.error(e)})}Promise.all(e).then(function(){i&&i()}).catch(function(e){i&&i()})})}})}),define("DS/ENXNav/mixins/xNavChangeActionV2",["UWA/Class","DS/ENXNav/models/_xNavCVParser","DS/PADUtils/views/PADAlert","DS/PADUtils/PADWSProxy","DS/PADUtils/PADChangeActionHandler","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,o,i,s,r,a){return e.extend({loadChangeV2:function(e){var t=this;t.beginBlockingTransaction(a.retrieveChangeAction);this.getPADTreeDocument().getRoots();var n=e.objects.map(function(e){return e.objectId});i.getInfos(n,function(n){t.beginBlockingTransaction(a.loadChangeAction);var o=-1,i=function(){if(++o<n.length){var r=n[o];t._processCAV2(r,i)}else{t.endBlockingTransaction(),t._checkIfEmptyV2(),e.callback&&e.callback();var a=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");!0===s.getSetting("changeControlDlgOpen")?(t._commandProxy.changeControlDlgOpen({isOpen:!1,widget:"2D"}),UWA.is(a.setFromDrop,"function")&&a.setFromDrop(n,function(){console.log("Change set on Singleton from 2D")})):s.setSetting("changeControlDlgOpen",!0)}};i()},function(e){t.endBlockingTransaction(),t._checkIfEmptyV2()})},_checkIfEmptyV2:function(){0===this.options.model.getRoots().length&&this.dispatchEvent("onEmptyView")},_processCAV2:function(e,t){var o=this;i.determineExecution(e,{addAndFind:function(e){var s=i.extractIds(e.changeaction.context),r=i.extractRealizedAndProposed(e),l=o.getPADTreeDocument().getRoots(),d=l.map(function(e){return e.getID()});l.length&&o.dropInvitContainer.hide(o.dropInvitContainer.active_invite);var c=s.filter(function(e){return-1===d.indexOf(e)});c.length!==s.length&&(n.displayNotification({msg:a.root_already_loaded}),0===c.length&&t&&t()),c.length>0&&o.performCAFindInContextV2({rootIds:c,findIds:r},t)},add:function(e){var i=t||void 0,s=o.getPADTreeDocument().getRoots(),r=s.map(function(e){return e.getID()});s.length&&o.dropInvitContainer.hide(o.dropInvitContainer.active_invite);var l=e.filter(function(e){return-1===r.indexOf(e)});0===l.length?(n.displayNotification({msg:a.root_already_loaded}),t&&t()):o.add({content:"idslist",pids:l,callback:i})},wasEmpty:function(){o.dropInvitContainer.options.active_invite&&o.dropInvitContainer.hide(),t&&t()}})},performCAFindInContextV2:function(e,t){var o=this,i=e.rootIds,s=e.findIds;o.getPADTreeDocument();let l="";for(let e=0;e<s.length;e++)e>0&&(l+=" OR "),l+="physicalid:"+s[e];new Promise(function(e,t){o.add({content:"idslist",pids:i,broadcast:!1,callback:function(){e()}})}).then(function(){for(var e=[],s=0;s<i.length;s++){var d=new Promise(function(e,t){let n=i[s],a=o.options.model.getNodesById(n);r.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:a,searchFts:l,searchFtsOriginal:l,noPager:!0,doNotBroacast:!0}}),r.getModelEvents().subscribeOnce({event:"ENXViews/Model/FindInCtx/complete"},function(n){n.foundNodes&&0===n.foundNodes.length&&t(),e(n)})});e.push(d),d.then(function(e){if(0===e.foundNodes.length){n.displayNotification({msg:a.find_in_context_no_result,eventID:"info"});var t=require("DS/PADUtils/PADUtilsServices"),i={pids:[rootId],tenant:t.getPlatformId()};o._commandProxy.drop(i)}}).catch(function(e){console.error(e)})}Promise.all(e).then(function(){t&&t()}).catch(function(e){t&&t()})})}})}),define("DS/ENXNav/XNavComponent",["css!DS/ENXNav/ENXNav","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/UIKIT/Mask","DS/Utilities/Utils","DS/Windows/ImmersiveFrame","DS/WebUAUtils/WebUAUtils","DS/PADUtils/views/PADFilterCancel","DS/ENXNav/mixins/_xNavDnD","DS/ENXNav/mixins/xNavLeftSidePanel","DS/ENXNav/mixins/_xNavBIFilter","DS/ENXNav/mixins/_xNavRefresh","DS/ENXNav/mixins/xNavChangeAction","DS/ENXNav/mixins/xNavChangeActionV2","DS/ENXNav/mixins/EventHooks","DS/ENXNav/mixins/xNavWidgetLink","DS/ENXNav/utils/FindInCtx","DS/ENOXParser/modules/common/Helpers","DS/PADUtils/views/PADAlert","DS/PADUtils/PADPromise","DS/PADUtils/PADSession","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/Storage","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/PADTrackerManager","DS/ENXNav/features/xNavPersistPanel","DS/ENOXInterWdgCom/LinkManager","DS/ENOXTriptych/js/ENOXTriptych","DS/PADUtils/PADWSAccess"],function(e,t,n,o,i,s,r,a,l,d,c,u,p,h,g,f,v,m,b,_,D,S,x,y,C,w,P,N,A,I,E,O,M,F,R){"use strict";function T(e,t){var n=this;require(["DS/ENXNav/views/ViewLoader"],function(o){var i={component:n,x3dAppId:n.options.x3dAppId,renderTo:e.renderTo,amd:{treelistview:n.options.amd_custo.TreeListView,graphview:n.options.amd_custo.TreeGraph,tileview:n.options.amd_custo.TileGridView,thumbnailview:n.options.amd_custo.ThumbnailGridView,datagridview:n.options.amd_custo.DataGridView}};n.loader=new o(i),n.loader.loadView(n.options.active_view,function(){"graphview"===n.options.active_view&&n.options.views.graphview.reframeOn(),t()})})}function k(e,t){e.push(t.map(function(e){return e.resourceid}))}function U(e){var t=this,n=require("DS/PADServices/ws/WSAccess"),o={data:{rootPhID:e.getID()},maxLeaves:P.getSetting("maxNumberOfLeaves"),is2D:!0,filterBI:t._biFilter};n.getRootStats(o).then(function(e){try{var n,o="string"==typeof e?JSON.parse(e):e,i={};if(o.results)for(var s=0;s<o.results.length;s++)if(o.results[s].resourceid)n=o.results[s].resourceid;else if(o.results[s].synthesis){var r=o.results[s].synthesis.name;switch(o.results[s].synthesis.name){case"ProgressiveExpand_FlatSynthesis":r="flatSynthesis";break;case"ProgressiveExpand_OccSynthesis":r="occSynthesis";break;case"ProgressiveExpand_LeafSynthesis":r="leafSynthesis"}i[r]=o.results[s].synthesis.value}var a=E.getPADTracker({eventCategory:"usage",eventAction:"synthesis"});a?(a.addMultivaluedEventData("synthesis",{flatSynthesis:i.flatSynthesis,occSynthesis:i.occSynthesis,leafSynthesis:i.leafSynthesis}),a.trackPageEvent()):console.warn("tracker not defined");var l=t.options.model.getNodesById(n);1===l.length&&l[0].isRoot()&&l[0].setSynthesis(i)}catch(e){}})}return i.extend(s,r,p,g,f,v,m,h,b,_,{_dispatchReady_NotDone:!0,defaultOptions:{widget:null,elements:null,active_view:"datagridview",action_bar_opts:null,configuration:{toolbarActivated:!1,dynamicCtxActivated:!1},layout:{padshell:!1,title_update:!0,view_customization:null,store_roots_in_pref:!0,statusInfo:!0,drop_invite:"dynamic",dndEvo:!1,keyboard_inputs:!0,withWelcomePanel:!1,triptychOpts:{left:{resizable:!0,originalState:"close",overMobile:!0,minWidth:300,withClose:!0},withtransition:!0,withoverflowhidden:!0,right:{resizable:!0,originalState:"close",overMobile:!0,minWidth:250,withClose:!1}},amdTreeView:"datagridview"},amd_custo:{TreeDocument:"DS/ENXNav/models/xNavDocument",TreeListView:"DS/ENXNav/views/xNavTreeListView",TreeGraph:"DS/ENXNav/views/xNavGraphView",TileGridView:"DS/ENXNav/views/xNavResponsiveTilesView",ThumbnailGridView:"DS/ENXNav/views/xNavResponsiveThumbnailsView",DataGridView:"DS/ENXNav/views/xNavDataGridView"},views:{treelistview:null,graphview:null,tileview:null,thumbnailview:null,datagridview:null},views_cb:{},isReady:{model:!1,actionbar:!1,treelistview:!1,graphview:!1,tileview:!1,thumbnailview:!1}},_probes:{},init:function(e){this._parent(e),this.options=o.extend(this.options,e,!0),this.options.layout.dndEvo="true"===N.getURLParameter("dndDivEvo"),document.body.setStyle("overflow","hidden"),this.elements.container=o.createElement("div",{class:"xnav_component"}),this.options.flags={},!0===P.getSetting("activateSynthesisOnRoot")&&P.setSetting("maxPathCount",void 0);var t=this;require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADProbes","DS/PADUtils/PADWebInWinServices"],function(e,i,s,r){t._probes.probe_init=s.createProbe("init_xnavcomponent"),t.options.loadGraphSection=P.getSetting("loadGraphSection"),r.initialize({widget:widget}),widget&&widget.lang&&P.setSetting("lang",widget.lang),e.app_initialization(function(r){r&&!0===r.success?function(){t._commandProxy=i.create({events:{onDrop:function(n,o){e.updatePlatformId(n.tenant);var i=!0!==n.already_added_in_PS;o.originWidgetId&&(i=!0!==n.already_added_in_PS||o.originWidgetId!==e.getWidgetId()&&!0===P.getSetting("activateFUN076708")),n.paths||n.pids||n.filters||(i=!1),i&&t.add({content:void 0===n.paths?"idslist":"pathslist",paths:void 0===n.paths?void 0:n.paths,pids:void 0===n.pids?void 0:n.pids,filters:n.filters,loadWithFilter:n.loadWithFilter,callback:null,broadcast:!1})},onDropFilter3D:function(e,n){t.addFilter({content:"3DXContent",filter_objects:e.droppedFilters,broadcast:void 0===e.broadcast||e.broadcast,callback:void 0,behavior:"fromDrop",fromProxy:!0})},onRemove:function(e){M.isWidgetSynchronizing()||t._onRemoveRoot(e)},onCleanAll:function(){t.empty(!1)},onFilterCancel:function(e){"3D"===e.widget&&t.confirmModal.cancelModal&&(t.confirmModal.cancelModal.fromProxy=!0,t.confirmModal.cancelModal.modals.current.destroy())},onRefreshModel:function(){o.is(t.refresh,"function")&&t.refresh(!1)},onApplyFilter:function(e){e.doNotBroacast=!0,t.applyFilter(e)},onSlaveBIToggle:function(e){t._biSlave3D=e.isSlave},onSearchInApp:t.onSearch.bind(t)}}),t.setupEventHooks(),!0===P.getSetting("activateWidgetLink")&&t.setupWidgetLink(),t._probes.probe_model=s.createProbe("init_xnav_model"),function(e){var t=this,n={},i=y.getPromises(),s=i.slice(),r=new Promise(function(i){Promise.all(s).then(function(){require([t.options.amd_custo.TreeDocument],function(s){if((n=function(e){var t=this,n={};return e.forEach(function(e){o.is(t.options.views_cb[e],"function")?n[e]=t.options.views_cb[e]:o.is(t[e],"function")&&(n[e]=t[e].bind(t))}),n}.call(t,["doDnDDragStart","shouldAcceptDnDDrop","doDnDDrop"])).authorize_setStructure=t.options.authorize_setStructure,n.insert_replace=t.options.insert_replace,n.renderTo=t.options.renderTo,n.insert_replace=t.options.insert_replace,t.options.additionalColumnsModules){n.additionalColumnsModules=t.options.additionalColumnsModules;for(var r=require("DS/PADServices/utils/AttributesMgtV2"),a=0;a<t.options.additionalColumnsModules.length;a++)r.addAsyncAttributes(t.options.additionalColumnsModules[a].getManagedColumnNames())}n.context=t,t.options.model=new s(n),t.options.model.getModelEvents().subscribe({event:"titleRecalc"},function(e){var n=t.getWidgetTitle();t.options.widget.setTitle(n)});var d=[];let c=!1;var u=l.debounce(function(){c||t._commandProxy.remove({pids:d});var e=t.options.model,n=e.getRoots().length;o.is(e.detachedRoots,"array")&&(n+=e.detachedRoots.length),t.dropInvitContainer&&(n||t.dropInvitContainer.show("drop")),0===n&&t.options.views.datagridview&&t.options.views.datagridview.removeSort(),t._onRemoveRoot({pids:d,fromWLSync:c}),e&&e._pagerview&&(e._pagerview.hide(),e._pagerview=null),d=[];var i=t.getWidgetTitle();t.options.widget.setTitle(i)},250);t.options.model.getModelEvents().subscribe({event:"onRemoveRoot"},function(e){c=M.isWidgetSynchronizing(),t.dropInvitContainer&&(e.data.remainingRoots||t.dropInvitContainer.show()),d.push(e.data.pid),u()}),t.options.model.getModelEvents().subscribe({event:"onCenterGraph"},function(e){if(t.options.views.treelistview)t.options.views.treelistview.getManager().scrollToNode(e.data,void 0,!1);else{let n=t.options.model,o=!1;"2.0"===n.version&&(n._parseLoadModel=!0,o=!0),t.options.views.datagridview.options.dgv.ensureNodeModelVisible(e.data,!1,!0,.2),o&&(n._parseLoadModel=!1)}t.options.views.graphview&&t.options.views.graphview.reframeOn()}),t.options.model.getModelEvents().subscribe({event:"onRootAdded"},function(e){t.dropInvitContainer&&(0!==e.data.nb_root?t.dropInvitContainer.hide():t.dropInvitContainer.show("drop"));var n=!1;if(0===e.data.nb_root&&(n=!0),I.publish({event:"DS/ENXDropInvite/displayEmptyInvite",data:n}),o.is(widget)&&!0===t.getOption("layout").title_update){var i=t.getWidgetTitle();if(t.options.widget.setTitle(i),i){var s={TitleInfo:i};t._commandProxy.padRefresh(s)}}let r=e.data;if(r.isremove=!1,I.publish({event:"ENXModel/Root/manage",data:r}),t.getOption("layout").store_roots_in_pref&&t.dispatchEvent("onSaveRoots"),e.data.added_node&&!1===t.options.layout.withWelcomePanel){var a=e.data.added_node.getID();t.dispatchEvent("onAddPaths",{addedPaths:[[a]]})}var l=e.data.added_node,d=void 0;if(l&&(d=l.isRoot()?l:l.getRoot()),!0===P.getSetting("activateSynthesisOnRoot")&&0!==e.data.nb_root&&!1===C.isAuthoring()&&!0!==e.data.isremove&&d&&(require("DS/PADServices/ws/WSAccess"),!0===d.options.waiting4validation&&!0!==d.options.parseV2||!1!==d.hasSynthesis()||U.call(t,d)),P.getSetting("activateExcludeOccurrences")&&d){const e={select_bo:["physicalid"],select_rel:["physicalid"],root_path_physicalid:[[d.getID()]],rootPhID:d.getID()},n={serviceId:"3DSpace",data:e,FBIProxy:t._biFilter,intent:"explore_2D",onComplete:function(e){try{if(e&&!e.contains("error")){let t=JSON.parse(e),n=[];for(let e=0;e<t.results.length;++e)if(n.push(t.results[e].Path),t.results[e].matching_lengths)for(let o=0;o<t.results[e].matching_lengths.length;++o)n.push(t.results[e].Path.slice(0,t.results[e].matching_lengths[o]));d.setExcludedOccurrences(n),d.cleanUpPathes()}else console.error("Error while getting excluded occurrences")}catch(e){console.error(e)}},onCancel:void 0,onFailure:function(){console.log("Failure")},onTimeout:function(){console.log("Timeout")}};R.getStaticMappingExcludedOccurrences(n)}}),t.options.model.addEventListener("beginBlockingTransaction",function(e){t.beginBlockingTransaction(e.data)}),t.options.model.addEventListener("endBlockingTransaction",function(){t.endBlockingTransaction()}),t.initializeBI(),document.addEventListener("keyup",function(e){27===e.keyCode&&(t.options.model.originalSelection?(delete t.options.model.originalSelection,t.options.model._pagerview&&(t.options.model._pagerview.hide(),t.options.model._pagerview=null)):(t.options.model.unselectAll(),t.uncut&&t.uncut.call(t)))}),document.addEventListener("keypress",function(e){if(!0===t.options.layout.keyboard_inputs){var n=t.options.model;require(["UWA/Event"],function(t){var o=t.whichKey(e);"ctrl+a"===o&&n.withBroadcastSelect(function(){n.selectAll()})})}}),t.options.isReady.model=!0,t._probes.probe_model.end(),e&&e(),i()})})});r.name="build",i.push(r)}.call(t),t._probes.probe_view=s.createProbe("init_xnav_views"),function(){var e=this,t=new o.Element("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}});t.inject(this.options.widget.body);var n=require("DS/Windows/ImmersiveFrame"),i=require("DS/WebUAUtils/WebUAUtils"),s=new n;s.inject(t),this.options.widget.immersiveFrame=s,i.setPanelHelpMode({immersiveFrame:s}),this.options.widget.body.container=o.createElement("div",{}).inject(s.getFreeZone(),"top");var r=o.createElement("div",{class:"xnav_viewmain"}),a=(o.createElement("div",{class:"xnavToolbar"}).inject(r),o.createElement("div",{class:"xnavContent"}).inject(r));!0===e.options.configuration.toolbarActivated&&r.addClassName("withToolbar");let l=Promise.resolve(),d=this.elements.container;var c=y.getPromises(),u=c.slice();u.push(l);var p=new Promise(function(t,n){Promise.all(u).then(function(n){var i=[],s=new Promise(function(t,n){if(e.options.action_bar_opts){var o=require("DS/PADUtils/PADProbes");e._probes.probe_actionbar=o.createProbe("init_xnav_actionbar"),require(["DS/ENXNav/commands/_xNavActionBar"],function(n){e.elements.actionbar=new n({xnav_app:e,action_bar:e.options.action_bar_opts,renderTo:d,callback:{onactionbarcb:function(n){e.options.isReady.actionbar=!0,!0===e.options.isReady.actionbar&&e._probes.probe_actionbar&&e._probes.probe_actionbar.end(),"onActionBarReady"===n&&"graphview"===e.options.active_view&&!0===e.options.loadGraphSection&&(e.elements.actionbar.mergeGraphSection(),e.options.graphABLoaded=!0),!0===e.options.configuration.dynamicCtxActivated?require(["DS/ENXNav/utils/xNavCmdsMap"],function(n){e.options.cmdsMap=new n({context:e,toolbarActivated:e.options.configuration.toolbarActivated,cmdsDefinition:e.options.configuration.commands}),e.options.cmdsMap.initialize({}).then(t).catch(function(e){console.error("xNavComponent: Cannot initialize command Map"),console.error(e)})}):t()}}})})}else e.options.isReady.actionbar=!0,t()});s.name="action bar",i.push(s);var l=d;if(!0!==e.options.layout.dndEvo&&require(["DS/PADUtils/views/PADDnDInvite"],function(t){e.dropInvitContainer=new t({renderTo:d,mode:e.options.layout.drop_invite,dropOnInvite:o.is(e.dropOnInvite,"function")?e.dropOnInvite.bind(e):void 0})}),!0===e.options.layout.statusInfo&&!0!==e.options.configuration.toolbarActivated){var c=new Promise(function(t){require(["DS/PADUtils/views/PADStatusInfos"],function(n){e.elements.padstatus=new n({withProgress:!0,events:{onShow:function(){var t=require("DS/PADUtils/PADUtilsServices");e.elements.padstatus.setStatus(n.buildStatus({Tenant:t.getPlatformId(),tree_content:{nbObjectsInTree:e.options.model.getAllDescendants().length,nbObjectsSelected:e.options.model.getSelectedNodes().length}}))}}}),t()})});c.name="status Infos",i.push(c)}var u=new Promise(function(t,n){if(!0===e.options.layout.padshell){var i,s=o.clone(e.options.layout.triptychOpts);!0===e.options.configuration.toolbarActivated&&(s.left.withClose=!1),s.container=d,i=o.createElement("div",{class:"xnav_viewright rightSidePanel"}),e.elements.padshell=new F,e.elements.padshell.init(s,e.createRootListSlidder2(),r,i),P.getSetting("persistSidePanel")&&(e._xNavPersistPanel=new O,e._xNavPersistPanel.setup(e.elements.padshell)),e.elements.padshell.togglePanel=function(t){"left"===t?e.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"left"}):e.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"right"})},e.elements.padshell._modelEvents.subscribe({event:"triptych-clicked-overlay"},function(e){I.publish({event:"ENXViews/Triptych/onOverlayClick",data:e})}),e.elements.padshell.openPanel=function(t){e.elements.padshell._modelEvents.publish({event:"triptych-show-panel",data:t})},I.publish({event:"on2DTriptychReady"}),require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommandCheckHeader("RootPanel");t&&t.addCallback()}),T.call(e,{renderTo:a},t)}else T.call(e,{renderTo:d},t)});if(u.name="slidder",i.push(u),!0===e.options.authorizeChangeControl){var p=new Promise(function(t,n){Promise.all(i).then(function(n){require(["require","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADCommandProxy"],function(n,o,i){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(n){var s;s=e.elements.padshell?e.elements.padshell.getMainPanelContainer():e.elements.container.querySelector(".xnav_body"),n.initialize2(s,i.appId(),"hide",P.getSetting("changeControlPosition"),function(t){e.dispatchEvent("onAuthoringCtxAvailable",t)}),o.authoringCtxAvailable(),t()},function(e){t()})})})});p.name="promiseAuthorizeChnage",i.push(p)}var h=new Promise(function(n,o){Promise.all(i).then(function(o){!0===e.options.isReady[e.options.active_view]&&e._probes.probe_view.end(),e.elements.padstatus&&(!0===e.options.layout.padshell?e.elements.padstatus.inject(e.elements.padshell.getMainPanelContainer()):e.elements.padstatus.inject(l)),require(["DS/ApplicationFrame/CommandsManager"],function(t){var n="datagridview"===e.options.active_view||"treelistview"===e.options.active_view?"treeview":e.options.active_view,o=t.getCommand(n);o?o.begin():console.warn("Command ["+n+"] not found")}),t(),n()})});h.name="promiseResolve",i.push(h)})});p.name="buildSkeleton",c.push(p)}.call(t);var r=y.getPromises(),a=r.slice(),d=new Promise(function(e){Promise.all(a).then(function(){t.options.model.getVisibleAdditionalColumns=function(e){var n=[];if(t.options.views.treelistview)var i=t.getPADTreeListView().getManager();else i=t.options.views.datagridview;if(t.options.additionalColumnsModules&&t.options.additionalColumnsModules.length)for(var s=0;s<t.options.additionalColumnsModules.length;s++){var r=[],a=t.options.additionalColumnsModules[s],l=a.getManagedColumnNames();if(i)for(var d=0;d<l.length;d++)!0===e?o.is(i.isColumnExportable,"function")&&i.isColumnExportable(l[d])&&r.push(l[d]):o.is(i.isColumnHidden,"function")&&!i.isColumnHidden(l[d])&&r.push(l[d]);(r.length||!0===a.alwaysUpdate)&&n.push({module:a,columns:r})}return n},t.options.model.forceSyncModel4TreeListView=function(){"treelistview"===t.options.active_view&&t.options.views.treelistview.getManager().syncModel(!1)};var i=function(){t.options.views.treelistview&&(t.options.views.treelistview.previousClick.idClicked="",t.options.views.treelistview.previousClick.date="")};if(t.options.model.getXSO().onPostRemove(i),t.options.model.getXSO().onEmpty(i),t.options.views.treelistview&&t.options.views.treelistview.getManager().onHeavyDataColumnModelRequest(t.updateAttributesDelayed.bind(t)),P.getSetting("supportPgpBasedOnDescription")){var s=P.getWebAPI_Options("navigate");s.select_rel.push("ro.plminstance.V_description"),P.setWebAPI_Options("navigate",s)}I.subscribe({event:"ENXModel/SyncModel"},function(e){if("datagridview"!==t.options.active_view){for(var n=!0,o=0;o<t.options.additionalColumnsModules.length&&n;o++)"function"==typeof t.options.additionalColumnsModules[o].hasStructureModelUpdate&&(n=!1);if(!1===n){var i=t.options.model.getAllDescendants();P.getSetting("expandv2")?t.options.model.fillAttributesAsync(i,"SyncModelNodes"):t.options.model.fillAttributesAsync4VisibleNodes(i,void 0,"SyncModelNodes")}}else{var s=t.options.views.datagridview.options.dgv,r="OnSyncModel";if(!0===e.refresh&&(r="SyncModelRefresh",s.requestDelayedModelData&&s.requestDelayedModelData(r)),e.what)switch(e.what){case"applyFilter":s.requestDelayedModelData&&s.requestDelayedModelData(r)}}}),t._dispatchReady(),t.isDynamicCtx()&&require(["DS/ENXNav/commands/CmdUtils"],function(e){e.checkAvailability()}),I.subscribe({event:"ENXModel/Expand/expandStatus"},function(e){e.status&&!0===e.status.expandTooLarge&&("find_in_ctx"===e.mode?x.displayNotification({msg:n.replace(n.tooManyResultFound,{maxResult:P.getSetting("maxPathsForSearch")}),eventID:"warning"}):x.displayNotification({msg:n.expandTooLarge,eventID:"warning"}))}),I.subscribe({event:"ENXModel/Expand/parseDone"},t._checkGraphCmdAvailability.bind(t)),e()})});d.name="dispatchReady",r.push(d)}():t._initialize_failure(function(){t.dispatchEvent("onReady",{error:!0})})})})},render:function(){return this.elements.container},onSearch:function(e){0===this.options.model.getRoots().length?this.displayNotification({msg:t.find_in_context_no_result,eventID:"info"}):D.launchFind({nodes:this.options.model.getRoots(),searchFts:e.query,doNotBroacast:!0})},openStoredObjects:function(e){if(e.unserializedData&&e.unserializedData.data.items.length>0){var n=require("DS/PADUtils/PADUtilsServices").getPlatformId();return n&&e.unserializedData.data.items.forEach(function(e){e.envId=n}),this.openSearchedObjects(e)}var i=A.buildKey("ENXNav","pendingOpen",!0),s=this;return new Promise(function(n){var r=A.sess.get(i);if(r&&(delete r.fromProxy,delete r.expiresAt,o.equals(r,e)))return A.sess.del(i),void n();A.sess.setWithExpire(i,e,2e3);var a=y.getPromises(),l=[];if(e.products&&Object.getOwnPropertyNames(e.products).length){var d=new Promise(function(n){Promise.all(a).then(function(){s.add({content:"structure",structure:e.products,id_to_detach:e.id2detach,broadcast:!0===e.broadcast,loadWithFilter:e.withFilter,callback:function(){!0===e.withFilter&&(C.isAuthoring()?(x.displayNotification({msg:t.filterInAuthoring,eventID:"warning"}),s.disableFilterWaiting()):!0!==e.fromProxy?require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("DefineFilter");t&&(t.begin(),s._filterPanelOpen=!0)}):!0===e.fromProxy&&(s._filterRootIds=Object.getOwnPropertyNames(e.products),s._filterPanelOpen=!0)),n()}})})});d.name="AddRoots",l.push(d)}if(e.filters){var c=require("DS/PADUtils/PADUtilsServices"),u=Object.getOwnPropertyNames(e.filters);u.length&&Promise.all(l).then(function(){var t=new Promise(function(t){Promise.all(a).then(function(n){for(var o=[],i=0;i<u.length;i++)o.push({envId:c.getPlatformId(),serviceId:"3DSpace",objectId:u[i],objectType:"ENOStrRefinementSpecification"});s.addFilter({filter_objects:o,multipleFilters:e.multipleFilters,broadcast:!1,callback:function(e){if(!0!==P.getSetting("removeDetachRoot")&&e.id2detach){for(var o=[],i=0;i<n.length;i++)-1!==e.id2detach.indexOf(n[i])&&o.push(n[i]);s.detachRoots({pids:o})}e.failure&&e.failure.length>0&&s.endBlockingTransaction(),t()}})})});t.name="AddFilters",l.push(t)})}Promise.all(l).then(function(){n()})})},openSearchedObjects:function(e){var n=this;return new Promise(function(i){function s(o){!0===e.withFilter&&(C.isAuthoring()?(x.displayNotification({msg:t.noFilterOnAuthoring,eventID:"warning"}),n.disableFilterWaiting()):!0!==e.fromProxy&&require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("DefineFilter");t&&t.begin()})),i(o)}var r=o.extend({notifPerObjects:!0,displayNotif:!1,callback:function(o){if(0===o.authorized_objects.length){var i={error:"noAuthObj"};!0===o.unsupportedDropNotified&&(x.displayNotification({msg:t.no_authorized_object,eventID:"error",key:"enxNav-openSearchedObjects-unsupported-drop"}),i.what="unsupportedDropNotified"),s(i)}else{var r=e.behavior?e.behavior:"WITH_CONTEXT";if(o.authorizedWithKind){if(o.authorizedWithKind.Product&&o.authorizedWithKind.Product.length>0){var a={content:"3DXContent",authorized_objects:o.authorizedWithKind.Product,callback:s,behavior:r,isDrop:!0,broadcast:!1};e.withFilter&&(a.loadWithFilter=!0),n.add(a)}o.authorizedWithKind.Filter&&o.authorizedWithKind.Filter.length>0&&n.addFilter({content:"3DXContent",filter_objects:o.authorizedWithKind.Filter,callback:s,behavior:void 0,broadcast:!1})}}},version:"2.0"},e);w.retrieveAuthorizedObjects(r)})},openDroppedObjects:function(e){var n=this;return new Promise(function(i){var s=require("DS/PADUtils/PADUtilsServices");function r(t){var o=I.getModelEvents();e.isOpenFromFiltersPage?o.publish({event:"ENXViews/WelcomePanel/closeLandingPage"}):0===n.options.model.getRoots().length&&0===n.options.model.getDetachedRoots().length?o.publish({event:"ENXViews/WelcomePanel/activate"}):o.publish({event:"ENXViews/WelcomePanel/closeLandingPage"}),i(t)}if("FILTER"===e.behavior)require(["DS/ApplicationFrame/CommandsManager"],function(t){var n=t.getCommand("FilterDropObjects");n?(e.fromWP=!0,n.execute(e.unserializedData,e)):console.error("XNavComponent## FilterDropObjects command is undefined"),i(n?void 0:{error:"noCommandAvailable"})});else{var a=o.extend({notifPerObjects:!0,displayNotif:!1,callback:function(i){if(0===i.authorized_objects.length){var a={error:"noAuthObj"};!0===i.unsupportedDropNotified&&(x.displayNotification({msg:t.invalidDropOperation,eventID:"error",key:"enxNav-openDroppedObjects-unsupported-drop"}),a.what="unsupportedDropNotified"),r(a)}else{var l=e.behavior?e.behavior:"WITH_CONTEXT",d=n.options.model.getRoots(),c=!!o.is(e.broadcast,"boolean")&&e.broadcast;s.multiTenantMgt(i.authorized_objects,d,function(e){if(e.isMultiTenant)e.isMultiTenant&&e.invalidTenant&&r({error:"invaidTenant"});else{var t=[];i.authorizedWithKind?(i.authorizedWithKind.Product&&i.authorizedWithKind.Product.length>0&&t.push(new Promise(function(e){n.add({content:"3DXContent",authorized_objects:i.authorizedWithKind.Product,callback:e,behavior:l,isDrop:!0,broadcast:c,biProxyCtx:i.source_data.biProxyCtx})})),i.authorizedWithKind.Filter&&i.authorizedWithKind.Filter.length>0&&Promise.all(t).then(function(){t.push(new Promise(function(e){n.addFilter({content:"3DXContent",filter_objects:i.authorizedWithKind.Filter,callback:e,behavior:"fromDrop",broadcast:c})}))}),i.authorizedWithKind.Change&&i.authorizedWithKind.Change.length>0&&Promise.all(t).then(function(){t.push(new Promise(function(e){P.getSetting("expandv2")?n.loadChangeV2?n.loadChangeV2({content:"3DXContent",objects:i.authorizedWithKind.Change,callback:e,behavior:l,broadcast:c}):e({}):n.loadChange?n.loadChange({content:"3DXContent",objects:i.authorizedWithKind.Change,callback:e,behavior:l,broadcast:c}):e({})}))}),i.authorizedWithKind.DesignEnv&&i.authorizedWithKind.DesignEnv.length>0&&Promise.all(t).then(function(){t.push(new Promise(function(e){I.publish({event:"ENXModel/DesignEnv/add",data:{designEnv:i.authorizedWithKind.DesignEnv,resolve:e}})}))})):t.push(new Promise(function(e){n.add({content:"3DXContent",authorized_objects:i.authorized_objects,callback:e,behavior:l,broadcast:c,biProxyCtx:i.source_data.biProxyCtx})})),Promise.all(t).then(r)}})}},version:"2.0"},e);w.retrieveAuthorizedObjects(a)}})},add:function(e){var n=e||{},i=[],s=[],r=[];switch(e.content){case"idslist":i=(n=e).pids;break;case"pathslist":for(var a=0;a<e.paths.length;a++){var l=e.paths[a][0];-1===i.indexOf(l)&&i.push(l)}break;case"3DXContent":(n=function(e){var t={pids:[],is3DContent:void 0!==e.initLoad&&e.initLoad},n=e.behavior?e.behavior:"WITH_CONTEXT";e.isDrop&&e.isDrop&&(t.skipDrop=!1);for(var i=[],s=[],r=[],a=0;a<e.authorized_objects.length;a++){var l=e.authorized_objects[a];i.push(l.objectId),"fromx3dContentId"===n&&Array.isArray(l.path)&&k(s,l.path),"WITH_CONTEXT"===n&&(o.is(l.path,"array")||(n="WITHOUT_CONTEXT")),"WITH_CONTEXT"===n&&s.push(l.path.map(function(e){return e.resourceid})),"FILTER"===n&&Array.isArray(l.path)&&k(s,l.path),l.folderId&&-1===r.indexOf(l.folderId)&&r.push(l.folderId)}"fromx3dContentId"===n&&(t.paths=s);if("WITH_CONTEXT"===n){t.paths=s;for(var d=0;d<t.paths.length;d++)t.pids.push(t.paths[d][0])}else t.pids=i;t.broadcast=!o.is(e.broadcast,"boolean")||e.broadcast,r.length&&(t.folderIds=r);return t}(e)).callback=e.callback,i=n.pids;break;case"structure":(n=function(e){var t={pids:[],paths:[],id_to_detach:e.id_to_detach,broadcast:e.broadcast},n=e.structure,o=[],i=function(e,n){var s,r=Object.keys(e),a=r.length;for(s=0;s<a;s++){let a=r[s],g=e[a],f="string"==typeof g;var l,d=Object.keys(g),c=d.length;if(0===c||f){var u;(u=void 0===n?[]:n.slice()).push(r[s]);var p=u.join(",");-1===o.indexOf(p)&&(o.push(p),t.paths.push(u))}else for(l=0;l<c;l++){var h;(h=void 0===n?[]:n.slice()).push(r[s]),i(e[r[s]],h)}}};return i(n),t}(e)).callback=e.callback;for(var d=0;d<n.paths.length;d++){var c=n.paths[d][0];-1===i.indexOf(c)&&i.push(c)}if(0===n.paths.length&&0===n.pids.length)return void(n.callback&&n.callback());break;case"filters":var u=!1,p=-1;if(void 0===n.pids&&(n.pids=[]),e.rootsWithFilters&&e.rootsWithFilters.length>0){for(var h=0;h<e.rootsWithFilters.length;h++){var g=e.rootsWithFilters[h].rootId,f=e.rootsWithFilters[h].filterId,v=e.rootsWithFilters[h].filterName;if(-1!==i.indexOf(g)){u=!0,p=h;break}i.push(g),n.pids.push(g),f&&-1===s.indexOf(f)&&s.push(f),v&&-1===r.indexOf(v)&&r.push(v)}u&&-1!==p&&e.rootsWithFilters.splice(p)}!0===u&&x.displayNotification({msg:t.filterMultipleSameRoot,eventID:"warning"}),n.rootsWithFilters=e.rootsWithFilters,n.callback=e.callback;break;default:throw new Error("Not supported content")}!0===e.loadWithFilter&&!0!==this._wait4Filter&&(this.disableUX(),n.loadWithFilter=!0,this._wait4Filter=!0,this._filterRootIds=i,this._filterPanelOpen=!0);var m=this;n.rootIds=i,n.filterIds=s,n.filterNames=r,n.behavior=!0===e.dropOnFilter?"fromDropOnFilter":n.behavior;var b=y.getPromises(),_=b.slice(),D=new Promise(function(t,o){Promise.all(_).then(function(){var o=Promise.resolve({rootsWithFilter:void 0,objectsWithoutFilterDrop:n});e.biProxyCtx&&(o=m._checkIfFilterAvailable(n,e.biProxyCtx)),o.then(function(e){m.addInProgressFlag=!0;var n=[],o=!1;e.rootsWithFilter&&(n.push(m._addDroppedRootsWithFilter(e.rootsWithFilter)),o=!0),e.objectsWithoutFilterDrop&&(n.push(new Promise(function(t){m._internalAdd(e.objectsWithoutFilterDrop,t)})),o=!0),Promise.all(n).then(function(){!1===o&&!0===m._wait4Filter&&(m.enableUX(),m._wait4Filter=!1),m.addInProgressFlag=!1,I.publish({event:"ENXModel/Root/AllAdded"}),t()}),m.dropInvitContainer&&m.dropInvitContainer.hide(),I.publish({event:"DS/ENXDropInvite/displayEmptyInvite",data:!0})})})});D.name="add",b.push(D)},_internalAdd:function(e,t){var i=this;a.mask(this.elements.container);var s=e.callback,r=function(t,n){if(!1!==t.broadcast){var o={pids_hidden:t.id_to_detach},s=!0;if(!0===e.loadWithFilter&&!1===C.isAuthoring()&&n.alreadyLoadedRoots&&n.alreadyLoadedRoots.length&&(o.loadWithFilter=!0,t.rootIds.length===n.alreadyLoadedRoots.length)){for(var r=!0,a=0;a<t.rootIds.length&&r;a++)-1===n.alreadyLoadedRoots.indexOf(t.rootIds[a])&&(r=!1);!0===r&&(s=!1)}if(!0===s){t.rootsWithFilters&&!0!==o.loadWithFilter?o.rootsWithFilters=t.rootsWithFilters:t.paths?o.paths=t.paths:o.pids=t.pids;var l=require("DS/PADUtils/PADUtilsServices");if(o.tenant=l.getPlatformId(),t.is3DContent)return;t.loadWithFilter&&(o.loadWithFilter=!0),i._commandProxy.drop(o)}}},l=function(t){i.options.model.prepareBroadcastSelect();var n=e.paths;if(!o.is(e.paths,"array")){n=[];for(var s=0;s<e.rootIds.length;s++)n.push([e.rootIds[s]])}i.options.model.pushBroadcastSelect()};function d(n){"graphview"===i.options.active_view&&i.options.views.graphview&&(i.options.views.graphview.reframeOn(),i.options.views.graphview.reframeAll()),i.dropInvitContainer&&(0===i.options.model.getRoots(void 0).length&&0===i.options.model.getDetachedRoots().length?i.dropInvitContainer.show("drop"):i.dropInvitContainer.hide());let a=!1;0===i.options.model.getRoots(void 0).length&&(a=!0),I.publish({event:"DS/ENXDropInvite/displayEmptyInvite",data:a}),o.is(s,"function")&&("error"==n?s(n):s.call(null,e.rootsWithFilters?e.rootsWithFilters:null,n)),r(e,n),l(e),t()}function c(){!0!==e.noNotif&&x.displayNotification({eventID:"success",msg:n.addRootSuccessNotif})}var u=!0,p=!!o.is(e.folderIds,"array");if(o.is(e.paths,"array")){if(p&&1===e.paths.length){for(var h=[],g=0;g<e.paths.length;g++)e.paths[g].length>1&&h.push(e.paths[g]);h.length||(u=!1)}if(u){var f=!0;for(g=0;g<e.paths.length&&f;g++)e.paths[g].length>1&&(f=!1)}}if(o.is(e.paths,"array")&&u&&!1===f&&e.paths.length){a.unmask(i.elements.container);var v=this.options.model.getRoots(),m=[];v&&v.length>0&&v.forEach(function(e){e.options.isRootAttached&&m.push(e.options.resourceid)}),this.options.model.addPaths({paths:e.paths,callback:function(t,n){if(t.success)o.is(e.id_to_detach,"array")&&e.id_to_detach.length>0&&e.id_to_detach.forEach(function(e){var t=i.options.model.searchRootById(e);o.is(t)&&i.toggleRoot({context:t})}),i.dispatchEvent("onAddPaths",{addedPaths:e.paths}),c();else if(o.is(t.idleRootIds,"array")){var s=[];if(t.idleRootIds.forEach(function(e){-1===m.indexOf(e)&&s.push(e)}),s.length>0){var r={};r.pids=s,i._onRemoveRoot(r),m.length>0&&m.filter(function(e){return this.indexOf(e)<0},s);var a=i.getWidgetTitle();i.options.widget.setTitle(a)}}d(n)}})}else this.options.model.add({pids:e.rootIds,rootsWithFilters:e.rootsWithFilters,callback:function(t){if(o.is(e.id_to_detach,"array")&&e.id_to_detach.length>0&&e.id_to_detach.forEach(function(e){var t=i.options.model.searchRootById(e);o.is(t)&&i.toggleRoot({context:t})}),o.is(e.paths,"array")){var n=i.options.model;n.insertBranches(e.paths,{onComplete:function(){if(n.prepareBroadcastSelect(),n.pushBroadcastSelect(),"graphview"===i.options.active_view&&i.options.views.graphview.reframeOn(),0===e.paths.length){for(var t=[],o=0;o<e.rootIds.length;o++)t.push([e.rootIds[o]]);e.paths=t}i.dispatchEvent("onAddPaths",{addedPaths:e.paths})}})}else{if(!0===i.options.layout.withWelcomePanel){if(t&&"error"!==t)if(e.filterIds.length>0)t&&t.alreadyLoadedRoots&&0===t.alreadyLoadedRoots.length&&i.dispatchEvent("onAddFilters",{filterIds:e.filterIds,rootIds:e.rootIds,filterNames:e.filterNames});else{for(var s=[],r=0;r<e.rootIds.length;r++)s.push([e.rootIds[r]]);i.dispatchEvent("onAddPaths",{addedPaths:s})}}else{for(s=[],r=0;r<e.rootIds.length;r++)s.push([e.rootIds[r]]);i.dispatchEvent("onAddPaths",{addedPaths:s})}"error"!==t&&c()}a.unmask(i.elements.container),d(t)}})},empty:function(e,t,n){var o=this,i=[],s=!1!==e;if(!0===t){o.options.model.getRoots().forEach(function(e){i.push(e.getID())}),I.publish({event:"ENXViews/WelcomePanel/removeFromStored",data:{item2remove:i,noDispatch:n}})}else{var r=y.getPromises(),a=r.slice(),l=new Promise(function(e,t){Promise.all(a).then(function(t){var n=o.options.model;n&&n.unselectAll(),!0===s&&o._commandProxy.cleanAll(),n&&(n.getRoots(!0).forEach(function(e){i.push(e)}),n.getDetachedRoots().forEach(function(e){i.push(e)}),n.wrapInTransaction(function(){n.withTransactionUpdate(function(){i.forEach(function(e){I.publish({event:"ENXModel/Root/remove",data:{all:!0}})})})}),n._pagerview&&(n._pagerview.hide(),n._pagerview=null),o.options.views.treelistview&&!0!==o.options.views.treelistview.getManager().isColumnHidden("bi_color")&&o.options.views.treelistview.getManager().hideColumn("bi_color"),o.options.widget.getValue("saved_filter_ids")&&o.options.widget.setValue("saved_filter_ids","[]"),e())})});l.name="empty",r.push(l)}},toggleView:function(e){var t=e;if("treeview"===e&&(e=this.options.layout.amdTreeView),e!==this.options.active_view){var n=this;this.loader.loadView(e,function(){if(n.options.views[n.options.active_view].unsetModel(),n.options.active_view=e,n.options.model.applyActiveView(n.options.active_view),n.options.views[n.options.active_view].setModel(n.options.model),"graphview"===n.options.active_view){if(n.options.views.graphview.reframeOn(),!0===n.options.loadGraphSection){if(!0!==n.options.configuration.toolbarActivated){var o=n.elements.actionbar.options.xnav_ab.onActionBarReady(function(){n.elements.actionbar.options.xnav_ab._modelEvents.unsubscribe(o),n.elements.actionbar.options.xnav_ab.goToNthSection(n.elements.actionbar.options.xnav_ab.getSectionID("XSCViews")),require("DS/ApplicationFrame/CommandsManager").getCommand(t).begin()});n.elements.actionbar.options.xnav_ab.loadModel({merge:!0,file:"GraphViewAB.xml",module:"ENXNav"})}n.options.graphABLoaded=!0}}else if(!0===n.options.loadGraphSection&&!0===n.options.graphABLoaded){if(!0!==n.options.configuration.toolbarActivated){var i=n.elements.actionbar.options.xnav_ab.onActionBarReady(function(){n.elements.actionbar.options.xnav_ab._modelEvents.unsubscribe(i),n.elements.actionbar.options.xnav_ab.goToNthSection(n.elements.actionbar.options.xnav_ab.getSectionID("XSCViews")),require("DS/ApplicationFrame/CommandsManager").getCommand(t).begin()});n.elements.actionbar.options.xnav_ab.loadModel(n.options.action_bar_opts)}n.options.graphABLoaded=!1}n.dispatchEvent("onToggleView",n.options.active_view),I.publish({event:"ENXModel/toggleView",data:{view:n.options.active_view}})})}},beginBlockingTransaction:function(e){a.mask(this.elements.container,e)},endBlockingTransaction:function(){a.unmask(this.elements.container)},onResize:function(){this.options.model.invalidateViewPort(),"graphview"===this.options.active_view&&this.options.views.graphview.setSize(),this.dispatchEvent("onParentResize")},getPADTreeDocument:function(){return this.options.model},getRoots:function(){return this.options.model.getRoots()},getPADDGVView:function(){return this.options.views.datagridview},getPADTreeListView:function(){return console.warn("getPADTreeListView Deprecated: use getPADDGVView instead"),this.getPADDGVView()},getProxy:function(){return this._commandProxy},getSelectedNodes:function(){return this.options.model.getSelectedNodes()},getMainHTMLClass:function(){return".xnav_body"},applyFilter:function(e){"2.0"===this.options.model.version?this.applyFilterV2(e):this.applyFilterV1(e)},applyFilterV1:function(e){this.enableUX();var t=this;!0===this._wait4Filter&&(this._wait4Filter=!1),this._filterPanelOpen=!1;var n=o.clone(e,!0),i=this.options.model.getRoots(),s=!1;t.options.ordering=t.options.ordering?t.options.ordering:[],null!==e&&!1===e.empty&&(s=!0,0===t.options.ordering.length&&i.forEach(function(e){var n=e.getID();-1===t.options.ordering.indexOf(n)&&t.options.ordering.push(n)}));var r,a=[];if(null===e)for(e={},r=0;r<i.length;r++)a.push(i[r].getID());else e.root_physicalid&&a.push(e.root_physicalid);!0===e.hideChildren?this.options.model._hideChildrenFilter=!0:delete this.options.model._hideChildrenFilter;var l=!1,d=P.getSetting("activateDGV");if(void 0!==e.filterRootIds){t=this;this.options.model.withTransactionUpdate(function(){for(r=0;r<e.filterRootIds.length;r++){var n=t.options.model.searchRootById(e.filterRootIds[r]);if(n)if(!0===e.empty){if(delete n.options.filtered,n.options.CVQuery=null,n.options.sequence_filter=null,n.options.config_filter=null,!0===d){if(n.options.icons&&n.options.icons.length)(c=o.clone(n.options.icons[0])).badges={bottomRight:null},n.updateOptions({icons:[c]})}else n.setBadges({bottomRight:""});var i=n.getState();n.setState({state:"partiallyExpanded"}),n.options.padstate="partiallyExpanded",n.childComputed=!1,"collapsed"===i?n.options.children=[]:(n.processDescendants({processNode:function(){if(!0!==this.isRelationsObjectNode){var e=this.getState();this.setState({state:"partiallyExpanded"}),this.options.padstate="partiallyExpanded",null===this.options.children&&(this.options.children=[]),this.childComputed=!1,"collapsed"===e&&(this.options.children=[])}}}),null===n.options.children&&(n.options.children=[])),I.publish({event:"ENXModel/SyncModel",data:{what:"applyFilter"}})}else{if(l=!0,n.options.filtered=!0,n.options.CVQuery=e.CVQuery,e.CVQuery&&e.CVQuery.union&&e.CVQuery.union.expand)for(var s=0;s<e.CVQuery.union.expand.length;s++){var a=e.CVQuery.union.expand[s].root_path_physicalid;1===a.length&&-1!==a[0].indexOf(n.getID())&&(n.options.sequence_filter=e.CVQuery.union.expand[s].sequence_filter,n.options.config_filter=e.CVQuery.union.expand[s].config_filter)}else n.options.sequence_filter=null,n.options.config_filter=null;if(n.collapseAll(),n.removeChildren(!1),n.options.children=[],n.setState({state:"collapsed"}),n.options.padstate="collapsed",n.childComputed=!1,!0===d){var c;if(n.options.icons&&n.options.icons.length)void 0===(c=o.clone(n.options.icons[0]))&&(c={}),c.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},n.updateOptions({icons:[c]})}else{n.setBadges({bottomRight:"filter"})}}}I.publish({event:"ENXModel/UpdateAdditionalColumns",data:{nodesToUpdate:{pids:e.filterRootIds},treedocument:t.options.model}})})}else console.warn("xNavComponent: No filterRootIds properties");l&&!0===P.getSetting("expandAllwithApplyFilter")&&(!0===P.getSetting("structureAppearCollapseAfterApplyFilter")&&(e.structCollapse=!0),e.tagFilterCase=s,this.options.model.applyFilter(e)),!0!==e.doNotBroacast&&this._commandProxy.applyFilter(n)},applyFilterV2:function(e){var t,n=this,i=o.clone(e,!0);!0===this._wait4Filter&&(this._wait4Filter=!1),this.enableUX(),I.publish({event:"ENXModel/Root/AllAdded"}),this._filterPanelOpen=!1;!0===e.hideChildren?this.options.model._hideChildrenFilter=!0:delete this.options.model._hideChildrenFilter;var s=[];void 0!==e.filterRootIds?this.options.model.withTransactionUpdate(function(){for(t=0;t<e.filterRootIds.length;t++){var o=n.options.model.searchRootById(e.filterRootIds[t]);if(o)if(s.push(o),!0===e.empty){o.options.icons&&o.options.icons.length&&S.node.clearBadges(o);var i=o.getState();o.setState({state:"partiallyExpanded"}),delete o.options.filtered,o.options.childComputed=!1,"collapsed"===i?o.options.children=[]:(o.processDescendants({processNode:function(){if(!0!==this.isRelationsObjectNode){var e=this.getState();this.setState({state:"partiallyExpanded"}),this.options.padstate="partiallyExpanded",null!==this.options.children&&void 0!==this.options.children||(this.options.children=[]),this.options.childComputed=!1,"collapsed"===e&&(this.options.children=[])}}}),null===o.options.children&&(o.options.children=[]))}else{o.options.filtered=!0,o.collapseAll(),o.removeChildren(!1);let e=n.options.model.getXSO(),t=e.get().filter(function(e){return!e.getTreeDocument()});e.remove(t),o.options.children=[],o.setState({state:"collapsed"}),o.options.padstate="collapsed",o.options.childComputed=!1,o.options.icons&&o.options.icons.length&&S.node.setFilterBadge(o),U.call(n,o)}}}):console.warn("xNavComponent: No filterRootIds properties"),s.length&&(e.tagFilterCase=!1,this.options.model.isGroupingApplied()&&(this.options.model.cleanGroupingForRoots({rootIds:e.filterRootIds}),this.options.model.__applyGrouping({roots:e.roots,groups:this.options.model.options.groups,fromApplyFilter:!0})),this.options.model.expandZeroForFilterRoots({filteredRoots:s})),!0!==e.doNotBroacast&&this._commandProxy.applyFilter(i)},attachRoots:function(e){this.manageAttach(e)},detachRoots:function(e){this.manageDetach(e)},disableUX:function(){var e=this;e._disablingInProgress=!0,require(["DS/UIKIT/Modal"],function(t){!0===e._disablingInProgress&&(delete e._disablingInProgress,e.elements.container.blockUX=new t({className:"disableMainUX",closable:!1,body:"",visible:!0}),e.elements.container.blockUX.inject(document.body))})},enableUX:function(){this.elements.container.blockUX&&(this.elements.container.blockUX.destroy(),delete this.elements.container.blockUX),!0===this._disablingInProgress&&delete this._disablingInProgress},disableFilterWaiting:function(e){var t=this,n=e||{};this.enableUX(),e&&"left"===e.panel&&(!0===this._wait4Filter&&(this._wait4Filter=!1,I.publish({event:"ENXModel/Root/AllAdded"}),!0===this._filterPanelOpen&&(this._filterPanelOpen=!1,this.confirmModal=new u({callback:function(e){if(!1===t.confirmModal.cancelModal.fromProxy){!1===e&&t._onRemoveRoot({pids:t._filterRootIds});var n={widget:"2D",result:e};t._commandProxy.filterCancel(n)}}}))),this._commandProxy.disableFilterWaiting(n))},togglePanel:function(e,t){this.options.views.treelistview&&this.options.views.treelistview.padModalElement&&this.options.views.treelistview.padModalElement.close(),(this.elements.padshell?this.elements.padshell:this.elements.padinfo).togglePanel(e,t)},openPanel:function(e){this.elements.padshell.openPanel(e)},destroy:function(){var e=require("DS/PADUtils/PADUtilsServices");this._commandProxy.padDestroy({widgetId:e.getWidgetId()}),this._commandProxy.destroy(),this.options.model._commandProxy&&this.options.model._commandProxy.destroy(),this.options.model._cmdProxy&&this.options.model._cmdProxy.destroy()},_dispatchReady:function(e){this._dispatchReady_NotDone&&!0===this.options.isReady.model&&!0===this.options.isReady.actionbar&&!0===this.options.isReady[this.options.active_view]&&(this.dispatchEvent.call(this,"onReady",{addInView:e}),this._probes.probe_init.end(),this._dispatchReady_NotDone=!1)},displayNotification:function(e){require(["DS/PADUtils/views/PADAlert"],function(t){t.displayNotification(e)})},_initialize_failure:function(e){var t=this;require(["DS/ENXNav/views/xNavInitError"],function(o){var i=n.initialization_error;t.elements.bigerror=new o({msg:i}),t._just_error_content(),t.displayNotification({title:n.initialization_errorTitle,msg:i,eventID:"error",key:"enxNav-initialisation-error"}),e()})},_just_error_content:function(){this.elements.bigerror&&this.elements.container.setContent(this.elements.bigerror)},getCurrentView:function(){return this.options.active_view},updateCurrentView:function(){this.options.views[this.options.active_view].updateView()},getPropertiesFacet:function(){return this.options.layout.propertiesFacet?this.options.layout.propertiesFacet:[]},isPartiallyExpanded:function(e,t){var n=!1;if("partiallyExpanded"===e.getState())n=!0;else{var o=e.getRoot();if(o.options._filterInfo&&o.options._filterInfo!=={})n=!0;else if(void 0!==o.options.sequence_filter||void 0!==o.options.config_filter)n=!0;else if(o.options._childrenFilterInfo){var i=o.options._childrenFilterInfo.filteredOutChildren;i&&i.length>0&&(n=!0)}}t&&t(n)},updateAttributesDelayed:function(e){var t=this,n=l.debounce(function(e){var n=e.displayNodesArray;if(void 0===n&&e&&e.collectionView&&e.collectionView.model){var o=e.collectionView;n=void 0!==e.startNodeIndex&&void 0!==e.endNodeIndex?o.model.slice(e.startNodeIndex,e.endNodeIndex+1):o.model}if(n.length){for(var i=[],s=0;s<n.length;s++)n[s]._canBeGrouped()&&i.push(n[s]);t.options.additionalColumnsModules&&t.options.additionalColumnsModules.length&&t.options.model.fillAttributesAsync4VisibleNodes(i,void 0,e.context),t.colorMap&&t.options.model.updateColorForNodes(i,t.colorMap,t.predicateKind);let o=t.getPADDGVView().getColumnViewsForUpdate();o&&t.options.model.updateSpecificColumnViews(i,o,e.context);for(var r=require("DS/PADUtils/PADPredicatesNls"),a=0,l=i.length;a<l;a++)!0!==i[a]._manageNLS&&!0!==i[a].options.ensureNLS||r.updateNLS(i[a])}},200);"OnResize"!==e.context&&n(e)},getWidgetTitle:function(){var e=require("DS/PADUtils/PADUtilsServices"),n=e.getPlatformId(),o=e.getTenantsPreference(),i=this.getRoots(),s="";if(0===i.length)s="";else if(1===i.length){s=i[0].getLabel(),o.length>1&&(s+=" - "+n)}else s=i.length+t.multi_root_tile,o.length>1&&(s+=" - "+n);return s},_checkGraphCmdAvailability:function(){var e=this.options.model.getAllDescendants().length,t=require("DS/ApplicationFrame/CommandsManager"),n=P.getSetting("maxNodesInGraph")?P.getSetting("maxNodesInGraph"):3e3,o=t.getCommand("graphview");if(o)if(e>n){if("graphview"===this.options.active_view)t.getCommand("treeview").begin();o.disable()}else o.enable()},_onRemoveRoot:function(e){var t=this,n=y.getPromises(),o=n.slice(),i=new Promise(function(n,i){Promise.all(o).then(function(o){e.pids.forEach(function(e){t.removeRootFromFilterProxy({rootId2remove:e})}),I.publish({event:"ENXModel/Root/remove",data:{pids:e.pids,noDispatch:!0}}),0===t.options.model.getRoots().length&&t.dispatchEvent("onEmptyView"),t.getOption("layout").store_roots_in_pref&&t.dispatchEvent("onDeleteRoots",{str_removeIds:JSON.stringify(e.pids),fromWLSync:e.fromWLSync}),t._checkGraphCmdAvailability(),n()})});return i.name="removeroot",n.push(i),!1},isToolbarActivated:function(){return this.options.configuration.toolbarActivated},getToolbar:function(){return this.options.toolbar},isDynamicCtx:function(){return this.options.configuration.dynamicCtxActivated},getDynamicCtxDef:function(){return new Promise(function(e){require(["text!"+this.options.configuration.ctxMenuOpts.definition],function(t){var n=JSON.parse(t);e(n.ctxMenu)})}.bind(this))},onShow:function(e){this._commandProxy.show(e);var t=this.options.model,n=[];t.withTransactionUpdate(function(){for(var o=0;o<e.paths.length;o++){var i=t.getNodeByOccurencePath(e.paths[o]);if(i){i.updateOptions({isPADHidden:!1}),n=n.concat(i)}}}.bind(t)),I.publish({event:"ENXModel/hideShowState",target:n,data:{toggle:"show"}}),I.publish({event:"ENXModel/HideShowTriggered",data:{name:"show"}})},onHide:function(e){this._commandProxy.hide(e);var t=this.options.model,n=[];t._doNotBroadcastSelect=!0,t.insertBranches(e.paths,{node_state:"collapsed",forceCollapsed:!0,novalidation:!0,onComplete:function(){t.withTransactionUpdate(function(){e.paths.forEach(function(e){var o=t.getNodeByOccurencePath(e);if(o){o.updateOptions({isPADHidden:!0}),n=n.concat(o)}})})}}),t._doNotBroadcastSelect=!1,I.publish({event:"ENXModel/hideShowState",target:n,data:{toggle:"hide"}}),I.publish({event:"ENXModel/HideShowTriggered",data:{name:"hide"}})}})});