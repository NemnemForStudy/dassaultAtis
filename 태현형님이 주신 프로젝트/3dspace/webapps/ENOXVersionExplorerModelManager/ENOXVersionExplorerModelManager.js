define("DS/ENOXVersionExplorerModelManager/ModelManagerP",["DS/ENOXVersionExplorerModelWebServices/ModelWebServicesP","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/WebappsUtils/WebappsUtils","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS"],function(e,t,n,i,r){"use strict";return e.extend({_onCompleteLoadVersions:function(e,t){var n=this;setTimeout(function(){!0!==t&&(n._loadBranchFilters(),n._loadPersonInfo(),n._loadThumbnailsAsync(),n._trackInitAction())},100)},getNewVersionName:function(){var e;if(this.isLoaded()&&this.getNumberOfNodes()>0){var t=this._nodeList[0];t instanceof n&&(e=r.version+(this.getNumberOfNodes()+1).toString()+"_"+t.options.grid.title)}return e},_createVersionData:function(e,n,r){var o=this.__proto__._createVersionData.call(this,e,n,r),s=t.getHistoryCustomAttribute(e);if(this.mainBranchRoot||(this.mainBranchRoot=r.find(function(e){return!Array.isArray(e.ancestors)||Array.isArray(e.ancestors)&&0===e.ancestors.length})),o.conx&&o.conx.length||(o.data.position=0),s){if(o.data.custom_node_color="string"==typeof s.node_color&&s.node_color.length?s.node_color:"",Array.isArray(o.conx)&&o.conx.length){var a,c=o.conx.filter(function(e){return!("E"==e.semantic||"I"==e.semantic)});if(o.conx&&1===c.length&&s&&"true"===s.setAsTree&&(a=s.position,!isNaN(a)))c[0].semantic="I",o.data.position=a,o.data.redrawFlag=!0,c[0].reference=this.mainBranchRoot.id,c[0].mergeBetweenRoots=!0,c[0].mergeLeft=!0,"string"==typeof s.icon&&s.icon.length&&(c[0].icon=i.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+s.icon),"string"==typeof s.line_color&&s.line_color.length&&(c[0].custom_line_color=s.line_color);else for(var l=0,d=o.conx.length;l<d;l++){var h=o.conx[l];"I"!==h.semantic&&"string"==typeof s.line_color&&s.line_color.length?h.custom_line_color=s.line_color:h.redrawFlag=!0,"string"==typeof s.icon&&s.icon.length&&(h.icon=i.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+s.icon)}}}else o.data.custom_node_color="";return o}})}),define("DS/ENOXVersionExplorerModelManager/ModelManagerHistory",["UWA/Core","DS/ENOXVersionExplorerModelWebServices/ModelWebServicesHistory","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/WebappsUtils/WebappsUtils","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/SemanticRelationships"],function(e,t,n,i,r,o){"use strict";return t.extend({_processVersions:function(e,t){var n,i=this;return n=i[(t&&i.itemID&&(i.itemID===t||i.searchByID(t).length)||e.nodes.findIndex(function(e){return e.id===i.itemID}),"_loadTree")](e),i.itemID=t,n},_getVersionArray:function(e){for(var t=e.nodes.length>1?e.nodes.sort(function(e,t){return e.nId-t.nId}):e.nodes,n=e.connections,i=0,r=n.length;i<r;i++){var o=n[i],s=t[o.src-1],a=t[o.trg-1],c=o.typ;a.ancestor={historySemantic:c,id:s.id}}return t.sort(function(e,t){return new Date(e.originated).getTime()-new Date(t.originated).getTime()})},_loadPersonInfo:function(){for(var t=0,n=this._nodeList.length;t<n;t++){var i=this._nodeList[t],r=i.options.grid.description,o=i.options.grid.owner,s=i.options.grid.reservedby;if("string"==typeof r&&r.length){var a={};if(i.options.eStrings&&(a=i.options.eStrings),!0===a[r]){var c=e.String.unescapeHTML(r);i.setAttribute("description",c)}}"string"==typeof o&&o.length?i.setAttribute("ownerName",o):o||i.setAttribute("ownerName",null),"string"==typeof s&&s.length?i.setAttribute("reservedbyName",s):s||i.setAttribute("reservedbyName",null)}},_createVersionData:function(t,s,a){var c=r.getHistoryCustomAttribute(t),l=[],d={},h={title:"",thumbnail:""};for(var f in t)switch(f){case"displayName":var p=t[f];h.title=e.String.escapeHTML(p),p.length!==h.title.length&&(d[h.title]=!0);break;case"currentUntranslated":var u=t[f];h.maturity=u,h.currentUntranslated=u;break;case"current":var g=t[f];h.maturity_nls=g,h.current=g;break;case"ancestor":if(t.ancestor){var m={semantic:i.historySemantics[t.ancestor.historySemantic].symbol,id:t.ancestor.id,icon:o.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+(c&&c.icon?c.icon:i.historySemantics[t.ancestor.historySemantic].icon),historySemantic:t.ancestor.historySemantic};c&&"string"==typeof c.line_color&&c.line_color.length&&(m.custom_line_color=c.line_color),l.push(m),t.ancestor.historySemantic.contains("From")&&"string"==typeof t.revisedFrom&&t.revisedFrom&&a.find(function(e){return e.id===t.revisedFrom})&&l.push({semantic:"I",id:t.revisedFrom,historySemantic:t.ancestor.historySemantic})}break;case"originated":h.creationDate=new Date(t[f]);break;case"modified":h.modified=new Date(t[f]);break;case"revision":h.code=t[f];break;case"thumbnail":case"icon":h[f]=t[f].length&&t[f].indexOf("http")<0?n.get3DSpaceBaseUrl(this.getTenantId())+t[f]:t[f];break;default:if("string"==typeof(p=t[f]))if(p.endsWith("Z")&&!isNaN(Date.parse(p)))h[f]=new Date(p);else{var v=e.String.escapeHTML(p);h[f]=v,p.length!==v.length&&(d[v]=!0)}else h[f]=p}return h.custom_node_color=c&&"string"==typeof c.node_color&&c.node_color.length?c.node_color:"",{data:h,conx:l,eStrings:d}}})}),define("DS/ENOXVersionExplorerModelManager/ModelManagerRDF",["UWA/Promise","DS/ENOXVersionExplorerModelWebServices/ModelWebServicesRDF","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/SemanticRelationships"],function(e,t,n,i,r,o,s){"use strict";return t.extend({_createVersionData:function(e,t,i){var o,s={},a={title:"",thumbnail:""};for(var c in e)switch(c){case"label":var l=e[c];a.title=UWA.String.escapeHTML(l),l.length!==a.title.length&&(s[a.title]=!0);break;case"semanticInfo":if(e.semanticInfo.member&&e.semanticInfo.member.length&&(o=e.semanticInfo.member.map(function(e){return{semantic:r.getSemanticSymbol(e.semantic),id:e.toVersion["@id"]}})).filter(function(e){return"I"!==r.getSemanticSymbol(e.semantic)}).length>1)throw Error("_createVersionData: Version "+e.id+"has more than one non-integrate connections");break;case"@id":a.id=e[c];break;case"creationDate":a[c]=new Date(a[c]);break;case"modificationDate":a.modified=new Date(a[c]);break;case"thumbnail":case"icon":a[c]=e[c].length&&e[c].indexOf("http")<0?n.get3DSpaceBaseUrl(this.getTenantId())+e[c]:e[c];break;default:if("string"==typeof(l=e[c]))if(l.endsWith("Z")&&!isNaN(Date.parse(l)))a[c]=new Date(l);else{var d=UWA.String.escapeHTML(l);a[c]=d,l.length!==d.length&&(s[d]=!0)}else a[c]=l}return a.code="",{data:a,conx:o,eStrings:s}},_getItemID:function(e){return e["@id"]},_getVersionArray:function(e){return e.versions.member},_onCompleteLoadVersions:function(e){},createNewVersionPromise:function(t){if(!t||"string"!=typeof t.title||!t.title.length)throw Error("createNewVersion: Title cannot be null");if(!t||"string"!=typeof t.parentid||!t.parentid.length)throw Error("createNewVersion: Title cannot be null");var n=this;return new e(function(e,i){n.addVersionPromise(t).then(function(r){n._onNewVersionCreated(t,r,e,i)},i)})},_onNewVersionCreated:function(e,t,n,i){var r=this;r.getVersionsFromVersion(r.itemID).then(function(e){r._processVersions(e);var t=r._nodeList[r._nodeList.length-1];n(t),r._onCompleteLoadVersions(t.options.id)})},getNewVersionName:function(){var e;if(this.isLoaded()&&this.getNumberOfNodes()>0){var t=this._nodeList[0];t instanceof i&&(e=o.version+(this.getNumberOfNodes()+1).toString()+"_"+t.options.grid.title)}return e},getLegend:function(){return s.P_PRIME},_processVersions:function(e){var t=!1;return e.versions&&(this.itemID===this._getItemID(e)?t=this._updateTree.bind(this)(e):(this.itemID=this._getItemID(e),this._loadTree.bind(this)(e),t=!0)),t}})}),define("DS/ENOXVersionExplorerModelManager/ModelManagerBase",["UWA/Core","UWA/Promise","DS/ENOXVersionExplorerModel/VersionTreeDocumentModel","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/Tree/TreeDocument","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/ENOXVersionExplorerUtils/ArrayFunctions","DS/WebappsUtils/WebappsUtils","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/ScaleRanges"],function(e,t,n,i,r,o,s,a,c,l,d,h,f){"use strict";var p=e.Class.extend({_manager:null,pollingInterval:void 0,init:function(e){this._previous&&this._previous(e)},setManager:function(t){if(!(this instanceof n))throw Error("ModelManagerBase.setManager: ModelManagerBase can only extend a VersionTreeDocument");this._manager=t,this._iconCache||(this._iconCache={}),e.Class.implement.call(this,new(p.extend(t)))},_processVersions:function(e){var t=!1;if(((e=Array.isArray(e.graphs)&&e.graphs.length&&e.graphs[0]?e.graphs[0]:e).items||e.item)&&e.versions){var n=!1;Array.isArray(e.items)?(n=this._checkIfItemsPreviouslyLoaded(e.items),this.items=e.items):e.item&&(n=this._checkIfItemsPreviouslyLoaded([e.item]),this.items=[e.item]),t=this[n?"_updateTree":"_loadTree"].bind(this)(e),t=!0}return t},_getVersionArray:function(e){for(var t=0;t<e.versions.length;t++)Array.isArray(e.versions[t].contents)&&1==e.versions[t].contents.length&&Object.keys(e.versions[t].contents[0]).map(function(n){"description"===n&&(e.versions[t]["PLMReference.V_versionComment"]=e.versions[t].description),"id"!==n&&"creation"!==n&&"modification"!==n&&(e.versions[t][n]=e.versions[t].contents[0][n])});return e.versions},_loadThumbnailsAsync:function(){var e=this;if(!e._thumbnailsLoaded&&(s.UserSettings.displayMode===a.DISPLAY_MODES.THUMBNAIL_VIEW||s.UserSettings.displayMode!==a.DISPLAY_MODES.THUMBNAIL_VIEW&&!0===e._isThumbnailsForListView)){for(const n in e._iconCache){if(r=e._iconCache[n]){var t=e._nodeList.find(function(e){return n===e.options.id});t&&t.setAttribute("thumbnail",r)}}for(var n=[],i=0;i<e._nodeList.length;i++){var r,o=e._nodeList[i].options.id;(r=e._iconCache[o])||n.push(o)}if(0!=n.length){e.getVersionsFromVersion(n,[],!0).then(function(t){var n=[];t.graphs?t.graphs.length>0&&(n=e._getVersionArray(t.graphs[0])):n=e._getVersionArray(t);for(var i=0;i<n.length;i++){var r=e._nodeList.find(function(e){return n[i].id===e.options.id});if(!e._iconCache[n[i].id]&&(n[i].thumbnail&&(e._iconCache[n[i].id]=n[i].thumbnail),r)){var o=n[i].thumbnail;r.setAttribute("thumbnail",o)}}})}}},_checkIfItemsPreviouslyLoaded:function(e){return!!Array.isArray(this.items)&&l.intersectionDifference(this.items,e,function(e,t){return null!=t.id&&null!=e.id&&t.id===e.id||null!=t.vid&&null!=e.vid&&t.vid===e.vid||null!=t.mid&&null!=e.mid&&t.mid===e.mid})[0].intersection.length>0},loadVersionModelPromise:function(e){this.trackerEventBeginTime=Date.now();var n=this,i=e.id;return this._bLoadThumbnail="boolean"!=typeof e.loadThumbnail||e.loadThumbnail,"string"==typeof e.tenantId&&e.tenantId.length&&n.setTenantId(e.tenantId),"string"==typeof e.serviceId&&e.serviceId.length?n.setServiceId(e.serviceId):n.setServiceId("3DSpace"),"string"==typeof e.securityContext&&e.securityContext.length&&n.setSecurityContext(e.securityContext),new t(function(t,o){n instanceof r||o("ModelManager.createVersionModel: 'this' must be an instance of TreeDocument"),"string"==typeof i&&i.length?n.getVersionsFromVersion(c.getSanitizedID(i),Array.isArray(e.attributeList)&&e.attributeList.length?e.attributeList:void 0).then(function(r){t(n._processVersions(r,i)),n._onCompleteLoadVersions(i,e.contextualMenu)},o):"object"==typeof i?(t(n._processVersions(i)),n._onCompleteLoadVersions(i,e.contextualMenu)):o("loadVersionModel: Input should be object or string")})},createNewVersionPromise:function(e,n,i){if(!e||"string"!=typeof e.title||!e.title.length)throw Error("createNewVersion: Title cannot be null");if(!e||"string"!=typeof e.parentid||!e.parentid.length)throw Error("createNewVersion: Title cannot be null");var r=this;return this._bLoadThumbnail="boolean"!=typeof e.loadThumbnail||e.loadThumbnail,new t(function(t,n){var i=[c.getSanitizedID(e.parentid)],o=[e.title!==r.searchByID(e.parentid)[0].options.label?e.title:void 0];r.reviseAsMajor({physIds:i,titles:o}).then(function(i){r._onNewVersionCreated(e,i,t,n)},n)})},_getNewVersionID:function(e,t){var n,i=e.results,r=i.find(function(e){return t.parentid===e["attribute[PLMReference.V_DerivedFrom]"]});return(r=r||i[0])&&(n=r.physicalid),n},_onNewVersionCreated:function(e,t,n,i){var r=this,o=("boolean"!=typeof e.loadThumbnail||e.loadThumbnail,r._getNewVersionID(t,e));"string"==typeof o&&o.length&&(e.description&&e.description.length?r.getUpdateNameAndDescriptionPromise({id:o,attributes:[{key:"description",value:e.description},{key:"V_description",value:e.description}]}).then(function(){r.getVersionsFromVersion(o).then(function(e){r._processVersions(e);var t=r._nodeList.find(function(e){return e.options.id===o});n(t),r._onCompleteLoadVersions(o)})},i):r.getVersionsFromVersion(o).then(function(e){r._processVersions(e);var t=r._nodeList.find(function(e){return e.options.id===o});n(t),r._onCompleteLoadVersions(o)}))},getNewVersionName:function(){throw Error("getNewVersionName: no implement")},_onCompleteLoadVersions:function(e,t){var n=this;setTimeout(function(){!0!==t&&(n._loadBranchFilters(),n._loadPersonInfo(),!0===n._bLoadThumbnail&&s.POLL_UPDATE_THUMBNAIL&&n._loadThumbnailAndTitle(e),n._trackInitAction())},100)},getLegend:function(e){},_loadBranchFilters:function(){var e=this;if(e.filterHash&&(!e.filterHash||0!=Object.keys(e.filterHash).length)){var t=[],n=[];Object.keys(e.filterHash).map(function(t){e.filterHash[t]&&n.push(t)}),t.push(e.getBranchFilterPromise(n));var i={branchFilterRequests:[]};t.length&&Promise.all(t).then(function(e){e.length>0&&!e[0].errorID&&(i=e[0])}).catch(function(e){}).finally(function(t){i.branchFilterRequests.forEach(function(t){if(e.filterHash[t.id]){var n=void 0;t.snapshot?"string"!=typeof t.snapshot&&(n=t.snapshot.filter):t.filter&&(n=t.filter),n&&(e.filterHash[t.id].filterQuery={filter:n,filterTitle:void 0})}});for(var n=0,r=e._nodeList.length;n<r;n++){var o=e._nodeList[n];o.options.grid.id;if(o.options.ancestors){var s=o.options.ancestors.find(function(e){return e.hasExpand});if(s){var a=e.filterHash[s.filterid];a&&a.filterQuery&&(s.filterQuery=a.filterQuery)}}}})}},_loadPersonInfo:function(){for(var t=this,n=[],i=this.personInfo=this.personInfo||{},r=0,o=t._nodeList.length;r<o;r++){var s=t._nodeList[r],a=s.options.grid.description,c=s.options.grid.owner,l=s.options.grid.reservedby;if("string"==typeof c&&c.length&&!i.hasOwnProperty(c)?(n.push(t.getPersonInfoPromise(c)),i[c]=void 0):"string"==typeof c&&c.length&&i[c]&&s.options.grid.ownerName!==i[c].firstname+" "+i[c].lastname?s.setAttribute("ownerName",i[c].firstname+" "+i[c].lastname):c||s.setAttribute("ownerName",null),"string"==typeof l&&l.length&&!i.hasOwnProperty(l)?(n.push(t.getPersonInfoPromise(l)),i[l]=void 0):"string"==typeof l&&l.length&&i[l]&&s.options.grid.reservedbyName!==i[l].firstname+" "+i[l].lastname?s.setAttribute("reservedbyName",i[l].firstname+" "+i[l].lastname):l||s.setAttribute("reservedbyName",null),"string"==typeof a&&a.length){var d={};if(s.options.eStrings&&(d=s.options.eStrings),!0===d[a]){var h=e.String.unescapeHTML(a);s.setAttribute("description",h)}}}n.length&&Promise.all(n).then(function(e){for(var n=0,r=e.length;n<r;n++)e&&e[n]&&e[n].name&&(i[e[n].name]=e[n]);for(var o=0,s=t._nodeList.length;o<s;o++){var a=t._nodeList[o],c=a.options.grid.owner,l=a.options.grid.reservedby;"string"==typeof c&&c.length&&i[c]&&a.options.grid.ownerName!==i[c].firstname+" "+i[c].lastname&&a.setAttribute("ownerName",i[c].firstname+" "+i[c].lastname),"string"==typeof l&&l.length&&i[l]&&a.options.grid.reservedbyName!==i[l].firstname+" "+i[l].lastname&&a.setAttribute("reservedbyName",i[l].firstname+" "+i[l].lastname)}})},_loadThumbnailAndTitle:function(e){var t,n=this,r=4,s=0;function a(){var c=[],l=n._branchArray.reduce(function(e,t){return Array.isArray(t.nodeList)&&t.nodeList.length&&t.nodeList[0]instanceof i&&e.push(n.getVersionFamilyData(t.nodeList[0].options.id)),e},[]);Promise.all(l).then(function(i){for(var l=0,d=i.length;l<d;l++)i[l]&&Array.isArray(i[l].data)&&i[l].data.length&&(c=c.concat(i[l].data));!function(i){var c=i.length;t=!1;for(var l=0;l<c;l++){var d=i[l],h=n._nodeList.find(function(e){return d.id===e.options.id});if(h){d.modified&&new Date(d.modified);var f=d.modified3DShape?new Date(d.modified3DShape):void 0,p=d.thumbnailModified?new Date(d.thumbnailModified):void 0,u=!0===d.isAssembly;-1===d.thumbnail.indexOf("http")?(d.thumbnail=o.get3DSpaceBaseUrl(n.getTenantId())+d.thumbnail,h.setAttribute("_mask",!0),t=!0,h.options.repmoddate=f,h.options.thumbnaildate=p):f&&p&&f-p>0?(h.setAttribute("_mask",!0),t=!0):u&&e===h.options.id?h.options.thumbnaildate&&p&&p-h.options.thumbnaildate<=0?(h.setAttribute("_mask",!0),t=!0):(h.setAttribute("_mask",!1),h.options.repmoddate=f,h.options.thumbnaildate=p):(h.options.repmoddate=f,h.options.thumbnaildate=p,h.setAttribute("_mask",!1)),h.options.grid.thumbnail!==d.thumbnail&&h.setAttribute("thumbnail",d.thumbnail),h.options.grid.title!==d.displayName&&h.setAttribute("title",d.displayName)}}if((s>=r||!t)&&void 0!==n.pollingInterval){clearInterval(n.pollingInterval),n.pollingInterval=void 0;for(var l=0,c=n._nodeList.length;l<c;l++){var h=n._nodeList[l];!0===h.options.grid._mask&&h.setAttribute("_mask",!1)}}else t&&void 0===n.pollingInterval&&(n.pollingInterval=setInterval(function(){a(),s++},3e4))}(c)})}"undefined"!==n.pollingInterval&&(clearInterval(n.pollingInterval),n.pollingInterval=void 0),a()},_getPreContextualMenuPromise:function(e,n,i){return new t(function(t,n){t(e)})},_loadTree:function(e){var t=this,n={},i={},r={},o={},s=[],a=void 0;t.prepareAddDelete(),t.empty();for(var l=this._createNodeArray.bind(t)(e,!0),d=0;d<l.length;d++){var h=l[d],f=h._getID();if(i[f]=h,!Array.isArray(h.options.ancestors)||!h.options.ancestors.length||Array.isArray(h.options.ancestors)&&1===h.options.ancestors.length&&!0===h.options.ancestors[0].mergeBetweenRoots?null==o[f]&&(o[f]=!0,s.push(f)):void 0===h.options.copyFrom&&(a=f),Array.isArray(h.options.ancestors)&&h.options.ancestors.length)for(var p=h.options.ancestors,u=0,g=p.length;u<g;u++){var m=p[u].id;if(t._isMinorRevision(h)){var v=t._getPreviousMinorRevision(h);v&&(m=v.id)}var _=r[m],y=p[u].semantic;void 0===_&&(r[m]=[]),"I"!==y.toUpperCase()&&r[m].indexOf(f)<0&&r[m].push(f)}}function b(e){var o=[];for(o.push(e);o.length>0;){var s=o;o=[];for(var a=0;a<s.length;a++){var l=s[a];if(!n[l.options.grid.id]){n[l.options.grid.id]=!0;var d=l._getID();if(Array.isArray(l.options.ancestors)&&l.options.ancestors.length)for(var h=l.options.ancestors,f=0,p=h.length;f<p;f++)"I"===c.getSemanticSymbol(h[f].semantic.toUpperCase())&&t.addMerge(h[f].id,l,h[f]);var u=r[d];if(void 0!==u)for(var g=0;g<u.length;g++){var m=u[g],v=i[m],_=null;if(v.options.ancestors.find(function(e){return"E"===e.semantic.toUpperCase()}))_=0;else 0===l.getNumberOfChildren()&&v.options.ancestors.find(function(e){return"I"!==e.semantic.toUpperCase()&&"MI"!==e.semantic.toUpperCase()})&&(_=1);t.addChildNode(v,_,l,void 0,void 0,!0),o.push(v)}}}}}0==s.length&&a&&s.push(a);for(var D=0;D<s.length;D++){var S=s[D],I=i[S];t.addChildNode(I),b(I)}return t._isLoaded=!0,t.pushAddDelete(),!0},_updateTree:function(e){var t,n,r,o=!1,s=this,a=s._nodeList;if(r=s._createNodeArray.bind(s)(e),n=(t=l.intersectionDifference(r,a,function(e,t){return e.options.id===t.options.id&&e.options.grid.redrawFlag===t.options.grid.redrawFlag})[1].difference).length,s.prepareAddDelete(),n>0)for(o=!0;g=t.shift();){if(a.indexOf(g)>=0){var d,h=g.getParent();Array.isArray(g.options.ancestors)&&g.options.ancestors.length?(g.options.ancestors.find(function(e){return"E"===e.semantic.toUpperCase()})&&h.getNumberOfChildren()>0&&s.addChildNode(new i,0,h,!0),s.removeChildNode(g),1===h.getNumberOfChildren()&&(d=h.getNthChild(0)).isEmpty()&&h.removeChild(d)):s.removeChildNode(g)}Array.isArray(g.options.ancestors)&&g.options.ancestors.filter(function(e){return"I"===e.semantic}).forEach(function(e){s.removeMerge(e.id,g)}),s._mergeConnections.filter(function(e){return e.parent===g}).forEach(function(e){s.removeMerge(g,e.child)})}var f,p=l.intersectionDifference(r,a,function(e,t){var n=e.options.id===t.options.id;if(n){if(e.options.ancestors&&e.options.ancestors.length&&t.options.ancestors&&t.options.ancestors.length){var i=e.options.ancestors.filter(function(e){return"I"===e.semantic}),r=t.options.ancestors.filter(function(e){return"I"===e.semantic});if(i.length||r.length){var a=l.intersectionDifference(i,r,function(e,t){return e.id===t.id&&e.redrawFlag===t.redrawFlag}),d=a[0].difference,h=a[1].difference;(d.length||h.length)&&(h.length&&h.forEach(function(e){s.removeMerge(e.id,t)}),d.length&&d.forEach(function(e){s.addMerge(c.getSanitizedID(e.id),t,e)}),o=!0)}}o|=t.refreshNodeData(e)}return n})[0].difference;if(f=p.length){o=!0;for(var u=-1;f>0;f=p.length){var g;if(g=p[u+=1])if(Array.isArray(g.options.ancestors)&&g.options.ancestors.findIndex(function(e){return!0===e.mergeBetweenRoots})<0)for(var m=0;m<g.options.ancestors.length;m++){var v=g.options.ancestors[m];if("I"!==c.getSemanticSymbol(v.semantic.toUpperCase())){if(h=s._nodeList.find(function(e){return v.id===e.options.id})){var _=null,y=h.getNumberOfChildren();"E"===c.getSemanticSymbol(v.semantic.toUpperCase())?_=0:0===y&&(_=1),s.addChildNode(p.splice(p.indexOf(g),1)[0],_,h),u=-1}}else s.addMerge(v.id,g,v)}else s.addChildNode(p.splice(p.indexOf(g),1)[0],r.findIndex(function(e){return e===g})),Array.isArray(g.options.ancestors)&&1===g.options.ancestors.length&&!0===g.options.ancestors[0].mergeBetweenRoots&&s.addMerge(g.options.ancestors[0].id,g,g.options.ancestors[0]),u=-1;else p.splice(p.indexOf(g),1)}}return o?s.pushAddDelete():s.cancelAddDelete(),o},_createNodeArray:function(e,t){var n=this,i=this._getVersionArray(e);n.objectHash={},n.linkHash={},n.filterHash&&1!=t||(n.filterHash={});for(var r=0;r<i.length;r++){var o=i[r],s=null!=o.id?o.id:o["@id"];if(n.objectHash[s]=o,n.linkHash[s]||(n.linkHash[s]={ancestorId:null,childId:null}),Array.isArray(o.ancestors)&&o.ancestors.length){if("E"===(m=o.ancestors[0]).semantic.toUpperCase()){var a=m.id;void 0===n.linkHash[a]&&(n.linkHash[a]={ancestorId:null,childId:null}),n.linkHash[a].childId=s,n.linkHash[s].ancestorId=a}n.filterHash&&1==m.hasExpand&&1==t&&n.filterHash&&(n.filterHash[m.filterid]={id:s,ancestorid:m.id,filterQuery:void 0})}}function c(e,t,r,o,s,a,l){t&&(void 0===l[t.id]&&(l[t.id]=!0,e.push(n._newVersionTreeNode.bind(n)(t,r,i)),r++,a[t.id].ancestorId&&c(e,s[a[t.id].ancestorId],r,o,s,a,l)))}for(var l=[],d={},h=Object.entries(n.linkHash).filter(e=>null===e[1].childId),f=0,p=0;p<h.length;p++){var u=h[p][0],g=n.objectHash[u];if(l.push(n._newVersionTreeNode.bind(n)(g,f,i)),f++,n.linkHash[u].ancestorId){var m;a=n.linkHash[u].ancestorId;c(l,m=n.objectHash[a],f,n,n.objectHash,n.linkHash,d)}}return l.sort(function(e,t){return e.options.creationDate.getTime()-t.options.creationDate.getTime()}),l},_newVersionTreeNode:function(e,t,n){var r=this._createVersionData(e,t,n);return new i(c.getSanitizedID(r.data.id),r.data,r.data.creationDate,r.data.fakeDate,this.getServiceId(),r.data.copyFrom,this.getSecurityContext(),r.conx,r.eStrings,!0,this.type)},_isMinorRevision:function(e){return e&&e.minororder>0&&e.secondaries},_getPreviousMinorRevision:function(e){var t=e.options&&e.options.grid?e.options.grid:e;if(t.secondaries&&t.secondaries[0].id!=t.majorid){var n=this.objectHash[t.secondaries[0].id];if(void 0!==n)return n}},_createVersionData:function(t,n,i){this._isMinorRevision(t)&&(null==this._getPreviousMinorRevision(t)?(t.isFirstMinor=!0,t.ancestors=[{semantic:"S",id:t.copyFrom,isMinorBranch:!0}]):t.ancestors=[{semantic:"MI",id:t.secondaries?t.secondaries[0].id:t.copyFrom}]);var r,s={},a={title:"",thumbnail:""};for(var l in t)switch(l){case"label":var h=t[l];a.title=e.String.escapeHTML(h),h.length!==a.title.length&&(s[a.title]=!0);break;case"ancestors":if(Array.isArray(t.ancestors)&&t.ancestors.length){r=[];for(var p=0,u=t.ancestors.length;p<u;p++){var g=t.ancestors[p],m=this.objectHash[g.id];if(m){var v=void 0;"S"===g.semantic||"PS"===g.semantic?t.copyFrom&&t.copyFrom!==g.id&&this._isMinorRevision(this.objectHash[t.copyFrom])&&(g.id=t.copyFrom):"E"===g.semantic&&!this._isMinorRevision(t)&&this._isMinorRevision(m)&&(v=this.objectHash[m.majorid]);var _=t.isFirstMinor?c.getSemanticIcon("MI"):c.getSemanticIcon(g.semantic),y={semantic:c.getSemanticSymbol(g.semantic),id:c.getSanitizedID(v?v.id:g.id),icon:d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+_,fid:v?v.fid:g.fid,filterid:v?v.filterid:g.filterid,hasExpand:v?v.hasExpand:g.hasExpand,title:v?v.title:g.title};if(r.push(y),v)r.push({semantic:"I",id:t.copyFrom,icon:d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+c.getSemanticIcon("E")});else if("E"===g.semantic&&t.copyFrom&&t.copyFrom!==g.id&&this.objectHash[t.copyFrom]){_=this._isMinorRevision(this.objectHash[t.copyFrom])?c.getSemanticIcon("E"):c.getSemanticIcon("I");i.findIndex(function(e){return e.id===t.copyFrom})>=0?r.push({semantic:"I",id:t.copyFrom,icon:d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+_}):(y.icon=d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+c.getSemanticIcon("I"),y.dontHighlightLink=!0)}}}}break;case"creation":case"creation date":a.creationDate=new Date(t[l]);var b,D=this.linkHash[t.id].childId;if(b=D?this.objectHash[D]:void 0){var S=b.fakeDate?b.fakeDate:b[l];t[l]>S?(a.fakeDate=new Date(Date.parse(S)-1),t.fakeDate=a.fakeDate.toISOString()):a.fakeDate=new Date(t[l])}else a.fakeDate=new Date(t[l]);break;case"modification":a.modified=new Date(t[l]);break;case"thumbnail":var I=t[l].length&&t[l].indexOf("://")>=0?t[l]:"";a[l]=I;break;case"icon":a[l]=t[l].length&&t[l].indexOf("://")>=0?t[l]:"",0==a[l].length&&(a[l]=o.get3DSpaceBaseUrl(this.getTenantId())+"/snresources/images/icons/large/"+t.icon+"108x144.png");break;case"LPAbstractReference.V_Scale":case"LPAbstractRepReference.V_Scale":switch(t[l]){case 1:a[l]=f.normalRange;break;case 2:a[l]=f.largeRange;break;case 3:a[l]=f.extraLargeRange;break;case 4:a[l]=f.smallRange;break;case 5:a[l]=f.extraSmallRange;break;case 6:a[l]=f.nanometricRange;break;default:a[l]=t[l]}break;default:if("string"==typeof(h=t[l]))if(h.endsWith("Z")&&!isNaN(Date.parse(h)))a[l]=new Date(h);else{var N=e.String.escapeHTML(h);a[l]=N,h.length!==N.length&&(s[N]=!0)}else a[l]=h}return t.code&&(a.code=t.code),null==t.reservedby&&(a.reservedby=null),{data:a,conx:r,eStrings:s}},_trackInitAction:function(e){try{let t=1,n=this._nodeList.length,i={UXName:"Revisions",numberObjects:t,typeObjects:this.type,pv16:n};e&&e.showDuplicatesIsChecked&&(i.pv17=1),this.trackerEventBeginTime&&(i.actionTime=Date.now()-this.trackerEventBeginTime,delete this.trackerEventBeginTime),this.initActionEvent=h.createInitActionEvent(i,this.initActionEvent),h.checkAndTrackPageEvent(this.initActionEvent)}catch(e){console.log("trackInitAction error: "+e)}}});return p}),define("DS/ENOXVersionExplorerModelManager/ModelManagerHistory2",["DS/ENOXVersionExplorerModelWebServices/ModelWebServicesHistory2","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/WebappsUtils/WebappsUtils","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/SemanticRelationships"],function(e,t,n,i,r){"use strict";return e.extend({_onCompleteLoadVersions:function(e,t){var n=this;setTimeout(function(){!0!==t&&(n._loadBranchFilters(),n._loadPersonInfo(),n._loadThumbnailsAsync(),n._trackInitAction({showDuplicatesIsChecked:!0}))},100)},_createVersionData:function(e,t,r){(e.copyFrom&&!e.ancestors||Array.isArray(e.ancestors)&&!e.ancestors.length)&&r.findIndex(function(t){return t.id===e.copyFrom})>=0&&(this.__proto__._isMinorRevision.call(this,e)||(e.ancestors=[{semantic:"SO",id:e.copyFrom}]));var o=this.__proto__._createVersionData.call(this,e,t,r),s=n.getHistoryCustomAttribute(e);if(this.mainBranchRoot||(this.mainBranchRoot=r.find(function(e){return!Array.isArray(e.ancestors)||Array.isArray(e.ancestors)&&0===e.ancestors.length})),o.conx&&o.conx.length||(o.data.position=0),s){if(o.data.custom_node_color="string"==typeof s.node_color&&s.node_color.length?s.node_color:"",Array.isArray(o.conx)&&o.conx.length){var a,c=o.conx.filter(function(e){return!("E"==e.semantic||"I"==e.semantic)});if(o.conx&&1===c.length&&s&&"true"===s.setAsTree&&(a=s.position,!isNaN(a)))c[0].semantic="I",o.data.position=a,o.data.redrawFlag=!0,c[0].reference=this.mainBranchRoot.id,c[0].mergeBetweenRoots=!0,c[0].mergeLeft=!0,"string"==typeof s.icon&&s.icon.length&&(c[0].icon=i.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+s.icon),"string"==typeof s.line_color&&s.line_color.length&&(c[0].custom_line_color=s.line_color);else for(var l=0,d=o.conx.length;l<d;l++){var h=o.conx[l];"I"!==h.semantic&&"string"==typeof s.line_color&&s.line_color.length?h.custom_line_color=s.line_color:h.redrawFlag=!0,"string"==typeof s.icon&&s.icon.length&&(h.icon=i.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+s.icon)}}}else o.data.custom_node_color="";return o},_createNodeArray:function(e,t){for(var n=this.__proto__._createNodeArray.call(this,e,t),i=[],r=0,o=n.length;r<o;r++)isNaN(n[r].options.grid.position)||(i.push(n.splice(r,1)[0]),o-=1,r-=1);return i.length&&i.sort(function(e,t){return e.options.grid.position-t.options.grid.position}),n=i.concat(n)},getNewVersionName:function(){var e;if(this.isLoaded()&&this.getNumberOfNodes()>0){var n=this._nodeList[0];n instanceof t&&(e=r.version+(this.getNumberOfNodes()+1).toString()+"_"+n.options.grid.title)}return e},_updateMerges:function(){var e=this;if(void 0!==this.mainBranchRoot){var n=e.searchByID(this.mainBranchRoot.id)[0];this._mergeConnections.forEach(function(i,r,o){i.mergeBetweenRoots&&(i.reference=i.reference instanceof t?i.reference:e.searchByID(i.reference)[0],i.referenceBranch=i.reference.__BRANCH__,!i.child instanceof t&&(i.child=e.searchByID(i.child)[0]),i.child instanceof t&&i.child.processDescendants({async:!1,onlyVisibleNodes:!0,processNode:function(r){var o=r.nodeModel;e._mergeConnections.filter(function(e){return e.child===o}).forEach(function(r){r.parent instanceof t||(r.parent=e.searchByID(r.parent)[0]),r.parent instanceof t&&n.isAscendantOf(r.parent)&&(r.mergeLeft=!0,r.referenceBranch=i.referenceBranch)})}}))}),this.__proto__._updateMerges.call(this)}},empty:function(){this.__proto__.empty.call(this),this.mainBranchRoot=void 0}})});