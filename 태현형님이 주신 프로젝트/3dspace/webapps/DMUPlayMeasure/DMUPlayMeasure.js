define("DS/DMUPlayMeasure/DMUMeasureImport",["UWA/Class","DS/DMUMeasurable/DMUMeasurable","DS/DMUBaseExperience/EXPUtils"],function(e,t,i){"use strict";return e.extend({init:function(e){this.importData=function(n,r,a){if(n&&r&&e){r.fillObjectAttributes(e,n,a);for(var o=n.measurables.length,s=0;s<o;s++){var l=new t({},!0).importData(n.measurables[s],i.strToType);e.setMeasurable(s+1,l)}r.registerForPostImport(e)}},this.afterImport=function(){e&&e.fireEvent("onDMUObjectInitialized",{dmuObject:e})}}})}),define("DS/DMUPlayMeasure/DMUMeasureMainValueDisplayUtils",["i18n!DS/DMUPlayMeasure/assets/nls/DMUPlayMeasure"],function(e){"use strict";var t=e.yes,i=e.no,n={MeasureTypes:{Coordinates:{name:"Coordinates",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:1},Line_Length:{name:"Line_Length",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:1},Curve_Length:{name:"Curve_Length",defaultMainValueDisplay:t,defaultUnitDisplay:t,isDisplayedInPref:1},Arc_Length:{name:"Arc_Length",defaultMainValueDisplay:t,defaultUnitDisplay:t,isDisplayedInPref:1},Cylinder_Length:{name:"Cylinder_Length",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:0},Cone_Length:{name:"Cone_Length",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:0},Distance:{name:"Distance",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:1},Min_Distance:{name:"Min_Distance",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:1},Max_Distance:{name:"Max_Distance",defaultMainValueDisplay:t,defaultUnitDisplay:t,isDisplayedInPref:1},Angle:{name:"Angle",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:1},Angle_Btw2Selections:{name:"Angle_Btw2Selections",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:0},Angle_By3Pts:{name:"Angle_By3Pts",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:0},Cone_Angle:{name:"Cone_Angle",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:0},Half_Angle:{name:"Half_Angle",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:1},Radius:{name:"Radius",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:1},Cylinder_Radius:{name:"Cylinder_Radius",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:0},Sphere_Radius:{name:"Sphere_Radius",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:0},Min_Radius:{name:"Min_Radius",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:1},Max_Radius:{name:"Max_Radius",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:1},Radius_By3Pts:{name:"Radius_By3Pts",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:0},Diameter:{name:"Diameter",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:1},Cylinder_Diameter:{name:"Cylinder_Diameter",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:0},Sphere_Diameter:{name:"Sphere_Diameter",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:0},Min_Diameter:{name:"Min_Diameter",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:1},Max_Diameter:{name:"Max_Diameter",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:1},Area:{name:"Area",defaultMainValueDisplay:t,defaultUnitDisplay:t,isDisplayedInPref:1},Diameter_By3Pts:{name:"Diameter_By3Pts",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:0},Surface_Area:{name:"Surface_Area",defaultMainValueDisplay:t,defaultUnitDisplay:t,isDisplayedInPref:0},PlanarSurface_Area:{name:"PlanarSurface_Area",defaultMainValueDisplay:t,defaultUnitDisplay:t,isDisplayedInPref:0},Product_Area:{name:"Product_Area",defaultMainValueDisplay:t,defaultUnitDisplay:t,isDisplayedInPref:0},Volume:{name:"Volume",defaultMainValueDisplay:t,defaultUnitDisplay:t,isDisplayedInPref:1},Thickness:{name:"Thickness",defaultMainValueDisplay:i,defaultUnitDisplay:t,isDisplayedInPref:1}},isPrefEnabled:function(e){return!0===e||e===t},getPrefVal:function(e){var n=t;return this.isPrefEnabled(e)||(n=i),n}};return Object.freeze(n)}),define("DS/DMUPlayMeasure/DMUMeasureNode3D",["UWA/Core","DS/DMUMeasurable/DMUMeasureEnums","DS/DMUBaseUI/DMUManipulableNode3D","DS/DMUBaseUI/DMUToolsLeader","DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/DMUMeasurable/DMUMathsFiniteGeometry","DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUToolsAvatars","DS/DMUBaseUIControllers/DMUWebPreferencesController","DS/DMUBaseExperience/EXPUtils","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/Manipulators/PlaneTranslationManipulator","DS/Manipulators/LineTranslationManipulator","DS/Manipulators/RotationManipulator","DS/SceneGraphNodes/ArrowNode","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/DMUMarkerVisu/DMUMarkerVisuMeasureShapeNode","DS/DMUBaseExperience/EXPToolsVisualization","DS/Selection/CSOManager","DS/Selection/PSOManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsMaterial","DS/Mesh/Mesh","DS/DMUMeasurable/DMUMeshMeasure","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUBaseUIServices/DMUObjectsServices","i18n!DS/DMUPlayMeasure/assets/nls/DMUPlayMeasure"],function(e,t,i,n,r,a,o,s,l,u,c,p,d,g,h,b,y,m,v,P,A,f,M,D,S,w,T,_,C,R,L,x,E){"use strict";return i.extend({init:function(i){this._parent(i);var V,N,k,I,F,O,U,B,z,G,H,J,q,X,W,Z,j,Y,Q,K,$,ee,te,ie,ne,re,ae,oe,se,le,ue,ce,pe,de,ge,he,be,ye,me,ve,Pe=this.getViewer(),Ae=i.owner.getAttribute("cLineStyleColor"),fe=i.owner.getAttribute("cFillStyleColor"),Me=new d.Color(16753920),De=10*window.devicePixelRatio,Se=!1,we=!1,Te=!1,_e=i.owner.getAttribute("iExtensionLinesManipulable"),Ce=function(){Te=!(!i.owner.getAttribute("bShortDisplay")||i.owner.getAttribute("bDisplayUnit"))};Ce();var Re={};Re.regularSolidLine=_.retrieveMaterialFromGAS({color:Ae,lineWidth:window.devicePixelRatio,pattern:C.LinePatternEnum.SOLID}),Re.regularDashedLine=_.retrieveMaterialFromGAS({color:Ae,lineWidth:window.devicePixelRatio,pattern:C.LinePatternEnum.DASHED}),Re.avatarSolidLine=_.retrieveMaterialFromGAS({color:fe,lineWidth:window.devicePixelRatio,pattern:C.LinePatternEnum.SOLID}),Re.avatarDashedLine=_.retrieveMaterialFromGAS({color:Ae,lineWidth:window.devicePixelRatio,pattern:C.LinePatternEnum.DASHED}),Re.avatarDottedLine=_.retrieveMaterialFromGAS({color:Ae,lineWidth:window.devicePixelRatio,pattern:C.LinePatternEnum.SMALLDOTTED}),Re.dotDashedLine=_.retrieveMaterialFromGAS({color:Ae,lineWidth:window.devicePixelRatio+1,pattern:C.LinePatternEnum.DOTDASHED}),Re.dotLine=_.retrieveMaterialFromGAS({color:Ae,lineWidth:window.devicePixelRatio+1,pattern:C.LinePatternEnum.DOTTED}),Re.crossPoint=_.retrieveMaterialFromGAS({symbol:1,size:De,withoutDPR:!0,color:new d.Color(0)});var Le,xe,Ee,Ve,Ne,ke,Ie,Fe,Oe,Ue,Be,ze,Ge,He=!1,Je=T.getReviewContext({viewer:Pe}),qe=!1,Xe=!1,We=null,Ze=null,je=null,Ye=null,Qe=!0,Ke=this,$e={},et=.001,tt=1,it=String.fromCharCode(216);function nt(e,t,i,n,r,a){return void 0===e&&void 0===t&&void 0===i&&void 0===n&&void 0===r&&void 0===a?0:Math.abs(i*t-e*n+(r*n-i*a)+(e*a-r*t))/2}function rt(){var e,t=S.get()[0];if(!t)return!1;if(t.event){var n=Ke.getLabelDimensions(),r={offsetWidth:M.convertModelToPixels({sizeInMM:n.offsetWidth}),offsetHeight:M.convertModelToPixels({sizeInMM:n.offsetHeight})},a=M.getViewerPositionFromPoint(Pe,n.position),o=new d.Vector2(Math.round(a.left-r.offsetWidth/2),Math.round(a.top-r.offsetHeight/2)),s=M.get2DSnappedPosition(t.event.getCurrentPosition(Pe.canvas)),l=o.clone();l.y=l.y+n.height/(xe+1)*Le;var u=o.clone();u.y=u.y+n.height/(xe+1)*xe;var c=o.clone();c.x=c.x+n.width,c.y=c.y+n.height/(xe+1)*Le;var p=o.clone();p.x=p.x+n.width,p.y=p.y+n.height/(xe+1)*xe;var g=i.owner.getAttribute("fBoxRotationAngle");g=-g;var h=i.owner.getAttribute("vLeaderBreakPoint3D");if(g){var b=M.getWindowPositionFromPoint(Pe,h,i.frmWindow);b=new d.Vector2(b.left,b.top);var y=function(e){var t=e.clone();t.x=e.x-b.x,t.y=e.y-b.y;var i,n=(i=t,new d.Vector2(i.x*Math.cos(g)-i.y*Math.sin(g),i.x*Math.sin(g)+i.y*Math.cos(g)));return t.x=n.x+b.x,t.y=n.y+b.y,t};l=y(l),u=y(u),c=y(c),p=y(p)}var m={x1:u.x,y1:u.y,x2:l.x,y2:l.y,x3:c.x,y3:c.y,x4:p.x,y4:p.y,x:s.x,y:s.y};if(!He||i.owner.getAttribute("bShortDisplay")||nt((e=m).x1,e.y1,e.x,e.y,e.x2,e.y2)+nt(e.x2,e.y2,e.x,e.y,e.x3,e.y3)+nt(e.x3,e.y3,e.x,e.y,e.x4,e.y4)+nt(e.x4,e.y4,e.x,e.y,e.x1,e.y1)-(nt(e.x1,e.y1,e.x3,e.y3,e.x2,e.y2)+nt(e.x1,e.y1,e.x3,e.y3,e.x4,e.y4))>et)return!1}return!0}function at(e,t){t.setPickParent(!0),t.setVisibilityInTree(!1),e.addChild(t)}function ot(){Qe=i.owner.isReadOnly()||!i.owner.isEditable()||function(){var e=p.allowManipulation({object:"Section",viewer:Pe});if("boolean"==typeof e)return!e;var t=p.checkIfCommandIsRunning(Pe);if(t){var i=p.getCurrentCommand(Pe);"measureCmdHdr"!==i&&"measure3CmdHdr"!==i&&"measure2CmdHdr"!==i&&"measure2DCmdHdr"!==i||(t=!1)}return t}()}function st(e){if(!Qe){var t={pathElement:w.buildPathElement(Ke)};if(e&&e.event&&e.event.from&&e.event.from.length>0){var n=e.event.from[e.event.from.length-1].getCurrentPosition();i.owner.refreshAssistantTool&&i.owner.refreshAssistantTool({mousePosition:n},!0)}e&&e.event.from[0].event.ctrlKey?D.remove(t):D.empty(),D.add(t)}}function lt(){var e={fontStyle:{height:Ke.getPixelFontSize("fFontSize"),familyStyle:i.owner.getAttribute("sFontStyle"),familyName:i.owner.getAttribute("sFontName"),color:i.owner.getAttribute("cFontColor"),fontSize:i.owner.getAttribute("fFontSize")},fontStyleComment:{height:Ke.getPixelFontSize("fCommentFontSize"),familyStyle:i.owner.getAttribute("sCommentFontStyle"),familyName:i.owner.getAttribute("sCommentFontName"),color:i.owner.getAttribute("cFontColor")},fillStyle:{color:i.owner.getAttribute("cFillStyleColor"),opacity:i.owner.getAttribute("fOpacity")},lineStyle:{thickness:(x.getLineThickness(i.owner.getAttribute("fLineStyleThicknessIndex"))||i.owner.getAttribute("fLineStyleThickness"))*window.devicePixelRatio,pattern:i.owner.getAttribute("sLineStylePattern"),color:i.owner.getAttribute("cLineStyleColor")}},t=x.getLineThickness(i.owner.getAttribute("fLeaderStyleThicknessIndex"))||i.owner.getAttribute("fLeaderStyleThickness"),n=i.owner.getAttribute("cLeaderStyleColor"),r=i.owner.getAttribute("sLeaderStylePattern");return(void 0!==t||n||r)&&(e.leaderStyle={thickness:void 0!==t?t*window.devicePixelRatio:void 0,pattern:r,color:n}),e}function ut(e){var t="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value;return" "+E.sx+": "+c.convertUnitValueToString("Length",e.x,Je,!0,Te,t)+" "+E.sy+": "+c.convertUnitValueToString("Length",e.y,Je,!0,Te,t)+" "+E.sz+": "+c.convertUnitValueToString("Length",e.z,Je,!0,Te,t)}function ct(e){var t="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value;return" "+E.dx+": "+c.convertUnitValueToString("Length",e.x,Je,!0,Te,t)+" "+E.dy+": "+c.convertUnitValueToString("Length",e.y,Je,!0,Te,t)+" "+E.dz+": "+c.convertUnitValueToString("Length",e.z,Je,!0,Te,t)}function pt(e,t,i){var n="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,a=r.isZero(e)?0:e,o=c.convertUnitValueToString("Length",a,Je,!0,Te,n);return we&&(o=E.aproximateSymbol+o),t?o:i?E.curveLength+" "+o:E.length+" "+o}function dt(e,t,i){var n,a="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,o=r.isZero(e)?0:180*e/Math.PI,s=c.convertUnitValueToString("Angle",o,Je,!0,Te,a);return t||(n=E.angle,i&&(n=E.halfAngle)),we&&(s=E.aproximateSymbol+s),t?s:n+" "+s}function gt(e,t){var i=r.isZero(e)?0:e,n="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,a=c.convertUnitValueToString("Area",i,Je,!0,Te,n);return we&&(a=E.aproximateSymbol+a),t?a:E.area+" "+a}function ht(e,t){var i=r.isZero(e)?0:e,n="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,a=c.convertUnitValueToString("Volume",i,Je,!0,Te,n);return we&&(a=E.aproximateSymbol+a),t?a:E.volume+" "+a}function bt(e,t,i){var n,a=r.isZero(e)?0:e,o="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,s=c.convertUnitValueToString("Length",a,Je,!0,Te,o);return n=void 0===i?E.radius:i?E.maxRadius:E.minRadius,we&&(s=E.aproximateSymbol+s),t?E.symbolRadius+" "+s:n+" "+s}function yt(e,t,i){var n,a=r.isZero(e)?0:e,o="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,s=c.convertUnitValueToString("Length",a,Je,!0,Te,o);return n=void 0===i?E.diameter:i?E.maxDiameter:E.minDiameter,we&&(s=E.aproximateSymbol+s),t?it+" "+s:n+" "+s}function mt(e,t,i){var n=r.isZero(e)?0:e,a="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,o=c.convertUnitValueToString("Length",n,Je,!0,Te,a);return we&&(o=E.aproximateSymbol+o),i?o:t+" "+o}function vt(e,t){var i="",n=!1,a="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value;r.isZero(t.x)||(n=!0,i+=c.convertUnitValueToString("Length",t.x,Je,!0,!0,a),i+=E.sx),r.isZero(t.y)||(t.y>0&&!0===n&&(i+="+"),n=!0,i+=c.convertUnitValueToString("Length",t.y,Je,!0,!0,a),i+=E.sy),r.isZero(t.z)||(t.z>0&&!0===n&&(i+="+"),n=!0,i+=c.convertUnitValueToString("Length",t.z,Je,!0,!0,a),i+=E.sz);var o=-(e.x*t.x+e.y*t.y+e.z*t.z);return o>0&&!0===n&&(i+="+"),i+=c.convertUnitValueToString("Length",o,Je,!0,!0,a),i+="=0"}function Pt(e,i){var n,r=!1;switch(null==i&&(r=!0),e){case t.ResultType.POINT:case t.ResultType.CENTER:n=r?E.point:E.point+" "+E.inLabel+" "+i;break;case t.ResultType.LINE:n=r?E.line:E.line+" "+E.inLabel+" "+i;break;case t.ResultType.AXIS:n=E.infiniteline+" "+E.inLabel+" "+i;break;case t.ResultType.CIRCLE:n=r?E.circle:E.circle+" "+E.inLabel+" "+i;break;case t.ResultType.CURVE:n=r?E.curve:E.curve+" "+E.inLabel+" "+i;break;case t.ResultType.PLANE:n=E.plane+" "+E.inLabel+" "+i;break;case t.ResultType.CYLINDER:n=E.cylinder+" "+E.inLabel+" "+i;break;case t.ResultType.CONE:n=E.cone+" "+E.inLabel+" "+i;break;case t.ResultType.SPHERE:n=E.sphere+" "+E.inLabel+" "+i;break;case t.ResultType.SURFACE:n=E.surface+" "+E.inLabel+" "+i;break;case t.ResultType.PRODUCT:n=E.product+" "+i}return n}function At(e,t,n,r,a){if(e){var o="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value;Se||r.push(E.coordinates),r[r.length]=E.sx+": "+(we?E.aproximateSymbol+c.convertUnitValueToString("Length",t.x,Je,!0,Te,o):c.convertUnitValueToString("Length",t.x,Je,!0,Te,o)),r[r.length]=E.sy+": "+(we?E.aproximateSymbol+c.convertUnitValueToString("Length",t.y,Je,!0,Te,o):c.convertUnitValueToString("Length",t.y,Je,!0,Te,o)),r[r.length]=E.sz+": "+(we?E.aproximateSymbol+c.convertUnitValueToString("Length",t.z,Je,!0,Te,o):c.convertUnitValueToString("Length",t.z,Je,!0,Te,o))}else{Ee=n?E.point+" "+E.inLabel+" "+n:E.point,Ve=void 0,r[0]=E.coordinates+" "+ut(t);var s=i.owner.getAttribute("lCustomization");s&&s.length>0?(s[0].custoValue&&r.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),s[1].custoValue&&r.push(a.mode)):(r[0]=E.coordinates+" "+ut(t),r[1]=Ee.length>50?Ee.substring(0,50)+"...":Ee,r[2]=a.mode),Le=1,xe=2}}function ft(e,t,i,n,r,a){if("Volume"===e&&void 0!==t&&t>0||"Area"!==e&&void 0!==t&&t>0)a[0]=ht(t,Se);else if("Area"===e&&void 0!==i&&i>0||void 0!==i&&i>0)a[0]=gt(i,Se);else if(void 0===t&&void 0===i&&void 0!==length&&length>0)a[0]=pt(length,Se);else if(void 0!==t||void 0!==i||void 0!==length||void 0===n&&void 0===r)void 0!==t&&(a[0]=ht(t,Se));else{var o="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,s=void 0!==n;a[0]=E.sx+": "+c.convertUnitValueToString("Length",s?n.x:r.x,Je,!0,Te,o),a[1]=E.sy+": "+c.convertUnitValueToString("Length",s?n.y:r.y,Je,!0,Te,o),a[2]=E.sz+": "+c.convertUnitValueToString("Length",s?n.z:r.z,Je,!0,Te,o)}}function Mt(e,t,n,r){var a,o,s,l,u,c,p,g,h=[],b=i.owner.getAttribute("sSurfaceDisplayType");if(e)switch(b){case"MinimumRadius":s=i.owner.getAttribute("fRadius"),h[0]=bt(s,Se,!1);break;case"MinimumDiameter":l=2*i.owner.getAttribute("fRadius"),h[0]=yt(l,Se,!1);break;case"MaximumRadius":u=i.owner.getAttribute("fMaxRadius"),h[0]=bt(u,Se,!0);break;case"MaximumDiameter":c=2*i.owner.getAttribute("fMaxRadius"),h[0]=yt(c,Se,!0);break;case"Length":p=i.owner.getAttribute("fHeight"),h[0]=pt(p,Se);break;case"Area":g=i.owner.getAttribute("fArea"),h[0]=gt(g,Se);break;case"Angle":0!==t&&(h[0]=dt(2*t,Se,!1));break;default:0!==t&&(h[0]=dt(t,Se,!0))}else{Ee=E.cone+" "+E.inLabel+" "+i.owner.getAttribute("oProduct1Name"),Ve=void 0,a=n.getPoints(),(o=new d.Vector3).subVectors(a.endPoint,a.beginPoint).normalize();var y=i.owner.getAttribute("lCustomization");if(y&&y.length>0){s=i.owner.getAttribute("fRadius"),u=i.owner.getAttribute("fMaxRadius"),l=2*i.owner.getAttribute("fRadius"),c=2*i.owner.getAttribute("fMaxRadius"),p=i.owner.getAttribute("fHeight"),g=i.owner.getAttribute("fArea");var m=n.getApex(),v=E.firstpoint+" "+ut(a.beginPoint),P=E.secondpoint+" "+ut(a.endPoint),A=pt(p,!1),f=bt(s,!1,!1),M=bt(u,!1,!0),D=yt(l,!1,!1),S=yt(c,!1,!0),w=E.direction+" "+ut(o),T=dt(2*t,!1,!1),_=dt(t,!1,!0),C=E.apex+" "+ut(m),R=gt(i.owner.getAttribute("fArea")),L=E.cog+" "+ut(i.owner.getAttribute("vCog")),x=Ee.length>50?Ee.substring(0,50)+"...":Ee,V=r.mode,N=void 0;switch(b){case"MinimumRadius":h[0]=f,N=M;break;case"MinimumDiameter":h[0]=D,N=S;break;case"MaximumRadius":h[0]=M,s>0&&(N=f);break;case"MaximumDiameter":h[0]=S,l>0&&(N=D);break;case"Length":h[0]=A;break;case"Area":h[0]=R;break;case"Angle":0!==t&&(h[0]=T);break;default:0!==t&&(h[0]=_)}"Length"===b?(y[0].custoValue&&h.push(v),y[1].custoValue&&h.push(P),y[2].custoValue&&h.push(w),y[3].custoValue&&h.push(T),y[4].custoValue&&h.push(_),y[5].custoValue&&h.push(C),s>0&&y[6].custoValue&&h.push(f),y[7].custoValue&&h.push(M),l>0&&y[8].custoValue&&h.push(D),y[9].custoValue&&h.push(S),y[10].custoValue&&h.push(R),y[11].custoValue&&h.push(L),y[12].custoValue&&h.push(x),y[13].custoValue&&h.push(V)):"Area"===b?(y[0].custoValue&&h.push(L),y[1].custoValue&&h.push(x),y[2].custoValue&&h.push(V)):"MinimumRadius"===b||"MaximumRadius"===b||"MinimumDiameter"===b||"MaximumDiameter"===b?(y[0].custoValue&&h.push(v),y[1].custoValue&&h.push(P),y[2].custoValue&&h.push(A),y[3].custoValue&&h.push(w),y[4].custoValue&&h.push(T),y[5].custoValue&&h.push(_),y[6].custoValue&&h.push(C),void 0!==N&&y[7].custoValue&&h.push(N),y[8].custoValue&&h.push(R),y[9].custoValue&&h.push(L),y[10].custoValue&&h.push(x),y[11].custoValue&&h.push(V)):(y[0].custoValue&&h.push(v),y[1].custoValue&&h.push(P),y[2].custoValue&&h.push(A),y[3].custoValue&&h.push(w),y[4].custoValue&&h.push(C),s>0&&y[5].custoValue&&h.push(f),y[6].custoValue&&h.push(M),l>0&&y[7].custoValue&&h.push(D),y[8].custoValue&&h.push(S),y[9].custoValue&&h.push(R),y[10].custoValue&&h.push(L),y[11].custoValue&&h.push(x),y[12].custoValue&&h.push(V))}else h[0]=dt(t,!1,!0),h[1]=E.startpoint+" "+ut(a.beginPoint),h[2]=E.endpoint+" "+ut(a.endPoint),h[3]=E.direction+" "+ut(o),h[4]=gt(i.owner.getAttribute("fArea")),h[5]=E.cog+" "+ut(i.owner.getAttribute("vCog")),h[6]=Ee.length>50?Ee.substring(0,50)+"...":Ee,h[7]=r.mode;Le=6,xe=7}return h}function Dt(e,n,r,a){var o=[];a.exact=n.getMode()===l.Mode.EXACT,a.mode=a.exact?E.exactMode:E.approximateMode;var s=i.owner.getAttribute("oProduct1Name"),u=i.owner.getAttribute("sResultingType1");switch(we&&a.exact&&(we=!1),u){case t.ResultType.POINT:At(e,i.owner.getAttribute("vPosition"),s,o,a);break;case t.ResultType.CENTER:At(e,n.getCenter(),s,o,a);break;case t.ResultType.LINE:!function(e,t,n,r,a){if(e)0!==i.owner.getAttribute("fLength")&&(r[0]=pt(i.owner.getAttribute("fLength"),Se));else{Ee=Se&&void 0===n?E.line:E.line+" "+E.inLabel+" "+n,Ve=void 0;var o=new d.Vector3;o.subVectors(t.endPoint,t.beginPoint).normalize();var s=i.owner.getAttribute("lCustomization");s&&s.length>0?(r[0]=pt(i.owner.getAttribute("fLength")),s[0].custoValue&&r.push(E.firstpoint+" "+ut(t.beginPoint)),s[1].custoValue&&r.push(E.secondpoint+" "+ut(t.endPoint)),s[2].custoValue&&r.push(E.direction+" "+ut(o)),s[3].custoValue&&r.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),s[4].custoValue&&r.push(a.mode)):(r[0]=pt(i.owner.getAttribute("fLength")),r[1]=E.startpoint+" "+ut(t.beginPoint),r[2]=E.endpoint+" "+ut(t.endPoint),r[3]=E.direction+" "+ut(o),r[4]=Ee.length>50?Ee.substring(0,50)+"...":Ee,r[5]=a.mode),Le=4,xe=5}}(e,r,s,o,a);break;case t.ResultType.AXIS:!function(e,t,n,r,a){var o=new d.Vector3;if(o.subVectors(t.endPoint,t.beginPoint).normalize(),e)r[0]=Se?ut(o):E.direction+" "+ut(o);else{Ee=E.infiniteline+" "+E.inLabel+" "+n,Ve=void 0,r[0]=E.direction+" "+ut(o);var s=i.owner.getAttribute("lCustomization");s&&s.length>0?(s[0].custoValue&&r.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),s[1].custoValue&&r.push(a.mode)):(r[1]=Ee.length>50?Ee.substring(0,50)+"...":Ee,r[2]=a.mode),Le=1,xe=2}}(e,r,s,o,a);break;case t.ResultType.CIRCLE:!function(e,t,n,r,a,o){var s,l=i.owner.getAttribute("fRadius"),u=t.getArcAngle();e||(s=i.owner.getAttribute("lCustomization")),i.owner.getAttribute("bArcLengthDisplay")?e?a[0]=mt(u*l,E.arcLength,Se):(a[0]=mt(u*l,E.arcLength),s&&s.length>0?(Ee=E.arc+" "+E.inLabel+" "+r,Ve=void 0,s[0].custoValue&&a.push(E.firstpoint+" "+ut(n.beginPoint)),s[1].custoValue&&a.push(E.secondpoint+" "+ut(n.endPoint)),s[2].custoValue&&a.push(bt(l)),s[3].custoValue&&a.push(yt(2*l)),s[4].custoValue&&a.push(Ee),s[5].custoValue&&a.push(o.mode)):(Ee=E.arc,Ve=void 0,a[1]=E.startpoint+" "+ut(n.beginPoint),a[2]=E.endpoint+" "+ut(n.endPoint),a[3]=Ee,a[4]=o.mode),Le=3,xe=4):e?i.owner.getAttribute("bRadiusDisplay")?a[0]=bt(l,Se):a[0]=yt(2*l,Se):(i.owner.getAttribute("bRadiusDisplay")?a[0]=bt(l):a[0]=yt(2*l),Ee=Se&&void 0===r?u&&Math.abs(2*Math.PI-u)>et?E.arc:E.circle:E.circle+" "+E.inLabel+" "+r,Ve=void 0,s&&s.length>0?(s[0].custoValue&&a.push(E.center+" "+ut(i.owner.getAttribute("vCenter"))),s[1].custoValue&&a.push(mt(u*l,E.arcLength)),s[2].custoValue&&a.push(mt(2*Math.PI*l,E.circlePerimeter)),s[3].custoValue&&a.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),s[4].custoValue&&a.push(o.mode)):(a[1]=E.center+" "+ut(i.owner.getAttribute("vCenter")),a[2]=mt(u*l,E.arcLength),a[3]=mt(2*Math.PI*l,E.circlePerimeter),a[4]=Ee.length>50?Ee.substring(0,50)+"...":Ee,a[5]=o.mode),Le=4,xe=5)}(e,n,r,s,o,a);break;case t.ResultType.CURVE:!function(e,t,n,r,a){if(e)0!==i.owner.getAttribute("fLength")&&(r[0]=pt(i.owner.getAttribute("fLength"),Se,!0));else{Ee=void 0===n?E.curve:E.curve+" "+E.inLabel+" "+n,Ve=void 0,r[0]=pt(i.owner.getAttribute("fLength"),!1,!0);var o=i.owner.getAttribute("lCustomization");null!==t?(o&&o.length>0?(o[0].custoValue&&r.push(E.firstpoint+" "+ut(t.beginPoint)),o[1].custoValue&&r.push(E.secondpoint+" "+ut(t.endPoint)),o[2].custoValue&&r.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),o[3].custoValue&&r.push(a.mode)):(r[1]=E.startpoint+" "+ut(t.beginPoint),r[2]=E.endpoint+" "+ut(t.endPoint),r[3]=Ee.length>50?Ee.substring(0,50)+"...":Ee,r[4]=a.mode),Le=3,xe=4):o&&o.length>0?(o[2].custoValue&&r.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),o[3].custoValue&&r.push(a.mode)):(r[1]=Ee.length>50?Ee.substring(0,50)+"...":Ee,r[2]=a.mode)}}(e,r,s,o,a);break;case t.ResultType.PLANE:!function(e,t,n,r,a){var o=i.owner.getAttribute("fArea");if(e)0!==o&&(r[0]=gt(o,Se));else{Ee=E.plane+" "+E.inLabel+" "+n,Ve=void 0;var s=t.getPlane(),l=i.owner.getAttribute("lCustomization");l&&l.length>0?(r.push(gt(o)),l[0].custoValue&&r.push(E.cog+" "+ut(i.owner.getAttribute("vCog"))),l[1].custoValue&&r.push(E.equation+" "+vt(s.origin,s.normal)),l[2].custoValue&&r.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),l[3].custoValue&&r.push(a.mode)):(r[0]=gt(o),r[1]=E.cog+" "+ut(i.owner.getAttribute("vCog")),r[2]=E.equation+" "+vt(s.origin,s.normal),r[3]=Ee.length>50?Ee.substring(0,50)+"...":Ee,r[4]=a.mode),Le=3,xe=4}}(e,n,s,o,a);break;case t.ResultType.CYLINDER:!function(e,t,n,r,a){var o,s,l=i.owner.getAttribute("fRadius"),u=i.owner.getAttribute("sSurfaceDisplayType");if(e)"Length"===u?(s=i.owner.getAttribute("fHeight"),r[0]=pt(s,Se)):"Area"===u?(o=i.owner.getAttribute("fArea"),r[0]=gt(o,Se)):0!==l&&(i.owner.getAttribute("bRadiusDisplay")?r[0]=bt(l,Se):r[0]=yt(2*l,Se));else{Ee=E.cylinder+" "+E.inLabel+" "+n,Ve=void 0,o=i.owner.getAttribute("fArea");var c=new d.Vector3;c.subVectors(t.endPoint,t.beginPoint).normalize();var p=i.owner.getAttribute("lCustomization");p&&p.length>0?"Length"===u?(s=i.owner.getAttribute("fHeight"),r[0]=pt(s),p[0].custoValue&&r.push(E.firstpoint+" "+ut(t.beginPoint)),p[1].custoValue&&r.push(E.secondpoint+" "+ut(t.endPoint)),p[2].custoValue&&r.push(E.direction+" "+ut(c)),p[3].custoValue&&r.push(bt(l)),p[4].custoValue&&r.push(yt(2*l)),p[5].custoValue&&r.push(gt(o)),p[6].custoValue&&r.push(E.cog+" "+ut(i.owner.getAttribute("vCog"))),p[7].custoValue&&r.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),p[8].custoValue&&r.push(a.mode)):"Area"===u?(o=i.owner.getAttribute("fArea"),r[0]=gt(o),p[0].custoValue&&r.push(E.cog+" "+ut(i.owner.getAttribute("vCog"))),p[1].custoValue&&r.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),p[2].custoValue&&r.push(a.mode)):0!==l&&(s=i.owner.getAttribute("fHeight"),i.owner.getAttribute("bRadiusDisplay")?r[0]=bt(l):r[0]=yt(2*l),p[0].custoValue&&r.push(E.firstpoint+" "+ut(t.beginPoint)),p[1].custoValue&&r.push(E.secondpoint+" "+ut(t.endPoint)),p[2].custoValue&&r.push(pt(s)),p[3].custoValue&&r.push(E.direction+" "+ut(c)),p[4].custoValue&&r.push(gt(o)),p[5].custoValue&&r.push(E.cog+" "+ut(i.owner.getAttribute("vCog"))),p[6].custoValue&&r.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),p[7].custoValue&&r.push(a.mode)):(i.owner.getAttribute("bRadiusDisplay")?r[0]=bt(l):r[0]=yt(2*l),r[1]=E.startpoint+" "+ut(t.beginPoint),r[2]=E.endpoint+" "+ut(t.endPoint),r[3]=E.direction+" "+ut(c),r[4]=gt(o),r[5]=E.cog+" "+ut(i.owner.getAttribute("vCog")),r[6]=Ee.length>50?Ee.substring(0,50)+"...":Ee,r[7]=a.mode),Le=6,xe=7}}(e,r,s,o,a);break;case t.ResultType.SPHERE:!function(e,t,n,r){n[0]=E.sphere;var a=i.owner.getAttribute("fRadius"),o=i.owner.getAttribute("sSurfaceDisplayType"),s=i.owner.getAttribute("fArea");if(e)"Area"===o?n[0]=gt(s,Se):i.owner.getAttribute("bRadiusDisplay")?n[0]=bt(a,Se):n[0]=yt(2*a,Se);else{Ee=E.sphere+" "+E.inLabel+" "+t,Ve=void 0;var l=i.owner.getAttribute("lCustomization");l&&l.length>0?"Area"===o?(n[0]=gt(s),l[0].custoValue&&n.push(E.cog+" "+ut(i.owner.getAttribute("vCog"))),l[1].custoValue&&n.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),l[2].custoValue&&n.push(r.mode)):(i.owner.getAttribute("bRadiusDisplay")?n[0]=bt(a):n[0]=yt(2*a),l[0].custoValue&&n.push(E.center+" "+ut(i.owner.getAttribute("vCenter"))),l[1].custoValue&&n.push(gt(s)),l[2].custoValue&&n.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),l[3].custoValue&&n.push(r.mode)):(i.owner.getAttribute("bRadiusDisplay")?n[0]=bt(a):n[0]=yt(2*a),n[1]=E.center+" "+ut(i.owner.getAttribute("vCenter")),n[2]=gt(s),n[3]=Ee.length>50?Ee.substring(0,50)+"...":Ee,n[4]=r.mode),Le=3,xe=4}}(e,s,o,a);break;case t.ResultType.SURFACE:!function(e,t,n,r){if(e)0!==i.owner.getAttribute("fArea")&&(n[0]=gt(i.owner.getAttribute("fArea"),Se));else{Ee=E.surface+" "+E.inLabel+" "+t,Ve=void 0;var a=i.owner.getAttribute("lCustomization");a&&a.length>0?(n.push(gt(i.owner.getAttribute("fArea"))),a[0].custoValue&&n.push(E.cog+" "+ut(i.owner.getAttribute("vCog"))),a[1].custoValue&&n.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),a[2].custoValue&&n.push(r.mode)):(n[0]=gt(i.owner.getAttribute("fArea")),n[1]=E.cog+" "+ut(i.owner.getAttribute("vCog")),n[2]=Ee.length>50?Ee.substring(0,50)+"...":Ee,n[3]=r.mode),Le=2,xe=3}}(e,s,o,a);break;case t.ResultType.PRODUCT:!function(e,t,n,r,a,o){var s=i.owner.getAttribute("fVolume"),l=i.owner.getAttribute("fArea"),u=i.owner.getAttribute("fLength"),c=i.owner.getAttribute("vCog"),p=t.getOriginPoint(),d=i.owner.getAttribute("sProductDisplayType");if(e)ft(d,s,l,c,p,a);else{Ee=r,Ve=void 0;var g=0,h=E.product,b=i.owner.getAttribute("lCustomization");b&&b.length>0?("Area"===i.owner.getAttribute("sProductDisplayType")?(a.push(gt(l)),b[0].custoValue&&s&&a.push(ht(s))):(a.push(ht(s)),b[0].custoValue&&a.push(gt(l))),void 0===s&&g++,void 0===l&&g++,void 0!==s||void 0!==l?b[1].custoValue&&a.push(E.cog+" "+ut(c)):g++,Ee=h+" "+Ee,b[2].custoValue&&a.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),b[3].custoValue&&a.push(o.mode)):(void 0===s?g++:a[0]=ht(s),void 0===l?g++:a[1-g]=gt(l),void 0!==s||void 0!==l?a[2-g]=E.cog+" "+ut(c):void 0!==u&&u>0?(a[2-g]=pt(u),void 0!==n.beginPoint&&void 0!==n.endPoint&&(h=E.curve+" "+E.inLabel,a[2- --g]=E.startpoint+" "+ut(n.beginPoint),a[2- --g]=E.endpoint+" "+ut(n.endPoint))):void 0!==c?(a[2-g]=ut(c),h=E.point+" "+E.inLabel):void 0!==p?(a[2-g]=ut(p),h=E.origin+" "+E.ofLabel):g++,Ee=h+" "+Ee,a[3-g]=Ee.length>50?Ee.substring(0,50)+"...":Ee,a[4-g]=o.mode),Le=3-g,xe=4-g}}(e,n,r,s,o,a);break;case t.ResultType.CONE:o=Mt(e,i.owner.getAttribute("fSemiAngle"),n,a);break;default:o[0]="Unknow"}return o}function St(e,t,n,r,a){var o,s,u=[],c={},p=i.owner.getMeasurable(1),g=p.getPoints();if(Se=!1,!1===i.owner.getAttribute("bDisplayMeasureType")&&(Se=!0),we=!1,e&&!0===i.owner.getAttribute("bDisplayApproximateSymbol")&&(we=!0),"MeasureBetween"===t||"MeasureThickness"===t)u=function(e,t,n,r,a,o,s,u){var c=[];u.exact="MeasureThickness"!==We&&o.getMode()===l.Mode.EXACT&&s.getMode()===l.Mode.EXACT,u.mode=u.exact?E.exactMode:E.approximateMode;var p=E.minDistance;if(we&&u.exact&&(we=!1),"MeasureBetween"===e)switch(t){case"Distance":p=E.distance;break;case"MaximumDistance":p=E.maxDistance;break;case"LocalMinimumDistance":p=E.LocalMinimumDistance;break;case"LocalMaximumDistance":p=E.LocalMaximumDistance}var g=pt(a,!0);if(r)c[0]=Se?g:"MeasureBetween"===e?p+" "+g:E.thickness+" "+g;else{var h=new d.Vector3;h.subVectors(s.getSelPoint(),o.getSelPoint());var b=h.clone().normalize(),y=i.owner.getAttribute("lCustomization");"MeasureBetween"===e?(Ee=Pt(i.owner.getAttribute("sResultingType1"),i.owner.getAttribute("oProduct1Name")),Ve=Pt(i.owner.getAttribute("sResultingType2"),i.owner.getAttribute("oProduct2Name")),"2D"===n&&(Ee===E.circle&&o._arcAngle&&Math.abs(2*Math.PI-o._arcAngle)>et&&(Ee=E.arc),Ve===E.circle&&s._arcAngle&&Math.abs(2*Math.PI-s._arcAngle)>et&&(Ve=E.arc)),y&&y.length>0?(c[0]=p+" "+g,7===y.length&&(y[0].custoValue&&c.push(E.firstpoint+" "+ut(o.getSelPoint())),y[1].custoValue&&c.push(E.secondpoint+" "+ut(s.getSelPoint())),y[2].custoValue&&c.push(E.components+" "+ct(h)),y[3].custoValue&&c.push(E.direction+" "+ut(b)),y[4].custoValue&&c.push("2D"!==n&&Ee.length>50?Ee.substring(0,50)+"...":Ee),y[5].custoValue&&c.push("2D"!==n&&Ve.length>50?Ve.substring(0,50)+"...":Ve),y[6].custoValue&&c.push(u.mode)),"2D"!==n&&(Le=5,xe=7)):(c[0]=p+" "+g,c[1]=E.firstpoint+" "+ut(o.getSelPoint()),c[2]=E.secondpoint+" "+ut(s.getSelPoint()),c[3]=E.components+" "+ct(h),c[4]=E.direction+" "+ut(b),"2D"===n?(c[5]=Ee+" - "+Ve,c[6]=u.mode):(Le=5,xe=7,c[5]=Ee.length>50?Ee.substring(0,50)+"...":Ee,c[6]=Ve.length>50?Ve.substring(0,50)+"...":Ve,c[7]=u.mode))):(Ee=E.thickness+" "+E.ofLabel+" "+i.owner.getAttribute("oProduct1Name"),Ve=void 0,y&&y.length>0?(c[0]=E.thickness+" "+g,y[0].custoValue&&c.push(E.firstpoint+" "+ut(o.getSelPoint())),y[1].custoValue&&c.push(E.secondpoint+" "+ut(s.getSelPoint())),y[2].custoValue&&c.push(E.direction+" "+ut(b)),y[3].custoValue&&c.push(Ee.length>50?Ee.substring(0,50)+"...":Ee),y[4].custoValue&&c.push(u.mode)):(c[0]=E.thickness+" "+g,c[1]=E.startpoint+" "+ut(o.getSelPoint()),c[2]=E.endpoint+" "+ut(s.getSelPoint()),c[3]=E.direction+" "+ut(b),c[4]=Ee.length>50?Ee.substring(0,50)+"...":Ee,c[5]=u.mode),Le=4,xe=5)}return c}(t,a,r,e,n,p,o=i.owner.getMeasurable(2),c);else if("MeasureItem"===t)u=Dt(e,p,g,c);else if("Measure3PointsCircle"===t){o=i.owner.getMeasurable(2);var h=i.owner.getMeasurable(3);if(c.exact=p.getMode()===l.Mode.EXACT&&o.getMode()===l.Mode.EXACT&&h.getMode()===l.Mode.EXACT,c.mode=c.exact?E.exactMode:E.approximateMode,s=i.owner.getAttribute("fRadius"),e)we&&c.exact&&(we=!1),i.owner.getAttribute("bRadiusDisplay")?u[0]=bt(s,Se):u[0]=yt(2*s,Se);else{var b=i.owner.getAttribute("lCustomization");b&&b.length>0?(i.owner.getAttribute("bRadiusDisplay")?u[0]=bt(s):u[0]=yt(2*s),void 0!==p&&void 0!==o&&void 0!==h&&void 0!==p.getSelPoint()&&void 0!==o.getSelPoint()&&void 0!==h.getSelPoint()&&(b[0].custoValue&&u.push(E.firstpoint+" "+ut(p.getSelPoint())),b[1].custoValue&&u.push(E.secondpoint+" "+ut(o.getSelPoint())),b[2].custoValue&&u.push(E.thirdpoint+" "+ut(h.getSelPoint()))),b[3].custoValue&&u.push(E.center+" "+ut(i.owner.getAttribute("vCenter"))),b[4].custoValue&&u.push(c.mode)):(u[0]=bt(s)+"  "+yt(2*s),u[1]=E.center+" "+ut(i.owner.getAttribute("vCenter")),u[2]=E.normal+" "+ut(i.owner.getAttribute("vNormal")),u[3]=E.circle,u[4]=c.mode)}}return u}function wt(e,n,r,a,o){var s=[],u={},c=i.owner.getMeasurable(1),p=i.owner.getMeasurable(2),d=i.owner.getMeasurable(3);return u.exact=c.getMode()===l.Mode.EXACT,u.mode=u.exact?E.exactMode:E.approximateMode,we=!1,e&&!0===i.owner.getAttribute("bDisplayApproximateSymbol")&&(we=!0),Se=!1,i.owner.getAttribute("bDisplayMeasureType")||(Se=!0),"MeasureBetween"===n||"Measure3PointsAngle"===n||"MeasureThickness"===n?s=function(e,t,n,r,a,o,s,u,c){var p=[];c.exact=a.getMode()===l.Mode.EXACT&&o.getMode()===l.Mode.EXACT,c.mode=c.exact?E.exactMode:E.approximateMode;var d=dt(n,!0);if(e)p[0]="2D"===u?d:Se?d:E.angle+" "+d;else{var g=i.owner.getAttribute("lCustomization");if(p[0]=E.angle+" "+d,r&&"MeasureBetween"===t||"MeasureThickness"===t)Ee=Pt(i.owner.getAttribute("sResultingType1"),i.owner.getAttribute("oProduct1Name")),Ve=Pt(i.owner.getAttribute("sResultingType2"),i.owner.getAttribute("oProduct2Name")),g&&g.length>0?(g[0].custoValue&&p.push(E.center+" "+ut(i.owner.getAttribute("vAngleArcCenter").clone())),g[1].custoValue&&p.push("2D"!==u&&Ee.length>50?Ee.substring(0,50)+"...":Ee),g[2].custoValue&&p.push("2D"!==u&&Ve.length>50?Ve.substring(0,50)+"...":Ve),g[3].custoValue&&p.push(c.mode),"2D"!==u&&Ee&&(Le=1,xe=2,Ve&&(xe=3))):("2D"===u?p[1]=Ee+" - "+Ve:Ee&&(Le=1,xe=2,p[1]=Ee.length>50?Ee.substring(0,50)+"...":Ee,Ve&&(p[2]=Ve.length>50?Ve.substring(0,50)+"...":Ve,xe=3)),p.push(c.mode));else if("Measure3PointsAngle"===t)if(g&&g.length>0)void 0!==a&&void 0!==o&&void 0!==s&&void 0!==a.getSelPoint()&&void 0!==o.getSelPoint()&&void 0!==s.getSelPoint()&&(g[0].custoValue&&p.push(E.firstpoint+" "+ut(a.getSelPoint())),g[1].custoValue&&p.push(E.secondpoint+" "+ut(s.getSelPoint())),g[2].custoValue&&p.push(E.center+" "+ut(o.getSelPoint()))),g[3].custoValue&&p.push(c.mode);else{void 0!==a&&void 0!==o&&void 0!==s&&(c.exact=a.getMode()===l.Mode.EXACT&&o.getMode()===l.Mode.EXACT&&s.getMode()===l.Mode.EXACT);var h=i.owner.getAttribute("fProjectedAngleXY"),b=i.owner.getAttribute("fProjectedAngleYZ"),y=i.owner.getAttribute("fProjectedAngleZX");if(void 0!==h&&void 0!==b&&void 0!==y){var m=dt(h,!0),v=dt(b,!0),P=dt(y,!0);p.push(E.projectedAngle+" "+E.xy+": "+m+" "+E.yz+": "+v+" "+E.zx+": "+P),void 0!==a&&void 0!==o&&void 0!==s&&void 0!==a.getSelPoint()&&void 0!==o.getSelPoint()&&void 0!==s.getSelPoint()&&(p.push(E.firstpoint+" "+ut(a.getSelPoint())),p.push(E.secondpoint+" "+ut(o.getSelPoint())),p.push(E.thirdpoint+" "+ut(s.getSelPoint())))}p.push(c.mode)}}return p}(e,n,r,a,c,p,d,o,u):"MeasureItem"===n&&i.owner.getAttribute("sResultingType1")===t.ResultType.CONE?s=Mt(e,r,c,u):i.owner.isReadOnly()&&"MeasureItem"===n&&i.owner.getAttribute("sResultingType1")===t.ResultType.CIRCLE&&(e?s[0]=dt(r):(s[0]=dt(r),s[1]=E.circle+" "+E.inLabel+" "+i.owner.getAttribute("oProduct1Name"),s[2]=u.mode)),s}function Tt(e,t,i,n,a,o){if(t&&i){var s=i.clone(),l=o.leaderStyle&&void 0!==o.leaderStyle.thickness?o.leaderStyle.thickness:o.lineStyle.thickness,u={arrowWidth:l,headLength:Math.max(2*l+4,10),viewpoint:Pe.currentViewpoint,initialPoint:s.clone(),finalPoint:t.clone(),color:o.leaderStyle&&o.leaderStyle.color?o.leaderStyle.color:o.lineStyle.color,arrowScale:2,head:1},c=M.getDistanceFromPixel(Pe,t,5),p=n.clone().normalize().multiplyScalar(c);if(s=t.clone().add(p),u.initialPoint=s.clone(),!r.areEqual(u.initialPoint,u.finalPoint,"Vector3")){var d=e.getChildByName("arrow1Node");d?(d.updateInitialPosition(u.initialPoint),d.updateFinalPosition(u.finalPoint),d.updateColor(u.color),d.setArrowWidth(u.arrowWidth),d.setHeadSize(u.headLength),d.setHeadType(u.head)):((d=new v(u)).name="arrow1Node",e.add(d))}var g=a.clone().normalize().multiplyScalar(c);if(s=i.clone().sub(g),u.initialPoint=s,u.finalPoint=i,!r.areEqual(u.initialPoint,u.finalPoint,"Vector3")){var h=e.getChildByName("arrow2Node");h?(h.updateInitialPosition(u.initialPoint),h.updateFinalPosition(u.finalPoint),h.updateColor(u.color),h.setArrowWidth(u.arrowWidth),h.setHeadSize(u.headLength),h.setHeadType(u.head)):((h=new v(u)).name="arrow2Node",e.add(h))}}}function _t(e,t,i,n,a,o,s,l,u,c,p){if(t&&i){var d=4,g=!1,h="MeasureThickness"===We,b=t.clone().add(i).multiplyScalar(.5),y=o?b.clone():i.clone(),m=s.leaderStyle&&void 0!==s.leaderStyle.thickness?s.leaderStyle.thickness:s.lineStyle.thickness;void 0===l||!0!==l&&!h||(d=Math.max(2*m+4,10),g=!0);var P={arrowWidth:m,headLength:d,viewpoint:Pe.currentViewpoint,initialPoint:y.clone(),finalPoint:t.clone(),color:s.leaderStyle&&s.leaderStyle.color?s.leaderStyle.color:s.lineStyle.color,head:0};if(!r.areEqual(P.initialPoint,P.finalPoint,"Vector3")){var A=e.getChildByName("lineNode");A?(A.updateInitialPosition(P.initialPoint),A.updateFinalPosition(P.finalPoint),A.updateColor(P.color),A.setArrowWidth(P.arrowWidth),A.setHeadSize(P.headLength),A.setHeadType(P.head)):((A=new v(P)).name="lineNode",e.add(A))}var f,D=t.clone().sub(i),S=D.length(),w=S<d,T=w?1:d/S;if(h)T=-T;else if(!0!==g){if(void 0!==n){var _=n.clone().sub(t),C=i.clone().sub(t),R=n.clone().sub(i),L=t.clone().sub(i);f=!a||_.clone().dot(C.clone())>0&&R.clone().dot(L.clone())>0}!1===u||f&&!w||(T=-T)}if(void 0===c||!0===c){if(P.head=1,D.multiplyScalar(T),h){var x=25*m;x=M.getDistanceFromPixel(Pe,t.clone(),x),D.normalize().multiplyScalar(x)}if(P.initialPoint=t.clone().sub(D),!r.areEqual(P.initialPoint,P.finalPoint,"Vector3")){var E=e.getChildByName("dimArrow1Node");E?(E.updateInitialPosition(P.initialPoint),E.updateFinalPosition(P.finalPoint),E.updateColor(P.color),E.setArrowWidth(P.arrowWidth),E.setHeadSize(P.headLength),E.setHeadType(P.head)):((E=new v(P)).name="dimArrow1Node",e.add(E))}if(!p&&(P.initialPoint=y.clone().add(D),P.finalPoint=y,!r.areEqual(P.initialPoint,P.finalPoint,"Vector3"))){var V=e.getChildByName("dimArrow2Node");V?(V.updateInitialPosition(P.initialPoint),V.updateFinalPosition(P.finalPoint),V.updateColor(P.color),V.setArrowWidth(P.arrowWidth),V.setHeadSize(P.headLength),V.setHeadType(P.head)):((V=new v(P)).name="dimArrow2Node",e.add(V))}}}}function Ct(e,t,i,n,a,o){var s=new h;if(e&&t&&i&&n){var l=t.clone(),u=n.clone();a&&(l.add(e).multiplyScalar(.5),u.add(i).multiplyScalar(.5));var c={arrowWidth:o.leaderStyle&&void 0!==o.leaderStyle.thickness?o.leaderStyle.thickness:o.lineStyle.thickness,viewpoint:Pe.currentViewpoint,initialPoint:i.clone(),finalPoint:e.clone(),color:o.leaderStyle&&o.leaderStyle.color?o.leaderStyle.color:o.lineStyle.color,head:0};r.areEqual(c.initialPoint,c.finalPoint,"Vector3")||at(s,new v(c)),c.initialPoint=u,c.finalPoint=l,r.areEqual(c.initialPoint,c.finalPoint,"Vector3")||at(s,new v(c))}return s}function Rt(e,t,i){var n=new P({position:e.clone(),name:"anchor1",type:"Spherical"});n.setMatrix((new d.Matrix4).setPosition(e.clone()));var r=g.createCircleNode({radius:4,segments:8,fill:!1,color:t});r.setShadow(!1);var a=new A({name:"myFixedSizeNode",ratio:1});at(a,r),at(n,a);var o=g.createCircleNode({radius:4,segments:8,fill:!0,color:i});o.setShadow(!1);var s=new A({name:"myFixedSizeNode",ratio:1});return at(s,o),at(n,s),n}function Lt(e,t,i){var n,r=t.getPoints(),a=o.computePointSegmentDistance(i.toArray(),r.beginPoint.toArray(),r.endPoint.toArray());0===a.returnCode&&a.relationship!==l.Relationship.COINCIDENT&&(n=new d.Vector3(a.aPosition[0],a.aPosition[1],a.aPosition[2])),n&&(s.areEqual(n.toArray(),i.toArray())?n=void 0:at(e,u.createLineNode(n,i,Re.regularDashedLine)))}function xt(e,n,r,a,o){if(null!==n&&e.remove(n),r){var s,l,c,p,d,b,y,m,v;switch(a){case t.ResultType.LINE:break;case t.ResultType.AXIS:l=(s=r.getPoints()).beginPoint.clone().sub(s.endPoint),c=30,p=M.getDistanceFromPixel(Pe,s.beginPoint,c),l.normalize().multiplyScalar(p),m=s.beginPoint.clone().add(l),v=s.endPoint.clone().sub(l),n=u.createLineNode(m,v,o);break;case t.ResultType.CIRCLE:n=new h;var P=r.getRadius();"2D"===i.owner.getAttribute("sMeasureOnGeometryType")&&r.get2DScale&&(P=r.get2DScale()*P),y=r.getCenter();var A=!1;if(!0===i.owner.getAttribute("bArcLengthDisplay"))A=!1;else if(0===i.owner.getAttribute("iRadiusResultDisplayType"))at(n,u.createCircleNode(P,y,r.getAxis(),o));else{!1===i.owner.getAttribute("bRadiusDisplay")?at(n,u.createCircleNode(P,y,r.getAxis(),o)):A=!0,Re.crossPoint.force=!0,at(n,g.createPointsNode({positions:y.clone().toArray(),material:Re.crossPoint}))}if(A){s=r.getPoints();var f=r.getArcMidPoint();d=f.clone().sub(s.beginPoint),b=f.clone().sub(s.endPoint);var D=s.beginPoint,S=s.endPoint;b.length()<d.length()&&(D=s.endPoint,S=s.beginPoint);var w=y.clone().sub(D),T=y.clone().sub(S),_=y.clone().sub(f);_.normalize().negate().multiplyScalar(P);var C=u.createArcNode(P,y,w,_,Re.regularSolidLine),R=u.createArcNode(P,y,_,T,Re.regularSolidLine);at(n,C),at(n,R)}break;case t.ResultType.CYLINDER:n=new h,s=r.getPoints();var L=i.owner.getAttribute("vFirstExtensionPoint3D");void 0===_e&&(L=r.getSelPoint().clone()),d=L.clone().sub(s.beginPoint),b=L.clone().sub(s.endPoint),y=s.beginPoint,b.length()<d.length()&&(y=s.endPoint);var x=s.endPoint.clone().sub(s.beginPoint);at(n,u.createCircleNode(r.getRadius(),y,x,o)),l=s.beginPoint.clone().sub(s.endPoint),c=30,p=M.getDistanceFromPixel(Pe,y,c),l.normalize().multiplyScalar(p),m=s.beginPoint.clone().add(l),v=s.endPoint.clone().sub(l),at(n,u.createLineNode(m,v,Re.dotDashedLine));break;case t.ResultType.CONE:n=new h;var E,V=(s=r.getPoints()).endPoint,N=r.getApex(),k=r.getSemiAngle(),I=r.getAxis(),F=N.clone(),O=i.owner.getAttribute("sSurfaceDisplayType"),U=r.vSlat.clone(),B=N.clone().sub(V).length()*Math.tan(k),z=u.createCircleNode(B,V,I,o);if(at(n,z),m=r.vExtensionPoint1,v=r.vExtensionPoint2,m&&v||(l=s.beginPoint.clone().sub(s.endPoint),c=30,p=M.getDistanceFromPixel(Pe,s.beginPoint,c),l.normalize().multiplyScalar(p),r.vExtensionPoint1=s.beginPoint.clone().add(l),r.vExtensionPoint2=s.endPoint.clone().sub(l),m=r.vExtensionPoint1.clone(),v=r.vExtensionPoint2.clone()),at(n,u.createLineNode(m,v,Re.dotDashedLine)),"Angle"===O)at(n,u.createLineNode(i.owner.getAttribute("vSecondExtensionPoint3D"),F,Re.regularSolidLine));else if("MinimumRadius"===O||"MinimumDiameter"===O){var G=N.clone().sub(s.beginPoint),H=N.clone().sub(s.endPoint),J=s.beginPoint.clone();G.length()>H.length()&&(J=s.endPoint.clone()),B=N.clone().sub(J).length()*Math.tan(k),at(n,z=u.createCircleNode(B,J,I,o)),E=r.getMaxRadius()/Math.sin(k),U=U.normalize().multiplyScalar(E),F=N.clone().add(U)}else"MaximumRadius"!==O&&"MaximumDiameter"!==O||(E=r.getMinRadius()/Math.sin(k),U=U.normalize().multiplyScalar(E),F=N.clone().add(U));at(n,u.createLineNode(i.owner.getAttribute("vFirstExtensionPoint3D"),F,Re.regularSolidLine));break;case t.ResultType.SPHERE:n=new h,void 0===r.normal&&i.owner._buildConstructionPointsForConeCylSphere(),at(n,u.createCircleNode(r.getRadius(),r.getCenter(),r.normal,o))}n&&at(e,n)}}function Et(e,i,n,r,a){var c;if(xt(e,i,n,r,r===t.ResultType.AXIS||r===t.ResultType.CIRCLE?Re.avatarDashedLine:Re.avatarSolidLine),r===t.ResultType.AXIS||r===t.ResultType.LINE){var p=n.getPoints(),g=o.computePointSegmentDistance(a.toArray(),p.beginPoint.toArray(),p.endPoint.toArray());0===g.returnCode&&g.relationship!==l.Relationship.COINCIDENT&&(c=new d.Vector3(g.aPosition[0],g.aPosition[1],g.aPosition[2]))}else c=n.getSelPoint();c&&(s.areEqual(c.toArray(),a.toArray())?c=void 0:at(e,u.createLineNode(c,a,Re.regularDashedLine)))}function Vt(){var e=!1;if("MeasureBetween"===We&&"Angle"!==i.owner.getAttribute("sDistanceType")||"MeasureThickness"===We){var n=i.owner.getAttribute("fDistance");e=void 0!==n&&!r.isZero(n)}else if("MeasureItem"===We){var a=i.owner.getAttribute("sResultingType1");e="Length"===i.owner.getAttribute("sSurfaceDisplayType")&&(a===t.ResultType.CONE||a===t.ResultType.CYLINDER)||(a===t.ResultType.LINE||a===t.ResultType.CIRCLE)}else"Measure3PointsCircle"===We&&(e=!0);return e}function Nt(){if(Vt()&&(Be.manipulator&&Be.manipulator.activate(Be.token),ze.manipulator&&ze.manipulator.activate(ze.token)),Ie){var e=Ke.getRepManipulator();e&&e.activate()}Fe.manipulator&&Fe.manipulator.activate(Fe.token)}function kt(){if(Vt()&&(Be.manipulator&&Be.manipulator.deactivate(Be.token),ze.manipulator&&ze.manipulator.deactivate(ze.token)),Ie){var e=Ke.getRepManipulator();e&&e.deactivate()}Fe.manipulator&&Fe.manipulator.deactivate(Fe.token)}function It(){Vt()&&(Be.manipulator&&(Be.manipulator.axis=i.owner.getAttribute("vExtensionDirection3D").clone()),Ie.manipulator&&(Ie.manipulator.axis=i.owner.getAttribute("vSecondPoint3D").clone().sub(i.owner.getAttribute("vFirstPoint3D"))),Fe.manipulator&&Xe&&(Fe.manipulator.axis=i.owner.getAttribute("vAngleVector1").clone().cross(i.owner.getAttribute("vAngleVector2"))))}function Ft(e){if(!i.owner.isReadOnly()&&i.owner.isEditable()){var n,r,a=Vt();(e||void 0!==je&&a!==je)&&(Be.manipulator&&(Be.manipulator.unlink(Be.token),Be.manipulator=null,Be.token=null),ze.manipulator&&(ze.manipulator.unlink(ze.token),ze.manipulator=null,ze.token=null),Fe.manipulator&&(Fe.manipulator.unlink(Fe.token),Fe.manipulator=null,Fe.token=null),Vt()&&(Be.manipulator=new y({axis:i.owner.getAttribute("vExtensionDirection3D").clone()}),Be.manipulator.setExclusive(!0),Be.token=Be.manipulator.linkToNode(Be),Be.manipulator.subscribe("BeginManipulate",function(){ot(),Qe||(n=i.owner.getAttribute("vFirstPoint3D").clone(),r=i.owner.getAttribute("vSecondPoint3D").clone())}),Be.manipulator.subscribe("Manipulate",function(e){if(!Qe){i.owner.setAttribute("vFirstPoint3D",n.clone().add(e.translationVector)),i.owner.setAttribute("vSecondPoint3D",r.clone().add(e.translationVector));var t=i.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(i.owner.getAttribute("vLeaderBreakPoint3D"));i.owner.setAttribute("vLeaderPointingPoint3D",i.owner.getAttribute("vFirstPoint3D").clone().add(i.owner.getAttribute("vSecondPoint3D")).multiplyScalar(.5)),i.owner.setAttribute("vLeaderBreakPoint3D",i.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(t)),It(),i.owner.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:i.owner})}}),Be.manipulator.subscribe("EndManipulate",st),"2D"!==i.owner.getAttribute("sMeasureOnGeometryType")&&0!==_e&&function(){var e,t,n,r=i.owner.getAttribute("vSecondExtensionPoint3D").clone().sub(i.owner.getAttribute("vFirstExtensionPoint3D"));ze.manipulator=new m({axis:r}),ze.manipulator.setExclusive(!0),ze.manipulator.setCenter(i.owner.getAttribute("vFirstExtensionPoint3D").clone()),ze.token=ze.manipulator.linkToNode(ze),ze.manipulator.subscribe("BeginManipulate",function(){ot(),Qe||(e=i.owner.getAttribute("vFirstPoint3D").clone(),t=i.owner.getAttribute("vSecondPoint3D").clone(),n=new d.Matrix4)}),ze.manipulator.subscribe("Manipulate",function(r){if(!Qe){var a=(new d.Matrix4).copy(n),o=(new d.Matrix4).makeRotationAxis(r.axis,r.angle),s=(new d.Matrix4).setPosition(r.center),l=(new d.Matrix4).getInverse(s).multiply(a),u=(new d.Matrix4).copy(o).multiply(l),c=(new d.Matrix4).copy(s).multiply(u);i.owner.setAttribute("vFirstPoint3D",e.clone().applyMatrix4(c)),i.owner.setAttribute("vSecondPoint3D",t.clone().applyMatrix4(c)),i.owner.setAttribute("vExtensionDirection3D",i.owner.getAttribute("vFirstPoint3D").clone().sub(i.owner.getAttribute("vFirstExtensionPoint3D")));var p=i.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(i.owner.getAttribute("vLeaderBreakPoint3D"));i.owner.setAttribute("vLeaderPointingPoint3D",i.owner.getAttribute("vFirstPoint3D").clone().add(i.owner.getAttribute("vSecondPoint3D")).multiplyScalar(.5)),i.owner.setAttribute("vLeaderBreakPoint3D",i.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(p)),It(),i.owner.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:i.owner})}}),ze.manipulator.subscribe("EndManipulate",st)}()),function(){var e,n,r=Xe?i.owner.getAttribute("vAngleVector1").clone().cross(i.owner.getAttribute("vAngleVector2")):new d.Vector3;Fe.manipulator=new b({axis:r}),Fe.manipulator.setExclusive(!0),Fe.token=Fe.manipulator.linkToNode(Fe.getBackNode());var a=Fe.manipulator;a.subscribe("BeginManipulate",function(){ot(),Qe||(n=i.frmWindow.getViewerFrame().style.cursor,i.frmWindow.getViewerFrame().setStyle("cursor","move"),e=i.owner.getAttribute("vAngleBreakPoint").clone())}),a.subscribe("Manipulate",function(n){if(!Qe){var r=e.clone().add(n.translationVector),a=r.clone().sub(i.owner.getAttribute("vAngleArcCenter")),o=i.owner.getAttribute("vAngleVector1"),s=i.owner.getAttribute("vAngleVector2"),l=o.clone().cross(s),u=0;0>l.clone().cross(o).dot(a)&&(u+=2),0<l.clone().cross(s).dot(a)&&(u+=1);var c="MeasureItem"===We&&i.owner.getAttribute("sResultingType1")===t.ResultType.CONE;if(!c||c&&0===u){i.owner.setAttribute("fQuadrant",u),i.owner.setAttribute("vAngleBreakPoint",r),i.owner.setAttribute("vAnglePointingPoint",r);var p=o.clone();1!==u&&3!==u||p.negate();var d=s.clone();2!==u&&3!==u||d.negate(),c||i.owner.setAttribute("fAngle",p.angleTo(d)),It()}i.owner.refreshAssistantTool&&i.owner.refreshAssistantTool({mousePosition:null},!1),i.owner.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:i.owner})}}),a.subscribe("EndManipulate",function(e){Qe||i.frmWindow.getViewerFrame().setStyle("cursor",n),st(e)})}(),je=a)}}function Ot(e,t){var n,r=!1,o=!0;switch(t){case"bool":r=void 0===(n=i.owner.getAttribute("b"+e))||void 0!==$e[e]&&n===$e[e];break;case"int":r=void 0===(n=i.owner.getAttribute("i"+e))||void 0!==$e[e]&&n===$e[e];break;case"float":r=void 0===(n=i.owner.getAttribute("f"+e))||void 0!==$e[e]&&n===$e[e];break;case"string":void 0===(n=i.owner.getAttribute("s"+e))&&$e[e]&&(n=$e[e]),r=void 0===n||void 0!==$e[e]&&n===$e[e];break;case"Color":r=void 0===(n=i.owner.getAttribute("c"+e))||void 0!==$e[e]&&n.equals($e[e]);break;case"Vector3":null!=(n=i.owner.getAttribute("v"+e))&&(n=n.clone()),r=null==n||void 0!==$e[e]&&n.equals($e[e]);break;case"AABB":r=void 0===(n=i.owner.getAttribute(e))||void 0!==$e[e]&&a.areEqualAABB(n,$e[e]);break;default:r=!1,o=!1}return!r&o&&($e[e]=n),r}function Ut(e){var t={value:0,scale:1};switch(e){case"None":t.value=0;break;case"Cross":t.value=1;break;case"Plus":t.value=2;break;case"Concentric":t.value=3;break;case"Coincident":t.value=4;break;case"FullCircle":t.value=5;break;case"FullSquare":t.value=6;break;case"Star":t.value=7;break;case"Dot":t.value=8,t.scale=.6;break;case"SmallDot":t.value=9,t.scale=.4}return t}function Bt(){if(Ge&&i.owner)if(qe||!Xe){Ge.setVisibility(!0);var e=lt(),r=1;let p=i.owner.getMeasurable(1);var a=i.owner.getAttribute("vLeaderPointingPoint3D"),o=i.owner.getAttribute("vLeaderBreakPoint3D"),s=!Vt();if("MeasureBetween"===We||"MeasureThickness"===We)r=0;else if("Measure3PointsCircle"===We)r=0,i.owner.getAttribute("iRadiusResultDisplayType")===t.RadiusResultDisplayType.CENTER&&(a=i.owner.getAttribute("vFirstExtensionPoint3D").clone());else if("MeasureItem"===We){var l=function(e,n,r){var a={vLeaderPointingPoint:n,headType:r};if(void 0!==a.headType&&void 0!==a.vLeaderPointingPoint){var o=i.owner.getAttribute("sSurfaceDisplayType"),s=!0;switch(i.owner.getAttribute("sResultingType1")){case t.ResultType.CYLINDER:case t.ResultType.SPHERE:if(void 0===_e){var l=i.owner._buildConstructionPointsForConeCylSphere();a.vLeaderPointingPoint=l.oPos1}"Area"===o?a.headType=1:(a.headType=0,s=!1);break;case t.ResultType.LINE:a.headType=0;break;case t.ResultType.CIRCLE:a.headType=0,i.owner.getAttribute("iRadiusResultDisplayType")===t.RadiusResultDisplayType.CENTER&&void 0!==e.getSelPoint()&&(a.vLeaderPointingPoint=e.getSelPoint());break;case t.ResultType.PLANE:case t.ResultType.SURFACE:a.headType=2;break;case t.ResultType.POINT:case t.ResultType.CENTER:a.headType=4;break;case t.ResultType.PRODUCT:a.headType=3;break;case t.ResultType.CONE:s=!1,"Length"===o||"MinimumRadius"===o||"MinimumDiameter"===o||"MaximumRadius"===o||"MaximumDiameter"===o?a.headType=0:"Area"===o&&(a.headType=1,s=!0)}if(s){var u=i.owner.getAttribute("sLeaderEndType");if(void 0!==u){switch(u){case"No end":u=0;break;case"Arrow":u=1;break;case"Bubble":u=2;break;case"Square":u=3;break;case"Cross":u=4}a.headType=u}}return a}}(p,a,r);void 0!==l&&void 0!==l.headType&&void 0!==l.vLeaderPointingPoint&&(r=l.headType,a=l.vLeaderPointingPoint)}if(i.owner.getAttribute("sResultingType1")===t.ResultType.CONE&&Ge.removeChildren(),i.owner.getAttribute("sTextGraphicRepresentation")){var u=Ie.getDimensions();u.position=o.clone();var c=function(e,t){if(e&&e.position&&e.offsetWidth&&e.offsetHeight){e.position.clone();var i=e,n=M.convertModelToPixels({sizeInMM:i.offsetWidth}),r=M.convertModelToPixels({sizeInMM:i.offsetHeight}),a=M.getViewerPositionFromPoint(Pe,i.position),o=new d.Vector2(Math.round(a.left-n/2),Math.round(a.top-r/2)),s=new d.Vector2(Math.round(a.left+n/2),Math.round(a.top-r/2)),l=new d.Vector2(Math.round(a.left+n/2),Math.round(a.top+r/2)),u=new d.Vector2(Math.round(a.left-n/2),Math.round(a.top+r/2)),c=M.get3DPositionFromScreenCoordinates({coords:o,viewer:Pe}),p=M.get3DPositionFromScreenCoordinates({coords:s,viewer:Pe}),g=M.get3DPositionFromScreenCoordinates({coords:l,viewer:Pe}),h=M.get3DPositionFromScreenCoordinates({coords:u,viewer:Pe}),b=t,y=[];y.push(b.clone().toArray()),y.push(e.position.clone().toArray());var m=[];m.push(c.clone().toArray()),m.push(p.clone().toArray());var v=[];v.push(p.clone().toArray()),v.push(g.clone().toArray());var P=[];P.push(g.clone().toArray()),P.push(h.clone().toArray());var A=[];A.push(h.clone().toArray()),A.push(c.clone().toArray());var f=R._computeTwoCurvesSquaredDistance(1,m,1,y),D=Math.sqrt(f.squaredDistance),S=R._computeTwoCurvesSquaredDistance(1,v,1,y),w=Math.sqrt(S.squaredDistance),T=R._computeTwoCurvesSquaredDistance(1,P,1,y),_=R._computeTwoCurvesSquaredDistance(1,A,1,y),C=Math.sqrt(_.squaredDistance),L=Math.sqrt(T.squaredDistance);return D<C?D<w?D<L?new d.Vector3(f.aPosition1[0],f.aPosition1[1],f.aPosition1[2]):new d.Vector3(T.aPosition1[0],T.aPosition1[1],T.aPosition1[2]):w<L?new d.Vector3(S.aPosition1[0],S.aPosition1[1],S.aPosition1[2]):new d.Vector3(T.aPosition1[0],T.aPosition1[1],T.aPosition1[2]):C<w?C<L?new d.Vector3(_.aPosition1[0],_.aPosition1[1],_.aPosition1[2]):new d.Vector3(T.aPosition1[0],T.aPosition1[1],T.aPosition1[2]):w<L?new d.Vector3(S.aPosition1[0],S.aPosition1[1],S.aPosition1[2]):new d.Vector3(T.aPosition1[0],T.aPosition1[1],T.aPosition1[2])}}(u,a.clone());c&&(o=c),"MeasureItem"===We&&i.owner.getAttribute("sResultingType1")===t.ResultType.POINT&&(r=1),s=!1}n.modifyLeaderNode(Pe,Ge,s,o,a,void 0,e.leaderStyle&&void 0!==e.leaderStyle.thickness?e.leaderStyle.thickness:e.lineStyle.thickness,e.leaderStyle&&e.leaderStyle.color?e.leaderStyle.color:e.lineStyle.color,null,r,Object.assign(Ie.getDimensions(),{rotationAngle:i.owner.getAttribute("fBoxRotationAngle")}),i.frmWindow)}else Ge.removeChildren()}function zt(e,n,a,o){var s,l=i.owner.getAttribute("vAngleArcCenter"),c=i.owner.getAttribute("vAnglePointingPoint"),p=i.owner.getAttribute("vAngleBreakPoint"),g=i.owner.getAttribute("vAngleVector1"),h=i.owner.getAttribute("vAngleVector2");if("MeasureItem"===We&&n===t.ResultType.CONE&&null==c&&(i.owner._buildConstructionPointsForConeCylSphere(),l=e.getApex().clone(),c=e.arcCenter.clone(),g=e.vAxis.clone(),h=e.vSlat.clone()),l&&c&&g&&h){var b=g.clone(),y=i.owner.getAttribute("fAngle"),m=!1;if(y)(r.isZero(y)?0:180*y/Math.PI)>180&&(m=!0);var v=i.owner.getAttribute("fQuadrant");"MeasureItem"===We&&n===t.ResultType.CONE&&null==v&&(v=0),1!==v&&3!==v||b.negate();var P=h.clone();2!==v&&3!==v||P.negate(),s=c.clone().sub(l).length();var A=l.clone().add(b.clone().normalize().multiplyScalar(s)),f=l.clone().add(P.clone().normalize().multiplyScalar(s)),D=(new d.Vector3).crossVectors(b.clone(),P.clone()),S=(new d.Vector3).crossVectors(D.clone().normalize(),b.clone()),w=(new d.Vector3).crossVectors(D.clone().normalize(),P.clone());m&&(S.negate(),w.negate()),function(e,t,n,r,a,o,s,l,c,p,d,g,h){if(Xe){var b=u.createArcNode(r,a,o,s,Re.regularSolidLine,l);if(at(ze,b),Tt(Be,c,p,d,g,h),void 0!==t&&void 0!==n&&!n.equals(t)){var y=u.createLineNode(n,t,Re.regularSolidLine);at(ze,y)}"2D"===i.owner.getAttribute("sMeasureOnGeometryType")&&"MeasureBetween"===We&&(Lt(ze,e,a),Lt(ze,i.owner.getMeasurable(2),a))}}(e,p,c,s,l,b,P,m,A,f,S,w,o),"MeasureItem"===We&&n===t.ResultType.CONE?function(e,t,n,r,a){var o,s,l,c,p,g=e.vExtensionPoint1,h=e.vExtensionPoint2;g&&h||(s=(o=e.getPoints()).beginPoint.clone().sub(o.endPoint),l=M.getDistanceFromPixel(Pe,o.beginPoint,30),s.normalize().multiplyScalar(l),e.vExtensionPoint1=o.beginPoint.clone().add(s),e.vExtensionPoint2=o.endPoint.clone().sub(s),g=e.vExtensionPoint1.clone(),h=e.vExtensionPoint2.clone());var b=[];b.push(g.clone().toArray()),b.push(h.clone().toArray());var y=R._computePointCurveSquaredDistance(n.clone().toArray(),1,b),m=Math.sqrt(y.squaredDistance);c=new d.Vector3(y.aPosition1[0],y.aPosition1[1],y.aPosition1[2]),p=new d.Vector3(y.aPosition2[0],y.aPosition2[1],y.aPosition2[2]),t=m>et?p:c;var v=i.owner.getAttribute("sSurfaceDisplayType");if(at(ze,"Angle"===v?u.createLineNode(r,n,Re.regularSolidLine):u.createLineNode(t,n,Re.regularSolidLine)),"MinimumRadius"!==v&&"MinimumDiameter"!==v&&"MaximumRadius"!==v&&"MaximumDiameter"!==v){at(ze,u.createLineNode(r,a,Re.regularSolidLine));var P=e.getApex();y=R._computePointCurveSquaredDistance(P.clone().toArray(),1,b),(m=Math.sqrt(y.squaredDistance))>et&&(p=new d.Vector3(y.aPosition2[0],y.aPosition2[1],y.aPosition2[2]),at(ze,u.createLineNode(P,p,Re.regularSolidLine)))}}(e,void 0,A,l,f):n===t.ResultType.AXIS||a===t.ResultType.AXIS?function(e,n,r,a,o,s,l){var c,p,g,h,b=[];if(n===t.ResultType.AXIS){void 0!==e.vExtensionPoint1&&void 0!==e.vExtensionPoint2||(p=(c=e.getPoints()).beginPoint.clone().sub(c.endPoint),g=30,h=M.getDistanceFromPixel(Pe,c.beginPoint,g),p.normalize().multiplyScalar(h),e.vExtensionPoint1=c.beginPoint.clone().add(p),e.vExtensionPoint2=c.endPoint.clone().sub(p)),b.push(e.vExtensionPoint1.clone().toArray()),b.push(e.vExtensionPoint2.clone().toArray());var y=R._computePointCurveSquaredDistance(s.clone().toArray(),1,b);Math.sqrt(y.squaredDistance)>et?at(ze,u.createLineNode(s,o,Re.regularSolidLine)):(0===_e&&(y=R._computePointCurveSquaredDistance(o.clone().toArray(),1,b),a=Math.sqrt(y.squaredDistance)>et?new d.Vector3(y.aPosition2[0],y.aPosition2[1],y.aPosition2[2]):o),at(ze,u.createLineNode(a,o,Re.regularSolidLine)))}else at(ze,u.createLineNode(s,o,Re.regularSolidLine));if(r===t.ResultType.AXIS){var m=i.owner.getMeasurable(2);void 0!==m.vExtensionPoint1&&void 0!==m.vExtensionPoint2||(p=(c=m.getPoints()).beginPoint.clone().sub(c.endPoint),g=30,h=M.getDistanceFromPixel(Pe,c.beginPoint,g),p.normalize().multiplyScalar(h),m.vExtensionPoint1=c.beginPoint.clone().add(p),m.vExtensionPoint2=c.endPoint.clone().sub(p));var v=[];v.push(m.vExtensionPoint1.clone().toArray()),v.push(m.vExtensionPoint2.clone().toArray());var P,A=R._computePointCurveSquaredDistance(s.clone().toArray(),1,v);Math.sqrt(A.squaredDistance)>et?at(ze,u.createLineNode(s,l,Re.regularSolidLine)):(0===_e&&(A=R._computePointCurveSquaredDistance(l.clone().toArray(),1,v),P=Math.sqrt(A.squaredDistance)>et?new d.Vector3(A.aPosition2[0],A.aPosition2[1],A.aPosition2[2]):l),at(ze,u.createLineNode(P,l,Re.regularSolidLine)))}else at(ze,u.createLineNode(s,l,Re.regularSolidLine))}(e,n,a,void 0,A,l,f):Xe&&(at(ze,u.createLineNode(l,A,Re.regularSolidLine)),at(ze,u.createLineNode(l,f,Re.regularSolidLine)))}}function Gt(e,t){return e&&t&&(t===l.GeometryType.LINE||t===l.GeometryType.CYLINDER||t===l.GeometryType.CONE)}function Ht(e,n,r,a,o){var s=o;if(n===t.ResultType.AXIS&&r===t.ResultType.AXIS&&void 0!==a&&a<et&&i.owner.getAttribute("fDistance")){var l=i.owner.getAttribute("vExtensionDirection3D"),u=e.getPoints(),c=l.angleTo(u.beginPoint.clone().sub(u.endPoint));(c<et||Math.abs(c-Math.PI)<et)&&(s=!0)}return s}function Jt(e,n,a){var o,s,l,c,p,g,b,y,m=i.owner.getMeasurable(2),v=a.getType(),P=m.getType(),A="Distance"===i.owner.getAttribute("sDistanceType"),f=Gt(A,v),D=Gt(A,P),S=i.owner.getAttribute("vFirstPoint3D"),w=i.owner.getAttribute("vSecondPoint3D"),T=i.owner.getAttribute("vFirstExtensionPoint3D"),_=i.owner.getAttribute("vSecondExtensionPoint3D"),C=!1;if(C=Ht(a,e,n,i.owner.getAttribute("fAngle"),C),Ht(C),e===t.ResultType.AXIS||f){void 0!==a.vExtensionPoint1&&void 0!==a.vExtensionPoint2||(s=a.getPoints(),a.vExtensionPoint1=s.beginPoint.clone(),a.vExtensionPoint2=s.endPoint.clone(),e===t.ResultType.AXIS&&(l=s.beginPoint.clone().sub(s.endPoint),c=30,p=M.getDistanceFromPixel(Pe,s.beginPoint,c),l.normalize().multiplyScalar(p),a.vExtensionPoint1=s.beginPoint.clone().add(l),a.vExtensionPoint2=s.endPoint.clone().sub(l)));var L=[];L.push(a.vExtensionPoint1.clone().toArray()),L.push(a.vExtensionPoint2.clone().toArray());var x=R._computePointCurveSquaredDistance(T.clone().toArray(),1,L),E=Math.sqrt(x.squaredDistance);g=new d.Vector3(x.aPosition1[0],x.aPosition1[1],x.aPosition1[2]),b=new d.Vector3(x.aPosition2[0],x.aPosition2[1],x.aPosition2[2]),E>et?e!==t.ResultType.AXIS?(o=u.createLineNode(g.clone(),b.clone(),Re.regularDashedLine),at(ze,o)):(C||(o=u.createLineNode(g.clone(),b.clone(),Re.dotLine),at(ze,o)),(y=[]).push(T.clone().toArray()),C?y=L:r.areEqual(b,a.vExtensionPoint1,"Vector3")?y.push(a.vExtensionPoint2.clone().toArray()):y.push(a.vExtensionPoint1.clone().toArray()),x=R._computePointCurveSquaredDistance(S.clone().toArray(),1,y),T=Math.sqrt(x.squaredDistance)>et?new d.Vector3(x.aPosition2[0],x.aPosition2[1],x.aPosition2[2]):S):e===t.ResultType.AXIS&&0===_e&&(x=R._computePointCurveSquaredDistance(S.clone().toArray(),1,L),T=Math.sqrt(x.squaredDistance)>et?new d.Vector3(x.aPosition2[0],x.aPosition2[1],x.aPosition2[2]):S)}if(n===t.ResultType.AXIS||D){void 0!==m.vExtensionPoint1&&void 0!==m.vExtensionPoint2||(s=m.getPoints(),m.vExtensionPoint1=s.beginPoint.clone(),m.vExtensionPoint2=s.endPoint.clone(),n===t.ResultType.AXIS&&(l=s.beginPoint.clone().sub(s.endPoint),c=30,p=M.getDistanceFromPixel(Pe,s.beginPoint,c),l.normalize().multiplyScalar(p),m.vExtensionPoint1=s.beginPoint.clone().add(l),m.vExtensionPoint2=s.endPoint.clone().sub(l)));var V=[];V.push(m.vExtensionPoint1.clone().toArray()),V.push(m.vExtensionPoint2.clone().toArray());var N=R._computePointCurveSquaredDistance(_.clone().toArray(),1,V),k=Math.sqrt(N.squaredDistance);g=new d.Vector3(N.aPosition1[0],N.aPosition1[1],N.aPosition1[2]),b=new d.Vector3(N.aPosition2[0],N.aPosition2[1],N.aPosition2[2]),k>et?n!==t.ResultType.AXIS?(o=u.createLineNode(g.clone(),b.clone(),Re.regularDashedLine),at(ze,o)):(C||(o=u.createLineNode(g.clone(),b.clone(),Re.dotLine),at(ze,o)),(y=[]).push(_.clone().toArray()),C?y=V:r.areEqual(b,m.vExtensionPoint1,"Vector3")?y.push(m.vExtensionPoint2.clone().toArray()):y.push(m.vExtensionPoint1.clone().toArray()),N=R._computePointCurveSquaredDistance(w.clone().toArray(),1,y),_=Math.sqrt(N.squaredDistance)>et?new d.Vector3(N.aPosition2[0],N.aPosition2[1],N.aPosition2[2]):w):n===t.ResultType.AXIS&&0===_e&&(N=R._computePointCurveSquaredDistance(w.clone().toArray(),1,V),_=Math.sqrt(N.squaredDistance)>et?new d.Vector3(N.aPosition2[0],N.aPosition2[1],N.aPosition2[2]):w)}at(ze,function(e,t,i,n,a,o){var s=new h;if(e&&t&&i&&n){var l=t.clone(),c=n.clone();a&&(l.add(e).multiplyScalar(.5),c.add(i).multiplyScalar(.5));var p=u.createLineNode(i.clone(),e.clone(),o);r.areEqual(i,e,"Vector3")||at(s,p);var d=u.createLineNode(c.clone(),l.clone(),o);r.areEqual(c,l,"Vector3")||at(s,d)}return s}(S,w,T,_,!1,Re.regularSolidLine))}function qt(e){var t=e.leaderStyle&&void 0!==e.leaderStyle.thickness?e.leaderStyle.thickness:e.lineStyle.thickness;return Math.max(2*t+4,De)}function Xt(e,n,r,a){var o,s=i.owner.getAttribute("vFirstExtensionPoint3D"),l=i.owner.getAttribute("vSecondExtensionPoint3D");n===t.ResultType.CURVE&&(s=(o=e.getPoints()).beginPoint.clone(),l=o.endPoint.clone());var u={value:5,scale:1};a=qt(r);var c=i.owner.getAttribute("sExtremityType");void 0!==c&&(u=Ut(c));var p=r.lineStyle.color,h=u.value;8!==h&&9!==h||(h=5);var b=_.retrieveMaterialFromGAS({size:a,withoutDPR:!0,scale:u.scale,symbol:h,color:new d.Color(p)});b.force=!0,at(Ue,g.createPointsNode({positions:s.toArray(),material:b})),at(Ue,g.createPointsNode({positions:l.toArray(),material:b}))}function Wt(e,n,a,s){var c,p="MeasureItem"===We,h="MeasureBetween"===We,b="MeasureThickness"===We;p&&n!==t.ResultType.LINE&&n!==t.ResultType.CIRCLE&&n!==t.ResultType.CONE&&n!==t.ResultType.CYLINDER||(O&&Y&&se&&Q||Be.removeChildren(),ze.removeChildren(),kt(),h&&(Re.regularSolidLine.lineWidth=s.leaderStyle&&void 0!==s.leaderStyle.thickness?s.leaderStyle.thickness:s.lineStyle.thickness),c=i.owner.isReadOnly()&&Xe&&n===t.ResultType.CIRCLE,h||b||p&&(n===t.ResultType.CONE||c)?((h||p&&(n===t.ResultType.CONE&&"Length"!==i.owner.getAttribute("sSurfaceDisplayType")&&"Area"!==i.owner.getAttribute("sSurfaceDisplayType")||c))&&zt(e,n,a,s),Vt()&&!c&&function(e,n,r,a){var o="MeasureBetween"===We||"MeasureItem"===We&&(e===t.ResultType.CONE||e===t.ResultType.CYLINDER)&&"Length"===i.owner.getAttribute("sSurfaceDisplayType");_t(Be,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,!1,a,o),"MeasureBetween"===We?Jt(e,n,r):at(ze,Ct(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("vSecondExtensionPoint3D"),!1,a))}(n,a,e,s)):p?function(e,n){switch(e){case t.ResultType.LINE:_t(Be,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,!1,n,!0),at(ze,Ct(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("vSecondExtensionPoint3D"),!1,n));break;case t.ResultType.CIRCLE:if(0!==i.owner.getAttribute("iRadiusResultDisplayType")){var a=i.owner.getAttribute("vArcMidPoint"),o=i.owner.getAttribute("vFirstExtensionPoint3D");r.areEqual(a,o,"Vector3")||i.owner._buildConstructionData(),_t(Be,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,i.owner.getAttribute("bRadiusDisplay"),n,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay")),at(ze,Ct(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("bRadiusDisplay")?i.owner.getAttribute("vSecondPoint3D"):i.owner.getAttribute("vSecondExtensionPoint3D"),!1,n))}break;case t.ResultType.CYLINDER:"Length"===i.owner.getAttribute("sSurfaceDisplayType")&&(_t(Be,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,!1,n,!0),at(ze,Ct(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("vSecondExtensionPoint3D"),!1,n)))}}(n,s):"Measure3PointsCircle"===We?i.owner.getAttribute("iRadiusResultDisplayType")!==t.RadiusResultDisplayType.CENTER&&(_t(Be,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,i.owner.getAttribute("bRadiusDisplay"),s,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay")),at(ze,Ct(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("vSecondExtensionPoint3D"),i.owner.getAttribute("bRadiusDisplay"),s))):"Measure3PointsAngle"===We&&function(e,t){var n=i.owner.getAttribute("vAngleVector1").clone(),a=i.owner.getAttribute("vAngleVector2").clone(),s=i.owner.getAttribute("fQuadrant"),c=!1;if(void 0!==s){1!==s&&3!==s||n.negate(),2!==s&&3!==s||a.negate();var p=n.angleTo(a);p!==i.owner.getAttribute("fAngle")&&i.owner.setAttribute("fAngle",p)}else{var h=i.owner.getAttribute("fAngle");(r.isZero(h)?0:180*h/Math.PI)>180&&(c=!0)}var b=i.owner.getAttribute("vAnglePointingPoint"),y=i.owner.getAttribute("bHasALeader"),m=i.owner.getAttribute("vAngleBreakPoint"),v=Re.regularSolidLine;if(void 0!==y&&void 0!==b&&void 0!==m&&!0===y){v=Re.regularSolidLine;var P=u.createLineNode(i.owner.getAttribute("vAnglePointingPoint"),i.owner.getAttribute("vAngleBreakPoint"),v);at(ze,P),Re.crossPoint.force=!0;var A=g.createPointsNode({positions:b.clone().toArray(),material:Re.crossPoint}),f=g.createPointsNode({positions:m.clone().toArray(),material:Re.crossPoint});at(ze,A),at(ze,f)}var M=i.owner.getAttribute("vAngleArcCenter"),D=i.owner.getAttribute("vAnglePointingPoint").clone().sub(M).length(),S=u.createArcNode(D,M,n,a,v,c);at(ze,S);var w=i.owner.getMeasurable(2);if(w){var T,_=M.clone().add(n.clone().normalize().multiplyScalar(D)),C=o.computePointSegmentDistance(_.toArray(),e.getSelPoint().toArray(),w.getSelPoint().toArray());0===C.returnCode&&C.relationship!==l.Relationship.COINCIDENT&&(T=new d.Vector3(C.aPosition[0],C.aPosition[1],C.aPosition[2]),at(ze,u.createLineNode(T,_,Re.regularSolidLine)));var R=M.clone().add(a.clone().normalize().multiplyScalar(D)),L=(new d.Vector3).crossVectors(n.clone(),a.clone()),x=(new d.Vector3).crossVectors(L.clone().normalize(),n.clone()),E=(new d.Vector3).crossVectors(L.clone().normalize(),a.clone());c&&(x.negate(),E.negate()),Tt(Be,_,R,x,E,t),0===(C=o.computePointSegmentDistance(R.toArray(),i.owner.getMeasurable(3).getSelPoint().toArray(),w.getSelPoint().toArray())).returnCode&&C.relationship!==l.Relationship.COINCIDENT&&(T=new d.Vector3(C.aPosition[0],C.aPosition[1],C.aPosition[2]),at(ze,u.createLineNode(T,R,Re.regularSolidLine)))}}(e,s),Nt())}function Zt(e,n,a,o,s){var c,p=i.owner.getMeasurable(2);if(p){if("MeasureBetween"===We&&function(e,n,a,o){var s,l,c,p,d,h=i.owner.getAttribute("vFirstExtensionPoint3D"),b=i.owner.getAttribute("vSecondExtensionPoint3D");if(!r.areEqual(h,b,"Vector3")){var y,m,v=n,P=a,A=void 0!==i.owner.getAttribute("fAngle")&&r.isZero(i.owner.getAttribute("fAngle"));v===t.ResultType.PLANE&&P===t.ResultType.PLANE&&A?(o.force=!0,y=g.createPointsNode({positions:h.clone().toArray(),material:o}),at(Ue,y),m=g.createPointsNode({positions:b.clone().toArray(),material:o}),at(Ue,m)):v===t.ResultType.AXIS&&P===t.ResultType.AXIS&&A||!i.owner.getAttribute("fDistance")||(o.force=!0,y=g.createPointsNode({positions:h.clone().toArray(),material:o}),at(Ue,y),m=g.createPointsNode({positions:b.clone().toArray(),material:o}),at(Ue,m))}n===t.ResultType.AXIS&&(c=(l=e.getPoints()).beginPoint.clone().sub(l.endPoint),p=30,d=M.getDistanceFromPixel(Pe,l.beginPoint,p),c.normalize().multiplyScalar(d),e.vExtensionPoint1=l.beginPoint.clone().add(c),e.vExtensionPoint2=l.endPoint.clone().sub(c),at(Oe,u.createLineNode(e.vExtensionPoint1,e.vExtensionPoint2,Re.dotDashedLine))),a===t.ResultType.AXIS&&(c=(l=(s=i.owner.getMeasurable(2)).getPoints()).beginPoint.clone().sub(l.endPoint),p=30,d=M.getDistanceFromPixel(Pe,l.beginPoint,p),c.normalize().multiplyScalar(d),s.vExtensionPoint1=l.beginPoint.clone().add(c),s.vExtensionPoint2=l.endPoint.clone().sub(c),at(Oe,u.createLineNode(s.vExtensionPoint1,s.vExtensionPoint2,Re.dotDashedLine)))}(e,n,a,s),n===t.ResultType.AXIS||n===t.ResultType.PLANE?Xe||"MeasureBetween"===We||Et(Oe,Ne,e,n,i.owner.getAttribute("vFirstExtensionPoint3D")):n===t.ResultType.CURVE&&e.getType()===l.GeometryType.LINE?"MeasureBetween"!==We&&Et(Oe,Ne,e,t.ResultType.LINE,i.owner.getAttribute("vFirstExtensionPoint3D")):n===t.ResultType.LINE&&a===t.ResultType.LINE&&"Distance"===i.owner.getAttribute("sDistanceType")&&Et(Oe,ke,p,a,i.owner.getAttribute("vSecondExtensionPoint3D")),a===t.ResultType.AXIS||a===t.ResultType.PLANE?Xe||"MeasureBetween"===We||Et(Oe,ke,p,a,i.owner.getAttribute("vSecondExtensionPoint3D")):a===t.ResultType.CURVE&&p.getType()===l.GeometryType.LINE&&"MeasureBetween"!==We&&Et(Oe,ke,p,t.ResultType.LINE,i.owner.getAttribute("vSecondExtensionPoint3D")),qe&&"MeasureBetween"!==We){var b="MeasureThickness"===We?Re.avatarDottedLine:Re.regularDashedLine,y=(m=i.owner.getAttribute("vFirstExtensionPoint3D"),v=i.owner.getAttribute("vSecondExtensionPoint3D"),P=o.leaderStyle&&o.leaderStyle.color?o.leaderStyle.color:o.lineStyle.color,f=o.fillStyle.color,D=b,w=new h,T=!0,0===i.owner._bCreateMeasureInShowSpace&&(T=!1),m&&(null!==w._nAnchor1SpriteNode&&w.remove(w._nAnchor1SpriteNode),w._nAnchor1SpriteNode=Rt(m,P,f),w._nAnchor1SpriteNode.setVisibility(T),at(w,w._nAnchor1SpriteNode)),v&&(null!==w._nAnchor2SpriteNode&&w.remove(w._nAnchor2SpriteNode),w._nAnchor2SpriteNode=Rt(v,P,f),w._nAnchor2SpriteNode.setVisibility(T),at(w,w._nAnchor2SpriteNode)),m&&v&&(void 0===S||!0===S)&&at(w,u.createLineNode(m,v,D)),w);at(Ue,y)}else Xe||"MeasureBetween"===We||((c=Rt(i.owner.getAttribute("vFirstExtensionPoint3D"),o.leaderStyle&&o.leaderStyle.color?o.leaderStyle.color:o.lineStyle.color,o.fillStyle.color)).setVisibility(0!==i.owner._bCreateMeasureInShowSpace),at(Ue,c));var m,v,P,f,D,S,w,T;if("MeasureThickness"===We){var _=o.lineStyle.thickness;_=Math.max(2*_+4,10),_/=8;var C=new h,R=new A({ratio:7}),L=u.createCircleNode(_,new d.Vector3(0,0,0),new d.Vector3(0,0,1),Re.regularSolidLine),x=new A({ratio:7}),E=u.createCircleNode(_,new d.Vector3(0,0,0),new d.Vector3(0,0,1),Re.regularSolidLine),V=r.computeTransformationBetweenTwoLines(new d.Vector3,new d.Vector3(0,0,1),e.getSelPoint(),e.getSelNormal());R.setMatrix(V.transformation),R.addChild(L),V=r.computeTransformationBetweenTwoLines(new d.Vector3,new d.Vector3(0,0,1),i.owner.getAttribute("vSecondExtensionPoint3D"),e.getSelNormal()),x.setMatrix(V.transformation),x.addChild(E),C.addChild(R),C.addChild(x),at(Oe,C)}}}function jt(e,n,r,a,o){var s,l,u,c,p,b,y;function m(){l&&(a.force=!0,u=g.createPointsNode({positions:l,material:a}),at(Ue,u))}switch(n){case t.ResultType.POINT:l=e.getSelPoint().toArray(),m();break;case t.ResultType.CENTER:l=e.getCenter().toArray(),m();break;case t.ResultType.AXIS:xt(Oe,Ne,e,n,Re.dotDashedLine);break;case t.ResultType.CIRCLE:!function(e,t,n,r){var a,o,s,l,u,c,p,h,b,y=i.owner.getAttribute("iRadiusResultDisplayType");if(xt(Oe,Ne,e,t,Re.regularSolidLine),i.owner.getAttribute("bArcLengthDisplay"))c=(b=e.getPoints()).beginPoint.clone(),p=b.endPoint.clone(),a={value:5,scale:1},r=qt(n),void 0!==(o=i.owner.getAttribute("sExtremityType"))&&(a=Ut(o)),s=n.lineStyle.color,8!==(l=a.value)&&9!==l||(l=5),(u=_.retrieveMaterialFromGAS({size:r,withoutDPR:!0,scale:a.scale,symbol:l,color:new d.Color(s)})).force=!0,at(Ue,g.createPointsNode({positions:c.toArray(),material:u})),at(Ue,g.createPointsNode({positions:p.toArray(),material:u}));else if(0===y){var m=e.getSelPoint(),v=i.owner.getAttribute("vCenter").clone();h=v.clone();var P=!0;if(!1===i.owner.getAttribute("bRadiusDisplay")){var A=v.clone().sub(m);h=v.clone().add(A),P=!1}m||(m=i.owner.getAttribute("vLeaderPointingPoint3D")),_t(Ue,m.clone(),h.clone(),void 0,!1,!1,n,!0,!1,!0,P)}}(e,n,r,o);break;case t.ResultType.CURVE:case t.ResultType.LINE:Xt(e,n,r,o);break;case t.ResultType.PLANE:xt(Oe,Ne,e,n,Re.regularSolidLine);break;case t.ResultType.CYLINDER:"Length"===(y=i.owner.getAttribute("sSurfaceDisplayType"))?Xt(e,n,r,o):"Area"!==y&&(xt(Oe,Ne,e,n,Re.regularSolidLine),c=i.owner.getAttribute("vFirstPoint3D"),p=i.owner.getAttribute("vSecondPoint3D"),b=i.owner.getAttribute("vLeaderBreakPoint3D"),void 0===_e&&(c=(s=i.owner._buildConstructionPointsForConeCylSphere()).oPos1,p=s.oPos2,b=c.clone()),y&&"Radius"!==y&&"Diameter"!==y&&"MinimumRadius"!==y&&"MinimumDiameter"!==y&&"MaximumRadius"!==y&&"MaximumDiameter"!==y||_t(Ue,c,p,b,!1,i.owner.getAttribute("bRadiusDisplay"),r,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay")));break;case t.ResultType.CONE:"Length"===(y=i.owner.getAttribute("sSurfaceDisplayType"))?Xt(e,n,r,o):"Area"!==y&&(xt(Oe,Ne,e,n,Re.regularSolidLine),"MinimumRadius"!==y&&"MinimumDiameter"!==y&&"MaximumRadius"!==y&&"MaximumDiameter"!==y||_t(Ue,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!1,i.owner.getAttribute("bRadiusDisplay"),r,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay")));break;case t.ResultType.SPHERE:xt(Oe,Ne,e,n,Re.regularSolidLine),c=i.owner.getAttribute("vFirstPoint3D"),p=i.owner.getAttribute("vSecondPoint3D"),b=i.owner.getAttribute("vLeaderBreakPoint3D"),void 0===_e&&(c=(s=i.owner._buildConstructionPointsForConeCylSphere()).oPos1,p=s.oPos2,b=c.clone()),_t(Oe,c,p,b,!1,i.owner.getAttribute("bRadiusDisplay"),r,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay"));break;case t.ResultType.SURFACE:xt(Oe,Ne,e,n,Re.regularSolidLine);break;case t.ResultType.PRODUCT:Ne=function(e,t,i){for(var n=new h,r=[],a=Number.MAX_VALUE,o=0;o<3;o++)r[o]=e[o+3]-e[o],a=Math.min(a,r[o]);a/=10;var s=[];s[0]=new d.Vector3(a,0,0),s[1]=new d.Vector3(0,a,0),s[2]=new d.Vector3(0,0,a);var l=[],u=[],c=new d.Vector3(e[0],e[1],e[2]);for(l[0]=0;l[0]<2;l[0]++)for(l[1]=0;l[1]<2;l[1]++)for(l[2]=0;l[2]<2;l[2]++){var p=4*l[0]+2*l[1]+l[2];u[p]=[],u[p][0]=new d.Vector3(l[0]*r[0],l[1]*r[1],l[2]*r[2]).add(c);for(var b=0;b<3;b++)u[p][b+1]=s[b].clone().multiplyScalar(1-2*l[b]).add(u[p][0]);var y=[u[p][1],u[p][0],u[p][2],u[p][0],u[p][3]],m=g.createLineNode({points:y,material:t});m.setShadow(!1),at(n,m)}var v=[u[0][0],u[4][0],u[6][0],u[2][0],u[0][0],u[1][0],u[5][0],u[4][0],u[5][0],u[7][0],u[6][0],u[7][0],u[3][0],u[2][0],u[3][0],u[1][0]],P=g.createLineNode({points:v,material:i});return P.setShadow(!1),at(n,P),n}(i.owner.getAttribute("aabb"),Re.avatarSolidLine,Re.avatarDashedLine),at(Oe,Ne)}}function Yt(e,n,r,a){Oe.removeChildren(),Ue.removeChildren();var o,s={value:0,scale:1},l=a.lineStyle.color,c=qt(a),p=i.owner.getAttribute("sPointType");if(void 0!==p&&(s=Ut(p)),0===s.value)o=_.retrieveMaterialFromGAS({color:new d.Color(l)});else{var h=s.value;8!==h&&9!==h||(h=5),o=_.retrieveMaterialFromGAS({size:c,scale:s.scale,withoutDPR:!0,symbol:h,color:new d.Color(l)})}"MeasureBetween"===We||"MeasureThickness"===We?Zt(e,n,r,a,o):"MeasureItem"===We?jt(e,n,a,o,c):"Measure3PointsCircle"===We?function(e,n,r){var a=i.owner.getMeasurable(2),o=i.owner.getMeasurable(3),s=u.createCircleNode(i.owner.getAttribute("fRadius"),i.owner.getAttribute("vCenter"),i.owner.getAttribute("vNormal"),Re.regularSolidLine);if(at(Oe,s),n.force=!0,at(Ue,g.createPointsNode({positions:e.getSelPoint().clone().toArray(),material:n})),at(Ue,g.createPointsNode({positions:a.getSelPoint().clone().toArray(),material:n})),at(Ue,g.createPointsNode({positions:o.getSelPoint().clone().toArray(),material:n})),i.owner.getAttribute("iRadiusResultDisplayType")===t.RadiusResultDisplayType.CENTER){var l=i.owner.getAttribute("vCenter").clone();!1===i.owner.getAttribute("bRadiusDisplay")&&(l=i.owner.getAttribute("vSecondExtensionPoint3D").clone()),_t(Ue,i.owner.getAttribute("vFirstExtensionPoint3D").clone(),l.clone(),void 0,!1,!1,r,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay"))}}(e,o,a):"Measure3PointsAngle"===We&&function(e,t){var n=i.owner.getMeasurable(2),r=i.owner.getMeasurable(3);at(Oe,u.createLineNode(e.getSelPoint(),n.getSelPoint(),Re.regularSolidLine)),at(Oe,u.createLineNode(r.getSelPoint(),n.getSelPoint(),Re.regularSolidLine)),t.force=!0,at(Ue,g.createPointsNode({positions:e.getSelPoint().clone().toArray(),material:t})),at(Ue,g.createPointsNode({positions:n.getSelPoint().clone().toArray(),material:t})),at(Ue,g.createPointsNode({positions:r.getSelPoint().clone().toArray(),material:t}))}(e,o)}function Qt(e){var t=!1;switch(e){case"AnchorAndAvatar":t=!(O&&U&&B&&Y&&le&&H&&X&&se&&ae&&oe&&Q);break;case"DimensionGroup":t=!(O&&U&&G&&B&&H&&J&&q&&X&&Q&&W&&Z&&j&&Y&&K&&$&&ee&&te&&ie&&ne&&re&&se);break;case"LableContent":t=!(O&&F&&ue&&H&&K&&U&&B&&z&&ce&&pe&&de&&ge&&he&&ye&&me&&Y&&ve);break;case"Leader":t=!(O&&z&&Z&&j&&U&&Y&&se)}return t}this.getPixelFontSize=function(e){var t;return i.owner.getAttribute("iFontSize")&&(t=M.convertPixelToModel({sizeInPixels:i.owner.getAttribute("iFontSize")*(4/3),viewer:Pe})),t||(t=i.owner.getAttribute(e)),M.convertModelToPixels({sizeInMM:t,viewer:Pe})},this.getTooltip=function(){var t=[];if(!i.owner.getAttribute("sTextGraphicRepresentation")&&Ee)return Ee.length&&Ee.length>50&&(He=!0),t.push(Ee),Ve&&(t.push("\n"+Ve),!He&&Ve.length&&Ve.length>50&&(He=!0)),function(t){var i;if(rt()){if(t&&t.length){i=e.createElement("div");for(var n=0;n<t.length;n++)e.createElement("p",{styles:{margin:"2px",padding:0}}).inject(i).setText(t[n])}return i}}(t)},this.processPathForTrimedText=function(e){var t=e;if(i.owner.getAttribute("bShortDisplay")||!Ee||i.owner.getAttribute("sTextGraphicRepresentation")||i.owner.getAttribute("stextGraphicRepresentationAngle"))return t;if(Ee.length&&Ee.length>50||Ve&&Ve.length&&Ve.length>50){var n=t.pathElement.hash();n+="000/",t.pathElement._hash=n}return t},this.getBoxPosition=function(){var e=Ie.getDimensions();return{top:-e.offsetHeight/2,left:-e.offsetWidth/2}},this.update=function(e,n){if(null!==$e&&-1!==i.owner.getAttribute("sSelectedType1")){_e=i.owner.getAttribute("iExtensionLinesManipulable"),Ce(),We=i.owner.getAttribute("sType"),n&&(Ze=void 0);var a=i.owner.getMeasurable(1);if(a){var o,s,l=lt(),u=i.owner.getAttribute("sResultingType1"),c=i.owner.getAttribute("sResultingType2"),p=!!e||!O;Ye||(Ye=!1),V=Ot("UnitLength","string"),N=Ot("UnitAngle","string"),k=Ot("UnitArea","string"),I=Ot("UnitVolume","string"),F=V&&N&&k&&I,(O=void 0!==Ze&&Ze===We)||(Ze=We),U=Ot("LineStyleColor","Color"),B=Ot("FillStyleColor","Color"),z=Ot("LineStyleThickness","float"),G=Ot("LeaderStyleThickness","float"),H=Ot("Distance","float"),J=Ot("FirstPoint3D","Vector3"),q=Ot("SecondPoint3D","Vector3"),X=Ot("FirstExtensionPoint3D","Vector3"),W=Ot("SecondExtensionPoint3D","Vector3"),Z=Ot("LeaderBreakPoint3D","Vector3"),j=Ot("LeaderPointingPoint3D","Vector3"),Y=Ot("RadiusDisplay","bool"),Q=Ot("ArcLengthDisplay","bool"),K=Ot("Angle","float"),$=Ot("AngleBreakPoint","Vector3"),ee=Ot("Quadrant","float"),te=Ot("AngleArcCenter","Vector3"),ie=Ot("AnglePointingPoint","Vector3"),ne=Ot("AngleVector1","Vector3"),re=Ot("AngleVector2","Vector3"),ae=Ot("PointType","string"),oe=Ot("ExtremityType","string"),se=!0,("MeasureItem"===We&&i.owner.getAttribute("sResultingType1")===t.ResultType.CIRCLE||"Measure3PointsCircle"===We)&&(se=Ot("RadiusResultDisplayType","int")),z&&G||(ae=!1,oe=!1),le=Ot("aabb","AABB"),ue=Ot("ShortDisplay","bool"),ce=Ot("IsFilled","bool"),pe=Ot("HasBorder","bool"),de=Ot("HasALeader","bool"),ge=Ot("FontColor","Color"),he=Ot("FontName","string"),(void 0!==(be=Ke.getPixelFontSize("fFontSize"))||void 0!==$e.FontSize&&be===$e.FontSize)&&($e.FontSize=be),ye=Ot("FontSize","float"),me=Ot("Opacity","float"),ve=Ye===i.owner.isInEdition(),Ye||(B=!1,U=!1),Ye=i.owner.isInEdition(),function(e){if(!O){var n,a=i.owner.getAttribute("sSurfaceDisplayType");"MeasureItem"===We?e!==t.ResultType.CONE||"Angle"!==a&&"HalfAngle"!==a||(n=i.owner.getAttribute("fSemiAngle")):n=i.owner.getAttribute("fAngle"),Xe=void 0!==n&&!r.isZero(n);var o=i.owner.getAttribute("fDistance");qe="MeasureItem"===We&&e!==t.ResultType.CONE||"MeasureItem"===We&&!Xe&&e===t.ResultType.CONE||"Measure3PointsCircle"===We||"MeasureThickness"===We||void 0!==o&&!(r.isZero(o)&&Xe),"MeasureBetween"===We&&void 0!==i.owner.getAttribute("sDistanceType")&&("Angle"===i.owner.getAttribute("sDistanceType")&&Xe?qe=!1:(Xe=!1,qe=!0))}}(u),Ft(p),function(e){if(!U||!B){var t=e.lineStyle.color;Re.regularSolidLine.color=!0===i.owner._bPrevisualized&&"MeasureThickness"===We?Me:e.leaderStyle&&e.leaderStyle.color?e.leaderStyle.color:t,Re.regularDashedLine.color=e.leaderStyle&&e.leaderStyle.color?e.leaderStyle.color:t,Re.avatarSolidLine.color=e.fillStyle.color,Re.avatarDashedLine.color=e.fillStyle.color,Re.avatarDottedLine.color=!0===i.owner._bPrevisualized&&"MeasureThickness"===We?Me:t,Re.dotDashedLine.color=t,Re.dotLine.color=t,Re.crossPoint.color=t}}(l),Qt("DimensionGroup")&&Wt(a,u,c,l),Qt("AnchorAndAvatar")&&Yt(a,u,c,l),Qt("LableContent")&&(Z=!1,function(e,n){Ie.setVisibility(qe),0===i.owner._bCreateMeasureInShowSpace?qe?Ie.setVisibility(!qe):(Ie.setVisibility(qe),Ie.setVisibilityFree(!qe)):1===i.owner._bCreateMeasureInShowSpace&&(Ie.setVisibility(qe),Ie.setVisibilityFree(!qe)),!qe&&Xe&&ve||(kt(),Ie.modify({content:St(i.owner.getAttribute("bShortDisplay"),We,i.owner.getAttribute("fDistance"),i.owner.getAttribute("sMeasureOnGeometryType"),i.owner.getAttribute("sDistanceType")),commentContent:i.owner.getAttribute("sCommentOnMeasure"),position:i.owner.getAttribute("vLeaderBreakPoint3D"),isFilled:i.owner.getAttribute("bIsFilled"),hasBorder:i.owner.getAttribute("bHasBorder"),graphicProperties:n,inEdition:i.owner.isInEdition(),boxRotationAngle:i.owner.getAttribute("fBoxRotationAngle"),tessRep:i.owner.getAttribute("sTextGraphicRepresentation")}),Nt()),Fe.setVisibility(Xe),0===i.owner._bCreateMeasureInShowSpace?(Xe?Fe.setVisibility(!Xe):Fe.setVisibility(Xe),Fe.setVisibilityFree(!Xe)):1===i.owner._bCreateMeasureInShowSpace&&(Fe.setVisibility(Xe),Fe.setVisibilityFree(!Xe)),Xe&&(kt(),Fe.modify({content:wt(i.owner.getAttribute("bShortDisplay"),We,"MeasureItem"===We&&e===t.ResultType.CONE?i.owner.getAttribute("fSemiAngle"):i.owner.getAttribute("fAngle"),!qe,i.owner.getAttribute("sMeasureOnGeometryType")),position:i.owner.getAttribute("vAngleBreakPoint"),isFilled:i.owner.getAttribute("bIsFilled"),hasBorder:i.owner.getAttribute("bHasBorder"),graphicProperties:n,boxRotationAngle:i.owner.getAttribute("fBoxRotationAngle"),tessRep:i.owner.getAttribute("stextGraphicRepresentationAngle")}),Nt())}(u,l)),O&&Z||!qe&&Xe||(kt(),Ie.modify({position:i.owner.getAttribute("vLeaderBreakPoint3D")}),Nt()),O&&$||Xe&&(kt(),Fe.modify({position:i.owner.getAttribute("vAngleBreakPoint")}),Nt()),Qt("Leader")&&Bt(),o=!i.owner.getAttribute("bCollapsedDisplay"),s=1===i.owner._bCreateMeasureInShowSpace?o:!o,Oe.setVisibility(s),Be.setVisibility(s),ze.setVisibility(s),Ge.setVisibility(s),Ie&&Ie.isVisible()&&!o&&Ie.setVisibility(o),Fe&&Fe.isVisible()&&!o&&Fe.setVisibility(o),Ie&&1===i.owner._bCreateMeasureInShowSpace&&Ie.setVisibilityFree(!Ie.isVisible()),Fe&&1===i.owner._bCreateMeasureInShowSpace&&Fe.setVisibilityFree(!Fe.isVisible()),Ke.setName(i.owner.getAttribute("sName")),Ke._updateVisibility()}}},this.updateRepresentation=function(e){if(Vt()){var t=e.position.clone(),n=i.owner.getAttribute("vSecondExtensionPoint3D").clone().sub(i.owner.getAttribute("vFirstExtensionPoint3D")),r=n.lengthSq();if(r>1e-6){var a=t;if(0===_e){var o=(new d.Plane).setFromCoplanarPoints(i.owner.getAttribute("vFirstExtensionPoint3D").clone(),i.owner.getAttribute("vFirstPoint3D").clone(),i.owner.getAttribute("vSecondPoint3D").clone()),s=M.getViewpointInfo(Pe.currentViewpoint),u=L.computeLinePlaneDistance(a.clone().toArray(),s.sight.toArray(),i.owner.getAttribute("vFirstPoint3D").clone().toArray(),o.normal.toArray());a=u&&0===u.returnCode&&u.relationship===l.Relationship.INTERSECTING?new d.Vector3(u.aPosition[0],u.aPosition[1],u.aPosition[2]):o.projectPoint(t)}var c=n.dot(i.owner.getAttribute("vFirstExtensionPoint3D").clone().sub(a))/r,p=n.multiplyScalar(-c).add(i.owner.getAttribute("vFirstExtensionPoint3D")),g=a.clone().sub(p);i.owner.setAttribute("vFirstPoint3D",i.owner.getAttribute("vFirstExtensionPoint3D").clone().add(g)),i.owner.setAttribute("vSecondPoint3D",i.owner.getAttribute("vSecondExtensionPoint3D").clone().add(g)),i.owner.setAttribute("vLeaderBreakPoint3D",a);var h=i.owner.getAttribute("vFirstPoint3D").clone().add(i.owner.getAttribute("vSecondPoint3D")).multiplyScalar(.5);i.owner.setAttribute("vLeaderPointingPoint3D",h)}}else i.owner.setAttribute("vLeaderBreakPoint3D",e.position);i.owner.setAttribute("fBoxRotationAngle",e.rotationAngle),It(),i.owner.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:i.owner})},this.getLabelParams=function(){var e={},t=Xe&&!qe?Fe.getDimensions():Ie.getDimensions();return e.position=Xe&&!qe?i.owner.getAttribute("vAngleBreakPoint"):i.owner.getAttribute("vLeaderBreakPoint3D"),e.rotationAngle=i.owner.getAttribute("fBoxRotationAngle")?i.owner.getAttribute("fBoxRotationAngle"):0,e.width=t.width,e.height=t.height,e},this.hasTessellatedRepresentation=function(){return i.owner.getAttribute("stextGraphicRepresentationAngle")&&i.owner.getAttribute("stextGraphicRepresentationAngle").length||i.owner.getAttribute("sTextGraphicRepresentation")&&i.owner.getAttribute("sTextGraphicRepresentation").length},this.getRepNode=function(){return{avatar:Oe,anchor:Ue,dimensionArrow:Be,dimensionExtension:ze,leader:Ge,box:Xe&&!qe?Fe.getLabelNode():Ie.getLabelNode()}},this.getLabelDimensions=function(){var e=Xe&&!qe?Fe.getDimensions():Ie.getDimensions();return e.position=Xe&&!qe?i.owner.getAttribute("vAngleBreakPoint"):i.owner.getAttribute("vLeaderBreakPoint3D"),e},this.onViewerEventCB=function(e){"beginExplodeCmd"!==e.eventType&&"endExplodeCmd"!==e.eventType&&"onPreferenceModified"!==e.eventType||Ke.update(null,!0),"MeasureThickness"===We&&"@onViewpointChange"===e.eventType&&$e.LeaderStyleThickness&&($e.bSameFirstPoint3D=-1,Ke.update())};var Kt=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){Kt(),Ke=Re=$e=Ne=ke=Ie=Fe=Oe=null,Ue=Be=ze=Ge=Pe=null},this._updateVisibility=function(e,t){var n=i.owner.isMeasureDisplayed();if(0===i.owner.getAttribute("bCreateMeasureInShowSpace"))n=!!i.owner.getAttribute("bCollapsedDisplay")||!n;else if(n){n=!i.owner.getAttribute("bCollapsedDisplay")}void 0!==e&&(tt=e),n=n&&tt>0,Ke.setVisibility(n);let r=t&&tt<1;Oe&&Oe.setVisibility(!r&&n),Ue&&Ue.setVisibility(!r&&n),Be&&Be.setVisibility(!r&&n),ze&&ze.setVisibility(!r&&n),Ge&&Ge.setVisibility(!r&&n),qe&&Ie&&Ie.setVisibility(n),Xe&&Fe&&Fe.setVisibility(n),(0===Pe.getVisibleSpace()&&!n||1===Pe.getVisibleSpace()&&n)&&tt>0&&Bt(),n&&tt>0&&(Ie&&Ie.setOpacity(tt),Fe&&Fe.setOpacity(tt)),Pe.render()},Ie=new f({window:i.frmWindow,content:[""],position:i.owner.getAttribute("vLeaderBreakPoint3D"),isFilled:i.owner.getAttribute("bIsFilled"),hasBorder:i.owner.getAttribute("bHasBorder"),graphicProperties:lt()}),Ke.linkManipulatorToNode(Ie.getBackNode()),at(this,Ie),at(this,Fe=new f({window:i.frmWindow,content:[""],position:i.owner.getAttribute("vLeaderBreakPoint3D"),isFilled:i.owner.getAttribute("bIsFilled"),hasBorder:i.owner.getAttribute("bHasBorder"),graphicProperties:lt()})),at(this,Oe=new h),at(this,Ue=new h),at(this,Be=new h),at(this,ze=new h),at(this,Ge=new h),this.update(!0)}})}),define("DS/DMUPlayMeasure/DMUMeasure",["DS/DMUBaseReview/DMUOverloadableObject","DS/DMUMeasurable/DMUMeasureEnums","DS/DMUMeasurable/DMUMeasurable","DS/DMUMeasurable/DMUToolsMeasure","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUBaseExperience/EXPToolsVisualization","DS/CoreEvents/ModelEvents","DS/Visualization/ThreeJS_DS","DS/DMUBaseExperience/DMUContextManager","DS/DMUMeasurable/DMUToolsInterference","DS/DMUBaseUIControllers/DMUMarkupsController","DS/DMUPlayMeasure/DMUMeasureNode3D","DS/DMUPlayMeasure/DMUMeasureImport","DS/Selection/CSOManager","DS/DMUBaseExperience/EXPUtils"],function(e,t,i,n,r,a,o,s,l,u,c,p,d,g,h,b,y){"use strict";var m=[{name:"sType",type:"string",JSONname:"Specifications.Type"},{name:"sSelectedType1",type:"int",JSONname:"Specifications.SelectedType1",defaultValue:-1},{name:"sSelectedType2",type:"int",JSONname:"Specifications.SelectedType2"},{name:"sResultingType1",type:"int",JSONname:"Results.ResultingType1",defaultValue:-1},{name:"sResultingType2",type:"int",JSONname:"Results.ResultingType2"},{name:"oProduct1Name",type:"string",JSONname:"Results.Product1Name"},{name:"oProduct2Name",type:"string",JSONname:"Results.Product2Name"},{name:"fDistance",type:"float",JSONname:"Results.Distance"},{name:"fAngle",type:"float",JSONname:"Results.Angle"},{name:"fProjectedAngleXY",type:"float",JSONname:"Results.ProjectedAngleXY"},{name:"fProjectedAngleYZ",type:"float",JSONname:"Results.ProjectedAngleYZ"},{name:"fProjectedAngleZX",type:"float",JSONname:"Results.ProjectedAngleZX"},{name:"vPosition",type:"Vector3",JSONname:"Results.Position"},{name:"vCenter",type:"Vector3",JSONname:"Results.Center"},{name:"vNormal",type:"Vector3",JSONname:"Results.Normal"},{name:"vCog",type:"Vector3",JSONname:"Results.Cog"},{name:"fLength",type:"float",JSONname:"Results.Length"},{name:"fRadius",type:"float",JSONname:"Results.Radius"},{name:"fArea",type:"float",JSONname:"Results.Area"},{name:"vApex",type:"Vector3",JSONname:"Results.Apex"},{name:"fSemiAngle",type:"float",JSONname:"Results.SemiAngle"},{name:"fVolume",type:"float",JSONname:"Results.Volume"},{name:"bHasALeader",type:"bool",JSONname:"Properties3DText.HasALeader",defaultValue:!0},{name:"vLeaderBreakPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderBreakPoint3D",defaultValue:new u.Vector3},{name:"vLeaderPointingPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderPointingPoint3D",defaultValue:new u.Vector3},{name:"fBoxRotationAngle",type:"float",JSONname:"Properties3DText.BoxRotationAngle"},{name:"bShortDisplay",type:"bool",JSONname:"PropertiesMeasure.Shortdisplay",defaultValue:!0},{name:"vFirstPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.FirstPoint3D"},{name:"vSecondPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.SecondPoint3D"},{name:"vFirstExtensionPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.FirstExtensionPoint3D"},{name:"vSecondExtensionPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.SecondExtensionPoint3D"},{name:"vExtensionDirection3D",type:"Vector3",JSONname:"PropertiesMeasure.ExtensionDirection3D"},{name:"bRadiusDisplay",type:"bool",JSONname:"PropertiesMeasure.Radiusdisplay",defaultValue:!1},{name:"bCollapsedDisplay",type:"bool",JSONname:"PropertiesMeasure.Collapseddisplay",defaultValue:!1},{name:"vAngleBreakPoint",type:"Vector3",JSONname:"PropertiesMeasure.AngleBreakPoint"},{name:"fQuadrant",type:"float",JSONname:"PropertiesMeasure.Quadrant"},{name:"vAngleArcCenter",type:"Vector3",JSONname:"PropertiesMeasure.AngleArcCenter"},{name:"vAnglePointingPoint",type:"Vector3",JSONname:"PropertiesMeasure.AnglePointingPoint"},{name:"vAngleVector1",type:"Vector3",JSONname:"PropertiesMeasure.AngleVector1"},{name:"vAngleVector2",type:"Vector3",JSONname:"PropertiesMeasure.AngleVector2"},{name:"aabb",type:"AABB",JSONname:"PropertiesMeasure.aabb"},{name:"bVisible",type:"bool",JSONname:"PropertiesMarkerBase.Visible",defaultValue:!0},{name:"bIsFilled",type:"bool",JSONname:"PropertiesMarkerBase.IsFilled",defaultValue:!0},{name:"bHasBorder",type:"bool",JSONname:"PropertiesMarkerBase.HasBorder",defaultValue:!1},{name:"fFontSize",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.fontSize",defaultValue:3.5},{name:"sFontName",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyName",defaultValue:"sans-serif"},{name:"sFontStyle",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyStyle",defaultValue:"normal"},{name:"cFontColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.color",defaultValue:new u.Color("#ffffff")},{name:"cFillStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.color",defaultValue:new u.Color("#368ec4")},{name:"fOpacity",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.opacity",defaultValue:1},{name:"fLineStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thickness",defaultValue:1},{name:"fLineStyleThicknessIndex",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thicknessIndex"},{name:"sLineStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.pattern",defaultValue:"1"},{name:"cLineStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.color",defaultValue:new u.Color("#3d3d3d")},{name:"sLeaderStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.pattern"},{name:"fLeaderStyleThicknessIndex",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thicknessIndex"},{name:"cLeaderStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.color"},{name:"cAvatarStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.AvatarStylecolor"},{name:"sCommentOnMeasure",type:"string",JSONname:"Comment.TextContents"},{name:"sCommentFontStyle",type:"string",JSONname:"Comment.GraphicProperties.FontStyle.familyStyle"},{name:"sCommentFontName",type:"string",JSONname:"Comment.GraphicProperties.FontStyle.familyName"},{name:"fCommentFontSize",type:"float",JSONname:"Comment.GraphicProperties.FontStyle.fontSize"},{name:"iRadiusResultDisplayType",type:"int",JSONname:"PropertiesMeasure.iRadiusResultDisplayType",defaultValue:0},{name:"vArcMidPoint",type:"Vector3",JSONname:"PropertiesMeasure.vArcMidPoint"},{name:"iExtensionLinesManipulable",type:"int",JSONname:"PropertiesMeasure.iExtensionLinesManipulable"},{name:"sLeaderEndType",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.sLeaderEndType"},{name:"sPointType",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.sPointType"},{name:"sExtremityType",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.sExtremityType"},{name:"sTextGraphicRepresentation",type:"string",JSONname:"Properties3DText.textGraphicRepresentation"},{name:"stextGraphicRepresentationAngle",type:"string",JSONname:"Properties3DText.textGraphicRepresentationAngle"},{name:"sMeasureOnGeometryType",type:"string",JSONname:"Specifications.MeasureOnGeometryType"},{name:"sDistanceType",type:"string",JSONname:"Results.DistanceType"},{name:"bArcLengthDisplay",type:"bool",JSONname:"PropertiesMeasure.ArcLengthDisplay",defaultValue:!1},{name:"bDisplayMeasureType",type:"bool",JSONname:"PropertiesMeasure.DisplayMeasureType",defaultValue:!0},{name:"bDisplayUnit",type:"bool",JSONname:"PropertiesMeasure.DisplayUnit",defaultValue:!0},{name:"sSurfaceDisplayType",type:"string",JSONname:"Results.SurfaceDisplayType"},{name:"sProductDisplayType",type:"string",JSONname:"Results.ProductDisplayType"},{name:"fHeight",type:"float",JSONname:"Results.Height"},{name:"fMaxRadius",type:"float",JSONname:"Results.MaxRadius"},{name:"lCustomization",type:"listObject",JSONname:"Results.Customization",defaultValue:[]},{name:"sComputationMode",type:"string",JSONname:"Results.ComputationMode"},{name:"bDisplayApproximateSymbol",type:"bool",JSONname:"PropertiesMeasure.DisplayApproximateSymbol",defaultValue:!1},{name:"fLeaderStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thickness"},{name:"iFontSize",type:"int",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.height"}];return e.extend({init:function(e,i,n){this._parent(e,i),this.addParameters(m),this._type="DMUMeasure",this._typeApps=n;var r="DS/DMUMeasure/DMUMeasureContextualBar",a=this;this._bCreateMeasureInShowSpace=this._viewer.getVisibleSpace(),this._isInCreationState=!1,this.initAuthoringData=function(){if(-1!==c.getAuthoringFeatureTypes().indexOf("Measure")&&(-1===c.getAuthoringFeatureTypes().indexOf("Measure")||a.getContextualCommandList||require([r],function(e){var t=new e;a.getContextualCommandList=t.getContextualCommandList,a.getSharedContextualCommandList=t.getSharedContextualCommandList,a.getSharedHeaderTypes=t.getSharedHeaderTypes,a.getCmdHdrsFor2DGeometries=t.getCmdHdrsFor2DGeometries,a.getSharedContextualMenuCommandList=t.getSharedContextualMenuCommandList,t.applyStateToContextHdr&&(a.applyStateToContextHdr=t.applyStateToContextHdr),t.getPointTypeHdr&&(a.getPointTypeHdr=t.getPointTypeHdr),t.getExtremityTypeHdr&&(a.getExtremityTypeHdr=t.getExtremityTypeHdr),t.setCheckCmdHdrState&&(a.setCheckCmdHdrState=t.setCheckCmdHdrState),t.register({frmWindow:a._frmWindow});var i=1===b.get().length?b.get()[0].pathElement.clone():null;i&&i.getLastElement(!0).getDMUType&&i.getLastElement(!0)===a.getNode()&&(b.empty(),b.add({pathElement:i}))}),!a.getPropertiesObject&&"ProgressiveVisuLoading"!==n)){require(["DS/DMUMeasure/DMUMeasureProperties"],function(e){var t=new e(a);a.getPropertiesObject=function(){return t}})}},this.removeAuthoringData=function(){-1!==c.getAuthoringFeatureTypes().indexOf("Measure")&&-1!==c.getAuthoringFeatureTypes().indexOf("Measure")&&require([r],function(e){var t=new e;a.getContextualCommandList=null,a.getSharedContextualCommandList=null,a.getSharedHeaderTypes=null,a.getSharedContextualMenuCommandList=null,a.applyStateToContextHdr=null,a.getPointTypeHdr=null,a.getExtremityTypeHdr=null,a.setCheckCmdHdrState=null,t.unregister({frmWindow:a._frmWindow})})};var s=new h(a);this.importData=s.importData,this.afterImport=s.afterImport,this.initAuthoringData();var l=d.getDMUMarkupsController({context:this._viewer,frmWindow:this._frmWindow});l&&l.registerMarker(this),this.getType=function(){return"DMUMeasure"},this.getMeasureType=function(){return this._sType},this.setNode(new g({owner:this,frmWindow:this._frmWindow,getType:this.getType})),this.getPixelFontSize=function(){if(a.getNode())return a.getNode().getPixelFontSize()};var u=this.refreshNode;this.refreshNode=function(e){a._doNotRefresh||!a.getNode()||i.isImporting&&(!i.isImporting||i.isImporting())||(a.getNode().update(!1,e),u())},this.getManipulationData=function(){return this.getNode().getLabelParams()},this.isMeasureDisplayed=function(){return a.isVisible()&&a.getActiveFlag()&&a.isDisplayed()&&a.getAttribute("bVisible")},this.getPrefNameForDistanceType=function(){var e="";if(this._sMeasurable1&&this._sMeasurable2){for(var i="DMUMeasureDistanceType",n=[],r=0;r<2;r++){var s=this.getAttribute("sSelectedType"+(r+1));if(this._objAction||s!==t.ViewedType.POINT&&s!==t.ViewedType.CENTER){var l="_sMeasurable"+(r+1);switch(this[l].getType()){case 0:case 1:n[r]="Point";break;case 2:n[r]="Curve";break;case 3:n[r]="Line";break;case 4:n[r]="Circle",Math.abs(2*Math.PI-this[l].getArcAngle())>.001&&(n[r]="Arc");break;case 5:n[r]="Surface";break;case 6:n[r]="Plane";break;case 7:n[r]="Cylinder";break;case 8:n[r]="Cone";break;case 9:n[r]="Sphere";break;case 10:n[r]="Product"}}else n[r]="Point"}var u="";if(this.getAttribute("sSelectedType1")!==t.ViewedType.POINT&&this.getAttribute("sSelectedType1")!==t.ViewedType.CENTER&&this.getAttribute("sSelectedType2")!==t.ViewedType.POINT&&this.getAttribute("sSelectedType2")!==t.ViewedType.CENTER){var c,p,d=0;a._sMeasurable1._type===o.GeometryType.LINE&&a._sMeasurable2._type===o.GeometryType.LINE?(c=a._sMeasurable1._point2.clone().sub(a._sMeasurable1._point1.clone()),p=a._sMeasurable2._point2.clone().sub(a._sMeasurable2._point1.clone()),0!==(d=c.angleTo(p))&&d!==Math.PI||(u="Parallel")):a._sMeasurable1._type===o.GeometryType.LINE&&a._sMeasurable2._type===o.GeometryType.PLANE||a._sMeasurable1._type===o.GeometryType.PLANE&&a._sMeasurable2._type===o.GeometryType.LINE?(a._sMeasurable1._type===o.GeometryType.LINE?(c=a._sMeasurable1._point2.clone().sub(a._sMeasurable1._point1.clone()),p=a._sMeasurable2._normal):(c=a._sMeasurable1._normal,p=a._sMeasurable2._point2.clone().sub(a._sMeasurable2._point1.clone())),(d=c.angleTo(p))!==.5*Math.PI&&d!==1.5*Math.PI||(u="NormalPerpendicular")):a._sMeasurable1._type===o.GeometryType.LINE&&(a._sMeasurable2._type===o.GeometryType.CYLINDER||a._sMeasurable2._type===o.GeometryType.CONE)||(a._sMeasurable1._type===o.GeometryType.CYLINDER||a._sMeasurable1._type===o.GeometryType.CONE)&&a._sMeasurable2._type===o.GeometryType.LINE?(a._sMeasurable1._type===o.GeometryType.LINE?(c=a._sMeasurable1._point2.clone().sub(a._sMeasurable1._point1.clone()),a._sMeasurable2.getAxis&&(p=a._sMeasurable2.getAxis())):(a._sMeasurable1.getAxis&&(c=a._sMeasurable1.getAxis()),p=a._sMeasurable2._point2.clone().sub(a._sMeasurable2._point1.clone())),0!==(d=c.angleTo(p))&&d!==Math.PI||(u="Parallel")):a._sMeasurable1._type===o.GeometryType.PLANE&&a._sMeasurable2._type===o.GeometryType.PLANE||a._sMeasurable1._type===o.GeometryType.CYLINDER&&a._sMeasurable2._type===o.GeometryType.CYLINDER||a._sMeasurable1._type===o.GeometryType.CYLINDER&&a._sMeasurable2._type===o.GeometryType.CONE||a._sMeasurable1._type===o.GeometryType.CONE&&a._sMeasurable2._type===o.GeometryType.CONE||a._sMeasurable1._type===o.GeometryType.CONE&&a._sMeasurable2._type===o.GeometryType.CYLINDER?(a._sMeasurable1.normal?c=a._sMeasurable1.normal:a._sMeasurable1._normal?c=a._sMeasurable1._normal:a._sMeasurable1.getAxis&&(c=a._sMeasurable1.getAxis()),a._sMeasurable2.normal?p=a._sMeasurable2.normal:a._sMeasurable2._normal?p=a._sMeasurable2._normal:a._sMeasurable2.getAxis&&(p=a._sMeasurable2.getAxis()),0!==(d=c.angleTo(p))&&d!==Math.PI||(u="Parallel")):(a._sMeasurable1._type===o.GeometryType.CYLINDER&&a._sMeasurable2._type===o.GeometryType.PLANE||a._sMeasurable1._type===o.GeometryType.CONE&&a._sMeasurable2._type===o.GeometryType.PLANE||a._sMeasurable1._type===o.GeometryType.PLANE&&a._sMeasurable2._type===o.GeometryType.CYLINDER||a._sMeasurable1._type===o.GeometryType.PLANE&&a._sMeasurable2._type===o.GeometryType.CONE)&&(a._sMeasurable1.normal?c=a._sMeasurable1.normal:a._sMeasurable1._normal?c=a._sMeasurable1._normal:a._sMeasurable1.getAxis&&(c=a._sMeasurable1.getAxis()),a._sMeasurable2.normal?p=a._sMeasurable2.normal:a._sMeasurable2._normal?p=a._sMeasurable2._normal:a._sMeasurable2.getAxis&&(p=a._sMeasurable2.getAxis()),(d=c.angleTo(p))!==.5*Math.PI&&d!==1.5*Math.PI||(u="Parallel"))}e=i+n[0]+n[1]+u+"Preferences",localStorage.getItem(i+n[0]+n[1]+u+"Preferences")||(e=i+n[1]+n[0]+u+"Preferences")}return e},this.setDistanceType=function(){var e=this.getPrefNameForDistanceType();if(""!==e){var t=localStorage.getItem(e);this.setAttribute("sDistanceType",t)}};var p=this.updateRepresentation;this.updateRepresentation=function(e,t){p(e,t),this.refreshAssistantTool(e,t)},this._parentsetAttributes=this.setAttributes,this.setAttributes=function(e){var t=[];if(e&&e.length)for(var i=0;i<e.length;i++)if("lCustomization"===e[i].name){var n=e[i].value,r=n.length,a=[],o=this.getAttribute("lCustomization"),s=0,l=0;for(s=0;s<o.length;s++)a.push(o[s]);var u=a&&a.length?a.length:0;if(0===u){var c=this.getCustoListAsPerMainValue(this.getMainValueType()),p=c&&c.length?c.length:0;for(s=0;s<p;s++)a.push({custoName:c[s],custoValue:1})}if(u=a&&a.length?a.length:0)for(s=0;s<r;s++)for(l=0;l<u;l++)n[s].custoName===a[l].custoName&&(a[l].custoValue=n[s].custoValue);a.length>0&&t.push({name:"lCustomization",value:a})}else t.push({name:e[i].name,value:e[i].value});t.length>0&&this._parentsetAttributes(t)}},setAttribute:function(e,t){"fFontSize"===e?this.setAttribute("iFontSize",null):"fLineStyleThicknessIndex"===e?this._parent("fLineStyleThickness",null):"fLeaderStyleThicknessIndex"===e&&this._parent("fLeaderStyleThickness",null),this._parent(e,t)},update2DArcDisplay:function(){if(this.getAttribute("sResultingType1")===t.ResultType.CIRCLE){var e=this._sMeasurable1.getArcAngle();this.getAttribute("bArcLengthDisplay")&&e&&Math.abs(2*Math.PI-e)>.001?(this.setAttribute("sLeaderEndType","Arrow"),this.setAttribute("sExtremityType","FullCircle")):(this._sLeaderEndType&&(this._sLeaderEndType=void 0),this._sExtremityType&&(this._sExtremityType=void 0))}},updateGlobalRadiusPreference:function(e){var i;switch(i=!0===e?"DisplayRadius":"DisplayDiameter",this.getAttribute("sResultingType1")){case t.ResultType.CIRCLE:"2D"===this.getAttribute("sMeasureOnGeometryType")&&Math.abs(2*Math.PI-this._sMeasurable1._arcAngle)>.001?localStorage.setItem("DMUMeasureArcRadiusPreferences",i):localStorage.setItem("DMUMeasureCircleRadiusPreferences",i);break;case t.ResultType.CYLINDER:localStorage.setItem("DMUMeasureCylinderRadiusPreferences",i);break;case t.ResultType.SPHERE:localStorage.setItem("DMUMeasureSphereRadiusPreferences",i)}},updateFeatureAndDistanceTypePreference:function(e){if(e){this.setAttribute("sDistanceType",e);var t=this.getPrefNameForDistanceType();""!==t&&localStorage.setItem(t,e)}switch(this._local2DDistancePref){case"DMUMeasBetween2CirclesDistancePref":localStorage.setItem("DMUMeasBetween2CirclesDistancePref",e);break;case"DMUMeasBetweenCircleArcDistancePref":localStorage.setItem("DMUMeasBetweenCircleArcDistancePref",e);break;case"DMUMeasBetweenCircleAnygeomDistancePref":localStorage.setItem("DMUMeasBetweenCircleAnygeomDistancePref",e);break;case"DMUMeasBetween2ArcsDistancePref":localStorage.setItem("DMUMeasBetween2ArcsDistancePref",e);break;case"DMUMeasBetweenArcAnygeomDistancePref":localStorage.setItem("DMUMeasBetweenArcAnygeomDistancePref",e);break;case"DMUMeasBetween2ParallelLinesDistancePref":localStorage.setItem("DMUMeasBetween2ParallelLinesDistancePref",e);break;case"DMUMeasBetween2LinesDistancePref":localStorage.setItem("DMUMeasBetween2LinesDistancePref",e);break;case"DMUMeasBetween2AnyGeomsDistancePref":localStorage.setItem("DMUMeasBetween2AnyGeomsDistancePref",e)}},updateFeatureAndSurfaceDisplayTypePreference:function(e){if(e)switch(this.setAttribute("sSurfaceDisplayType",e),this._sResultingType1){case t.ResultType.CYLINDER:localStorage.setItem("DMUMeasSurfaceDisplayCylinderPref",e);break;case t.ResultType.CONE:localStorage.setItem("DMUMeasSurfaceDisplayConePref",e);break;case t.ResultType.SPHERE:localStorage.setItem("DMUMeasSurfaceDisplaySpherePref",e)}this.updateMainValueDisplayAsPerPref()},updateFeatureAndProductDisplayTypePreference:function(e){e&&(this.setAttribute("sProductDisplayType",e),localStorage.setItem("DMUMeasProductDisplayPref",e)),this.updateMainValueDisplayAsPerPref()},updateGlobalRadiusResultDisplayPreference:function(e){var i,n;"MeasureItem"===this.getAttribute("sType")&&this.getAttribute("sResultingType1")===t.ResultType.CIRCLE?(n="DMUMeasureRadiusResultDisplayPreferences",i="TANGENT",0===e&&(i="CENTER")):"Measure3PointsCircle"===this.getAttribute("sType")&&(n="DMUMeasure3PointsCircleRadiusResultDisplayPreferences",i="TANGENT",0===e&&(i="CENTER")),void 0!==i&&void 0!==n&&localStorage.setItem(n,i)},updateGrpahicPropertyAsPerPref:function(){if(void 0===this._partialMeasure){var e=["Solid","Dotted","Dashed","Dot Dashed","Phantom","Small Dots","JIS Axis"].indexOf(this._preferences.find(e=>"Measure_GraphicProperties_LineType"===e.name).value)+1,t=["1","2","3","4","5","6","7","8","16","32","64"].indexOf(this._preferences.find(e=>"Measure_GraphicProperties_LineThickness"===e.name).value);0!==t&&this.setAttribute("fLineStyleThicknessIndex",t),this.setAttribute("fLeaderStyleThicknessIndex",t),this.setAttribute("sLineStylePattern",e.toString()),this.setAttribute("sLeaderStylePattern",e.toString());var i=this._preferences.find(e=>"Measure_GraphicProperties_TextBold"===e.name).value,n=this._preferences.find(e=>"Measure_GraphicProperties_TextItalic"===e.name).value;i&&n?this.setAttribute("sFontStyle","bold italic"):i?this.setAttribute("sFontStyle","bold"):n?this.setAttribute("sFontStyle","italic"):this.setAttribute("sFontStyle","normal"),this.setAttribute("bIsFilled",this._preferences.find(e=>"Measure_GraphicProperties_Fill"===e.name).value),this.setAttribute("cFillStyleColor",new u.Color(this._preferences.find(e=>"Measure_GraphicProperties_FillColor"===e.name).value)),this.setAttribute("fOpacity",1-this._preferences.find(e=>"Measure_GraphicProperties_FillTransparency"===e.name).value),this.setAttribute("bHasBorder",this._preferences.find(e=>"Measure_GraphicProperties_LineBorder"===e.name).value),this.setAttribute("cLineStyleColor",new u.Color(this._preferences.find(e=>"Measure_GraphicProperties_LineColor"===e.name).value)),this.setAttribute("cLeaderStyleColor",new u.Color(this._preferences.find(e=>"Measure_GraphicProperties_LineColor"===e.name).value)),this.setAttribute("cFontColor",new u.Color(this._preferences.find(e=>"Measure_GraphicProperties_TextColor"===e.name).value))}this.setAttribute("fFontSize",this._preferences.find(e=>"Measure_GraphicProperties_TextSize"===e.name).value)},updateMainValueDisplayAsPerPref:function(){var e,t;(t=this.getMainValueType())&&("MainValue"===(e=this.getMeasureFilterPref(t)).displayType?this.setAttribute("bShortDisplay",!0):this.setAttribute("bShortDisplay",!1),this.setAttribute("bDisplayMeasureType",e.measType),this.setAttribute("bDisplayUnit",e.unit),this.setAttribute("bDisplayApproximateSymbol",e.approx),this._sMainValueType=t,this.setCustomizationToMeasure(e.custo))},getMeasureFilterPref:function(e){var t,i=[],n=[],r=0;switch(e){case"Axis":case"Coordinates":this._preferences.forEach(e=>{e.name.includes("Coordinates_")&&(n[r++]=e.value)});break;case"Line_Length":this._preferences.forEach(e=>{e.name.includes("Line_Length_")&&(n[r++]=e.value)});break;case"Curve_Length":this._preferences.forEach(e=>{e.name.includes("Curve_Length_")&&(n[r++]=e.value)});break;case"Arc_Length":this._preferences.forEach(e=>{e.name.includes("Arc_Length_")&&(n[r++]=e.value)});break;case"Cylinder_Length":this._preferences.forEach(e=>{e.name.includes("Cylinder_Length_")&&(n[r++]=e.value)});break;case"Cone_Length":this._preferences.forEach(e=>{e.name.includes("Cone_Length_")&&(n[r++]=e.value)});break;case"Distance":this._preferences.forEach(e=>{e.name.includes("Distance_")&&(n[r++]=e.value)});break;case"Min_Distance":"LocalMinimumDistance"===this.getAttribute("sDistanceType")?this._preferences.forEach(e=>{e.name.includes("Local_Min_Distance_")&&(n[r++]=e.value)}):this._preferences.forEach(e=>{e.name.includes("Min_Distance_")&&(n[r++]=e.value)});break;case"Max_Distance":"LocalMaximumDistance"===this.getAttribute("sDistanceType")?this._preferences.forEach(e=>{e.name.includes("Local_Max_Distance_")&&(n[r++]=e.value)}):this._preferences.forEach(e=>{e.name.includes("Max_Distance_")&&(n[r++]=e.value)});break;case"Angle_Btw2Selections":this._preferences.forEach(e=>{e.name.includes("Angle_Btw2Selections_")&&(n[r++]=e.value)});break;case"Angle_By3Pts":this._preferences.forEach(e=>{e.name.includes("Angle_By3Pts_")&&(n[r++]=e.value)});break;case"Cone_Angle":this._preferences.forEach(e=>{e.name.includes("Cone_Angle_")&&(n[r++]=e.value)});break;case"Half_Angle":this._preferences.forEach(e=>{e.name.includes("Half_Angle_")&&(n[r++]=e.value)});break;case"Radius":this._preferences.forEach(e=>{e.name.includes("Radius_")&&(n[r++]=e.value)});break;case"Cylinder_Radius":this._preferences.forEach(e=>{e.name.includes("Cylinder_Radius_")&&(n[r++]=e.value)});break;case"Sphere_Radius":this._preferences.forEach(e=>{e.name.includes("Sphere_Radius_")&&(n[r++]=e.value)});break;case"Min_Radius":this._preferences.forEach(e=>{e.name.includes("Min_Radius_")&&(n[r++]=e.value)});break;case"Max_Radius":this._preferences.forEach(e=>{e.name.includes("Max_Radius_")&&(n[r++]=e.value)});break;case"Radius_By3Pts":this._preferences.forEach(e=>{e.name.includes("Radius_By3Pts_")&&(n[r++]=e.value)});break;case"Diameter":this._preferences.forEach(e=>{e.name.includes("Diameter_")&&(n[r++]=e.value)});break;case"Cylinder_Diameter":this._preferences.forEach(e=>{e.name.includes("Cylinder_Diameter_")&&(n[r++]=e.value)});break;case"Sphere_Diameter":this._preferences.forEach(e=>{e.name.includes("Sphere_Diameter_")&&(n[r++]=e.value)});break;case"Min_Diameter":this._preferences.forEach(e=>{e.name.includes("Min_Diameter_")&&(n[r++]=e.value)});break;case"Max_Diameter":this._preferences.forEach(e=>{e.name.includes("Max_Diameter_")&&(n[r++]=e.value)});break;case"Diameter_By3Pts":this._preferences.forEach(e=>{e.name.includes("Diameter_By3Pts_")&&(n[r++]=e.value)});break;case"Surface_Area":this._preferences.forEach(e=>{e.name.includes("Surface_Area_")&&(n[r++]=e.value)});break;case"PlanarSurface_Area":this._preferences.forEach(e=>{e.name.includes("PlanarSurface_Area_")&&(n[r++]=e.value)});break;case"Product_Area":this._preferences.forEach(e=>{e.name.includes("Product_Area_")&&(n[r++]=e.value)});break;case"Volume":this._preferences.forEach(e=>{e.name.includes("Volume_")&&(n[r++]=e.value)});break;case"Thickness":this._preferences.forEach(e=>{e.name.includes("Thickness_")&&(n[r++]=e.value)})}for(r=0,t=4;t<n.length;t++)i[r++]=n[t];return{displayType:n[0],measType:n[1],unit:n[2],approx:n[3],custo:i}},getMainValueType:function(){var e;if("MeasureItem"===this._sType){var i=this.getAttribute("sResultingType1");switch(i){case t.ResultType.AXIS:e="Axis";break;case t.ResultType.POINT:case t.ResultType.PICKINGPT:case t.ResultType.CENTER:e="Coordinates";break;case t.ResultType.CURVE:e="Curve_Length";break;case t.ResultType.LINE:e="Line_Length";break;case t.ResultType.CIRCLE:e=this.getAttribute("bArcLengthDisplay")?"Arc_Length":this.getAttribute("bRadiusDisplay")?"Radius":"Diameter";break;case t.ResultType.CYLINDER:case t.ResultType.SPHERE:var n=this.getAttribute("sSurfaceDisplayType");e="Cylinder_",i===t.ResultType.SPHERE&&(e="Sphere_"),i===t.ResultType.CYLINDER&&"Length"===n?e+="Length":"Area"===n?e="Surface_Area":this.getAttribute("bRadiusDisplay")?e+="Radius":e+="Diameter";break;case t.ResultType.PLANE:e="PlanarSurface_Area";break;case t.ResultType.SURFACE:e="Surface_Area";break;case t.ResultType.CONE:e="Half_Angle";var r=this.getAttribute("sSurfaceDisplayType");"HalfAngle"===r?e="Half_Angle":"Angle"===r?e="Cone_Angle":"Length"===r?e="Cone_Length":"MaximumRadius"===r?e="Max_Radius":"MaximumDiameter"===r?e="Max_Diameter":"MinimumRadius"===r?e="Min_Radius":"MinimumDiameter"===r?e="Min_Diameter":"Area"===r&&(e="Surface_Area");break;case t.ResultType.PRODUCT:e="Volume";var a=this.getAttribute("fVolume");"Area"!==this.getAttribute("sProductDisplayType")&&0!==a&&void 0!==a||(e="Product_Area")}}else if("MeasureBetween"===this._sType){switch(this.getAttribute("sDistanceType")){case"Angle":e="Angle_Btw2Selections";break;case"Distance":e="Distance";break;case"MinimumDistance":case"LocalMinimumDistance":e="Min_Distance";break;case"MaximumDistance":case"LocalMaximumDistance":e="Max_Distance";break;default:"Min_Distance"}}else if("MeasureThickness"===this._sType)e="Thickness";else if("Measure3PointsCircle"===this._sType)e=this.getAttribute("bRadiusDisplay")?"Radius_By3Pts":"Diameter_By3Pts";else if("Measure3PointsAngle"===this._sType){e="Angle_By3Pts","Angle"===this.getAttribute("sDistanceType")||(e=this.getAttribute("bRadiusDisplay")?"Radius_By3Pts":"Diameter_By3Pts")}return e},getMeasurable:function(e){return this["_sMeasurable"+e]},setMeasurable:function(e,t){var i=this;if(this["_sMeasurable"+e])for(var n=this["_sMeasurableNode"+e],a=this["_sMeasurableToken"+e],o=0;o<n.length;o++)n[o].modelEvents.unsubscribe(a[o]);if(this["_sMeasurable"+e]=t,t){var s=[],u=[],c=t.getPathElement(),p=t.getLevel(),d=p?r.truncatePathElement(c,p).externalPath:c.externalPath,g={event:"move"};this.updateAfterEvent=function(){i.update()};for(var h=0;h<d.length;h++){var b=d[h];r.isInstance(b)&&(void 0===b.modelEvents&&(b.modelEvents=new l),s.push(b),u.push(b.modelEvents.subscribe(g,this.updateAfterEvent)))}this["_sMeasurableNode"+e]=s,this["_sMeasurableToken"+e]=u}},remove:function(){var e=d.giveDMUMarkupsController({context:this._viewer});if(e&&e.unregisterMarker(this),d.unreferenceDMUMarkupsController({context:this._viewer}),this._parent(),this._paneltop&&this._paneltop.destroy(),this.setMeasurable(1,void 0),this.setMeasurable(2,void 0),this.setMeasurable(3,void 0),this._lockedNodes){var t=c.getContextViewer({viewer:this._viewer});t.getController&&t.getController().unlockNodes({ids:this._lockedNodes}),this.clearLockedNodes()}},update:function(){this._doNotRefresh=!0;var e,s,l=[],d=[],g=[],h={},b="NA",m="NA",v="NA",P=!1;if("2D"===this.getAttribute("sMeasureOnGeometryType")&&(P=!0),"MeasureItem"===this._sType){var A=(h=n.measureItem(this._sMeasurable1,this.getAttribute("sSelectedType1"))).position;this._sResultingType1===t.ResultType.CIRCLE&&0===this.getAttribute("iRadiusResultDisplayType")&&(A=h.arcMidPoint.clone()),g.push({attribute:"vLeaderPointingPoint3D",value:A}),g.push({attribute:"vLeaderBreakPoint3D",value:A}),this._oProduct1=h.product,l.push(this._oProduct1),d.push(this._sMeasurable1._pathElement);var f=this.getAttribute("sSurfaceDisplayType");s="Approximate";var M=this.getMeasurable(1);switch(M&&M.getMode()===o.Mode.EXACT&&(s="Exact"),g.push({attribute:"sComputationMode",value:s}),this._sResultingType1){case t.ResultType.POINT:case t.ResultType.PICKINGPT:case t.ResultType.CENTER:b="Cross",m="None",g.push({attribute:"vPosition",value:h.position});break;case t.ResultType.LINE:case t.ResultType.AXIS:case t.ResultType.CURVE:this._sMeasurable1._type===o.GeometryType.CIRCLE?g.push({attribute:"fLength",value:h.arcLength}):g.push({attribute:"fLength",value:h.length}),this._sResultingType1!==t.ResultType.LINE&&this._sResultingType1!==t.ResultType.CURVE||(v="FullCircle"),this._sResultingType1!==t.ResultType.AXIS&&this._sResultingType1!==t.ResultType.CURVE||(b="Arrow");break;case t.ResultType.CIRCLE:g.push({attribute:"fRadius",value:h.radius}),g.push({attribute:"vCenter",value:h.center}),g.push({attribute:"vNormal",value:h.normal}),g.push({attribute:"vArcMidPoint",value:h.arcMidPoint});var D=this._sMeasurable1.getArcAngle();P&&this.getAttribute("bArcLengthDisplay")&&D&&Math.abs(2*Math.PI-D)>.001&&(b="Arrow",v="FullCircle");break;case t.ResultType.PLANE:b="Bubble",g.push({attribute:"vOrigin",value:h.origin}),g.push({attribute:"vNormal",value:h.normal}),g.push({attribute:"fArea",value:h.area}),g.push({attribute:"vCog",value:h.cog});break;case t.ResultType.CYLINDER:g.push({attribute:"fRadius",value:h.radius}),g.push({attribute:"fArea",value:h.area}),g.push({attribute:"vCog",value:h.cog}),g.push({attribute:"fHeight",value:h.height}),this._vPoint1=h.point1,this._vPoint2=h.point2,this._vAxis=h.point2.clone().sub(h.point1);var S=this._vPoint1.clone().add(this._vPoint2).multiplyScalar(.5);g.push({attribute:"vCenter",value:S}),this._sMeasurable1.center=S.clone(),this._sMeasurable1.normal=this._vAxis.clone(),e=["sLeaderEndType","sExtremityType","sPointType"],this._removeAttribute(e),"Length"===f?v="FullCircle":"Area"===f&&(b="Bubble");break;case t.ResultType.CONE:g.push({attribute:"vApex",value:h.apex}),g.push({attribute:"fSemiAngle",value:h.semiAngle}),g.push({attribute:"fArea",value:h.area}),g.push({attribute:"vCog",value:h.cog}),g.push({attribute:"fRadius",value:h.minRadius}),g.push({attribute:"fMaxRadius",value:h.maxRadius}),g.push({attribute:"fHeight",value:h.height}),this._vPoint1=h.point1,this._vPoint2=h.point2,this._vAxis=h.axis,g.push({attribute:"vCenter",value:this._vPoint2.clone()}),e=["sLeaderEndType","sExtremityType","sPointType"],this._removeAttribute(e),"Length"===f?v="FullCircle":"Area"===f&&(b="Bubble");break;case t.ResultType.SPHERE:g.push({attribute:"fRadius",value:h.radius}),g.push({attribute:"vCenter",value:h.center}),g.push({attribute:"fArea",value:h.area}),g.push({attribute:"vCog",value:h.cog});break;case t.ResultType.SURFACE:b="Bubble",g.push({attribute:"fArea",value:h.area}),g.push({attribute:"vCog",value:h.cog});break;case t.ResultType.PRODUCT:b="Square";this._removeAttribute(["fVolume","fArea","vCog","aabb","fLength"]),h.volume&&h.volume>0?g.push({attribute:"fVolume",value:h.volume}):g.push({attribute:"sProductDisplayType",value:"Area"}),h.area&&h.area>0&&g.push({attribute:"fArea",value:h.area}),h.cog&&g.push({attribute:"vCog",value:h.cog}),h.aabb&&g.push({attribute:"aabb",value:h.aabb}),h.length&&h.length>0&&g.push({attribute:"fLength",value:h.length})}"NA"!==b&&g.push({attribute:"sLeaderEndType",value:b}),"NA"!==m&&g.push({attribute:"sPointType",value:m}),"NA"!==v&&g.push({attribute:"sExtremityType",value:v}),this.set(g),this._buildConstructionData(h)}else if("MeasureBetween"===this._sType){if(P){var w=this.getAttribute("sSelectedType1"),T=this.getAttribute("sSelectedType2"),_=this.getAttribute("sDistanceType");"Distance"!==_&&(w===t.ViewedType.POINT&&T===t.ViewedType.POINT||this.getAttribute("sResultingType1")===t.ResultType.POINT&&this.getAttribute("sResultingType2")===t.ResultType.POINT)&&(_="Distance",this.setAttribute("sDistanceType",_)),h=n.measureBetween2DGeometries(_,this._sMeasurable1,w,this._sMeasurable2,T)}else h=n.measureBetween(this._sMeasurable1,this.getAttribute("sSelectedType1"),this._sMeasurable2,this.getAttribute("sSelectedType2"),!1,this.getAttribute("sDistanceType"),y.isEnvActivated("measurebetweenCylConeOldAlgo",!0));if(void 0!==h.aPosition1&&void 0!==h.aPosition2){h.product1&&(this._oProduct1=h.product1,this._oProduct1.externalPath&&this._oProduct1.getLength()>0?l.push(this._oProduct1.getLastElement()):l.push(this._oProduct1)),d.push(this._sMeasurable1._pathElement),h.product2&&(this._oProduct2=h.product2,this._oProduct2.externalPath&&this._oProduct2.getLength()>0?l.push(this._oProduct2.getLastElement()):l.push(this._oProduct2)),d.push(this._sMeasurable2._pathElement),this._duration=h.duration,g.push({attribute:"fDistance",value:void 0!==h.distance?h.distance:0});var C=void 0!==h.angle?h.angle:0;g.push({attribute:"fAngle",value:C}),void 0===C||a.isZero(C)||g.push({attribute:"fQuadrant",value:0}),g.push({attribute:"sSelectedType1",value:h.type1}),g.push({attribute:"sSelectedType2",value:h.type2}),a.isZero(C)?this.getAttribute("sResultingType1")===t.ResultType.PLANE&&this.getAttribute("sResultingType2")===t.ResultType.PLANE?m="FullCircle":this.getAttribute("sResultingType1")===t.ResultType.AXIS&&this.getAttribute("sResultingType2")===t.ResultType.AXIS||(m="Cross"):P&&"Angle"!==this.getAttribute("sDistanceType")&&(m="Cross"),e=["sLeaderEndType","sExtremityType","sPointType"],this._removeAttribute(e),"NA"!==m&&g.push({attribute:"sPointType",value:m}),s="Approximate",this._sMeasurable1.getMode()===o.Mode.EXACT&&this._sMeasurable2.getMode()===o.Mode.EXACT&&(s="Exact"),g.push({attribute:"sComputationMode",value:s}),this.set(g),this._buildConstructionData(h)}}else if("MeasureThickness"===this._sType){var R,L,x=this._sMeasurable1.getSelPoint(),E=this._sMeasurable1.getSelNormal(),V=[];if(null!=E&&null!=x){R=E.clone().negate(),L=E.clone().normalize().multiplyScalar(.1).add(x);var N=p.computeRayProductInterferences(L.toArray(),R.toArray(),[this._sMeasurable1.getPathElement()]);0===N.returnCode&&(V=N.aIntersections)}var k,I=V&&V.length>0&&V[0].primitive?THREEDS.SubElement.getFromSGNode(V[0].primitive):void 0;k=!!I&&3===I.getBodyDimension()&&V[1]?function(e,t){var n=new u.Matrix4;t&&t.getWorldMatrix?n.getInverse(t.getWorldMatrix()):(n.makeBasis(new u.Vector3(1,0,0),new u.Vector3(0,1,0),new u.Vector3(0,0,1)),n.setPosition(new u.Vector3(0,0,0)));var r=e.point.clone();r.applyMatrix4(n);var a={type:o.GeometryType.POINT,primitive:e.primitive,position:r};return new i({canonic:a,pathElement:t})}(V[1],this._sMeasurable1.getPathElement()):this._sMeasurable1.clone(),this.setMeasurable(2,k),g.push({attribute:"sSelectedType1",value:t.ViewedType.POINT}),g.push({attribute:"sSelectedType2",value:t.ViewedType.POINT}),g.push({attribute:"sResultingType1",value:t.ResultType.POINT}),g.push({attribute:"sResultingType2",value:t.ResultType.POINT}),h=n.measureBetween(this._sMeasurable1,t.ViewedType.POINT,this._sMeasurable2,t.ViewedType.POINT),this._oProduct1=h.product1,l.push(this._oProduct1),d.push(this._sMeasurable1._pathElement),this._oProduct2=h.product2,l.push(this._oProduct2),d.push(this._sMeasurable2._pathElement),g.push({attribute:"fDistance",value:void 0!==h.distance?h.distance:0}),g.push({attribute:"fAngle",value:0}),s="Approximate",g.push({attribute:"sComputationMode",value:s}),this.set(g),this._buildConstructionData(h)}else"Measure3PointsCircle"===this._sType?(e=["sLeaderEndType","sExtremityType"],this._removeAttribute(e),m="Cross",g.push({attribute:"sPointType",value:m}),h=n.measureThreepoints(this._sMeasurable1,this._sMeasurable2,this._sMeasurable3),g.push({attribute:"fRadius",value:h.radius}),g.push({attribute:"fAngle",value:h.angle}),g.push({attribute:"vCenter",value:h.center.clone()}),g.push({attribute:"vNormal",value:h.normal.clone()}),s="Approximate",this._sMeasurable1.getMode()===o.Mode.EXACT&&this._sMeasurable2.getMode()===o.Mode.EXACT&&this._sMeasurable3.getMode()===o.Mode.EXACT&&(s="Exact"),g.push({attribute:"sComputationMode",value:s}),this.set(g),h.position=h.center.clone(),this._buildConstructionData(h)):"Measure3PointsAngle"===this._sType&&(e=["sLeaderEndType","sExtremityType"],this._removeAttribute(e),m="Cross",g.push({attribute:"sPointType",value:m}),h=n.measureThreepoints(this._sMeasurable1,this._sMeasurable2,this._sMeasurable3),g.push({attribute:"fRadius",value:h.radius}),g.push({attribute:"fAngle",value:h.angle}),g.push({attribute:"vCenter",value:h.center.clone()}),g.push({attribute:"vNormal",value:h.normal.clone()}),s="Approximate",this._sMeasurable1.getMode()===o.Mode.EXACT&&this._sMeasurable2.getMode()===o.Mode.EXACT&&this._sMeasurable3.getMode()===o.Mode.EXACT&&(s="Exact"),g.push({attribute:"sComputationMode",value:s}),this.set(g),h.position=this._sMeasurable2.getSelPoint(),this._buildConstructionData(h));this._doNotRefresh=!1;var F=this;if(!P&&l.length>0){var O=[0,1];if(l.length>0&&"3dPlay"!==F._typeApps)for(var U=d.length,B=0;B<U;B++)r.getNameWithInstances(d[B],function(e){void 0!==e.name&&(F["_oProduct"+(O[e.forPathNum]+1)+"Name"]=e.name,F.refreshNode(!(F._bPrevisualized&&"MeasureThickness"===F._sType)))},c.getContextViewer({viewer:this._viewer}),B)}this.updateMainValueDisplayAsPerPref(),this.updateGrpahicPropertyAsPerPref(),this.refreshNode(!(this._bPrevisualized&&"MeasureThickness"===this._sType))},addLockedNode:function(e){void 0===this._lockedNodes&&(this._lockedNodes=[]),this._lockedNodes.push(e)},getLockedNodes:function(){return this._lockedNodes},isNodeLocked:function(e){var t=!1;return this._lockedNodes&&-1!==this._lockedNodes.indexOf(e)&&(t=!0),t},clearLockedNodes:function(){this._lockedNodes=[]},_buildConstructionData:function(e){var i,n,r,o,l,c,p,d,g,h,b,y,m,v,P,A,f,M,D,S=30,w=[];if("MeasureItem"===this._sType){var T=this.getAttribute("sSurfaceDisplayType");switch(this._sResultingType1){case t.ResultType.POINT:case t.ResultType.PICKINGPT:this._buildConstructionPointsForLeader(1.4*S,e.position);break;case t.ResultType.CENTER:this._buildConstructionPointsForLeader(1.4*S,e.center);break;case t.ResultType.LINE:this._buildConstructionPointsForDimension(S,e.point1,e.point2);break;case t.ResultType.AXIS:this._buildConstructionPointsForLeader(S,e.point1.clone().add(e.point2).multiplyScalar(.5));break;case t.ResultType.CIRCLE:var _=[];if(n=this.getAttribute("fRadius"),r=this.getAttribute("vNormal"),S=.2*n,l=s.getViewpointInfo(this._viewer.currentViewpoint),o=(new u.Vector3).crossVectors(r,l.sight),i=this.getAttribute("vCenter"),0!==this.getAttribute("iRadiusResultDisplayType"))o=this.getAttribute("vArcMidPoint").clone().sub(i);if(o.length()>.001?o.normalize().multiplyScalar(n):o=l.right.clone().normalize().multiplyScalar(n),h=(new u.Vector3).crossVectors(r,o).normalize(),Math.abs(r.angleTo(l.sight)-Math.PI/2)<Math.PI/10?((h=r.clone().normalize()).dot(l.up)<0&&h.negate(),b=h.clone().multiplyScalar(S)):b=h.clone().multiplyScalar(S+n),0!==this.getAttribute("iRadiusResultDisplayType")&&(b=h.clone().multiplyScalar(S+n)),_.push({attribute:"iExtensionLinesManipulable",value:0}),y=i.clone().add(o),m=i.clone().sub(o),d=y.clone().add(b),g=m.clone().add(b),0===this.getAttribute("iRadiusResultDisplayType")){var C=this._sMeasurable1.getSelPoint().clone().sub(i.clone());C=C.normalize();var R=n+s.getDistanceFromPixel(this._viewer,this._sMeasurable1.getSelPoint().clone(),70);C=C.multiplyScalar(R),v=i.clone().add(C)}else v=d.clone().add(g).multiplyScalar(.5);_.push({attribute:"vLeaderBreakPoint3D",value:v}),_.push({attribute:"vLeaderPointingPoint3D",value:v}),_.push({attribute:"vFirstPoint3D",value:d}),_.push({attribute:"vSecondPoint3D",value:g}),_.push({attribute:"vFirstExtensionPoint3D",value:y}),_.push({attribute:"vSecondExtensionPoint3D",value:m}),_.push({attribute:"vExtensionDirection3D",value:h}),this.set(_);break;case t.ResultType.CURVE:this._buildConstructionPointsForLeader(S,e.position);break;case t.ResultType.PLANE:case t.ResultType.SURFACE:void 0!==this._sMeasurable1.getSelPoint()?this._buildConstructionPointsForLeader(S,e.position):this._buildConstructionPointsForLeader(S,this.getAttribute("vCog"));break;case t.ResultType.CYLINDER:n=this.getAttribute("fRadius"),i=this.getAttribute("vCenter"),l=s.getViewpointInfo(this._viewer.currentViewpoint),(o=(new u.Vector3).crossVectors(this._vAxis,l.sight)).length()>.001?o.normalize().multiplyScalar(n):o=l.right.clone().normalize().multiplyScalar(n),c=i.clone().add(o),p=i.clone().sub(o),"Length"===T?this._buildConstructionPointsForDimension(S,this.getAttribute("vPoint1"),this.getAttribute("vPoint2")):"Area"===T?void 0!==this._sMeasurable1.getSelPoint()?this._buildConstructionPointsForLeader(S,e.position):this._buildConstructionPointsForLeader(S,this.getAttribute("vCog")):this._buildConstructionPointsForLeader(S,c,p);break;case t.ResultType.CONE:var L=this.getAttribute("vApex"),x=this.getAttribute("fSemiAngle");i=this.getAttribute("vCenter"),n=L.clone().sub(this._vPoint2).length()*Math.tan(x),l=s.getViewpointInfo(this._viewer.currentViewpoint),(o=(new u.Vector3).crossVectors(this._vAxis,l.sight)).length()>.001?o.normalize().multiplyScalar(n):o=l.right.clone().normalize().multiplyScalar(n),c=i.clone().add(o),p=i.clone().sub(o),"Length"===T?this._buildConstructionPointsForDimension(S,this.getAttribute("vPoint1"),this.getAttribute("vPoint2")):"Area"===T?void 0!==this._sMeasurable1.getSelPoint()?this._buildConstructionPointsForLeader(S,e.position):this._buildConstructionPointsForLeader(S,this.getAttribute("vCog")):this._buildConstructionPointsForLeader(S,c,p);break;case t.ResultType.SPHERE:n=this.getAttribute("fRadius"),i=this.getAttribute("vCenter"),o=(l=s.getViewpointInfo(this._viewer.currentViewpoint)).right.clone().normalize().multiplyScalar(n),c=i.clone().add(o),p=i.clone().sub(o),this._buildConstructionPointsForLeader(S,c,p);break;case t.ResultType.PRODUCT:this._buildConstructionPointsForLeader(S,this.getAttribute("vLeaderPointingPoint3D"))}}else if("MeasureBetween"===this._sType||"MeasureThickness"===this._sType){if(this._sResultingType1===t.ResultType.PLANE&&this._sResultingType2===t.ResultType.PLANE)if(0===this.getAttribute("fDistance")&&0!==this.getAttribute("fAngle"))d=e.position2.clone(),g=e.position1.clone();else{var E=e.position2.clone().sub(e.position1);g=(d=e.position1.clone()).clone().add(E)}else d=e.position1.clone(),g=e.position2.clone();var V,N,k=this.getAttribute("sDistanceType");if("Distance"!==k&&"MinimumDistance"!==k&&"MaximumDistance"!==k||!e.extensionDirection?"Angle"!==k&&w.push({attribute:"iExtensionLinesManipulable",value:1}):w.push({attribute:"iExtensionLinesManipulable",value:0}),this._buildConstructionPointsForDimension(S,d,g,e.extensionDirection),"MeasureBetween"===this._sType)void 0===(D=this.getAttribute("fAngle"))||a.isZero(D)||(y=this.getAttribute("vFirstExtensionPoint3D"),m=this.getAttribute("vSecondExtensionPoint3D"),this.computeAngleVector=function(e,i,n,r){var o,s,l,u;return e===t.ViewedType.CYCOSP||e===t.ViewedType.AXIS?(s=(o=i.beginPoint.clone().sub(n)).length(),u=(l=i.endPoint.clone().sub(n)).length(),(a.isZero(s)||u<s&&!a.isZero(u))&&(o=l)):(o=r.clone().sub(n),a.isZero(o.length())&&(s=(o=i.beginPoint.clone().sub(n)).length(),u=(l=i.endPoint.clone().sub(n)).length(),(a.isZero(s)||u<s&&!a.isZero(u))&&(o=l))),o},P=this.computeAngleVector(this._sSelectedType1,this._sMeasurable1.getPoints(),y,this._sMeasurable1.getSelPoint()),A=this.computeAngleVector(this._sSelectedType2,this._sMeasurable2.getPoints(),m,this._sMeasurable2.getSelPoint()),D=P.angleTo(A),f=P.clone().add(A),M=Math.min(P.length(),A.length())/2,V=m,N=f.normalize().multiplyScalar(M).add(V)),w.push({attribute:"fAngle",value:D}),w.push({attribute:"vAngleArcCenter",value:V}),w.push({attribute:"vAnglePointingPoint",value:N}),w.push({attribute:"vAngleBreakPoint",value:N}),w.push({attribute:"vAngleVector1",value:P}),w.push({attribute:"vAngleVector2",value:A}),this.set(w)}else if("Measure3PointsCircle"===this._sType)n=this.getAttribute("fRadius"),r=this.getAttribute("vNormal"),i=this.getAttribute("vCenter"),w.push({attribute:"fAngle",value:0}),S=.2*n,l=s.getViewpointInfo(this._viewer.currentViewpoint),(o=(new u.Vector3).crossVectors(r,l.sight)).length()>.001?o.normalize().multiplyScalar(n):o=l.right.clone().normalize().multiplyScalar(n),b=(h=(new u.Vector3).crossVectors(r,o).normalize()).clone().multiplyScalar(S+n),y=i.clone().add(o),m=i.clone().sub(o),d=y.clone().add(b),g=m.clone().add(b),v=0===this.getAttribute("iRadiusResultDisplayType")?y.clone():this.getAttribute("bRadiusDisplay")?g.clone().sub(d).multiplyScalar(.25).add(d):d.clone().add(g).multiplyScalar(.5),w.push({attribute:"vExtensionDirection3D",value:h}),w.push({attribute:"vFirstExtensionPoint3D",value:y}),w.push({attribute:"vSecondExtensionPoint3D",value:m}),w.push({attribute:"vFirstPoint3D",value:d}),w.push({attribute:"vSecondPoint3D",value:g}),w.push({attribute:"vLeaderBreakPoint3D",value:v}),w.push({attribute:"vLeaderPointingPoint3D",value:v.clone()}),this.set(w);else if("Measure3PointsAngle"===this._sType){w.push({attribute:"fDistance",value:0}),P=this._sMeasurable1.getSelPoint().sub(this._sMeasurable2.getSelPoint()),A=this._sMeasurable3.getSelPoint().sub(this._sMeasurable2.getSelPoint()),f=P.clone().add(A),M=Math.min(P.length(),A.length())/2;var I=f.normalize().multiplyScalar(M).add(this._sMeasurable2.getSelPoint());D=P.angleTo(A),w.push({attribute:"fAngle",value:D}),w.push({attribute:"vAngleVector1",value:P}),w.push({attribute:"vAngleVector2",value:A}),w.push({attribute:"vAngleArcCenter",value:this._sMeasurable2.getSelPoint()}),w.push({attribute:"vAnglePointingPoint",value:I.clone()}),w.push({attribute:"vAngleBreakPoint",value:I.clone()}),w.push({attribute:"vLeaderBreakPoint3D",value:I.clone()}),w.push({attribute:"vLeaderPointingPoint3D",value:I.clone()}),w.push({attribute:"vFirstExtensionPoint3D",value:I.clone()}),w.push({attribute:"vSecondExtensionPoint3D",value:I.clone()}),w.push({attribute:"vFirstPoint3D",value:I.clone()}),w.push({attribute:"vSecondPoint3D",value:I.clone()}),this.set(w)}},_buildConstructionPointsForConeCylSphere:function(){var e,i,n,r,a,o,l,c={oPos1:void 0,oPos2:void 0};if(this._sResultingType1===t.ResultType.CONE){var p=this._sMeasurable1.getApex(),d=this._sMeasurable1.getSemiAngle(),g=this.getAttribute("sSurfaceDisplayType");n=this._sMeasurable1.getPoints(),e="MinimumRadius"===g||"MinimumDiameter"===g?n.beginPoint:n.endPoint;var h=p.clone().sub(e).length()*Math.tan(d)/Math.sin(d);void 0===(l=this._sMeasurable1.getSelPoint())&&(e=this.getAttribute("vCenter"),o=p.clone().sub(e).length()*Math.tan(d),a=s.getViewpointInfo(this._viewer.currentViewpoint),(r=(new u.Vector3).crossVectors(this._vAxis,a.sight)).length()>.001?r.normalize().multiplyScalar(o):r=a.right.clone().normalize().multiplyScalar(o),l=e.clone().add(r));var b=l.clone().sub(p);b=b.normalize().multiplyScalar(h),c.oPos1=p.clone().add(b),this._sMeasurable1.vSlat=b,this._sMeasurable1.vAxis=e.clone().sub(p);var y=p.clone().sub(n.beginPoint).length()*Math.tan(d);if(y>.001){var m=y/Math.sin(d);this._sMeasurable1.arcRadius=m+Math.abs(h-m)/2}else this._sMeasurable1.arcRadius=h/2;i=c.oPos1.clone().sub(e),c.oPos2=e.clone().sub(i);var v,P=c.oPos2.clone().sub(p);this._sMeasurable1.vSlat1=P,v="Angle"===g?this._sMeasurable1.vAxis.clone():b.clone().add(this._sMeasurable1.vAxis),this._sMeasurable1.arcCenter=v.normalize().multiplyScalar(this._sMeasurable1.arcRadius).add(p.clone())}else if(this._sResultingType1===t.ResultType.CYLINDER){void 0===(l=this._sMeasurable1.getSelPoint())&&(o=this.getAttribute("fRadius"),a=s.getViewpointInfo(this._viewer.currentViewpoint),(r=(new u.Vector3).crossVectors(this._vAxis,a.sight)).length()>.001?r.normalize().multiplyScalar(o):r=a.right.clone().normalize().multiplyScalar(o),l=r),n=this._sMeasurable1.getPoints();var A=l.clone().sub(n.beginPoint),f=l.clone().sub(n.endPoint);e=n.beginPoint,f.length()<A.length()&&(e=n.endPoint);var M=n.beginPoint.clone().sub(n.endPoint);i=(i=(new u.Plane).setFromNormalAndCoplanarPoint(M.normalize(),e).projectPoint(l).clone().sub(e)).clone().normalize().multiplyScalar(this._sMeasurable1.getRadius()),c.oPos1=e.clone().add(i),c.oPos2=e.clone().sub(i)}else if(this._sResultingType1===t.ResultType.SPHERE){var D=(a=s.getViewpointInfo(this._viewer.currentViewpoint)).up.clone();D=D.negate(),e=this._sMeasurable1.getCenter();var S=this._sMeasurable1.getRadius(),w=this._sMeasurable1.getSelPoint();void 0===w&&(w=e.clone().add(a.right.clone().normalize().multiplyScalar(S))),i=(i=w.clone().sub(e)).normalize().multiplyScalar(S);var T=(new u.Vector3).crossVectors(D,i.clone().normalize());this._sMeasurable1.normal=T,c.oPos1=e.clone().add(i),c.oPos2=e.clone().sub(i)}return c},_buildConstructionPointsForLeader:function(e,i,n){var r=[],o=s.getDistanceFromPixel(this._viewer,i,e,this._frmWindow),l=s.getViewpointInfo(this._viewer.currentViewpoint).up.clone().multiplyScalar(o);if(this._sResultingType1===t.ResultType.CONE||this._sResultingType1===t.ResultType.CYLINDER||this._sResultingType1===t.ResultType.SPHERE){if(this._sResultingType1===t.ResultType.SPHERE||"Area"!==this.getAttribute("sSurfaceDisplayType")){var u=this._buildConstructionPointsForConeCylSphere();i=u.oPos1,n=u.oPos2}if(this._sResultingType1===t.ResultType.CONE&&"Area"!==this.getAttribute("sSurfaceDisplayType")){var c=this.getAttribute("fSemiAngle");if(void 0!==c&&!a.isZero(c)){var p=this._sMeasurable1.vAxis.clone();"Angle"===this.getAttribute("sSurfaceDisplayType")&&(p=this._sMeasurable1.vSlat1.clone()),r.push({attribute:"fQuadrant",value:0}),r.push({attribute:"vAngleArcCenter",value:this._sMeasurable1.getApex().clone()}),r.push({attribute:"vAnglePointingPoint",value:this._sMeasurable1.arcCenter.clone()}),r.push({attribute:"vAngleBreakPoint",value:this._sMeasurable1.arcCenter.clone()}),r.push({attribute:"vAngleVector1",value:p}),r.push({attribute:"vAngleVector2",value:this._sMeasurable1.vSlat.clone()})}}}r.push({attribute:"vFirstExtensionPoint3D",value:i.clone()}),r.push({attribute:"vFirstPoint3D",value:i.clone()});var d=i.clone();void 0!==n?(r.push({attribute:"vSecondExtensionPoint3D",value:n.clone()}),r.push({attribute:"vSecondPoint3D",value:n.clone()})):d=i.clone(),!this._sMeasurable1.arcCenter||this._sResultingType1!==t.ResultType.CONE||"Angle"!==this.getAttribute("sSurfaceDisplayType")&&"HalfAngle"!==this.getAttribute("sSurfaceDisplayType")||(d=this._sMeasurable1.arcCenter.clone()),r.push({attribute:"vLeaderPointingPoint3D",value:d}),r.push({attribute:"vLeaderBreakPoint3D",value:this._sResultingType1===t.ResultType.CONE?d:d.clone().add(l)}),this.set(r)},_buildConstructionPointsForDimension:function(e,t,i,n){var r,o,l,c,p,d,g=[],h=s.getDistanceFromPixel(this._viewer,t,e,this._frmWindow),b=a.areEqual(t,i,"Vector3"),y=s.getViewpointInfo(this._viewer.currentViewpoint);if(n){var m=(r=n.clone().normalize()).angleTo(y.sight.clone().negate());m>Math.PI/2&&(m=Math.abs(m-Math.PI));var v=(c=i,p=r,d=t.clone().sub(c).normalize(),(new u.Vector3).crossVectors(d,p)),P=v.angleTo(y.sight.clone().negate());P>Math.PI/2&&(P=Math.abs(P-Math.PI)),P>m&&(r=v),g.push({attribute:"iExtensionLinesManipulable",value:0})}else r=b?y.up.clone():function(e,t,i){var n=e.clone().sub(t).normalize(),r=(new u.Vector3).crossVectors(n,i);return a.isZero(r.length())&&(r=y.up.clone()),r}(t,i,y.sight);r.normalize();var A,f,M=r.clone().multiplyScalar(h);M.dot(y.up)<0&&M.negate(),b?(o=t.clone(),l=i.clone(),f=(A=o.clone().add(l).multiplyScalar(.5)).clone().add(M)):(o=t.clone().add(M),l=i.clone().add(M),f=(A=o.clone().add(l).multiplyScalar(.5)).clone()),g.push({attribute:"vExtensionDirection3D",value:r}),g.push({attribute:"vFirstExtensionPoint3D",value:t.clone()}),g.push({attribute:"vSecondExtensionPoint3D",value:i.clone()}),g.push({attribute:"vFirstPoint3D",value:o}),g.push({attribute:"vSecondPoint3D",value:l}),g.push({attribute:"vLeaderBreakPoint3D",value:f}),g.push({attribute:"vLeaderPointingPoint3D",value:A}),this.set(g)},onViewerEventCB:function(e){if(this.getNode()&&this.getNode().onViewerEventCB){if("beginExplodeCmd"===e.eventType||"endExplodeCmd"===e.eventType){var t=this._viewer.getVisibleSpace();this._bCreateMeasureInShowSpace===t&&this.setVisibleFlag("endExplodeCmd"===e.eventType)}this.getNode().onViewerEventCB(e)}},isPartialMeasure:function(){return this._partialMeasure},setPartialMeasure:function(e){if(this._partialMeasure!==e){this._partialMeasure=e;var t=[];if(t.push({name:"sFontStyle",value:"normal"}),t.push({name:"bIsFilled",value:!0}),t.push({name:"bHasBorder",value:!1}),t.push({name:"fLineStyleThicknessIndex",value:0}),t.push({name:"sLineStylePattern",value:"1"}),t.push({name:"fLeaderStyleThicknessIndex",value:0}),t.push({name:"sLeaderStylePattern",value:"1"}),this._partialMeasure){var i=1;t.push({name:"cFillStyleColor",value:new u.Color("#ff8a2e")}),t.push({name:"cLineStyleColor",value:new u.Color("#8f4c00")}),t.push({name:"cLeaderStyleColor",value:new u.Color("#8f4c00")}),"partialCmd"===this._partialMeasure?(i=.4,t.push({name:"cFontColor",value:new u.Color("#e5e5e5")})):t.push({name:"cFontColor",value:new u.Color("#ffffff")}),t.push({name:"fOpacity",value:i})}else t.push({name:"cFontColor",value:new u.Color("#ffffff")}),t.push({name:"cFillStyleColor",value:new u.Color("#368ec4")}),t.push({name:"cLineStyleColor",value:new u.Color("#3d3d3d")}),t.push({name:"cLeaderStyleColor",value:new u.Color("#3d3d3d")}),t.push({name:"fOpacity",value:1});this.setAttributes(t),this.refreshNode()}},_removeAttribute:function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++)this.getAttribute(e[t])&&(delete this["_"+e[t]],null)},refreshAssistantTool:function(e,t){var i;this._isInCreationState&&this._assistantTool&&(t?(e.position&&(i=e.position.clone()),e.mousePosition&&(e.mousePosition.y=e.mousePosition.y+45,i=s.getNearPositionFrom2DCoordinates(e.mousePosition,this._viewer)),this._assistantTool.updatePosition(i),this._vAssistantPosition=i,this._assistantTool.setVisibleFlag(!0)):this._assistantTool.setVisibleFlag(!1))},movePosDownByPixels:function(e){if(e&&e.position&&e.pixels){var t=s.getDistanceFromPixel(this._viewer,e.position.clone(),e.pixels),i=this._viewer.currentViewpoint.getUpDirection();return i=(i=i.normalize()).multiplyScalar(-t),(new u.Vector3).addVectors(e.position.clone(),i)}},getCustoListAsPerMainValue:function(e){var t=[],i=this._sMeasurable1.getPoints();switch(e){case"Coordinates":case"Axis":t.push("selection","computationMode");break;case"Curve_Length":t.push("point1","point2","selection","computationMode");break;case"Line_Length":t.push("point1","point2","direction","selection","computationMode");break;case"Arc_Length":t.push("point1","point2","radius","diameter","selection","computationMode");break;case"Cylinder_Length":t.push("point1","point2","direction","radius","diameter","area","centerOfGravity","selection","computationMode");break;case"Cone_Length":t.push("point1","point2","direction","angle","halfAngle","apex","minRadius","maxRadius","minDiameter","maxDiameter","area","centerOfGravity","selection","computationMode");break;case"Distance":case"Min_Distance":case"Max_Distance":t.push("point1","point2","components","direction","selection1","selection2","computationMode");break;case"Angle_Btw2Selections":t.push("center","selection1","selection2","computationMode");break;case"Angle_By3Pts":t.push("point1","point2","center","computationMode");break;case"Cone_Angle":case"Half_Angle":t.push("point1","point2","length","direction","apex","minRadius","maxRadius","minDiameter","maxDiameter","area","centerOfGravity","selection","computationMode");break;case"Radius":case"Diameter":t.push("center","arcLength","circlePerimeter","selection","computationMode");break;case"Cylinder_Radius":case"Cylinder_Diameter":t.push("point1","point2","length","direction","area","centerOfGravity","selection","computationMode");break;case"Sphere_Radius":case"Sphere_Diameter":t.push("center","area","selection","computationMode");break;case"Radius_By3Pts":case"Diameter_By3Pts":t.push("point1","point2","point3","center","computationMode");break;case"Min_Radius":case"Max_Radius":case"Min_Diameter":case"Max_Diameter":var n;t.push("point1","point2","length","direction","angle","halfAngle","apex"),"Min_Radius"===e?n="maxRadius":"Max_Radius"===e?n="minRadius":"Min_Diameter"===e?n="maxDiameter":"Max_Diameter"===e&&(n="minDiameter"),t.push(n),t.push("area","centerOfGravity","selection","computationMode");break;case"Surface_Area":t.push("centerOfGravity","selection","computationMode");break;case"PlanarSurface_Area":t.push("centerOfGravity","equation","selection","computationMode");break;case"Product_Area":void 0===this.getAttribute("fArea")&&void 0!==this.getAttribute("fLength")?(void 0!==i.beginPoint&&void 0!==i.endPoint&&t.push("point1","point2"),t.push("selection","computationMode")):void 0!==this.getAttribute("fArea")?t.push("volume","centerOfGravity","selection","computationMode"):t.push("selection","computationMode");break;case"Volume":t.push("area","centerOfGravity","selection","computationMode");break;case"Thickness":t.push("point1","point2","direction","selection","computationMode")}return t},setCustomizationToMeasure:function(e){var t,i=this.getCustoListAsPerMainValue(this._sMainValueType),n=[],r=i.length;if("true"===localStorage.getItem("CATWebUXMePreferenceImplementation"))for(t=0;t<r;t++)n[t]={custoName:i[t],custoValue:e[t]};else for(t=0;t<r;t++)n[t]={custoName:i[t],custoValue:!0};this.setAttribute("lCustomization",n)}})});