define("DS/DELPPRData/WKIModelService",["UWA/Core"],function(e){"use strict";return function(t,n){var r=n.getOption("mappingKeys");return{getWKIContentPromise:function(i,o){return new e.Promise(function(a,s){e.is(i,"array")&&i.length>0&&o?t.getFileNameFromIndex(i,o).then(function(i){e.is(i,"string")?t.getFileContent(i,r.READERTYPE.TEXT).then(a).fail(s):r.FILETYPES.WKICONTENT===o?a(null):s(n.getNLSValue("FileNotFound",{fileType:o},"Error","Message"))}).fail(s):s(n.getNLSValue("Error.Message.InvalidInput"))})},destroy:function(){r=null}}}}),define("DS/DELPPRData/WebService",["UWA/Core","DS/DELWebViewerUtils/DELWebViewerSettingsMgt","DS/WAFData/WAFData","DS/Logger/Logger","DS/DELWebViewerUtils/Utils"],function(e,t,n,r,i){"use strict";var o,a=function(){return{request:function(o){return new e.Promise(function(a,s){var u,l={Accept:"application/json, text/plain, application/octet-stream",SecurityContext:t.getSetting("pad_security_ctx")?t.getSetting("pad_security_ctx"):"preferred","Content-Type":"application/json"};e.is(o,"object")?(e.is(o.headers)&&Object.assign(l,o.headers),(u=new URL(o.url)).searchParams.set("tenant",i.getPlatformId()),n.authenticatedRequest(u.toString(),{method:o.method?o.method:"",type:o.dataType?o.dataType:"",data:o.payload?e.Json.encode(o.payload):"",headers:l,timeout:t.getSetting("webapi_timeout"),proxy:"none",onComplete:function(e){a(e)},onTimeout:function(e,t){r.error("WebService Call failed due to - "+e),s(t)},onFailure:function(e,t){r.error("WebService Call failed due to - "+e),s(t)}})):(r.error("WebService Request Input not found."),s("Error.InvalidInput.Message"))})}}};return e.is(o)||(o=new a),o}),define("DS/DELPPRData/BuildUpModelService",["UWA/Core","DS/DELPPRData/WebService","DS/DELWebViewerUtils/Utils","text!DS/DELPPRData/assets/json/Webservices.json"],function(e,t,n,r){"use strict";return function(i,o){var a,s=o.getOption("logger"),u=JSON.parse(r),l=o.getOption("mappingKeys"),c=l.BUILDUPKEYS.BUILDUPDEFKEYS;return{getBuildUpSettings:function(t){return new e.Promise(function(n,r){var a,u=t.processId;i.getFileNameFromIndex([u],l.FILETYPES.BUILDUPSETTINGS).then(function(t){e.is(t,"string")?i.getFileContent(t,l.READERTYPE.TEXT).then(function(e){n([e[l.BUILDUPKEYS.BUILDUPSETTINGS]])}).fail(r):(a=o.getNLSValue("FileNotFound",{fileType:l.FILETYPES.BUILDUPSETTINGS},"Error","Message"),s.error(a),r(a))}).fail(r)})},getContent:function(r){var u=2===o.getOption("viewerType"),f=o.getOption("dynamicBuildUp"),d=function(){var t=r.processId;return e.is(i)?i.loadProcess(t).then(function(){return new e.Promise(function(t,n){i.getFileNameFromZipBlob(l.FILENAMES.BUILDUPDEF+".").then(function(t){return t?i.getFileContent(t,l.READERTYPE.TEXT):e.Promise.reject(o.getNLSValue("FileNotFound",{fileType:l.FILENAMES.BUILDUPDEF},"Error","Message"))}).then(function(r){var i;e.is(r,"object")?(a=r,t(r)):(i=o.getNLSValue("FileContentNotFound",{fileContentType:l.FILENAMES.BUILDUPDEF+"Content"},"Error","Message"),s.error(i),n(i))}).fail(function(e){s.error(e),n(e)})})}).then(function(t){return new e.Promise(function(n,r){i.getFileNameFromZipBlob(l.FILETYPES.BUILDUPCONTEXT+".").then(function(t){return t?i.getFileContent(t,l.READERTYPE.TEXT):e.Promise.reject(o.getNLSValue("FileNotFound",{fileType:l.FILETYPES.BUILDUPCONTEXT},"Error","Message"))}).then(function(a){var u,f=[];e.is(a,"object")?(a.mfgItemsBuildUp.forEach(function(e){var n=e.Id?e.Id:"",r={};r[l.BUILDUPKEYS.PATH]=t[c.MFGITEMS][n][l.BUILDUPKEYS.PATHIDS],r[l.BUILDUPKEYS.CATEGORY]=e[l.BUILDUPKEYS.CATEGORY],f.push(r),delete t[c.MFGITEMS][n]}),i.set("buildupContext",f),n(f)):(u=o.getNLSValue("FileContentNotFound",{fileContentType:l.FILETYPES.BUILDUPCONTEXT+"Content"},"Error","Message"),s.error(u),r(u))}).fail(function(e){s.error(e),r(e)})})}):e.Promise.reject(o.getNLSValue("Error.DataManagerNotFound.Message"))};return u&&f&&d(),s.log(`************** Get Process BuildUp Content using ${f?"Dynamic Build Up":"Published Build Up"} **********`),f?function(){let o=function(e,n){return t.request({url:e,method:"POST",dataType:"json",payload:n})},a=function(){var e={"dsprcs:MfgProcess":{id:r.processId},"dsprcs:Mfg":{id:r.mfgId},"dsprcs:Resource":{}};return r.installPath&&(e["dsprcs:Mfg"].installPath=r.installPath),r.resourceId&&(e["dsprcs:Resource"].id=r.resourceId),r.filter&&(e.filter=r.filter),e};return e.Promise.all([function(){let e=`${n.get3DSpaceUrl()}/resources/v0/dsprcs/private/invoke/buildup`;return o(e,a()).then(function(e){return i.set("buildupContent",e),e})}(),function(){let e=`${n.get3DSpaceUrl()}/resources/v1/delviewerservices/private/invoke/getBuildUpContext`;return o(e,a()).then(function(e){return i.set("buildupContext",e.results),e})}()])}():d()},set:i.set,get:i.get,reset:function(){a=null,i.reset()},destroy:function(){i&&i.destroy(),s=l=c=null},getMFGAndResourcePaths:function(){var t,n,r=[];if(a)for(t in a)if(a.hasOwnProperty(t)&&e.is(a[t],"object"))for(n of Object.values(a[t]))e.is(n[l.BUILDUPKEYS.PATHIDS],"array")&&n[l.BUILDUPKEYS.PATHIDS].length>0&&r.push(n[l.BUILDUPKEYS.PATHIDS].toString());return r},getBuildUp:function(t){return o.getOption("dynamicBuildUp")?function(t){var n,r=t.path,o=i.get("process"),a=o.installPath&&o.installPath.length>0?o.installPath.slice(0,o.installPath.length-1):[],s=[],u=function(t,n){e.is(t,"array")&&t.length>0&&t.forEach(function(e){var t={};t[l.BUILDUPKEYS.PATH]=a.concat(e.objectinstancepath),e.bucategory&&(t[l.BUILDUPKEYS.CATEGORY]=l.BUILDUPCATEGORY[e.bucategory]),t[l.GRAPHICPROPERTIES.VISIBILITY]=n,t[l.GRAPHICPROPERTIES.VISIBILITYFREE]=!n,s.push(t)})};return e.is(r,"array")&&r.length>0&&(n=i.get("buildupContent")[r.join("/")])&&(u(n[l.BUILDUPKEYS.OBJECTSTOSHOW],!0),u(n[l.BUILDUPKEYS.OBJECTSTOHIDE],!1)),s}(t):function(t){var n=function(t){return new e.Promise(function(n,r){var i,a,u,f=[];if(e.is(t.buildUp,"object")){for(i in c)c.hasOwnProperty(i)&&(a=c[i]+l.BUILDUPKEYS.BUILDUP,e.is(t.buildUp[a],"array")&&t.buildUp[a].length>0&&t.buildUp[a].forEach(function(e){var n=e.Id?e.Id:"",r={};n&&(r[l.BUILDUPKEYS.PATH]=t.buildUpDef[c[i]][n][l.BUILDUPKEYS.PATHIDS],r[l.BUILDUPKEYS.CATEGORY]=e[l.BUILDUPKEYS.CATEGORY],r[l.BUILDUPKEYS.POSITION]=e[l.BUILDUPKEYS.MODEL.POSITION],r[l.BUILDUPKEYS.TYPE]=c[i],f.push(r))}));n(f)}else u=o.getNLSValue("FileContentNotFound",{fileContentType:l.FILETYPES.BUILDUPCONTENT},"Error","Message"),s.error(u),r(u)})};return new e.Promise(function(r,u){var c;(c=a,new e.Promise(function(n,r){var a,u=t.path;e.is(u,"array")&&u.length>0&&i.getFileNameFromIndex(u,l.FILETYPES.BUILDUPCONTENT).then(function(t){e.is(t,"string")?i.getFileContent(t,l.READERTYPE.TEXT).then(function(e){n({buildUp:e,buildUpDef:c})}).fail(r):(a=o.getNLSValue("FileNotFound",{fileType:l.FILETYPES.BUILDUPCONTENT},"Error","Message"),s.error(a),r(a))}).fail(r)})).then(n).then(r).fail(u)})}(t)},isObjectAvailable:function(e){return!!(a&&a[e]&&Object.keys(a[e]).length>0)},getInstallContext:function(r){var i,a,s,l=u.getMfgItemInstallDependencies;if(r&&r.installPath&&r.installPath.length>1){a=r.installPath[0],s=r.installPath[1];let e=`${n.get3DSpaceUrl()}${l.url}`,o=l.method,u=l.payload;u.assemblyid=a,u.installinstids=[s],r.filter&&(u.config=n.getObjectHavingProperty(r.filter,"config_filter")),i=t.request({url:e,method:o,dataType:"json",payload:u}).then(e=>e[s])}else i=e.Promise.reject(o.getNLSValue("Error.InvalidInput.Message"));return i}}}}),define("DS/DELPPRData/facets/DELWkiInstructionsFacetModel",["UWA/Core","DS/DELPPRData/WebService","DS/DELWebViewerUtils/Utils","text!DS/DELPPRData/assets/json/Webservices.json"],function(e,t,n,r){"use strict";return function(){var i=JSON.parse(r).WorkInstructionsTypes;return{getData:async function(r){var o,a,s;return"businessobject"!==r.get("metatype")&&"bus"!==r.get("metatype")||(o=r.get("objectId"),a=await async function(r){var i=null,o=`${n.get3DSpaceUrl()}/cvservlet/fetch/v2`,a={label:"Fetch-V2-"+Date.now(),physicalid:[r],locale:"en",select_predicate:["ds6w:type"]},s=await t.request({url:o,method:"POST",dataType:"json",payload:a});return s&&e.is(s.results,"array")&&s.results.forEach(t=>{e.is(t.attributes,"array")&&t.attributes.forEach(e=>{"ds6w:type"===e.name&&(i=e.value)})}),i}(o),s=await async function(e,r){var o,a;return i[r]&&(o=`${n.get3DSpaceUrl()}`+`${i[r].url.replace("{ID}",e)}`,a=await t.request({url:o,method:"GET",dataType:"json"})),{response:a,type:r}}(o,a)),s}}}}),define("DS/DELPPRData/Zip",["UWA/Core","DS/ZipJS/zip-fs","DS/VisuUnstreamers/FileInZipStreamObject","DS/DELWebViewerUtils/Utils","DS/Logger/Logger","DS/DELPPRData/WebService"],function(e,t,n,r,i,o){"use strict";var a,s=function(){var a,s,u=function(){return new e.Promise(function(e,t){a?e():t("Error.ZipNotInit.Message")})};return{init:function(e){var t=e.getOption("mappingKeys");t&&(a=t.DOCUMENTKEYS),s=e.getOption("logger")},fetchProcessData:function(t,n){var i=this,l=r.get3DSpaceUrl(),c=function(){return`timestamp=${(new Date).getTime()}`},f=function(){return new e.Promise(function(t,r){var i=`${l}/cvservlet/expand`;o.request({url:i,method:"POST",dataType:"json",payload:n}).then(function(n){t(function(t){var n,r;return e.is(t,"object")&&e.is(t.results,"array")&&t.results.length>0&&t.results.forEach(function(t){t.attributes&&t.attributes.length>0&&t.attributes.find(function(e){return e.name===a.TYPE&&e.value===a.DOCUMENTTYPE})&&(r=t.attributes.find(e=>e.name===a.PHYSICALID),n=e.is(r,"object")?r.value:"")}),n}(n))}).fail(r)})},d=function(t){return new e.Promise(function(n,r){var i;e.is(t)?(i=`${l}/resources/v1/modeler/documents/${t}/files/DownloadTicket?${c()}`,function(){var e=`${l}/resources/v1/application/CSRF?${c()}`;return o.request({url:e,method:"GET",dataType:"json"})}().then(function(e){return o.request({url:i,method:"PUT",dataType:"json",headers:{ENO_CSRF_TOKEN:e.csrf.value}})}).then(n).fail(r)):(s.debug("Document id not found. Ensure workplan is published correctly."),r("Error.PublishedContentNotFound.Message"))})},g=function(t){return new e.Promise(function(n,r){e.is(t)&&e.is(t.data,"array")&&e.is(t.data[0].dataelements.ticketURL)?o.request({url:t.data[0].dataelements.ticketURL,method:"GET",dataType:"blob"}).then(function(o){var u;e.is(t.data[0].dataelements.fileNames,"array")?(u=t.data[0].dataelements.fileNames.find(function(e){return-1!==e.indexOf(a.FILETYPE)}),e.is(u)?i.getFileNameFromZipBlob(o,u).then(function(e){i.getFileContent(o,e,"BLOB").then(n).fail(r)}).fail(r):(s.debug("Viewer Zip content file not found. Ensure workplan is published correctly."),r("Error.PublishedContentNotFound.Message"))):(s.debug("File names not found. Ensure workplan is published correctly."),r("Error.PublishedContentNotFound.Message"))}).fail(r):(s.debug("FCS URL not found. Ensure workplan is published correctly."),r("Error.PublishedContentNotFound.Message"))})},p=function(t){return new e.Promise(function(n,r){e.is(t)&&t.size>0?i.getFileNameFromZipBlob(t,a.INDEXFILESUFFIX).then(function(n){var r;return n?r=i.getFileContent(t,n,"TEXT"):(s.debug("Index file is invalid in published content. Ensure workplan is published correctly."),r=e.Promise.reject("Error.PublishedContentNotFound.Message")),r}).then(function(i){e.is(i)?n({zipBlob:t,indexFile:i}):(s.debug("Index file is invalid in published content. Ensure workplan is published correctly."),r("Error.PublishedContentNotFound.Message"))}).fail(r):(s.debug("Published content not found for given workplan. Ensure workplan is published correctly"),r("Error.PublishedContentNotFound.Message"))})};return new e.Promise(function(e,r){t&&n?u().then(f).then(d).then(g).then(p).then(e).fail(r):r("Error.InvalidInput.Message")})},getFileContent:function(t,r,o){var a={BLOB:function(e,t){e.readAsBlob(t)},TEXT:function(e,t){e.readAsText(t)}};return new e.Promise(function(s,l){u().then(function(){var u,c=a[o];c?(c(u=new n(t,r),function(t){try{"TEXT"===o&&(t=JSON.parse(t)),e.is(t)?s(t):l("Error.FileContentNotFound.Message")}catch(e){i.error("File content extraction failed due to - "+e),l("Error.FileContentExtractionFailed.Message")}}),u.close()):l("Error.InvalidReaderType.Message")}).fail(l)})},getFileNameFromZipBlob:function(n,r){return new e.Promise(function(i,o){u().then(function(){n&&r?t.createReader(new t.BlobReader(n),function(t){t.getEntries(function(t){t.length>0?i(function(t,n){var r,i;for(r=0;r<t.length;++r)if(e.is(t[r].filename)&&(t[r].filename===n.trim()||t[r].filename.indexOf(n)>0)){i=t[r].filename;break}return i}(t,r)):o("Error.NoEntriesInZipBlob.Message")})},o):o("Error.FilenameNotFound.Message")}).fail(o)})},getFileName:function(t,n,r){return new e.Promise(function(i,o){u().then(function(){var o,a,s,u,l;if(e.is(t,"object")&&e.is(n,"array")&&n.length>0&&r&&(o=t.occurrences,e.is(o,"array")))for(a=0;a<o.length;a++)if(e.Array.equals(o[a].pathIds,n)){for(l=o[a].files,s=0;s<l.length;s++)if(l[s].type===r){u=l[s].name;break}break}i(u)}).fail(o)})},getOperationPath:function(t,n){return new e.Promise(function(e,r){u().then(function(){var i;t&&n&&(i=t.occurrences.find(function(e){return!!(e.pathIds&&e.pathIds.length>1)&&(e.pathIds[e.pathIds.length-1]===n||e.pathIds[e.pathIds.length-2]===n)})),i?e(i.pathIds):r("Error.StepPathInvalid.Message")}).fail(r)})},dispose:function(){a=s=null}}};return e.is(a)||(a=new s),a}),define("DS/DELPPRData/DataManager",["UWA/Core","DS/DELPPRData/Zip"],function(e,t){"use strict";return function(n){var r={zip:{}},i=n.getOption("del3DModel").expand.document;return t.init(n),{get:function(e){return r[e]?r[e]:null},set:function(e,t){r[e]=t},reset:function(){r={zip:{}}},destroy:function(){r={zip:{}},t.dispose(),i=null},loadProcess:function(o){return new e.Promise(function(e,a){var s=i;o&&s&&(s.multi_root_physicalid=o,t.fetchProcessData(o,s).then(function(t){r.zip=t,e(t)}).fail(function(e){a(n.getNLSValue(e))}))})},getFileNameFromIndex:function(i,o){return new e.Promise(function(e,a){t.getFileName(r.zip.indexFile,i,o).then(e).fail(function(e){a(n.getNLSValue(e))})})},getFileNameFromZipBlob:function(i){return new e.Promise(function(e,o){return t.getFileNameFromZipBlob(r.zip.zipBlob,i).then(e).fail(function(e){o(n.getNLSValue(e))})})},getFileContent:function(i,o){return new e.Promise(function(e,a){t.getFileContent(r.zip.zipBlob,i,o).then(e).fail(function(e){a(n.getNLSValue(e))})})},getOperationPath:function(i){return new e.Promise(function(e,o){r&&r.zip?t.getOperationPath(r.zip.indexFile,i).then(e).fail(function(e){o(n.getNLSValue(e))}):o(n.getNLSValue("Error.ProcessNotSet.Message"))})}}}}),define("DS/DELPPRData/ModelFactory",["UWA/Core","DS/DELPPRData/DataManager","text!DS/DELPPRData/assets/json/DELPPRDataConfig.json"],function(e,t,n){"use strict";return function(r){var i,o={},a="ModelService",s={BuildUpBehavior:"DS/DELPPRData/BuildUpModelService",WorkInstructionBehavior:"DS/DELPPRData/WKIModelService"};return r.setOption("del3DModel",JSON.parse(n)),{getCreatePromise:function(n){return new e.Promise(function(u){var l,c={};i=e.is(n,"array")&&n.length>0?new t(r):null,l=[null,i,r].concat(Array.prototype.slice.call(arguments,1)),e.is(n,"array")&&n.length>0?(n.forEach(e=>{s[e]&&(c[e]=s[e])}),require(Object.values(c),function(){var e=Array.prototype.slice.call(arguments),t=Object.keys(c);e.length>0&&e.forEach(function(e,n){o[t[n]+a]=new(Function.prototype.bind.apply(e,l))}),u(o)})):u(o)})},getInstance:function(e){return e&&o[e]?o[e]:null},getDataManager:function(){return i},destroy:function(){i&&i.destroy(),o=a=i=null}}}}),define("DS/DELPPRData/ModelInterface",["UWA/Core","DS/DELPPRData/ModelFactory","DS/DELPPRData/WebService","DS/DELWebViewerUtils/Utils","DS/DELWebViewerUtils/DELWebViewerSettingsMgt"],function(e,t,n,r,i){"use strict";return function(o){var a=new t(o);return{getCreatePromise:function(e){return a.getCreatePromise(e)},loadProcess:function(e){return this.getInstance("BuildUpBehaviorModelService").getContent(e)},getInstance:function(e){return a.getInstance(e)},getOperationPath:function(t){var n=a.getDataManager();return n?n.getOperationPath(t):e.Promise.reject(o.getNLSValue("Error.DataManagerNotFound.Message"))},getIndexingDate:function(t){var o={select_service:[t]};return new e.Promise(function(e,t){var a=i.getSetting("pad_security_ctx")?i.getSetting("pad_security_ctx"):"preferred",s=`${r.get3DSpaceUrl()}/cvservlet/indexingdate?SecurityContext=${a}`;n.request({url:s,method:"POST",dataType:"json",payload:o}).then(function(t){e(t)}).fail(t)})},getProgressiveExpandData:function(t){var i=r.get3DSpaceUrl()+"/cvservlet/progressiveexpand/v2?output_format=cvjson";return new e.Promise(function(e,r){n.request({url:i,method:"POST",dataType:"json",payload:t}).then(function(t){e(t)}).fail(r)})},getDataManager:function(){return a.getDataManager()},destroy:function(){a&&a.destroy(),a=null}}}});