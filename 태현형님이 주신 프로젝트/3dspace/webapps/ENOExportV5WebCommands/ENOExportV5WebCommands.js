define("DS/ENOExportV5WebCommands/utils/ExportV5connexionMngtUtil",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/ENOExportV5WebCommands/assets/nls/ExportV5Cmd"],function(e,t,i,o,n,r){"use strict";var s=null,a=null;return{GetCurrentSecurityContext:function(){return new t(function(e,t){o.getInstance().getSecurityContext({onSuccess:function(t){a=t.SecurityContext.replace("ctx::",""),e()},onFailure:function(){var e={message:r.error.security_context_fail};t(e)}})})},get3DSpaceUrl:function(){return this.getPlatformURL("3DSpace")},getPlatformId:function(){return"undefined"!=typeof widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},retrievePlatformUrl:function(){return new t(function(e,t){null===s?n.getPlatformServices({onComplete:function(t){s=t,e()},onFailure:function(e){t(e)}}):e()})},getTenantInfo:function(e){for(var t={},i=0;i<s.length;i++)if(s[i].platformId===e){t=s[i];break}return t},getPlatformURL:function(e){if(!UWA.is(s,"array"))throw new Error("Platform services not initialize yet");var t=this.getPlatformId(),i=this.getTenantInfo(t);if(void 0===i[e])throw console.error("No "+e+" URL available for this tenant."),new Error("Unknown service "+e);return i[e]},SendServerRequest:function(e){var t=this,o={};o.method=e.webService.verb,t.GetCurrentSecurityContext().then(function(){o.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:"ctx::"+a},o.type="json",o.proxy="passport",o.timeout=void 0!==e.timeout?e.timeout:3e5,o.onComplete=e.callback.onComplete,o.onFailure=e.callback.onFailure;var n=e.data;o.data=JSON.stringify(n),t.retrievePlatformUrl().then(function(){var n=t.get3DSpaceUrl();i.authenticatedRequest(n+e.webService.url,o)})}).catch(function(t){e.callback.onFailure(t)})}}}),define("DS/ENOExportV5WebCommands/commands/ExportV5PSECmd",["DS/ApplicationFrame/Command","i18n!DS/ENOExportV5WebCommands/assets/nls/ExportV5Cmd","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/Utilities/UUID"],function(e,t,i,o,n,r){"use strict";return e.extend({_check_roots:function(){i.get().getPADTreeDocument().getRoots().length>0?this.enable():this.disable()},_check_added_roots:function(e){i.get().getPADTreeDocument();0===e.data.nb_root?this.disable():this.enable()},init:function(e){this._parent(e);var t=i.get(),o=t.options.model?t.options.model:t.getPADTreeDocument();if(UWA.Utils.Client.Platform.ios)this.disable();else{this._check_roots();var n=this._check_roots.bind(this);o.addEventListener("addChild",n),o.addEventListener("removeChild",n),this._check_roots(),t.addEvent("onRootsVisibility",this._check_roots.bind(this)),t.getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},this._check_added_roots.bind(this))}},_getSelectedNodesId:function(e){for(var t=[],i=0;i<e.length;i++){var o=e[i];t.push(o.getID())}return t},_buildRequestMessage:function(e,t){for(var i={requests:[]},o=[],n=[],s=0;s<t.length;s++){var a=t[s],l=a.getOccurencePath(),d=a.getRoot(),c=o.indexOf(d.getID());if(-1===c){o.push(d.getID());var u=[l];n.push(u)}else n[c]&&n[c].push(l)}var m={V1:{}};for(s=0;s<o.length;s++){var p,h={};h.rootId=o[s],h.selection=n[s];var f=null!=e.HasFilter;if(f){var g=e.HasFilter(o[s]);UWA.is(g.hasFilter)&&!0===g.hasFilter?UWA.is(e.GetFilterSpec(o[s],m).CVQuery)&&(p=e.GetFilterSpec(o[s],m).CVQuery):f=!1}f||(p={union:{expand:[{root_path_physicalid:n[s],no_type_filter_rel:["XCADBaseDependency"],"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"'}]}});p.select_bo=["physicalid","ds6w:label","ds6w:type","ds6w:cadMaster","ds6w:xcadFileName"],p.select_rel=["physicalid"],p.label="ExpandForWebExchanges_"+r.v4(),h.msgExpand=p,i.requests.push(h)}return console.log(i),i},execute:function(){var e=this,t=i.get(),o=t.options.model?t.options.model:t.getPADTreeDocument();require(["DS/ENOExportV5WebCommands/commands/ExportV5GenericCmd"],function(i){var n=o.getSelectedNodes(),r=e._buildRequestMessage(t,n);new i({command_id:e.options.ID,render_div:".xnav_viewmain",disable_cmd:()=>e.disable(),enable_cmd:()=>e.enable(),data:{requests:r.requests}})})}})}),define("DS/ENOExportV5WebCommands/views/_EV5CustomizeView",["css!DS/UIKIT/UIKIT","css!DS/ENOExportV5WebCommands/ENOExportV5WebCommands","i18n!DS/ENOExportV5WebCommands/assets/nls/ExportV5Cmd","text!DS/ENOExportV5WebCommands/assets/catrsc/ExportV5Locations.json","UWA/Controls/Abstract","UWA/Class/Events","UWA/Promise","DS/WAFData/WAFData","DS/PADUtils/PADUtilsServices","DS/Windows/Panel","DS/UIKIT/Modal","DS/Controls/ButtonGroup","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/LineEditor","DS/Controls/Loader","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/ComboBox","DS/Controls/Expander","DS/Core/PointerEvents","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","DS/Utilities/UUID","DS/i3DXCompassServices/i3DXCompassPubSub"],function(e,t,i,o,n,r,s,a,l,d,c,u,m,p,h,f,g,b,_,v,C,x,S,y,E){"use strict";return n.extend(r,{name:"ev5customizeview",_command_id:"",_applyOnlyToThisApp:!1,init:function(e){this._parent(e),UWA.is(e.render_div)&&(this.render_div=document.querySelector(e.render_div));var t=this;e.controller&&(this.controller=e.controller),require(["DS/ENOFloatingPanel/ENOFloatingPanel"],function(o){t._command_id=e._command_id,t.elements.useDLNames=!1,t.model=e.model,t.elements.container=t._createContent(),t.elements.floatingpanel=new o({className:t.name,body:t.elements.container,footer:t._buildFooter(),title:i.title,overlay:!0,closable:!0,animate:!0,resizable:!0,visible:!0,events:{onClose:function(){t.controller._destroyCmd()}}}),t.elements.floatingpanel.inject(t.render_div)})},_isLineEditorPathValid:function(){var e=this.elements.lineEditor.getContent().getChildren()[0].value;return this._isPathValid(e)},_isSelectionValid:function(){return 1==this.elements.useDLNames?-1!=this.elements.combobox.selectedIndex:this._isLineEditorPathValid()},_isPathValid:function(e){if(e){if(e=e.trim(),navigator.platform.indexOf("Win")>-1){return!!/^(?:[a-z]:|\\\\[a-z0-9_.$‚óè-]+)\\(?:[^\\\/:*?"<>|\r\n]+\\)*[^\\\/:*?"<>|\r\n]*$/.test(e.toLowerCase())}return!!/[^\0]+/.test(e)}return!1},_onPathChange:function(){this.elements.launchbutton.disabled=!this._isLineEditorPathValid()},_expandCompleted:function(){this.myLoader.off()},_createContent:function(){var e=this,t=UWA.createElement("div",{class:"ev5customizeview_content"}),n=UWA.createElement("div",{class:"ev5customizeview_body"}).inject(t);n.setAttribute("id","ev5customizeview_body");var r=UWA.createElement("h5",{content:i.option_path.label});n.appendChild(r),o=UWA.is(o,"string")?JSON.parse(o):o;var s=o.paths.length,a=o.manual,l=localStorage.getItem("ExportV5path");if(0===s)if(!0===a){var d="";d=l&&this._isPathValid(l)?l:o.defaultLocation,e.elements.lineEditor=new h({placeholder:i.option_path.option_text,requiredFlag:!0,value:d}),e.elements.lineEditor.addEventListener("uncommittedChange",e._onPathChange.bind(this)),n.appendChild(e.elements.lineEditor.getContent())}else e._displayNotification("error",i.error.emptyDefinedPath.title,i.error.emptyDefinedPath.subtitle),e.controller._destroyCmd();else{var c,u,C=[],x=[],S=[],y=!1,E=new g({shouldBeSelected:function(e){return"section"!==e.options.comboBoxSemantics}}),D=new b({label:i.option_path.predefined_paths,comboBoxSemantics:"section"});E.addRoot(D);var w=-1,N=1,P=0;o.paths.forEach(function(t){c=t.name,u=t.path,void 0===t.name||""===c?void 0!==t.path&&""!==u?(e._displayNotification("error",i.error.emptyPathIdentifier.title,i.error.emptyPathIdentifier.subtitle),e.controller._destroyCmd()):P++:UWA.Array.detect(C,function(e,t){return e==c})?(S.push(c),y=!0):e._isPathValid(u)?(c==l?w=N:u==l&&-1==w&&(w=N),D.addChild(new b({label:c,comboBoxSemantics:"subsection"})),N++,C.push(c),0):(x.push(c),y=!0)});let t={title:"",subtitle:"",msg:""};if(0==C.length)t.title=i.error.emptyDefinedPath.title,t.subtitle=i.error.emptyDefinedPath.subtitle,t.msg=null,y=!0;else if(P>0)t.title=i.error.title,t.subtitle=null,t.msg=i.error.emptyobject,y=!0;else if(S.length>0){let e=i.replace(i.error.identifierUnicity.title,{namesList:S});t.title=e,t.subtitle=i.error.identifierUnicity.subtitle,t.msg=null}else if(x.length>0){let e=i.replace(i.error.pathInvalid.title,{namesList:x});t.title=e,t.subtitle=i.error.pathInvalid.subtitle,t.msg=null}else{var A=1;if(-1!==w&&(A=w),a){var U=new b({label:i.option_path.added_path,comboBoxSemantics:"section"});E.addRoot(U),this._isPathValid(l)&&(U.addChild(new b({label:l,comboBoxSemantics:"subsection"})),A=E.getAllDescendants().length-1)}var V=new UWA.Element("div",{class:"ev5-path-container"}).inject(n);if(E.expandAll(),e.elements.combobox=new _({elementsTree:E,selectedIndex:A}),V.appendChild(e.elements.combobox.getContent()),e.elements.useDLNames=!0,e.elements.combobox.addEventListener("change",function(){e.elements.launchbutton.disabled=!1}),a){var W=new UWA.Element("div",{class:"expander-container"}),I=new h({placeholder:i.option_path.option_text,value:o.defaultLocation}).inject(W),O=!this._isPathValid(o.defaultLocation),L=new m({domId:"ev5-add-button",label:i.option_path.button_add,emphasize:"primary",touchMode:!0,disabled:O,allowUnsafeHTMLLabel:!1}).inject(W);I.addEventListener("uncommittedChange",function(){e._isPathValid(I.getContent().getChildren()[0].value)?L.disabled=!1:L.disabled=!0});var M=new v({orientation:"horizontal",height:"22px",body:W,allowUnsafeHTMLHeader:!1}).inject(V);L.addEventListener("buttonclick",function(){E.getRoots()[1].getAllDescendants().map(e=>e.getLabel()).includes(I.value)||(E.getRoots()[1].addChild(new b({label:I.value,comboBoxSemantics:"subsection"})),E.expandAll(),e.elements.combobox.selectedIndex=e.elements.combobox.elementsTree.getAllDescendants().length-1,M.getContent().collapse)})}}y&&(e._displayNotification("error",t.title,t.subtitle,t.msg),e.controller._destroyCmd())}var F=!0;return localStorage.getItem("ExportV5copy")&&(F="false"!=localStorage.getItem("ExportV5copy")),e.elements.toggleCopy=new p({label:i.option_conflict.option_copy,checkFlag:F,allowUnsafeHTMLLabel:!1}),n.appendChild(e.elements.toggleCopy.getContent()),this.myLoader=new f({text:i.loading,showButtonFlag:!1,height:"20px",fadeDuration:100}).inject(t),this.myLoader.on(),t},_getSelectedPath:function(){if(1==this.elements.useDLNames){var e,t=this.elements.combobox.value;return this._isPathValid(t)&&(e=t),o.paths.forEach(function(i){i.name==t&&(e=i.path)}),e=e.trim()}return t=(t=this.elements.lineEditor.value).trim()},_displayNotification:function(e,t,i,o){window.notifs=S,x.setNotificationManager(window.notifs);var n={level:e,title:t,sticky:!1};void 0===i&&null===i||(n.subtitle=i),null===o&&void 0===o||(n.message=o),window.notifs.addNotif(n)},_buildFooter:function(){var e=this,t=UWA.createElement("div",{class:"footerModal"}),o=!e._isSelectionValid();e.elements.launchbutton=new m({label:i.buttonExport,emphasize:"primary",touchMode:!0,disabled:o,allowUnsafeHTMLLabel:!1}),e.elements.launchbutton.addEventListener("buttonclick",function(){e._LaunchExport()}),t.appendChild(e.elements.launchbutton.getContent());var n=new m({label:i.buttonCancel,emphasize:"secondary",touchMode:!0,allowUnsafeHTMLLabel:!1});return n.addEventListener("click",function(){e.controller._destroyCmd()}),n.inject(t),t},_LaunchExport:function(){this._isSelectionValid()?(document.getElementById("ev5customizeview_body").style.display="none",this.model.updatePath(this._getSelectedPath()),this.model.updateCopyOption(this.elements.toggleCopy.checkFlag),localStorage.setItem("ExportV5copy",this.elements.toggleCopy.checkFlag),this.elements.launchbutton.disabled=!0,0==this.elements.useDLNames?localStorage.setItem("ExportV5path",this.model.path):localStorage.setItem("ExportV5path",this.elements.combobox.value),this.controller._sendExportRequest()):this._displayNotification("warning",i.warning.title_path,null,i.warning.empty_path)},destroy:function(){this.elements.floatingpanel.destroy()}})}),define("DS/ENOExportV5WebCommands/commands/ExportV5BECmd",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/Utilities/UUID","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","DS/ENOExportV5WebCommands/utils/ExportV5connexionMngtUtil","i18n!DS/ENOExportV5WebCommands/assets/nls/ExportV5Cmd"],function(e,t,i,o,n,r,s){"use strict";var a=["physicalid","ds6w:label","ds6w:type","ds6w:cadMaster","ds6w:xcadFileName"],l=["physicalid"],d=["Workspace","Workspace Vault"];return e.extend({execute:function(){var e=this,o=t.get(),n=o.getSelectedNodes();1!=n.length||0!=Object.entries(n[0].options.grid).length?n.some(e=>d.includes(e.options.grid.type))?e._displayNotification("warning",s.warning.title,null,s["ExportV5.Msg.InvalidInput"]):new Promise(function(t,i){var o={data:{ids:n.map(e=>e.getID())},timeout:6e5,webService:{url:"/resources/ENOWebExchangesWSAPI/webExchanges_services/validate?tenant="+r.getPlatformId(),verb:"POST"},callback:{onComplete:function(o){var n=UWA.is(o,"string")?JSON.parse(o):o;if(n&&0!==Object.keys(n).length)if("success"===n.status)t();else{let t=n.msg;e._displayNotification("warning",s.warning.title,null,s[t])}else e._displayNotification("error",s.error.fetchFailed.title,s.error.fetchFailed.subtitle),i(s.error.fetchFailed)},onFailure:function(t){e._displayNotification("error",s[t.msg].title,s[t.msg].Subtitle),i(t.message)},onTimeout:function(){e._displayNotification("error",s.error.title,s.replace(s.error.timeout,{seconds:6e5})),i(s.replace(s.error.timeout,{seconds:6e5}))}}};r.SendServerRequest(o)}).then(function(){require(["DS/ENOExportV5WebCommands/commands/ExportV5GenericCmd"],t=>{var n=function(e){for(var t={requests:[]},o={},n=0;n<e.length;n++){var r=e[n],s=r.getOccurencePath();o[d=r.getRoot().getID()]||(o[d]=[]),o[d].push(s)}for(var d in o){var c={};c.rootId=d,c.selection=o[d];var u={union:{expand:[{root_path_physicalid:c.selection,no_type_filter_rel:["XCADBaseDependency"],"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"'}]}};u.select_bo=a,u.select_rel=l,u.label="ExpandForWebExchangesBE_"+i.v4(),c.msgExpand=u,t.requests.push(c)}return t}(o.getSelectedNodes());new t({command_id:e.options.ID,render_div:".FolderEditor_global_container",data:{requests:n.requests}})})},function(e){console.log(e)}):e._displayNotification("error",s.error.title,null,s.error.noSelection)},_displayNotification:function(e,t,i,r){window.notifs=n,o.setNotificationManager(window.notifs);var s={level:e,title:t,sticky:!1};void 0!==i&&(s.subtitle=i),null!==r&&(s.message=r),window.notifs.addNotif(s)}})}),define("DS/ENOExportV5WebCommands/commands/ExportV5GenericCmd",["UWA/Controls/Abstract","UWA/Promise","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","DS/i3DXCompassServices/i3DXCompassPubSub","i18n!DS/ENOExportV5WebCommands/assets/nls/ExportV5Cmd","DS/ENOExportV5WebCommands/utils/ExportV5connexionMngtUtil","DS/Utilities/UUID"],function(e,t,i,o,n,r,s,a){"use strict";var l={url:"/resources/ENOWebExchangesWSAPI/webExchanges_services/getExportOpenMessage",verb:"POST"};var d,c;return e.extend({init:function(e){this._parent(e),UWA.is(e.data)&&UWA.is(e.data.requests)&&0!=e.data.requests.length?(this.requestsMessage=e.data.requests,UWA.is(e.render_div)||(this.render_div=e.render_div),this._expandAll(),this._buildModel(),this.view=this._createView()):(this._displayNotification("error",r.error.title,r.error.noSelection),this.destroy())},_buildModel:function(){this.model={path:"",bCopy:!0,updatePath:function(e){this.path=e},updateCopyOption:function(e){this.bCopy=e}}},_createView:function(){var e=this;null!=e.options.disable_cmd&&e.options.disable_cmd(),require(["DS/ENOExportV5WebCommands/views/_EV5CustomizeView"],function(t){var i=new t({_command_id:e.options.ID,render_div:e.options.render_div,model:e.model,controller:e});e._view=i})},_displayNotification:function(e,t,n,r){window.notifs=o,i.setNotificationManager(window.notifs);var s={level:e,title:t,message:n,sticky:!1};void 0!==r&&(s.subtitle=r),window.notifs.addNotif(s)},_expandAll:function(){var e=this;d=!1,c="",new t(function(t,i){a.v4();var o={data:{requests:e.requestsMessage},timeout:6e5,webService:{url:l.url,verb:l.verb},callback:{onComplete:function(i){var o=UWA.is(i,"string")?JSON.parse(i):i;null!=o.status&&"failure"===o.status?(c=r.error.genericError,null!=o.msg&&null!=r[o.msg]?(c=r[o.msg],e._displayNotification("warning",r.error.expand_failed.title,r[o.msg],r.error.expand_failed.subtitle)):e._displayNotification("error",r.error.expand_failed.title,r.error.genericError,r.error.expand_failed.subtitle),e._destroyCmd()):o.results&&0!==o.results.length?(e.message_batch=o,e._view._expandCompleted(),d=!0,t()):(e._displayNotification("error",r.error.fetchFailed.title,null,r.error.fetchFailed.subtitle),e._destroyCmd())},onFailure:function(t){var i;if(t.message&&t.message.indexOf("Error:")&&t.message.indexOf("ResponseCode")){var o=t.message.substring(t.message.indexOf("ResponseCode")).split('"')[1];i="500"==o?r.error.expandIssue:"400"==o?r.error.code400:"401"==o?r.error.code401:r.error.genericError}e._displayNotification("error",r.error.expand_failed.title,i,r.error.expand_failed.subtitle),c=t.message,e._destroyCmd()},onTimeout:function(){e._displayNotification("error",r.error.title,r.replace(r.error.timeout,{seconds:6e5})),c=r.replace(r.error.timeout,{seconds:6e5}),e._destroyCmd()}}};s.SendServerRequest(o)})},_sendExportRequest:function(){var e=this;if(d){var t={path:e.model.path,copy_if_conflict:e.model.bCopy,data:e.message_batch},i={widgetId:e._command_id,appId:"ENOEXV5_AP",fileName:"-file",fileContent:JSON.stringify(t)};n.subscribe("launchAppCallback",function(t){t&&t.widgetId===e._command_id&&("COMPLETE"===t.response?e._displayNotification("success",r.success.title,r.success.message):e._displayNotification("error",r.errorType.title,r.errorType.message,r.errorType.subtitle),n.unsubscribe("launchAppCallback"),e._destroyCmd())}),n.publish("launchApp",i)}else e._displayNotification("error",r.error,r.error.launchApp+c),e._destroyCmd()},_destroyCmd:function(){null!=this.options.enable_cmd&&this.options.enable_cmd(),UWA.is(this._view)&&this._view.destroy(),this.destroy()}})});