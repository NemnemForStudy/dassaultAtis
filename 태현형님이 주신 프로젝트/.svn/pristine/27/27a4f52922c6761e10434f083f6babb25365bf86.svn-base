define("DS/DMUSlideEdition/DMUEditAssociatedFormatCmd",["DS/ApplicationFrame/Command","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUSlidesController"],function(e,t,i,n){"use strict";return e.extend({init:function(e){e.mode="exclusive",this._parent(e);var r=this;this.beginExecute=function(){var e=t.get();if(1===e.length){var a=e[0].pathElement.getLastElement(!0);if(a&&a.getDMUType&&"DMUSlide"===a.getDMUType()){var o=i.getReviewContext({viewer:r.getFrameWindow().getViewer()});if(o){var l=o.getDMUObjectFromPathElement(e[0].pathElement);if(l&&l.getPointedFormats&&l.getPointedFormats().length){var d=l.getPointedFormats()[0],s=!o.getUIManager().getFormatEditionModeFlag();o.getUIManager().setFormatEditionModeFlag(s);var g=n.giveDMUSlidesController({context:r.getFrameWindow()});g&&g.setActiveSlide(d,{duration:0});var c=i.giveEventsController({viewer:r.getFrameWindow().getViewer()});c&&c.fireEvent(s?"onFormatsEditionModeStarted":"onFormatsEditionModeEnded")}}}}r.end()}}})}),define("DS/DMUSlideEdition/DMUSlideEdition",[],function(){}),define("DS/DMUSlideEdition/DMUCreateSlideCmd",["require","exports","DS/ApplicationFrame/Command","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUBaseUIControllers/DMUSceneDisplayController","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUIServices/DMUSlidePreferences","UWA/Utils","DS/DMUPlaySlide/DMUFormat","DS/DMUPlaySlide/DMUSlide","DS/DMUBaseExperience/DMUModelServices","i18n!DS/DMUSlideEdition/assets/nls/DMUSlideEdition"],function(e,t,i,n,r,a,o,l,d,s,g,c,u,m,D){"use strict";return class extends i{constructor(e){super(e,"exclusive");let t=this;r.setAuthoringFeatureTypes("Slide"),this.beginExecute=async function(){var e,i;let p=r.getReviewContext({viewer:t.getFrameWindow().getViewer()}),f=r.giveEventsController({viewer:t.getFrameWindow().getViewer()}),M=null!==(i=null===(e=s.getSlidePreferences({context:t.getFrameWindow()}))||void 0===e?void 0:e.slideNameFromfeature)&&void 0!==i&&i,U=p.getValidation();if(U||p){let e=U?U.getCurrentMarkup():null;for(;e&&"Markup"!==e.getValType();)e=e.getParentRepRef().getParent();e&&e.getValType&&"Markup"===e.getValType()&&(e=e.getRepRef());let i=e?e.getMarkupContent():p.getCurrentSessionMarkup(),s=[];if(i){U&&U.setCurrentMarkup(e);let v,S=r.getContextViewer({viewer:t.getFrameWindow().getViewer()}),h=o.giveDMUSceneDisplayController({context:S}),E=i.isVisible()?null:h.getDisplayedAndHiddenOccurrences(),C=p.getTransientReviewBag().getDMUObjects(),w=p.getTransientReviewBag().getAttribute("oLinksManager");if(C.length){let e;f&&f.fireEvent("onBeginDMUObjectDuplication");for(let t=0;t<C.length;t++){if(-1!==C[t].getType().indexOf("Compare")&&w){let e=[],n=[],r=[],a=C[t].getAttribute("oSelections");if("DMUCompare2D"===C[t].getType()&&(r=C[t].getAttribute("oSheetIDs")),r&&2===r.length&&(r[0].id&&n.push({id:r[0].id}),r[1].id&&n.push({id:r[1].id}),2===n.length&&C[t].setAttribute("oSheetIDs",n)),2===a.length&&a[0].id&&a[1].id){let n=w.getChildWithID(a[0].id),r=null;n.path?r=w.getOccurrenceIdPath(n.path):n.identifier&&(r=[n.identifier]);let o=i.getOccurence({idPath:r},!0);o&&o.id&&e.push({id:o.id}),n=w.getChildWithID(a[1].id),r=null,n.path?r=w.getOccurrenceIdPath(n.path):n.identifier&&(r=[n.identifier]),(o=i.getOccurence({idPath:r},!0))&&o.id&&e.push({id:o.id}),2===e.length&&C[t].setAttribute("oSelections",e),h&&(C[t].setAttribute("fBalance",h.getCurrentCompareBalance()),C[t].setAttribute("bLocalAxis",h.getCurrentLocalAxisValue()))}}e=await m.getObjectDefinition(C[t]),s.push(e)}}let F,b=p.getUIManager().getFormatEditionModeFlag(),x=[{name:"sID",value:i.computeNewID()},{name:"sUuid",value:g.getUUID()}];if(b)(v=new c(t.getFrameWindow().getViewer(),i)).setAttributes(x);else{v=new u(t.getFrameWindow().getViewer(),i);let e=i.getCurrentSlide();e&&e instanceof u&&e.getAttribute("sPointedFormats")&&x.push({name:"sPointedFormats",value:e.getAttribute("sPointedFormats")}),p.getValidation()&&(x=x.concat([{name:"sOwner",value:d.getUserLogin()},{name:"fCreationDate",value:Date.now()}])),v.setAttributes(x)}if(v.updateEnvironmentOverload({target:p.getEnvironment(),state:p.getEnvironment().getEnvironmentInfo()}),b&&v instanceof c){let e;if(i.getCurrentSlide()){let t=i.getFormats();for(F=0;F<t.length;F++)if(t[F]===i.getCurrentSlide()&&F!==t.length-1){e=F+1;break}}i.addFormat(v,e),v.setReadOnly(!1),window.require(["DS/DMUBaseExperience/EXPUtils"],function(e){e._sendUsageProbe("command","CreateFormat")})}else if(v instanceof u){let e;if(i.getCurrentSlide()){let t=i.getSlides();for(F=0;F<t.length;F++)if(t[F]===i.getCurrentSlide()&&F!==t.length-1){e=F+1;break}}i.addSlide(v,e),window.require(["DS/DMUBaseExperience/EXPUtils"],function(e){e._sendUsageProbe("command","CreateSlide")})}if(s.length){let e=a.getManager({name:"DMUUserExperienceManager",context:t.getFrameWindow()});await e.duplicateDMUElements({elementDefinitions:s,parent:v,cb:function({duplicatedElements:e}){if(e&&e.length)for(F=0;F<e.length;F++)e[F].setAttributes([{name:"sID",value:i.computeNewID()},{name:"sUuid",value:g.getUUID()}])}})}if(E&&h){let e,t,i=[],n=function(t,n){(e=p.getCurrentSessionMarkup().getOrCreateOccurrenceOverloader(t,!0))&&(i.push({target:e,state:{bVisible:n}}),v.addObjectOverload({target:e,state:{bVisible:n}}))};E.hidden&&(E.hidden.paths.forEach(function(e){n({pathElement:e},!1)}),E.hidden.idPaths.forEach(function(e){(t=e.slice())[0]===S.getController().getRootBagId()&&t.splice(0,1),n({idPath:t},!1)})),E.shown&&(E.shown.paths.forEach(function(e){n({pathElement:e},!0)}),E.shown.idPaths.forEach(function(e){(t=e.slice())[0]===S.getController().getRootBagId()&&t.splice(0,1),n({idPath:t},!0)})),i.length&&v.fireEvent("onDMUOverloadPropertiesChanged",{overloads:i})}let O=l.giveDMUApplicativeContextManager({context:S}),A=null;if(!b&&O){let e,t,i=O?O.getApplicativeControllers():[],n=[];for(let r=0;r<i.length;r++){t=i[r].getApplicativeContainerID();let a=O.getVerifiedApplicativeContainerState(t);if(a){if(e=null,(e=i[r].getCurrentAppContainerStateTitle())&&(A?A+=" - ":A="",A+=e),M&&i[r]&&i[r].getFeatureInformation){let e=i[r].getFeatureInformation();e&&e.name&&n.push(e.name)}v.setSlideApplicativeContext(t,a)}}1===n.length&&n[0]&&(A=n[0])}f&&C.length&&(p.getTransientReviewBag().removeDMUObjects(),f.fireEvent("onDMUObjectDuplicated")),i.setVisibleFlag(!0),M||(A=null),v.setAttribute("sName",i.computeNewName({object:v,prefix:b?D.normalFormatTitle:A||D.normalSlideTitle,noSuffixIfPossible:null!==A,separator:null!==A?"parenthesis":null})),v.fireEvent("onDMUObjectInitialized",{dmuObject:v,dmuCont:i,mkpRepRef:e});let P=n.giveDMUSlidesController({context:t.getFrameWindow()});P&&P.setActiveSlide(v,{duration:0})}}t.end()}}}}),define("DS/DMUSlideEdition/DMUGenerateFormatCmd",["DS/ApplicationFrame/Command","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUControls/DMUPasteWithOptionsPanel","DS/DMUBaseUIControllers/DMUSlidesController","i18n!DS/DMUSlideEdition/assets/nls/DMUSlideEdition"],function(e,t,i,n,r,a,o){"use strict";return e.extend({init:function(e){e.mode="exclusive",this._parent(e);var l,d=this;function s(e,i){l&&l.destroy(),l=new t({body:d.getFrameWindow().getUIFrame(),type:e,message:i})}this.beginExecute=function(){var e=!1,t=i.getReviewContext({viewer:d.getFrameWindow().getViewer()});if(t){var l=t.getCurrentSessionMarkup();if(l){var g=n.getManager({name:"DMUUserExperienceManager",context:d.getFrameWindow()});if(g){var c=g.getCCPTarget();if(c&&c.getType&&"DMUSlide"===c.getType()){c.fireEvent("onBeginDMUObjectDuplication");new r({frmWindow:d.getFrameWindow(),panelTitle:o.generateFormatTitle,prefs:{displayAssociateFormatToSlidePref:!0,applyButtonNls:o.generateAndEditLabel},cb:function(e,n){if(g){let r,u=t.getValidation();if(u){for(r=u.getCurrentMarkup();r&&"Markup"!==r.getAttribute("sValType");)r=r.getParentRepRef().getParent();r&&"Markup"===r.getAttribute("sValType")&&(r=r.getRepRef()),r&&(l=r.getMarkupContent())}g.duplicateDMUElements({elements:[c],parent:l,newType:"Format",markupRepRef:r,duplicationOptions:e,cb:function(r){if(r.duplicatedElements&&1===r.duplicatedElements.length)if(e.associateFormat){c.setAttribute("sPointedFormats",[r.duplicatedElements[0].getAttribute("sID")]);for(var l,g,u=Object.keys(e),m=0;m<u.length;m++)if("formatting"===u[m]&&e[u[m]]){for(g=(l=c.getDMUObjects("DMUSection")).length-1;g>=0;g--)c.removeDMUObject(l[g]);for(g=(l=c.getObjectOverloads()).length-1;g>=0;g--)c.removeObjectOverload(l[g])}else if("markers3D"===u[m]&&e[u[m]])for(g=(l=c.getDMUObjects()).length-1;g>=0;g--)-1===l[g].getType().indexOf("DMUMarker3D")&&-1===l[g].getType().indexOf("Measure")||c.removeDMUObject(l[g]);else if("markers2D"===u[m]&&e[u[m]])for(g=(l=c.getDMUObjects()).length-1;g>=0;g--)-1!==l[g].getType().indexOf("DMUMarker2D")&&c.removeDMUObject(l[g])}else r.duplicatedElements.forEach(function(e){e.refreshNode()});if(c.refreshNode(),d.getFrameWindow().getViewer().render(),c.fireEvent("onDMUObjectDuplicated"),r.duplicatedElements&&1===r.duplicatedElements.length&&n){var D=!t.getUIManager().getFormatEditionModeFlag();t.getUIManager().setFormatEditionModeFlag(D);var p=a.giveDMUSlidesController({context:d.getFrameWindow()});p&&p.setActiveSlide(r.duplicatedElements[0],{duration:0});var f=i.giveEventsController({viewer:d.getFrameWindow().getViewer()});f&&f.fireEvent(D?"onFormatsEditionModeStarted":"onFormatsEditionModeEnded")}else c.fireEvent("onSlidePreviewRefreshRequired",{dmuObject:c}),s(r.duplicatedElements&&r.duplicatedElements.length?"info":"error",r.duplicatedElements&&r.duplicatedElements.length?o.formatGenerated:o.formatGenerationError)}})}}})}else e=!0}else e=!0}else e=!0}else e=!0;e&&s("error",o.formatGenerationError),d.end()}}})});