define("DS/RenderEngineUtils/StateSortingCacheItem",["DS/Mesh/ThreeJS_Base"],function(e){"use strict";var i=function({dlIndex:e,resetFrameIndex:i,material:t,object:r,geometry:a,dg:s,dgInterval:n,renderMode:o,renderVolumesOnly:l,renderLineMode:d,geomDisposeFunc:p,materialToUse:y,matApp:c,gasMaterial:u,cpInfos:h=null}){this._args={material:t,object:r,geometry:a,dg:s,dgInterval:n,renderMode:o,renderVolumesOnly:l,geomDisposeFunc:p,materialToUse:y,matApp:c,gasMaterial:u,cpInfos:h},this.dlIndex=e,this.resetFrameIndex=i,this.renderLineMode=d};return i.prototype.addDrawable=function(e,i,t){var r=e[this.dlIndex],a={qaAutomationMode:i,oitActive:t};Object.assign(a,this._args),r.addDrawable(a)},i}),define("DS/RenderEngineUtils/InheritanceSolver",["DS/Mesh/ThreeJS_Base"],function(e){"use strict";function i(i){return!(!i||!(i instanceof e.MeshBasicMaterial||i instanceof e.MeshPhongMaterial||i instanceof e.MeshLambertMaterial||i instanceof e.PhysicalMaterial)||i.map)}const t=e._VisuFilterType;let r=null,a=0,s=0,n=0,o=0,l=null,d=null,p=null;function y(e,i){if(!e||!i)return null;let t=e;return i.glType!=n&&i.glType!=o||!e.line||(t=e.line),i.glType==s&&e.point&&(t=e.point),t._deferredMaterialsInit||t.updateDeferredMaterials(),t}function c(e){if("true"===localStorage.getItem("forceCPUOutlines"))return e.isOrtho;return e._viewpoint&&e._viewpoint._2DMode&&e.isOrtho}function u(e,i,t){return e._viewpoint&&e._viewpoint.isNative2D()&&e._viewpoint._depthMode?t?t._priority-4+i._depthPriority:i._depthPriority:-1}let h=null;return class{constructor(e){this.renderer=e,this.gl=null,this.reset(),this._objectsWithOutlines=null,this.camera=null}_useCPUOutlines(e){return c(e)}_getMaterialMode(e){return this.renderer.getMaterialMode(this.object,e,this.zOnlyPass)}enableOutlineHanding(i,t){if(!this.camera)throw"Globals are not set, camera not found";if(this.outlineStruct=null,i){const i=this.camera;this.outlineStruct=t;let r=null;c(i)&&(r=new e.Vector4(0,0,1,0).applyMatrix4(i.matrixWorld)),t.outlinesCameraDirection=r;const a=this._objectsWithOutlines&&this._objectsWithOutlines.cameraDir,s=!!r!=!!a||r&&!r.equals(a);this._objectsWithOutlines&&s&&(this._objectsWithOutlines.cameraDir=r,this._objectsWithOutlines.objects.forEach(e=>e._flagAsGSSOInvalidated()),this._objectsWithOutlines.objects.clear())}}setContext(i,t,r){this.gl=i,a=e.GeomTypeEnum.FACE,s=i.POINTS,n=i.LINES,o=i.LINE_STRIP,l=t,d=r,p||(p=new e.MeshBasicMaterial)}setFrameContext(i,t,r,a,s,n,o){this.getDLFromObject=i,this.onGeometryDisposeDS=t,this.camera=r,this.defaultAppearanceType=a,this.QAAutomationMode=a===e.DefaultAppearanceMode.__QA_AUTOMATION__,this.stateSortingResultID=s,this.zOnlyPass=n,this.pickingPass=o}reset(){this.getDLFromObject=null,this.onGeometryDisposeDS=null,this.QAAutomationMode=!1,this.defaultAppearanceType=-1,this.stateSortingResultID=-1,this.outlineStruct=null,this.object=null,this.cappingMaterial=null,this.zOnlyPass=!1,this.pickingPass=!1}_registerObjectWithOutlines(){this._objectsWithOutlines||(this._objectsWithOutlines={cameraDir:this.outlineStruct.outlinesCameraDirection,objects:new Set}),this._objectsWithOutlines.objects.add(this.object)}_handleOutlines(i){if(!this.outlineStruct)return;const t=this.object,r=this.renderer,a=this.outlineStruct,s=(this.getDLFromObject,this.onGeometryDisposeDS);if(t.fromLoadedModel&&i&&i.getMask()&e.OutlineMask)if(t.geometry&&t.geometry.length&&t.geometry[0]&&t.geometry[0].vertexIndexArray){let n=null;const o=a.outlinesCameraDirection;o&&((n=o.clone()).applyMatrix4((new e.Matrix4).getInverse(t.matrixWorld)),n=new e.Vector3(n.x,n.y,n.z).normalize());let{outlineBG:d,created:p,invalidateGSSO:y}=l.prepareOutlines({object:t,width:i._outlineWidth,viewDirection:n,_sortCount:a.sortCount,_gl:this.gl,visibleSpace:r.visibleSpace,showHiddenOutlines:1===i._hiddenEdges});d.length>0&&(this._registerObjectWithOutlines(),y&&a.objectWithTransientGSSO.add(t),p&&(a.outlinesCreated=!0));for(let e=0;e<d.length;e++){const t=d[e];p&&t.addEventListener("dispose",s);const r=t.drawingGroups[0];this._addDGToDL({geometry:t,dg:r,dgInterval:r,material:r.material,originalMaterial:r.material,renderMode:i})}}else r._NoMeshInRamWarningCount<10&&(console.warn("OutlineBuilding unavailable, make sure noMeshInRAM is inactive"),r._NoMeshInRamWarningCount++)}_handleSectionLines(i){let t=null;if(i&&i._maskWithDefault&e.SectionLineMask){const e=this.object,r=this.renderer,a=(this.getDLFromObject,this.onGeometryDisposeDS);if(e.geometry&&e.geometry.length&&e.geometry[0]&&e.geometry[0].vertexIndexArray){let s=e.sectionLinesBuilder&&e.sectionLinesBuilder.sectionLineGeometry;const n=e.occurrenceRenderingOverride&&e.occurrenceRenderingOverride.sectionLinesProperties,o=n?n.color:null,l=n?n.width:1,p=e.occurrenceRenderingOverride&&e.occurrenceRenderingOverride.clipPlanes;let y=null;e.occurrenceRenderingOverride&&e.occurrenceRenderingOverride.clippingContext&&(y=e.occurrenceRenderingOverride.clippingContext._getSectionLinesArray());const c=s&&e.layer&&!e.layer.upToDate,u=!c&&e.sectionLinesBuilder&&e.sectionLinesBuilder.update({width:l,color:o,clipPlanes:p,sectionLines:y});if(!c&&u||(e.sectionLinesBuilder&&e.sectionLinesBuilder.dispose(),e.sectionLinesBuilder=null,s=null,e.layer&&(e.layer.upToDate=!0)),!s&&!e.sectionLinesBuilder){const i=new d({renderable:e,renderer:r,lineWidth:l,color:o,clipPlanes:p,sectionLines:y});i.computeSectionLineGeometry(),(s=i.sectionLineGeometry)&&s.addEventListener("dispose",a),e.sectionLinesBuilder=i}if(s){const e=s.drawingGroups[0];null===o&&(t=e.material),this._addDGToDL({geometry:s,dg:e,dgInterval:e,material:e.material,originalMaterial:e.material,renderMode:i})}}else r._NoMeshInRamWarningCount<10&&(console.warn("SectionLineBuilding unavailable, make sure noMeshInRAM is inactive"),r._NoMeshInRamWarningCount++)}return t}_handleObjectSectionCapping(e,i,t){const r=this.renderer,s=this.object,n=s.renderPointsOnly;let o=null;if(r.cuttingScene||i){for(let i=0;i<e.length;i++){const s=e[i].drawingGroups;let l=0;for(let e=0;e<s.length;e++){const i=s[e];i._geomType!==a||n||i.count>l&&(o=t&&i.material?i.material:i.gas.isGAS?i.gas.getMaterial(null,4,i.gas,r):i.gas,l=i.count)}}i&&!r.cuttingScene&&o&&o.color&&(s.sectionLinesBuilder.setColor(o.color),o=null)}return o}_getModifiedOriginalMaterial(e,i,t,r,s,n){const o=this.renderer,l=this.object._occurrence;let d=i;!r&&l&&l.__solvedSubstituteMaterials&&l.__solvedSubstituteMaterials.has(i)&&(d=l.__solvedSubstituteMaterials.get(i));let p=s;return t?p=null:d=d.getGeomTypeDeferredMaterial(e._geomType,{boundaryEdge:o.boundaryEdgeMaterialInfo,smoothEdge:n._halfVisibleSmoothEdges>0}),(r&&e._geomType===a||this.QAAutomationMode)&&(d=d.getPredefinedMaterial(o.noiseTexture3D,this.defaultAppearanceType,o._customMaterialModeParams),p=null),d._deferredMaterialsInit||d.updateDeferredMaterials(),[d,p]}_getBackgroundViewModeMaterial(i,t){return this.renderer._backgroundViewMode===e.BackgroundViewMode.GHOST&&i.applyBackgroundViewMode?h||((h=new e.MeshBasicMaterial({force:!0,side:e.Constants.DoubleSide,color:new e.Color(16711680),transparent:!0})).activatePDSFX(),h.setPDSFXOverridableFunctions({},{ProcessFinalColor:"void ProcessFinalColor(inout vec4 color) { color = vec4(1.0, 1.0, 1.0, 0.1); }"}),h):t}_handleOldWorkFlowCommon(e,s,n,o,l,d,c,u){const h=this.object,g=this.renderer;let m=null,f=!1,P=!1,L=y(s.gas,s);if(d&&c)m=y(c,s);else{const e=h.material||p,i=l||!h.fromLoadedModel,t=e.force&&"forceGeomTypeFACE"!==e.force,r=e.force&&"forceGeomTypeFACE"===e.force,n=i&&t;m=y(e,s),n||(l&&s.material&&s.material.updateDeferredMaterials?m=y(s.material,s):(m=L,f=!0),r&&s._geomType===a&&(m=e,f=!1,P=!0))}m=this._getBackgroundViewModeMaterial(h,m),!d&&u&&s._geomType===a&&(m=u);const D=h._getFilter(t.LOOK);if(D){const e=D.material;e&&(P=!0,f=!1,m=y(e,s))}[m,r]=this._getModifiedOriginalMaterial(s,m,P,f,null,e);const _=g.materialToUse;let S=m._deferredMaterials[_];if(S){if(g.cuttingScene&&!i(S)&&(S=y(s.gas,s)||S),d&&g.cuttingScene&&s.glType>=4&&(null!==this.cappingMaterial?S=this.cappingMaterial:this.cappingMaterial=S),m.backMaterial){const i=m.backMaterial._deferredMaterials[_];i&&this._addDGToDL({geometry:o,dg:s,dgInterval:n,material:i,gasMaterial:L,originalMaterial:m,renderMode:e,materialMode:l})}this._addDGToDL({geometry:o,dg:s,dgInterval:n,material:S,gasMaterial:L,originalMaterial:m,renderMode:e,materialMode:l})}}_handleLayerOldWorkflow(e,i,t,r){const a=e.drawableGroup,s=e.drawableInterval,n=e.geometry;this._handleOldWorkFlowCommon(t,a,s,n,r,!0,i,null)}_handleGeometryOldWorkflow(e,i,t,r){const a=this.object,n=this.renderer,o=a.renderPointsOnly,l=a.material||p,d=t||!a.fromLoadedModel,y=l.force&&"forceGeomTypeFACE"!==l.force;let c=null;d&&y||(c=this._handleObjectSectionCapping(e,r,t)),c&&!n.cuttingScene&&("forceGeomTypeFACE"!==l.force||this.QAAutomationMode||(c=l));for(let r=0;r<e.length;r++){const a=e[r],n=a.drawingGroups;for(let e=0;e<n.length;e++){const r=n[e],l=r.glType;o&&l!=s||this._handleOldWorkFlowCommon(i,r,r,a,t,!1,null,c)}}}_handleNewWorkFlowCommon(r,a,s,n,o,l,d,p,c,h){const g=this.object,m=this.renderer,f=a.glType;let P=!1,L=null,D=!1;const _=g.gas;let S=null;if(!(S=_?l.isGAS?l.clone().merge(_):_:l.isGAS?l:null)||!p||d||0!==a.glType&&1!==a.glType||S._type!==e.GASTypeEnum.SKIN||(d=p._getMaterialFromGLType(4,e.GeomTypeEnum.FACE)),!h){const e=g.material;d&&p||!o&&g.fromLoadedModel||!e||!e.force||(d=y(e,a))}if(L=_?_.getMaterial(l,f,a.gas.isGAS?a.gas:null,m,u(this.camera,g,l),d):l.isGAS?l.getMaterial(null,f,a.gas,m,u(this.camera,g,l),d):l,S){if(this.pickingPass&&S._noPick)return;const i=g._getFilter(t.ZMODE)||m._GlobalZModeFilter;i&&(S._type===e.GASTypeEnum.NOZ&&i.enableZ?(S=S.clone())._type=e.GASTypeEnum._SKIN:S._type===e.GASTypeEnum.NOZ||i.enableZ||((S=S.clone())._type=e.GASTypeEnum.NOZ))}L&&!d&&(d=L,P=!0);const M=g._getFilter(t.LOOK);if(M){const e=M.material;e&&(D=!0,P=!1,d=y(e,a))}d=this._getBackgroundViewModeMaterial(g,d),[d,p]=this._getModifiedOriginalMaterial(a,d,D,P,p,r);const E=m.materialToUse;let v=d._deferredMaterials[E];if(v){if(m.cuttingScene&&L&&!i(v)&&(v=L),d.backMaterial){const e=d.backMaterial._deferredMaterials[E];e&&this._addDGToDL({geometry:n,dg:a,dgInterval:s,material:e,originalMaterial:d,renderMode:r,matApp:p,gasMaterial:L,gasStruct:S,materialMode:o})}c&&m.cuttingScene&&f>=4&&(null!==this.cappingMaterial?d=v=this.cappingMaterial:this.cappingMaterial=v),this._addDGToDL({geometry:n,dg:a,dgInterval:s,material:v,originalMaterial:d,renderMode:r,matApp:p,gasMaterial:L,gasStruct:S,materialMode:o})}}_solveIntervalMaterialNewWorkflow(i,t,r){const a=this.object,s=a.matApp;let n=null,o=null;return i.isMatApp&&(o=(n=i.solveInheritance(s,a._occurrence.depth))===s?r:i._getMaterialFromGLType(t.glType,t._geomType)),o||i.isMatApp||(n=r?s:null,(o=r)||(o=i instanceof e.Material?y(i,t):null)),[n,o]}_handleLayerNewWorkflow(e,i,t,r,a){const s=this.object,n=e.drawableGroup,o=n.glType;let l=null,d=null,p=!1;if(a){const e=s.matApp;let t=e&&e._getMaterialFromGLType(o,n._geomType);i?(p=!0,[l,d]=this._solveIntervalMaterialNewWorkflow(i,n,t)):n.material&&([l,d]=this._solveIntervalMaterialNewWorkflow(n.material,n,t)),d||(l=e,d=t)}this._handleNewWorkFlowCommon(r,n,e.drawableInterval,e.geometry,a,t,d,l,!0,p)}_handleGeometryNewWorkflow(e,i,t,r){const n=this.object,o=n.renderPointsOnly,l=function(e){return e&&e.materialMode<2}(n);let d=this._handleObjectSectionCapping(e,r,t);const p=l?t:t||!n.fromLoadedModel;for(let r=0;r<e.length;r++){const l=e[r],y=l.drawingGroups;for(let e=0;e<y.length;e++){const r=y[e],c=r.glType;if(o&&c!=s)continue;let u=null,h=null;if(p){const e=n.matApp;let i=e&&e._getMaterialFromGLType(c,r._geomType);r.material&&([u,h]=this._solveIntervalMaterialNewWorkflow(r.material,r,i)),h||(u=e,h=i),!d||e&&u===e||r._geomType!==a||(h=d)}this._handleNewWorkFlowCommon(i,r,r,l,t,r.gas,h,u,!1,!1)}}}_handleObjectWithLayers(e,i,t){const r=this.object,a=r.layer,n=this.renderer,o=r.renderPointsOnly,l=a.layers.length;this.cappingMaterial=null;for(let d=0;d<l;d++){const l=a.layers[d];let p=l.drawableInterval.getMaterial();if(l.drawableInterval.skip(r,n.visibleSpace))continue;const y=l.drawableGroup,c=y.glType;if(!o||c==s)if(e||p&&p.isMatApp){p||(p=y.material);let e=l.drawableInterval.gas;e||(e=y.gas),this._handleLayerNewWorkflow(l,p,e,i,t)}else this._handleLayerOldWorkflow(l,p,i,t)}}_handleObject(e,i,t,r){let a=this.object.geometry;a.length||0===a.length||(a=[a]),e?this._handleGeometryNewWorkflow(a,i,t,r):this._handleGeometryOldWorkflow(a,i,t,r)}_addDGToDL({material:e,originalMaterial:i,dg:t=null,dgInterval:r=null,geometry:a,renderMode:s=null,matApp:n=null,gasMaterial:o=null,gasStruct:l=null,materialMode:d=!1}){this.renderer.addDGToDL({object:this.object,geometry:a||this.object.geometry,dg:t,dgInterval:r,material:e,originalMaterial:i,renderMode:s,matApp:n,gasMaterial:o,gasStruct:l,getDLFromObjectFunc:this.getDLFromObject,geomDisposeFunc:this.onGeometryDisposeDS,camera:this.camera,materialMode:d})}solve(i){this.object=i;const r=this.object._occurrence,a=this.renderer,s=a.materialToUse,n=i.material;let o=null;const l=i.matApp,d=a.newMaterialInheritance||!!function(e){if(!e.geometry.length)return!1;const i=e.geometry[0].drawingGroups;return!(!i||!i.length)&&i[0].gas&&i[0].gas.isGAS}(i)||!!l;var p=i._getFilter(t._MATERIAL_TO_USE);if(p&&p.materialToUse!==s)return;if(r&&r._isFurtiveFiltered())return;if(!d&&n&&(n._deferredMaterialsInit||n.updateDeferredMaterials(),n.line&&!n.line._deferredMaterialsInit&&n.line.updateDeferredMaterials(),n.point&&!n.point._deferredMaterialsInit&&n.point.updateDeferredMaterials(),o=n._deferredMaterials[s]),void 0===o&&(o=n),null===i._gsso_cache&&(i._gsso_cache={}),i._gsso_cache[this.stateSortingResultID]||(i._gsso_cache[this.stateSortingResultID]=[]),i._updateBackgroundViewMode(this.renderer._invertBackgroundNodes),a._backgroundViewMode===e.BackgroundViewMode.NO_DISPLAY&&i.applyBackgroundViewMode)return;if(a._planeViewMode&&a._planeViewMode.mode!==e.PlaneViewMode.NORMAL&&(i._updatePlaneViewMode(a._planeViewMode.plane),i._applyPlaneViewMode)){const i=a._planeViewMode.mode;if(i===e.PlaneViewMode.NO_DISPLAY)return;if(this.pickingPass&&i===e.PlaneViewMode.LOWLIGHT_NO_PICK)return}this.getDLFromObject,this.onGeometryDisposeDS,this.camera;const y=a.getRenderMode(i);if(i.renderLineMode=y.getMasks()[1],2===i.geometry._type||i.geometry.length>=0){const e=i.layer,t=this._getMaterialMode(y);this._handleOutlines(y);const r=this._handleSectionLines(y);e?this._handleObjectWithLayers(d,y,t):this._handleObject(d,y,t,r)}else d&&n?(n._deferredMaterialsInit||n.updateDeferredMaterials(),n.backMaterial&&this._addDGToDL({material:n.backMaterial._deferredMaterials[s],originalMaterial:n}),this._addDGToDL({material:n._deferredMaterials[s],originalMaterial:n})):(o.backMaterial&&this._addDGToDL({material:o.backMaterial._deferredMaterials[s],originalMaterial:n}),this._addDGToDL({material:o,originalMaterial:n}))}}}),define("DS/RenderEngineUtils/DisplayRangeList",["DS/Mesh/ThreeJS_Base","DS/Visualization/FixedSizeArrayPool"],function(e,i){"use strict";var t=null,r=null;const a=e._VisuFilterType;var s=function(e,i,t,r,a,s){const n=i.geometry.indexBufferGPU;e.drawElements(e.LINE_STRIP,t,n.glFormat,i.start*n.bytesPerIndex)},n=function(e,i,t,r,a,s){e.drawArrays(i.dg.glType,i.geometry.vertexIndexArray[i.start],t)},o=function(e,i,t,r,a,s){e.drawArrays(i.dg.glType,i.start,t)},l=function(e,i,t,r,a,s){const n=i.geometry,o=n.indexBufferGPU;e.drawElements(i.dg.glType,t,o.glFormat,(n.indexOffsetGPU+i.start)*o.bytesPerIndex)},d=function(e,i,t,r,a,s){const n=i.geometry.indexBufferGPU;r._setVertexAttribDivisors(1,a,s),r.drawElementsInstanced(e.LINE_STRIP,t,n.glFormat,i.start*n.bytesPerIndex,i.object.nbInstances),r._setVertexAttribDivisors(0,a,s)},p=function(e,i,t,r,a,s){const n=i.geometry.indexBufferGPU,o=i.dg&&i.dg._instancingInfos?i.dg._instancingInfos.nbInstances:i.object.nbInstances;r._setVertexAttribDivisors(1,a,s),r.drawElementsInstanced(i.dg.glType,t,n.glFormat,i.start*n.bytesPerIndex,o),r._setVertexAttribDivisors(0,a,s)},y=function(e,i,t,r,a,s){if(s.specialMeshIds>=0){const a=i.geometry.indexBufferGPU;var n=i.autoInstancingData.updateData;i.autoInstancingData.updateData=!1,e.bindBuffer(e.ARRAY_BUFFER,i.autoInstancingData.idsBuffer),e.vertexAttribPointer(s.specialMeshIds,2,e.FLOAT,!1,0,0),n&&e.bufferData(e.ARRAY_BUFFER,i.autoInstancingData.idsArray,e.DYNAMIC_DRAW),r.vertexAttribDivisor(s.specialMeshIds,1),s.specialMeshPicking>=0&&(e.bindBuffer(e.ARRAY_BUFFER,i.autoInstancingData.pickingColorBuffer),e.vertexAttribPointer(s.specialMeshPicking,3,e.FLOAT,!1,0,0),n&&e.bufferData(e.ARRAY_BUFFER,i.autoInstancingData.pickingColorArray,e.DYNAMIC_DRAW),r.vertexAttribDivisor(s.specialMeshPicking,1));const o=i.autoInstancingData.lastId+1;r.drawElementsInstanced(i.dg.glType,t,a.glFormat,i.start*a.bytesPerIndex,o),r.vertexAttribDivisor(s.specialMeshIds,0),s.specialMeshPicking>=0&&r.vertexAttribDivisor(s.specialMeshPicking,0)}},c=function(i,a,s,n,o){this.material=i,this.material._displayRangeLists.set(n,this),this.occurrenceRenderingOverride=a,this.materialOverride=null,this.tree=new Map,this.ssrId=s,this.dl=o,null===t&&(t=e.Constants,r=e.MaterialToUse)};return c.prototype.getSortId=function(e,i){return e.isCurvedPipe?i.id:i.vertexBufferGPU?i.vertexBufferGPU.id:-1},c.prototype.insert=function(i,c,u,h,g,m,f,P){var L=this.getSortId(c,u),D=this.tree,_=D.get(L);if(_){var S=!0,M=_.next;if(h.cullingData||1!==h.glType||M.object.id===c.id&&M.geometry===u&&M.dg.glType===h.glType&&M.start+M.count===g&&(M.count+=m,S=!1),S){var E=_.next;_.next=i,i.attachment=_,i.next=E,null!==E&&(E.attachment=i)}}else _={tree:D,sortId:L,next:i},i.attachment=_,D.set(L,_);if(i.attachment){var v=!1,T=h?h.glType:-1;if(h){v=4===T||5===T;var O=c._getFilter(a.POLYGON_OFFSET);O?(i.doRenderLineModePolygonOffset.doIt=!0,i.doRenderLineModePolygonOffset.enable=O.enabled(),i.doRenderLineModePolygonOffset.unit=O.unit,i.doRenderLineModePolygonOffset.factor=O.factor):v&&!this.material.polygonOffset&&(i.doRenderLineModePolygonOffset.doIt=!0,i.doRenderLineModePolygonOffset.enable=0!==c.renderLineMode&&!(this.material.isWideLine||this.material.is2DLine),i.doRenderLineModePolygonOffset.unit=1,i.doRenderLineModePolygonOffset.factor=1);var I=null!==(h._instancingInfos?h._instancingInfos.instanceAttribArrays:c._instancingInfos?c._instancingInfos.instanceAttribArrays:null);c.isCurvedPipe?i.draw=y:this.material.wireframe&&v?i.draw=I?d:s:I?i.draw=p:0===T&&u.vertexPositionArray&&u.vertexPositionArray.nonindexedPoints?i.draw=n:h.nonIndexed?i.draw=o:i.draw=l}var A=P||(h?h.gas:null),b=!(!A||this.material.forceSide)?A:this.material,R=b.side,w=b.forceSide,k=c._getFilter(a._SIDE);k&&(R=k.side,w=!0);var F=R===t.BackSide;return c._isDecal()&&(F=F||f!==r.highlightMaterial&&f!==r.pickingMaterial),i.doSetMaterialFaces.doubleSided=R!==t.BackSide&&R!==t.FrontSide,i.doSetMaterialFaces.forceSide=w,i.doSetMaterialFaces.flipSided=F,(c._occurrence&&c._occurrence.isInNozPass()||this.dl.noz)&&(i._programID|=e.ProgramIDs.NOZ_OBJECT),i.updateLineInfos=this.material.isWideLine||this.material.is2DLine||this.material.isDashedLine&&!this.material.is2DLine||h&&h._updateLineWithShapes,!0}return!1},c.prototype._setRenderingInfos=function(i,t){var r=this.material,a=(i.ssr.overridableMaterial||r.deferrable)&&r.overridable&&this.occurrenceRenderingOverride&&this.occurrenceRenderingOverride.materialOverride?this.occurrenceRenderingOverride.materialOverride:null;return a&&a.internalMaterialOverride&&a.internalMaterialOverride.material===r&&(a=null),this.materialOverride=a,!(r.overridable&&a&&0===a.getOpacity(r.__dimension)||!a&&0===r.getOpacity())||e._isSelectionMaterial(t)},c.prototype.flagObjectsAsGSSOInvalidated=function(){this.tree.forEach(function(e,i){for(var t=e.next;null!==t;t=t.next)t.object._flagAsGSSOInvalidated()})},c.prototype.add=function({object:a,geometry:s,dg:n,dgInterval:o,renderMode:l,renderVolumesOnly:d,materialToUse:p,matApp:y,gasMaterial:c,cpInfos:u=null,qaAutomationMode:h}){var g=!0,m=l?l._maskWithDefault:e.RenderMode.defaultMask,f=p===e.MaterialToUse.pickingMaterial||p===e.MaterialToUse.highlightMaterial;if(f||(m&=~t.SurfacicPointRenderPointMask),n){var P=a&&a.getFilterGeomType(),L=P||n._geomType;if(L||(L=0===n.glType?e.GeomTypeEnum.UNKNOWN_0D:e.GeomTypeEnum.UNKNOWN),g=(L&m)>0,d){var D=c?c.side:n.gas?n.gas.side:-1;0===n.glType||1===n.glType||L&e.RenderMode.pointsMask||L&e.RenderMode.linesMask?g=!1:D===e.DoubleSide&&(g=!1)}if(h){var _=e.__QA_AUTOMATION_MASK__;g&&(g=(L&_)>0),f&&(g=(L&(_|=e.GeomTypeEnum.SMOOTH_EDGE|e.GeomTypeEnum.SHARP_EDGE|e.GeomTypeEnum.BOUNDARY_EDGE))>0)}}if(g){var S=o?o.start:0,M=o?o.count:0;if(a.isCurvedPipe){var E=e.InstancedCurvedPipeManager,v=E._perRenderableData.get(u.dgIndex);if(!v)return;var T=v[u.index],O=this.tree.get(s.id),I=O?O.next:null,A=E._geometryToInstancingGroup.get(s.id);if(!A)return;var b=2,R=p===r.pickingMaterial,w=!1;if(I)if(I.autoInstancingData){if(I.autoInstancingData.lastId+1>=I.autoInstancingData._maxNbInstances){b=2*I.autoInstancingData._maxNbInstances;var k=i.prototype.allocate_autoInstData(b,R,T.bin);I.autoInstancingData.copyDataTo(k),I.releaseAutoInstData(),I.autoInstancingData=k}}else I.autoInstancingData=i.prototype.allocate_autoInstData(b,R,T.bin);else w=!0,(I=i.prototype.allocateInstancedCurvedPipeSection(a,s,n,S,M,b,R,T.bin)).next=null,this.insert(I,a,s,n,S,M,p);var F=null;if(R){var G=a.pickingID>>16&255,B=(a.pickingID>>8&255)/255,x=(255&a.pickingID)/255;G|=128,F=(new e.Color).setRGB(G/255,B,x)}I.autoInstancingData.addInstance(a,T,u,F,A._nbCurvePointsPlus2),a._tokens[this.ssrId]||(a._tokens[this.ssrId]=[]);var N=a._tokens[this.ssrId];w=!0;for(var C=0;C<N.length;C++)if(N[C]===I){w=!1;break}w&&N.push(I)}else{var j=i.prototype.allocate(a,s,n,S,M,y,this.material.useGASColor?c:null);if(j.next=null,this.insert(j,a,s,n,S,M,p,c))a._tokens[this.ssrId]||(a._tokens[this.ssrId]=[]),(N=a._tokens[this.ssrId]).push(j)}}},c.prototype.getFirstDrawable=function(){if(this.tree.values)var e=this.tree.values().next().value;else{e=null;this.tree.forEach(function(i,t){null===e&&(e=i)})}return e?e.next:null},c}),define("DS/RenderEngineUtils/DisplayRangeListBackToFront",["DS/RenderEngineUtils/DisplayRangeList"],function(e){"use strict";var i=function(i,t,r,a,s){e.call(this,i,t,r,a,s)};return(i.prototype=Object.create(e.prototype)).getSortId=function(e,i){return 0},i.prototype.sortDrawablesBackToFront=function(e){var i=e.matrixWorldInverse.elements,t=this.tree.get(0),r=t?t.next:null;if(r)for(var a=null;null!==r;){if(null!==(a=r.object).renderDepth)a.z=a.renderDepth,r.zSortKey=a.z;else{var s=a.worldRadius,n=a.worldCenter,o=i[2]*n.x+i[6]*n.y+i[10]*n.z+i[14];a.z=o+s,r.zSortKey=a.z}for(var l=r.attachment,d=!1;l!==t&&a.z<l.object.z;)l=l.attachment,d=!0;var p=r.next;if(d){var y=r.attachment;y.next=p,p&&(p.attachment=y);var c=l.next;l.next=r,r.next=c,r.attachment=l,c&&(c.attachment=r)}r=p}},i}),define("DS/RenderEngineUtils/DisplayList",["DS/Mesh/ThreeJS_Base","DS/Visualization/WidelinesHelper","DS/RenderEngineUtils/DisplayRangeList","DS/RenderEngineUtils/DisplayRangeListBackToFront"],function(e,i,t,r){"use strict";var a=0,s=0;let n=null;var o=function(i){n=e.displayListPriorityEnum,this.name="",this.string_id=a.toString(),a++,this.active=!0,this.priority=0,this.zSort=e.FrontToBack,this.side=e.DoubleSide,this.clearDepth=!1,this.clearStencil=!1,this.useStencil=!1,this.pickingPriority=!1,this.depthTest=!0,this.depthWrite=!0,this.depthFunc=null,this.polygonOffset=!1,this.polygonOffsetFactor=1,this.polygonOffsetUnits=1,this.canOIT=!1,this.canForceSideOnSolids=!1,this.hasTranspar=!1,this.hasDecal=!1,this.neverSort=!1,this.hasPoliteDepth=!0,this.hasOcclusionDepth=!0,this.noz=!1,this.sortByGLType=!1,this.setValues(i),this._materialList=[],this._displayRangeLists=new Map,this.index=-1,this.ssrId=-1,this.mustZSort=!1,this._sortByProgramNextFrame=!0,this._fatherDL=null},l=function(e,i,t,r,a,s,n,o){this.material=e,this.occurrenceRenderingOverride=i,this.id=t,this.occurrenceRenderingOverrideId=r,this.decalSortID=a,this.glType=s,this.materialToUse=n,this._objectsTransparentOnGPU=o};const d="true"===localStorage.getItem("__WEBVISU_NEW_TRANSPARDL_SORTING__");function p(e){return!(e.vertexLineDistancesArray||e.vertexBufferGPU&&e.vertexBufferGPU.layout.has("lineDistance"))}return o.prototype._getDisplayRangeList=function(e,i,a,s,n,o){var l=!1,d=e+"-"+i.id+o,p=this._displayRangeLists.get(d);if(n&&p){let e=p.occurrenceRenderingOverride;e&&e.getGSSOId(e.isPurePGP())!==s&&(p=null)}if(!p){var y=d.toString()+"_"+this.string_id;p=this.mustZSort?new r(i,a,this.ssr.id,y,this):new t(i,a,this.ssr.id,y,this),this._displayRangeLists.set(d,p),(l=p._setRenderingInfos(this,e))||this._displayRangeLists.delete(d)}return[p,l,d]},o.prototype.addDrawable=function({material:t,object:r,geometry:a,dg:o,dgInterval:y,renderMode:c,renderVolumesOnly:u,geomDisposeFunc:h,materialToUse:g,matApp:m,gasMaterial:f,cpInfos:P=null,qaAutomationMode:L,oitActive:D}){var _="";o&&this.canForceSideOnSolids&&0===g&&t._autoForceSide&&(5===o._dimension||f&&0===f.side)&&(r._forceBackFacesOnSolid=!0);var S=!1,M=null,E=null;r&&r.occurrenceRenderingOverride&&(S=(E=r.occurrenceRenderingOverride).isPurePGP(),_=_+"#"+(M=E.getGSSOId(S)));var v=null;this.hasDecal&&r&&r._isInDecalPass()?(_=b+"!"+r._decalData.stencilID+"?"+r._decalData.key+"."+r._decalData.internalSortKey,m&&(_+="l"+m._layer),v={key:r._decalData.key,internalSortKey:r._decalData.internalSortKey,layer:m?m._layer:0}):d&&this.priority===n.dlTranspar&&r&&!D&&(_=_+"O"+r.id);var T=!1;if(r._vertexColors&&(t.useGASColor||t._isFromGAS)){_=_+"VC"+r._vertexColors;var O=r._vertexColors;T=(O&e.VertexColorType.A)>0||O<=e.VertexColorType.RGBA}this.neverSort&&(_+=s++);var[I,A,b]=this._getDisplayRangeList(g,t,E,M,S,_);if(t.isWideLine||t.is2DLine){if(!u){var R=a.computeWideLine(o,t);if(R){var w=!0;if(a.wideLinesLinker&&(a.wideLinesLinker.linkedGeometry.addEventListener("dispose",h),t.isDashedLine&&(t.isCPUPattern||(a.wideLinesLinker.linkedGeometry.cpuPatternMode||p(a.wideLinesLinker.linkedGeometry))&&(a&&!a.vertexIndexArray?(w=!1,t=t._getBodyEdgeMaterial(),[I,A,b]=this._getDisplayRangeList(g,t,E,M,S,_),I.add({object:r,geometry:a,dg:o,dgInterval:y,renderMode:c,renderVolumesOnly:u,materialToUse:g,matApp:m,gasMaterial:f,cpInfos:P,qaAutomationMode:L})):i._computeWideLineDistances(a.wideLinesLinker.linkedGeometry)))),w){if(y===o)y=R;else{var k=R.getPrimitiveStart(y.primitiveStart),F=R.getPrimitiveStart(y.primitiveStart+y.primitiveCount-1),G=R.getPrimitiveCount(y.primitiveStart+y.primitiveCount-1);k>=0&&F>=0&&(y={start:k,count:F-k+G},R.getPrimitiveStart(0)!==R.start&&(y.start+=R.start))}I.add({object:r,geometry:a.wideLinesLinker.linkedGeometry,dg:R,dgInterval:y,renderMode:c,renderVolumesOnly:u,materialToUse:g,matApp:m,gasMaterial:f,qaAutomationMode:L})}}else t=t._getBodyEdgeMaterial(),[I,A,b]=this._getDisplayRangeList(g,t,E,M,S,_),I.add({object:r,geometry:a,dg:o,dgInterval:y,renderMode:c,renderVolumesOnly:u,materialToUse:g,matApp:m,gasMaterial:f,cpInfos:P,qaAutomationMode:L})}}else t.isDashedLine&&!t.is2DLine&&(t.isCPUPattern||(a.cpuPatternMode||p(a)||a.isAttributeStale("position"))&&(a&&!a.vertexIndexArray?(t=t._getBodyEdgeMaterial(),[I,A,b]=this._getDisplayRangeList(g,t,E,M,S,_)):i._computeLineDistances(a))),I.add({object:r,geometry:a,dg:o,dgInterval:y,renderMode:c,renderVolumesOnly:u,materialToUse:g,matApp:m,gasMaterial:f,cpInfos:P,qaAutomationMode:L});if(A){var B=this._materialList,x=new l(t,E,b,E?E.id:-1,v,o?o.glType:-1,g,T);this._sortByProgramNextFrame=!0,B.push(x)}},o.prototype.empty=function(){for(var e=this._materialList,i=e.length,t=this._displayRangeLists,r=0;r<i;r++){var a=t.get(e[r].id);a&&a.material._displayRangeLists.delete(e[r].id.toString()+"_"+this.string_id)}e.length=0,t.clear()},o.prototype.cleanMaterialListAndDRLs=function(){for(var e=this._displayRangeLists,i=0,t=0,r=0,a=-1,s=this._materialList;i<s.length;){a=s[i].id;var n=e.get(a);n&&n.getFirstDrawable()?r>0?(s.splice(t,r),i=++t,r=0):t=++i:(r++,e.delete(a),n&&n.material._displayRangeLists.delete(a.toString()+"_"+this.string_id),i++)}r>0&&s.splice(t,r)},o.prototype.init=function(){},o.prototype.finalize=function(){},o.prototype.setValues=function(e){if(void 0!==e)for(var i in e){var t=e[i];void 0!==t?i in this&&(this[i]=t):console.warn("DisplayList: '"+i+"' parameter is undefined.")}},o}),define("DS/RenderEngineUtils/StateSortingResult",["DS/Mesh/ThreeJS_Base","DS/RenderEngineUtils/DisplayList","DS/Visualization/CullingSystem"],function(e,i,t){"use strict";var r=null,a=null,s=t.__CullingSystemFactory;e.displayListPriorityEnum={},e.displayListPriorityEnum.dlSolids=71,e.displayListPriorityEnum.dlSurfaces=70,e.displayListPriorityEnum.dlSurfacesCurvedPipes=69,e.displayListPriorityEnum.dlSurfacesCurvedPipesTranspar=68,e.displayListPriorityEnum.dlEdges=67,e.displayListPriorityEnum.dlBack=66,e.displayListPriorityEnum.dlPoints=65,e.displayListPriorityEnum.dlDecals=64,e.displayListPriorityEnum.dlTranspar1D=63,e.displayListPriorityEnum.dlTranspar=62,e.displayListPriorityEnum.dlEdgeAdjacenceSelection=61,e.displayListPriorityEnum.dlEdgePrimitiveSelection=60,e.displayListPriorityEnum.dlPointPrimitiveSelection=59,e.displayListPriorityEnum.dlNoZ=58,e.displayListPriorityEnum.dlNoZTranspar=57,e.displayListPriorityEnum.dlDepthValue=56,e.displayListPriorityEnum.dlDepthValue2=55,e.displayListPriorityEnum.OTHER3D_2DMODE=54,e.displayListPriorityEnum.OTHER3D=36,e.displayListPriorityEnum.priority0=53,e.displayListPriorityEnum.priority1=51,e.displayListPriorityEnum.priority2=49,e.displayListPriorityEnum.priority3=47,e.displayListPriorityEnum.priority4=45,e.displayListPriorityEnum.priority5=43,e.displayListPriorityEnum.priority6=41,e.displayListPriorityEnum.priority7=39,e.displayListPriorityEnum.priority8=37,e.displayListPriorityEnum.priority9=34,e.displayListPriorityEnum.priority10=32,e.displayListPriorityEnum.priority11=30,e.displayListPriorityEnum.priority12=28,e.displayListPriorityEnum.priority13=26,e.displayListPriorityEnum.priority14=24,e.displayListPriorityEnum.priority15=22,e.displayListPriorityEnum.priorityP0=52,e.displayListPriorityEnum.priorityP1=50,e.displayListPriorityEnum.priorityP2=48,e.displayListPriorityEnum.priorityP3=46,e.displayListPriorityEnum.priorityP4=44,e.displayListPriorityEnum.priorityP5=42,e.displayListPriorityEnum.priorityP6=40,e.displayListPriorityEnum.priorityP7=38,e.displayListPriorityEnum.priorityP8=35,e.displayListPriorityEnum.priorityP9=33,e.displayListPriorityEnum.priorityP10=31,e.displayListPriorityEnum.priorityP11=29,e.displayListPriorityEnum.priorityP12=27,e.displayListPriorityEnum.priorityP13=25,e.displayListPriorityEnum.priorityP14=23,e.displayListPriorityEnum.priorityP15=21,e.displayListPriorityEnum.HEDGE=20,e.displayListPriorityEnum.HOTHER=19,e.displayListPriorityEnum.FURTIVE_EDGE=18,e.displayListPriorityEnum.FURTIVE=17,e.displayListPriorityEnum.OTHER2D=16,e.displayListPriorityEnum.TRANSPAR2DP15=15,e.displayListPriorityEnum.TRANSPAR2DP14=14,e.displayListPriorityEnum.TRANSPAR2DP13=13,e.displayListPriorityEnum.TRANSPAR2DP12=12,e.displayListPriorityEnum.TRANSPAR2DP11=11,e.displayListPriorityEnum.TRANSPAR2DP10=10,e.displayListPriorityEnum.TRANSPAR2DP9=9,e.displayListPriorityEnum.TRANSPAR2DP8=8,e.displayListPriorityEnum.TRANSPAR2DP7=7,e.displayListPriorityEnum.TRANSPAR2DP6=6,e.displayListPriorityEnum.TRANSPAR2DP5=5,e.displayListPriorityEnum.TRANSPAR2DP4=4,e.displayListPriorityEnum.TRANSPAR2DP3=3,e.displayListPriorityEnum.TRANSPAR2DP2=2,e.displayListPriorityEnum.TRANSPAR2DP1=1,e.displayListPriorityEnum.TRANSPAR2DP0=0,e.displayListPriorityEnum.priority=[e.displayListPriorityEnum.priority0,e.displayListPriorityEnum.priority1,e.displayListPriorityEnum.priority2,e.displayListPriorityEnum.priority3,e.displayListPriorityEnum.priority4,e.displayListPriorityEnum.priority5,e.displayListPriorityEnum.priority6,e.displayListPriorityEnum.priority7,e.displayListPriorityEnum.priority8,e.displayListPriorityEnum.priority9,e.displayListPriorityEnum.priority10,e.displayListPriorityEnum.priority11,e.displayListPriorityEnum.priority12,e.displayListPriorityEnum.priority13,e.displayListPriorityEnum.priority14,e.displayListPriorityEnum.priority15],e.displayListPriorityEnum.priorityP=[e.displayListPriorityEnum.priorityP0,e.displayListPriorityEnum.priorityP1,e.displayListPriorityEnum.priorityP2,e.displayListPriorityEnum.priorityP3,e.displayListPriorityEnum.priorityP4,e.displayListPriorityEnum.priorityP5,e.displayListPriorityEnum.priorityP6,e.displayListPriorityEnum.priorityP7,e.displayListPriorityEnum.priorityP8,e.displayListPriorityEnum.priorityP9,e.displayListPriorityEnum.priorityP10,e.displayListPriorityEnum.priorityP11,e.displayListPriorityEnum.priorityP12,e.displayListPriorityEnum.priorityP13,e.displayListPriorityEnum.priorityP14,e.displayListPriorityEnum.priorityP15];var n=0,o=function(i,t){null===r&&(r=e.Constants,a=e.MaterialToUse),this.id=n++,this._displayLists=[],this._resetGSSOCacheIndex=-1,this._pickingPriorityMapping=null,this.pass=i,this.materialToUse=t,this.overridableMaterial=t===a.originalMaterial||t===a.oitAccumMaterial||t===a.oitRevealMaterial||t===a.transparentShadowMaterial||t===a.ZOnlyMaterial,this.init()};function l(i,t){return i?"c"+(i._renderingRole===e._CameraRoles.NONE||t&&t._checkCamera?i.id:i._renderingRole):"c"}o.prototype.init=function(){for(var t=new i({name:"SOLID",priority:e.displayListPriorityEnum.dlSolids,zSort:e.FrontToBack,side:r.FrontSide,polygonOffset:!0}),a=new i({name:"SURFACE",priority:e.displayListPriorityEnum.dlSurfaces,zSort:e.FrontToBack,side:r.DoubleSide,polygonOffset:!0}),s=new i({name:"EDGE",priority:e.displayListPriorityEnum.dlEdges,zSort:e.FrontToBack,side:r.DoubleSide,polygonOffset:!1,hasOcclusionDepth:!1}),n=new i({name:"SURFACE_CURVED_PIPE",priority:e.displayListPriorityEnum.dlSurfacesCurvedPipes,zSort:e.FrontToBack,side:e.DoubleSide,polygonOffset:!0}),o=new i({name:"SURFACE_CURVED_PIPE_TRANSPAR",priority:e.displayListPriorityEnum.dlSurfacesCurvedPipesTranspar,zSort:e.BackToFront,side:r.DoubleSide,polygonOffset:!0,depthWrite:!1,hasTranspar:!0,canOIT:!0,hasOcclusionDepth:!1}),l=new i({name:"BACK",priority:e.displayListPriorityEnum.dlBack,zSort:e.FrontToBack,side:r.DoubleSide,polygonOffset:!0,depthWrite:!1,depthFunc:"GREATER",canOIT:!0,hasPoliteDepth:!1,hasOcclusionDepth:!1}),d=new i({name:"POINT",priority:e.displayListPriorityEnum.dlPoints,zSort:e.FrontToBack,side:r.DoubleSide,polygonOffset:!1,hasOcclusionDepth:!1}),p=new i({name:"DECALS",priority:e.displayListPriorityEnum.dlDecals,zSort:e.FrontToBack,side:r.DoubleSide,polygonOffset:!0,hasTranspar:!0,hasDecal:!0,hasPoliteDepth:!1,hasOcclusionDepth:!1,canOIT:!0}),y=new i({name:"TRANSPAR1D",priority:e.displayListPriorityEnum.dlTranspar1D,zSort:e.BackToFront,side:r.DoubleSide,polygonOffset:!0,depthWrite:!1,hasTranspar:!0,canOIT:!0,hasOcclusionDepth:!1}),c=new i({name:"TRANSPAR",priority:e.displayListPriorityEnum.dlTranspar,zSort:e.BackToFront,side:r.DoubleSide,polygonOffset:!0,depthWrite:!1,hasTranspar:!0,canOIT:!0,hasOcclusionDepth:!1,canForceSideOnSolids:!0}),u=new i({name:"EDGEADJACENCESELECTION",priority:e.displayListPriorityEnum.dlEdgeAdjacenceSelection,zSort:e.FrontToBack,side:r.DoubleSide,polygonOffset:!1,hasOcclusionDepth:!1,depthTest:!1}),h=new i({name:"EDGEPRIMITIVESELECTION",priority:e.displayListPriorityEnum.dlEdgePrimitiveSelection,zSort:e.FrontToBack,side:r.DoubleSide,polygonOffset:!1,hasOcclusionDepth:!1,depthTest:!1}),g=new i({name:"POINTPRIMITIVESELECTION",priority:e.displayListPriorityEnum.dlPointPrimitiveSelection,zSort:e.FrontToBack,side:r.DoubleSide,polygonOffset:!1,hasOcclusionDepth:!1,depthTest:!1}),m=new i({name:"NOZ",priority:e.displayListPriorityEnum.dlNoZ,zSort:e.FrontToBack,side:r.DoubleSide,polygonOffset:!0,clearDepth:!0,hasPoliteDepth:!1,noz:!0,hasOcclusionDepth:!1}),f=new i({name:"DEPTHVALUE2",priority:e.displayListPriorityEnum.dlDepthValue2,zSort:e.BackToFront,side:r.DoubleSide,hasPoliteDepth:!1,depthTest:!1,noz:!0,neverSort:!0,hasOcclusionDepth:!1}),P=new i({name:"DEPTHVALUE",priority:e.displayListPriorityEnum.dlDepthValue,zSort:e.FrontToBack,side:r.DoubleSide}),L=new i({name:"NOZTRANSPAR",priority:e.displayListPriorityEnum.dlNoZTranspar,zSort:e.BackToFront,side:r.DoubleSide,polygonOffset:!0,hasPoliteDepth:!1,noz:!0,hasOcclusionDepth:!1}),D=new i({name:"OTHER2D",priority:e.displayListPriorityEnum.OTHER2D,zSort:e.FrontToBack,side:r.DoubleSide}),_=0;_<16;_++){var S=new i({name:"NOZPRIORITY"+_,priority:e.displayListPriorityEnum.priority[_],zSort:e.FrontToBack,side:r.DoubleSide,polygonOffset:!0,depthTest:!1,hasOcclusionDepth:!0,hasPoliteDepth:!1,sortByGLType:!0,noz:!0});this.addDisplayList(S)}for(_=0;_<16;_++){S=new i({name:"NOZPRIORITYP"+_,priority:e.displayListPriorityEnum.priorityP[_],zSort:e.FrontToBack,side:r.DoubleSide,polygonOffset:!0,depthTest:!0,depthFunc:"ALWAYS",hasOcclusionDepth:!0,hasPoliteDepth:!1,sortByGLType:!0,noz:!0});this.addDisplayList(S)}for(_=0;_<16;_++){S=new i({name:"TRANSPAR2DP"+_,priority:e.displayListPriorityEnum.TRANSPAR2DP0+_,zSort:e.BackToFront,side:r.DoubleSide,depthTest:!0,depthWrite:!1});this.addDisplayList(S)}this.addDisplayList(t),this.addDisplayList(a),this.addDisplayList(n),this.addDisplayList(o),this.addDisplayList(s),this.addDisplayList(l),this.addDisplayList(d),this.addDisplayList(p),this.addDisplayList(c),this.addDisplayList(y),this.addDisplayList(u),this.addDisplayList(h),this.addDisplayList(g),this.addDisplayList(m),this.addDisplayList(L),this.addDisplayList(D),this.addDisplayList(P),this.addDisplayList(f)},o.prototype.addDisplayList=function(i){var t,r=!1;if(this._displayLists.length&&void 0!==i.priority)for(t=0;t<this._displayLists.length&&!r;t++){var a=this._displayLists[t].priority;i.priority>a&&(this.insertDisplayList(i,t),r=!0)}for(r||this._displayLists.push(i),t=0;t<this._displayLists.length;t++)this._displayLists[t].index=t;return i.ssrId=this.id,i.ssr=this,i.zSort===e.BackToFront&&(i.mustZSort=!0),i},o.prototype.insertDisplayList=function(e,i){this._displayLists.splice(i,0,e)},o.prototype.getDisplayListByPriority=function(e){for(var i=0;i<this._displayLists.length;i++)if(this._displayLists[i].priority===e)return this._displayLists[i];return null},o.prototype.getDisplayListByName=function(e){for(var i=0;i<this._displayLists.length;i++)if(this._displayLists[i].name===e)return this._displayLists[i];return null};var d={_getStateSortingResult:function(e,i,t,r,a,s){var n;if(r?(n="id"+r.id+l(a,r),t&&(n+="s"+t.id)):n="noid",e&&e.hideSurfacesAndUnclipedMeshes&&(n+="h"),s[n])return s[n];var d=new o(e,i);return s[n]=d,d},_getCullingSystem:function(e,i,t,r,a){var n=r+l(e,t);return a&&a.hideSurfacesAndUnclipedMeshes&&(n+="h"),s.get(i,n)}};return d}),define("DS/RenderEngineUtils/RenderEngineUtils",["DS/RenderEngineUtils/StateSortingResult","DS/RenderEngineUtils/DisplayList","DS/RenderEngineUtils/InheritanceSolver","DS/RenderEngineUtils/StateSortingCacheItem"],function(e,i,t,r){"use strict";return{StateSortingResult:e,DisplayList:i,InheritanceSolver:t,StateSortingCacheItem:r}});