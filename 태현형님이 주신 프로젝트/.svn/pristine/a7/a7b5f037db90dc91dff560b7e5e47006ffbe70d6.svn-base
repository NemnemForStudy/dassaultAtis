/*!  COPYRIGHT DASSAULT SYSTEMES 2016   */
define("DS/ENOPAD_v2/mixins/_PADDnD",["DS/ENXNav/mixins/_xNavDnD","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADDropConfirm","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSettingsMgt","DS/PADUtils/Utility","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,a,r,d,c){"use strict";return e.extend({shouldAcceptDnDDrop:function(e,t,n,i){if(!0===i.isRoot){var o={shiftKey:2===i.modifiers};this._add_drop_invite(o)}else this.dropInvitContainer.show("insert");return!0},doDnDDrop:function(e,n,s,a){var r={dataTransfer:e},l=this,u=l._parent;t.retrieveDroppedDataAsync(r,function(r){var p=!0,g=!1;s&&s._parentNode&&n&&s._parentNode.options.resourceid===n.options.resourceid&&(g=!0);var f=!1;t.getWidgetId()===r.unserializedData.widgetId&&(f=!0,p=!1);var h=function(t){if(t){var o,d=!1;if(r.unserializedData.data.items.forEach(function(e){if(n){var t=n.options.resourceid;if(e.path)for(var i=0;i<e.path.length;i++)if(t===e.path[i].resourceid){d=!0;break}}}),a.isRoot||d&&!f)e.params=r,l._parent=u,l._parent(e,n,s,a);else r.authorized_objects&&r.authorized_objects.length>0?s&&s._parentNode&&n&&s._parentNode.options.resourceid===n.options.resourceid?(o={dropInfos:{nodeModel:s,dropPosition:"top"},dropped_data:r.authorized_objects,source_data:r.source_data},1===r.authorized_objects.length?l._dropOnCellCompositeOrder(o):(i.displayNotification({msg:c.multi_reordering,eventID:"warning"}),l.dropInvitContainer&&l.dropInvitContainer.hide())):(o={dropInfos:{nodeModel:n},dropped_data:r.authorized_objects,source_data:r.source_data},l._dropOnTreeColumn(o)):l.dropInvitContainer&&l.dropInvitContainer.hide()}else l.dropInvitContainer&&l.dropInvitContainer.hide()};if(!0===l.getEditMode()||a.isRoot){var v=l.getPADTreeDocument(),m=v._confirmDialog||!1;if(a.isRoot&&(m=!1),m){var D=v._copyMode,P=c.all_selected_objects,_=r.authorized_objects;if(_&&1===_.length&&(P=_[0].displayName),0!==_.length){var b=n.options.label||n.options.display;new o({copyMode:D,isReordering:g,isOutsideWidget:p,dropName:P,targetName:b,callback:h})}else l.dropInvitContainer&&l.dropInvitContainer.hide()}else h(!0)}else i.displayNotification({msg:d.editmodedeactivated,eventID:"info"})})},onDragOverCell:function(e,t){if(this.getPADTreeDocument().isGroupingApplied()){let n=t.nodeModel;if((n.isGroupingNode||n.isRoot())&&e.dataTransfer)return e.dataTransfer.dropEffect="none",e.preventDefault(),!1}return e.dataTransfer&&("copyMove"!==e.dataTransfer.effectAllowed&&"copy"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect="copy",e.preventDefault())),!!this._isDroppableInBody()&&("find_in_ctx"===t.dataIndex?this.dropInvitContainer.show("find"):this.dropInvitContainer.show("insert"),e.preventDefault(),!0)},onDropCell:function(e,n){var l=this,u=[],p=!1,g=!1;if((t.isTouchDevice()||t.isSurface())&&(this._dnd_leaveCell||this._dnd_startCell)&&(this._dnd_leaveCell=!1,this._dnd_startCell=!1,r.elementIsOrIsWithin(e.target,this._dnd_start_target)))return this._dnd_start_target=null,void(this.dropInvitContainer&&this.dropInvitContainer.hide(this.dropInvitContainer.active_invite));if(n.nodeModel&&n.nodeModel.options){var f=n.nodeModel.options.type;if(f&&"Drawing"===f)return i.displayNotification({msg:c.msg_warning_invalid_parent,eventID:"warning"}),this.dropInvitContainer&&this.dropInvitContainer.hide(this.dropInvitContainer.active_invite),!1}function h(){return u}n.nodeModel._parentNode&&(g=n.nodeModel._parentNode.options._isTrueRoot||!n.nodeModel._parentNode.options.resourceid);var v="find_in_ctx"===n.dataIndex,m="top"===n.dropPosition||"bottom"===n.dropPosition;return m&&g&&(p=!0),s.retrieveAuthorizedObjects({dnd_event:e,isFindInCtx:v,callback:function(e){var s=function(t){if(t){var o=a.getSetting("x3dPlatformId");if(!m||v){var s=0;if(v){for(s=0;s<e.authorized_objects.length;s++)u.push([e.authorized_objects[s].objectId]);u.length&&(n.nodeModel.options.partialPreExpand=h,n.nodeModel.expand())}else o===(e.authorized_objects[0]?e.authorized_objects[0].envId:"")?l._dropOnTreeColumn({dropped_data:e.authorized_objects,source_data:e.source_data,dropInfos:n}):i.displayNotification({msg:c.Tenant_InsertError,eventID:"error"})}else 1===e.authorized_objects.length?o===e.authorized_objects[0].envId?l._dropOnCellCompositeOrder({dropped_data:e.authorized_objects,source_data:e.source_data,dropInfos:n}):i.displayNotification({msg:c.Tenant_InsertError,eventID:"error"}):(l.getPADTreeDocument()._active_cutting_nodes.length>0&&l.uncut.call(l),0===e.authorized_objects.length?i.displayNotification({msg:c.no_authorized_object,eventID:"warning"}):i.displayNotification({msg:c.multi_reordering,eventID:"warning"}))}};if(!0===l.getEditMode()||v){var r=!0;t.getWidgetId()===e.source_data.widgetId&&(r=!1);var g=l.getPADTreeDocument(),f=g._confirmDialog||!1;if(!v&&f&&!p||!0===e.unsupportedDropNotified){var D=g._copyMode,P=c.all_selected_objects,_=e.authorized_objects,b="";if(_&&1===_.length&&(P=_[0].displayName,b=_[0].objectId),0!==_.length){var I=n.nodeModel.options.label||n.nodeModel.options.display;if(b===n.nodeModel.options.resourceid)i.displayNotification({msg:c.msg_warning_dndnotsupported,eventID:"warning"});else new o({copyMode:D,isReordering:m,isOutsideWidget:r,dropName:P,targetName:I,dropPosition:n.dropPosition,callback:s})}}else s(!0)}else i.displayNotification({msg:d.editmodedeactivated,eventID:"info"})}}),this.onDragLeaveCell(e),e.preventDefault(),e.stopPropagation(),!1},onDragStartRowHeader:function(e,n){var i=n.nodeModel,o=this.options.model.getXSO().get().slice(0);if(o[0]!==i){var s=o.indexOf(i),a=o[0];o[0]=i,o[s]=a}var r=t.dropdata_from_selected_nodes(o);r.fromRowID=n.rowID,r.data.DataGridView_Row_Options={"dswebux/x-datagridview.row.options.label+json":n.nodeModel.options.label,"dswebux/x-datagridview.row.options.icons+json":n.nodeModel.options.icons,"dswebux/x-datagridview.row.options.grid+json":n.nodeModel.options.grid,"dswebux/x-datagridview.row.id+json":n.rowID},e.dataTransfer.setData("text/plain",JSON.stringify(r))},onDropRowHeader:function(e,n){var r,l,u,p=this,g=!1,f=!1,h="",v=n.nodeModel.options.resourceid;n.nodeModel._parentNode&&(r=n.nodeModel._parentNode.options.resourceid,f=n.nodeModel._parentNode.options._isTrueRoot||!n.nodeModel._parentNode.options.resourceid),f&&(g=!0);var m=a.getSetting("x3dPlatformId");s.retrieveAuthorizedObjects({dnd_event:e,isFindInCtx:!1,callback:function(e){n.dropPosition="top";var s=e.authorized_objects;if(s&&1===s.length){var a=s[0].path.length;if(a>2&&(l=s[0].path[a-3].resourceid),h=s[0].objectId,u=e.authorized_objects[0].envId,r===l)if(h!==v)if(m===u){var f=function(t){t&&p._dropOnCellCompositeOrder({dropped_data:e.authorized_objects,source_data:e.source_data,dropInfos:n})};if(!0===p.getEditMode()){var D=!0;t.getWidgetId()===e.source_data.widgetId&&(D=!1);var P=p.getPADTreeDocument();if(!(P._confirmDialog||!1)||g)f(!0);else{var _=P._copyMode,b=c.all_selected_objects;if(s&&1===s.length&&(b=s[0].displayName,h=s[0].objectId),0!==s.length){var I=n.nodeModel.options.label||n.nodeModel.options.display;new o({copyMode:_,isReordering:!0,isOutsideWidget:D,dropName:b,targetName:I,dropPosition:n.dropPosition,callback:f})}}}else i.displayNotification({msg:d.editmodedeactivated,eventID:"info"})}else i.displayNotification({msg:c.Tenant_InsertError,eventID:"error"});else i.displayNotification({msg:c.msg_warning_dndnotsupported,eventID:"warning"});else i.displayNotification({msg:c.msg_warning_dndnotsupported,eventID:"warning"})}else 0===e.authorized_objects.length?i.displayNotification({msg:c.no_authorized_object,eventID:"warning"}):(p.getPADTreeDocument()._active_cutting_nodes.length>0&&p.uncut.call(p),i.displayNotification({msg:c.multi_reordering,eventID:"warning"}))}}),e.preventDefault()},_distinguishInsideOutsideCases:function(e){var n={insideView:[],outsideView:[]},i=this.getPADTreeDocument(),o=i.getSelectedNodes();return e.dropped_data.forEach(function(o){var s=o.path;if(s&&s.length>0&&UWA.is(s[0],"object")){var a=[];s.forEach(function(e){a.push(e.resourceid)}),s=a}var r=s?i.getNodeByOccurencePath(s):null;r&&e.source_data&&t.getWidgetId()===e.source_data.widgetId?n.insideView.push(r):n.outsideView.push(o)}),o.length>1&&n.insideView.length===o.length&&(n.insideView=o),e.dropInfos.droppedNodes&&(n.insideView=e.dropInfos.droppedNodes.map(e=>n.insideView.filter(t=>t.getID()==e.getID())[0])),n},_handleNodeNotInView:function(e,t,n){var i;i=UWA.is(e.path)?e.path.map(function(e){return e.resourceid?e.resourceid:e}):[e.objectId],n&&n.options._isTrueRoot?treeDocument.add({pids:[i],callback:function(){}}):t.push(i)},_handleNodesNotInView:function(e,t){var n=this,o=[];function s(e){var i,o={},s=t.getID();for(o[s]=[],i=0;i<e.length;i++){var a=e[i].relationid,r=e[i].resourceid;let t=e[i].clientTaskData;o[s].push({resourceid:r,relationid:a,clientTaskData:t})}n.insertNodes(o)}function a(e){if(n.getPADTreeDocument()._endBlockingTransaction(),e&&UWA.is(e.messages,"array")){var t=[];e.messages.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),i.displayNotification({msg:t.join(""),eventID:"error"})}n.dropInvitContainer&&n.dropInvitContainer.hide()}if(e.forEach(function(e){n._handleNodeNotInView(e,o,t)}),o.length>0){var r={parents:[t.getOccurencePath()],children:o,commit:!0};n.getPADTreeDocument()._beginBlockingTransaction(d.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,scenario:"externalDnD",data:r,onSuccess:s,onFailure:a})})}},_dropOnTreeColumn:function(e){var t=this.getPADTreeDocument();t._active_cutting_nodes.length>0&&this.uncut.call(this);var n=this._distinguishInsideOutsideCases(e);if(n.insideView.length>0&&t._onInsert(n.insideView,e.dropInfos.nodeModel,null),n.outsideView.length>0){var i=e.dropInfos.nodeModel;this._handleNodesNotInView(n.outsideView,i)}this.dropInvitContainer&&this.dropInvitContainer.hide()},_handleNodesNotInViewOrder:function(e,t,n){var o=this,s=[];function a(e){var i,s={},a=t.getID();for(s[a]=[],i=0;i<e.length;i++){var r=e[i].relationid,d=e[i].resourceid;let t=e[i].clientTaskData;s[a].push({resourceid:d,relationid:r,ordering:n,clientTaskData:t})}o.insertNodes(s)}function r(e){if(o.getPADTreeDocument()._endBlockingTransaction(),e&&UWA.is(e.messages,"array")){var t=[];e.messages.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),i.displayNotification({msg:t.join(""),eventID:"error"})}o.dropInvitContainer&&o.dropInvitContainer.hide()}if(e.forEach(function(e){o._handleNodeNotInView(e,s,null)}),s.length>0){var c={parents:[t.getOccurencePath()],children:s,ordering:n,commit:!0};o.getPADTreeDocument()._beginBlockingTransaction(d.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,scenario:"externalDnD",data:c,onSuccess:a,onFailure:r})})}},_dropOnCellCompositeOrder:function(e){if(this.getPADTreeDocument()._active_cutting_nodes.length>0&&this.uncut.call(this),e.dropInfos&&e.dropInfos.nodeModel){var t=this.getPADTreeDocument(),n=e.dropped_data[0].path;if(n&&n.length>0&&UWA.is(n[0],"object")){var o=[];n.forEach(function(e){e.resourceid&&o.push(e.resourceid)}),n=o}var s=n?t.getNodeByOccurencePath(n):null,a=e.dropInfos.nodeModel._parentNode,r={};if(a&&!a.options._isTrueRoot){var d,l,u=a.getChildren(),p=e.dropInfos.nodeModel.getRelationID(),g=a.getChildren().indexOf(e.dropInfos.nodeModel),f=-1,h=-1;if(g>-1&&(f=g-1,h=g+1),"top"===e.dropInfos.dropPosition?(l=u?u[f]:null,!p&&s&&a.insertBefore(s,e.dropInfos.nodeModel),r.before=p,r.after=l?l.getRelationID():""):"bottom"===e.dropInfos.dropPosition?(d=u?u[h]:null,!p&&s&&a.addChild(s,a.getChildren().indexOf(e.dropInfos.nodeModel)+1),r.after=p,r.before=d?d.getRelationID():""):i.displayNotification({msg:c.drop_between_lines,eventID:"warning"}),p)if(s)t._compositeOrder(s,a,r);else{var v=this._distinguishInsideOutsideCases(e);v.outsideView.length>0&&this._handleNodesNotInViewOrder(v.outsideView,a,r)}}else i.displayNotification({msg:c.drop_between_lines,eventID:"warning"});this.dropInvitContainer&&this.dropInvitContainer.hide()}}})}),define("DS/ENOPAD_v2/models/mixins/PADDocProxy",["UWA/Core","DS/PADServices/utils/Generics","DS/PADServices/utils/Iterator","DS/ENXNav/models/NodeUtils","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Constants","DS/ENOXParser/modules/TwoDParser","DS/PADUtils/views/PADAlert","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,a,r,d,c,l){const u="insertExisting",p="detach",g="reParent",f="replaceInstances",h="updateRevision",v="TitleInfo";function m(){}return m.prototype={_appendToCommandProxy:function(){if(this._cmdProxy){let e={events:{onRefresh:this._onRefresh.bind(this),onPadRefresh:this._onPadRefresh.bind(this)}};this._cmdProxy.addProxyEvents(e)}},_handleSplitAndRefresh:function(e){if(e&&e.modified&&e.created){for(var t,n=[],i={},o=0;o<e.modified.length;o++)t={oldId:e.modified[o].physicalid,newId:e.created[o].physicalid},n.push(t);i.couples=n,i.cb=e.cb,this.splitInstance(i)}else console.warn("refreshInstance: no input")},_onRefresh:function(e){let i=this;if((t.checks.array(e.authored.created)||t.checks.array(e.authored.modified))&&(e.authored.origin&&"reserve"===e.authored.origin||this.refreshNodeById({created:e.authored.created,modified:e.authored.modified})),t.checks.array(e.authored)&&e.authored.length&&e.authored[0].previous)for(var o=0;o<e.authored.length;o++){var a=e.authored[o].previous,r=e.authored[o].modified;if(a!==r){var d={modified:[{physicalid:a}],created:[{physicalid:r}]};i._handleSplitAndRefresh(d)}}if(t.checks.array(e.authored.deleted)){var c=[],l=[];n.iterate(e.authored.deleted,function(e){var t=i.getNodesById(e);n.iterate(t,function(t){-1===l.indexOf(e)&&l.push(e)}),c=c.concat(i.getNodesById(e))}),i.deleteNodes(c,!0),s.publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:e.authored.deleted}})}},_onPadRefresh:function(e){if(!0===o.getSetting("activateFUN076708")){var t=this,i=function(n){var i=Object.getOwnPropertyNames(n);for(var o in i){let s=i[o];switch(s){case u:e.origin&&"CCP"===e.origin||(n.insertExisting&&n.insertExisting.modified&&n.insertExisting.created&&n.insertExisting.inserted?t._viewInsertExisting(n.insertExisting):console.warn("onPadRefresh missing insertExisting "+s));break;case p:n.detach&&n.detach.deleted?t._viewDetach(n.detach):console.warn("onPadRefresh missing detach "+s);break;case g:t._viewReParent(n.reParent);break;case f:t.splitInstance(n.replaceInstances);break;case v:break;case h:t.updateRevision(n);break;default:console.warn("onPadRefresh unknown "+s)}}};e.transactions?n.iterate(e.transactions,function(e){i(e)}):i(e)}},_viewDetach:function(e){var t=this;let i=e.deleted.map(function(e){return t.getNodesByRelId(e)}).reduce(function(e,t){return e=e.concat(t)},[]);this.withTransactionUpdate(function(){n.iterate(i,function(e){let t=e.getParent();t&&t.removeChild(e)})})},_viewReParent:function(e){this._viewInsertExisting(e),this._viewDetach(e)},_viewInsertExisting:function(e){},_viewSplitInstance:function(t){var n=this;function i(e){if(!e.hasChildren())return e.getDepth();var t=1;return e.getChildren().forEach(function(e){var n=i(e);n>t&&(t=n)}),t}var o,s,a,r,d,c,l,u,p=[],g=[],f=[];this._insertFlag=!0,this.withTransactionUpdate(function(){try{for(var h=0;h<t.couples.length;h++){var v=n.getNodesByRelId(t.couples[h].oldId);if(v&&v.length>0)for(var m=0;m<v.length;m++)if(o=v[m]){if((u=o.getOccurencePath())&&u.length&&p.push(u),o.isExpanded()){var D=i(o)-o.getDepth();D=parseInt(D),f.push(D)}if(g.push(o.getRelationID()),a=o.getParent()){r=a.getChildren(),s=o.options.relationtype,d=r.indexOf(o)+1,c=e.clone(o.options,!1);var P=e.clone(o.options.grid,!1);c.grid=P,c.children&&(c.children=[]),c.relationid=t.couples[h].newId,(l=n.createNodeModel(c)).setRelationID(t.couples[h].newId,s),g.push(t.couples[h].newId),d===r.length?a.addChild(l):t.editVariant?a.insertBefore(l,o):a.insertBefore(l,r[d]),a.isExpanded()||a.options.padstate&&"partiallyExpanded"===a.options.padstate||(a.setState({state:"partiallyExpanded"}),a.options.padstate="partiallyExpanded"),l.isSelected()||l.select(),o.isSelected()&&o.unselect(),(u=l.getOccurencePath())&&u.length&&p.push(u)}}}}catch(e){console.error("error >>:",e)}finally{console.info("splitInstance done")}}),n.invalidateViewPort(),t.editVariant&&n.updateInstance({occurencePaths:p,expandStates:f,newRelIds:g,editCfg:!0}),t.cb&&t.cb({occurencePaths:p,expandStates:f,newRelIds:g})},splitInstance:function(t){var n=this;t.editVariant||t.cb||(t.cb=function(t){e.is(n.updateInstance,"function")&&n.updateInstance(t)}),this._viewSplitInstance(t)}},m}),define("DS/ENOPAD_v2/commands/edit/_Cut",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.cut()}}}),define("DS/ENOPAD_v2/mixins/_PADRefresh",["UWA/Class","DS/PADUtils/PADSettingsMgt"],function(e,t){"use strict";var n=n=e.extend({});return!0!==t.getSetting("refresh_v2")&&(n.prototype.refresh=function(e){e=void 0===e||e,require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("Uncut").begin()}),e&&this._commandProxy.refreshModel();var t=this.getPADTreeListView(),n=this.getPADDGVView();n.options.shouldClearSort=!1,n&&n.removeFilterView(),this.getPADTreeDocument().refresh({treelist:t,datagrid:n,dispatch:!1})}),n}),define("DS/ENOPAD_v2/models/mixins/PADDocInserts",["DS/PADServices/ws/WSAccess","DS/PADServices/utils/Iterator","DS/PADServices/utils/PromiseHook","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Constants","DS/ENOXParser/modules/PADParser","DS/ENOXParser/modules/ClientDataParser","DS/PADServices/utils/Generics","DS/PADServices/ws/WSAccess","DS/PADServices/settings/AppSettings","DS/ENXNav/models/xNavNodeModel","DS/ENXNav/utils/TwoDAppEvents","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADPredicatesNls","DS/PADUtils/views/PADAlert","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,a,r,d,e,c,l,u,p,g,f,h,v,m){const D=["owner","ds6w:globalType"];function P(e){let t=i.parseAttributes(e.attributes);if(d.checks.number(t.relcount)&&t.relcount>0&&(t.children=[]),t.padgrid&&d.checks.string(t.padgrid.relcount)){parseInt(t.padgrid.relcount)>0&&(t.children=[])}return e.relationid&&(t.relationid=e.relationid),t}function _(e,n,i,o){t.iterate(n,function(n){let o=e.getRoots().map(function(e){return e.getNodesById(n.parent_id)}).reduce(function(e,t){return e=e.concat(t)},[]);t.iterate(o,function(o){let a=n.children.map(P);t.iterate(a,function(t){var n=[],a={insertExisting:{modified:[],inserted:[],created:[]}};t.grid["ds6w:reserved-Instance"]||(t.grid["ds6w:reserved-Instance"]="FALSE");var r=e.createNodeModel(t);o.addChild(r),o.setState(s.NODE_STATES.PARTIALLY_EXPANDED),o.options.padstate=s.NODE_STATES.PARTIALLY_EXPANDED.state,a.insertExisting.modified.push(o.getID()),a.insertExisting.inserted.push(r.getOccurencePath()),n.push(r.getID()),a.insertExisting.created.push(r.getRelationID()),a.insertExisting.withContext=!1,e.updateNodesAttrValue(n,D,function(){}),e.isGroupingApplied()&&o.isRoot()&&function(e,t){let n=e.grpGetOtherNode(t.getRoot());n.addChild(t),n.isExpanded()||n.setState(s.NODE_STATES.PARTIALLY_EXPANDED)}(e,r),f.updateNLS(r),i.transactions.push(a)})})}),e._cmdProxy.padRefresh(i)}function b(){}return b.prototype={insertNodes:function(e,n){var i=this,o=[];var s={transactions:[]};return this.wrapInTransaction(function(){d.checks.array(e.created)||d.checks.array(e.inserted)?(console.info("INFO: insertNodes() attributes provided"),i.withTransactionUpdate(function(){e.created&&function(e,n,i){let o=n.map(P);p.setAuthoringState(!0);var s=[];t.iterate(o,function(t){let n=e.createNodeModel(t),o=e.addRoot(n);o.select(),s.push(o.getID()),i.push(o),f.updateNLS(o),e.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.getRoots().length,added_node:o}})}),e.updateNodesAttrValue(s,D,function(){});let a={pids:s,already_added_in_PS:!0};e._cmdProxy.drop(a)}(i,e.created,o),e.inserted&&_(i,e.inserted,s)})):(console.info("INFO: insertNodes() attributes to be gotten"),i._insertWithLessInfo({parameters:e,noNotification:e.noNotification,callback:n}))}),o},_insertWithLessInfo:function(e){let i=this,s=e.callback;if(!0===c.getSetting("useLWCWebServices")){console.info("INFO: insertNodes() attributes with expand"),this.unselectAll();let s={docPtr:this,padRefreshData:{transactions:[]},insertedNodes:[],pathToFetch:[],rootNodesIds:[],rootNodes:[],objects:e.parameters,parentOccurencePaths:[]};!function(e){t.iterateObj(e.objects,function(n,i){if(d.checks.array(n)){let o={insertExisting:{modified:[],inserted:[],created:[]}};if(t.iterate(n,function(t){let n=[i,t.relationid,t.resourceid];-1===e.pathToFetch.indexOf(n)&&(e.pathToFetch.push(n),o.insertExisting.modified.push(i),o.insertExisting.inserted.push(t.resourceid),e.insertedNodes.push(t.relationid),o.insertExisting.created.push(t.relationid),o.insertExisting.withContext=!1);let s=t.clientTaskData;s&&new r(s).appendPaths(e.pathToFetch)}),-1===e.rootNodesIds.indexOf(i)){e.rootNodesIds.push(i);let n=e.docPtr.getNodesById(i);n&&(e.rootNodes=e.rootNodes.concat(n),t.iterate(n,function(t){var n=t.getOccurencePath();-1===e.parentOccurencePaths.indexOf(n)&&e.parentOccurencePaths.push(n)}))}e.padRefreshData.transactions.push(o)}})}(s);e.noNotification;delete e.noNotification,this._beginBlockingTransaction(v.inserting_nodes);let l=i._getAuthoringFlag();this._getExpandFunc(l)({pathIds:s.pathToFetch,data:{expandLevel:"0"},FBIProxy:this.options.FBIProxy,timeout:c.getSetting("webapi_timeout")}).then(function(e){var r=o.data.jsonParse(e);i._parseLoadModel=!0;let d=a.insertNodesExpand({treeDoc:i,expandedNodes:s.rootNodes,FBIProxy:i.options.FBIProxy,wsResponse:r,expandLevel:0});new n(d,i.boundClearFlag);d.then(function(){i._endBlockingTransaction(),function(e){if(e.insertedNodes.length){var n=[];t.iterate(e.insertedNodes,function(t){let i=e.docPtr.getNodesByRelId(t);i&&i.length&&n.push(i[0].getOccurencePath())}),e.padRefreshData.transactions[0].insertExisting.inserted=n}}(s),i._cmdProxy.padRefresh(s.padRefreshData),u.addChild()})})}else{console.info("INFO: insertNodes() attributes with fetch");var l=[];t.iterateObj(e.parameters,function(e){d.checks.array(e)&&function(e,n){t.iterate(n,function(t){o.array.unique(e,t.resourceid),o.array.unique(e,t.relationid)})}(l,e)});let n=e.noNotification;delete e.noNotification,delete e.parameters.noNotification,this._beginBlockingTransaction(v.inserting_nodes);c.getSetting("enopad_webapis_debug");let r=i._getAuthoringFlag();this._getFetchFunc(r)({data:{physicalid:l},autoAttSelection:!0}).then(function(t){let r=o.data.jsonParse(t);if(i.invalidateViewPort(),0===r.results.length)throw new Error("Cannot find object with the physicalid "+l);i.wrapInTransaction(function(){var t=a.insertNodes({treedocument:i,response:r,insert_parameters:e.parameters});i._cmdProxy.padRefresh(t),u.addChild()},"insert_nodes"),i._endBlockingTransaction(),s&&s(),!0!==n&&h.displayNotification({msg:v.insert_existing_succeeded,eventID:"info"})}).catch(function(e){h.displayNotification({msg:m.generic_service_failure,eventID:"error"}),i._endBlockingTransaction()})}}},b}),define("DS/ENOPAD_v2/commands/edit/_Uncut",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.uncut()}}}),define("DS/ENOPAD_v2/utils/PADCtxMenuUtilsV2",["i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADClipboard","DS/ENXNav/utils/CtxMenuUtilsV2"],function(e,t,n,i){"use strict";var o={RESETPOS:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_ResetPosition.png")+")",COPYRELPOS:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_CopyPosition.png")+")",PASTEPOS:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_PastePosition.png")+")"};return i.psePositionCtxCmd=function(t,i){var s,a,r={available:!1,menu:[]};if(!i.collectionView)return r;if(s=i.cellInfos.nodeModel,a=i.cellInfos,!1===s.isRoot()){s.isSelected()||s.select(!0),r.available=!0;for(var d=t.getSelectedNodes(),c=!1,l=0;l<d.length&&!1===c;l++)d[l].options.grid["positionMatrix-Instance"]&&(c=!0);c&&(r.menu.push({type:"PushItem",title:e.PAD_CMDResetPosition,icon:o.RESETPOS,state:t.getEditMode()?"enabled":"disabled",action:{this:this,context:{node:s,cellInfos:a},callback:function(e){t.resetPosition()}}}),1===d.length&&r.menu.push({type:"PushItem",title:e.PAD_CMDCopyRelativePosition,icon:o.COPYRELPOS,state:t.getEditMode()?"enabled":"disabled",action:{this:this,context:{node:s,cellInfos:a},callback:function(e){var t={matrix:e.context.node.options.grid["positionMatrix-Instance"]};n.setData(n.POSITION,t)}}})),!1===n.isEmpty(n.POSITION)&&("VPMInstance"===s.options.relationtype||""===s.options.relationtype&&"3DShape"!==s.options.type&&"Drawing"!==s.options.type)&&r.menu.push({type:"PushItem",title:e.PAD_CMDPastePosition,icon:o.PASTEPOS,state:t.getEditMode()?"enabled":"disabled",action:{this:this,context:{node:s,cellInfos:a},callback:function(e){t.pastePosition()}}}),0===r.menu.length&&r.menu.push({type:"PushItem",title:e.PAD_CMDNoPositionAction,state:"disabled"})}else r.isRoot=!0;return r},i}),define("DS/ENOPAD_v2/models/_PADModelParser",["DS/ENXNav/models/_xNavCVParser","DS/ENXNav/models/xNavNodeModel","DS/PADServices/utils/AttributesMgt","DS/PADUtils/PADPredicatesNls"],function(e,t,n,i){"use strict";return e.process.insert_nodes=function(o){var s={transactions:[]},a=n.getAvailableColumns(),r=o.treedocument,d=r.getRoots(),c=o.response.results;console.log("replace insert response_results",c);var l,u,p,g=UWA.clone(o.insert_parameters,!1),f=Object.keys(g),h={},v={},m={};Date.now();function D(){for(var e,t,n,i,o,s,a,r=function(e,t){for(var n={beforeNodes:[],afterNodes:[],afterPosition:-1},i=e.length;i--;){var o=(u=e[i])._options.relationid;if(o===t.after){n.afterNodes=[u],n.afterPosition=i;break}if(o===t.before){n.beforeNodes=[u];break}}return n},d=f.length;d--;){e=f[d];for(var c=(n=h[e]).length;c--&&((t=n[c].getChildren())&&0!==t.length);){s=g[e],o=t[0];for(var l=s.length;l--&&(i=(a=s[l]).resourceid,a.ordering);){var p,v=a.ordering.before,D=a.ordering.after,P=!(!v||""===v),_=!(!D||""===D),b=r(t,a.ordering),I=b.beforeNodes.length>0,y=-1!==b.afterPosition;P&&_?(I&&(m[i]={before:b.beforeNodes}),y&&(p=b.afterPosition+2,m[i]={after:[p]})):P?I?m[i]={before:b.beforeNodes}:o&&(m[i]={before:[o]}):_&&y&&(p=b.afterPosition+2,m[i]={after:[p]})}}}}function P(t){var i,o,s=t.relationid;if((i=v[t.resourceid])&&((o=e.parse_attributes(i.attributes,a,n.getTreeColumn())).relationid=s,-1!==a.indexOf("instanceName")&&s&&v[s])){var r=e.parse_attributes(v[s].attributes,a,n.getTreeColumn());o.grid.instanceName=r.label}return UWA.clone(o,!1)}!function(){for(var e,t,n=f.length;n--;){t=f[n];for(var i=d.length;i--;)if((e=d[i].getNodesById(t)).length>0){h[t]=e;break}}}(),function(){for(var e,t,n,i,o=c.length;o--;){e=c[o],console.log("insert result",e);for(var s=(t=e.attributes).length;s--;)if("resourceid"===(n=t[s]).name){i=n.value,v[i]=e;break}}}(),D();Date.now();for(var _,b=f.length;b--;){_=f[b];var I=[],y={insertExisting:{modified:[],inserted:[],created:[]}},A=h[_],E=g[_];if(r.withTransactionUpdate(function(){for(var e,n,o=E.length;o--;){n=(p=E[o]).resourceid,e=P(p);for(var s=A.length;s--;){l=A[s];var a=new t(e);if(p.ordering){var r=m[n];r?r.before?l.insertBefore(a,r.before[0]):r.after?l.addChild(a,r.after[0]):l.addChild(a):l.addChild(a)}else l.addChild(a);"expanded"!==l.options.padstate&&(l.setState({state:"partiallyExpanded"}),l.options.padstate="partiallyExpanded"),"noChildren"===l.options.padstate&&(l.setState({state:"expanded"}),l.options.padstate="expanded"),(l._isExpanded||"expandState"===l._expandState)&&(l.options.padstate="expanded",l.setState({state:"expanded"})),y.insertExisting.modified.push(l.getID()),y.insertExisting.inserted.push(a.getID()),I.push(a.getRelationID()),y.insertExisting.created.push(a.getRelationID()),y.insertExisting.withContext=!1,i.updateNLS(a),D()}}}),s.transactions.push(y),I.length){var N=[];I.forEach(function(e){var t=r.getNodesByRelId(e);t&&N.push(t[0].getOccurencePath())}),s.transactions[0].insertExisting.inserted=N}}return s},e}),define("DS/ENOPAD_v2/utils/PADInlineEdit",[],function(){return{}}),define("DS/ENOPAD_v2/mixins/_PADKBInput",["UWA/Core","UWA/Class","UWA/Event","DS/ApplicationFrame/CommandsManager","DS/PADUtils/views/PADAlert","DS/Utilities/Dom","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,a){"use strict";return t.extend({_component:null,init:function(e){this._parent(e),this._component=e.component,this._onKeyDown_binded=this._onKeyDown.bind(this)},startObservingKeyboard:function(t){e.Element.addEvent.call(t,"keydown",this._onKeyDown_binded)},_onKeyDown:function(e){var t=this,r=n.whichKey(e),d=function(r,d){if((u=document.activeElement)&&"INPUT"===u.tagName){if("esc"===r)if(s.firstParentWithClass(document.activeElement,"xnav_treelst")&&t._component){var c=document.activeElement.getParent();t._component.getPADTreeListView().cancelModification(c.getAttribute("row-id"),c.getAttribute("column-id"))}}else{var l=i.getCommand(d);l&&(l.isEnabled()||"Uncut"===d)?(l.begin(),n.stop(e)):"Paste"===d&&(!1===t._component.getEditMode()?o.displayNotification({msg:a.edit_mode_disabled,eventID:"warning"}):o.displayNotification({msg:a.must_select,eventID:"warning"}))}var u};switch(r){case"ctrl+a":d(r,"SelectAll");break;case"ctrl+c":d(r,"Copy");break;case"ctrl+x":d(r,"Cut");break;case"ctrl+v":d(r,"Paste");break;case"ctrl+z":case"esc":d(r,"Uncut");break;case"alt+return":case"alt+enter":d(r,"ActionBar_Attributes")}}})}),define("DS/ENOPAD_v2/commands/_PADActionBarCmds",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(e,t,n){"use strict";var i=["Copy","Cut","PADOpen","DownloadStructure"];return e.extend({init:function(e){this._parent(e);var o=this;if(-1!==i.indexOf(this.options.ID)){this._check_select(),this._boundSelect=this._check_select.bind(this);let e=t.get().options.model.getXSO();e.onPostAdd(this._boundSelect),e.onPostRemove(this._boundSelect)}"RemoveAndResetExpand"===this.options.ID&&(this.options.label=n.grouping.commandTitle),"Paste"===this.options.ID&&require(["DS/PADUtils/PADClipboard"],function(e){o._boundActivate=o._activate_paste.bind(o);let n=t.get().getPADTreeDocument().getXSO();n.onPostAdd(o._boundActivate),n.onPostRemove(o._boundActivate),e.addEvent("post_setData",o._activate_paste.bind(o)),e.addEvent("post_clear",o._activate_paste.bind(o)),o._activate_paste()}),"DownloadStructure"!==this.options.ID&&(!0!==t.get().getEditMode()&&o.disable(),t.get().addEvent("editModeModified",function(e){"Paste"===o.options.ID?o._activate_paste():o._check_select()}))},execute:function(){var e=this;switch(this.options.ID){case"Copy":require(["DS/ENOPAD_v2/commands/edit/_Copy"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"Cut":require(["DS/ENOPAD_v2/commands/edit/_Cut"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"Paste":require(["DS/ENOPAD_v2/commands/edit/_Paste"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"Uncut":require(["DS/ENOPAD_v2/commands/edit/_Uncut"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"DownloadStructure":require(["DS/ENOPAD_v2/commands/tools/DownloadStructure"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"RemoveAndResetExpand":let n=t.get();n.features.grouping.executeCommand({id:this.options.ID,context:n,model:n.getPADTreeDocument()});break;default:throw new Error("Unknown command")}},isCommandAvailable:function(e){switch(e.cmdId){case"RemoveAndResetExpand":let n=t.get().getPADTreeDocument();return!(!n.isGroupingApplied()||!function(e){let t=e.getXSO().get(),n=!0;for(let e=0;e<t.length;e++){let i=t[e];if(i.isRoot()||i.isGroupingNode){n=!1;break}}return n}(n));default:return!0}},_check_select:function(){var e=!t.get().options.model.getXSO().isEmpty();!0===t.get().getEditMode()&&!0===e&&"DownloadStructure"!==this.options.ID?this.enable():this.disable()},_activate_paste:function(){var e=require("DS/PADUtils/PADClipboard"),n=!t.get().options.model.getXSO().isEmpty(),i=t.get().getEditMode();!0!==e.isEmpty(e.OBJECT)&&!0===n&&!0===i?this.enable():this.disable()}})}),define("DS/ENOPAD_v2/features/Grouping",["DS/PADServices/utils/GlobalUtils","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(e,t){function n(e){this.options=e}return n.prototype={executeCommand:function(e){switch(e.id){case"RemoveAndResetExpand":this._executeRemoveAndResetExpand(e)}},displayRefreshMessage:function(n){e.displayNotif({title:t.grouping.refreshTitle,message:t.grouping.refreshMessage,level:"info"})},_executeRemoveAndResetExpand:function(e){let t=this.options.context.getPADTreeDocument().getXSO().get();for(let e=0;e<t.length;e++){let n=t[e];n.removeChildren(),delete n.options.childComputed,n.updateOptions({children:[]}),n.collapse()}}},n}),define("DS/ENOPAD_v2/commands/edit/_Paste",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.paste()}}}),define("DS/ENOPAD_v2/mixins/_PADCCP",["UWA/Class","DS/PADUtils/PADClipboard","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADDropConfirm","DS/ENXNav/utils/TwoDAppEvents","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/ClientDataParser","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,a,r,d){"use strict";var c=e.extend({init:function(){this._parent(arguments),this._acceptedNodes={},this._rejectedNodes={}},acceptNode:function(e){var t=!1;if(!0===e.isRelationsObjectNode)t=!0,this._rejectedNodes.nonPSNodes||(this._rejectedNodes.nonPSNodes={nodes:[]}),this._rejectedNodes.nonPSNodes.nodes.push(e);else{var n=e.getPath(),i=n.length,o=n[0].getID();if(this._acceptedNodes.hasOwnProperty(o)){var s=this._acceptedNodes[o];if(s.depth<=i)s.nodes.push(e);else{var a=e.getFirstCommonAncestor(s.nodes[0]);s.nodes.length=0,s.nodes.push(a),s.depth=a.getPath().length,t=!0}}else this._acceptedNodes[o]={depth:i,nodes:[e]}}return t},applyOnAcceptedNodes:function(e){var t=!0,i=!1,o=!1;for(var s in this._acceptedNodes)if(i=!0,UWA.is(s,"string"))for(var a=this._acceptedNodes[s].nodes,d=0;d<a.length;d++)e(a[d]);return this._rejectedNodes.nonPSNodes&&(o=!0,1===this._rejectedNodes.nonPSNodes.nodes.length?n.displayNotification({msg:r.replace(r.copyNonPSNode,{label:this._rejectedNodes.nonPSNodes.nodes[0].getLabel()}),eventID:"warning"}):this._rejectedNodes.nonPSNodes.nodes.length>=1&&n.displayNotification({msg:r.replace(r.copyNonPSNodes,{length:this._rejectedNodes.nonPSNodes.nodes.length}),eventID:"warning"})),!0===o&&!1===i&&(t=!1),t}});function l(e,t){Date.now();e.withBroadcastSelect(function(){var t=e.getXSO();if(!t.isEmpty()){var i=t.get(),o=!1;i.sort((e,t)=>e._rowID-t._rowID),i.sort(function(e,t){var n=e.getDepth(),i=t.getDepth();return n===i?0:n<i?-1:n>i?1:void 0});var s=new c;if(i.forEach(function(e){o=s.acceptNode(e)||o}),o){Date.now();e.unselectAll();Date.now();!0===s.applyOnAcceptedNodes(function(e){Date.now();e.select()})&&n.displayNotification({msg:r.reselectionFeedback,eventID:"warning"})}}})}function u(e,n){var i=e.getXSO();if(!i.isEmpty()){var o,s=i.get(),a={action:n,objects:[]},r=[];s.forEach(function(t){t.isVisible()&&!0!==t.isRelationsObjectNode&&(o=t.getOccurencePath(),a.objects.push({path:o,labelPath:t.buildPath()}),r.push(e.getNodeByOccurencePath(o)))}),t.setData(t.OBJECT,a),"cut"===n&&g(r)}}var p=[];function g(e){p=e}function f(){return p}return e.extend({activeCutting:!1,activeNodes:[],getActiveNodes:function(){return f()},setStateCuttingNodes:function(e){e&&(this.activeCutting&&this.activeNodes.length>0&&this.setStaUncuttingNodes(this.activeNodes),e.forEach(function(e){e.updateOptions({isBeingCut:!0})}),this.activeCutting=!0,this.activeNodes=e)},setStaUncuttingNodes:function(e){e.length>0&&e.forEach(function(e){e.options.isBeingCut&&e.updateOptions({isBeingCut:!1})}),this.activeCutting=!1,this.activeNodes=[]},copy:function(){var e=this.getPADTreeDocument(),t=e.getSelectedNodes();this.uncut(),g([]),e.withBroadcastSelect(function(){e.withTransactionUpdate(function(){t.forEach(function(e){e.select()})})}),l(e),u(e,"copy")},cut:function(){var e=this.getPADTreeDocument();l(e),u(e,"cut"),this.options.model.setCuttingNodes(f()),this.setStateCuttingNodes(f())},uncut:function(){this.activeCutting&&(this.options.model.setCuttingNodes([]),this.setStaUncuttingNodes(this.activeNodes)),this.getPADTreeDocument().unselectAll(),t.isEmpty(t.OBJECT)||t.clear(t.OBJECT)},resetClipboard:function(){this.uncut()},_processTargets:function(e){var t,n=[],i=[];return e.forEach(function(e){e.isRoot()?n.push(e):(t=e.getID(),i.indexOf(t)<0&&(n.push(e),i.push(t)))}),n},_inputData:function(e,t){var n=[],i=[],o=[];return e.forEach(function(e){var t=e.getRelationID();""===t?n.push(e.getOccurencePath()):-1===i.indexOf(t)&&(i.push(t),n.push(e.getOccurencePath()))}),t.forEach(function(e){o.push(e.getOccurencePath())}),{children:n,parents:o,commit:!0}},_inputDataCopy:function(e,t){var n=[],i=[];return e.forEach(function(e){n.push(e.getOccurencePath())}),t.forEach(function(e){i.push(e.getOccurencePath())}),{children:n,parents:i,commit:!0}},_distinguishInsertReparentCases:function(e,t){var n={insertExisting:[],reparent:[]};return e.forEach(function(e){!e.getRelationID()||"copy"===t?n.insertExisting.push(e):n.reparent.push(e)}),n},paste:function(){var e,c,l=this;function u(e){var t,n=[];return e.forEach(function(e){e.getRelationID()&&(t=e.getParent().getID(),-1===n.indexOf(t)&&n.push(t))}),n}function p(e,t){var n;for(n=0;n<e.length;n++){var i=e[n];if(i.options.resourceid===t)return e.splice(n,1),i}return null}function g(e,t){var n,i,o,s=e.length;if(t){for(n=0;n<s;n++)if((i=e[n]).options.resourceid===t){o=i;break}}else 1===s&&(o=e[0]);return o}function h(e,t){var n,i,o,s=e.length;if(t){var a=[];for(n=0;n<s;n++)(i=e[n]).options.resourceid===t&&a.push(i);if(1==a.length)o=a[0];else if(a.length>1){o=a[0];e.indexOf(o)}}else 1===s&&(o=e[0]);return o}function v(e){for(var t=[],n=l.getPADTreeDocument(),i=0;i<e.length;i++){var o=e[i],s=n.getNodeByOccurencePath(o);s&&t.push(s.getLabel())}return t}this.setStaUncuttingNodes(f());var m=this.getPADTreeDocument(),D=m._confirmDialog||!1,P=0,_=0,b=0,I=m.getXSO();if(!I.isEmpty()){var y=I.get();if(y.some(function(e){return"Drawing"===e.options.type}))return n.displayNotification({msg:d.msg_warning_invalid_parent,eventID:"warning"}),!1;_=(y=this._processTargets(y)).length;var A=d.selected_target;if(_>1&&(A=d.selected_targets),!t.isEmpty(t.OBJECT)){var E=!1;f().length>0&&(E=!0);var N=t.consumeData(t.OBJECT,E),S=N.action;if(S&&(c="copy"===S?"COPY":"MOVE",e=function(e,t){var i=[];return e.objects.forEach(function(e){var o=s.node.exactNodeByPath(t,e.path);if(o&&o.getOccurencePath().length===e.path.length)i.push(o);else{var a=e.labelPath.replace(/\/$/,"");n.displayNotification({msg:a+r.pasteObjectNotInView,eventID:"error"})}}),i}(N,m)),e.length<N.objects.length)return;if(e.length>0){var C=l._distinguishInsertReparentCases(e,S);P=C.reparent.length,b=C.insertExisting.length}if(_*P>1e3)return void n.displayNotification({msg:d.limit_cut_paste,eventID:"error"});var x=function(t){t&&(b>0&&(l.beginBlockingTransaction(r.composite),require(["DS/ApplicationFrame/CommandsManager"],function(t){var i=t.getCommand("InsertExisting"),s=u(e);i.execute({mode:"CopyPaste",internal_call:!0,data:l._inputDataCopy(e,y),onSuccess:function(t){!function(t,i,s){var d,u,f,v,m,D,P,_,b=t.length,I=(i.length,[]),y=l.getPADTreeDocument(),A=[];let E=[];for(d=0;d<b;d++){f=t[d].hasParent,v=t[d].relationid,m=t[d].resourceid,D=t[d].instanceName?t[d].instanceName:"",P=f+"_"+v+"_"+m,u=p(e,m);let n=t[d].clientTaskData;n&&new a(n).appendPids(E),u?I.push(u):u=g(I,m);var N,S,C,x=u.getID(),O=u.getRelationID(),w=!Boolean(O);y.wrapInTransaction(function(){y.withTransactionUpdate(function(){if(N=h(i,f))if(S=N.getID(),C={node:u,parent:N,behavior:c,newRelationID:v,instanceName:D},_=f+"_"+N.options.relationid?N.options.relationid:"",P=_+P,A.indexOf(P)<0){y.instantiate(C,s),A.push(P);var e=[],t={transactions:[],origin:"CCP"},n={detach:{}};if(t.transactions.push({insertExisting:{modified:[S],inserted:[x],created:[v],withContext:!w}}),e.push(v),e.length){var a=[];e.forEach(function(e){var t=y.getNodesByRelId(e);t&&a.push(t[0].getOccurencePath())}),t.transactions[0].insertExisting.inserted=a}w||"COPY"===c?(l._commandProxy.padRefresh(t),o.addChild()):(n.detach.deleted=[O],l._commandProxy.padRefresh(t),l._commandProxy.padRefresh(n),o.addChild())}else console.log("already added to targets",C)},l),l.endBlockingTransaction()})}y.refreshNodeById({modified:E}),n.displayNotification({msg:r.pasteSucceeded,eventID:"info"})}(t,y,s)},onFailure:function(e){var t,i,o;i=[],o=[],(t=e)&&t.targets&&(i=v(t.targets)),t&&UWA.is(t.messages,"array")?(t.messages.forEach(function(e){-1===o.indexOf(e)&&o.push(e)}),n.displayNotification({msg:o.join(""),eventID:"error"})):i&&i.length>0&&n.displayNotification({msg:"Failed insert operation in "+i.join(""),eventID:"error"}),l.resetClipboard&&l.resetClipboard(),l.endBlockingTransaction()}})})),P>0&&(l.beginBlockingTransaction(r.composite),require(["DS/ApplicationFrame/CommandsManager"],function(t){var i=t.getCommand("InsertExisting"),s=u(e);i.execute({mode:"CutPaste",internal_call:!0,data:l._inputData(e.reverse(),y),onSuccess:function(t){!function(t,i,s){var d,u,f,v,m,D,P,_,b,I,y,A,E,N=t.length,S=(i.length,[]),C=l.getPADTreeDocument(),x=[],O=!0,w=[],R=[],T=[],M=[];let k=[];t.forEach(function(e){var t=e.relationid,n=e.hasParent,i=e.resourceid;t&&-1===w.indexOf(t)&&w.push(t),n&&-1===R.indexOf(n)&&R.push(n),i&&-1===M.indexOf(i)&&M.push(i);let o=e.clientTaskData;o&&new a(o).appendPids(k)});var B={newRelationIDs:w,tgtParentIds:R,removedNodeIds:M};for(d=0;d<N;d++){m=t[d].hasParent,u=t[d].relationid,f=t[d].resourceid,A=m+"_"+u+"_"+f,(v=p(e,f))?S.push(v):v=g(S,f);try{b=v.getID(),I=v.getRelationID(),y=!Boolean(I),C.wrapInTransaction(function(){C.withTransactionUpdate(function(){if(D=h(i,m))if(P=D.getID(),_={node:v,parent:D,behavior:c,newRelationID:u},E=m+"_"+D.options.relationid?D.options.relationid:"",A=E+A,x.indexOf(A)<0){C.instantiate(_,s,B),C.refreshNodeById({modified:k}),x.push(A);var e=[],t={transactions:[],origin:"CCP"},n={detach:{deleted:[]}};if(t.transactions.push({insertExisting:{modified:[P],inserted:[b],created:[u],withContext:!y}}),e.push(u),e.length){var a=[];e.forEach(function(e){var t=C.getNodesByRelId(e);t&&t.length&&t.forEach(function(e){a.push(e.getOccurencePath())})}),t.transactions[0].insertExisting.inserted=a}y||"COPY"===c?(l._commandProxy.padRefresh(t),o.addChild()):(l._commandProxy.padRefresh(t),-1===w.indexOf(I)&&-1===T.indexOf(I)&&(T.push(I),n.detach.deleted.push(I),l._commandProxy.padRefresh(n)),o.addChild())}else console.log("already done ")},l)}),l.endBlockingTransaction()}catch(e){l.endBlockingTransaction(),l.resetClipboard&&l.resetClipboard(),n.displayNotification({msg:r.pasteFailed,eventID:"error"}),O=!1}}O&&n.displayNotification({msg:r.pasteSucceeded,eventID:"info"})}(t,y,s)},onFailure:function(e){!function(e){l.endBlockingTransaction();var t=[],i=[];e&&e.targets&&(t=v(e.targets)),e&&UWA.is(e.messages,"array")?(e.messages.forEach(function(e){-1===i.indexOf(e)&&i.push(e)}),n.displayNotification({msg:i.join(""),eventID:"error"})):t&&t.length>0&&n.displayNotification({msg:"Failed reparent operation in "+t.join(""),eventID:"error"}),l.resetClipboard&&l.resetClipboard()}(e)}})})))};if(D){var O=d.all_selected_objects;1===e.length&&(O=e[0]._options.display||e[0]._options.label),1===y.length&&(A=y[0]._options.display||y[0]._options.label);new i({copyMode:c,dropName:O,targetName:A,callback:x})}else x(!0)}}},resetPosition:function(){this._doMove([1,0,0,0,1,0,0,0,1,0,0,0],"RESETPOSITION")},pastePosition:function(){for(var e=t.getData(t.POSITION).matrix.split(","),n=[],i=0;i<e.length;i++)n.push(parseFloat(e[i]));this._doMove(n,"PASTEPOSITION"),t.clear(t.POSITION)},_doMove:function(e,t){var i=this,o=i.getPADTreeDocument();require(["DS/UPSCommands/UPSCmdUtils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSession"],function(s,a,c){var l={instances:[],onComplete:function(s){if("success"===s.status){for(var l,u=e.toString(),p=0;p<s.results.length;p++)for(var g=o.getNodesByRelId(s.results[p].instance),f=0;f<g.length;f++){var h={relationId:s.results[p].instanceOut,grid:{"positionMatrix-Instance":a.checkNotIdentity(u)?u:null}};g[f].updateOptions(h)}switch(t){case"RESETPOSITION":l=r.resetPositionSucceeded;break;case"PASTEPOSITION":l=r.pastePositionSucceeded}n.displayNotification({msg:l,eventID:"info"}),c.setAuthoringState(!0,d.PADSession_disabling_index_authoring),o.pushUpdate(),i._commandProxy.updatePosMatrix(i.newParams),delete i.newParams}else"failure"===s.status&&(n.displayNotification({msg:s.message,eventID:"error"}),o.pushUpdate())},onFailure:function(e){var i,s="";switch(e.messages&&(s=Array.isArray(e.messages)?e.messages[0]:e.messages),t){case"RESETPOSITION":i=s.length>0?r.resetPositionFailedWithError:nlskeys.resetPositionFailed;break;case"PASTEPOSITION":i=s.length>0?r.pastePositionFailedWithError:r.pastePositionFailed}s.length>0&&(i=i.replace("{error}",s)),n.displayNotification({msg:i,eventID:"error"}),o.pushUpdate()}},u=i.getPADTreeDocument(),p=(u._confirmDialog,u.getXSO());if(!p.isEmpty()){for(var g=p.get(),f=0;f<g.length;f++){var h=g[f];("VPMInstance"===h.options.relationtype||""===h.options.relationtype&&"3DShape"!==h.options.type&&"Drawing"!==h.options.type)&&h.getRelationID()&&l.instances.push({instance:h.getRelationID(),nodePath:h.getOccurencePath(),hasPositioningMatrix:e})}if(l.instances.length){!0&&(o.prepareUpdate(),i.newParams={instances:l.instances},s.move3D(l))}}})}})}),define("DS/ENOPAD_v2/commands/EditMode",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt"],function(e,t,n,i){"use strict";return t.extend({_triggerFromCmd:null,_context:null,_toolbarActivated:!1,init:function(e){this._parent(e,{});var t=this;this._context=n.get(),this._toolbarActivated=this._context.isToolbarActivated(),!0===this._toolbarActivated?!0===this._context.getEditMode()?this.setState(!1,!1):this.setState(!0,!1):!0===this._context.getEditMode()?this.setState(!0,!1):this.setState(!1,!1),this.onStateChange(function(){t._triggerFromCmd=!1;var e=t.getState();!0===t._toolbarActivated&&(e=!e),t._context.setEditMode(e)})}})}),define("DS/ENOPAD_v2/mixins/_PADFolder",["UWA/Core","UWA/Class","DS/PlatformAPI/PlatformAPI","DS/PADUtils/PADSettingsMgt"],function(e,t,n,i){"use strict";return t.extend({requestCurrentFolder:function(){n.publish("FolderEditor.RequestCurrentFolder")},setFolderCommunicationChannel:function(){n.subscribe("FolderEditor.CurrentFolder",this.setCurrentFolder.bind(this)),this.requestCurrentFolder()},getCurrentFolder:function(){return this.getOption("current_folder")&&this.getOption("current_folder")!=={}?this.getOption("current_folder"):null},setCurrentFolder:function(e){this.setOption("current_folder",e);var t=JSON.parse(e);widget&&i.getSetting("syncSecCtxOnFolderChange")&&(widget.setValue("pad_security_ctx",t.SecurityContext),i.setSetting("pad_security_ctx",t.SecurityContext))},getSecurityContext:function(){return{SecurityContext:i.getSetting("pad_security_ctx"),tenant:i.getSetting("x3dPlatformId")}}})}),define("DS/ENOPAD_v2/models/mixins/PADDocSupport",["DS/PADUtils/PADSession","DS/PADServices/settings/AppSettings","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Helpers"],function(e,t,n,i){function o(){}return o.prototype={doRefreshCV:function(e,o){let s=this;return new Promise(function(o,a){let r={pathIds:e.map(function(e){return e.getOccurencePath()}),data:{expandLevel:-1},FBIProxy:s.options.FBIProxy,timeout:t.getSetting("webapi_timeout")};s._getExpandFunc(!1)(r).then(function(t){let a=i.data.jsonParse(t);n.refresh({roots:e,treeDoc:s,FBIProxy:s.options.FBIProxy,wsResponse:a,expandLevel:-1}).then(function(){s.isGroupingApplied()&&s.__applyGrouping({roots:e,groups:s.options.groups}),o()})}).catch(function(e){a(e)})})},_getAuthoringFlag:function(){return e.determineAuthoredFlag()}},o}),define("DS/ENOPAD_v2/commands/edit/_Copy",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.copy()}}}),define("DS/ENOPAD_v2/utils/PADBulkEdit",["css!DS/ENOPAD_v2/ENOPAD_v2","UWA/Core","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/UIKIT/Mask","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt"],function(e,t,n,i,o,s,a,r,d){"use strict";var c="DS/ENOFloatingPanel/ENOFloatingPanel",l=/^\d+$/;const u=["\v","\t","\n","\r","\f","\v"];function p(e){let t=e,n=u.length;for(let e=0;e<n;e++)t=t.replace(u[e],"");return t}function g(e,t){return parseInt(e.valueItem)-parseInt(t.valueItem)}function f(){var e=document.getElementsByClassName("xnav_component");return e&&1===e.length?e[0]:document.body}var h={cleanStr:p,execute:function(e){var i=e.padcomponent,r=i.getPADDGVView().options,c=r.dgv,l=i.getPADTreeDocument(),u=i.getSelectedNodes(),g=e.cellInfos,f=c.getColumnOrGroup(g.columnID),v=f.dataIndex,m=d.getSetting("bulkEditPCSLimit");if(u.length>m)a.displayNotification({msg:n.replace(n.get("bulkEditPCSLimitExceeded"),{limit:m}),eventID:"warning"});else{var D=require("DS/ENOPAD_v2/utils/PADDGVDirectEdition");switch(v){case"ds6w:responsible":D.changeOwnerCmd(g);break;case"ds6w:reserved":D.reservedCmd(g);break;case"ds6w:status":D.changeMaturityCmd(g);break;case"ds6wg:EnterpriseExtension.V_PartNumber":D.setThePartNumberCmd(g);break;default:o.mask(c.getContent(),n.checkingRights);for(var P={lIds:[],busIDs:[],relIDs:[],attributes:"true"},_=!1,b=0;b<u.length;b++){var I;v.endsWith("-Instance")?(I=u[b].getRelationID())&&I.length>0&&(_=!0,-1===P.relIDs.indexOf(I)&&P.relIDs.push(I)):(I=u[b].getID(),-1===P.busIDs.indexOf(I)&&P.busIDs.push(I))}if(0===P.busIDs.length&&0===P.relIDs.length)return void o.unmask(c.getContent());s.read({data:P,onComplete:function(e){"string"==typeof e&&(e=p(e));var i=t.is(e,"string")?JSON.parse(e):e;o.unmask(c.getContent());for(var s,d,u=[],m=!1,P=0;P<i.results.length;P++){var b,I=i.results[P];if((b=_?l.getNodesByRelId(I.physicalID):l.getNodesById(I.physicalID)).length){var y=b[0],A=d=D._updateNodeModel(b[0],I,_,r),E=!0;A.isEditable&&y.options.edit.editableColumns[v]&&!1===y.options.edit.editableColumns[v].readOnly&&(E=!1,u.push(I.physicalID)),E?(a.displayNotification({msg:n.replace(n.get("accessrightAttrenoteditable_2"),{attr:f.text,label:b[0].getLabel()}),eventID:"warning"}),delete b[0].options.edit):(m=!0,s=A.editableColumns[v].kind,A.editableColumns[v].maxLength)}}if(m)switch(s){case"integer":case"float":case"string":h.editStringAttribute({cellInfos:g,editableIds:u,model:l,dgv:c,editOptions:d,isInstance:_,colOpt:f});break;case"timestamp":h.editDateAttribute({cellInfos:g,editableIds:u,model:l,dgv:c,editOptions:d,isInstance:_,colOpt:f});break;case"boolean":h.editBoolAttribute({cellInfos:g,editableIds:u,model:l,dgv:c,editOptions:d,isInstance:_,colOpt:f});break;case"enum":h.editEnumAttribute({cellInfos:g,editableIds:u,model:l,dgv:c,editOptions:d,isInstance:_,colOpt:f});break;default:console.error("Unknown kind of attribute")}i.notification&&"ERROR"===i.notification.type&&a.displayNotification({msg:i.notification.message,eventID:"info"})},onTimeout:function(){a.displayNotification({msg:n.accessrightCheckTimeout,eventID:"error"}),o.unmask(c.getContent())},onFailure:function(){a.displayNotification({msg:n.accessrightCheckFailed,eventID:"error"}),o.unmask(c.getContent())}})}}},editStringAttribute:function(e){require([c,"DS/Controls/LineEditor","DS/Controls/Button"],function(i,o,s){var a,r="",d=t.createElement("div",{class:"PADEditModalBody stringEdit"}),c=e.editOptions.editableColumns[e.colOpt.dataIndex].mandatory;c=void 0!==c&&c;var l=e.editOptions.editableColumns[e.colOpt.dataIndex].kind;new o({placeholder:n.enterModification,requiredFlag:c,sizeInCharNumber:e.editOptions.editableColumns[e.colOpt.dataIndex].maxLength}).inject(d).addEventListener("uncommittedChange",function(e){var t=!0;r=e.dsModel.valueToCommit,"integer"===l||"real"===l?t=!isNaN(Number(r)):""===r&&e.dsModel.requiredFlag&&(t=!1),a.disabled=!t});var u=t.createElement("div",{class:"PADEditModalFooter"});(a=new s({label:n.apply,emphasize:"primary",touchMode:!0,disabled:c,onClick:function(){h.updateModelOnServer({model:e.model,cellInfos:e.cellInfos,newValue:r,editableIds:e.editableIds,editOptions:e.editOptions,isInstance:e.isInstance,colOpt:e.colOpt}),p.destroy()}})).inject(u),new s({label:n.cancel,touchMode:!0,onClick:function(){p.destroy()}}).inject(u);var p=new i({className:"PADEditModal stringEdit",title:n.replace(n.get("editAttribute"),{attr:e.colOpt.text}),body:d,footer:u,overlay:!0,closable:!0,animate:!0,resizable:!1,visible:!0,autocenter:!0,events:{onClose:function(){p.destroy()}}});document.addEventListener("keyup",function(e){27===e.keyCode&&p&&(p.destroy(),p=null)}),p.inject(f())})},editDateAttribute:function(e){var i=this;require([c,"DS/Controls/DatePicker","DS/Controls/Button"],function(o,s,a){var r,d,c=t.createElement("div",{class:"PADEditModalBody dateEdit"}),l=new Date(Date.now()),u=e.cellInfos.nodeModel.options.grid[e.colOpt.dataIndex];u&&(l=new Date(u));var p=new s({value:l,timePickerFlag:!0}).inject(c),g=i.buildCancelClosure(e.cellInfos.nodeModel);p.addEventListener("change",function(e){r=e.dsModel.value,d.disabled=!1});var v=t.createElement("div",{class:"PADEditModalFooter"});d=new a({label:n.apply,emphasize:"primary",touchMode:!0,disabled:!0,onClick:function(){require([m],function(t){var n=t.convertDateToStandard(r,!0);h.updateModelOnServer({model:e.model,cellInfos:e.cellInfos,newValue:n.valueDB,editableIds:e.editableIds,editOptions:e.editOptions,isInstance:e.isInstance,colOpt:e.colOpt})}),D.destroy()}});var m="DS/WidgetServices/WidgetServices";d.inject(v),new a({label:n.cancel,touchMode:!0,onClick:function(){g(),D.destroy()}}).inject(v);var D=new o({className:"PADEditModal stringEdit",title:n.replace(n.get("editAttribute"),{attr:e.colOpt.text}),body:c,footer:v,overlay:!0,closable:!0,animate:!0,resizable:!1,visible:!0,autocenter:!0,events:{onClose:function(){g(),D.destroy()}}});document.addEventListener("keyup",function(e){27===e.keyCode&&D&&(g(),D.destroy(),D=null)}),D.inject(f())})},editBoolAttribute:function(e){var i=this;require([c,"DS/Controls/ButtonGroup","DS/Controls/Button"],function(o,s,a){var r,d,c=t.createElement("div",{class:"PADEditModalBody boolEdit"}),l=(new s).inject(c);l.addChild(new a({type:"radio",touchMode:!0,label:n.True,value:!0,displayStyle:"lite-borders",icon:{iconName:"check",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}})),l.addChild(new a({type:"radio",touchMode:!0,label:n.False,value:!1,displayStyle:"lite-borders",icon:{iconName:"wrong",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}})),l.addEventListener("change",function(e){r=e.dsModel.value,d.disabled=!1});var u=i.buildCancelClosure(e.cellInfos.nodeModel),p=t.createElement("div",{class:"PADEditModalFooter"});(d=new a({label:n.apply,emphasize:"primary",touchMode:!0,disabled:!0,onClick:function(){h.updateModelOnServer({model:e.model,cellInfos:e.cellInfos,newValue:r,isBoolean:!0,editableIds:e.editableIds,editOptions:e.editOptions,isInstance:e.isInstance,colOpt:e.colOpt}),g.destroy()}})).inject(p),new a({label:n.cancel,touchMode:!0,onClick:function(){u(),g.destroy()}}).inject(p);var g=new o({className:"PADEditModal boolEdit",title:n.replace(n.get("editAttribute"),{attr:e.colOpt.text}),body:c,footer:p,overlay:!0,closable:!0,animate:!0,resizable:!1,visible:!0,autocenter:!0,events:{onClose:function(){u(),g.destroy()}}});document.addEventListener("keyup",function(e){27===e.keyCode&&g&&(u(),g.destroy(),g=null)}),g.inject(f())})},editEnumAttribute:function(e){var i=this;require([c,"DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/Toggle"],function(o,s,a,r,d){for(var c=e.editOptions.editableColumns[e.colOpt.dataIndex],u=t.createElement("div",{class:"PADEditModalBody PADEditModalBody comboEdit"}),p=function(e){for(var t=0,n=0;n<e.length;n++)l.test(e[n])&&t++;return t===e.length}(c.range),v=[],m=0;m<c.range.length;m++)v.push({labelItem:c.displayRange[m],valueItem:c.range[m]});p&&v.sort(g);var D=i.buildCancelClosure(e.cellInfos.nodeModel),P=new s({elementsList:v,currentValue:c.current,enableSearchFlag:!1}).inject(u),_=t.createElement("div",{class:"PADEditModalFooter"});new a({label:n.apply,emphasize:"primary",touchMode:!0,disabled:!1,onClick:function(){var t=P.value;h.updateModelOnServer({model:e.model,cellInfos:e.cellInfos,newValue:t,editableIds:e.editableIds,editOptions:e.editOptions,isInstance:e.isInstance,colOpt:e.colOpt}),b.destroy()}}).inject(_),new a({label:n.cancel,touchMode:!0,onClick:function(){D(),b.destroy()}}).inject(_);var b=new o({className:"PADEditModal  PADEditModalBody comboEdit",title:n.replace(n.get("editAttribute"),{attr:e.colOpt.text}),body:u,footer:_,overlay:!0,closable:!0,animate:!0,resizable:!1,visible:!0,autocenter:!0,events:{onClose:function(){D(),b.destroy()}}});document.addEventListener("keyup",function(e){27===e.keyCode&&b&&(D(),b.destroy(),b=null)}),b.inject(f())})},buildCancelClosure:function(e){return function(){delete e._updateFromEdit,delete e._editDataIndex,delete e.options.edit}},updateModelOnServer:function(e){var o=[],d=e.colOpt.dataIndex,c="model/bus/";e.isInstance&&(c="model/rel/");for(var l=e.editOptions.editableColumns[d].path,u=e.editOptions.editableColumns[d].selectable,p=0;p<e.editableIds.length;p++){var g={path:c+e.editableIds[p],method:"PATCH",body:[{op:"replace",path:l,value:e.newValue}],queryParams:{select:["physicalid","modified",u]}};o.push(g)}e.model._beginBlockingTransaction(n.updateAttribute),s.update({data:{requests:o},onComplete:function(o){e.model._endBlockingTransaction(),r.setAuthoringState(!0,i.PADSession_disabling_index_authoring);var s=t.is(o,"string")?JSON.parse(o):o;if(!s.results)throw new Error("Invalid update answer");for(var c=e.model,l=0;l<s.results.length;l++){var u,p=s.results[l],f=p.body.physicalid;u=e.isInstance?c.getNodesByRelId(f):c.getNodesById(f);for(var h,v=g.body[0].path,m=Object.keys(p.body),D=[],P=0;P<m.length;P++){var _=m[P];-1!==_.indexOf(v)&&(h=p.body[_]).notification&&D.push(h.notification)}if(p.body.errors&&p.body.errors.length>0)for(P=0;P<p.body.errors.length;P++)D.push(p.body.errors[P]);if(D&&D.length>0)for(P=0;P<D.length;P++)a.displayNotification({msg:D[P].message,eventID:"warning"});else if(p.body.oldInstancePhysicalid){let e={authored:[{modified:p.body.physicalid,previous:p.body.oldInstancePhysicalid}]};c._onRefresh(e)}else if(u&&u.length>0){if(p.body.oldInstancePhysicalid){let e={authored:[{modified:p.body.physicalid,previous:p.body.oldInstancePhysicalid}]};c._onRefresh(e)}c.withTransactionUpdate(function(){for(var t,n=e.editOptions,i=0;i<u.length;i++){var o=u[i];if(!t){t={grid:{}};for(var s=Object.getOwnPropertyNames(n.editableColumns),a=0;a<s.length;a++)if(n.editableColumns[s[a]].selectable&&p.body[n.editableColumns[s[a]].selectable])if("tree"===s[a])t.label=p.body[n.editableColumns[s[a]].selectable].value[0],t.display=t.label,t.oldLabel=t.label;else if(o.options.grid.hasOwnProperty(s[a]))if(p.body[n.editableColumns[s[a]].selectable].value){if(t.grid[s[a]]=p.body[n.editableColumns[s[a]].selectable].value[0],"timestamp"===n.editableColumns[s[a]].kind){var r=require("DS/WidgetServices/WidgetServices").formatDateObj(t.grid[s[a]]);t.grid[s[a]]=r.toUTCString()}}else t.grid[s[a]]="";o.options.grid["ds6w:modified"]&&p.body.modified&&p.body.modified.value&&(t.grid["ds6w:modified"]=p.body.modified.value[0])}o._updateFromEdit&&delete o._updateFromEdit,o._editDataIndex&&delete o._editDataIndex,o.options.edit&&delete o.options.edit,!0===e.isBoolean&&(t.grid[d]=e.newValue[0]),o.updateOptions(t)}}),a.displayNotification({msg:n.attributeModified,eventID:"success"})}}},onFailure:function(){a.displayNotification({msg:n.attributeModificationFailed,eventID:"warning"}),e.model&&e.editableIds.length&&(e.model._endBlockingTransaction(),e.editableIds.forEach(function(t){var n,i=e.model;(n=i.getNodesById(t)?i.getNodesById(t)[0]:i.getNodesByRelId(t)[0])._updateFromEdit&&delete n._updateFromEdit,n._editDataIndex&&delete n._editDataIndex,n.options.edit&&delete n.options.edit}))}})}};return h}),define("DS/ENOPAD_v2/models/mixins/PADDocCfgHook",["DS/PADUtils/PADUtilsServices","DS/PADServices/utils/Iterator"],function(e,t){const n="SUCCESS";function i(){}return i.prototype={subscribeToCfgHook:function(){let i=this;e.subscribeCfgModifyEvent({handler:function(e){let o=e.commandName,s=e.response.results,a=[];switch(o){case"cfgExtendEvolutionEffectivity":(function(e,i){t.iterate(e,function(e){e.status===n&&e.identifier&&i.push(e.identifier)})})(s=e.response.resources,a),a.length&&i.additionalColumnUpdateByModule("CfgEffectivityColumns",{relids:a});break;case"cfgEditEvolution":case"cfgPasteEvolution":!function(e,i){t.iterate(e,function(e){e.status===n&&e.existing&&i.push(e.existing.pid)})}(s,a),a.length&&i.additionalColumnUpdateByModule("CfgEffectivityColumns",{relids:a});break;case"cfgEditConfigurationContext":i.additionalColumnUpdateByModule("CfgConfigurationContextColumn",{pids:e.data.pids});break;case"cfgRevManualComposition":i.additionalColumnUpdateByModule("CfgConfigurationRevisionColumn",{pids:e.data.pids});break;case"cfgReplaceInstantiatedConfigurationByRevision":i.additionalColumnUpdateByModule("CfgProductConfigurationColumn",{relids:e.data.relids});break;default:let r=[];!function(e,i,o){t.iterate(e,function(e){e.status===n&&(e.new?i.push({oldId:e.existing.pid,newId:e.new.pid}):o.push(e.existing.pid))})}(s,r,a),r.length&&i.splitInstance({couples:r,editVariant:!0}),a.length&&i.additionalColumnUpdateByModule("CfgEffectivityColumns",{relids:a})}}})},refreshCfgValues:function(e){this.additionalColumnUpdateByModule("CfgEffectivityColumns",e)}},i}),define("DS/ENOPAD_v2/models/mixins/PADDocRefresh",["DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/Iterator","DS/ENXNav/models/RefreshMask","DS/PADServices/utils/private/TreeDocUpdate","DS/ENXNav/models/NodeUtils","DS/ENXNav/models/SmartNodeOptions","DS/PADUtils/PADSession","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(e,t,n,i,o,s,a,r,d,c,l){function u(){}return u.prototype={refresh:function(){let e=this.getRoots();if(this._getAuthoringFlag()&&this.isGroupingApplied()){let e=this.options.context.features.grouping;e&&e.displayRefreshMessage()}else this._parent({roots:e,isEditor:!0})}},u}),define("DS/ENOPAD_v2/utils/PADDGVDirectEdition",["UWA/Core","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","text!DS/ENOPAD_v2/assets/PADEditInList.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/PADSettingsMgt","DS/UIKIT/Mask","DS/PADUtils/PADWSAccess","DS/PADUtils/PADSession","DS/ApplicationFrame/CommandsManager","DS/PADUtils/views/PADAlert","DS/ENOPAD_v2/utils/PADBulkEdit","DS/PADServices/utils/AttributesMgt"],function(e,t,n,i,o,s,a,r,d,c,l,u){"use strict";var p=["ds6w:type","ds6wg:revision","ds6w:responsible","ds6w:status","ds6w:cadMaster"],g=["ds6w:reserved","ds6w:manufacturable"],f=JSON.parse(n),h=[],v=0,m=[],D=[];const P=["tree","ds6w:description"];var _={editCtxMenuAvailable:function(e,t){var n=_.canColumnBeEditable(e,t);if(!n){var i=e.options.views.datagridview.options.dgv.getColumnOrGroup(t.columnID).dataIndex;-1!==g.indexOf(i)&&(n=!0)}return n},canColumnBeEditable:function(e,t,n){var i=!1,o=e.options.views.datagridview.options.dgv,s=!0===n?t:o.getColumnOrGroup(t.columnID),a=s.dataIndex;if(!0===s.isAdditionalColumn)i=!1;else if(u.isAttributeColumn(a)||"ds6w:label_Instance"===a){if(-1!==p.indexOf(a))i=!1;else if(-1!==g.indexOf(a))i=!0;else if(-1!==f.editableColumnsDataIndex.indexOf(a)&&"inline"===f.editBehavior[a].mode)i=!0;else if(!0===u.isAttributeColumn(a)&&(-1!==a.indexOf("ds6wg:")||-1===a.indexOf("ds6w"))&&-1===f.editableColumnsDataIndex.indexOf(a)){i=!0;var r=a.split(":"),d=(r=r[r.length-1].split("."))[r.length-1];f.editableColumnsDataIndex.push(a),f.editableColumnsAttribute.push(d),f.editBehavior[a]={mode:"inline",attribute:d}}}else i=!1;return i},editCell:function(n){var i=this,o=n.context.options.views.datagridview.options.dgv,r=n.context.options.views.datagridview.options.dgvLayout,d=o.getColumnOrGroup(n.cellInfos.columnID).dataIndex,u=n.cellInfos,p=(n.context,u.nodeModel);switch(u.dataIndex=d,d){case"ds6w:responsible":_.changeOwnerCmd(u);break;case"ds6w:reserved":_.reservedCmd(u);break;case"ds6w:status":_.changeMaturityCmd(u);break;case"ds6wg:EnterpriseExtension.V_PartNumber":_.setThePartNumberCmd(u);break;default:var g={lIds:[p.getID()],attributes:"true"},f=r.getColumnTypeRepresentation(u.columnID),h=!1;if(u.dataIndex.endsWith("-Instance")){if(!u.nodeModel.options.relationid)return;g.lIds=[u.nodeModel.options.relationid],h=!0}a.read({data:g,onComplete:function(s){"string"==typeof s&&(s=l.cleanStr(s));var a=e.is(s,"string")?JSON.parse(s):s;if(console.log("Edit attribute ["+d+"] of type:["+f+"]"),!a.results)throw new Error("Invalid read WS response: no Results");if(a.results.length!==g.lIds.length)throw new Error("Invalid read WS response: Incoherent answer");i._updateNodeModel(u.nodeModel,a.results[0],h,n),o.getColumnOrGroup(n.cellInfos.columnID).getCellEditableState=function(e){var t=!1;if(e.nodeModel){var n=e.nodeModel.getID();m[n]&&m[n].editableColumns[d]&&!1===m[n].editableColumns[d].readOnly&&(t=!0)}return t};var r=u.nodeModel.getID();D[r]||(D[r]={displayNotif:!1}),u.nodeModel.options.edit.editableColumns[d]&&!1===u.nodeModel.options.edit.editableColumns[d].readOnly?(o.setCellInEdition(n.cellInfos.cellID),D[r].displayNotif=!1):D[r].displayNotif||(D[r].displayNotif=!0,c.displayNotification({msg:t.editionNotSupported,eventID:"warning"}))},onFailure:function(){s.unmask(o.getContent()),c.displayNotification({msg:t.accessrightfailed,eventID:"warning"})}})}},reservedCmd:function(e){if(!e.nodeModel.isGroupingNode){var t=e.nodeModel.getReferenceValue("ds6w:reserved"),n="ActionBar_ReserveCmd";!0===("boolean"!=typeof t?function(e){if("string"==typeof e)return"TRUE"===e}(t):t)&&(n="ActionBar_UnreserveCmd");var i=d.getCommand(n);i&&i.begin()}},changeMaturityCmd:function(e){if(!e.nodeModel.isGroupingNode){var t=d.getCommand("MaturityHdr");t&&t.begin()}},setThePartNumberCmd:function(e){var t=d.getCommand("SetThePartNumber");t&&t.begin()},changeOwnerCmd:function(e){if(!e.nodeModel.isGroupingNode){var t=d.getCommand("ActionBar_ChangeOwner");t&&t.begin()}},_updateNodeModel:function(e,t,n,i){var o=e,s=0,a={isEditable:t.modifyAccess,editableColumns:{}},r=i.context.options.views.datagridview.options;for(s=0;s<t.basicData.length;s++){var d=t.basicData[s],c=!0===n?d.name+"-Instance":d.name;-1!==f.editableColumnsAttribute.indexOf(c)&&(a.editableColumns[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(c)]]={mandatory:d.mandatory,readOnly:d.readOnly,maxLength:d.maxlength,path:d.path,selectable:d.selectable,kind:d.type,mode:f.editBehavior[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(d.name)]].mode,command:f.editBehavior[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(d.name)]].command})}for(s=0;s<t.data.length;s++){var l=!1;(d=t.data[s]).range&&(l=!0);c=!0===n?d.name+"-Instance":d.name;if(-1!==f.editableColumnsAttribute.indexOf(c)){var u={mandatory:d.mandatory,readOnly:d.readOnly,maxLength:d.maxlength,path:d.path,selectable:d.selectable,kind:d.type,mode:f.editBehavior[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(c)]].mode,command:f.editBehavior[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(c)]].command};l&&"boolean"!==u.kind&&(u.kind="enum",u.range=d.range.slice(),u.displayRange=d.rangeNLS.slice(),d.value?u.current=d.value[0]:u.current=""),"real"==u.kind&&(u.kind="float"),a.editableColumns[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(c)]]=u}}a.editableColumns["ds6w:reserved"]={mode:f.editBehavior["ds6w:reserved"].mode,commands:f.editBehavior["ds6w:reserved"].commands,readOnly:!1},f.editOptions=a,o.options.edit=a;var p=o.getID();if(m[p]=a,i.cellInfos&&a.editableColumns[i.cellInfos.dataIndex])switch(a.editableColumns[i.cellInfos.dataIndex].kind){case"enum":var g={},D="enum"+v++;if(g[D]={stdTemplate:"enumCombo",semantics:{possibleValues:[],valueType:"enumString"}},a.editableColumns[i.cellInfos.dataIndex].range.forEach(function(e){g[D].semantics.possibleValues.push({value:e})}),-1===h.indexOf(i.cellInfos.dataIndex))if(h.push(i.cellInfos.dataIndex),i.cellInfos)r.dgv.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(g)),r.dgvLayout.setColumnTypeRepresentation(i.cellInfos.columnID,D),r.dgv.getColumnOrGroup(i.cellInfos.columnID).editionPolicy="EditionOnDoubleClick";break;case"boolean":case"timestamp":r.dgv.getColumnOrGroup(i.cellInfos.columnID).editionPolicy="EditionOnDoubleClick"}return a},saveModification:function(n,o){return new Promise(function(s,d){var u=n.options.views.datagridview.options.dgv,p=(n.options.views.datagridview.options.dgvLayout,u.getColumnOrGroup(o.columnID).dataIndex),g=o.nodeModel,h=g.options.edit;h||(h=f.editOptions);var v=h.editableColumns[p].kind,m=h.editableColumns[p].path,D=h.editableColumns[p].selectable,_=g.getID(),b="tree"===p?g.getLabel():g.options.grid[p];if("integer"!=v&&"real"!=v&&"float"!=v||(b=b.toString()),"timestamp"===v){var I=require("DS/WidgetServices/WidgetServices").convertDateToStandard(b,!0);b=I.valueDB}b=l.cleanStr(b);var y="model/bus/"+_;p.endsWith("-Instance")&&(y="model/rel/"+g.getRelationID());var A={path:y,method:"PATCH",body:[{op:"replace",path:m,value:b}],queryParams:{select:["physicalid","modified",D]}};a.update({data:{requests:[A]},onComplete:function(n){var a=e.is(n,"string")?JSON.parse(n):n;if(!a.results||1!==a.results.length){s({message:"Invalid update answer",type:"ERROR"})}for(var d,l=A.body[0].path,u=a.results[0],f=Object.keys(u.body),v=[],m=0;m<f.length;m++){var D=f[m];-1!==D.indexOf(l)&&(d=u.body[D]).notification&&v.push(d.notification)}if(u.body.errors&&u.body.errors.length>0)for(m=0;m<u.body.errors.length;m++)v.push(u.body.errors[m]);if(v&&v.length>0)for(m=0;m<v.length;m++)c.displayNotification({msg:v[m].message,eventID:"warning"}),"ERROR"===v[m].type&&s(v[m]);else if(200!==u.status){s({message:"Invalid update answer",type:"ERROR"})}else{r.setAuthoringState(!0,i.PADSession_disabling_index_authoring);var I,y=g.getTreeDocument();if(u.body.oldInstancePhysicalid){let e={authored:[{modified:u.body.physicalid,previous:u.body.oldInstancePhysicalid}]};y._onRefresh(e)}if(g.isRoot()&&function(e){return-1!==P.indexOf(e)}(p)){let e=y._commandProxy,t={modifiedIds:[_],fetchAnswer:{results:[{attributes:[]}]}};t.fetchAnswer.results[0].attributes.push({name:function(e){let t;switch(e){case"tree":t="ds6w:label";break;default:t=e}return t}(p),value:b}),t.fetchAnswer.results[0].attributes.push({name:"resourceid",value:_});let n=Object.keys(g.options.grid);for(m=0;m<n.length;m++)t.fetchAnswer.results[0].attributes.push({name:n[m],value:g.options.grid[n[m]]});e.updatePreviousContent(t)}"ds6w:label-Instance"===p?(_=u.body.physicalid,I=y.getNodesByRelId(_)):I=y.getNodesById(_),I&&I.length>0&&(y.withTransactionUpdate(function(){var t,n=I.map(function(e){if(e.options.edit)return e.options.edit}).filter(function(e){return void 0!==e})[0];n||(n=h);for(var i=0;i<I.length;i++){var s=I[i];if(!t){t={grid:{}};for(var a=Object.getOwnPropertyNames(n.editableColumns),r=0;r<a.length;r++)if(n.editableColumns[a[r]].selectable&&u.body[n.editableColumns[a[r]].selectable])if("tree"===a[r])t.label=u.body[n.editableColumns[a[r]].selectable].value[0],t.display=t.label,t.oldLabel=t.label,y._triggerTitleUpdate();else if(e.is(s.options.grid[a[r]]))if(u.body[n.editableColumns[a[r]].selectable].value){if(t.grid[a[r]]=u.body[n.editableColumns[a[r]].selectable].value[0],"timestamp"===n.editableColumns[a[r]].kind){var d=require("DS/WidgetServices/WidgetServices").formatDate(t.grid[a[r]]);t.grid[a[r]]=d}}else t.grid[a[r]]="";s.options.grid["ds6w:modified"]&&u.body.modified&&u.body.modified.value&&(t.grid["ds6w:modified"]=u.body.modified.value[0])}if(s._updateFromEdit&&delete s._updateFromEdit,s._editDataIndex&&delete s._editDataIndex,s.options.edit&&delete s.options.edit,!0===o.change&&void 0!==o.nodeModel.options.grid[p]){var c=o.nodeModel.options.grid[p];c="boolean"==typeof c?c:"TRUE"===c.toUpperCase(),t.grid[p]=c}s.updateOptions(t)}}),c.displayNotification({msg:t.attributeModified,eventID:"success"})),s()}},onFailure:function(){g._updateFromEdit&&delete g._updateFromEdit,g._editDataIndex&&delete g._editDataIndex,g.options.edit&&delete g.options.edit,c.displayNotification({msg:t.attributeModificationFailed,eventID:"warning"}),s()}})})}};return _}),define("DS/ENOPAD_v2/views/PADDataGridView",["css!DS/ENOPAD_v2/ENOPAD_v2","DS/ENXNav/views/xNavDataGridView","DS/ApplicationFrame/CommandsManager","DS/ENOPAD_v2/utils/PADDGVDirectEdition","DS/Core/PointerEvents"],function(e,t,n,i,o){"use strict";function s(e){e=Object.assign(e,{doubleClickEvent:{"ds6w:reserved":i.reservedCmd,"ds6w:responsible":i.changeOwnerCmd,"ds6w:status":i.changeMaturityCmd}}),t.call(this,e)}return s.prototype=Object.assign(s.prototype,t.prototype),s.prototype=Object.create(t.prototype),s.prototype.completeCB=function(){var e=this;return new Promise(function(t){var s=e.options.dgv;e.previousValues={},s.addEventListener("preEdit",function(t,n){e.previousValues[n.cellID]=n.cellModel;e.options.context}),s.addEventListener("postEdit",function(t,n){i.saveModification(e.options.context,n).then(function(t){if(t&&"ERROR"===t.type&&t.message)throw new Error(t.message);delete e.previousValues[n.cellID]}).catch(function(t){var i=s.getColumnOrGroup(n.columnID).dataIndex;if("tree"===i)n.nodeModel.setLabel(e.previousValues[n.cellID]);else{var o={grid:{}};o.grid[i]=e.previousValues[n.cellID],n.nodeModel.updateOptions(o),n.nodeModel.setReferenceValue(i,e.previousValues[n.cellID])}delete e.previousValues[n.cellID]})}),s.addEventListener("change",function(t,n){if(-1!==n.columnID&&"boolean"===s.getColumnOrGroup(n.columnID).kind){var o=s.getColumnOrGroup(n.columnID).dataIndex;!0===n.nodeModel.options.grid[o]||"TRUE"===n.nodeModel.options.grid[o]?n.nodeModel.options.grid[o]="TRUE":n.nodeModel.options.grid[o]="FALSE",n.change=!0,i.saveModification(e.options.context,n).then(function(t){if(t&&"ERROR"===t.type&&t.message)throw new Error(t.message);delete e.previousValues[n.cellID]}).catch(function(t){var i=s.getColumnOrGroup(n.columnID).dataIndex;if("tree"===i)n.nodeModel.setLabel(e.previousValues[n.cellID]);else{var o={grid:{}};o.grid[i]=e.previousValues[n.cellID],n.nodeModel.updateOptions(o),n.nodeModel.setReferenceValue(i,e.previousValues[n.cellID])}delete e.previousValues[n.cellID]})}}),s.addEventListener(o.POINTERHIT,function(t,n){if(2===t.multipleHitCount&&!n.isHeader&&n.nodeModel&&-1!==n.columnID&&e.options.context.getEditMode()&&!0!==n.nodeModel.isGroupingNode){if(i.editCtxMenuAvailable(e.options.context,n)){let t={context:e.options.context,cellInfos:n};i.editCell(t)}}}),s.onCopy=function(e){n.getCommand("Copy").begin()},s.onPaste=function(t){s.setUseClipboardFlag(!1);var i=n.getCommand("Paste");i.isEnabled()?i.begin():require(["DS/PADUtils/views/PADAlert","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(t,n){!1===e.options.context.getEditMode()?t.displayNotification({msg:n.edit_mode_disabled,eventID:"warning"}):t.displayNotification({msg:n.must_select,eventID:"warning"})})},s.onCut=function(e){n.getCommand("Cut").begin()},t()})},s.prototype.rowReorder=function(e,t){var n=this;return new Promise(function(i){n.options.dgv.onDropRowHeaderDefault(e,t),i()})},s}),define("DS/ENOPAD_v2/commands/EditInTableCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/ENOPAD_v2/utils/PADDGVDirectEdition"],function(e,t,n,i){"use strict";return t.extend({init:function(e){this._parent(e),this.context=n.get()},currentState:function(){return this.context.getEditMode()?"enabled":"disabled"},isCommandAvailable:function(e){var t=!1;"datagridview"===this.context.getCurrentView()&&(this.context.getSelectedNodes().length>0&&e&&e.params&&e.params.cellInfos&&(t=i.editCtxMenuAvailable(this.context,e.params.cellInfos)));return t},setViewParams:function(e){this.viewParams=e},execute:function(){var e=this;e.viewParams?require(["DS/ENOPAD_v2/utils/PADBulkEdit"],function(t){var n=e.viewParams.cellInfos;e.viewParams=null,t.execute({padcomponent:e.context,cellInfos:n})}):console.warn("View parameters not defined")}})}),define("DS/ENOPAD_v2/models/PADTreeDocumentRefresh",["UWA/Class","UWA/Class/Promise","DS/ENXNav/models/RefreshHandler","DS/ENXNav/utils/TwoDAppEvents","DS/ENOPAD_v2/models/_PADModelParser","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADProgressBar","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,a,r,d,c,l,u,p){"use strict";function g(e){e.options.isNotManagedByPS||e.hasChildren()||(e.childComputed=!1)}var f=e.extend({});if(!0!==a.getSetting("refresh_v2")){f.prototype.refresh=function(e){var f=this,h=[],v=function(t){l.off(),i.refresh(),Array.isArray(t)&&0!==t.length||(t=[{msg:u.refresh_ok}]);for(var n=0;n<t.length;n++){var o=t[n];void 0===e.cb?c.displayNotification(o):e.cb(o)}setTimeout(function(){s.publish({event:"ENXModel/SyncModel",data:{refresh:!0}})},100),f.getModelEvents().publish({event:"titleRecalc"})},m=u.refresh_ongoing;e=e||{},this._clearSortOrders(e);var D=e.roots||this.getRoots();if(D.length>0){e.dispatch&&this._commandProxy.refreshModel(),l.on(m);var P=[],_=[],b=[];if(null!=D&&D.forEach(function(e){if(!0===e.options.filtered)b.push(e);else{for(var t=[],n=[e];n.length;){var i=n.pop();if(null!=i&&!0!==i.isRelationsObjectNode)t.push(i.getOccurencePath()),i.getOccurencePath().forEach(function(e){_.indexOf(e)<0&&_.push(e)}),n=n.concat(i.getChildren())}P.push(t)}}),0===P.length&&0===b.length)v();else{var I=[];if(P.length>0){var y=new t(function(t,i){var s,c={session:P,intent:"explore_2D",expand_iter:"1",debug:a.getSetting("enopad_webapis_debug"),type_filter_bo:a.getSetting("type_filter_bo")};d.refresh({data:c,onComplete:function(i){try{var d=UWA.is(i,"string")?JSON.parse(i):i;if(void 0!==d){if(s=f.startTransaction("refresh"),!0===a.getSetting("supportPgpBasedOnDescription"))new n({app_context:a.app_context,treeDocument:f}).complete(!0);var c=r.determineAuthoredFlag(),l=!1;c&&(l=!0),o.process.expand({treedocument:f,root_nodes:D,starting_from_root:d.full_path,response:d,mode:"refresh",needNewStructure:l,expand_level:c?1:-1,security_counts_HTML:null}),c&&function(e){for(var t=e.getRoots(),n=0;n<t.length;n++){var i=t[n];g(i),i.processDescendants({processNode:function(e){g(this)}})}}(f),e&&e.datagrid&&!e.datagrid.isClearSortEnabled()&&f.sortInTreeOrder(D),f.invalidateViewPort(),s&&s.end()}t()}catch(e){var u="Exception thrown during the process of the refresh answer "+e.toString();h.push({msg:u,eventID:"error"}),t()}},onFailure:function(e){h.push({msg:p.generic_service_failure,eventID:"error"}),t()}})});I.push(y)}b.length>0&&I.push(f.doRefreshCV(b,!1)),t.all(I).then(function(){v(h)})}this.withTransactionUpdate(function(){for(var e=UWA.clone(D,!1);e.length;){var t=e.pop();null!=t&&(!0===t.options.isPADHiddenFromServer&&delete t.options.isPADHiddenFromServer,t.isSelected()&&t.unselect(),e=e.concat(t.getChildren()))}})}}}return f}),define("DS/ENOPAD_v2/utils/PADCtxMenuUtils",["i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADClipboard","DS/PADUtils/PADSettingsMgt","DS/ENXNav/utils/CtxMenuUtils","DS/ENOPAD_v2/utils/PADDGVDirectEdition"],function(e,t,n,i,o,s){"use strict";var a={CUT:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_Cut.png")+")",COPY:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_Copy.png")+")",PASTE:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_Paste.png")+")",RENAME:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_Rename.png")+")",RESETPOS:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_ResetPosition.png")+")",COPYRELPOS:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_CopyPosition.png")+")",COPYABSPOS:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_CopyPosition.png")+")",PASTEPOS:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_PastePosition.png")+")"};return{enrichCtxMenu:function(){o.ccpMenu=function(t,i,s){if(i.push({type:"SeparatorItem"}),i.push({type:"PushItem",title:e.PAD_CMDCopy,icon:a.COPY,state:t.getEditMode()?"enabled":"disabled",action:{this:t,context:s,callback:function(){o.launchCommand({context:t,command:"Copy"})}}}),i.push({type:"PushItem",title:e.PAD_CMDCut,icon:a.CUT,state:t.getEditMode()?"enabled":"disabled",action:{this:t,context:s,callback:function(){o.launchCommand({context:t,command:"Cut"})}}}),!1===n.isEmpty()){var r=t.getPADTreeDocument().getXSO().get();r&&r.length>0&&i.push({type:"PushItem",title:e.PAD_CMDPaste,icon:a.PASTE,state:t.getEditMode()?"enabled":"disabled",action:{this:t,context:s,callback:function(){o.launchCommand({context:t,command:"Paste"})}}})}},o.psePositionCtxCmd=function(t,o){var s,r,d={available:!1,menu:[]};if(o.collectionView?(s=o.cellInfos.nodeModel,r=o.cellInfos):(s=o.treeview.nodeModel?o.treeview.nodeModel:o.treeview.cellModel,r=o.treeview.cellView.getCellInfos()),!1===s.isRoot()&&!0===i.getSetting("ActivateCCPPosition")){d.available=!0;for(var c=t.getSelectedNodes(),l=!1,u=0;u<c.length&&!1===l;u++)c[u].options.grid["positionMatrix-Instance"]&&(l=!0);l&&(d.menu.push({type:"PushItem",title:e.PAD_CMDResetPosition,icon:a.RESETPOS,state:t.getEditMode()?"enabled":"disabled",action:{this:this,context:{node:s,cellInfos:r},callback:function(e){t.resetPosition()}}}),1===c.length&&d.menu.push({type:"PushItem",title:e.PAD_CMDCopyRelativePosition,icon:a.COPYRELPOS,state:t.getEditMode()?"enabled":"disabled",action:{this:this,context:{node:s,cellInfos:r},callback:function(e){console.warn("Need to calculate the absolute matrix");var t={matrix:e.context.node.options.grid["positionMatrix-Instance"]};n.setData(n.POSITION,t)}}})),!1===n.isEmpty(n.POSITION)&&("VPMInstance"===s.options.relationtype||""===s.options.relationtype&&"3DShape"!==s.options.type&&"Drawing"!==s.options.type)&&d.menu.push({type:"PushItem",title:e.PAD_CMDPastePosition,icon:a.PASTEPOS,state:t.getEditMode()?"enabled":"disabled",action:{this:this,context:{node:s,cellInfos:r},callback:function(e){t.pastePosition()}}}),0===d.menu.length&&d.menu.push({type:"PushItem",title:e.PAD_CMDNoPositionAction,state:"disabled"})}return d},o.pseTreeMenu=function(t,n,o,r,d){if(!0===i.getSetting("activateEditInCtxMenu")&&!0===i.getSetting("activateEditInTable")){var c=!1;if("treelistview"===d?c=t.getPADTreeListView().canColumnBeEditable(r):"datagridview"===d&&(c=s.editCtxMenuAvailable(t,r)),!0===c)t.options.model.getSelectedNodes().length>1&&!0===i.getSetting("activateBulkEditEdit")?n.push({type:"PushItem",title:e.PAD_CMDRename,icon:a.RENAME,state:t.getEditMode()?"enabled":"disabled",action:{this:t,context:{node:o,cellInfos:r,view:d},callback:function(e){if("datagridview"===e.context.view){var t=this;require(["DS/ENOPAD_v2/utils/PADBulkEdit"],function(e){e.execute({padcomponent:t,cellInfos:r})})}else{var n=this.getPADTreeListView(),i=e.context.cellInfos.cellModel.getView();i&&(n.activateWriteMode(i.getCellInfos()),n.giveFocus())}}}}):n.push({type:"PushItem",title:e.PAD_CMDRename,icon:a.RENAME,state:t.getEditMode()?"enabled":"disabled",action:{this:t,context:{node:o,cellInfos:r,view:d},callback:function(e){if("datagridview"===e.context.view)s.editCell({context:this,cellInfos:e.context.cellInfos});else{var t=this.getPADTreeListView(),n=e.context.cellInfos.cellModel.getView();n&&(t.activateWriteMode(n.getCellInfos()),t.giveFocus())}}}})}}}}}),define("DS/ENOPAD_v2/PADComponent",["DS/ENXNav/XNavComponent","DS/PADUtils/PADSession","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENOPAD_v2/mixins/_PADCCP","DS/ENOPAD_v2/mixins/_PADFolder","DS/ENOPAD_v2/mixins/_PADDnD","DS/ENOPAD_v2/mixins/_PADRefresh","DS/ENXNav/mixins/xNavChangeAction","DS/ENOPAD_v2/utils/PADCtxMenuUtils","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalUtils","DS/ENOPAD_v2/features/Grouping"],function(e,t,n,i,o,s,a,r,d,c,l,u,p){"use strict";return t.softInit(),e.extend(i,o,s,a,r,{name:"pad_component",init:function(e){var t,n,i=(t=e,(n={x3dAppId:"ENOPAD",widget:widget,amd_custo:{TreeDocument:"DS/ENOPAD_v2/models/PADTreeDocument",TileGridView:"DS/ENXNav/views/xNavResponsiveTilesView",ThumbnailGridView:"DS/ENXNav/views/xNavResponsiveThumbnailsView",DataGridView:"DS/ENXNav/views/xNavDataGridView"},layout:{}}).layout=UWA.clone(t.layout_opts),delete(n=UWA.extend(n,t,!0)).layout_opts,n),o=Promise.resolve();i.configuration&&!0===i.configuration.dynamicCtxActivated?o=new Promise(function(e){require(["DS/ENOPAD_v2/utils/PADCtxMenuUtilsV2"],e)}):d.enrichCtxMenu(),(l.getSetting("activateGrouping")||"true"===u.getURLParameter("activateGrouping"))&&(this.features={},this.features.grouping=new p({context:this}));var s=this._parent.bind(this);o.then(function(){this.setFolderCommunicationChannel(),require(["UWA/Utils/Client"],function(t){!1!==i.layout.action_bar&&(e.settings.action_bar.touch&&e.settings.action_bar.standard?i.action_bar_opts=t.Features.touchEvents&&!t.Features.pointerEvents?e.settings.action_bar.touch:e.settings.action_bar.standard:i.action_bar_opts=e.settings.action_bar,i.action_bar_opts.language=e.lang),s(i)})}.bind(this))},displayConfirmationOnRemove:function(){var e=require("DS/PADUtils/PADSettingsMgt");return e.getSetting("addRemoveMessagePreference")?e.getSetting("displayConfirmationOnRemove"):void 0},getPADTreeListView:function(){return this.options.views.treelistview},getPADDGVView:function(){return this.options.views.datagridview},getPADTileGridView:function(){return this.options.views.tileview},getPADThumbnailGridView:function(){return this.options.views.thumbnailview},getPADTreeGraph:function(){return this.options?this.options.views.graphview:null},getEditMode:function(){return require("DS/PADUtils/PADSettingsMgt").getSetting("EditModeActivated")},setEditMode:function(e){require("DS/PADUtils/PADSettingsMgt").setSetting("EditModeActivated",e,!0),this.dispatchEvent("editModeModified",e)},add:function(e,t,n){e.content||(e.content="idslist"),void 0===t&&e.callback&&(t=e.callback),void 0===n&&(n=e.broadcast),e.callback=function(e,n){t&&t(e,n)},e.broadcast=n,this._parent(e)},addRootNodes:function(e){if(!UWA.is(e,"array"))throw new Error("nodes parameter must be an array");var t=[];this.dropInvitContainer.hide();var n=this.options.model;n&&n.wrapInTransaction(function(){n.withTransactionUpdate(function(){n.addRoot(e);for(var i=0;i<e.length;i++)t.push(e[i].getID());n.getRoots().length;UWA.is(n.detachedRoots,"array")&&n.detachedRoots.length,n.getModelEvents().publish({event:"onRootAdded",data:{nb_root:n.getRoots().length,added_node:e[n.getRoots().length-1]}})})});var i={pids:t};this._commandProxy.drop(i)},addNodesFromContent:function(e,t,n,i){var o=this;require(["DS/PADUtils/PADTypesMgt"],function(s){s.retrieveAuthorizedObjects({version:"2.0",X3DContentId:e,callback:function(e){e.authorizedWithKind?(e.authorizedWithKind.Product&&e.authorizedWithKind.Product.length>0&&o.add({content:"3DXContent",authorized_objects:e.authorizedWithKind.Product,callback:t,behavior:n}),e.authorizedWithKind.Filter&&e.authorizedWithKind.Filter.length>0&&o.addFilter({content:"3DXContent",filter_objects:e.authorizedWithKind.Filter,callback:t,behavior:void 0}),e.authorizedWithKind.Change&&e.authorizedWithKind.Change.length>0&&o.loadChange&&o.loadChange({content:"3DXContent",objects:e.authorizedWithKind.Change,callback:t,behavior:n})):o.add({content:"3DXContent",authorized_objects:e.authorized_objects,behavior:n},t,i)}})})},getOrdering:function(e){return this.options.model.getOrdering(e)},replaceNodes:function(e){console.time("replaceNodes");var t,n,i,o,s,a=this,r=[],d={},c=[],l=[];e.toDelete&&(e.toDelete.forEach(function(e){r.push(e.physicalid)}),t=e.toDelete,s=0,t.forEach(function(e){(n=a.getPADTreeDocument().getNodesByRelId(e.physicalid))&&n.forEach(function(t){if(t){var n=t.getParent();if(n){l.push(n);var a=n.getOccurencePath();if(a){c.push(a),i=t.isExpanded(),o=t.options.padstate;var r={};i&&(s=function e(t){if(!t.hasChildren())return t.getDepth();var n=1;return t.getChildren().forEach(function(t){var i=e(t);i>n&&(n=i)}),n}(t)-t.getDepth(),s=parseInt(s),e.newrelid&&(r[e.newrelid]={isExpanded:i,padState:o,expandLevel:s},a=a.join("_"),d[a]?d[a].push(r):d[a]=[r]))}}}})}));var u={};e.callack=function(){u.detach={deleted:r},a._commandProxy.padRefresh(u)},e.callback2=function(t){try{console.timeLog("replaceNodes"),a.processPathExpand(t,d),console.timeEnd("replaceNodes")}catch(e){console.error("error",e)}finally{var n,i;if(r.length>0)for(var o=0;o<r.length;o++)if((n=a.getPADTreeDocument().getNodesByRelId(r[o]))&&n.length>0){i=!0;break}if(i){console.count("needCleanUp");var s={deleted:e.toDelete};a.refreshView(s)}}},e.occurencePaths=c,e.parentNodes=l,this.options.model.insertNodesSplitFetch(e)},processPathExpand:function(e,t){var n=this,i=Object.keys(t);if(0!==i.length){var o,s,a,r,d=e.expandNodeIds;if(d&&0!==d.length)d.forEach(function(e){i.forEach(function(i){s=t[i],i=i.split("_"),a=n.getPADTreeDocument().getNodeByOccurencePath(i),s&&a&&s.forEach(function(t){(o=t[e])&&o.isExpanded&&0!==o.expandLevel&&a.getNodesByRelId(e).forEach(function(e){e.isExpanded()||(r={numberOfLevelsToExpand:o.expandLevel},e.expandNLevels(r))})})})})}},insertNodes:function(e){var t=this.options.model.insertNodes(e);"graphview"===this.options.active_view&&(this.options.views.graphview.reframeAll(),this.dropInvitContainer&&this.dropInvitContainer.hide());var n=t.map(function(e){return e.getOccurencePath()});this.dispatchEvent("onAddPaths",{addedPaths:n}),require(["DS/ENXNav/utils/TwoDAppEvents"],function(e){e.addRoot()})},author:function(e){t.setAuthoringState(e,n.PADSession_disabling_index_authoring)},setDnDBehavior:function(e){this.options.model.setDnDBehavior(e)},setConfirmdDialog:function(e){this.options.model.setConfirmdDialog(e)},displayNotification:function(e){require(["DS/PADUtils/views/PADAlert"],function(t){t.displayNotification(e)})},broadcastSelect:function(e){this.options.model.broadcastSelect(e)},getSelectedNodes:function(){return this.options.model.getSelectedNodes()},getActiveView:function(){return this.options?this.options.active_view:"treelistview"},refreshView:function(e){var t,n={updateRevision:[]},i=this,o=Promise.resolve(),s=e.modified;s&&((t={}).modified=s);var a,r,d,l=e.created;l&&(t||(t={}),t.created=[],l.forEach(function(e){if(e.sourceObjectId){e.operation&&"Revise"===e.operation&&(a={existing:e.sourceObjectId,new:e.physicalid,newRevison:"Z.8"},n.updateRevision.push(a));var s=i.getPADTreeDocument().getNodesById(e.sourceObjectId);if(s&&s.length>0)for(var r=0;r<s.length;r++){var d=s[r],l=[];l.push({type:d.options.type}),o=new Promise(n=>{c.isTypesAuthorized(l,function(i){i.length>0&&-1===t.created.indexOf(e.physicalid)&&t.created.push(e.physicalid),n()})})}}else t.created.push(e.physicalid)}));var u=e.deleted;(u&&u.forEach(function(e){var t=e.physicalid,n=i.getPADTreeDocument().getNodesById(t);n&&0!==n.length||(n=i.getPADTreeDocument().getNodesByRelId(t)),n.forEach(function(e){e.isRoot()?(r||(r=[]),r.push(t)):(d||(d=[]),d.push(e))})}),o.then(function(){if(t){t.created&&t.created.length&&(t.onAddPaths=function(e){i.dispatchEvent("onAddPaths",{addedPaths:e}),require(["DS/ENXNav/utils/TwoDAppEvents"],function(e){e.addRoot()})});for(var e=0;e<t.modified.length;e++){var n=i.getPADTreeDocument().getNodesById(t.modified[e].physicalid);0===n.length&&(n=i.getPADTreeDocument().getNodesByRelId(t.modified[e].physicalid),t.modified[e].attributes&&((t.modified[e].attributes[0].name="ds6w:reserved")&&(t.modified[e].attributes[0].name="ds6w:reserved-Instance"),(t.modified[e].attributes[1].name="ds6w:reservedBy")&&(t.modified[e].attributes[1].name="ds6w:reservedBy-Instance")))}i.getPADTreeDocument().refreshNodeById(t)}}),d&&this.getPADTreeDocument().deleteNodes(d),r)&&(this._onRemoveRoot({pids:r}),r.length&&require("DS/PADServices/utils/GlobalModelEvents").publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:r}}));n.updateRevision.length&&this.getPADTreeDocument().updateRevision(n)},refreshInstance:function(e){if(e&&e.modified&&e.created){for(var t,n={},i=0;i<e.modifed.length;i++)t={oldId:e.modified[i].physicalid,newId:e.created[i].physicalid},coulples.push(t);n.coulpes=[],n.cb=e.cb,this.getPADTreeDocument().splitInstance(n)}else console.warn("refreshInstance: no input")},_dispatchReady:function(e){!0===this.options.isReady.model&&!0!==this.options.isReady.PADmodel&&(this._buildENOPADModel(),this.options.isReady.PADmodel=!0),!0===this.options.isReady.model&&this._probes.probe_model.end(),!0===this.options.isReady[this.options.active_view]&&this._probes.probe_view.end(),!0===this.options.isReady.actionbar&&this._probes.probe_actionbar&&this._probes.probe_actionbar.end(),!0===this._dispatchReady_NotDone&&!0===this.options.isReady.model&&!0===this.options.isReady.actionbar&&!0===this.options.isReady[this.options.active_view]&&(this.dispatchEvent.call(this,"onReady",{addInView:e}),this.dispatchEvent("onActionBarReadyToBuild"),this._probes.probe_init.end(),this._dispatchReady_NotDone=!1)},setKeyboardListenerOnGraph:function(){var e=this;e._keyboardListener||require(["DS/ENOPAD_v2/mixins/_PADKBInput"],function(t){e._keyboardListener=new t({component:e}),e._keyboardListener.startObservingKeyboard(e.options.views.graphview.elements.container)})},_buildENOPADModel:function(){var e=this;e.getContent().addEventListener("dragleave",function(t){var n=t.relatedTarget,i=n?n.className:" ";if(!(!i||-1===i.indexOf("paddnd_invite")))return t.preventDefault(),t.stopPropagation(),!1;e.dropInvitContainer&&e.dropInvitContainer.hide(),0===e.options.model.getRoots().length&&e.dropInvitContainer.show("drop")},!1)},destroy:function(){this._parent()}})}),define("DS/ENOPAD_v2/models/PADDocTree",["UWA/Core","DS/ENXNav/models/xNavTreeDoc","DS/ENXNav/models/xNavNodeModel","DS/ENXNav/utils/OFW","DS/ENXNav/utils/TwoDAppEvents","DS/ENOPAD_v2/models/PADTreeDocumentRefresh","DS/PADServices/utils/AttributesMgt","DS/PADServices/utils/CompassUtils","DS/ENOXParser/modules/common/Constants","DS/ENOPAD_v2/models/_PADModelParser","DS/ENOXParser/modules/ClientDataParser","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPredicatesNls","DS/PADUtils/PADUtilsServices","DS/PADUtils/views/PADAlert","DS/PADUtils/utilsWS/WSUtils","DS/ENOPAD_v2/models/mixins/PADDocInserts","DS/ENOPAD_v2/models/mixins/PADDocRefresh","DS/ENOPAD_v2/models/mixins/PADDocProxy","DS/ENOPAD_v2/models/mixins/PADDocCfgHook","DS/ENOPAD_v2/models/mixins/PADDocSupport","DS/PADServices/utils/Generics","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,a,r,d,c,l,u,p,g,f,h,v,m,D,P,_,b,I,y,A,E){"use strict";function N(){}return N.prototype=Object.assign(N.prototype,D.prototype),N.prototype=Object.assign(N.prototype,P.prototype),N.prototype=Object.assign(N.prototype,I.prototype),N.prototype=Object.assign(N.prototype,_.prototype),N.prototype=Object.assign(N.prototype,b.prototype),t.extend(N,{_active_cutting_nodes:[],init:function(t){var n=u.getSetting("activateEditInTable");!0!==n||e.is(t.shouldBeEditable)||(t.shouldBeEditable=function(e){return!0},t.shouldBeSelected=function(e){return!e.ghostMode}),this._parent(t);var i=this;this._commandProxy=this._cmdProxy,!0===n&&!0!==u.getSetting("activateDGV")&&require(["DS/ENOPAD_v2/mixins/_PADEditInLst"],function(e){i.onNodeModelUpdate(e.onNodeModelUpdate.bind(i))}),this._commandProxy&&this._appendToCommandProxy(),this.subscribeToCfgHook()},broadcastSelect:function(e){this._broadcastSelect=e,!0===this._broadcastSelect&&!0===this.options.authorize_setStructure&&(r.setObject({nodes:this.getSelectedNodes()}),i.setTypesForOFW(this))},setDnDBehavior:function(e){this._copyMode=e},setConfirmdDialog:function(e){this._confirmDialog=e},setCuttingNodes:function(e){this._active_cutting_nodes=e},instantiate:function(t,i,o){let s=t.updatePids||[];var a=t.instanceName?t.instanceName:"",r=o?o.newRelationIDs:[],c=o?o.tgtParentIds:[],l=o?o.removedNodeIds:[],u={},g=i||[],f=t.node,h=t.parent,v=t.behavior,m=t.newRelationID,D=t.ordering,P=h.getID(),_=e.clone(f.options,!1);let b="MOVE"===t.behavior;"COPY"===t.behavior&&(_.childComputed=!1);var I=e.clone(f.options.grid,!1);_.grid=I,b&&!_.children&&(_.children=[],_.childComputed=!1);var y=f.getRelationID(),A=f.options.relationtype,N=!Boolean(y),S=f.getParent()?f.getParent().getID():"",C=this.getRoots(),x=!1,O=this;!!!D&&N||"COPY"===v||(C.forEach(function(e){var t=[];g&&0!==g.length?-1!==g.indexOf(e.getID())?t=e.getNodesByRelId(y):S&&-1!==g.indexOf(S)?t=e.getNodesByRelId(y):c.length>0?-1===c.indexOf(e.getID())&&(r.length>0?-1===r.indexOf(y)&&(t=e.getNodesByRelId(y)):t=e.getNodesByRelId(y)):t=e.getNodesByRelId(y):t=e.getNodesByRelId(y),t.length>0&&t.forEach(function(e){var t=e.getParent();e.isRoot()||(g&&0!==g.length?-1!==g.indexOf(t.getID())&&t.removeChild(e):t.removeChild(e))})}),f.setRelationID(m,A));var w=function(t,n,i){if(n&&n.before&&""!==n.before){var o,s=t.getChildren();for(o=0;o<s.length;o++){var a=s[o];if(a.options.relationid===n.before){try{t.insertBefore(i,a),x=!0}catch(e){throw console.log(e),e}break}}}e.is(t.options.relcount,"number")||(t.options.relcount=0),t.options.relcount=t.options.relcount+1,x||t.addChild(i),b&&t.setState(d.NODE_STATES.PARTIALLY_EXPANDED)};C.forEach(function(i){N&&l.length>0&&-1!==l.indexOf(i.getID())&&(u[i.getID()]=!0);var o=i.getNodesById(P);o&&0!==o.length&&o.forEach(function(i){if(i===h||i.isExpanded()||null===i.options.children||0===i.options.children.length){if(N||"COPY"===v||i!==h){var o=e.clone(f.options,!1);("COPY"===t.behavior||b)&&(o.childComputed=!1);var s=e.clone(f.options.grid,!1);(e.is(o.relcount,"number")&&o.relcount>0||e.is(o.children,"array")&&o.children.length>0)&&(o.children=[]),g&&-1===g.indexOf(i.getID())?(s.CurrentEvolutionEffectivity="",s.Effectivity="",s.ProjectedEvolutionEffectivity="",s.VariantEffectivity=""):"COPY"===v&&(s.CurrentEvolutionEffectivity="",s.Effectivity="",s.ProjectedEvolutionEffectivity="",s.VariantEffectivity=""),a&&(s.instanceName=a),o.grid=e.clone(s,!1);var r=new n(o),d=o.relationtype;(N||"COPY"===v||c&&c.length>1)&&r.setRelationID(m,d),w(i,D,r)}else if(c&&c.length>1){var l=e.clone(_,!1),u=O.createNodeModel(l),p=f.options.relationtype;u.setRelationID(m,p),w(i,D,u)}else w(i,D,f);i.isExpanded()||i.options.padstate&&"partiallyExpanded"===i.options.padstate||(i.setState({state:"partiallyExpanded"}),i.options.padstate="partiallyExpanded")}else console.log("**3 =========",i)})}),h.isExpanded()||h.options.padstate&&"partiallyExpanded"===h.options.padstate||(h.setState({state:"partiallyExpanded"}),h.options.padstate="partiallyExpanded"),p.setAuthoringState(!0,E.PADSession_disabling_index_authoring),N&&"COPY"!==v&&(0===l.length?this.removeRoot(f):u[f.getID()]&&this.removeRoot(f)),this.invalidateViewPort(),s.length&&O.refreshNodeById({modified:s})},_distinguishInsertReparentCases:function(e){var t={insertExisting:[],reparent:[]},n=this._copyMode;return e.forEach(function(e){!e.getRelationID()||"COPY"===n?t.insertExisting.push(e):t.reparent.push(e)}),t},_inputData:function(e,t){var n=[];return e.forEach(function(e){n.push(e.getOccurencePath())}),{children:n,parents:[t.getOccurencePath()],commit:!0}},_onInsert:function(t,n,i){var s=this._copyMode;"function"==typeof n.getID&&n.getID();var a=this;function r(e,t){var n;for(n=0;n<e.length;n++){var i=e[n];if(i.options.resourceid===t)return i}return null}function d(e){var d;let u=[];for(d=0;d<e.length;d++){var p=e[d].relationid,g=e[d].resourceid,f=r(t,g),h=e[d].instanceName||"";let v=e[d].clientTaskData;if(!f)return void c();if(v){new l(v).appendPids(u)}var m={node:f,parent:n,next:i,behavior:s,newRelationID:p,instanceName:h},D=(f.getID(),n.getID()),P=f.getRelationID(),_=!Boolean(P);a._endBlockingTransaction(),a.wrapInTransaction(function(){a.withTransactionUpdate(function(){a.instantiate(m);var e={transactions:[]},t=a.getNodesByRelId(p)[0].getOccurencePath();_||"COPY"===s?e.transactions.push({insertExisting:{modified:[D],inserted:[t],created:[p],withContext:!_}}):e.transactions.push({reParent:{modified:[D],inserted:[t],created:[p],deleted:[P]}}),a._commandProxy.padRefresh(e),o.addChild()},a)})}u.length&&a.refreshNodeById({modified:u}),v.displayNotification({msg:A.insert_existing_succeeded,eventID:"info"})}function c(t){if(a._endBlockingTransaction(),t&&e.is(t.messages,"array")){var n=[];t.messages.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),v.displayNotification({msg:n.join(""),eventID:"error"})}a.dropInvitContainer&&a.dropInvitContainer.hide()}function u(e){var d;let c=[];for(d=0;d<e.length;d++){var u=e[d].relationid,g=e[d].resourceid,f=r(t,g),h=e[d].instanceName||"";let b=e[d].clientTaskData;if(b){new l(b).appendPids(c)}if(!f)return void p();try{var m={node:f,parent:n,next:i,behavior:s,newRelationID:u,instanceName:h},D=(f.getID(),n.getID()),P=f.getRelationID(),_=!Boolean(P);a._endBlockingTransaction(),a.wrapInTransaction(function(){a.withTransactionUpdate(function(){a.instantiate(m);var e={transactions:[]},t=a.getNodesByRelId(u)[0].getOccurencePath();_?e.transactions.push({insertExisting:{modified:[D],inserted:[t],created:[u],withContext:!_}}):e.transactions.push({reParent:{modified:[D],inserted:[t],created:[u],deleted:[P]}}),a._commandProxy.padRefresh(e),o.addChild()},a),v.displayNotification({msg:A.reparent_succeeded,eventID:"info"})})}catch(e){a._endBlockingTransaction(),v.displayNotification({msg:E.generic_service_failure,eventID:"error"})}}c.length&&a.refreshNodeById({modified:c})}function p(t){if(a._endBlockingTransaction(),t&&e.is(t.messages,"array")){var n=[];t.messages.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),v.displayNotification({msg:n.join(""),eventID:"error"})}}var g=a._distinguishInsertReparentCases(t);return g.insertExisting.length>0&&(this._beginBlockingTransaction(A.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,data:a._inputData(t,n),onSuccess:d,onFailure:c})})),g.reparent.length>0&&(this._beginBlockingTransaction(A.reparenting),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CutPaste",internal_call:!0,data:a._inputData(t,n),onSuccess:u,onFailure:p})})),!1},getOrdering:function(e){var t={};if(!e)return ordering;var n,i,o,s=-1,a=-1,r=-1;return e.forEach(function(e){var d={};(n=e.getParent().getChildren())&&n.length>1&&((s=n.indexOf(e))>-1&&(a=s-1,r=s+1),o=n[a],i=n[r],d.after=o?o.getRelationID():"",d.before=i?i.getRelationID():"",t[e.getRelationID()]=d)}),t},getFetches:function(t){var n=e.clone(t,!1);return n.cbOnProcess=function(e,t){var n={intent:"explore_2D",debug:u.getSetting("enopad_webapis_debug")},i={enopad_webapis:u.getSetting("enopad_webapis"),data:n,pids:t,onComplete:function(n){var i="string"==typeof n?JSON.parse(n):n;if(i.results)for(var o=0,s=i.results.length;o<s;o++){var a=i.results[o];e.setAnswer(t[o],a)}else console.log("handle error in the future")},onFailure:function(t,n){console.log("getFetches.onFailure"),e.reprocess()}};return g.fetch(i)},new m.MassChunkedRequests(n)},getNavigates:function(t){var n=e.clone(t,!1);return n.cbOnProcess=function(t,n){if(n&&n.length>0){var i=e.extend({root_path_physicalid:n,expand_iter:"1",intent:"explore_2D"},u.getWebAPI_Options("navigate"),!0),o={enopad_webapis:u.getSetting("enopad_webapis"),data:i,onComplete:function(e){var i="string"==typeof e?JSON.parse(e):e;i.results?t.setAnswers(n,i.results):console.log("handle error in the future")},onFailure:function(e,t){console.error("getNavigates.onFailure networkError",e),console.error("getNavigates.onFailure serverError ",t)}};return g.navigate(o)}},new m.MassChunkedRequestsLWC(n)},insertNodesSplitFetch:function(t,n){t.toDelete;var i=t.callack,s=t.callback2,a=t.occurencePaths,r=t.parentNodes,d=t.toInsert,l=this,p=[];function g(e){-1===p.indexOf(e.resourceid)&&p.push(e.resourceid),-1===p.indexOf(e.relationid)&&p.push(e.relationid)}var f=[],h={transactions:[]},m=[],D=[],P=[],_={};function b(){v.displayNotification({msg:E.generic_service_failure,eventID:"error"}),l._endBlockingTransaction()}this.wrapInTransaction(function(){var t,n;if(!0===u.getSetting("useLWCWebServices"))!function(){for(var t=Object.keys(d),n=0;n<t.length;n++){var i=t[n];if(e.is(d[i],"array")){for(var o={insertExisting:{modified:[],inserted:[],created:[]}},s=d[i],a=0,r=s.length;a<r;a++){var c=s[a],u=[i,c.relationid,c.resourceid];-1===m.indexOf(u)&&(f.push(c.relationid),m.push(u),o.insertExisting.modified.push(i),o.insertExisting.inserted.push(u),o.insertExisting.created.push(c.relationid),o.insertExisting.withContext=!1),_[c.relationid]||(_[c.relationid]=c.ordering)}if(-1===D.indexOf(i)){D.push(i);var p=l.getNodesById(i);p&&(P=P.concat(p))}h.transactions.push(o)}}}(),t=d.noNotification,delete d.noNotification,l._beginBlockingTransaction(A.inserting_nodes),n={chunkSize:1e3,requests:m,cbOnComplete:function(n){var d;try{var u=n.getAnswers(),p=e.is(u,"string")?JSON.parse(u):u;p.results&&p.results.length>0&&!p.error?(d=l.startTransaction("expand"),c.process.expand({treedocument:l,response:p,root_nodes:r,occurencePaths:a,pathOrdering:_,expand_level:1,mode:"insert"}),!0!==t&&v.displayNotification({msg:A.insert_existing_succeeded,eventID:"info"}),l._endBlockingTransaction(),l._commandProxy.padRefresh(h),o.addChild(),i&&i(),s&&s({expandNodeIds:f})):b()}catch(e){b()}finally{d&&d.end()}},cbOnProgress:function(e,t,n){}},l.getNavigates(n);else{for(var I in d)d.hasOwnProperty(I)&&e.is(d[I],"array")&&d[I].forEach(g);t=d.noNotification,delete d.noNotification,l._beginBlockingTransaction(A.inserting_nodes),n={chunkSize:30,requests:p,cbOnComplete:function(n){p.length;var s=n.getAnswers(),a=e.is(s,"string")?JSON.parse(s):s,r=a.results.length;if(0===r)throw new Error("Cannot find object with the physicalid "+p);if(r!=r)throw new Error("More results than input objects");l.invalidateViewPort(),l.wrapInTransaction(function(){var e=c.process.insert_nodes({treedocument:l,response:a,insert_parameters:d});l._commandProxy.padRefresh(e),o.addChild()},"insert_nodes"),l._endBlockingTransaction(),i&&i(),!0!==t&&v.displayNotification({msg:A.insert_existing_succeeded,eventID:"info"})},cbOnProgress:function(e,t,n){}},l.getFetches(n)}})},updateInstance:function(t){var n=this,i=[],o=t.occurencePaths;o&&(i=o),i&&i.length&&(this.wrapInTransaction(function(){var s=e.extend({root_path_physicalid:i,expand_iter:"0",intent:"explore_2D"},u.getWebAPI_Options("navigate"),!0);console.time("ws-navigate"),g.navigate({enopad_webapis:u.getSetting("enopad_webapis"),data:s,onComplete:function(i){var s;console.timeEnd("ws-navigate");try{var a=e.is(i,"string")?JSON.parse(i):i;a.results&&a.results.length&&(a.error?(console.error("ws-navigate",a.error),t.editCfg&&(console.time("partial_update_instances"),c.update_instances({treedocument:n,response:a,occurencePaths:o,newRelIds:t.newRelIds,editCfg:t.editCfg}),console.timeEnd("partial_update_instances"))):(s=n.startTransaction("update"),console.time("update_instances"),c.update_instances({treedocument:n,response:a,occurencePaths:o,newRelIds:t.newRelIds,editCfg:t.editCfg||!1}),console.timeEnd("update_instances")))}catch(e){console.error("updateInstance:",e)}finally{s&&s.end()}},onFailure:function(e){console.error("ws navigate ",e)}})}),t.expandStates&&t.expandStates.length&&t.expandStates.forEach(function(e){o&&o.forEach(function(t){var i=n.getNodeByOccurencePath(t);if(i&&!i.isExpanded()){var o={numberOfLevelsToExpand:e};i.expandNLevels(o)}})}))},updateRevision:function(e){console.count("updateRevision");if(y.checks.array(e.updateRevision))for(let t=0;t<e.updateRevision.length;t++){let n=e.updateRevision[t];if(n.existing&&n.new&&n.newRevison){let e=this.getNodesById(n.existing)[0],t={grid:{"ds6wg:PLMReference.V_isLastVersion":"FALSE"}};this.withTransactionUpdate(function(){e.updateOptions(t)})}}},_clearSortOrders:function(e){if(e&&e.treelist){var t=e.treelist.getManager();t.getColumns().forEach(function(e){var n=t.getColumnIDFromDataIndex(e.dataIndex);"none"!==t.getColumnOrderState(n)&&t.setColumnOrderState(n,"none")})}},sortInTreeOrder:function(e){e&&e.forEach(function(e){e.sortChildren({isRecursive:!0,sortFunction:function(e,t){if(e.options&&t.options){if(e.options.relationOrder<t.options.relationOrder)return-1;if(e.options.relationOrder>t.options.relationOrder)return 1}return 0}})})},_compositeOrder:function(t,n,i){"function"==typeof n.getID()?n.getID():n.options.resourceid;var s,a=!t.getRelationID(),r=this._copyMode,d=this;function c(s){try{e.is(s)&&e.is(s,"array")&&s.length>0&&(s=s[0].relationid);var a={node:t,parent:n,behavior:r,newRelationID:s,ordering:i},c=(t.getID(),n.getID()),l=t.getRelationID(),u=!Boolean(l);d._endBlockingTransaction(),d.wrapInTransaction(function(){d.withTransactionUpdate(function(){d.instantiate(a);var e={transactions:[]},t=d.getNodesByRelId(s)[0].getOccurencePath();u||"COPY"===r?e.transactions.push({insertExisting:{modified:[c],inserted:[t],created:[s],withContext:!u}}):e.transactions.push({reParent:{modified:[c],inserted:[t],created:[s],deleted:[l]}}),d._commandProxy.padRefresh(e),o.addChild()},d)})}catch(e){d._endBlockingTransaction(),v.displayNotification({msg:E.generic_service_failure,eventID:"error"})}}function l(t){d._endBlockingTransaction(),t&&e.is(t.messages,"array")&&t.messages.forEach(function(e){v.displayNotification({msg:e,eventID:"error"})})}a||"COPY"===r?(s={children:[t.getOccurencePath()],parents:[n.getOccurencePath()],ordering:i,commit:!0},this._beginBlockingTransaction(A.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,data:s,onSuccess:c,onFailure:l})})):(s={children:[t.getOccurencePath()],parents:[n.getOccurencePath()],ordering:i,commit:!0},this._beginBlockingTransaction(A.reparenting),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CutPaste",internal_call:!0,data:s,onSuccess:c,onFailure:l})}))},_beginBlockingTransaction:function(e){this.getModelEvents().publish({event:"beginBlockingTransaction",data:e,context:this})},_endBlockingTransaction:function(){this.getModelEvents().publish({event:"endBlockingTransaction",context:this})},_triggerTitleUpdate:function(){var e=this.getRoots();this.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.length,added_node:e[e.length-1]}})},isEditor:function(){return!0}})}),define("DS/ENOPAD_v2/models/PADTreeDocument",["UWA/Core","DS/ENXNav/models/xNavDocument","DS/ENXNav/models/xNavNodeModel","DS/ENOPAD_v2/models/PADTreeDocumentRefresh","DS/PADServices/utils/AttributesMgt","DS/ENOPAD_v2/models/_PADModelParser","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPredicatesNls","DS/PADUtils/views/PADAlert","DS/PADUtils/utilsWS/WSUtils","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,a,r,d,c,l,u,p,g){"use strict";const f=["owner"];return t.extend(i,{_active_cutting_nodes:[],init:function(t){!0!==a.getSetting("activateEditInTable")||e.is(t.shouldBeEditable)||(t.shouldBeEditable=function(e){return!0},t.shouldBeSelected=function(e){return!e.ghostMode}),this._parent(t);var n=this;this._commandProxy&&this._commandProxy.addProxyEvents({events:{onRefresh:function(t){if((e.is(t.authored.created,"array")||e.is(t.authored.modified,"array"))&&(t.authored.origin&&"reserve"===t.authored.origin||n.refreshNodeById({created:t.authored.created,modified:t.authored.modified})),e.is(t.authored.deleted,"array")){var i=[],o=[];t.authored.deleted.forEach(function(e){n.getNodesById(e).forEach(function(t){-1===o.indexOf(e)&&o.push(e)}),i=i.concat(n.getNodesById(e))}),n.deleteNodes(i,!0),require("DS/PADServices/utils/GlobalModelEvents").publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:t.authored.deleted}})}}}})},setDnDBehavior:function(e){this._copyMode=e},setConfirmdDialog:function(e){this._confirmDialog=e},setCuttingNodes:function(e){this._active_cutting_nodes=e},instantiate:function(t,i,o){var s=t.instanceName?t.instanceName:"",a=o?o.newRelationIDs:[],d=o?o.tgtParentIds:[],c=o?o.removedNodeIds:[],l={},u=i||[],p=t.node,f=t.parent,h=t.behavior,v=t.newRelationID,m=t.ordering,D=f.getID(),P=e.clone(p.options,!1),_=e.clone(p.options.grid,!1);P.grid=_;var b=p.getRelationID(),I=p.options.relationtype,y=!Boolean(b),A=p.getParent()?p.getParent().getID():"",E=this.getRoots(),N=!1;!!!m&&y||"COPY"===h||(E.forEach(function(e){var t=[];u&&0!==u.length?-1!==u.indexOf(e.getID())?t=e.getNodesByRelId(b):A&&-1!==u.indexOf(A)?t=e.getNodesByRelId(b):d.length>0?-1===d.indexOf(e.getID())&&(a.length>0?-1===a.indexOf(b)&&(t=e.getNodesByRelId(b)):t=e.getNodesByRelId(b)):t=e.getNodesByRelId(b):t=e.getNodesByRelId(b),t.length>0&&t.forEach(function(e){var t=e.getParent();e.isRoot()||(u&&0!==u.length?-1!==u.indexOf(t.getID())&&t.removeChild(e):t.removeChild(e))})}),p.setRelationID(v,I));var S=function(t,n,i){if(n&&n.before&&""!==n.before){var o,s=t.getChildren();for(o=0;o<s.length;o++){var a=s[o];if(a.options.relationid===n.before){try{t.insertBefore(i,a),N=!0}catch(e){throw console.log(e),e}break}}}e.is(t.options.relcount,"number")||(t.options.relcount=0),t.options.relcount=t.options.relcount+1,N||t.addChild(i)};E.forEach(function(t){y&&c.length>0&&-1!==c.indexOf(t.getID())&&(l[t.getID()]=!0);var i=t.getNodesById(D);i&&0!==i.length&&i.forEach(function(t){if(t===f||t.isExpanded()||null===t.options.children||0===t.options.children.length){if(y||"COPY"===h||t!==f){var i=e.clone(p.options,!1),o=e.clone(p.options.grid,!1);(e.is(i.relcount,"number")&&i.relcount>0||e.is(i.children,"array")&&i.children.length>0)&&(i.children=[]),u&&-1===u.indexOf(t.getID())?(o.CurrentEvolutionEffectivity="",o.Effectivity="",o.ProjectedEvolutionEffectivity="",o.VariantEffectivity=""):"COPY"===h&&(o.CurrentEvolutionEffectivity="",o.Effectivity="",o.ProjectedEvolutionEffectivity="",o.VariantEffectivity=""),s&&(o.instanceName=s),i.grid=e.clone(o,!1);var a=new n(i),r=i.relationtype;(y||"COPY"===h||d&&d.length>1)&&a.setRelationID(v,r),S(t,m,a)}else if(d&&d.length>1){var c=e.clone(P,!1),l=new n(c),g=p.options.relationtype;l.setRelationID(v,g),S(t,m,l)}else S(t,m,p);t.isExpanded()||t.options.padstate&&"partiallyExpanded"===t.options.padstate||(t.setState({state:"partiallyExpanded"}),t.options.padstate="partiallyExpanded")}else console.log("**3 =========",t)})}),f.isExpanded()||f.options.padstate&&"partiallyExpanded"===f.options.padstate||(f.setState({state:"partiallyExpanded"}),f.options.padstate="partiallyExpanded"),r.setAuthoringState(!0,g.PADSession_disabling_index_authoring),y&&"COPY"!==h&&(0===c.length?this.removeRoot(p):l[p.getID()]&&this.removeRoot(p)),this.invalidateViewPort()},_distinguishInsertReparentCases:function(e){var t={insertExisting:[],reparent:[]},n=this._copyMode;return e.forEach(function(e){!e.getRelationID()||"COPY"===n?t.insertExisting.push(e):t.reparent.push(e)}),t},_inputData:function(e,t){var n=[];return e.forEach(function(e){n.push(e.getOccurencePath())}),{children:n,parents:[t.getOccurencePath()],commit:!0}},_onInsert:function(t,n,i){var o=this._copyMode;"function"==typeof n.getID&&n.getID();var s=this;function a(e,t){var n;for(n=0;n<e.length;n++){var i=e[n];if(i.options.resourceid===t)return i}return null}function r(e){var r;for(r=0;r<e.length;r++){var c=e[r].relationid,u=e[r].resourceid,g=a(t,u),f=e[r].instanceName||"";if(!g)return void d();var h={node:g,parent:n,next:i,behavior:o,newRelationID:c,instanceName:f},v=(g.getID(),n.getID()),m=g.getRelationID(),D=!Boolean(m);s._endBlockingTransaction(),s.wrapInTransaction(function(){s.withTransactionUpdate(function(){s.instantiate(h);var e={transactions:[]},t=s.getNodesByRelId(c)[0].getOccurencePath();D||"COPY"===o?e.transactions.push({insertExisting:{modified:[v],inserted:[t],created:[c],withContext:!D}}):e.transactions.push({reParent:{modified:[v],inserted:[t],created:[c],deleted:[m]}}),s._commandProxy.padRefresh(e)},s)})}l.displayNotification({msg:p.insert_existing_succeeded,eventID:"info"})}function d(t){if(s._endBlockingTransaction(),t&&e.is(t.messages,"array")){var n=[];t.messages.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),l.displayNotification({msg:n.join(""),eventID:"error"})}s.dropInvitContainer&&s.dropInvitContainer.hide()}function c(e){var r;for(r=0;r<e.length;r++){var d=e[r].relationid,c=e[r].resourceid,f=a(t,c),h=e[r].instanceName||"";if(!f)return void u();try{var v={node:f,parent:n,next:i,behavior:o,newRelationID:d,instanceName:h},m=(f.getID(),n.getID()),D=f.getRelationID(),P=!Boolean(D);s._endBlockingTransaction(),s.wrapInTransaction(function(){s.withTransactionUpdate(function(){s.instantiate(v);var e={transactions:[]},t=s.getNodesByRelId(d)[0].getOccurencePath();P?e.transactions.push({insertExisting:{modified:[m],inserted:[t],created:[d],withContext:!P}}):e.transactions.push({reParent:{modified:[m],inserted:[t],created:[d],deleted:[D]}}),s._commandProxy.padRefresh(e)},s),l.displayNotification({msg:p.reparent_succeeded,eventID:"info"})})}catch(e){s._endBlockingTransaction(),l.displayNotification({msg:g.generic_service_failure,eventID:"error"})}}}function u(t){if(s._endBlockingTransaction(),t&&e.is(t.messages,"array")){var n=[];t.messages.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),l.displayNotification({msg:n.join(""),eventID:"error"})}}var f=s._distinguishInsertReparentCases(t);return f.insertExisting.length>0&&(this._beginBlockingTransaction(p.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,data:s._inputData(t,n),onSuccess:r,onFailure:d})})),f.reparent.length>0&&(this._beginBlockingTransaction(p.reparenting),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CutPaste",internal_call:!0,data:s._inputData(t,n),onSuccess:c,onFailure:u})})),!1},getOrdering:function(e){var t={};if(!e)return ordering;var n,i,o,s=-1,a=-1,r=-1;return e.forEach(function(e){var d={};(n=e.getParent().getChildren())&&n.length>1&&((s=n.indexOf(e))>-1&&(a=s-1,r=s+1),o=n[a],i=n[r],d.after=o?o.getRelationID():"",d.before=i?i.getRelationID():"",t[e.getRelationID()]=d)}),t},insertNodes:function(t,i){var r=this,u=[],h=[];function v(e){-1===h.indexOf(e.resourceid)&&h.push(e.resourceid),-1===h.indexOf(e.relationid)&&h.push(e.relationid)}function m(){l.displayNotification({msg:g.generic_service_failure,eventID:"error"}),r._endBlockingTransaction()}var D={transactions:[]},P=[],_=[],b=[],I=[];var y=[];return this.wrapInTransaction(function(){var A;if(e.is(t.created,"array")||e.is(t.inserted,"array"))r.withTransactionUpdate(function(){if(t.created){for(var i=[],a=0;a<t.created.length;a++){var d=s.parse_attributes(t.created[a].attributes,o.getAvailableColumns(),o.getTreeColumn());void 0===d.children&&(d.children=null),e.is(d.relcount,"number")&&d.relcount>0&&(d.children=[]);var l=new n(d);r.addRoot(l),l.select(),i.push(l.getID());var p=r.getRoots().length;e.is(r.detachedRoots,"array")&&(p+=r.detachedRoots.length),u.push(l),r.getModelEvents().publish({event:"onRootAdded",data:{nb_root:p,added_node:l}}),c.updateNLS(l)}var g={pids:i,already_added_in_PS:!0};r._commandProxy.drop(g),r.updateNodesAttrValue(i,f,function(){})}if(t.inserted){for(var h=0;h<t.inserted.length;h++){var v=[];let i=[];var m={insertExisting:{modified:[],inserted:[],created:[]}};r.getRoots().forEach(function(e){v=v.concat(e.getNodesById(t.inserted[h].parent_id))}),t.inserted[h].children.forEach(function(t){v.forEach(function(a){var d=s.parse_attributes(t.attributes,o.getAvailableColumns(),o.getTreeColumn());d.relationid=t.relationid,void 0===d.children&&(d.children=null),e.is(d.relcount,"number")&&d.relcount>0&&(d.children=[]);var l=new n(d);a.addChild(l),a.setState({state:"partiallyExpanded"}),a.options.padstate="partiallyExpanded",m.insertExisting.modified.push(a.getID()),m.insertExisting.inserted.push(l.getOccurencePath()),i.push(l.getID()),P.push(l.getRelationID()),m.insertExisting.created.push(l.getRelationID()),m.insertExisting.withContext=!1,r.updateNodesAttrValue(i,f,function(){}),c.updateNLS(l)})}),D.transactions.push(m)}r._commandProxy.padRefresh(D)}});else if(!0===a.getSetting("useLWCWebServices")){r.unselectAll(),function(n){for(var i=Object.keys(t),o=0;o<i.length;o++){var s=i[o];if(e.is(t[s],"array")){for(var a={insertExisting:{modified:[],inserted:[],created:[]}},d=t[s],c=0,l=d.length;c<l;c++){var u=d[c],p=[s,u.relationid,u.resourceid];-1===_.indexOf(p)&&(_.push(p),a.insertExisting.modified.push(s),a.insertExisting.inserted.push(u.resourceid),P.push(u.relationid),a.insertExisting.created.push(u.relationid),a.insertExisting.withContext=!1)}if(-1===b.indexOf(s)){b.push(s);var g=r.getNodesById(s);g&&(I=I.concat(g),g.forEach(function(e){var t=e.getOccurencePath();-1===y.indexOf(t)&&y.push(t)}))}D.transactions.push(a)}}}(),A=t.noNotification,delete t.noNotification,r._beginBlockingTransaction(p.inserting_nodes);var E=e.extend({root_path_physicalid:_,expand_iter:"0",intent:"explore_2D"},a.getWebAPI_Options("navigate"),!0);d.navigate({enopad_webapis:a.getSetting("enopad_webapis"),data:E,onComplete:function(t){var n;try{var o=e.is(t,"string")?JSON.parse(t):t;o.results&&o.results.length>0&&!o.error?(n=r.startTransaction("expand"),s.process.expand({treedocument:r,response:o,root_nodes:I,occurencePaths:y,expand_level:1,mode:"insert"}),!0!==A&&l.displayNotification({msg:p.insert_existing_succeeded,eventID:"info"}),r._endBlockingTransaction(),i&&i(),function(){if(P.length){var e=[];P.forEach(function(t){var n=r.getNodesByRelId(t);n&&e.push(n[0].getOccurencePath())}),D.transactions[0].insertExisting.inserted=e}}(),r._commandProxy.padRefresh(D)):m()}catch(e){m()}finally{n&&n.end()}},onFailure:function(e){m()}})}else{for(var N in t)t.hasOwnProperty(N)&&e.is(t[N],"array")&&t[N].forEach(v);A=t.noNotification,delete t.noNotification,r._beginBlockingTransaction(p.inserting_nodes);var S={intent:"explore_2D",debug:a.getSetting("enopad_webapis_debug")};d.fetch({enopad_webapis:a.getSetting("enopad_webapis"),data:S,pids:h,onComplete:function(n){r.invalidateViewPort();var o=e.is(n,"string")?JSON.parse(n):n;if(0===o.results.length)throw new Error("Cannot find object with the physicalid "+h);if(o.results.length!==h.length)throw new Error("More results than input objects");r.wrapInTransaction(function(){var e=s.process.insert_nodes({treedocument:r,response:o,insert_parameters:t});r._commandProxy.padRefresh(e)},"insert_nodes"),r._endBlockingTransaction(),i&&i(),!0!==A&&l.displayNotification({msg:p.insert_existing_succeeded,eventID:"info"})},onFailure:function(e){l.displayNotification({msg:g.generic_service_failure,eventID:"error"}),r._endBlockingTransaction()}})}}),u},getFetches:function(t){var n=e.clone(t,!1);return n.cbOnProcess=function(e,t){var n={intent:"explore_2D",debug:a.getSetting("enopad_webapis_debug")},i={enopad_webapis:a.getSetting("enopad_webapis"),data:n,pids:t,onComplete:function(n){var i="string"==typeof n?JSON.parse(n):n;if(i.results)for(var o=0,s=i.results.length;o<s;o++){var a=i.results[o];e.setAnswer(t[o],a)}else console.log("handle error in the future")},onFailure:function(t,n){console.log("getFetches.onFailure"),e.reprocess()}};return d.fetch(i)},new u.MassChunkedRequests(n)},getNavigates:function(t){var n=e.clone(t,!1);return n.cbOnProcess=function(t,n){if(n&&n.length>0){var i=e.extend({root_path_physicalid:n,expand_iter:"1",intent:"explore_2D"},a.getWebAPI_Options("navigate"),!0),o={enopad_webapis:a.getSetting("enopad_webapis"),data:i,onComplete:function(e){var i="string"==typeof e?JSON.parse(e):e;i.results?t.setAnswers(n,i.results):console.log("handle error in the future")},onFailure:function(e,t){console.error("getNavigates.onFailure networkError",e),console.error("getNavigates.onFailure serverError ",t)}};return d.navigate(o)}},new u.MassChunkedRequestsLWC(n)},insertNodesSplitFetch:function(t,n){t.toDelete;var i=t.callack,o=t.callback2,r=t.occurencePaths,d=t.parentNodes,c=t.toInsert,u=this,f=[];function h(e){-1===f.indexOf(e.resourceid)&&f.push(e.resourceid),-1===f.indexOf(e.relationid)&&f.push(e.relationid)}var v=[],m={transactions:[]},D=[],P=[],_=[],b={};function I(){l.displayNotification({msg:g.generic_service_failure,eventID:"error"}),u._endBlockingTransaction()}this.wrapInTransaction(function(){var t,n;if(!0===a.getSetting("useLWCWebServices"))!function(){for(var t=Object.keys(c),n=0;n<t.length;n++){var i=t[n];if(e.is(c[i],"array")){for(var o={insertExisting:{modified:[],inserted:[],created:[]}},s=c[i],a=0,r=s.length;a<r;a++){var d=s[a],l=[i,d.relationid,d.resourceid];-1===D.indexOf(l)&&(v.push(d.relationid),D.push(l),o.insertExisting.modified.push(i),o.insertExisting.inserted.push(l),o.insertExisting.created.push(d.relationid),o.insertExisting.withContext=!1),b[d.relationid]||(b[d.relationid]=d.ordering)}if(-1===P.indexOf(i)){P.push(i);var p=u.getNodesById(i);p&&(_=_.concat(p))}m.transactions.push(o)}}}(),t=c.noNotification,delete c.noNotification,u._beginBlockingTransaction(p.inserting_nodes),n={chunkSize:1e3,requests:D,cbOnComplete:function(n){var a;try{var c=n.getAnswers(),g=e.is(c,"string")?JSON.parse(c):c;g.results&&g.results.length>0&&!g.error?(a=u.startTransaction("expand"),s.process.expand({treedocument:u,response:g,root_nodes:d,occurencePaths:r,pathOrdering:b,expand_level:1,mode:"insert"}),!0!==t&&l.displayNotification({msg:p.insert_existing_succeeded,eventID:"info"}),u._endBlockingTransaction(),u._commandProxy.padRefresh(m),i&&i(),o&&o({expandNodeIds:v})):I()}catch(e){I()}finally{a&&a.end()}},cbOnProgress:function(e,t,n){}},u.getNavigates(n);else{for(var g in c)c.hasOwnProperty(g)&&e.is(c[g],"array")&&c[g].forEach(h);t=c.noNotification,delete c.noNotification,u._beginBlockingTransaction(p.inserting_nodes),n={chunkSize:30,requests:f,cbOnComplete:function(n){f.length;var o=n.getAnswers(),a=e.is(o,"string")?JSON.parse(o):o,r=a.results.length;if(0===r)throw new Error("Cannot find object with the physicalid "+f);if(r!=r)throw new Error("More results than input objects");u.invalidateViewPort(),u.wrapInTransaction(function(){var e=s.process.insert_nodes({treedocument:u,response:a,insert_parameters:c});u._commandProxy.padRefresh(e)},"insert_nodes"),u._endBlockingTransaction(),i&&i(),!0!==t&&l.displayNotification({msg:p.insert_existing_succeeded,eventID:"info"})},cbOnProgress:function(e,t,n){}},u.getFetches(n)}})},updateInstance:function(t){var n=this,i=[],o=t.occurencePaths;o&&(i=o),i&&i.length&&(this.wrapInTransaction(function(){var r=e.extend({root_path_physicalid:i,expand_iter:"0",intent:"explore_2D"},a.getWebAPI_Options("navigate"),!0);console.time("ws-navigate"),d.navigate({enopad_webapis:a.getSetting("enopad_webapis"),data:r,onComplete:function(i){var a;console.timeEnd("ws-navigate");try{var r=e.is(i,"string")?JSON.parse(i):i;r.results&&r.results.length&&(r.error?(console.error("ws-navigate",r.error),t.editCfg&&(console.time("partial_update_instances"),s.update_instances({treedocument:n,response:r,occurencePaths:o,newRelIds:t.newRelIds,editCfg:t.editCfg}),console.timeEnd("partial_update_instances"))):(a=n.startTransaction("update"),console.time("update_instances"),s.update_instances({treedocument:n,response:r,occurencePaths:o,newRelIds:t.newRelIds,editCfg:t.editCfg||!1}),console.timeEnd("update_instances")))}catch(e){console.error("updateInstance:",e)}finally{a&&a.end()}},onFailure:function(e){console.error("ws navigate ",e)}})}),t.expandStates&&t.expandStates.length&&t.expandStates.forEach(function(e){o&&o.forEach(function(t){var i=n.getNodeByOccurencePath(t);if(i&&!i.isExpanded()){var o={numberOfLevelsToExpand:e};i.expandNLevels(o)}})}))},updateRevision:function(t){console.count("updateRevision");var n,i=[],o=[];if(e.is(t.updateRevision,"array")){t.updateRevision.forEach(function(e){-1===i.indexOf(e.existing)&&i.push(e.existing)});for(var s,a=this.getRoots(),r=e.clone(a,!1);r.length;){var d=r.pop();d&&(-1!==i.indexOf(d.getID())&&(n=d.options.grid["ds6wg:PLMReference.V_isLastVersion"],d.options.grid["ds6wg:revision"],d.options.lable||d.options.display,n&&o.push(d)),(s=d.getChildren())&&s.length&&(r=r.concat(s)))}o.length>0&&this.withTransactionUpdate(function(){o.forEach(function(e){var t={resourceid:e.getID(),grid:{"ds6wg:PLMReference.V_isLastVersion":"FALSE"}};e.updateOptions(t)})})}},_clearSortOrders:function(e){if(e&&e.treelist){var t=e.treelist.getManager();t.getColumns().forEach(function(e){var n=t.getColumnIDFromDataIndex(e.dataIndex);"none"!==t.getColumnOrderState(n)&&t.setColumnOrderState(n,"none")})}},sortInTreeOrder:function(e){e&&e.forEach(function(e){e.sortChildren({isRecursive:!0,sortFunction:function(e,t){if(e.options&&t.options){if(e.options.relationOrder<t.options.relationOrder)return-1;if(e.options.relationOrder>t.options.relationOrder)return 1}return 0}})})},_compositeOrder:function(t,n,i){"function"==typeof n.getID()?n.getID():n.options.resourceid;var o,s=!t.getRelationID(),a=this._copyMode,r=this;function d(o){try{e.is(o)&&e.is(o,"array")&&o.length>0&&(o=o[0].relationid);var s={node:t,parent:n,behavior:a,newRelationID:o,ordering:i},d=(t.getID(),n.getID()),c=t.getRelationID(),u=!Boolean(c);r._endBlockingTransaction(),r.wrapInTransaction(function(){r.withTransactionUpdate(function(){r.instantiate(s);var e={transactions:[]},t=r.getNodesByRelId(o)[0].getOccurencePath();u||"COPY"===a?e.transactions.push({insertExisting:{modified:[d],inserted:[t],created:[o],withContext:!u}}):e.transactions.push({reParent:{modified:[d],inserted:[t],created:[o],deleted:[c]}}),r._commandProxy.padRefresh(e)},r)})}catch(e){r._endBlockingTransaction(),l.displayNotification({msg:g.generic_service_failure,eventID:"error"})}}function c(t){r._endBlockingTransaction(),t&&e.is(t.messages,"array")&&t.messages.forEach(function(e){l.displayNotification({msg:e,eventID:"error"})})}s||"COPY"===a?(o={children:[t.getOccurencePath()],parents:[n.getOccurencePath()],ordering:i,commit:!0},this._beginBlockingTransaction(p.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,data:o,onSuccess:d,onFailure:c})})):(o={children:[t.getOccurencePath()],parents:[n.getOccurencePath()],ordering:i,commit:!0},this._beginBlockingTransaction(p.reparenting),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CutPaste",internal_call:!0,data:o,onSuccess:d,onFailure:c})}))},_beginBlockingTransaction:function(e){this.getModelEvents().publish({event:"beginBlockingTransaction",data:e,context:this})},_endBlockingTransaction:function(){this.getModelEvents().publish({event:"endBlockingTransaction",context:this})},_triggerTitleUpdate:function(){var e=this.getRoots();this.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.length,added_node:e[e.length-1]}})}})}),define("DS/ENOPAD_v2/models/PADTreeDocumentRedirector",["DS/ENOPAD_v2/models/PADTreeDocument","DS/ENOPAD_v2/models/PADDocTree","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalUtils"],function(e,t,n,i){let o=e;return(n.getSetting("expandV2PS")||"true"===i.getURLParameter("expandV2PS"))&&(o=t),o});