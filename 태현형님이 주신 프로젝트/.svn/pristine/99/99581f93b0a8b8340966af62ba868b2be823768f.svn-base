define("DS/DELWeb3DViewerComp/DELWeb3DViewer",["DS/DELWebViewerComponent/Component","UWA/Class/Promise","DS/Logger/Logger","DS/PlatformAPI/PlatformAPI","DS/DELWebComponentManager/DELWebComponentManager","DS/DELWebLandingPage/DELWebDragAndDropPage","DS/PADUtils/PADContext","DS/DELWebComponentManager/DELWebTypesUtil","DS/Selection/CSOManager","DS/Selection/HSOManager","i18n!DS/DELWeb3DViewerComp/assets/nls/messages","css!DS/DELWeb3DViewerComp/assets/css/DELWeb3DViewer.css"],function(e,t,n,i,o,r,a,d,s,c,l){"use strict";return function(g,h){const u="scopedMfg",p="resource";var f,v,w,b=[],m=[],P=[],V=[],y=n.getLogger("DELWeb3DViewer"),D=function(e){return e&&e.origin!==g&&e.data},E=function(t,n){return{graphicProperties:function(e){var t=[];return e&&e.data?e.data.path&&UWA.is(e.data.path,"array")&&(t=UWA.is(e.data.path[0],"array")?e.data.path:[e.data.path]):y.error(l.get("Error.InvalidInput.Message")),t}(t).map(function(t){return{[UWA.is(t,"array")?"path":"id"]:t,[e.getViewerBehavior().getGraphicPropertiesEnum().VISIBILITY]:n}})}},B=function(t){D(t)&&e.getViewerBehavior().setGraphicProperties(t.data)},C=function(t){e.getViewerBehavior().notifyRootVisibilityChange(t.data.id,t.data.visibility)},S=function(t){var n;t&&(w=t,(n=function(){let e=w[u]||{},t=w[p]||{};return{mfgId:e.id,installPath:e.occurrence,resourceId:t.id,processId:w.occurrence&&w.occurrence.length>0?w.occurrence[0]:w.id,defaultShow:!0,filter:w.filter?w.filter:null}}()).resourceId&&B({data:E({data:{path:[n.resourceId]}},!1)}),e.getViewerBehavior().setProcess(n).then(function(){n.resourceId&&C({data:{id:n.resourceId,visibility:!1}}),e.getViewerBehavior().setReframe({path:n.installPath&&n.installPath.length>0?n.installPath:[n.mfgId]}),o.getComponent("ModelEvents").publish({event:"onProcessLoadCompleted",data:{data:n,origin:g}})}).fail(function(){o.getComponent("ModelEvents").publish({event:"onProcessLoadFailed",data:{data:n,origin:g}})}))},I=function(t){var n=function(n){switch(n){case d.PPRTYPES.PROCESS:S(t.data);break;default:!0!==(i=t.data).withFilter&&e.getViewerBehavior().addRoots({objects:[{path:[i.id]}]})}var i};D(t)&&(t.data.id?t.data.pprType?n(t.data.pprType):d.getTaxonomies([t.data.id]).then(function(e){e&&n(d.getPPRType(e[t.data.id]))}).fail(function(e){y.debug(e.toString()),y.error("Error occurred while checking type for id ",t.data.id)}):(y.log("Invalid Input Provided, object id is missing"),y.error(l.get("Error.InvalidInput.Message"))))},M=function(e,t){var n=o.getComponent("ModelEvents");e&&UWA.is(t,"array")&&t.forEach(t=>{var i={};Object.assign(i,t,{path:t.paths}),delete i.paths,n.publish({event:e,data:{data:i,origin:g}})})},U=function(e,t){o.getComponent("ModelEvents").publish({event:e,data:{data:t,origin:g}})},W=function(e){B({data:E(e,!1)})},H=function(e){B({data:E(e,!0)})},L=function(t){D(t)&&e.getViewerBehavior().setReframe(t.data)},A=function(){return w={},e.getViewer()?e.getViewerBehavior().empty():t.reject(l.get("Error.Viewer.NotInitialized"))},O=function(e,t){o.getComponent("ModelEvents").publish({event:e,data:{data:t,origin:g}})},N={Model:{setGraphicProperties:B,removeGraphicProperties:function(t){D(t)&&e.getViewerBehavior().removeGraphicProperties(t.data)},setMode:function(t){D(t)&&e.getViewerBehavior().setMode(t.data)},loadData:I,onHide:W,onShow:H,notifyRootVisibilityChange:C,onSelect:function(t){D(t)&&e.getViewerBehavior().selectNode(t.data)},onUnSelect:function(t){D(t)&&e.getViewerBehavior().unSelectNode(t.data)},onReframe:L,onSearch:function(t){D(t)&&e.getViewer()&&e.getViewerBehavior().search({searchQuery:t.data})},onRefresh:async function(){let t=e.getViewerBehavior(),n=function(){w&&w.resource&&w.resource.id&&(B({data:E({data:{path:[w.resource.id]}},!1)}),C({data:{id:w.resource.id,visibility:!1}}))};t&&t.refresh().then(function(){n(),o.getComponent("ModelEvents").publish({event:"onViewerRefreshed",data:{data:{isRefreshed:!0},origin:g}})}).fail(function(){n(),o.getComponent("ModelEvents").publish({event:"onViewerRefreshFailed",data:{data:{isRefreshed:!1},origin:g}})})},onHighlight:function(t){D(t)&&e.getViewerBehavior().highlightNode(t.data)},onUnHighlight:function(t){D(t)&&e.getViewerBehavior().unHighlightNode(t.data)},onPreHighlight:function(t){D(t)&&e.getViewerBehavior().preHighlightNode(t.data)},onUnPreHighlight:function(t){D(t)&&e.getViewerBehavior().unPreHighlightNode(t.data)},onEmpty:A,onRemoveRoot:function(t){D(t)&&e.getViewerBehavior().removeRoots(t.data)},activateBuildup:function(t){D(t)&&e.getViewerBehavior().setOperation(t.data).then(()=>{o.getComponent("ModelEvents").publish({event:"onBuildUpActivated",data:{data:t.data,origin:g}})})},deactivateBuildup:function(t){D(t)&&e.getViewerBehavior().removeOperation().then(()=>{o.getComponent("ModelEvents").publish({event:"onBuildUpDeactivated",data:{data:t.data,origin:g}})})},onApplyNGFilter:function(){e.getViewer()&&e.getViewerBehavior().resetGraphicProperties(!1)},onPreAddSelect:function(){var e=s.get();UWA.is(e,"array")&&e.length>0&&(c.remove(e),s.empty())},onUpdatePreferences:function(t){let n=e.getViewerBehavior();n&&D(t)&&n.updateOptions(t.data)},highlightLinkedViews:function(t){D(t)&&e.getViewerBehavior().highlightLinkedViews(t.data)}},Viewer:{onHideNode:M.bind(M,"onHide"),onShowNode:M.bind(M,"onShow"),onSelectNode:M.bind(M,"onSelect"),onUnSelectNode:M.bind(M,"onUnSelect"),onHighlightNode:M.bind(M,"onHighlight"),onUnHighlightNode:M.bind(M,"onUnHighlight"),onPreHighlightNode:M.bind(M,"onPreHighlight"),onUnPreHighlightNode:M.bind(M,"onUnPreHighlight"),onWKIFailed:function(e){e=e||{},y.error(JSON.stringify(e)),o.getComponent("Utils").displayNotification({level:"warning",message:l.get("Warn.WKIFailed.Message")})},onSelectView:U.bind(U,"onSelectView")},Platform:{"DS/PADUtils/PADCommandProxy/focus":function(e){e&&e.data&&UWA.is(e.data.paths,"array")&&e.data.paths.forEach(e=>{o.getComponent("ModelEvents").publish({event:"onFocus",data:{data:{path:e},origin:g}})})}},FilterBIProxy:{FilterBIColorize:O.bind(O,"onBIColorize"),FilterBIUnColorize:O.bind(O,"onBIUnColorize")},PAD3DViewer:{onEndProgressiveLoad:function(e){o.getComponent("ModelEvents").publish({event:"onLoadGraphicsComplete",data:{data:e,origin:g}})}}},R={initialize:function(n={}){return new t(function(t){var d;!function(){let e=h.viewerOptions.delviewer.run_options.propertiesFacet;e&&UWA.is(e.value,"array")&&e.value.forEach(e=>{e&&e.facet&&e.facet.name&&(e.facet.text=l.get("Facet."+e.facet.name+".Text"))}),h=UWA.extend(h,n,!0)}(),e.init(h),function(){var e=o.getComponent("ModelEvents");for(let t in N.Model)Object.prototype.hasOwnProperty.call(N.Model,t)&&b.push(e.subscribe({event:t},N.Model[t]))}(),function(){var t=e.getEventHnd();for(let e in N.Viewer)Object.prototype.hasOwnProperty.call(N.Viewer,e)&&m.push(t.subscribe(t.events[e],N.Viewer[e]))}(),Object.keys(N.Platform).forEach(e=>{P.push(i.subscribe(e,N.Platform[e]))}),d=e.getEventHnd().subscribe(e.getEventHnd().events.onReady,function(){e.getEventHnd().unSubscribe(d),e.getViewer().addClassName("del-viewer-component-container"),h&&h.dragAndDrop&&n.dndOptions&&n.dndOptions.onDrop&&(v=new r({onDrop:n.dndOptions.onDrop,body:e.getViewer(),nls:n.dndOptions.nls})).initialize(),function(){if(f=a&&a.get()&&a.get().getController()?a.get().getController().getBIProxy():null)for(let e in N.FilterBIProxy)Object.prototype.hasOwnProperty.call(N.FilterBIProxy,e)&&f.addEvent(e,N.FilterBIProxy[e])}(),Object.keys(N.PAD3DViewer).forEach(e=>{V.push(a.get().subscribe({event:e},N.PAD3DViewer[e]))}),o.getComponent("ModelEvents").publish({event:"onViewerReady",data:{origin:g}}),t()})})},destroy:function(){R.clean()},loadData:function(e){I(e)},hide:function(e){W(e)},show:function(e){H(e)},reframe:function(e){L(e)},empty:A,getViewer:e.getViewer,showViewer:function(){e.getViewer().removeClassName("del-viewer-component-container-hidden")},hideViewer:function(){e.getViewer().addClassName("del-viewer-component-container-hidden")},clean:async function(){if(b.forEach(e=>{o.getComponent("ModelEvents").unsubscribe(e)}),b=[],m.forEach(t=>{e.getEventHnd().unSubscribe(t)}),m=[],f)for(let e in N.FilterBIProxy)Object.prototype.hasOwnProperty.call(N.FilterBIProxy,e)&&f.removeEvent(e,N.FilterBIProxy[e]);P.forEach(e=>{i.unsubscribe(e)}),P=[],v&&v.destroy(),e.dispose()},getVisualizedRoots:function(){let e=a.get(),t=[];return e&&(t=e.getRoots().map(e=>({id:e.getModelIdentification()}))),t}};return R}});