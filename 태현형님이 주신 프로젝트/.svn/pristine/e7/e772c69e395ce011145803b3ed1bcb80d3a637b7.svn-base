<%--  decProjectEnterOrderResultDialog.jsp   

   Copyright (c) 2003-2020 Dassault Systemes.All Rights Reserved.
   This program contains proprietary and trade secret information of MatrixOne,Inc.
   Copyright notice is precautionary only and does not evidence any actual or intended publication of such program

   decProjectEnterOrderResultDialog.jsp
   Created By thok 2023-08-11
--%>
   
<%@page import="com.matrixone.apps.domain.DomainObject"%>
<%@include file = "../emxUICommonAppInclude.inc"%>
<%@include file = "emxCompCommonUtilAppInclude.inc"%>
<%@include file = "emxUIConstantsInclude.inc"%>
<%@page import="com.matrixone.apps.domain.util.SetUtil,
                com.matrixone.apps.domain.util.XSSUtil"
%>
<%@include file = "../emxTagLibInclude.inc" %>

<%@ page import="com.matrixone.apps.domain.util.ContextUtil"%>
<%@ page import="com.dec.util.DecConstants"%>
<script language="JavaScript" src="scripts/emxUICollections.js" type="text/javascript"></script>
<script language="javascript" type="text/javascript" src="../common/scripts/emxUICalendar.js"></script>
<%@include file = "../emxUICommonHeaderBeginInclude.inc"%>
<%@include file = "../emxJSValidation.inc" %>

<%
	String languageStr = request.getHeader("Accept-Language");
	String jsTreeID    = emxGetParameter(request,"jsTreeID");
	String suiteKey    = emxGetParameter(request,"suiteKey");
	String sPSOID 	 = emxGetParameter(request, "objectId");
	String sCharSet    = Framework.getCharacterEncoding(request);
	DomainObject doPS = DomainObject.newInstance(context, sPSOID);
		
	StringList slPersonOID = new StringList();
	StringList slMemberRELID = doPS.getInfoList(context, "from[" + DecConstants.RELATIONSHIP_MEMBER + "].id");
	
	String sArrTableRowId[] = emxGetParameterValues(request, "emxTableRowId");
	for(String sRowId : sArrTableRowId){
		  String sPersonName = sRowId.split(":")[2].replace("_PRJ", "");
		  String sPersonOID = PersonUtil.getPersonObjectID(context, sPersonName);
		  slPersonOID.add(sPersonOID);
	}
	
	StringList slRelParam = new StringList();
	slRelParam.add(DecConstants.SELECT_ATTRIBUTE_DECPROJECTMEMBERROLE);
	slRelParam.add("to." + DecConstants.SELECT_ATTRIBUTE_FIRSTNAME);
	slRelParam.add("to." + DecConstants.SELECT_ATTRIBUTE_LASTNAME);
	slRelParam.add("to.id");
	RelationshipWithSelectList rwsl = Relationship.getSelectRelationshipData(context, slMemberRELID, slRelParam);
	String sRoleChild = MqlUtil.mqlCommand(context, "print role $1 select $2 dump $3", "decProjectMemberRole", "child.description", "|");
	String[] sArrRoleChild = sRoleChild.split("[|]");
%>
<style>
	.header{
		border-left: 1px solid #b4b6ba;
	    border-top-left-radius: 3px;
	    border-bottom-left-radius: 3px;
	    padding-left: 6px;
	    border: 1px solid #b4b6ba;
		min-height: 26px;
	    color: #2a2a2a;
	    font-weight: bold;
	    background: linear-gradient(to bottom, #f5f6f7 0%,#e2e4e3 100%);
    	padding: 5px;
    	min-width: 150px;
	}
	.even{
		background:#fff;
   		padding: 5px;
	}
	.odd{
		background:#f3f3f3;
    	padding: 5px;
	}
</style>
<emxUtil:localize id="i18nId" bundle="emxProgramCentralStringResource" locale='<xss:encodeForHTMLAttribute><%= request.getHeader("Accept-Language") %></xss:encodeForHTMLAttribute>' />
<script type="text/javascript" src="../common/scripts/jquery-latest.js"></script>
<script language="Javascript" >

	function cancelMethod() {
		getTopWindow().close();
	}
	function doneMethod() {
		document.editForm.submit();
        getTopWindow().opener.getTopWindow().refreshTablePage();
    	parent.turnOffProgress();
		getTopWindow().close();
	}
</script>
<%
	try{
    // ----------- set up the url to do the edit and refresh itself.
    StringBuffer editURL = new StringBuffer("decProjectMemberRoleSettingProcess.jsp?objectId=");
    
    editURL.append(sPSOID);
    
%>
<!-- \\XSSOK -->
<form name="editForm"  target="pagehidden" method="post" onsubmit="doneMethod(); return false" action="<%=editURL.toString()%>">
<div id="pageHeadDiv">
<table>
<tbody>
<tr>
	<td class="page-title"><h2 id="ph"><%=i18nNow.getI18nString("ProgramCentral.Label.ProjectMemberRoleSetting", "emxProgramCentralStringResource", languageStr) %></h2></td>
	<td class="functions">
	<table>
	<tbody>
	<tr>
		<td class="progress-indicator"><div id="imgProgressDiv" style="visibility: hidden;"></div></td>
	</tr>
	</tbody>
	</table>
	</td>
</tr>
</tbody>
</table>
</div>
<div id="mx_divTable">
<table border="0" width="100%" cellpadding="5" cellspacing="2">
  <tr>
<%
	for(RelationshipWithSelect rws : rwsl){
		String sPersonOID = rws.getSelectData("to.id");
		if(!slPersonOID.contains(sPersonOID)){
			continue;
		}
		String sFirstName = rws.getSelectData("to." + DecConstants.SELECT_ATTRIBUTE_FIRSTNAME);
		String sLastName = rws.getSelectData("to." + DecConstants.SELECT_ATTRIBUTE_LASTNAME);
%>
    <td class="header">
    <%=sFirstName%> <%=sLastName%>
	</td>
<%
	}
%>
  </tr>
<%
	for(int i=0; i<sArrRoleChild.length; i++){
		String sRole = sArrRoleChild[i];
		String sEvenOdd = i%2 == 1 ? "even" : "odd";
%>
	<tr>
<%
		for(RelationshipWithSelect rws : rwsl){
			String sPersonOID = rws.getSelectData("to.id");
			if(!slPersonOID.contains(sPersonOID)){
				continue;
			}
			StringList slMemberRole = rws.getSelectDataList(DecConstants.SELECT_ATTRIBUTE_DECPROJECTMEMBERROLE);
%>
	<td class="<%=sEvenOdd%>">
		<input type="checkbox" name="<%=sPersonOID%>" value="<%=sRole%>" <%=slMemberRole.contains(sRole) ? "checked=\"checked\"" : ""%>/> <%=sRole%>
	</td>
<%
		}
%>
	</tr>
<%
	}
%>
</table>
</div>
</form>
<div id="divPageFoot">
<table>
<tbody>
<tr>
    	<td class="functions"></td>
		   <td class="buttons">
		   <table><tbody><tr>
		   <td><a onclick="doneMethod();"><button class="btn-primary" type="button"><%=i18nNow.getI18nString("emxProgramCentral.Button.Done", "emxProgramCentralStringResource", languageStr) %></button></a></td>
		   <td><a onclick="cancelMethod();"><button class="btn-default" type="button"><%=i18nNow.getI18nString("emxProgramCentral.Common.Cancel", "emxProgramCentralStringResource", languageStr) %></button></a></td>
</tr>
</tbody>
</table>
</div>
<%	
	} 
	catch(Exception e)
	{
		e.printStackTrace();
		throw e;
	}
%>
<%@include file = "../emxUICommonEndOfPageInclude.inc" %>
