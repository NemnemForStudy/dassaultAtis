define("DS/XSRCommonComponents/service/CommandsService",["UWA/Class","UWA/Class/Promise","DS/ApplicationFrame/CommandsManager","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/alternate/services/XSpecsAlternateCtxManager","DS/XSRCommonComponents/utils/Notification","text!DS/XSRCommonComponents/assets/config/Commands.json","DS/XSRCommonComponents/utils/ContextManager","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],function(e,t,a,n,o,m,i,c,s){"use strict";return e.singleton({init:function(e){this._commandConfig=JSON.parse(i)},initialize:function(e){var t=this;t.modelEvents=e.modelEvents,t.modelEvents.subscribe({event:n.EVENT_LAUNCH_COMMAND},function(e){t._commandsListener(e)}),t._loadAllCommands()},_commandsListener:function(e){var t=this;if(!e.commandId)throw new Error("commandId is a mandatory parameter");if(!t._commandConfig[e.commandId])throw new Error("command doesn't existing");var o=t._commandConfig[e.commandId];t.commandLoaderStatus.then(function(m){var i;UWA.is(m,"array")&&m.length>0&&m.forEach(function(e){e&&e.value&&e.value._id===o.commandHdr&&(i=e.value._ctx)});var c=t.prepareCmdInput(e.context,e.commandId);e.commandId!==n.SUBSCRIBE_CMD&&e.commandId!==n.UNSUBSCRIBE_CMD&&e.commandId!==n.EDIT_SUBSCRIBE_CMD&&e.commandId!==n.MY_SUBSCRIPTIONS_CMD||(c._selectedItems[0].options.type=c._selectedItems[0].getTypeActualName()),e.commandId===n.INFORMATION_CMD&&(e.context.item&&e.context.item.cmdLaunchAt&&(c.cmdLaunchAt=e.context.item.cmdLaunchAt),c.commandId=e.commandId);var s=a.getCommand(o.commandHdr,i),r=function(){s.execute(c)};t.modelEvents&&t.modelEvents.getEventByName(n.EVENT_SPEC_OTHER_ACTION_CLICK_SLIDEIN_OPEN)?t.modelEvents.publish({event:n.EVENT_SPEC_OTHER_ACTION_CLICK_SLIDEIN_OPEN,data:{callBackFunc:r,cmdId:e.commandId,selNodes:c._selectedItems}}):r()}).catch(function(e){console.log(e)})},_loadAllCommands:function(){var e=this,a=[];for(var n in e._commandConfig)if(e._commandConfig.hasOwnProperty(n)){var o=e._commandConfig[n],m=new t(function(t,a){e.loadCommand(o,t,a)});a.push(m)}return e.commandLoaderStatus=t.allSettled(a),e.commandLoaderStatus},loadCommand:function(e,t,a){if(!e||!e.commandHdr||!e.AmdLoader)return console.error("Oups ! no valid command description"),void a("Oups ! no valid command description");var n=this;return require([e.AmdLoader],function(a){var o={context:c.getContext(),ID:e.commandHdr,modelEvents:n.modelEvents};a&&t(new a(o))},function(e){a(e)})},_getObjectAdditionnalData:function(e){return{type:e.getTypeActualName(),name:e.getTitle(),displayName:e.getTitle(),revision:e.getRevision(),physicalid:e.getID()}},prepareCmdInput:function(e,t){var a={},m=[];if(e.item){var i=[],s=e.item.data||e.item;if(s)if(Array.isArray(s))for(var r=0;r<s.length;r++)m.push(this._getObjectAdditionnalData(s[r])),i.push(s[r]);else s=[e.item.data||e.item],i.push(e.item.data||e.item);var d=i.length>1;if(e.item.nodeModels){let t=e.item.nodeModels;c.setGridChildNodes(t)}c.addSelection(i);let p=e.item.selectFacet?e.item.selectFacet:void 0;if(a={_selectedItems:s},t)switch(t){case n.ENGINEERING_ITEM_REVISE:case n.DUPLICATE_CMD:case n.CHANGE_OWNER_CMD:case n.MULTI_OWNERSHIP_CMD:a.type=s[0].getTypeActualName(),a.typeDisplayName=s[0].getType(),a.name=s[0].getTitle(),a.displayName=s[0].getTitle(),a.revision=s[0].getRevision(),a.physicalid=s[0].getID();break;case n.MATURITY_GRAPH_CMD:d?(a=m)._selectedItems=s:(a.physicalid=s[0].getID(),a.type=s[0].getTypeActualName?s[0].getTypeActualName():s[0].getType(),a.typeDisplayName=s[0].getType(),a.name=s[0].getTitle?s[0].getTitle():s[0].getLabel(),a.displayName=s[0].getTitle?s[0].getTitle():s[0].getLabel(),a.revision=s[0].getRevision?s[0].getRevision():s[0].getReferenceVersion());break;case n.INFORMATION_CMD:if(a.physicalid=s[0].getID(),a.propWidth=e.item.propWidth,a.selectFacet=p,s[0].appCore){s[0].appCore.contextManager=o.getContext();let e=null;(e=s[0].getParent()&&s[0].getParent().getID?s[0].getParent():s[0].appCore.specRouteManager.getActiveSpecItem())?s[0].appCore.contextManager.setActiveEngItem(e):s[0].appCore.contextManager.setActiveEngItem(s[0]),s[0].appCore.contextManager.setSelectedNodes([s[0]])}break;case n.FILTER_CMD:a.commandId=t,a.appCore=e.item.appCore;break;case n.SUBSCRIBE_CMD:case n.UNSUBSCRIBE_CMD:case n.EDIT_SUBSCRIBE_CMD:case n.MY_SUBSCRIPTIONS_CMD:a.type=s[0].getTypeActualName();break;case n.OPEN_ALTERNATES:if(a.physicalid=s[0].getID(),s[0].appCore){s[0].appCore.orgContextManager=s[0].appCore.contextManager,s[0].appCore.contextManager=o.getContext();let e=null;e=void 0===s[0].appCore.specRouteManager?s[0].parentNode:s[0].appCore.specRouteManager.getActiveSpecItem(),s[0].appCore.contextManager.setActiveEngItem(e),s[0].appCore.contextManager.setSelectedNodes([s[0]])}a.commandId=n.OPEN_ALTERNATES;break;case n.OPEN_INFO_WIDGET:if(a.physicalid=s[0].getID(),s[0].appCore){s[0].appCore.orgContextManager=s[0].appCore.contextManager,s[0].appCore.contextManager=o.getContext();let e=null;e=void 0===s[0].appCore.specRouteManager?s[0].parentNode:s[0].appCore.specRouteManager.getActiveSpecItem(),s[0].appCore.contextManager.setActiveEngItem(e),s[0].appCore.contextManager.setSelectedNodes([s[0]])}a.commandId=n.OPEN_INFO_WIDGET;break;default:a.physicalid=s?s[0].getID():e.item.physicalid}return a}}})});