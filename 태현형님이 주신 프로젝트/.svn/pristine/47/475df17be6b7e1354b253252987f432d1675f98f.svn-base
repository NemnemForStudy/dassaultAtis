define("DS/CAT3DWRichLinksUI/CAT3DWExternalRichLinkProcessingUtils",["UWA/Data","UWA/Class","UWA/Promise"],function(t,e,n){"use strict";var i=e.extend({init:function(){},getURLInformation:function(t,e){return new n(function(n,i){var a=new URL(t),r={url:a.hostname};this.requestExternalUrl({url:t,responseType:"text",proxy:e}).then(function(t){var i=t.headers.get("content-type");if(i.match(/text\/html/g)||i.match(/application\/xhtml/g)){var s=(new DOMParser).parseFromString(t.data,"text/html"),o=s.getElementsByTagName("meta"),c=s.getElementsByTagName("link");r.title=s.title,r.description=null;var l=null,u=null,h=null,m=null;if(o){o.description&&(r.description=o.description.content);for(let t=0;t<o.length;t++)!r.title&&o[t].getAttribute("property")&&"og:title"===o[t].getAttribute("property")&&(r.title=o[t].getAttribute("content")),!r.description&&o[t].getAttribute("property")&&"og:description"===o[t].getAttribute("property")&&(r.description=o[t].getAttribute("content")),o[t].getAttribute("property")&&"og:image"===o[t].getAttribute("property")&&(l=o[t].getAttribute("content"))}if(c){for(let t=0;t<c.length;t++){if(c[t].getAttribute("rel")&&"icon"===c[t].getAttribute("rel")){if(c[t].getAttribute("sizes")&&h&&parseInt(c[t].getAttribute("sizes"))<h)continue;u=c[t].getAttribute("href"),h=c[t].getAttribute("sizes")?parseInt(c[t].getAttribute("sizes")):h}c[t].getAttribute("rel")&&"shortcut icon"===c[t].getAttribute("rel")&&(m=c[t].getAttribute("href")),c[t].getAttribute("rel")&&"icon shortcut"===c[t].getAttribute("rel")&&(m=c[t].getAttribute("href"))}var p=u||m}}r.title||(r.title=a.hash);var d=0;if(p&&d++,l&&d++,0===d)n(r);else{var f=0,g=function(){++f===d&&n(r)};l&&this.requestExternalUrl({url:l,responseType:"blob",proxy:e}).then(function(t){if(t.data.type.includes("image/")){var e=URL.createObjectURL(t.data);r.image=e}g()}).catch(function(){g()}),p&&this.requestExternalUrl({url:p,responseType:"blob",proxy:e}).then(function(t){if(t.data.type.includes("image/")){var e=URL.createObjectURL(t.data);r.favicon=e}g()}).catch(function(){g()})}}.bind(this)).catch(function(){n()})}.bind(this))},requestExternalUrl:function(t){return new n(function(e,n){var i=UWA.Data;UWA.Data.proxies.ajax.contains("netvibes")&&window.parent&&window.parent.UWA&&window.parent.UWA.Data&&window.parent.UWA.Data.proxies&&(i=window.parent.UWA.Data);var a=t.proxy?t.proxy:"ajax",r=t.responseType?t.responseType:"text",s=t.url;s.startsWith("//")&&(s="https:"+s),s.startsWith("http://")||s.startsWith("https://")||(s="https://"+s);var o=i.proxifyUrl(s,{proxy:a});i.request(o,{proxy:a,timeout:15e3,type:r,onComplete:function(t,n){var i=new Headers(n);e({data:t,headers:i})},onTimeout:function(){console.warn("request url timed out"),n()},onFailure:function(t){t&&console.warn(t),n()}})})}});return UWA.namespace("DS/CAT3DWRichLinksUI/CAT3DWExternalRichLinkProcessingUtils",i)}),define("DS/CAT3DWRichLinksUI/CAT3DWLinkPlaceholderHtmlView",["UWA/Class","DS/VENWebHtml2Canvas/Html2Canvas","css!DS/CAT3DWRichLinksUI/CAT3DWRichLinksUI","i18n!DS/CAT3DWRichLinksUI/assets/nls/CAT3DWLinkPlaceholderHtmlView"],function(t,e,n,i){"use strict";var a=t.extend({init:function(t){this._mainContainerClassName="link-placeholder-view",this._mainContainer=null,this._viewParams=t},getHTML:function(){return this._mainContainer||this._build(this._viewParams),this._mainContainer},getCanvas:function(){return new Promise(function(t,n){var i=new e,a=this.getHTML();document.body.append(a),i.htmlToCanvas(a,{onclone:function(t){var e=t.getElementsByClassName(this._mainContainerClassName);e&&(e[e.length-1].style.opacity="1")}.bind(this),allowTaint:!0,useCORS:!0,scale:2}).then(function(e){this.clean(),t(e)}.bind(this)).catch(function(){this.clean(),n()}.bind(this))}.bind(this))},clean:function(){this._mainContainer.remove(),this._mainContainer=null},_build:function(t){this._mainContainer=new UWA.Element("div",{class:this._mainContainerClassName});var e=new UWA.Element("div",{class:"placeholder-image-container"}).inject(this._mainContainer),n=new UWA.Element("div",{class:"placeholder-data-container"}).inject(this._mainContainer);new UWA.Element("div",{class:"placeholder-icon",html:{tag:"span",class:"fonticon fonticon-doc-link "}}).inject(e),new UWA.Element("span",{class:"placeholder-url",text:t.url}).inject(n),new UWA.Element("div",{class:"placeholder-processingmsg",text:i.get("processingMsg")}).inject(n)}});return UWA.namespace("DS/CAT3DWRichLinksUI/CAT3DWLinkPlaceholderHtmlView",a)}),define("DS/CAT3DWRichLinksUI/CAT3DWLinkFullHtmlView",["UWA/Class","DS/VENWebHtml2Canvas/Html2Canvas","css!DS/CAT3DWRichLinksUI/CAT3DWRichLinksUI","i18n!DS/CAT3DWRichLinksUI/assets/nls/CAT3DWLinkFullHtmlView"],function(t,e,n,i){"use strict";var a=t.extend({init:function(t){this._mainContainerClassName="link-full-view",this._mainContainer=null,this._viewParams=t},getHTML:function(){return new Promise(async function(t,e){this._mainContainer||await this._build(this._viewParams),t(this._mainContainer)}.bind(this))},getCanvas:function(){return new Promise(async function(t,n){var i=new e,a=await this.getHTML();document.body.append(a),i.htmlToCanvas(a,{onclone:function(t){var e=t.getElementsByClassName(this._mainContainerClassName);e&&(e[e.length-1].style.opacity="1")}.bind(this),allowTaint:!0,useCORS:!0,scale:2}).then(function(e){this.clean(),t(e)}.bind(this)).catch(function(){this.clean(),n()}.bind(this))}.bind(this))},clean:function(){this._mainContainer.remove(),this._mainContainer=null},_build:function(t){return new Promise(async function(e,n){t||console.warn("[CAT3DWLinkFullHtmlView : no params to build link view]"),this._mainContainer=new UWA.Element("div",{class:this._mainContainerClassName});var a=new UWA.Element("div",{class:"linkfull-header-container"}).inject(this._mainContainer),r=new UWA.Element("div",{class:"linkfull-body-container"}).inject(this._mainContainer),s=new UWA.Element("div",{class:"linkfull-title-container"}).inject(a),o=new UWA.Element("div",{class:"linkfull-subtitle-container"}).inject(r),c=new UWA.Element("div",{class:"linkfull-message-container"}).inject(r),l=this._getFonticon(t.type),u=(new UWA.Element("div",{class:"preview-icon",html:{tag:"span",class:"fonticon "+l.name},styles:{color:l.color,"background-color":l.bkcolor}}).inject(s),new UWA.Element("div",{class:"preview-title",text:t.title}).inject(s),new UWA.Element("div",{class:"preview-author-community",html:[{tag:"span",text:i.get("authorPrep")+" "},{tag:"a",text:t.author},{tag:"span",text:" "+i.get("communityPrep")+" "},{tag:"a",text:t.community}]}).inject(o),new UWA.Element("div",{class:"preview-message"}).inject(c));u.innerHTML=t.message;var h=u.getElementsByTagName("img");if(!h.length)return void e();for(let e=0;e<h.length;e++)h[e].dataset.mediaId&&(h[e].src=t.images.get(h[e].dataset.mediaId).url);let m=setInterval(()=>{let t=!0;for(let e=0;e<h.length;e++)if(!h[e].complete){t=!1;break}t&&(clearInterval(m),m=void 0,e())},10)}.bind(this))},_getFonticon:function(t){switch(t){case"posts":case"post":return{name:"fonticon-newspaper",color:"white",bkcolor:"#adadad"};case"idea":return{name:"fonticon-lightbulb",color:"white",bkcolor:"#00b8de"};case"iquestion":return{name:"fonticon-i-question",color:"white",bkcolor:"#ea4f37"};case"wiki":return{name:"fonticon-book-open",color:"white",bkcolor:"#00aa86"};default:return{name:"fonticon-globe",color:"#77797c",bkcolor:"white"}}}});return UWA.namespace("DS/CAT3DWRichLinksUI/CAT3DWLinkFullHtmlView",a)}),define("DS/CAT3DWRichLinksUI/CAT3DWLinkProcessingUtils",["UWA/Class","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWUrlServices","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/WAFData/WAFData","DS/CAT3DWInfra/CAT3DW3DSwymMediaServices"],function(t,e,n,i,a,r){"use strict";var s=t.extend({init:function(t){this._platformId=t.platformId,this._platformUrl=t.platformUrl,this._hostUrl=t.originUrl,this._appName=t.appName,this._uwarequestor=UWA.Data,!this._appName&&UWA.Data.proxies.ajax.contains("netvibes")&&window.parent&&window.parent.UWA&&window.parent.UWA.Data&&window.parent.UWA.Data.proxies&&(this._uwarequestor=window.parent.UWA.Data),this._debugMode=t.debugMode,this._urlService=new n,this._swymMediaServices=new r({platformId:this._platformId}),this._appName&&this._hostUrl&&(this._uwarequestor.proxies.ajax=this._hostUrl+"/resources/3DStory/en/webapps/UWA2/js/Ajax.js")},isHTTPLinkFormat:function(t){var e=t.trim();return!(!e.startsWith("http://")&&!e.startsWith("https://"))&&this.isLinkFormat(e)},isLinkFormat:function(t){return!(!this._urlService.isValidHttpUrl(t)||t.contains(" "))},processLink:function(t){return new Promise(function(e,n){this._debugMode&&console.time("[CAT3DWLinkProcessingUtils] Process link : "+t);var i=this.formatLink(t),a=function(n){this._debugMode&&console.timeEnd("[CAT3DWLinkProcessingUtils] Process link : "+t),e(n)}.bind(this);this.getLinkType(i).then(this.getContentType.bind(this)).then(function(t){t.type===s.LINK_INTERNAL?this.getPlatformContent(t).then(function(t){a(t)}).catch(function(t){this.getWebContent(t).then(function(t){a(t)}).catch(function(t){a(t)})}.bind(this)):t.type===s.LINK_EXTERNAL&&this.getWebContent(t).then(function(t){a(t)}).catch(function(t){a(t)})}.bind(this))}.bind(this))},formatLink:function(t){var e=t.trim();return e.startsWith("//")&&(e="https:"+e),e.startsWith("http://")||e.startsWith("https://")||(e="https://"+e),e},getLinkType:function(t){return new Promise(function(e,n){this._getPlatformUrl().then(function(n){var i=!1,a=t.startsWith(n);if(!a){var r=null!==t.match("#app:X3DMCTY_AP")&&2===t.match(/content:url=(.*?(?=&))/i).length&&t.match(/content:url=(.*?(?=&))/i)[1].replace(/%3A/g,":").replace(/%2F/g,"/").replace(/%2e/g,".");i=n&&n===r}e(i||a?{url:t,type:s.LINK_INTERNAL}:{url:t,type:s.LINK_EXTERNAL})}.bind(this)).catch(function(n){e({url:t,type:s.LINK_EXTERNAL})}.bind(this))}.bind(this))},getContentType:function(t){return new Promise(function(e,n){if(t.type===s.LINK_EXTERNAL)t.content_type=s.CONTENT_UNKNOWN,e(t);else if(t.type===s.LINK_INTERNAL){var i,a,r=t.url;r.contains("#app")?(a=r.match(/contentType=([^&]*)/i)[1],i=r.match(/contentId=([^&]*)/i)[1]):r.contains("post")?(a=s.CONTENT_POST,i=r.match(/post:([^/]{0,})/i)[1]):r.contains("question")?(a=s.CONTENT_QUESTION,i=r.match(/question:([^/]{0,})/i)[1]):r.contains("idea")?(a=s.CONTENT_IDEA,i=r.match(/idea:([^/]{0,})/i)[1]):r.contains("wiki")?(a=s.CONTENT_WIKI,i=r.match(/wiki:([^/]{0,})/i)[1]):r.contains("media")?(a=s.CONTENT_MEDIA,i=r.match(/media:([^/]{0,})/i)[1]):r.contains("survey")?(a=s.CONTENT_SURVEY,i=r.match(/survey:([^/]{0,})/i)[1]):r.contains("wedo")?(a=s.CONTENT_WEDO,i=r.match(/wedo:([^/]{0,})/i)[1]):(a=s.CONTENT_UNKNOWN,i=null),t.content_type=a,t.content_id=i,e(t)}})},getPlatformContent:function(t){return new Promise(function(n,i){this._getPlatformUrl().then(e.getCsrfToken.bind(this)).then(function(a){e.search({url:a.url,token:a.token,legacyFormat:!1,query:"#all",contentType:t.content_type,refineUsingQuery:'id:"'+t.content_id+'"',nresults:1,start:0}).then(async function(r){if(0!==r.nhits){var o=r.hits[0].metas;t.content={};for(var c=0;c<o.length;c++){if("id"===o[c].name&&t.content_id!==o[c].value)return t.content_type=s.CONTENT_UNKNOWN,delete t.content_id,void i(t);"title"===o[c].name&&(t.content.title=o[c].value),"name"===o[c].name&&(t.content.author=o[c].value),"ds6w_58_community"===o[c].name&&(t.content.community=o[c].value),"ds6w_58_description"===o[c].name&&(t.content.description=o[c].value),"preview_media_type"===o[c].name&&(t.content.mediaType=o[c].value),"ResourceURL"===o[c].name&&(t.content.resourceURL=o[c].value),"preview_url"===o[c].name&&o[c].value&&(t.content.thumbnail_original_url=o[c].value)}var l=function(){return new Promise(function(e,n){t.content.thumbnail_original_url?this._getImageBlobUrl(t.content.thumbnail_original_url).then(function(n){t.content.thumbnail_blob_url=n,e()}.bind(this)).catch(function(){delete t.content.thumbnail_original_url,e()}.bind(this)):e()}.bind(this))}.bind(this),u=function(){return new Promise(function(n,i){var r={},o="";if(t.content_type===s.CONTENT_POST)o="/api/post/get",r.community_post_id=t.content_id;else if(t.content_type===s.CONTENT_QUESTION)o="/api/question/get",r.iQuestions_id=t.content_id;else if(t.content_type===s.CONTENT_IDEA)o="/api/idea/get",r.id=t.content_id;else{if(t.content_type!==s.CONTENT_WIKI)return void n();o="/api/wiki/get",r.id=t.content_id}e.callPlatformWebService({url:a.url,params:r,api:o,token:a.token,returnPromise:!1,onSuccessCB:function(e){if(t.content_type===s.CONTENT_QUESTION?t.content.message=e.result.question:t.content.message=e.result.message,!e.result.thumbnails_infos.length)return void n();let i=[],a=e.result.thumbnails_infos;for(let t=0;t<a.length;t++)!0===a[t].user_access&&"processed"===a[t].preview_media_processing_status&&i.push({mediaId:a[t].media_id});this._swymMediaServices.getMedias(i,function(){}).then(async function(e){t.content.images_infos=new Map;for(let n=0;n<e.length;n++){var i=e[n].mediaId.split("media:")[1];t.content.images_infos.set(i,{url:e[n].url})}n()}.bind(this)).catch(function(){n()}.bind(this))}.bind(this),onFailCB:function(){n()}})}.bind(this))}.bind(this);await l(),await u(),n(t)}else t.content_type=s.CONTENT_UNKNOWN,delete t.content_id,i(t)}.bind(this)).catch(function(){t.content_type=s.CONTENT_UNKNOWN,delete t.content_id,i(t)}.bind(this))}.bind(this)).catch(function(){t.content_type=s.CONTENT_UNKNOWN,delete t.content_id,i(t)}.bind(this))}.bind(this))},isCrossInternalDomain:function(t){var e=new URL(t);return!(this._appName||!(window.top.bundles.ifwe||window.top.dsResourceUrl&&!window.top.dsResourceUrl.includes(e.host)))||!(!this._appName||this._hostUrl.includes(e.host))},getWebContent:function(t){return new Promise(function(e,n){var i={};i.url=t.url,i.responseType="text",i.requestor=this.getUWARequestor(),t.type===s.LINK_EXTERNAL?i.proxy="ajax":t.type===s.LINK_INTERNAL&&this.isCrossInternalDomain(t.url)?i.proxy="passport":i.proxy=null,this.requestUrl(i).then(function(n){t.content={};var a=n.headers.get("content-type");if(a.match(/text\/html/g)||a.match(/application\/xhtml/g)){var r=(new DOMParser).parseFromString(n.data,"text/html"),s=r.getElementsByTagName("meta");r.getElementsByTagName("link");t.content.title=r.title,t.content.description=null;if(s){s.description&&(t.content.description=s.description.content);for(let e=0;e<s.length;e++)!t.content.title&&s[e].getAttribute("property")&&"og:title"===s[e].getAttribute("property")&&(t.content.title=s[e].getAttribute("content")),!t.content.description&&s[e].getAttribute("property")&&"og:description"===s[e].getAttribute("property")&&(t.content.description=s[e].getAttribute("content")),s[e].getAttribute("property")&&"og:image"===s[e].getAttribute("property")&&(t.content.thumbnail_original_url=s[e].getAttribute("content"))}}var o=new URL(i.url);t.content.hostname=o.hostname,t.content.title||(t.content.title=o.hash),t.content.thumbnail_original_url?this._getImageBlobUrl(t.content.thumbnail_original_url).then(function(n){t.content.thumbnail_blob_url=n,e(t)}.bind(this)).catch(function(){delete t.content.thumbnail_original_url,e(t)}.bind(this)):e(t)}.bind(this)).catch(function(){t.notreachable=!0,n(t)}.bind(this))}.bind(this))},requestUrl:function(t){return new Promise(function(e,n){var r=t.requestor,s=t.proxy,o=t.responseType?t.responseType:"text",c=null;this._appName&&"passport"===s?(i.getPreferenceValue("M3DEMobile")?a.proxifiedRequest:a.authenticatedRequest)(c=t.url,{proxy:s,method:"GET",type:o,onComplete:function(t,n){var i=new Headers(n);e({data:t,requestedUrl:c,headers:i})}.bind(this),onTimeout:function(t){t&&console.warn(t),n(new Error("[CAT3DWLinkProcessingUtils] requestUrl() timeout"))}.bind(this),onFailure:function(t){t&&console.warn(t),n(new Error("[CAT3DWLinkProcessingUtils] requestUrl() failed"))}.bind(this)}):(c=s?r.proxifyUrl(t.url,{proxy:s}):t.url,r.request(c,{proxy:s,timeout:1e4,type:o,onComplete:function(t,n){var i=new Headers(n);e({data:t,requestedUrl:c,headers:i})}.bind(this),onTimeout:function(t){t&&console.warn(t),n(new Error("[CAT3DWLinkProcessingUtils] requestUrl() timeout"))}.bind(this),onFailure:function(t){n(new Error("[CAT3DWLinkProcessingUtils] requestUrl() failed"))}.bind(this)}))}.bind(this))},getUWARequestor:function(){return this._uwarequestor},_getImageBlobUrl:function(t){return new Promise(function(e,n){this.getLinkType(t).then(function(t){var i={};i.url=t.url,i.responseType="blob",i.requestor=this.getUWARequestor(),t.type===s.LINK_EXTERNAL?i.proxy="ajax":t.type===s.LINK_INTERNAL&&this.isCrossInternalDomain(t.url)?i.proxy="passport":i.proxy=null,this.requestUrl(i).then(function(t){if(t.data&&t.data.type.includes("image/")){var i=URL.createObjectURL(t.data);e(i)}else n()}.bind(this)).catch(function(){n()})}.bind(this))}.bind(this))},_getPlatformUrl:function(){return this._platformUrl?new Promise(function(t){t(this._platformUrl)}.bind(this)):new Promise(function(t,n){e.get3DSwym(this._platformId).then(function(e){this._platformUrl=e,t(this._platformUrl)}.bind(this)).catch(function(t){n(t)}.bind(this))}.bind(this))}});return s.LINK_INTERNAL="internal",s.LINK_EXTERNAL="external",s.CONTENT_UNKNOWN="unknown",s.CONTENT_POST="posts",s.CONTENT_QUESTION="iquestion",s.CONTENT_IDEA="idea",s.CONTENT_WIKI="wiki",s.CONTENT_MEDIA="media",s.CONTENT_SURVEY="survey",s.CONTENT_WEDO="WeDo",s}),define("DS/CAT3DWRichLinksUI/CAT3DWRichLinkHtmlView",["UWA/Class","DS/VENWebHtml2Canvas/Html2Canvas","css!DS/CAT3DWRichLinksUI/CAT3DWRichLinksUI","i18n!DS/CAT3DWRichLinksUI/assets/nls/CAT3DWRichLinkHtmlView"],function(t,e,n,i){"use strict";var a=t.extend({init:function(t){this._mainContainerClassName="rich-link-preview",this._mainContainer=null,this._viewParams=t},getHTML:function(){return this._mainContainer||this._build(this._viewParams),this._mainContainer},getCanvas:function(){return new Promise(function(t,n){var i=new e,a=this.getHTML();document.body.append(a),i.htmlToCanvas(a,{onclone:function(t){var e=t.getElementsByClassName(this._mainContainerClassName);e&&(e[e.length-1].style.opacity="1")}.bind(this),allowTaint:!0,useCORS:!0,scale:2}).then(function(e){this.clean(),t(e)}.bind(this)).catch(function(){this.clean(),n()}.bind(this))}.bind(this))},clean:function(){this._mainContainer.remove(),this._mainContainer=null},_build:function(t){t||console.warn("[CAT3DWRichLinkHTMLView : no params to build link view]"),this._mainContainer=new UWA.Element("div",{class:this._mainContainerClassName});var e=new UWA.Element("div",{class:"preview-image-container"}).inject(this._mainContainer),n=new UWA.Element("div",{class:"preview-data-container"}).inject(this._mainContainer);if(t.thumbnail)new UWA.Element("img",{class:"preview-thumbnail",src:t.thumbnail}).inject(e);if(t.favicon&&!t.type)new UWA.Element("img",{class:"preview-favicon",src:t.favicon}).inject(e);else{var a=this._getFonticon(t.type,t.mediaType);new UWA.Element("div",{class:"preview-icon",html:{tag:"span",class:"fonticon "+a.name},styles:{color:a.color,"background-color":a.bkcolor}}).inject(e)}if(t.title)new UWA.Element("span",{class:"preview-title",text:this._truncate(t.title,80)}).inject(n);if(t.url||t.author||t.community){var r=new UWA.Element("div",{class:"preview-domain"}).inject(n);if(t.author&&t.community)new UWA.Element("div",{class:"preview-author-community",html:[{tag:"span",text:i.get("authorPrep")+" "},{tag:"a",text:t.author},{tag:"span",text:" "+i.get("communityPrep")+" "},{tag:"a",text:t.community}]}).inject(r);else if(t.url||t.hash){var s=t.hash?t.hash:t.url;new UWA.Element("a",{text:s}).inject(r)}}if(t.description)new UWA.Element("span",{class:"preview-description",text:this._truncate(t.description,150)}).inject(n)},_truncate:function(t,e){return t.length>e?t.substr(0,e-1)+"...":t},_getFonticon:function(t,e){switch(t){case"posts":case"post":return{name:"fonticon-newspaper",color:"white",bkcolor:"#adadad"};case"idea":return{name:"fonticon-lightbulb",color:"white",bkcolor:"#00b8de"};case"iquestion":return{name:"fonticon-i-question",color:"white",bkcolor:"#ea4f37"};case"survey":return{name:"fonticon-clipboard",color:"white",bkcolor:"#e87b00"};case"WeDo":return{name:"fonticon-task",color:"white",bkcolor:"#005686"};case"media":var n=e;return"sketch"===e&&(n="app-3dsketch"),"whiteboard"===e&&(n="app-whiteboard"),"document"===e&&(n="doc"),"animatedPicture"===e&&(n="picture-animated"),"3d_model"===e&&(n="cube"),"story"===e&&(n="app-3dstory"),{name:"fonticon-"+n,color:"white",bkcolor:"#70036b"};case"wiki":return{name:"fonticon-book-open",color:"white",bkcolor:"#00aa86"};default:return{name:"fonticon-globe",color:"#77797c",bkcolor:"white"}}}});return UWA.namespace("DS/CAT3DWRichLinksUI/CAT3DWRichLinkHtmlView",a)}),define("DS/CAT3DWRichLinksUI/CAT3DWInternalRichLinkProcessingUtils",["UWA/Class","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWRichLinksUI/CAT3DWExternalRichLinkProcessingUtils","UWA/Promise"],function(t,e,n,i,a){"use strict";var r=t.extend({init:function(){this._externalRichLinkUtils=new i},getSwymContentData:function(t){return new a(function(n,i){var a,r,s={};t.contains("#app")?(r=t.match(/contentType=([^&]*)/i)[1],a=t.match(/contentId=([^&]*)/i)[1]):t.contains("post")?(r="posts",a=t.match(/post:([^/]{0,})/i)[1]):t.contains("iquestion")?(r="iquestion",a=t.match(/iquestion:([^/]{0,})/i)[1]):t.contains("idea")?(r="idea",a=t.match(/idea:([^/]{0,})/i)[1]):t.contains("wiki")?(r="wiki",a=t.match(/wiki:([^/]{0,})/i)[1]):t.contains("media")?(r="media",a=t.match(/media:([^/]{0,})/i)[1]):t.contains("survey")?(r="survey",a=t.match(/survey:([^/]{0,})/i)[1]):t.contains("wedo")&&(r="WeDo",a=t.match(/wedo:([^/]{0,})/i)[1]),r?(s.type=r,this.getSwymURL().then(e.getCsrfToken.bind(this)).then(function(i){e.search({url:i.url,token:i.token,legacyFormat:!1,query:"#all",contentType:r,refineUsingQuery:'id:"'+a+'"',nresults:1,start:0}).then(function(e){var i=!1;if(s.url=t,s.searchSucceeded=!0,s.searchNbResults=e.nhits,0!==e.nhits){for(var r=e.hits[0].metas,o=null,c=0;c<r.length;c++){if("id"===r[c].name&&a!==r[c].value)return;if("title"===r[c].name&&(s.title=r[c].value),"name"===r[c].name&&(s.author=r[c].value),"ds6w_58_community"===r[c].name&&(s.community=r[c].value),"ds6w_58_description"===r[c].name&&(s.description=r[c].value),"preview_media_type"===r[c].name&&(s.mediaType=r[c].value),"preview_url"===r[c].name&&r[c].value){o=r[c].value;var l=new URL(o);window.top.bundles.ifwe||window.top.dsResourceUrl&&!window.top.dsResourceUrl.includes(l.host)?(i=!0,this._externalRichLinkUtils.requestExternalUrl({url:o,responseType:"blob",proxy:"passport"}).then(function(t){if(t.data.type.includes("image/")){var e=URL.createObjectURL(t.data);s.image=e}n(s)}).catch(function(){n(s)})):s.image=o}}i||n(s)}else this._externalRichLinkUtils.getURLInformation(t,"passport").then(function(t){n(t)})}.bind(this)).catch(function(){this._externalRichLinkUtils.getURLInformation(t,"passport").then(function(t){n(t)})}.bind(this))}.bind(this))):this._externalRichLinkUtils.getURLInformation(t,"passport").then(function(t){n(t)})}.bind(this))},getSwymURL:function(){var t=n.getPreferenceValue("swymTenant");return t?(t=t.toUpperCase(),e.get3DSwym(t)):a.resolve(!1)}});return UWA.namespace("DS/CAT3DWRichLinksUI/CAT3DWInternalRichLinkProcessingUtils",r)}),define("DS/CAT3DWRichLinksUI/CAT3DWRichLinkPreviewGenerator",["UWA/Core","UWA/Class/Events","UWA/Class/Listener","DS/CAT3DWRichLinksUI/CAT3DWExternalRichLinkProcessingUtils","DS/CAT3DWRichLinksUI/CAT3DWInternalRichLinkProcessingUtils","DS/CAT3DWRichLinksUI/CAT3DWRichLinkHtmlView","UWA/Promise"],function(t,e,n,i,a,r,s){"use strict";return n.singleton(e,{init:function(){this._externalRichLinkUtils=new i,this._internalRichLinkUtils=new a},getContentFromUrl:function(t){return new Promise(function(e){return this._isSwymContentUrl(t).then(function(n){if(!n)return this._externalRichLinkUtils.getURLInformation(t,"ajax").then(function(t){e(t)});t&&this._internalRichLinkUtils.getSwymContentData(t).then(function(t){e(t)})}.bind(this)).catch(function(t){t&&console.log(t)})}.bind(this))},createLinkPreview:function(t){return new r({title:t.title,description:t.description,thumbnail:t.image,favicon:t.favicon,type:t.type,url:t.url,author:t.author,community:t.community,mediaType:t.mediaType}).getHTML()},createPreview:function(t){return new Promise(function(e){this.getContentFromUrl(t).then(function(t){if(t){var n=this.createLinkPreview(t);e(n)}else e(!1)}.bind(this))}.bind(this))},_isSwymContentUrl:function(t){return this._internalRichLinkUtils.getSwymURL().then(function(e){var n=!1,i=t.startsWith(e);if(!i){var a=null!==t.match("#app:X3DMCTY_AP")&&2===t.match(/content:url=(.*?(?=&))/i).length&&t.match(/content:url=(.*?(?=&))/i)[1].replace(/%3A/g,":").replace(/%2F/g,"/").replace(/%2e/g,".");n=e&&e===a}return n||i})}})});