define("DS/SpecGridView/controller/GridColumn",["DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/Utils","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/Toggle","DS/XSRCommonComponents/utils/TypeUtils","i18n!DS/SpecGridView/assets/nls/SpecGridView"],function(e,t,n,o,a,i,r){"use strict";function l(e){return this}return l.prototype.process=function(l){var s=this;return l&&l.forEach(function(l){l.text=l.text,l.editableFlag&&l.forbiddenCheck&&(s.columnCharValidationList[l.dataIndex]=!0),!1!==l.exportFlag&&s.exportableColums.push(l.dataIndex),l.editableFlag&&(l.getCellEditableState=function(e){var n=e.nodeModel;return!(!n||!n.getID||t.isOriginatedInGLS(n))&&n.hasAccess("modify")}),"uomupdated"===l.dataIndex&&(l.getCellValue=function(t){var l=UWA.createElement("div",{class:"uom-container"}),d=widget.getValue(e.PERSISTENCY_BOM_VIEW);if((g=t.nodeModel)&&g._canBeGrouped()){var u=!0,c=!0;"function"==typeof g.getCQInstance&&g.getCQInstance()?u=!0:"boolean"!=typeof d||d?"function"==typeof g.IsComputed&&g.IsComputed()&&(u=!1):u=!1,u&&"EA (each)"==g.options.grid.uom&&(c=!1),!s.parentModel||"Released"!==s.parentModel.options.maturity&&"Released"!==s.parentModel.options.grid["ds6w:status"]||(u=!1);var g=t.nodeModel,p=Object.entries(i.getUOMUnits(g.options.grid.quantityType,g.options.grid.quantityTypeDBName)),m=[],C=new Map;p.forEach(function(e){m.push(e[1]),C.set(e[1],e[0])}),m.sort(function(e,t){return(e=e.toLowerCase())==(t=t.toLowerCase())?0:e>t?1:-1});var f=t.nodeModel.getUnitOfMeasure(),I=g.getAttributeValue("quantity"),v=null==I||null==I||"0.0"==I?"":I,M=-1;null!=f&&(M=m.indexOf(f));var h=g.getasNeeded(),y=v+(null==f||null==f||""==v?"":f)+(h?" "+r.label_As_Required:"");""==y&&i.isRawMaterial(g.getTypeActualName())&&(y=r.placeholder_UOM_Details);var x=UWA.createElement("div",{class:"readonly-container",html:y}).inject(l),b=UWA.createElement("div",{class:"uom-container-edit xsr-grid-wux-hide"}).inject(l);u&&x.addEventListener("click",function(){document.querySelectorAll(".readonly-container").forEach(e=>{e.hasClassName("xsr-grid-wux-hide")&&e.toggleClassName("xsr-grid-wux-hide")}),document.querySelectorAll(".uom-container-edit").forEach(e=>{e.hasClassName("xsr-grid-wux-hide")||e.toggleClassName("xsr-grid-wux-hide")}),x.addClassName("xsr-grid-wux-hide"),b.toggleClassName("xsr-grid-wux-hide")});var D=new a({label:r.label_As_Required,type:"switch",checkFlag:h});D.getContent().addClassName("xsr-grid-wux-inline"),D.addEventListener("buttonclick",function(e){var n=e.dsModel.checkFlag;let o=g.getAttributeValue("quantity");null!=o&&parseFloat(o)<=0?(s.activeCellId=null,e.preventDefault(),e.stopPropagation(),D.checkFlag=!0):(s.activeCellId=t.cellID,g.updateOptions({grid:{asNeeded:n}}))});var w=c?"([0-9]*[.])?[0-9]+":"[0-9]+",R=new n({placeholder:r.placeholder_Quantity,value:v,pattern:w,selectAllOnFocus:!0}).inject(b),A=new o({elementsList:m,selectedIndex:M,placeholder:r.placeholder_UOM}).inject(b);D.inject(b),A.getContent().addClassName("xsr-grid-combobox"),R.getContent().addClassName("xsr-grid-lineeditor"),R.getContent().getChildren()[0].onpaste=function(e){e.preventDefault();let t=(e.clipboardData||window.clipboardData).getData("text");R.value=t},R.addEventListener("change",function(e){let n=e.dsModel.value;s.activeCellId=t.cellID,""!=n&&g.updateOptions({grid:{quantity:parseFloat(n)}})}),A.addEventListener("change",function(e){let n=e.dsModel.value;s.activeCellId=t.cellID,null!=n&&g.updateOptions({grid:{quantityUOMNLS:n,quantityUOM:C.get(n),uom:n}})}),c||(A.disabled=!0,D.disabled=!0)}return s.activeCellId===t.cellID&&(x.addClassName("xsr-grid-wux-hide"),b.toggleClassName("xsr-grid-wux-hide")),l},l.getCellValueForExport=function(e){var t=e.nodeModel;if(t&&t.getID){if(null==t)return r.label_UOM;var n=t.getQuantity()+t.getUnitOfMeasure();return t.getasNeeded()&&(n+=r.label_As_Required),n}}),"quantity"!==l.dataIndex&&"asNeeded"!==l.dataIndex||(l.getCellEditableState=function(t){var n=widget.getValue(e.PERSISTENCY_BOM_VIEW),o=t.nodeModel;return!!o&&(!("function"!=typeof o.getCQInstance||!o.getCQInstance())||("boolean"!=typeof n||n?"function"!=typeof o.IsComputed||!o.IsComputed():null))},"quantity"===l.dataIndex&&(l.getCellSemantics=function(e){var t=e.nodeModel;if(t&&t.getID)return"EA (each)"==t.options.grid.uom?{stepValue:1}:{}}),"asNeeded"===l.dataIndex&&(l.getCellTooltip=function(e){var t=e.nodeModel;if(t&&t.getID&&("function"==typeof t.getCQInstance&&t.getCQInstance()||"function"==typeof t.getMadeFrom&&t.getMadeFrom()))return{shortHelp:t.options.grid.asNeeded?r.label_True:r.label_False}})),"madeFrom"===l.dataIndex&&(l.getCellValueForExport=function(e){var t=e.nodeModel;if(t&&t.getID)switch(s.grid.layout.getDataIndexFromColumnIndex(e.columnID)){case"madeFrom":return void 0===t.getMadeFrom()||null===t.getMadeFrom()?"":r.label_MakeFrom}},l.getCellTooltip=function(e){var t=e.nodeModel;if(t&&t.getID&&!!t.getMadeFrom())return{shortHelp:r.label_MakeFrom}}),"uom"===l.dataIndex&&(l.getCellSemantics=function(e){var t=e.nodeModel;if(t&&t._canBeGrouped()&&(t.options.grid.quantityType||"function"==typeof t.getCQInstance&&t.getCQInstance())){var n=Object.entries(i.getUOMUnits(t.options.grid.quantityType,t.options.grid.quantityTypeDBName));i.getUOMUnits(t.options.grid.quantityType);if(n){var o=[];return t.options.grid.CQInstance&&o.push(""),n.forEach(function(e){o.push(e[1])}),o.sort((e,t)=>(e=e.toLowerCase())==(t=t.toLowerCase())?0:e>t?1:-1),{possibleValues:()=>o,placeholder:r.placeholder_UOM}}return null}},l.getCellEditableState=function(e){var t=e.nodeModel;if(t&&t._canBeGrouped())return"function"==typeof t.IsComputed&&t.IsComputed()?null:t.options.grid.quantityType||"function"==typeof t.getCQInstance&&t.getCQInstance()?{editableFlag:!0,typeRepresentation:"enumValueToProperty"}:null}),"revisionForTMS"===l.dataIndex&&(l.getCellTooltip=function(e){var t=e.nodeModel;if(t&&t.getID)return{shortHelp:t.isLastVersion()?t.getRevision():t.getRevision()+"  "+r.HigherRevExist}},l.getCellValue=function(e){var t=e.nodeModel;if(t&&t.getRevision)return t.getRevision()},l.getCellSemantics=function(e){var t=e.nodeModel;if(t&&t.isLastVersion&&!t.isLastVersion())return{icon:"flow-line"}}),"url"===l.typeRepresentation?(l.getCellValue=function(n){var o,a,i=function(e,n,o,a,i){return t.isXSRAuthoredType(o.getTypeActualName())?{label:e,icon:a,url:"#UNEXISTANT_ID",module:"DS/XSRCommonComponents/utils/GridCommonActionsManager",func:"launch",argument:{commandId:n,selectedNode:o,appCore:s.appCore,currentTabKey:s.currentTabKey,selectFacet:i}}:{label:e}},r=n.nodeModel,l=s.grid.layout.getDataIndexFromColumnIndex(n.columnID);if(r.getID){switch(l){case"partNumber":(a=void 0===r.getPartNumber()||null===r.getPartNumber()?"":r.getPartNumber())&&(o=i(a,e.SET_PART_NUMB,r));break;case"ds6wg:revision":(a=void 0===r.getRevision()||null===r.getRevision()?"":r.getRevision())&&(o=i(a,e.VERSION_GRAPH_CMD,r),r.isLastVersion&&void 0!==r.isLastVersion()&&!r.isLastVersion()&&(o.icon="flow-line")),a&&t.isOriginatedInGLS(r)&&(o=a);break;case"ds6w:status":(a=void 0===r.getMaturity()||null===r.getMaturity()?"":r.getMaturity())&&(o=i(a,e.MATURITY_GRAPH_CMD,r)),a&&t.isOriginatedInGLS(r)&&(o=a);break;case"ds6w:responsible":(a=void 0===r.getOwner()||null===r.getOwner()?"":r.getOwner())&&(o=i(a,e.CHANGE_OWNER_CMD,r)),a&&t.isOriginatedInGLS(r)&&(o=a);break;case"Alternate":var d="",u=r._options.grid.Alternate;"Yes"==(u=u?u.replace("\n",""):u)&&(d="fonticon fonticon-exchange alternateColumn"),o=i("",e.INFORMATION_CMD,r,d,e.FACET_ALTERNATE);break;case"revisionForTMS":let n=null,s=null;r&&r.getRevision&&(n=r.getRevision()),r&&r.isLastVersion&&!r.isLastVersion()&&(s="flow-line"),o={icon:s,label:n}}return o}},l.getCellGroupingKey=function(e){var t=e.nodeModel;if(t&&t.getID){var n=s.grid.layout.getDataIndexFromColumnIndex(e.columnID);return e.nodeModel.options.grid[n]}},l.getCellValueForExport=function(e){var t=e.nodeModel;if(t&&t.getID)switch(s.grid.layout.getDataIndexFromColumnIndex(e.columnID)){case"partNumber":return void 0===t.getPartNumber()||null===t.getPartNumber()?"":t.getPartNumber();case"ds6wg:revision":var n=void 0===t.getRevision()||null===t.getRevision()?"":t.getRevision();return n=n&&t.isLastVersion&&t.isLastVersion()?n:n+"("+r.HigherRevExist+")";case"ds6w:status":return void 0===t.getMaturity()||null===t.getMaturity()?"":t.getMaturity();case"ds6w:responsible":return void 0===t.getOwner()||null===t.getOwner()?"":t.getOwner()}},"ds6wg:revision"===l.dataIndex&&(l.getCellTooltip=function(e){var t=e.nodeModel;if(t&&t.getID)return{shortHelp:t.isLastVersion()?t.getRevision():t.getRevision()+"  "+r.HigherRevExist}}),"Alternate"===l.dataIndex&&(l.getCellTooltip=function(e){var t=e.nodeModel;if(t&&t.getID){return{shortHelp:"Yes"==t._options.grid.Alternate?r.label_Alternate:""}}}),"ds6wg:revision"!==l.dataIndex&&"ds6w:status"!==l.dataIndex&&"ds6w:responsible"!==l.dataIndex||(l.getCellTypeRepresentation=function(e){return e.nodeModel&&t.isOriginatedInGLS(e.nodeModel)?"string":l.typeRepresentation})):"menu"===l.dataIndex&&(l.getCellValue=function(t){var n=t.nodeModel;if(n.getID&&n.getID()){var o=[];return n.currentTabKey===e.FACET_MBMF&&n.appCore.contextAppId===e.XSR_APP_ID?(o.push("Information"),o.push("OpenSpecificationView"),o.push("DeleteItem")):n.currentTabKey===e.FACET_MBMF&&n.appCore.contextAppId!==e.XSR_APP_ID?o=["Information","OpenSpecificationView","OpenWith","ManageFiles","SetPartNumber","UPSAuthUnparent","RemoveChild","VersionExplorer","DuplicateItem","CompareWith","RelatedObjects","MaturityGraph","ActionBar_ChangeOwner","MultiOwnership","DownloadReport","DownloadDocument","Subscriptions","DeleteItem","addExisting","RegenerateReport","Close"]:n.currentTabKey===e.BOM_TAB||n.currentTabKey===e.MAT_TAB||n.currentTabKey===e.DOC_TAB||n.currentTabKey===e.MEI_TAB?o=["Information_Widget","Alternates"]:"test-method-facet"===n.currentTabKey&&(o=["Information","OpenWith","ManageFiles","SetPartNumber","UPSAuthUnparent","RemoveChild","VersionExplorer","DuplicateItem","CompareWith","RelatedObjects","MaturityGraph","ActionBar_ChangeOwner","MultiOwnership","DownloadReport","Subscriptions","DeleteItem","addExisting","RegenerateReport","Close","Information_Widget","Alternates"]),{label:"",module:"DS/XSRCommonComponents/utils/GridCommonActionsManager",func:"getActionMenu",argument:{execludeCmds:o}}}n.options.grid.menu=""},l.hasCellValue=function(e){var t=e.nodeModel;return!(!t||!t._canBeGrouped())})}),l},l});