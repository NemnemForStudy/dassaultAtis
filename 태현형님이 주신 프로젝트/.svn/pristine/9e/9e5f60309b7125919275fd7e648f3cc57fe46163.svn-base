define("DS/XSRCommonComponents/utils/Utils",["UWA/Class","UWA/Utils/InterCom","DS/WebappsUtils/WebappsUtils","DS/XSRCommonComponents/utils/Constants","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/OpenWith","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/XInfraRequestUtil","DS/XSRCommonComponents/utils/PlatformDataProvider","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/utils/RMCommonServiceProvider","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents","css!DS/XSRCommonComponents/XSRCommonComponents.css"],function(e,t,i,n,s,o,r,a,c,u,l,p,d){var m=e.singleton({dragStartedInXSR:!1,arePrdTypesLoaded:!0,activateInfoIcon:function(){let e=document.getElementsByClassName("fonticon fonticon-info information-icon");if(UWA.is(e,"object")&&1==e.length){-1==e[0].className.split(" ").indexOf("infoIconActive")&&(e[0].className+=" infoIconActive")}this.activateCustomInfoIconInIDcard()},activateInfoIconInTab:function(){let e=document.querySelector("li.item span.fonticon.fonticon-info");if(null!=e&&"object"==typeof e){-1==e.className.split(" ").indexOf("infoIconActive")&&(e.className+=" infoIconActive")}},deactivateInfoIconInTab:function(){let e=document.querySelector("li.item span.fonticon.fonticon-info");null!=e&&"object"==typeof e&&(e.className=e.className.replace(/\binfoIconActive\b/g,""))},activateCustomInfoIconInIDcard:function(){let e=document.getElementsByClassName("xsr-page-top-bar-icon wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-info");UWA.is(e,"object")&&1==e.length&&e[0].addClassName("infoIconActive")},deactivateCustomInfoIconInIDcard:function(){let e=document.getElementsByClassName("xsr-page-top-bar-icon wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-info infoIconActive");UWA.is(e,"object")&&1==e.length&&e[0].removeClassName("infoIconActive")},deactivateInfoIcon:function(){let e=document.getElementsByClassName("fonticon fonticon-info information-icon");UWA.is(e,"object")&&1==e.length&&(e[0].className=e[0].className.replace(/\binfoIconActive\b/g,"")),this.deactivateCustomInfoIconInIDcard()},activateReportInfoIcon:function(){let e=document.getElementsByClassName("xsr-pdf-toolbar-info wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-info");UWA.is(e,"object")&&1==e.length&&e[0].addClassName("infoIconActive")},deactivateReportInfoIcon:function(){let e=document.getElementsByClassName("xsr-pdf-toolbar-info wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-info");UWA.is(e,"object")&&1==e.length&&e[0].removeClassName("infoIconActive")},getformatedDate:function(e){this.dataFormatter||(this.dataFormatter=new Intl.DateTimeFormat(r.getLanguage(),{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}));try{return e.indexOf("@")>=0&&e.replace("@"," "),this.dataFormatter.format(new Date(e)).replace(",","")}catch(t){return e}},getDataGridformatedDate:function(e){try{return e.indexOf("@")>=0&&e.replace("@"," "),new Date(e).toLocaleDateString(r.getLanguage(),{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}catch(t){return e}},formatDateObjInUTC:function(e){if(!e)return null;var t=e.split("@"),i=e;if(t.length>1){var n=t[0].split("/"),s=n[0],o=n[1]-1,r=n[2],a=t[1].split(":"),c=a[0],u=a[1],l=a[2];(i=new Date).setUTCHours(c),i.setUTCMinutes(u),i.setUTCSeconds(l),i.setUTCFullYear(s),i.setUTCDate(1),i.setUTCMonth(o),i.setUTCDate(r)}return i},formatDate:function(e,t){var i=e,n=e instanceof Date?e:this.formatDateObjInUTC(e);return n&&(i=1==t?n.toLocaleString(r.getLanguage()):n.toLocaleDateString(r.getLanguage())),i},convertToISOString:function(e){return(e instanceof Date?e:this.formatDateObjInUTC(e)).toISOString()},hasBadChar:function(e,t){var i=e,s=t||n.FORBIDDEN_CHARS;i.length>s.length&&(i=t||n.FORBIDDEN_CHARS,s=e);for(var o=!1,r=0;r<i.length;r++){var a=i[r];if(s.indexOf(a)>=0){o=!0;break}}return o},formatBytes:function(e){return e<1024?e+" Bytes":e<1048576?(e/1024).toFixed(3)+" KB":e<1073741824?(e/1048576).toFixed(3)+" MB":(e/1073741824).toFixed(3)+" GB"},isTouchDevice:function(){return"ontouchstart"in document.documentElement},getFileInput:function(e){var t=UWA.extendElement(widget.body).getElement("#fileExplorer");return t||(t=new UWA.createElement("input",{id:"fileExplorer",multiple:e?void 0:"multiple",type:"file",styles:{display:"none"}}).inject(widget.body),this.isTouchDevice()&&(t.accept="image/*;capture=camera")),t.removeEvents(),t},isValidFormatForDocumentCreate:function(e){var t={};return t.isRestricted=this.isRestrictedFileFormat(e),t.isSupported=this.isSupportedFormatForReport(e),t},isRestrictedFileFormat:function(e){var t=this.restrictedFormats(),i=this.getFileExtension(e);return void 0!==t&&-1!==t.indexOf(i)},restrictedFormats:function(){return["action","apk","app","bat","bin","cmd","com","command","cpl","csh","exe","gadget","inf1","ins","inx","ipa","isu","job","jse","ksh","lnk","msc","msi","msp","mst","osx","out","paf","pif","prg","ps1","reg","rgs","run","scr","sct","shb","shs","u3p","vb","vbe","vbs","vbscript","workflow","ws","wsf","wsh","0xe","73k","89k","a6p","ac","acc","acr","actm","ahk","air","app","arscript","as","asb","awk","azw2","beam","btm","cel","celx","chm","cof","crt","dek","dld","dmc","docm","dotm","dxl","ear","ebm","ebs","ebs2","ecf","eham","elf","es","ex4","exopc","ezs","fas","fky","fpi","frs","fxp","gs","ham","hms","hpf","hta","iim","ipf","isp","jar","js","jsx","kix","lo","ls","mam","mcr","mel","mpx","mrc","ms","mxe","nexe","obs","ore","otm","pex","plx","potm","ppam","ppsm","pptm","prc","pvd","pwc","pyc","pyo","qpx","rbx","rox","rpj","s2a","sbs","sca","scar","scb","script","smm","spr","tcp","thm","tlb","tms","udf","upx","url","vlx","vpm","wcm","widget","wpk","wiz","wpm","xap","xbap","xlam","xlm","xlsm","xltm","xqt","zl9","xys"]},supportedFormats:function(){return["doc","docx","xlsx","png","jpg","jpeg","rtf","svg","wmf","bmp","emf","gif"]},isSupportedFormatForReport:function(e){var t=this.supportedFormats(),i=this.getFileExtension(e);return void 0===t||-1!==t.indexOf(i)},getFileExtension:function(e){var t=e.lastIndexOf(".");return(t<1?"":e.substr(t+1)).toLowerCase()},isXSRAuthoredType:function(e){return!!(this.isPhysicalProduct(e)||this.isDocument(e)||this.isTechnicalSpecification(e)||this.isCoreMaterial(e)||this.isPerformanceSpec(e)||this.isPerformanceChar(e))},isValidItemOnOpen:function(e){return!!(l.isPhyProd(e)||l.isRawMaterial(e)||l.isTechSpec(e))},isOriginatedInGLS:function(e){var t="";return e&&"function"==typeof e.getPolicyActualName&&(t=e.getPolicyActualName()),t===n.POLICY_PRD_DATA_SPEC||t===n.POLICY_RES_PRD_DATA_SPEC},isTechnicalSpecification:function(e){return!!(this.techSpecsDBNames&&e&&this.techSpecsDBNames.indexOf(e)>=0)},getSpecificationTypes:function(){if(this.productSpecificationItfs)return this.productSpecificationItfs},isPhysicalProduct:function(e){return!!(this.subProductDBNames&&e&&this.subProductDBNames.indexOf(e)>=0)||(n.TYPE_VPMREFERENCE===e||!!this.isRawMatSubtypes(e))},isRawMatSubtypes:function(e){return!!(this.rawMaterialsNames&&e&&this.rawMaterialsNames.indexOf(e)>=0)},isMEIItem:function(e){var t;return e.length&&e.length>1&&void 0!==e[0].getMEIInterface&&e[0].getMEIInterface()&&(t=e[0].getMEIInterface()),!e.length&&void 0!==e.getMEIInterface&&e.getMEIInterface()&&(t=e.getMEIInterface()),!(!t||!t.includes("ManufacturerEquivalentItemExtension"))},isCoreMaterial:function(e){return[n.TYPE_CORE_MATERIAL,n.TYPE_CORE_MATERIAL_NAME].includes(e)},isDocument:function(e){return n.TYPE_DOCUMENT===e},isPerformanceSpec:function(e){return n.TYPE_PERFORMANCE_SPEC===e},isPerformanceChar:function(e){return l.isPerformanceCharacteristics(e)},getAttributeSelectable:function(e){return n.ATTRIBUTE+"["+e+"]"},downloadCSV:function(e,t){var i="";"en"!=r.getLanguage()&&(i="\ufeff"),i+=e;var n={blob:new Blob([i]),fileName:t,mimeType:"text/csv;charset:utf-8",isCSV:!0};this.downloadFileonBrowser(n)},downloadFileonBrowser:function(e){if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(e.blob,e.fileName);else{var t=e.mimeType?window.URL.createObjectURL(e.blob,{type:e.mimeType}):window.URL.createObjectURL(e.blob);if(!r.isSafarionIPadorPod()||e.isCSV){var i=new UWA.Element("a",{href:t,download:e.fileName}).inject(document.body);i.hide(),i.click(),setTimeout(function(){i.destroy(),window.URL.revokeObjectURL(t)},100)}else window.open(t,"_blank")}},getIconFormXSR:function(e){return i.getWebappsAssetUrl("SpecViewer","icons/32/"+e+".png")},getIconUrl:function(e){return"url("+this.getIconFormXSR(e)+")"},getIconFormPerfSpec:function(e){return i.getWebappsAssetUrl("ENOCharacteristicsApp","icons/32/"+e+".png")},isSourcingAvailable:function(){r.isCloud()&&c.getAllPlatforms().then(function(e){var t=r.getPlatformId();return!!c.getServiceURL("sourcing",t)}).catch(function(e){console.log(e)})},setAdminConfigs:function(){var e=new a({id:"getSpecAdminConfigs"}),t=this;return t.hasAdminDisabledTemplate=!1,t._hasAdminDisabledCreatePS=!1,new Promise(function(i,n){e.invoke().then(function(e){var n=e,s=n.isSpecTemplateOptional,o=n.isProductSpecOptional;t.hasAdminDisabledTemplate=s,t._hasAdminDisabledCreatePS=o,i()}).catch(function(e){console.error("Error getting Admin Configs! "+e),i()})})},getTemplateAdminConfig:function(){return this.hasAdminDisabledTemplate},getCreatePrdSpecAdminConfig:function(){return this._hasAdminDisabledCreatePS},getPhysicalProductSubtypes:function(){if(this.physicalProductSubTypes)return this.physicalProductSubTypes},getNewProductIncludedtypes:function(){if(this.newProductIncludedTypes)return this.newProductIncludedTypes},getNewRawMatIncludedtypes:function(){if(this.newRawMatIncludedTypes)return this.newRawMatIncludedTypes},getRawMaterialSubtypes:function(){if(this.rawMaterialSubTypes)return this.rawMaterialSubTypes},getTechSpecSubtypes:function(){if(this.techSpecSubTypes)return this.techSpecSubTypes},getTechSpecTypeHierarchy:function(){if(this.typeHierarchy)return this.typeHierarchy},prepareNewProductIncludedtypes:function(){var e=new a({id:"NewProductIncludedtypes"}),t=this;e.getAdminSavedConfiguration("ProductSpecification").then(function(e){var i=e.result.applicableTypes;t.newProductIncludedTypes=l.setProductAdminData(i,t.physicalProductSubTypes),null!=t.physicalProductSubTypes&&0!=t.physicalProductSubTypes.length||!t.arePrdTypesLoaded||(t.prepareNewProductIncludedtypes(),t.arePrdTypesLoaded=!1)}).catch(function(e){console.error("Error getting for Physical Product excluded types! "+e)})},prepareNewRawMatIncludedtypes:async function(){var e=new a({id:"NewRawMatIncludedtypes"});var t=(await e.getAdminSavedConfiguration("Raw_Material")).result.applicableTypes;l.getRawMaterialArr();this.newRawMatIncludedTypes=l.setRawMaterialAdminData(t)},preparePhysicalProductSubtypes:function(){var e=new a({id:"getPhysicalPrdTypes"}),t=this;t.subProductDBNames=[],e.invoke().then(function(e){var i=e.response;t.physicalProductSubTypes=i,i&&i.forEach(function(e){t.subProductDBNames.push(e.valueItem)}),l.setPhysicalProductArr(i),l.setPhysicalProductList(t.subProductDBNames)}).catch(function(e){console.error("Error getting Physical Product types! "+e)})},prepareRawMaterialSubtypes:async function(){var e=new a({id:"getRawMaterialSubTypes"});this.rawMaterialsNames=[];var t=(await e.getSubtypes()).result.RawMaterialTypes;t&&l.setRawMaterialData(t),this.rawMaterialsNames=[].concat(l.getRawMaterialSubtypesList(),l.getRawMaterialActualSubtypesList()),this.rawMaterialSubTypes=l.getRawMaterialArr()},prepareUOMTypes:function(){(new p).getUOMAndUnits().then(e=>{var t=e.result.rmUOMTypes;t&&l.setDimensions(t)}).catch(e=>console.log("Error getting UOM Types! "+e))},convertDateToStandard:function(e){var t=e,i=e.getUTCFullYear(),n=e.getUTCMonth()+1,s=e.getUTCDate(),o=t.getUTCHours(),r=t.getUTCMinutes(),a=t.getUTCSeconds();return n<10&&(n="0"+n),s<10&&(s="0"+s),o<10&&(o="0"+o),r<10&&(r="0"+r),a<10&&(a="0"+a),t.setYear(i),t.setMonth(e.getMonth()),t.setDate(s),i+"/"+n+"/"+s+"@"+o+":"+r+":"+a+":GMT"},prepareTechSpecSubtypes:function(){var e=new a({id:"getTechSpecTypes"}),t=this;t.techSpecsDBNames=[],e.invoke().then(function(e){var i=e.response,n=[];i&&(n=i.subTypes,t.typeHierarchy=i.typeHierarchy),t.techSpecSubTypes=n,n&&n.forEach(function(e){t.techSpecsDBNames.push(e.valueItem)}),l.setTechSpecList(t.techSpecsDBNames),l.setTechSpecArr(n)}).catch(function(e){console.error("Error getting technical Specification types! "+e)})},getValidPreviousorNextNode:function(e,t){var i;if(this.isPerformanceSpec(e.getAttributeValue(["ds6w:type_value"]))){if("previous"===t){if(null==(i=e.getPreviousVisibleNode())||i.getAttributeValue("physicalId")||(i=i.getPreviousVisibleNode()),null!=i)for(;this.isPerformanceChar(i.getAttributeValue(["ds6w:type_value"]))&&null!=(i=i.getPreviousVisibleNode())&&(i.getAttributeValue("physicalId")||(i=i.getPreviousVisibleNode()),null!=i););}else if("next"===t&&(null==(i=e.getNextVisibleNode())||i.getAttributeValue("physicalId")||(i=i.getNextVisibleNode()),null!=i))for(;this.isPerformanceChar(i.getAttributeValue(["ds6w:type_value"]))&&null!=(i=i.getNextVisibleNode())&&(i.getAttributeValue("physicalId")||(i=i.getNextVisibleNode()),null!=i););}else if(this.isPerformanceChar(e.getAttributeValue(["ds6w:type_value"]))){if("previous"===t){if(null==(i=e.getPreviousVisibleNode())||i.getAttributeValue("physicalId")||(i=i.getPreviousVisibleNode()),null!=i)for(;this.isPerformanceSpec(i.getAttributeValue(["ds6w:type_value"]))&&null!=(i=i.getPreviousVisibleNode())&&(i.getAttributeValue("physicalId")||(i=i.getPreviousVisibleNode()),null!=i););}else if("next"===t&&(null==(i=e.getNextVisibleNode())||i.getAttributeValue("physicalId")||(i=i.getNextVisibleNode()),null!=i))for(;this.isPerformanceSpec(i.getAttributeValue(["ds6w:type_value"]))&&null!=(i=i.getNextVisibleNode())&&(i.getAttributeValue("physicalId")||(i=i.getNextVisibleNode()),null!=i););}else"previous"===t?i=e.getPreviousVisibleNode():"next"===t&&(i=e.getNextVisibleNode());if(i)return i._canBeGrouped()?i:this.getValidPreviousorNextNode(i,t)},getNlsOfPropertiesValues:function(e){var t=this;return new Promise(function(i,n){u.getNlsOfPropertiesValues(JSON.stringify(e),{apiVersion:"R2019x",tenantId:r.getPlatformId(),lang:r.getLanguage(),onComplete:function(e){e&&(t.ds6wClassPropNls||(t.ds6wClassPropNls={}),UWA.extend(t.ds6wClassPropNls,e,!0),i(t.ds6wClassPropNls))},onFailure:function(){console.warn("DictionaryAccess## FedDictionaryAccessAPI.getNlsOfPropertiesValues failed for"+e),i()}})})},publishCrossWidgetHighlightEvent:function(e,t){var i={metadata:{uid:this.uid(),originUid:e,timestamp:Date.now(),appid:"ENOSPEC_AP_"+widget.id,origin:"ENOSPEC_AP"},data:t};s.publish(n.CROSS_APP_SELECTION_EVENT,i)},uid:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},launchTansientWidget:function(e){var i=[];i.push({envId:r.getPlatformId(),serviceId:n.SERVICE_3DSPACE_NAME,contextId:widget.getValue("Current_security_credentials"),objectId:e.objectId,objectType:e.objectType,displayName:e.displayName});var s={protocol:"3DXContent",version:"1.0",source:"ENOSPEC_AP",data:{items:i}},o={protocol:"3DXContent",version:"1.0",source:"ENOSPEC_AP",appId:e.appId,data:{items:i}},a=new t.Socket("compassPageSocket");a.subscribeServer("com.ds.compass",window.parent),a.dispatchEvent("onSetX3DContent",s,"compassPageSocket");a.addListener("launchApp",function(e){console.log("Response = "+JSON.stringify(e))}),a.dispatchEvent("onLaunchApp",o,"compassPageSocket")},_createOpenWithContent:function(e){var t={protocol:"3DXContent",version:"1.1",source:"ENOSPEC_AP",widgetId:widget.id,data:{items:[]}},i=[],s={};if(s=Array.isArray(e)?e[0]:e,this.isPhysicalProduct(s.getTypeActualName()))i=[n.TYPE_VPMREFERENCE];else for(var o=m.getTechSpecTypeHierarchy(),a=0;a<o.length;a++){Object.keys(this.getTechSpecTypeHierarchy()[a]);if(s.getTypeActualName()===Object.keys(this.getTechSpecTypeHierarchy()[a])[0])i=Object.values(this.getTechSpecTypeHierarchy()[a])[0].split(",")}var c={envId:r.getPlatformId(),serviceId:n.SERVICE_3DSPACE_NAME,contextId:widget.getValue("Current_security_credentials"),objectId:s.getID(),objectTaxonomies:i,objectType:s.getTypeActualName(),displayName:s.getName(),displayType:s.getType(),session_object:!1};return t.data.items.push(c),t},_setSupportedAppsList:function(e){var t=new o,i=m._createOpenWithContent(e),s=[];t.set3DXContent(i),UWA.is(t.retrieveCompatibleApps,"function")&&t.retrieveCompatibleApps(function(e){e.forEach(function(e){e.name!=n.XSR_APP_ID&&s.push({type:"PushItem",title:e.text,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS},action:{callback:e.handler}})})}),this.openWithSubMenu=s},_getSupportedAppsList:function(){return this.openWithSubMenu},getRequestLabel:function(){return r.getloginUser().login+"-"+n.XSR_APP_ID+"-"+Date.now()},_getWorkUnderHeaders:function(){return r.getWorkUnderHeaders()},_isWorkUnderEnabled:function(){return Object.keys(this._getWorkUnderHeaders()).length>0},hasValue:function(e){return null!=e&&""!==e},removeDuplicatesFromArr:e=>[...new Set(e)]});return m});