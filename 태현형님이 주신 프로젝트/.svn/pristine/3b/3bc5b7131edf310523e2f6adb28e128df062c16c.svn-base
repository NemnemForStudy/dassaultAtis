define("DS/DELWebOpen/ContextHelper",[],function(){"use strict";const e={getMfgContext:function(t,o,n){var i={context:[],ids:[]},r={},l=e.getProcessContext(t,o);if(l&&l.context)for(let e of l.context)if(e.scope===n&&e.implementedScope){i.context=e.implementedScope,e.implementedScope.forEach(e=>{r[e.id]||(r[e.id]=!0,i.ids.push(e.id))});break}return i},getMfgInstallOccurrences:function(t,o,n,i){var r={context:[],ids:[]},l=e.getMfgContext(t,o,n);if(l)for(let e of l.context)i===e.id&&e.context&&(r.context=e.context,r.ids=r.ids.concat(e.context.map(e=>`${e.parent}_${e.instance}_${i}`)));return r},getProcessContext:function(t,o){var n={context:[],ids:[]},i=e.getContextScope(t,o);return i&&(n.context=i,n.ids=i.map(e=>e.scope)),n},getProcessContextOccurrences:function(t,o,n){var i={context:[],ids:[]},r=e.getProcessContext(t,o);if(r&&r.context)for(let e of r.context)if(e.scope===n){i.context=r.context,i.ids=e.contextOccurrence.slice();break}return i},getContextScope:function(e,t){var o,n;return e&&UWA.is(e.member,"array")&&t&&e.member.forEach(e=>{(n=e.find(function(e){return e.refid===t}))&&(o=n.contextScope)}),o},getAllPhysicalIds:function(t,o){var n=o?[o]:[],i=e.getContextScope(t,o);return i&&i.forEach(e=>{n.push(e.scope),e.contextOccurrence&&e.contextOccurrence.forEach(e=>{n=n.concat(e.split("_"))}),e.implementedScope&&e.implementedScope.forEach(e=>{n.push(e.id),e.context&&e.context.forEach(e=>{n.push(e.parent),n.push(e.instance)})})}),n}};return e}),define("DS/DELWebOpen/Helper",["DS/DELWebComponentManager/DELWebComponentManager","text!DS/DELWebOpen/assets/json/ServicePayloads.json","i18n!DS/DELWebOpen/assets/nls/OpenControl"],function(e,t,o){"use strict";let n=JSON.parse(t),i={computeVolumeFilter:async function(t,r,l={}){let s,a,c,p,d=e.getComponent("Utils");return t&&r&&(s=await async function(e){let t,o,i=n.expandV2;return i.batch.expands[0].root.physical_id=e,(t=await d.getProgressiveExpand(i))&&t.results&&t.results.length>0&&(o=t.results[0]),o}(r))&&s.boundingbox&&(a=n.publicVolumeFilterSpec,c=d.getValue(a,"specification"),p=d.getValue(c,"allVolumes"),a.rootID=t,a.rootAlias=s["ds6w:label"],!0===l.withFilter?(a.applyFilter=0,a.displayFilter=1):(a.applyFilter=1,a.displayFilter=0),c.title=o.get(c.title),c.referencedObject.identifier=t,p[0].allVolumes=[i.getVolumeFilter(t,s.boundingbox,l.installVolumeOffSet)]),a},getVolumeFilter:function(e,t,i=0){let r,l=n.volumeFilter,s=function(e,t){return e.map(e=>`${e+t}`)},a=Number.isNaN(Number(i))?0:10*Number(i);var c,p;return t&&t.max&&t.min&&(r=s(t.max,a),l.displayName=o.get(l.displayName),l.parameters.root_path_physicalid=[[e]],l.parameters.corner_max=(c=r,p=t.min,c.map((e,t)=>`${e-p[t]}`)),l.parameters.transformation_matrix=[1,0,0,0,1,0,0,0,1,...function(e,t){return s(e,-t/2)}(t.min,a)]),l}};return i}),define("DS/DELWebOpen/Model",[],function(){"use strict";return function(){var e={};return{set:function(t,o){e[t]=o},get:function(t){return e[t]?e[t]:null},remove:function(t){delete e[t]},clear:function(){e={}}}}}),define("DS/DELWebOpen/FormColumns",[],function(){"use strict";return[{dataIndex:"tree",typeRepresentation:"string",alignment:"near",width:"175",minWidth:"15",alwaysVisibleFlag:!0,editableFlag:!1,getCellClassName:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("className"):""}},{dataIndex:"value",getCellTypeRepresentation:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("typeRepresentation"):"string"},getCellSemantics:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("semantics"):void 0},getCellEditableState:function(e){return!e.nodeModel||!e.nodeModel.getAttributeValue("readOnly")},allowUnsafeHTMLContent:!1,width:"250",minWidth:"10",alwaysVisibleFlag:!0,editableFlag:!0,editionPolicy:"EditionInPlace"},{dataIndex:"withFilter",width:"5",typeRepresentation:"functionIcon",hasCellValue:function(e){return e.nodeModel&&!0===e.nodeModel.getAttributeValue("withFilter")},getCellSemantics:function(e){if(e.nodeModel&&!0===e.nodeModel.getAttributeValue("withFilter"))return{icon:{iconName:"filter",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},disabled:!0}}}]}),define("DS/DELWebOpen/FormDocument",["DS/Tree/TreeDocument","DS/Tree/TreeNodeModel"],function(e,t){"use strict";var o=function(...t){e.apply(this,t)};return(o.prototype=Object.create(e.prototype)).constructor=o,o.prototype.removeRootNode=function(e){let t,o=this.getRoots();o&&o.length>0&&(t=o.find(function(t){return t.options.fieldId===e}))&&this.removeRoot(t)},o.prototype.createRootNode=function(e,o){var n=new t({label:o?o.label:null,fieldId:e,grid:{className:"oer-form-expander"}});return this.removeRootNode(e),this.addRoot(n),n},o.prototype.getFieldNode=function(e){let t,o=this.search({match:function(t){if(e&&t.nodeModel.options.fieldId===e)return!0}});return o&&o.length>0&&(t=o.find(t=>t.options.fieldId===e)),t},o.prototype.createFieldNode=function(e,o,n){var i,r,l={label:o?o.label:null,fieldId:e,grid:{value:void 0,fieldValue:"",typeRepresentation:"string",semantics:{}}},s=o?o.possibleValues:[];return s&&(1===s.length&&UWA.merge(l.grid,s[0]),l.grid.semantics=function(e){return e&&e.length>1?{possibleValues:e,displayStyle:"combo",allowResetToUndefinedByUIFlag:!0}:{possibleValues:e,displayStyle:"combo",disabled:!0}}(s)),this.removeFieldNode(e),r=new t(l),n&&((i=this.getRoots().find(e=>e&&e.options&&e.options.fieldId===n)).addChild(r),i.expandAll()),r},o.prototype.removeFieldNode=function(e){var t,o=this.getFieldNode(e);o&&(t=o.getParent())&&t.removeChild(o)},o.prototype.updateAttribute=function(e,t,o){let n=this.getFieldNode(e);n&&n.setAttribute(t,o)},o}),define("DS/DELWebOpen/ProcessForm",["DS/Controls/Button","DS/DELWebComponentManager/DELWebComponentManager","DS/DELWebCommonControls/Form","DS/DELWebOpen/FormDocument","DS/DELWebOpen/FormColumns","text!DS/DELWebOpen/assets/json/Constants.json","text!DS/DELWebOpen/assets/json/FormFieldsConfig.json","i18n!DS/DELWebOpen/assets/nls/OpenControl.json"],(e,t,o,n,i,r,l,s)=>{"use strict";const a=JSON.parse(r),c=JSON.parse(l);function p(t,o){this._options=o||{},this._tokens=[],this._model=t,this._openButton=new e({onClick:(...e)=>{o.onOpen&&o.onOpen.apply(o,e)}}),this._cancelButton=new e({onClick:(...e)=>{o.onCancel&&o.onCancel.apply(o,e)}}),this._formOptions={identifier:"oer-process-form",formOptions:{maxVisibleRowCount:Object.keys(c).length,treeDocument:new n,columns:i},dialogOptions:{title:s.get("Dialog.Process.Title"),position:{my:"bottom",at:"center",offsetY:-100},buttons:{Open:this._openButton,Cancel:this._cancelButton}},frameContainer:o.container},this._subscribeEvents()}return p.prototype._subscribeEvents=function(){let e=this;[{event:"onGetFieldValue",handler:e._onGetFieldValue},{event:"onFilterApplied",handler:e._onFilterApplied},{event:"onFilterCancelled",handler:e._onFilterCancelled},{event:"onFormComplete",handler:()=>{e._openButton.disabled=!1}},{event:"onFormClean",handler:e.destroy}].forEach(o=>{e._tokens.push(t.getComponent("ModelEvents").subscribe({event:o.event},o.handler.bind(e)))})},p.prototype._addFormListener=function(){let e=this;e.getTreeDocument().onNodeModelUpdate(function(o){var n=o.data?o.data.nodeModel:{};if(e.getTreeDocument().prepareUpdate(),n&&n.options&&n.options.fieldId){let e=n.options.grid.semantics;if(e&&e.possibleValues){let t=e.possibleValues.find(function(e){return n.getAttributeValue("value")===e.value});n.setAttribute(a.Context.fieldValue,t[a.Context.fieldValue])}o.data.attributes.value&&t.getComponent("ModelEvents").publish({event:`on${n.options.fieldId}Select`,data:{data:n.getAttributeValue(a.Context.fieldValue),origin:"FormHelper"}})}e.getTreeDocument().pushUpdate()}),e._processForm.addEventListener("onClose",e._options.onCancel)},p.prototype._removeFormListener=function(){this._processForm&&this._processForm.removeEventListener("onClose",this._options.onCancel)},p.prototype._getPossibleValues=function(e){var t=[],o=e=>{let t;return(e?e.split(a.Context.delimeter):[]).forEach(e=>{t?t+=`, ${this._getAttributeValue(e,a.Attributes.label)}`:t=`${this._getAttributeValue(e,a.Attributes.label)}`}),t},n=e=>{let t=e?e.split(a.Context.delimeter):[""];return this._getAttributeValue(t[t.length-1],a.Attributes.iconUrl)};return e&&e.length>0&&(t=e.map(e=>{let t;return t=o(e),{[a.Context.fieldValue]:e,value:t,label:t,withFilter:void 0,icon:{iconPath:n(e)}}})),t},p.prototype._getParentFieldId=function(e){return e&&c[e]?c[e].parent:null},p.prototype._getFieldIdsToShow=function(e){var t=[],o=0;return c[e]&&(o=c[e].position,t=Object.keys(c).filter(e=>c[e].position<=o)),t.sort((e,t)=>c[e].position-c[t].position)},p.prototype._onFilterApplied=function(e){let{fieldId:t}=e&&e.data?e.data:{};this._updateAttribute({fieldId:t,attribute:"withFilter",value:!0})},p.prototype._onFilterCancelled=function(e){let{fieldId:t}=e&&e.data?e.data:{};this._updateAttribute({fieldId:t,attribute:"withFilter",value:!1})},p.prototype._updateAttribute=function(e){let t=this.getTreeDocument();t&&t.updateAttribute(e)},p.prototype._getAttributeValue=function(e,t){var o=this._model.get("attributesMap");return o&&o[e]?o[e][t]:{}},p.prototype._onGetFieldValue=function(e){let t,n,i=this,{fieldId:r,ids:l}=e&&e.data?e.data:{},a=this._model.get("fieldToValuesMap"),p=[],d=function(e){let t=i.getTreeDocument();var o,n;i._openButton.disabled=!0,t.prepareUpdate(),o=t,(n=e)&&n.forEach(e=>{var t=i._getParentFieldId(e);e&&(t?o.createFieldNode(e,{label:s.get(c[e].label),possibleValues:i._model.get("fieldToValuesMap")[e]},t):o.createRootNode(e,{label:s.get(c[e].label)}))}),t.pushUpdate()};a||(a={},i._model.set("fieldToValuesMap",a)),l&&l.length>0&&(a[r]=i._getPossibleValues(l),i._processForm?(n=i._getParentFieldId(r),(t=i.getTreeDocument().getFieldNode(n))||p.push(n),p.push(r),d(p)):l.length>1&&(i._processForm=new o(i._formOptions),i._addFormListener(),d(p=i._getFieldIdsToShow(r))))},p.prototype.isVisible=function(){return!!this._processForm},p.prototype.getTreeDocument=function(){if(this._processForm)return this._processForm.getDataGridView().getTreeDocument()},p.prototype.destroy=function(){let e=t.getComponent("ModelEvents");this._removeFormListener(),this._tokens.forEach(e.unsubscribe),this._processForm&&this._processForm.destroy()},p}),define("DS/DELWebOpen/OpenControl",["DS/Logger/Logger","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","DS/DELWebCommonCmds/DELWeb3DFilterCmd","DS/ApplicationFrame/CommandsManager","DS/DELWebComponentManager/DELWebComponentManager","DS/DELWebComponentManager/DELWebTypesUtil","DS/DELWebComponentManager/DELWebComponent","DS/DELWebOpen/Model","DS/DELWebOpen/ContextHelper","DS/DELWebOpen/ProcessForm","DS/DELWebOpen/Helper","text!DS/DELWebOpen/assets/json/Constants.json","i18n!DS/DELWebOpen/assets/nls/OpenControl"],(e,t,o,n,i,r,l,s,a,c,p,d,u,f)=>{"use strict";const m=JSON.parse(u);var g=function(...t){s.apply(this,t),this.logger=e.getLogger("DS/DELWebOpen/OpenControl")};return(g.prototype=Object.create(s.prototype)).constructor=g,g.prototype._onFailure=function(e,t="DELOP_E00",o){let n=o?m.ErrorCodes[t].replace({}):m.ErrorCodes[t];this.logger.debug(e),this._initOptions.onError&&this._initOptions.onError({results:[],error:{code:t,message:f.replace(f.get(n),o)}})},g.prototype._showMask=function(){t.mask(widget.body,f.get("WaitingPage.Title"))},g.prototype._removeMask=function(){t.unmask(widget.body)},g.prototype._onOpen=function(e){this._initOptions.onOpen&&this._initOptions.onOpen(e)},g.prototype._onCancel=function(e){this._initOptions.onCancel&&this._initOptions.onCancel(e)},g.prototype._openFilter=function(e){let t,n,i=r.getComponent("ModelEvents"),l=function(){t&&o.unsubscribe(t),n&&i.unsubscribe(n)};t=o.subscribe("onApplyNGFilter/"+this._utils.getSharedAppId(),function(t){t.filterRootIds&&1===t.filterRootIds.length&&(l(),e.onApply(t))}),n=i.subscribe({event:"onFilterCancel"},function(t){l(),e.onCancel(t.data)}),this.publish("onOpenFilter",e.data)},g.prototype._open=async function(e){let t=this;t._utils.markStart("openItem"),!0===e.items[0].withFilter?t._openFilter({data:e.items,onApply:o=>{let n;o.filterRootIds&&1===o.filterRootIds.length&&(n=o.filterRootIds[0],e.items.forEach(function(e){e.id===n?e.filter=o.CVQueryV2.filter:e.withFilter=!1}),t._onOpen({results:e.items}))},onCancel:e=>{e&&e.result&&e.filterData?(e.filterData.forEach(function(e){e.withFilter=!1}),t._onOpen({results:e.filterData})):t._onCancel()}}):(t._utils.markEnd("openItem","Item opened in"),t._onOpen({results:e.items}))},g.prototype._openProcess=async function(e){let t,o,n,i=this,s=[],a=()=>{let e=r.getComponent("ModelEvents");i.publish("onFormClean"),s.forEach(e.unsubscribe),i._model.remove("attributes"),i._model.remove("formData")},u=async function(){var e=[],t=i._model.get("formData");i._showMask();try{e.push(async function(){let e=i._model.get("formData"),t=await i._utils.getCapableResource(e.process.context);UWA.is(t,"array")&&t.length>0&&(e.rsc={context:t[0].physicalid,pprType:l.PPRTYPES.RESOURCE})}()),e.push(async function(){let e,t=i._model.get("formData");t.mfg&&(e=t.mfg.contextOccurrence)&&e.length>1&&(t.mfg.predecessors=await i._utils.getInstallPredecessors(t.mfg.context,e[e.length-2]))}()),await Promise.all(e),i._removeMask(),i._onOpen({results:[function(){let e=function(e){var t,o;return e&&(o=e.contextOccurrence&&e.contextOccurrence.length>0?e.contextOccurrence[e.contextOccurrence.length-1]:e.context,Object.assign(e,{id:o,occurrence:e.contextOccurrence?1===e.contextOccurrence.length?[]:e.contextOccurrence:[]}),delete e.context,delete e.contextOccurrence,t=e),t};var o=e(t.process),n=e(t.mfg),i=e(t.rsc);return o.scopedMfg=n,o.resource=i,o}()]})}catch(e){i._removeMask(),i.logger.debug(e),i._onFailure(`Error occurred while fetching resource/predecessors for mfg ${t.mfg.context}`,"DELOP_E00")}finally{a()}},f=()=>{a(),i._onCancel()},g=async()=>{if(!0===e.showForm){let n=await this._utils.getAttributeForIds(c.getAllPhysicalIds(t,e.id),Object.values(m.Attributes),Object.values(m.FileAttributes));this._model.set("attributesMap",n);let i=Object.assign({},this._initOptions,{onOpen:u,onCancel:f});o=new p(this._model,i)}else r.getComponent("ModelEvents").subscribe({event:"onGetFieldValue"},e=>{let{fieldId:t,ids:o}=e&&e.data||{};o&&o.length>1&&this._onFailure(`Multiple ids found for ${t}`,"DELOP_E02",{fieldId:t})})},h=function(){o&&o.isVisible()?i.publish("onFormComplete"):u()},b=async e=>{let t=i._model.get("formData");i._openFilter({data:[{id:t.mfg.context,type:t.mfg.type,pprType:t.mfg.pprType,withFilter:!0,filterSpec:i._model.get("filterSpec"),publicFilterSpec:i._model.get("publicFilterSpec")}],onApply:o=>{let n;o.filterRootIds&&1===o.filterRootIds.length&&(n=o.filterRootIds[0],t.mfg.context===n&&(t.mfg.filter=o.CVQueryV2.filter,t.mfg.withFilter=!0,t.process.filter=o.CVQueryV2.filter,i.publish("onFilterApplied",{fieldId:e}),h()))},onCancel:o=>{o&&o.result?(t.mfg.filter=null,t.mfg.withFilter=!1,t.process.filter=null,t.process.withFilter=!1,i.publish("onFilterCancelled",{fieldId:e}),u()):f()}})},_=function(e,t){t&&t.ids&&t.ids.length>0&&(i.publish("onGetFieldValue",{fieldId:e,ids:t.ids}),1===t.ids.length&&i.publish(`on${e}Select`,t.ids[0]))},y=async function(t){let o,n=i._model.get("formData"),r=(a=[],(s=[t])&&(a=s.map(e=>e.split(m.Context.delimeter)[0])),a);var s,a;if(r&&1===r.length)if(n.mfg={context:r[0],contextOccurrence:t.split(m.Context.delimeter),pprType:l.PPRTYPES.MBOM},!0===e.installAutoApplyVolume){let t=n.mfg.contextOccurrence;o=await d.computeVolumeFilter(n.mfg.context,t[t.length-1],{installVolumeOffSet:e.installVolumeOffSet,withFilter:e.withFilter}),i._model.set("publicFilterSpec",o),b(m.Fields.MfgInstallOccurrence)}else!0===e.withFilter?b(m.Fields.MfgInstallOccurrence):h()},C=function(o){let n=i._model.get("formData");n.mfg={context:o,pprType:l.PPRTYPES.MBOM},c.getMfgInstallOccurrences(t,e.id,n.process.context,o).ids.length>0?function(){let o=i._model.get("formData");var n=c.getMfgInstallOccurrences(t,e.id,o.process.context,o.mfg.context);_(m.Fields.MfgInstallOccurrence,n)}():!0===e.withFilter?b(m.Fields.MfgScopedItem):h()},F=function(o){let n=i._model.get("formData");var r;n.process.contextOccurrence=o.split(m.Context.delimeter),n.process.context,r=c.getMfgContext(t,e.id,i._model.get("formData").process.context),_(m.Fields.MfgScopedItem,r)},O=function(o){var n;i._model.get("formData").process={context:o,pprType:l.PPRTYPES.PROCESS,withFilter:e.withFilter},n=c.getProcessContextOccurrences(t,e.id,i._model.get("formData").process.context),_(m.Fields.ProcessContextOccurrence,n)};if(e.scopedMfg){let t=e.scopedMfg;!0===t.withFilter?i._openFilter({data:[t],onApply:o=>{let n;o.filterRootIds&&1===o.filterRootIds.length&&(n=o.filterRootIds[0],t.id===n&&(e.filter=t.filter=o.CVQueryV2.filter,i._onOpen({results:[e]})))},onCancel:e=>{e&&e.result&&e.filterData?(e.filterData.withFilter=!1,i._onOpen({results:[e.filterData]})):i._onCancel()}}):i._onOpen({results:[e]})}else i._showMask(),(()=>{const e={ProcessContext:O,ProcessContextOccurrence:F,MfgScopedItem:C,MfgInstallOccurrence:y};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&s.push(r.getComponent("ModelEvents").subscribe({event:`on${t}Select`},function(o){let n=o?o.data:null;i.logger.debug(`Value of the ${t} is ${n}`),e[t](n)}))})(),[t,n]=await Promise.all([i._utils.getContextScope(e.id),async function(){let t;!0===e.withFilter&&e.buildId&&await i._utils.getFilterSpec(e.buildId)&&(t={filterSpec:{specification:{type:i._filterCmd.getProxy().CONFIG_FILTER,data:await i._utils.getFilterSpec(e.buildId)}}});return t}()]),i._model.set("context",t),i._model.set("filterSpec",n),await g(),i._removeMask(),(()=>{let o;(o=c.getProcessContext(t,e.id))&&o.ids.length>0?(i._model.set("formData",{}),_(m.Fields.ProcessContext,o)):(i._model.set("formData",{process:{context:e.id,type:e.type,pprType:l.PPRTYPES.PROCESS,withFilter:e.withFilter}}),h())})()},g.prototype.initialize=async function(e){this._filterCmd=i.getCommand("DELWeb3DFilterCmd"),this._filterCmd||(this._filterCmd=new n({context:null,ID:"DELWeb3DFilterCmd",isEnabled:!0,arguments:[]})),this._filterCmd.initProxy(),this._initOptions=e||{},this._utils=r.getComponent("Utils"),this._model=new a},g.prototype.publish=function(e,t){r.getComponent("ModelEvents").publish({event:e,data:{data:t,origin:"OpenController"}})},g.prototype.open=async function(e){let t;if(this.logger.debug("OpenControl open invoked with params",e),e&&e.id)switch(t=await l.getTaxonomies([e.id]),e.pprType=l.getPPRType(t[e.id]),e.pprType){case l.PPRTYPES.PROCESS:this._openProcess(e);break;default:this._open({items:[e]})}else this._onFailure("id property is missing","DELOP_E01")},g.prototype.openMultiRoots=async function(e){let t;this.logger.debug("OpenControl open invoked with params",e),e&&e.items&&e.items.length>0?(t=await l.getTaxonomies(e.items.map(e=>e.id)),e.items.forEach(function(e){e.pprType=l.getPPRType(t[e.id])}),-1!==e.items.map(e=>e.pprType).indexOf(l.PPRTYPES.PROCESS)?this._onFailure(`${l.PPRTYPES.PROCESS} type not supported in MultiRoots Scenarios`,"DELOP_E04",{type:l.PPRTYPES.PROCESS}):this._open(e)):this._onFailure("items property is missing","DELOP_E01")},g.prototype.clean=async function(){this._filterCmd&&this._filterCmd.cleanProxy(),this._initOptions={},this._utils=null,this._model&&this._model.clear(),this._model=null},g});