define("DS/ENOFilterExplicitWebInWin/views/filterRepairUI",["UWA/Core","UWA/Element","UWA/Promise","UWA/Class/View","DS/Tree/TreeListView","DS/Tree/TreeNodeModel","DS/Handlebars/Handlebars4","DS/UIKIT/SuperModal","DS/UIKIT/Mask","DS/WAFData/WAFData","DS/Controls/Accordeon","DS/Controls/TooltipModel","DS/Controls/Button","DS/CollectionView/ResponsiveLargeTilesCollectionView","i18n!DS/ENOFilterExplicitWebInWin/assets/nls/ENOStrRefinementUX.json","text!DS/ENOFilterExplicitWebInWin/template/filterRepairUITemplate.html","css!DS/ENOFilterExplicitWebInWin/ENOFilterExplicitWebInWin.css","DS/ENONextGenFilterUX/utils/FilterUIService"],function(e,t,i,n,r,a,l,o,s,c,d,h,p,u,g,f,v,m){"use strict";return n.extend({setup:function(e){this._isRepairFilterLaunchedInWidget=!1,this.securityCtx=e.ctx,this.serverUrl=e.url,this._brokenPathObj="object"==typeof e.brokenPaths?e.brokenPaths:JSON.parse(e.brokenPaths),this._template=l.compile(f),this.container.addEvent("click",function(e){return e.stopPropagation(),!1})},render:function(){var t=this;this.container.setContent(this._template({AppType:this._isRepairFilterLaunchedInWidget?"widget":"webInWin",filterNameToRepair:g.get("RepairPanelHeader")})),this._ListOfTileViewCollection=[],this._myAccordeon=new d({touchMode:!1,style:"filled-separate"}),this._myAccordeon.inject(this.getElement(".repairFilter-list-accordeons"));for(var i=0;i<t._responseJsonObj.paths.length;i++){var n=new u({height:"inherit",displayTitleTooltip:!0,displayPropertiesTooltip:!0,useDragAndDrop:!1,toggle:!0});n.selectionBehavior={unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!1,enableShiftSelection:!1,enableListSelection:!1,enableFeedbackForActiveCell:!0};for(var r=[],l=0;l<t._responseJsonObj.paths[i].length;l++){var s=t._responseJsonObj.paths[i][l],c=s.length,f=t._checkForDeletedPathCase(s),v=!!f&&this._checkForReplacedPathCase(s,this._brokenPathObj.paths[i]);if(c>0&&s[c-2].name&&f&&!v){var m=this._buildNodeFromData(s);if(m.label){var b=new a({label:m.label,subLabel:s[c-1].trueType,thumbnail:s[c-1].preview_url,data:m.data});r.push(b)}}}if(r.length>0){n.model=r,this._ListOfTileViewCollection.push(n),n.modelProvider.selectNode(r[0]);var _=e.createElement("div",{class:"tile1 accordeon-node"});_.inject(this.getElement(".repairFilterTiles-test")),n.inject(_);var y=n.model.length,T=125*y+"px";_.setStyle("height",T);var S={header:t._brokenPathObj.paths[i][t._brokenPathObj.paths[i].length-1].name,content:_};this._myAccordeon.addItem(S);var I=e.createElement("span",{class:"ignore-span accordeon-"+i,text:g.get("IgnoreTitle")});I.setAttribute("expander",i);var O=e.createElement("div",{class:"statusOfRepair statusNum-"+i,text:g.get("SolvedCellName")}),C=this.getElements(".wux-controls-expander-header-container")[i];I.inject(C),O.inject(C),C.tooltipInfos=new h({shortHelp:S.header,mouseRelativePosition:!0}),I.addEventListener("click",function(e){var i=e.target.getAttribute("expander"),n=t._ListOfTileViewCollection[i],r=e.target.getText();g.get("IgnoreTitle")===r?(t._ignore=!0,e.target.setText(g.get("ReactivateTitle")),n.modelProvider.unselectAll()):g.get("ReactivateTitle")===r&&(t._reactivate=!0,e.target.setText(g.get("IgnoreTitle")),n.modelProvider.selectNode(n.model[0]))},!1)}else{this._ListOfTileViewCollection.push(n);var F=new UWA.Element("div",{text:g.get("ObjectDeleted")});S={header:t._brokenPathObj.paths[i][t._brokenPathObj.paths[i].length-1].name,content:F};this._myAccordeon.addItem(S);var E=e.createElement("span",{class:"ignore-span deletedPath-span accordeon-"+i,text:g.get("Deleted")});C=this.getElements(".wux-controls-expander-header-container")[i];E.inject(C),C.tooltipInfos=new h({shortHelp:S.header,mouseRelativePosition:!0})}var w=function(e,i){for(var n=e.getLabel(),r="",a=t._ListOfTileViewCollection.length,l=0;l<a;l++){var o=t._ListOfTileViewCollection[l].model;if(o.length)for(var s=0;s<o.length;s++)if(n===o[s].getLabel()){r=l,t._myAccordeon.getExpanderFromIndex(l).expand();break}}if(r>=0){var c=t.getElement(".statusNum-"+r);c.setText("add"===i?g.get("SolvedCellName"):g.get("IgnoreCellName")),c.setStyle("background-color","add"===i?"limegreen":"darkorange"),(l=t.getElement(".accordeon-"+r)).setText("add"===i?g.get("IgnoreTitle"):g.get("ReactivateTitle"))}};n.onSelectionAdd(function(e){w(e,"add")}),n.onSelectionRemove(function(e){w(e,"remove")})}var x=function(e){e.stopImmediatePropagation();var t=e.options.expanderIndex,i=this._ListOfTileViewCollection[t],n=this.getElement(".statusNum-"+t);this._ignore?(i.modelProvider.unselectAll(),this._ignore=!1,n.setText(g.get("IgnoreCellName")),n.setStyle("background-color","darkorange")):this._reactivate&&(i.modelProvider.selectNode(i.model[0]),this._reactivate=!1,n.setText(g.get("SolvedCellName")),n.setStyle("background-color","limegreen"))};this._myAccordeon.getContent().addEventListener("expand",x.bind(this)),this._myAccordeon.getContent().addEventListener("collapse",x.bind(this));var A=this.getElement(".repairFilter-footer"),N=t._isRepairFilterLaunchedInWidget?"TitleOK":"TitleApply";return this.applyButton=new p({touchMode:!0,domId:"applyButton",label:g.get(N),emphasize:"secondary"}).inject(A),this._isRepairFilterLaunchedInWidget||(this.saveButton=new p({touchMode:!0,domId:"saveButton",label:g.get("TitleSave"),emphasize:"secondary"}).inject(A),this.saveButton.addEventListener("buttonclick",function(){new o({closable:!0,renderTo:document.body,id:"superModaldialog"}).confirm(g.get("SaveWarning"),g.get("SaveWarningTitle"),function(e){if(console.log("Confirm result: "+e),e){var i=t._operateModel();t._webInWinNotif("SaveButton",i.listOfList)}})})),this.cancelButton=new p({touchMode:!0,domId:"cancelButton",label:g.get("TitleCancel"),emphasize:"secondary"}).inject(A),this.cancelButton.addEventListener("buttonclick",function(){if(t._isRepairFilterLaunchedInWidget){t.dispatchEvent("NGF_CancelRepairFilter",{listOfList:"CancelRepair"})}else t._webInWinNotif("CancelButton")}),this.applyButton.addEventListener("buttonclick",function(){var e=t._operateModel();t._isRepairFilterLaunchedInWidget?t.dispatchEvent("NGF_RepairFilter",e):t._webInWinNotif("ApplyButton",e.listOfList)}),this},RepairFilterInWidget:function(){this._isRepairFilterLaunchedInWidget=!0},fetchData:function(){var e=this;return new i(function(t){c.authenticatedRequest(e.serverUrl+"/resources/FilterBIAPI/ExplicitMgt/getGoodVersionsIds",{headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:e.securityCtx},method:"POST",data:JSON.stringify(e._brokenPathObj),onComplete:function(i){e._responseJsonObj={paths:[]};var n=JSON.parse(i);"object"==typeof n&&Array.isArray(n.paths)&&(e._responseJsonObj=n),e._responseJsonObj?e._getThumbnailAndTypeInfo().then(function(){t("RepairFilterFetchData_SUCCESS")}):t("RepairFilterFetchData_SUCCESS")},onFailure:function(i,n){var r;n?r=JSON.parse(n).error:(console.log(" WebService Failure"),r=g.get("ServerError")),e._isRepairFilterLaunchedInWidget?m.displayNotification({level:"error",title:"Repair Filter",message:r}):alert(r),s.unmask(e.container),t("RepairFilterFetchData_FAILURE")}})})},_checkForDeletedPathCase:function(e){if(0==e.length)return!1;for(var t=0;t<e.length;t++)if(!e[t].name)return!1;return!0},_checkForReplacedPathCase:function(e,t){if(e[e.length-1].logicalid!=t[t.length-1].logicalid)return!0},_buildNodeFromData:function(e){for(var t=e[e.length-2].name+" - "+e[e.length-1].revision,i=e[e.length-2].coretype,n=[],r=[],a=0;a<e.length;a++)n.push(e[a].physicalid),r.push(e[a].logicalid);return{label:t,subLabel:i,data:{pathOfPhysicalID:n,pathOfLogicalID:r}}},_webInWinNotif:function(e,t){var i=JSON.stringify(t);console.log(i),"undefined"!=typeof CATCefSendString&&dscef.sendString(e+"="+i)},_operateModel:function(){for(var e=[],t=[],i=this._ListOfTileViewCollection.length,n=0;n<i;n++){var r=this._ListOfTileViewCollection[n],a=r.getActiveCellID();if("undefined"!==a&&r.modelProvider.isNodeSelected(r.model[a])){var l=r.getModelAt(a).options.data;e.push(l.pathOfPhysicalID),t.push(l.pathOfLogicalID)}}return{listOfList:e}},_getThumbnailAndTypeInfo:function(){var e=this;return new i(function(t){for(var i=[],n=e._responseJsonObj.paths,r=n.length,a=0;a<r;a++){var l=n[a].length;if(1==l)(s=n[a][0].length)>0&&i.push(n[a][0][s-1].physicalid);else for(var o=0;o<l;o++){var s;(s=n[a][o].length)>0&&i.push(n[a][o][s-1].physicalid)}}i.length>0?e._fetchTypeUrlInfo(i).then(function(n){var r=[];if(n.results=n.results||[],n.results.length<=i.length){for(var a=0;a<n.results.length;a++){for(var l,o,s,c=n.results[a],d=0;d<c.attributes.length;d++){var h=c.attributes[d];"resourceid"==h.name&&(l=h.value),"preview_url"==h.name&&(o=h.value),"type"==h.name&&(s=h.value)}var p={physicalid:l,url:o,type:s};r.push(p)}for(var u=e._responseJsonObj.paths,g=u.length,f=0;f<g;f++){var v=u[f].length;if(1==v){if((_=u[f][0].length)>0)for(var m=u[f][0][_-1].physicalid,b=0;b<r.length;b++)r[b].physicalid==m&&(u[f][0][_-1].preview_url=r[b].url,u[f][0][_-1].trueType=r[b].type)}else for(b=0;b<v;b++){var _;if((_=u[f][b].length)>0){m=u[f][b][_-1].physicalid;for(var y=0;y<r.length;y++)r[y].physicalid==m&&(u[f][b][_-1].preview_url=r[y].url,u[f][b][_-1].trueType=r[y].type)}}}t()}}):t()})},_fetchTypeUrlInfo:function(e){var t=this;return new i(function(i,n){var r={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({label:"NGF_ExecuteFetch",physicalid:e,select_file:["icon","thumbnail_2d"],select_predicate:["type"]}),onComplete:function(e){i(e)},onFailure:function(e){n(e)}};c.authenticatedRequest(t.serverUrl+"/cvservlet/fetch/v2",r)})}})});