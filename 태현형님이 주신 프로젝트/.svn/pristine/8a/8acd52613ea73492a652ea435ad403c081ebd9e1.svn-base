window.define&&define("DS/DELWebInfrastructureControls/UWAUtils",["UWA/Core","UWA/Object","UWA/Array","UWA/Function"],function(e,t,i,a){"use strict";var s={isPlainObject:function(e){if(window.jQuery)return window.jQuery.isPlainObject(e);if(!e||e.nodeType||"object"!=typeof e||window===e)return!1;if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},isEmptyObject:function(e){return window.jQuery?window.jQuery.isEmptyObject(e):0===Object.keys(e).length}};for(var r in s)r in t&&delete s[r];Object.assign(t,s);var n={isArraylike:function(e){var t=e.length,i=typeof e;if(window.jQuery){if(i=window.jQuery.type(e),window.jQuery.isWindow(e))return!1}else if(e===window)return!1;return!(1!==e.nodeType||!t)||("array"===i||"function"!==i&&(0===t||"number"==typeof t&&t>0&&t-1 in e))}};for(var r in n)r in i&&delete n[r];Object.assign(i,n);var o={isFunction:function(e){return window.jQuery?window.jQuery.isFunction(e):e instanceof Function||"function"==typeof e||"[object Function]"==Object.prototype.toString.call(e)}};for(var r in o)r in t&&delete o[r];Object.assign(a,o);var l={isWindow:function(e){return window.jQuery?window.jQuery.isWindow(e):null!=e&&e==e.window},each:function(t,i,a){if(window.jQuery&&window.jQuery.each)return window.jQuery.each(t,i,a);var s=0,r=t.length,n=e.Array.isArraylike(t);if(a){if(n)for(;s<r&&!1!==i.apply(t[s],a);s++);else for(s in t)if(!1===i.apply(t[s],a))break}else if(n)for(;s<r&&!1!==i.call(t[s],s,t[s]);s++);else for(s in t)if(!1===i.call(t[s],s,t[s]))break;return t}};for(var r in l)r in e&&delete l[r];return Object.assign(e,l),e}),define("DS/DELWebInfrastructureControls/DELWebDocFacet",["UWA/Core","UWA/Controls/Abstract","UWA/Class","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXAttachmentsUX/AttachmentsPane"],function(e,t,i,a,s){"use strict";return i.extend(t,a,{_docList:null,init:function(e){this._parent(e),e.platformUrls&&!e.platformUrls.platformId&&(e.platformUrls.platformId=window.widget.data.x3dPlatformId||"OnPremise"),this.platformUrls=e.platformUrls,this.collabSpace=e.collabSpace,this._initUI()},_initUI:function(){this.elements.container=e.createElement("div",{class:"relatedDocumentsv2"}),this.attachmentsPane=null},updateFacet:function(){var e=this,t=function(t){if(t)if(null===e.attachmentsPane){var i={parentObject:{parentId:t},connectorOptions:{fetchSecurityContext:function(){return e.collabSpace||window.widget.getValue("pad_security_ctx")||window.widget.getValue("collabSpace")},platformUrls:e.platformUrls||null}};e.attachmentsPane=new s(i),e.attachmentsPane.inject(e.elements.container)}else{if(!t)return;var a={parentId:t};e.attachmentsPane&&(e.attachmentsPane.show(),e.attachmentsPane.options.parentObject.parentId!==t&&e.attachmentsPane.setParentObject(a))}},i=this.getModel();i?"relationship"===i.get("metatype")?this.getOccurrence().addEventOnce("onChange:properties",function(){var i=e.getModel();t(i.get("objectId"))}):t(i.get("objectId")):t()},onRefresh:function(){this.updateFacet()}})}),window.define&&define("DS/DELWebInfrastructureControls/Mask",["UWA/Core","DS/Controls/Loader","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],function(e,t,i){"use strict";return{mask:function(a,s){var r;this.isMasked(a)&&this.unmask(a),a.addClassName("masked"),r=e.createElement("div",{class:"mask"}),s=e.is(s,"string")?s:i.get("Loading"),e.createElement("div",{class:"mask-wrapper",html:{tag:"div",class:"mask-content",html:[new t({text:s,showButtonFlag:!1})]}}).inject(r),r.inject(a);var n=r.getElementsByClassName("wux-controls-loader");n&&n.length&&n[0].dsModel&&n[0].dsModel.show()},unmask:function(e){var t=e.getElement(" > .mask");t&&t.destroy(),e.removeClassName("masked")},isMasked:function(e){return e.hasClassName("masked")}}}),window.define&&define("DS/DELWebInfrastructureControls/DELWebAjaxModel",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","UWA/Promise","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CoreEvents/Events","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],function(e,t,i,a,s,r,n){"use strict";var o={},l=window.Configuration&&window.Configuration.webroot?window.Configuration.webroot:null,c=t.singleton({init:function(t){this._parent&&this._parent.apply(this,arguments),t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)&&(this.options=Object.assign(this.options,t)),this.setupCompassConfig(),this.setupWebRoot()},setCacheObject:function(t){t&&e.Object.isPlainObject(t)&&(o=t)},getCacheObject:function(e){return o},setupWebRoot:function(){if(l)return l;var t=null,i=(t=window.widget&&window.widget.environment&&"uwa"!=window.widget.environment.name&&window.widget.getUrl?e.createElement("a",{href:window.widget.getUrl()}):e.createElement("a",{href:window.location.href})).pathname.indexOf("/",1);l=i<0?t.pathname:t.pathname.substring(0,i),e.log("in DELWebResourceParameterModel: initial webroot = "+l);var a=t.origin||"";return a||(t.protocol&&t.hostname?(a=t.protocol+"//"+t.hostname,t.port&&(a+=":"+t.port)):window.steal&&window.steal.isRhino&&(a="http://127.0.0.1")),"/"!==l[0]&&window.Configuration&&(l="/"+window.Configuration.webroot||""),l=a+l},setupCompassConfig:function(){window.COMPASS_CONFIG||(window.COMPASS_CONFIG={}),window.COMPASS_CONFIG.myAppsBaseUrl||(window.COMPASS_CONFIG.myAppsBaseUrl=c.setupWebRoot()),window.COMPASS_CONFIG.userId||(window.COMPASS_CONFIG.userId=window.enoviaServerCAWidget&&window.enoviaServerCAWidget.contextUser?window.enoviaServerCAWidget.contextUser:null,!window.COMPASS_CONFIG.userId&&window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&(window.COMPASS_CONFIG.userId=window.Foe.Model.Session.get("user"))),window.COMPASS_CONFIG.lang||(window.COMPASS_CONFIG.lang=window.widget.lang||window.$&&window.$.jsperanto&&window.$.jsperanto.lang())},getPlatformServices:function(t){var a=c;return new i(function(i,r){var n=null;if(t||(t={}),!t.platformId&&window.widget.data&&(t.platformId=window.widget.data.x3dPlatformId),o.platform_services&&!1!==t.blnCachedOk&&(e.Object.isPlainObject(o.platform_services)&&!e.Object.isEmptyObject(o.platform_services)||Array.isArray(o.platform_services)&&o.platform_services.length))return e.Object.isPlainObject(o.platform_services)?n=Object.assign({},o.platform_services):Array.isArray(o.platform_services)&&(n=o.platform_services.slice(0)),i(n),n;window.COMPASS_CONFIG&&window.COMPASS_CONFIG.userId||a.setupCompassConfig(),l&&(window.widget.standalone||"uwa"===window.widget.environment.name)&&(o._i3DXCompassPlatformServices_timeout=setTimeout(function(){return delete o._i3DXCompassPlatformServices_timeout,(!o.platform_services||Array.isArray(o.platform_services)&&!o.platform_services.length)&&(o.platform_services={"3DCompass":l,"6WTags":l,"3DSpace":l,"3DSearch":!1},window.widget.getUrl().contains("TSK7719527=1")&&a.useFixtures()&&(o.platform_services["3dmfgworkorder"]=l),window.widget.getUrl().contains("TSK9232963=1")&&a.useFixtures()&&(o.platform_services.r2vsurvey=l)),a.getPlatformServices(t).then(i,r)},5e3)),s.getPlatformServices({platformId:t.platformId,config:window.COMPASS_CONFIG,onComplete:function(t){o._i3DXCompassPlatformServices_timeout&&(clearTimeout(o._i3DXCompassPlatformServices_timeout),delete o._i3DXCompassPlatformServices_timeout);var s=t;t&&t.length&&(s=t[0]),window.widget.getUrl().contains("TSK7719527=1")&&!s["3dmfgworkorder"]&&a.useFixtures()&&(s["3dmfgworkorder"]=l),window.widget.getUrl().contains("TSK9232963=1")&&!s.r2vsurvey&&a.useFixtures()&&(s.r2vsurvey=l),s.r2vsurvey&&!s.r2vsurvey.contains("/enovia")&&(s.r2vsurvey+="/enovia"),o.platform_services=s,e.Object.isPlainObject(s)?i(Object.assign({},s)):Array.isArray(s)&&i(s.slice(0))},onFailure:function(t){o._i3DXCompassPlatformServices_timeout&&(clearTimeout(o._i3DXCompassPlatformServices_timeout),delete o._i3DXCompassPlatformServices_timeout),o.platform_services&&e.Object.isPlainObject(o.platform_services)||(o.platform_services={"3DCompass":l,"6WTags":l,"3DSpace":l,"3DSearch":null}),r(t)}})})},getServiceUrl:function(t){var a=c;return new i(function(i,r){t&&t.serviceName?o.platform_services&&o.platform_services[t.serviceName]?i(o.platform_services[t.serviceName]):(window.COMPASS_CONFIG&&window.COMPASS_CONFIG.userId||a.setupCompassConfig(),!t.platformId&&window.widget.data&&(t.platformId=window.widget.data.x3dPlatformId),s.getServiceUrl({platformId:t.platformId,serviceName:t.serviceName,config:window.COMPASS_CONFIG,onComplete:function(a){var s=null;a&&a.length&&(s=1===a.length?a[0].url:a),s||(o.platform_services&&o.platform_services[t.serviceName]?s=o.platform_services[t.serviceName]:!window.widget.standalone||"3DSpace"!==t.serviceName||t.platformId&&"onpremise"!==t.platformId.toLowerCase()||(s=l)),(!o.platform_services||e.Array.isArray(o.platform_services)&&!o.platform_services.length)&&(o.platform_services={}),o.platform_services[t.serviceName]=s,i(s)},onFailure:function(a){window.widget.standalone&&o.platform_services&&!e.Object.isEmptyObject(o.platform_services)?(e.log("DELWebResourceParameterModel::getServiceURL - onFailure A"),o.platform_services[t.serviceName]||(o.platform_services[t.serviceName]=null,"3DSpace"!==t.serviceName||t.platformId&&"onpremise"!==t.platformId.toLowerCase()||(o.platform_services[t.serviceName]=l)),i(o.platform_services[t.serviceName])):r(a)}})):r("invalid input params")})},callAuthenticatedRequest:function(t,s,r,n,l,u){var d=c;return new i(function(i,m){for(var p=window.Foe,h=window.widget.getValue("pad_security_ctx")||window.widget.getValue("collabSpace");h&&h.contains("ctx::ctx::");)h=h.replace("ctx::ctx::","ctx::");window.COMPASS_CONFIG&&window.COMPASS_CONFIG.userId||d.setupCompassConfig();var f=window.COMPASS_CONFIG.userId||"";if(!f&&p&&p.Model&&p.Model.Session){if(!h)for(h=p.Model.Session.get("security_ctx");h&&h.contains("ctx::ctx::");)h=h.replace("ctx::ctx::","ctx::"),p.Model.Session.set("security_ctx",h);f||(f=p.Model.Session.get("user"))}var g={Accept:"application/json","Accept-Language":window.widget.lang,"Content-Type":!n||n.constructor&&"FormData"===n.constructor.name?null:"application/json; charset=UTF-8",SecurityContext:h,SecurityToken:f+"|"+h+"|preferred"};o.platform_services&&o.platform_services["3DSearch"]&&0===t.indexOf(o.platform_services["3DSearch"])?(delete g.SecurityContext,delete g.SecurityToken):o.platform_services&&o.platform_services["3dmfgworkorder"]&&0===t.indexOf(o.platform_services["3dmfgworkorder"])?delete g.SecurityToken:o.platform_services&&o.platform_services.r2vsurvey&&0===t.indexOf(o.platform_services.r2vsurvey)&&(delete g.SecurityContext,delete g.SecurityToken),u&&e.Object.isPlainObject(u)&&e.Object.assign(g,u);var v=null;window.widget.standalone||(v=e.Data.proxies.passport?"passport":"ajax"),window.jQuery&&0==window.jQuery.active++&&window.jQuery.event.trigger("ajaxStart"),a.authenticatedRequest(t,{proxy:v,timeout:12e4,type:s,method:r,async:!0,headers:g,data:n,onComplete:function(t){var a=null;if(t&&t.infos&&t.infos.sources&&1===t.infos.sources.length&&t.infos.sources[0].error&&"FS_AUTHENTICATION_ERROR__REDIRECT"===t.infos.sources[0].error.errorCode)return a=t.infos.sources[0].error.errorMessage||t.infos.sources[0].error.errorCode,m(a?"Invalid auth: "+a:"Invalid auth"),e.log("Invalid auth: "+a),e.log("-- Details: "+t.infos.sources[0].error.errorCode),c.publish("Auth.LoginRequired",t.infos.sources[0]),m(a),!1;if(t&&t.error&&l&&e.Function.isFunction(l)&&"CLOUDVIEW_ERROR__SUMMARY"===t.error.errorCode&&t.error.errors&&t.error.errors.length){var s=!1;return e.each(t.error.errors,function(e,t){return!(s=t&&"CLOUDVIEW_ERROR__INVALID_ROOTS"===t.errorCode)}),s?l(t):m(t.error),!1}if(t&&t.error)return a=t.error.errorMessage||t.error.errorCode||"Authenticated Request Error",e.log("Authenticated Request Error: "+a),m(t.error),!1;i(t),window.jQuery&&!--window.jQuery.active&&window.jQuery.event.trigger("ajaxStop")},onFailure:function(t,i){if(e.log("Error"),window.jQuery&&!--window.jQuery.active&&window.jQuery.event.trigger("ajaxStop"),i&&"invalid_grant"===i.error){var a=i.error_description?i.error_description:t||"";return m(a?"Invalid auth: "+a:"Invalid auth"),e.log("Invalid auth: "+a),t&&e.log("-- Details: "+t),c.publish("Auth.LoginRequired",i),!1}i&&i.message?m(i.message):m(n)}})})},publishEvent:function(e,t){window.OpenAjax&&window.OpenAjax.hub.publish(e,t);var i={event:e};t&&(i.data=t),this.options&&this.options.modelEvents?this.options.modelEvents.publish(i):r.publish(i)},getReference:function(t){var a=this;return new i(function(i,s){var r={R:Math.random(),class_name:t.class_name?t.class_name:"PRODUCTCFG/VPMReference",Depth:t.Depth||t.depth||0,Minimum:"Minimum"in t?t.Minimum:"True",SkipCheckingResource:!0,ClearServerCache:!!t.blnForceRefresh&&t.blnForceRefresh};e.each(["OXID","PLM_ExternalID","physicalid","search_str","startindex","endindex","class_name","Extensions","SkipCheckingResource","ClearServerCache","searchByAttribute"],function(e,i){i in t&&(r[i]=t[i])}),r.Minimum instanceof Array&&(r.Minimum=JSON.stringify(r.Minimum)),"searchByAttribute"in r||!t.Discipline||(r.searchByAttribute='{"V_discipline":"'+t.Discipline+'"}'),a.getServiceUrl({serviceName:t.serviceName||"3DSpace"}).then(function(l){var c=l+"/resources/DELWebInfrastructureLite/v0/referenceFinder";t.fixtureTag&&"string"==typeof t.fixtureTag&&(c+="?"+t.fixtureTag),a.callAuthenticatedRequest(c,"json","GET",r).then(function(l){var c=a.commonAjaxJsonResponseOK(l,s);if(!c)return c;var u="VPMReference";if(t.class_name&&(u=t.class_name.substr(t.class_name.indexOf("/")+1)),l&&l[u]){var d=l[u],m=!1,p=(t.search_str||"").replace("*","");!m&&a.useFixtures()&&p&&p.length&&(e.each(d,function(e,i){i.V_Name===p||i.PLM_ExternalID===p?m=i:t.search_str.indexOf("*")>0&&i.V_Name&&0===i.V_Name.indexOf(p)&&(m=i)}),m||e.each([o.resource,o.parameter_list,o.parameter],function(i,a){e.each(a||[],function(e,i){return i&&!i.ReferenceOXID&&!i.ReferencePhysicalid&&i.V_Name&&(i.V_Name===p?(d.unshift(i),m=i):t.search_str.indexOf("*")>0&&0===i.V_Name.indexOf(p)&&d.unshift(i)),!m})})),e.each(d,function(i,s){if(a.removeNullAttributes(s),s.MatchResult&&!m&&a.useFixtures()&&t.search_str&&t.search_str.length&&!m&&("DELRmiResourceModel/Resource"===r.Extensions||r.Extensions.indexOf(s.V_discipline)>=0)&&p&&!m){var n=Object.assign({},s);n.PLM_ExternalID=p.replace("*",""),s.children&&!e.Object.isEmptyObject(s.children)&&(n.children=s.children),d.unshift(n),m=n}}),i(d)}else s(n.get("Error"))},s)},s)})},getTree:function(t){var a=this;return new i(function(i,s){if(!t)return e.log("getTree: params must be specified"),void s();if(!(t.PLM_ExternalID||t.physicalid||t.OXID||t.QueryList))return e.log("getTree: Either QueryList, PLM_ExternalID, physicalid or OXID must be specified inside params"),void s();if(t.QueryList&&(!t.QueryList.length||!(t.QueryList instanceof Array)))return e.log("getTree: QueryList Must be an array with at least one item in it"),void s();var r=function(e){var t=null;void 0!==e.Minimum&&(t=e.Minimum instanceof Array?e.Minimum.slice(0):e.Minimum);var i=null,s=a.FindPLMObjectInCache(e,"True");return s?(i=null!=t?t:["physicalid","V_Name"],s=a.FindPLMObjectInCache(e,i)):null};a.getServiceUrl({serviceName:"3DSpace"}).then(function(n){var o=n+"/resources/DELWebInfrastructureLite/v0/resource/expand?getTree",l={R:Math.random(),url:o,class_name:t.class_name?t.class_name:"PRODUCTCFG/VPMReference",Depth:t.Depth?t.Depth:"0",Minimum:t.Minimum?t.Minimum:"True",QueryList:t.QueryList?t.QueryList:void 0};e.each(["OXID","physicalid","PLM_ExternalID"],function(){var e=this.toString();t[e]&&(l[e]=t[e])});var c={},u=[],d=function(t){if(null!=t.CurrentDepth&&t.CurrentDepth>t.Depth)t.CurrentDepth-=1;else{null!=t.CurrentDepth?t.CurrentDepth+=1:t.CurrentDepth=0;var i=r(t);if(null!=i){if(t.CurrentDepth==t.Depth)c[i.physicalid||i.OXID]=i;else if(null!=i.children){var a=!0;e.each(i.children,function(e,t){var i={physicalid:t.physicalid,OXID:t.OXID,PLM_ExternalID:t.PLM_ExternalID},s=r(i);s?r({OXID:s.ReferencePhysicalid,OXID:s.ReferenceOXID})||(a=!1):a=!1}),a?(c[i.physicalid||i.OXID]=i,e.each(i.children,function(e,i){var a=r(i),s=r({physicalid:a.ReferencePhysicalid,OXID:a.ReferenceOXID});if(c[a.physicalid||a.OXID]=a,s){var n={physicalid:s.physicalid,OXID:s.OXID,PLM_ExternalID:s.PLM_ExternalID,CurrentDepth:t.CurrentDepth,Depth:t.Depth?t.Depth:0};d(n)}else u.push({PLM_ExternalID:t.PLM_ExternalID,physicalid:t.physicalid,OXID:t.OXID,Depth:t.Depth?t.Depth-t.CurrentDepth:0})})):(t.PLM_ExternalID||t.physicalid||t.OXID)&&u.push({PLM_ExternalID:t.PLM_ExternalID,physicalid:t.physicalid,OXID:t.OXID,Depth:t.Depth?t.Depth-t.CurrentDepth:0})}}else(t.PLM_ExternalID||t.physicalid||t.OXID)&&u.push({PLM_ExternalID:t.PLM_ExternalID,physicalid:t.physicalid,OXID:t.OXID,Depth:t.Depth-t.CurrentDepth});t.CurrentDepth-=1}},m=Object.assign({},l);m.QueryList?e.each(m.QueryList,function(e,t){d(t)}):d(m);var p=function(t,r){a.callAuthenticatedRequest(t,"json","GET",r).then(function(t){var r=a.commonAjaxJsonResponseOK(t,s);if(!r)return r;if(t&&t.Data){var n=Object.assign(t.Data,c);e.each(n,function(e,t){t.plmBaseObjectType&&("DELSCPLogisticsSiteRef"===t.plmObjectTypeInternal?t._objectType="workcenter":"DELSSerializedItem"===t.plmObjectTypeInternal||"VPMReference"===t.plmBaseObjectType&&("Ext(PLMDELMIAModeler/DELSerialNumber).V_SerialNumber"in t||"V_SerialNumber"in t)?t._objectType="execution_resource":"DELSAssetGroup"===t.plmBaseObjectType||"VPMReference"===t.plmBaseObjectType&&"WorkCenter"===t.V_discipline?t._objectType="execution_resource_group":"DELSAssetPool"===t.plmBaseObjectType||"VPMReference"===t.plmBaseObjectType&&"Pool"===t.V_discipline?t._objectType="execution_resource_pool":"DELLmiProductionSystemReference"===t.plmBaseObjectType&&"DELLmiProductionPlanReference"===t.plmObjectTypeInternal?t._objectType="execution_production_plan":"DELLmiWorkPlanSystemReference"===t.plmBaseObjectType||"DELLmiWorkPlanSystemReference"===t.plmObjectTypeInternal||"DELLmiHeaderWorkPlanReference"===t.plmBaseObjectType||"DELLmiHeaderWorkPlanReference"===t.plmObjectTypeInternal?t._objectType="workplan":"DELLmiProductionSystemReference"===t.plmBaseObjectType?t._objectType="process":"DELLmiOperationReference"===t.plmBaseObjectType?t._objectType="process":"DELFmiFunctionReference"===t.plmBaseObjectType?t._objectType="mbom":"DELResourceParameterListReference"===t.plmBaseObjectType?t._objectType="resource_parameter_list":"DELResourcePrm"===t.plmBaseObjectType||"DELResourcePrmINPUT"===t.plmBaseObjectType||"DELResourcePrmOUTPUT"===t.plmBaseObjectType||"DELResourceParameter"===t.plmBaseObjectType?t._objectType="resource_parameter":"R2V_FeatureOfInterest"===t.plmBaseObjectType||"R2V_FeatureState"===t.plmBaseObjectType?t._objectType="r2v_point_cloud_data":"VPMReference"===t.plmBaseObjectType&&(t._objectType="resource"))}),i(n)}else t&&t.error&&t.error.msg&&t.error.msg.text&&s(t.error.msg.text)},s)};if(Object.keys(u).length>0){if(delete l.PLM_ExternalID,delete l.OXID,delete l.physicalid,l.Minimum&&l.Minimum.constructor===Array){var h=l.Minimum;l.Minimum=JSON.stringify(h)}l.QueryList=JSON.stringify(u),p(o,l)}else if(Object.keys(c).length>0){var f={Data:Object.assign({},c)};i(f.Data)}else{if(l.Minimum&&l.Minimum.constructor===Array){h=l.Minimum;l.Minimum=JSON.stringify(h)}if(l.QueryList&&l.QueryList instanceof Object){var g=l.QueryList;l.QueryList=JSON.stringify(g)}p(o,l)}},s)})},getInstance:function(t){var a=this;return new i(function(i,s){return t?t.PLM_ExternalID||t.physicalid||t.OXID||t.QueryList?!t.QueryList||t.QueryList.length&&t.QueryList instanceof Array?void a.getServiceUrl({serviceName:"3DSpace"}).then(function(r){var n=r+"/resources/DELWebInfrastructureLite/v0/instanceFinder";t.Minimum&&"string"==typeof t.Minimum&&"false"!==t.Minimum.toLowerCase()&&"true"!==t.Minimum.toLowerCase()&&(t.Minimum=[t.Minimum]),t.Minimum instanceof Array&&t.Minimum.indexOf("name")>-1&&-1===t.Minimum.indexOf("PLM_ExternalID")&&t.Minimum.push("PLM_ExternalID");var o={R:Math.random(),url:n,Minimum:"Minimum"in t?t.Minimum:"True",blnForceRefresh:"blnForceRefresh"in t?t.blnForceRefresh:"false"};e.each(["physicalid","OXID","PLM_ExternalID","QueryList"],function(e,i){t[i]&&(o[i]=t[i])}),a.callAuthenticatedRequest(n,"json","GET",o).then(function(e){var r=a.commonAjaxJsonResponseOK(e,s);if(!r)return r;if(e&&e.Data){var n={PLMData:e.Data};t.blnForceRefresh&&a.publishEvent("Resource.refresh.done",Object.assign({},n)),i(n)}else e&&(e.error&&e.error.msg&&e.error.msg.text?s(e.error.msg.text):s())},s)}):(e.log("getInstance: QueryList Must be an array with at least one item in it"),void s()):(e.log("getInstance: Either QueryList, PLM_ExternalID, physicalid or OXID must be specified inside params"),void s()):(e.log("getInstance: params must be specified"),void s())})},getResourceDisciplines:function(t){var a=this;return new i(function(i,s){if(t||(t={}),a._data&&a._data.childrenArrayInterfaces&&(!("blnCachedOk"in t)||t.blnCachedOk)){var r={},o=!1;if(t.V_discipline?Array.isArray(t.V_discipline)?(o=!0,e.each(t.V_discipline,function(e,t){return a._data.childrenArrayInterfaces[t]?r[t]=a._data.childrenArrayInterfaces[t].slice(0):o=!1,o})):a._data.childrenArrayInterfaces[t.V_discipline]&&(r[t.V_discipline]=a._data.childrenArrayInterfaces[t.V_discipline].slice(0),o=!0):a._data.childrenArrayInterfaces.Resource&&(r.Resource=a._data.childrenArrayInterfaces.Resource.slice(0),o=!0),t.blnIncludeParent){var l=t.V_discipline||"Resource";a._data.interfaceDetails&&a._data.interfaceDetails[l]?(r[l]||(r[l]=[]),r[l].push(Object.assign({},a._data.interfaceDetails[l]))):o=!1}if(o)return t.addAdditionalDisciplines&&a._data.childrenArrayInterfaces.AdditionalDisciplines&&(r.AdditionalDisciplines=Object.assign({},a._data.childrenArrayInterfaces.AdditionalDisciplines)),void i(r)}var c={R:Math.random(),class_name:t.class_name?t.class_name:"PRODUCTCFG/VPMReference",Extensions:t.Extensions?t.Extensions:"DELRmiResourceModel/Resource"};t.blnIncludeParent&&(c.blnIncludeParent="True"),"DELRmiResourceModel/Area"!==c.Extensions&&"Area"!==t.V_discipline&&"Area"!==t.disciplineName||(c.Extensions="DELRmiResourceModel/ResourceArea");var u=t.V_discipline||t.disciplineName;Array.isArray(u)&&(u=JSON.stringify(u)),u&&(c.V_discipline=u),a.getServiceUrl({serviceName:"3DSpace"}).then(function(r){var o=r+"/resources/DELWebInfrastructure/v0/interface/getImmediateDerivative?getDisciplines";a.callAuthenticatedRequest(o,"json","GET",c).then(function(r){var o=a.commonAjaxJsonResponseOK(r,s);if(!o)return o;if(r&&r.Data){e.each(r.Data,function(i,s){if("name"===i||!Array.isArray(s))return delete r.Data[i],!0;e.each(s,function(e,t){t&&t.nlsName&&(t.name&&(n["V_discipline."+t.name]=t.nlsName),t.disciplineName&&(n["V_discipline."+t.disciplineName]=t.nlsName))});var o=s.slice(0);if(a._data||(a._data={}),a._data.childrenArrayInterfaces||(a._data.childrenArrayInterfaces={}),t.blnIncludeParent){var l=-1;e.each(o,function(e,t){return t.name===i&&(l=e),l<0}),l>=0&&o.splice(l,1)}return a._data.childrenArrayInterfaces[i]=o,a._data.interfaceDetails||(a._data.interfaceDetails={}),e.each(s,function(e,t){if(!a._data.interfaceDetails[t.name]){if(!t.IconPath&&t.LargeIconPath)t.IconPath=t.LargeIconPath;else if(t.IconPath&&!t.LargeIconPath){var i=t.IconPath.substring(t.IconPath.lastIndexOf("/")+1,t.IconPath.lastIndexOf("."));["I_DELRMAreaSystem","I_DELRMControlDeviceSystem","I_DELRMConveyorSystem","I_DELRMIndustrialMachineSystem","I_DELRMInspectSystem","I_DELRMLogicControllerSystem","I_DELRMManufacturingSetupSystem","I_DELRMNCMachineSystem","I_DELRMOrganizationalSystem","I_DELRMRobotSystem","I_DELRMSensorSystem","I_DELRMStorageSystem","I_DELRMToolDeviceSystem","I_DELRMTransportSystem","I_DELRMUserDefinedSystem","I_DELRMWorkerSystem","I_PPRProductionPlan","I_VPMNavProduct"].indexOf(i)<0?t.LargeIconPath=t.IconPath:t.LargeIconPath=t.IconPath.substr(0,t.IconPath.lastIndexOf("/small/"+i))+"/large/"+i+"108x144.png"}a._data.interfaceDetails[t.name]=Object.assign({},t)}}),!0});var l=Object.assign({},r.Data);return t.addAdditionalDisciplines&&a._data.childrenArrayInterfaces.AdditionalDisciplines&&(l.AdditionalDisciplines=a._data.childrenArrayInterfaces.AdditionalDisciplines),i(l),!0}},s)},s)})},commonAjaxJsonResponseOK:function(t,i){var a=t;a.Root&&(a=a.Root);var s=null;if(!a.auth)return(s=a.msg&&a.msg.text?a.msg.text:"")?i&&($(".ds_alert").size()>0||i!==window.alert)&&i("Invalid auth: "+s):i&&($(".ds_alert").size()>0||i!==window.alert)&&i("Invalid auth"),e.log("Invalid auth: "+s),a.msg&&a.msg.details&&e.log("-- Details: "+a.msg.details),this.publishEvent("Auth.LoginRequired"),!1;if(!a.license)return(s=a.msg&&a.msg.text?a.msg.text:"")?i&&i(s,{type:"license"}):i&&(n&&n.get?i(n.get("Valid License Required"),{type:"license"}):i("Valid License Required",{type:"license"})),e.log("License Check error: "+s),a.msg&&a.msg.details&&e.log("-- Details: "+a.msg.details),this.publishEvent("Auth.LicenseRequired"),!1;if(a.msg&&"success"!==a.msg.type){s=a.msg&&a.msg.text?a.msg.text:"";var r=a.msg&&a.msg.type?a.msg.type:"";"warning"===r&&(r="notice");var o=a.errorDetails||null;return!o&&a.msg.details&&(o={details:a.msg.details}),s?i&&i(s,o,a):i&&i("DELWebAjaxModel::commonAjaxJsonResponseOK :"+r,a.errorDetails),e.log("Error: "+s),a.msg&&a.msg.details&&e.log("-- Details: "+a.msg.details),!1}return!0},FindPLMObjectInCache:function(t,i){var a=Object.assign({},t),s=null;return e.each(o,function(t){if("platform_services"===t||"point_cloud_assoc"===t)return!0;var r=o[t];if(!r||!e.Object.isPlainObject(r)||e.Object.isEmptyObject(r))return!0;if(!s&&a.physicalid&&(s=r[a.physicalid]),!s&&a.OXID&&(s=r[a.OXID]),s){if(!(i&&i instanceof Array))return!i||"string"==typeof i&&"false"===i.toLowerCase()?!0===s.AllAttributesRetrieved?s:null:s;if(function(t,i){var a=!0;return e.each(i,function(e,i){return a&&(a=t.hasOwnProperty(i)),a}),a}(s,i))return s}return!s&&void 0}),s},removeNullAttributes:function(t){return t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)&&e.each(t,function(e,i){null==i||"NULL"===i?delete t[e]:!i&&["V_description","V_Description","V_discipline"].indexOf(e)>=0&&delete t[e]}),t},getPhysicalIDForOXID:function(e){var t="";return!t&&e&&0===e.indexOf("[")&&(t=e.substring(1,e.indexOf(","))),t},useFixtures:function(){return window.$&&window.Configuration&&window.Configuration.useFixtures&&window.can&&window.can.fixture}});return c}),define("DS/DELWebInfrastructureControls/DELWebSpecificationsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/ENOXSpecificationsUX/SpecificationsPane"],function(e,t,i,a,s,r){"use strict";return t.extend(i,a,{init(e){this._parent(e),this._buildView(e)},_buildView:function(t){var i=this;this.elements.container=e.createElement("div",{class:"SpecificationDocuments"}),s.getPlatformServices().then(function(t){!t.platformId&&window.widget.data&&(t.platformId=window.widget.data.x3dPlatformId);const a={parentObject:{parentId:i.getSelectedRefId()},connectorOptions:{fetchSecurityContext:()=>i.options.collabSpace||window.widget.getValue("pad_security_ctx")||window.widget.getValue("collabSpace"),platformUrls:t,getWorkUnderHeaders:function(){var t={};return i.options.authoringCtx&&(t=e.is(authoringCtx)&&e.is(authoringCtx.AuthoringContextHeader)?authoringCtx.AuthoringContextHeader:{}),t}},webinwin:!1},s=r.extend({onRemoved:function(){}});i.SpecificationsPane=new s(a),i.SpecificationsPane.modelEvents.subscribe({event:"upload-attachment-complete"},i.addDocument.bind(i)),i.SpecificationsPane.modelEvents.subscribe({event:"attach-attachment-complete"},i.addDocument.bind(i)),i.SpecificationsPane.modelEvents.subscribe({event:"detach-attachment-complete"},i.deleteDocument.bind(i)),i.SpecificationsPane.inject(i.elements.container)})},getSelectedRefId(){var t=this.getModel();if(t){if("relationship"!==t.get("metatype"))return t.get("objectId");e.log("getSelectedRefId FIX ME")}return t.get("objectId")},updateFacet(){const e=this.getSelectedRefId();if(!e)return void this.notApplicable();const t={parentId:e};this.SpecificationsPane&&(this.SpecificationsPane.show(),this.SpecificationsPane.options.parentObject.parentId!==e&&this.SpecificationsPane.setParentObject(t))},destroyComponent(){this.SpecificationsPane.destroy()},onResize(){this.updateFacet()},onRefresh(){this.updateFacet()},addDocument(e){const t=this;let i={};e.documents&&e.documents.length>0?i=e.documents[0]:e.document&&(i=e.document),t.options.appContext&&t.options.appContext.addDocument?t.options.appContext.addDocument(e.parentObject.parentId,i):t.options.addDocument&&t.options.addDocument(e.parentObject.parentId,i)},deleteDocument(e){const t=this;t.options.appContext&&t.options.appContext.deleteDocument?t.options.appContext.deleteDocument(e.parentObject.parentId,e.id):t.options.deleteDocument&&t.options.deleteDocument(e.parentObject.parentId,e.id)}})}),define("DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","DS/DELWebInfrastructureControls/DELWebAjaxModel","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],function(e,t,i,a){"use strict";var s=null,r=null,n=null,o=null,l=!1,c=t.singleton({init:function(){var e=window.widget.getPreference("navigateOnIndex");if(e||(e={name:"navigateOnIndex",label:"Navigate on",type:"list",options:[{value:"Index",label:"Index"},{value:"Database",label:"Database"}],value:"Index"},window.widget.addPreference(e)),"Index"===(s=e.value||"Index")){var t=window.widget.getPreference("navigateOnDatabaseStart");if(t&&t.value&&!isNaN(t.value))r=t.value;else if(window.widget.standalone&&window.Foe&&window.Foe.Model&&window.Foe.Model.Session){var i=window.Foe.Model.Session.get("navigateOnDatabaseStart");i&&(t={name:"navigateOnDatabaseStart",label:"Navigate on Database Start",type:"hidden",value:r=parseInt(i)},window.widget.addPreference(t),window.widget.setValue("navigateOnDatabaseStart",r))}}},setDatabase:function(){if(s="Database","Database"!==window.widget.getValue("navigateOnIndex")){r=(new Date).getTime();var e=window.widget.getPreference("navigateOnDatabaseStart");e||(e={name:"navigateOnDatabaseStart",label:"Navigate on Database Start",type:"hidden",value:r},window.widget.addPreference(e)),window.widget.setValue("navigateOnDatabaseStart",r),window.widget.standalone&&window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&window.Foe.Model.Session.set("navigateOnDatabaseStart",r,!0),this._updateIndexedTimestamp()}},setIndex:function(){s="Index"},isDatabase:function(){s||this.init();var e="Database"===s;if(!e&&r&&(e=(new Date).getTime()-r<=6e5)&&(s="Database"),e&&"Database"!==window.widget.getValue("navigateOnIndex"))if(r?o&&!isNaN(o)&&o>r?e=!1:(new Date).getTime()-r>6e5&&(e=!1):r=(new Date).getTime(),e)if(o){var t=o+1e3;n&&(t+=o-n),(new Date).getTime()>t&&this._updateIndexedTimestamp()}else o||this._updateIndexedTimestamp();else this.setIndex(),r=null,window.widget.deleteValue("navigateOnDatabaseStart"),window.widget.standalone&&window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&window.Foe.Model.Session.set("navigateOnDatabaseStart",null,!0);return e&&window.widget.getUrl().contains("TSK7174741=FORCE")?e=!1:!e&&window.widget.getUrl().contains("TSK7174741=0")&&(e=!0),e},isIndex:function(){return!this.isDatabase()},_updateIndexedTimestamp:function(){l||(l=!0,i.getServiceUrl({serviceName:"3DSpace"}).then(function(t){if(t&&"string"==typeof t){var s={select_service:["FTS","EXPAND"]};s=e.Json.encode(s);var r=window.widget.getValue("collabSpace");if(!r){var c=window.widget.getPreference("pad_security_ctx");r=c&&c.value?c.value:"preferred"}r&&0===r.indexOf("ctx::")&&(r=r.substring("ctx::".length));var u=t+"/cvservlet/indexingdate?SecurityContext="+encodeURIComponent(r);i.callAuthenticatedRequest(u,"json","POST",s).then(function(t){var i=6e5+(new Date).getTime();t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)&&(e.each(t,function(e,t){t&&t.allvaultsacl&&!isNaN(t.allvaultsacl)&&1e3*t.allvaultsacl<i&&(i=1e3*t.allvaultsacl)}),o&&o!==i&&(n=o),o=i),l=!1},function(t){var i=a.get("Error");t&&t.message?(i=t.message,t.stack&&(e.log(t.message),e.log(t.stack))):"string"==typeof t&&(i=t),e.log(i),l=!1})}else e.log("invalid 3DSearch URL")}))}});return i.useFixtures()&&(window.Configuration.fixtureDelay&&(window.can.fixture.delay=window.Configuration.fixtureDelay),can.fixture({type:"POST",url:Fam.Model.Platform.webroot+"/cvservlet/indexingdate"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/CVServlet_indexingdate.json",function(a){if(window.widget.getUrl().contains("TSK7174741=FORCE")||!window.widget.getUrl().contains("TSK7174741=0")&&window.widget.getUrl().contains("ODTRunning=1"))e.each(a,function(e,t){t&&t.allvaultsacl&&(t.allvaultsacl=parseInt((new Date).getTime()/1e3)-1)});else{var s=window.widget.getPreference("navigateOnIndex");if(s&&"Index"===s.value){var r=window.widget.getPreference("navigateOnDatabaseStart");r&&r.value&&!isNaN(r.value)&&parseInt(r.value/1e3)+5<=(new Date).getTime()&&(a={fixture:{allvaultsacl:parseInt(r.value/1e3)+5}})}}i.responseText=JSON.stringify(a),t.complete(i,i.statusText)})})),c}),window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","UWA/Promise","DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt","DS/DELWebInfrastructureControls/DELWebAjaxModel","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],function(e,t,i,a,s,r){"use strict";var n={},o=window.Configuration&&window.Configuration.webroot?window.Configuration.webroot:null,l=t.singleton({init:function(){n=s.getCacheObject()},setCacheObject:function(t){if(t&&e.Object.isPlainObject(t)){var i=s.getCacheObject();e.Object.isEmptyObject(n)||n===i||(t=Object.assign(t,n)),e.Object.isEmptyObject(i)||(t=Object.assign(t,i)),s.setCacheObject(t),n=s.getCacheObject()}},getCacheObject:function(e){return n},get3DSearchString:function(){return"flattenedtaxonomies:types/DELResourceParameterListReference"},getResourceParameterLists:function(t){var a=this;return new i(function(i,r){if(t&&(t.physicalid||t.QueryList||t.allCached)){var o={};if(t.allCached)return n.parameter_list&&(o=Object.assign(o,n.parameter_list)),void i(o);if(t.QueryList){var l=!0;if(n.parameter_list_assoc&&!t.blnForceRefresh?e.each(t.QueryList,function(e,t){return(l=t&&t.physicalid&&n.parameter_list_assoc[t.physicalid])&&(o[t.physicalid]=n.parameter_list_assoc[t.physicalid]),!!l}):l=!1,l)return void i(o)}else{if(n.parameter_list_assoc&&t.blnIncludeDescendants&&n.parameter_list_assoc[t.V_discipline||"All"]&&n.parameter_list_assoc[t.V_discipline||"All"][t.physicalid]&&!t.blnForceRefresh)return void i(e.clone(n.parameter_list_assoc[t.V_discipline||"All"][t.physicalid]));if(n.parameter_list_assoc&&n.parameter_list_assoc[t.physicalid]&&!t.blnForceRefresh&&!t.blnIncludeDescendants)return void i(e.clone(n.parameter_list_assoc[t.physicalid]))}s.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var l={};if(t.physicalid)l.target_physicalid=t.physicalid;else if(t.QueryList){var c=[];e.each(t.QueryList,function(e,t){t&&(t.physicalid?c.push({physicalid:t.physicalid}):c.push(t))}),l.target_QueryList=JSON.stringify(c)}t.blnIncludeDescendants&&(l.getAllDescendants=!0,t.V_discipline&&(l.disciplineFilter=t.V_discipline));var u=o+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation";s.callAuthenticatedRequest(u,"json","GET",l).then(function(o){if(o){var c=s.commonAjaxJsonResponseOK(o,r);if(!c)return c;n.parameter_list_assoc||(n.parameter_list_assoc={});var u=o.Data||{};s.useFixtures()&&n.parameter_list_assoc[t.physicalid]&&!t.blnForceRefresh?u=n.parameter_list_assoc[t.physicalid]:t.blnForceRefresh&&n.parameter_list_assoc[t.physicalid]&&delete n.parameter_list_assoc[t.physicalid],e.each(u,function(e,i){var s=i.resource;if(s||(s=i.resource={physicalid:t.physicalid}),a._cacheResource(s),i.resourceParameterList){var r=e;i&&i.properties&&i.properties.physicalid?r=i.properties.physicalid:i&&i.resourceParameterList&&i.resourceParameterList.physicalid&&(r=i.resourceParameterList.physicalid),t.blnIncludeDescendants?t.blnIncludeDescendants&&(n.parameter_list_assoc[t.V_discipline||"All"]||(n.parameter_list_assoc[t.V_discipline||"All"]={}),n.parameter_list_assoc[t.V_discipline||"All"][t.physicalid]||(n.parameter_list_assoc[t.V_discipline||"All"][t.physicalid]={}),n.parameter_list_assoc[t.V_discipline||"All"][t.physicalid][r]=i):(n.parameter_list_assoc[s.physicalid]||(n.parameter_list_assoc[s.physicalid]={}),n.parameter_list_assoc[s.physicalid][r]=i),a._cacheResourceParameterList(i.resourceParameterList,"False"===l.Minimum)}}),t.blnIncludeDescendants?(n.parameter_list_assoc||(n.parameter_list_assoc={}),n.parameter_list_assoc[t.V_discipline||"All"]||(n.parameter_list_assoc[t.V_discipline||"All"]={}),t.physicalid&&!n.parameter_list_assoc[t.V_discipline||"All"][t.physicalid]&&(n.parameter_list_assoc[t.V_discipline||"All"][t.physicalid]={})):t.physicalid&&!n.parameter_list_assoc[t.physicalid]&&(n.parameter_list_assoc[t.physicalid]={}),t.blnIncludeDescendants&&t.physicalid?i(e.clone(n.parameter_list_assoc[t.V_discipline||"All"][t.physicalid])):t.physicalid?i(e.clone(n.parameter_list_assoc[t.physicalid])):i(e.clone(u))}else r("invalid server response")},r)}else r("invalid 3DSpace URL")},r)}else r("invalid parameters")})},getResourceParametersForList:function(t){var a=this;return new i(function(i,r){if(t&&(t.physicalid||t.QueryList||t.allCached)){var o={};if(t.allCached)return n.parameter&&(o=Object.assign(o,n.parameter)),void i(o);if(t.QueryList){var l=!0;if(n.parameter_list&&!t.blnForceRefresh?e.each(t.QueryList,function(t,i){return(l=i&&i.physicalid&&n.parameter_list[i.physicalid]&&n.parameter_list[i.physicalid].associatedResourceParameters)&&e.each(n.parameter_list[i.physicalid].associatedResourceParameters,function(t,a){return a&&"string"==typeof a?n.parameter&&n.parameter[a]?(o[i.physicalid]||(o[i.physicalid]={}),o[i.physicalid][a]=n.parameter[a]):l=!1:(e.log("invalid physicalidParamId!"),l=!1),!!l}),!!l}):l=!1,l)return void i(e.clone(o))}else if(n.parameter_list&&n.parameter_list[t.physicalid]&&n.parameter_list[t.physicalid].associatedResourceParameters&&!t.blnForceRefresh)return void i(e.clone(n.parameter_list[t.physicalid].associatedResourceParameters));s.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var l={};if(t.physicalid)l.resourceParameterListphysicalid=t.physicalid;else if(t.QueryList){var c=[];e.each(t.QueryList,function(e,t){t&&(t.physicalid?c.push({physicalid:t.physicalid}):c.push(t))}),l.resourceParameterListQueryList=JSON.stringify(c)}var u=o+"/resources/DELWebInfrastructureLite/v0/resource/parameter";s.callAuthenticatedRequest(u,"json","GET",l).then(function(o){if(o){var c=s.commonAjaxJsonResponseOK(o,r);if(!c)return c;n.parameter_list||(n.parameter_list={}),n.parameter||(n.parameter={});var u=o.Data||{};e.each(u,function(i,r){t.QueryList?s.useFixtures()&&n.parameter_list[i]&&n.parameter_list[i].associatedResourceParameters&&!t.blnForceRefresh?u=n.parameter_list[i].associatedResourceParameters:t.blnForceRefresh&&n.parameter_list[i]&&n.parameter_list[i].associatedResourceParameters&&delete n.parameter_list[i].associatedResourceParameters:s.useFixtures()&&n.parameter_list[t.physicalid]&&n.parameter_list[t.physicalid].associatedResourceParameters&&!t.blnForceRefresh?u=n.parameter_list[t.physicalid].associatedResourceParameters:t.blnForceRefresh&&n.parameter_list[t.physicalid]&&n.parameter_list[t.physicalid].associatedResourceParameters&&delete n.parameter_list[t.physicalid].associatedResourceParameters;var o={physicalid:i};a._cacheResourceParameterList(o),(o=n.parameter_list[o.physicalid]).associatedResourceParameters||(o.associatedResourceParameters=[]),e.each(r,function(e,t){var i=e;t&&t.physicalid&&(i=t.physicalid),o.associatedResourceParameters.push(i),t&&t.physicalid&&a._cacheResourceParameter(t,"False"===l.Minimum)}),t.physicalid&&!n.parameter_list[t.physicalid]?n.parameter_list[t.physicalid]={associatedResourceParameters:[]}:t.QueryList&&!n.parameter_list[i]&&(n.parameter_list[i]={associatedResourceParameters:[]})}),i(e.clone(u))}else r("invalid server response")},r)}else r("invalid 3DSpace URL")},r)}else r("invalid parameters")})},getOneResourceParameterList:function(t){var a=this;return new i(function(i,r){if(t&&e.Object.isPlainObject(t))if(t.physicalid){"Minimum"in t&&!0!==t.Minimum?t.Minimum&&Array.isArray(t.Minimum)||(t.Minimum="False"):t.Minimum="True";var n=t.Minimum,o=["V_Name","physicalid"];t.Minimum&&!Array.isArray(t.Minimum)&&(t.Minimum.match(/true/i)||t.Minimum.match(/yes/i)||t.Minimum.match(/on/i))&&(t.Minimum=o);var l=a._FindPLMObjectInCache(t,t.Minimum);!l&&t.Minimum&&Array.isArray(t.Minimum)&&s.useFixtures()&&(l=a._FindPLMObjectInCache(t,"True"))&&e.each(t.Minimum,function(e,t){t in l||(l[t]=null)}),l&&!l.ReferenceOXID&&!l.ReferencePhysicalid&&n&&n.match&&(n.match(/true/i)||n.match(/yes/i)||n.match(/on/i))&&(t.Minimum=o,l=a._FindPLMObjectInCache(t,t.Minimum)),l?i(Object.assign({},l)):(t.class_name||(t.class_name="DELRmiParameterModel/DELResourceParameterListReference"),!t.fixtureTag&&s.useFixtures()&&(t.fixtureTag="getOneResourceParameterList"),s.getReference(t).then(function(t){t&&(Array.isArray(t)?e.each(t,function(e,t){t&&a._cacheResourceParameterList(Object.assign({},t))}):a._cacheResourceParameterList(Object.assign({},t))),i(t)},r))}else r("no id provided!");else r("invalid parameters")})},createResourceParameterList:function(t){var r=this;return new i(function(i,o){t&&e.Object.isPlainObject(t)?t.name||t.V_Name?s.getServiceUrl({serviceName:"3DSpace"}).then(function(l){if(l&&"string"==typeof l){var c={V_Name:t.V_Name||t.name};(t.V_description||t.description)&&(c.V_description=(t.V_description||t.description).trim()),t.target_resource&&e.Object.isPlainObject(t.target_resource)&&(t.target_resource.physicalid&&(c.target_physicalid=t.target_resource.physicalid),t.target_resource.OXID&&(c.target_OXID=t.target_resource.OXID),t.target_resource.QueryList&&(c.target_resource=t.target_resource)),t.target_physicalid&&(c.target_physicalid=t.target_physicalid),t.target_OXID&&(c.target_OXID=t.target_OXID);var u=l+"/resources/DELWebInfrastructureLite/v0/resource/parameterList";s.callAuthenticatedRequest(u,"json","POST",c).then(function(t){if(t){var l=s.commonAjaxJsonResponseOK(t,o);if(!l)return l;a.setDatabase();var u=t.Data||{},d=[],m=[];e.each(u,function(t,i){"SuccessfullyAssociated"!==t?(i.associatedResources||(i.associatedResources=[]),r._cacheResourceParameterList(i),d.push(i),m.push({event:"ResourceParameterList.created",data:Object.assign({},i)})):i&&(e.Object.isPlainObject(i)||Array.isArray(i))&&e.each(i,function(t,i){var a=i.resource?i.resource.physicalid||i.resource.OXID:c.target_physicalid||c.target_OXID,s=i.resourceParameterList?i.resourceParameterList.physicalid||i.resourceParameterList.OXID:null;i&&a&&s?(n.parameter_list_assoc&&n.parameter_list_assoc[a]&&r._cacheResourceToResourceParameterListAssoc(a,s,i),m.push({event:"ResourceParameterList.associated",data:Object.assign({},i)})):e.log("DELWebResourceParameterModel::createResourceParameterList - invalid connection!  idxConnection = "+t+", ResourceID = "+a+", ParamListID = "+s+", objConnection = "+i)})}),e.each(m,function(e,t){s.publishEvent(t.event,t.data)}),i(d.slice(0))}else o("invalid server response")},o)}else o("invalid 3DSpace URL")},o):o("No name provided!"):o("invalid parameters")})},updateResourceParameterList:function(t){var a=this;return new i(function(i,n){if(t&&e.Object.isPlainObject(t)&&t.physicalid){var o={physicalid:t.physicalid,attributes:[]};(t.V_Name||t.name)&&o.attributes.push({V_Name:(t.V_Name||t.name).trim()}),(t.V_description||t.description)&&o.attributes.push({V_description:(t.V_description||t.description).trim()}),o.attributes.length?(o.attributes=JSON.stringify(o.attributes),s.getServiceUrl({serviceName:"3DSpace"}).then(function(r){if(r&&"string"==typeof r){var l=r+"/resources/DELWebInfrastructureLite/v0/resource";s.useFixtures()&&(l+="?updateResourceParameterList"),s.callAuthenticatedRequest(l,"json","PATCH",o).then(function(r){var o=s.commonAjaxJsonResponseOK(r,n);if(!o)return o;var l=r.Data||r.data,c=(l?l.ChangedAttributes:null)||{};a._cacheResourceParameterList(Object.assign({physicalid:t.physicalid},c));var u=Object.assign({ChangedAttributes:e.clone(c)},t);s.publishEvent("ResourceParameterList.updated",u),i(e.clone(u))},n)}else n("invalid 3DSpace URL")},n)):n(r.get("No changes have been made."))}else n("invalid parameters")})},associateResourceParameterList:function(t){var o=this;return new i(function(i,l){t&&e.Object.isPlainObject(t)?t.resource&&e.Object.isPlainObject(t.resource)&&(t.resource.physicalid||t.resource.QueryList)?t.resourceParameterList&&e.Object.isPlainObject(t.resourceParameterList)&&(t.resourceParameterList.physicalid||t.resourceParameterList.QueryList)?s.getServiceUrl({serviceName:"3DSpace"}).then(function(c){if(c&&"string"==typeof c){var u={};t.resource&&t.resource.physicalid&&(u.target_physicalid=t.resource.physicalid),t.resourceParameterList&&t.resourceParameterList.physicalid?u.resourceParameterListphysicalid=t.resourceParameterList.physicalid:t.resourceParameterList&&t.resourceParameterList.QueryList&&(u.resourceParameterListQueryList=[],e.each(t.resourceParameterList.QueryList,function(e,t){t&&(t.physicalid?u.resourceParameterListQueryList.push({physicalid:t.physicalid}):u.resourceParameterListQueryList.push(t))}));var d=new window.FormData;s.useFixtures()?d=u:e.each(u,function(t,i){t&&i?"string"!=typeof i&&isNaN(i)?d.append(t,JSON.stringify(i)):d.append(t,i):e.log("DELWebResourceParameterModel::associateResourceParameterList - invalid key = "+t+", val = "+i)});var m=c+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation";s.callAuthenticatedRequest(m,"json","POST",d).then(function(c){if(c){var u=s.commonAjaxJsonResponseOK(c,l);if(!u)return u;a.setDatabase(),n.parameter_list_assoc||(n.parameter_list_assoc={});c.Data;var d=[],m=!0,p=[];(c.Data.SuccessfullyAssociated||c.Data.AlreadyAssociated)&&e.each({SuccessfullyAssociated:"ResourceParameterList.associated",AlreadyAssociated:"ResourceParameterList.associated.duplicate"},function(i,a){c.Data[i]&&e.each(c.Data[i],function(i,s){var r=s.resource;!r&&t.resource&&(r=s.resource=t.resource),r&&o._cacheResource(r),s.resourceParameterList&&o._cacheResourceParameterList(s.resourceParameterList),r&&r.physicalid&&s.resourceParameterList&&s.resourceParameterList.physicalid?(o._cacheResourceToResourceParameterListAssoc(r.physicalid,s.resourceParameterList.physicalid,s),p.push(s),d.push({event:a,data:s})):e.log("invalid ID in response!")})}),c.Data.FailedAssociated&&(m=!1,e.each(c.Data.FailedAssociated,function(e,t){d.push({event:"ResourceParameterList.associated.error",data:t})})),e.each(d,function(e,t){s.publishEvent(t.event,t.data)}),m&&p&&p.length?i(e.clone(p)):l(r.get("Error"))}else l("invalid server response")},l)}else l("invalid 3DSpace URL")},l):l("invalid resource parameter list"):l("invalid resource"):l("invalid parameters")})},unassociateResourceParameterList:function(t){var n=this;return new i(function(i,o){if(t&&e.Object.isPlainObject(t)){if(!(t.resourceParameterListAssociation||t.resourceParameterListAssociationphysicalid||t.resourceParameterListAssociationOXID||t.resourceParameterListAssociationQueryList)){if(!(t.resource||t.target_physicalid||t.target_OXID||t.target_QueryList))return void o("No resource provided!");if(!(t.resourceParameterList||t.resourceParameterListphysicalid||t.resourceParameterListOXID||t.resourceParameterListQueryList))return void o("No resource parameter list provided!")}s.getServiceUrl({serviceName:"3DSpace"}).then(function(l){if(l&&"string"==typeof l){var c={};if(e.each(["resourceParameterListAssociation","resourceParameterListAssociationphysicalid","resourceParameterListAssociationOXID","resourceParameterListAssociationQueryList"],function(e,i){t[i]&&(c[i]=t[i])}),e.Object.isEmptyObject(c)){if(e.each(["resource","target_resource","target_physicalid","target_OXID","target_QueryList","resourceParameterList","resourceParameterListphysicalid","resourceParameterListOXID","resourceParameterListQueryList"],function(e,i){t[i]&&(c[i]=t[i])}),e.Object.isEmptyObject(c))return void o("invalid parameters");c.resource&&!c.target_resource&&(c.target_resource=c.resource),delete c.resource}var u=new window.FormData;s.useFixtures()?u=c:e.each(c,function(t,i){"string"!=typeof i&&isNaN(i)?u.append(t,e.Json.encode(i)):u.append(t,i)});var d=l+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation";s.callAuthenticatedRequest(d,"json","DELETE",u).then(function(l){if(l){var c=s.commonAjaxJsonResponseOK(l,o);if(!c)return c;a.setDatabase();var u=l.Data||{},m=[],p=!0;e.each(u,function(i,a){if("SuccessfullyUnassociated"===i||"AlreadyUnassociated"===i)e.each(a,function(i,a){if(a&&e.Object.isPlainObject(a)&&!e.Object.isEmptyObject(a)){if(p=!0,!a.properties)if(t.resourceParameterListAssociation){var s=e.clone(a);a.properties=Object.assign(s,t.resourceParameterListAssociation)}else t.resourceParameterListAssociationOXID||t.resourceParameterListAssociationphysicalid?a.properties=Object.assign({OXID:t.resourceParameterListAssociationOXID,physicalid:t.resourceParameterListAssociationphysicalid},a):a.physicalid&&(a.properties={physicalid:a.physicalid});a.resourceParameterList||(t.resourceParameterList?a.resourceParameterList=t.resourceParameterList:(t.resourceParameterListphysicalid||t.resourceParameterListOXID)&&(a.resourceParameterList={physicalid:t.resourceParameterListphysicalid,OXID:t.resourceParameterListOXID})),a.resource||(t.resource?a.resource=t.resource:(t.target_physicalid||t.target_OXID)&&(a.resource={OXID:t.target_OXID,physicalid:t.target_physicalid})),n._cacheResourceToResourceParameterListUnassoc(a),m.push({event:"ResourceParameterList.unassociated",data:a})}else e.log("DELWebResourceParameterModel::unassociateResourceParameterList - invalid response from "+d)});else if("FailedUnassociated"===i){var s=e.clone(u);s=Object.assign(s,t),e.each(a,function(t,a){0===t.indexOf("[")?s.resourceParameterListOXID=t:s.resourceParameterListphysicalid=t,e.each(a,function(e,t){0===t.indexOf("[")?s.target_OXID=t:s.target_physicalid=t,m.push({event:"ResourceParameterList.unassociated.error",data:s}),p=!1,o(i,s)})})}else e.log("unknown response key: "+i)}),e.each(m,function(e,t){s.publishEvent(t.event,t.data)}),p&&(u&&!e.Object.isEmptyObject(u)?i(e.clone(u)):o(r.get("Error")))}else o("invalid server response")},o)}else o("invalid 3DSpace URL")},o)}else o("invalid parameters")})},_cacheResourceParameter:function(e,t){n.parameter||(n.parameter={});var i=n.parameter;if(e.OXID||e.physicalid){if(e.plmBaseObjectType||(e.plmBaseObjectType="DELResourceParameter"),i[e.physicalid||e.OXID]){var a=Object.assign(i[e.physicalid||e.OXID],e);i[e.physicalid||e.OXID]=a,Object.assign(e,a)}else i[e.physicalid||e.OXID]=e;e.OXID&&e.physicalid&&(i[e.OXID]=i[e.physicalid])}},createResourceParameter:function(t){var r=this;return new i(function(i,o){t&&e.Object.isPlainObject(t)?t.name||t.V_Name?s.getServiceUrl({serviceName:"3DSpace"}).then(function(l){if(l&&"string"==typeof l){var c={V_Name:t.V_Name||t.name};if((t.V_description||t.description)&&(c.V_description=(t.V_description||t.description).trim()),c.inputOutput=t.inputOutput,t.inputOutput||t.V_Direction||("DELResourcePrmOUTPUT"===t.plmObjectType||"DELResourcePrmOUTPUT"===t.plmObjectTypeInternal?c.inputOutput="Output":"DELResourcePrmINPUT"!==t.plmObjectType&&"DELResourcePrmINPUT"!==t.plmObjectTypeInternal||(c.inputOutput="Input")),t.resourceParameterExtension||t.parameter_type){(t.resourceParameterExtension||t.parameter_type)&&(c.resourceParameterExtension=(t.resourceParameterExtension||t.parameter_type).trim()),("minValue"in t||"V_MinValue"in t)&&(c.minValue=(t.minValue||t.V_MinValue||"0").toString().trim()),("maxValue"in t||"V_MaxValue"in t)&&(c.maxValue=(t.maxValue||t.V_MaxValue||"0").toString().trim()),t.minLimit&&(c.minLimit=t.minLimit.trim()),t.maxLimit&&(c.maxLimit=t.maxLimit.trim()),(t.units||t.V_Units)&&(c.units=(t.units||t.V_Units).trim()),t.target_param_list&&e.Object.isPlainObject(t.target_param_list)&&(t.target_param_list.physicalid&&(c.resourceParameterListphysicalid=t.target_param_list.physicalid),t.target_param_list.OXID&&(c.resourceParameterListOXID=t.target_param_list.OXID),t.target_param_list.QueryList&&(c.resourceParameterListQueryList=t.target_param_list.QueryList)),t.target_physicalid&&(c.resourceParameterListphysicalid=t.target_physicalid),t.target_OXID&&(c.resourceParameterListOXID=t.target_OXID),t.V_Values&&(c.V_Values=JSON.stringify(t.V_Values));var u=l+"/resources/DELWebInfrastructureLite/v0/resource/parameter?createResourceParameter";s.callAuthenticatedRequest(u,"json","POST",c).then(function(l){if(l){var c=s.commonAjaxJsonResponseOK(l,o);if(!c)return c;a.setDatabase();var u=l.Data||{},d=t.target_param_list;d||(d={physicalid:t.target_physicalid,OXID:t.target_OXID});var m=[];e.each(u,function(t,i){r._cacheResourceParameter(i,!0);var a=d.physicalid||d.OXID,s=i.physicalid||i.OXID||t;if(s&&a){var o={resourceParameterList:d,properties:i};(n.parameter_list||n.parameter_list[a])&&r._cacheResourceParameterToResourceParameterListAssoc(a,o),m.push({event:"ResourceParameter.associated",data:e.clone(o)})}else e.log("DELWebResourceParameterModel::createResourceParameter - invalid connection!  idxConnection = "+idxConnection+", ResourceParamID = "+s+", ParamListID = "+a)}),e.each(m,function(e,t){s.publishEvent(t.event,t.data)}),i([].slice(0))}else o("invalid server response")},o)}}else o("invalid 3DSpace URL")},o):o("No name provided!"):o("invalid parameters")})},updateResourceParameter:function(t){var a=this;return new i(function(i,n){if(t&&e.Object.isPlainObject(t)&&t.physicalid){var o={resourceParameterPhysicalid:t.physicalid};(t.V_Name||t.name)&&(o.V_Name=(t.V_Name||t.name).trim()),(t.V_description||t.description)&&(o.V_description=(t.V_description||t.description).trim()),(t.attributes||t.attributes)&&(o.attributes=JSON.stringify(t.attributes)),o.V_Name||o.V_description||o.attributes?s.getServiceUrl({serviceName:"3DSpace"}).then(function(r){if(r&&"string"==typeof r){var l=r+"/resources/DELWebInfrastructureLite/v0/resource/parameter?updateResourceParameter";s.callAuthenticatedRequest(l,"json","PATCH",o).then(function(r){var o=s.commonAjaxJsonResponseOK(r,n);if(!o)return o;var l=(r.Data?r.Data.ChangedAttributes:null)||{};a._cacheResourceParameter(Object.assign({physicalid:t.physicalid},l));var c=Object.assign({ChangedAttributes:e.clone(l)},t);s.publishEvent("ResourceParameter.updated",c),i(e.clone(c))},n)}else n("invalid 3DSpace URL")},n):n(r.get("No changes have been made."))}else n("invalid parameters")})},unassociateResourceParameterFromList:function(t){var n=this;return new i(function(i,o){t&&e.Object.isPlainObject(t)?t.resourceParameterQueryList||t.resourceParameterListQueryList?s.getServiceUrl({serviceName:"3DSpace"}).then(function(l){if(l&&"string"==typeof l){var c={};if(e.each(["resourceParameter","resourceParameterphysicalid","resourceParameterOXID","resourceParameterQueryList"],function(e,i){t[i]&&(c[i]=t[i])}),t.resourceParameterListphysicalid&&(c.resourceParameterListphysicalid=t.resourceParameterListphysicalid),e.Object.isEmptyObject(c)){if(e.each(["resourceParameterList","resourceParameterListphysicalid","resourceParameterListOXID","resourceParameterListQueryList","resourceParameter","resourceParameterphysicalid","resourceParameterOXID","resourceParameterQueryList"],function(e,i){t[i]&&(c[i]=t[i])}),e.Object.isEmptyObject(c))return void o("invalid parameters");c.param_list&&!c.target_param_list&&(c.target_param_list=c.param_list),delete c.param_list}var u=new window.FormData;s.useFixtures()?u=c:e.each(c,function(t,i){"string"!=typeof i&&isNaN(i)?u.append(t,e.Json.encode(i)):u.append(t,i)});var d=l+"/resources/DELWebInfrastructureLite/v0/resource/parameter?unassociateResourceParameterFromList";s.callAuthenticatedRequest(d,"json","DELETE",u).then(function(l){if(l){var c=s.commonAjaxJsonResponseOK(l,o);if(!c)return c;a.setDatabase();var u=l.Data||{},m=[],p=!0;e.each(u,function(i,a){if("SuccessfullyDeleted"===i||"AlreadyDeleted"===i)e.each(a,function(i,a){if(a&&e.Object.isPlainObject(a)&&!e.Object.isEmptyObject(a)){if(p=!0,!a.resourceParameter)if(t.resourceParameterList){var s=e.clone(a);a.properties=Object.assign(s,t.resourceParameterList)}else t.resourceParameterListAssociationOXID||t.resourceParameterListAssociationphysicalid?a.properties=Object.assign({OXID:t.resourceParameterListAssociationOXID,physicalid:t.resourceParameterListAssociationphysicalid},a):a.physicalid&&(a.properties={physicalid:a.physicalid});a.resourceParameterList||(t.resourceParameterList?a.resourceParameterList=t.resourceParameterList:(t.resourceParameterListphysicalid||t.resourceParameterListOXID)&&(a.resourceParameterList={physicalid:t.resourceParameterListphysicalid,OXID:t.resourceParameterListOXID})),a.resource||(t.resource?a.resource=t.resource:(t.target_physicalid||t.target_OXID)&&(a.resource={OXID:t.target_OXID,physicalid:t.target_physicalid})),n._cacheResourceParameterToResourceParameterListUnassoc(a),m.push({event:"ResourceParameter.unassociated",data:a})}else e.log("DELWebResourceParameterModel::unassociateResourceParameterFromList - invalid response from "+d)});else if("FailedUnassociated"===i){var s=e.clone(u);s=Object.assign(s,t),e.each(a,function(t,a){0===t.indexOf("[")?s.resourceParameterListOXID=t:s.resourceParameterListphysicalid=t,e.each(a,function(e,t){0===t.indexOf("[")?s.target_OXID=t:s.target_physicalid=t,m.push({event:"ResourceParameter.unassociated.error",data:s}),p=!1,o(i,s)})})}else e.log("unknown response key: "+i)}),e.each(m,function(e,t){s.publishEvent(t.event,t.data)}),p&&(u&&!e.Object.isEmptyObject(u)?i(e.clone(u)):o(r.get("Error")))}else o("invalid server response")},o)}else o("invalid 3DSpace URL")},o):o("No resource parameter list provided!"):o("invalid parameters")})},_cacheResource:function(e,t){if(window.Foe&&window.Foe.Model&&window.Foe.Model.Asset&&window.Foe.Model.Asset.cacheResourcePLMObject)return window.Foe.Model.Asset.cacheResourcePLMObject(e,t);var i=e;if(!i||!i.blnDoNotCache){n.resource||(n.resource={});var a=n.resource;if(i&&(i.OXID||i.physicalid)){i.OXID&&!i.physicalid&&(i.physicalid=s.getPhysicalIDForOXID(i.OXID)),t||"False"===i.Minimum?i.AllAttributesRetrieved=!0:i.AllAttributesRetrieved=i.AllAttributesRetrieved||!1;var r=Object.assign({},i);if(a[r.physicalid]){var o=Object.assign(a[r.physicalid],r);a[i.physicalid]=o,i.OXID&&(a[i.OXID]=a[i.physicalid])}else a[i.physicalid]=i,i.OXID&&(a[i.OXID]=a[i.physicalid])}}},_cacheResourceParameterList:function(e,t){n.parameter_list||(n.parameter_list={});var i=n.parameter_list;if(e.OXID||e.physicalid){if(e.plmBaseObjectType||(e.plmBaseObjectType="DELResourceParameterListReference"),i[e.physicalid||e.OXID]){var a=Object.assign(i[e.physicalid||e.OXID],e);i[e.physicalid||e.OXID]=a,Object.assign(e,a)}else i[e.physicalid||e.OXID]=e;e.OXID&&e.physicalid&&(i[e.OXID]=i[e.physicalid])}},_cacheResourceToResourceParameterListAssoc(t,i,a){if(t&&i&&a){if(n.parameter_list_assoc||(n.parameter_list_assoc={}),!n.parameter_list_assoc[t])if(0===t.indexOf("[")){var r=s.getPhysicalIDForOXID(t);n.parameter_list_assoc[r]?n.parameter_list_assoc[t]=n.parameter_list_assoc[r]:(n.parameter_list_assoc[r]={},n.parameter_list_assoc[t]=n.parameter_list_assoc[r])}else n.parameter_list_assoc[t]={};if(n.parameter_list_assoc[t]&&a&&(a.resourceParameterList||(a.resourceParameterList={physicalid:i},0===i.indexOf("[")&&(a.resourceParameterList.OXID=i,a.resourceParameterList.physicalid=s.getPhysicalIDForOXID(i))),n.parameter_list_assoc[t][a.resourceParameterList.physicalid]=a),delete n.parameter_list_assoc.All,n.resource&&n.resource[t]&&n.resource[t].V_discipline?delete n.parameter_list_assoc[n.resource[t].V_discipline]:a&&a.resource&&a.resource.V_discipline&&delete n.parameter_list_assoc[a.resource.V_discipline],n.parameter_list&&n.parameter_list[i]){var o=n.parameter_list[i];o.associatedResources||(o.associatedResources=[]),o.associatedResources.indexOf(t)<0&&o.associatedResources.push(t)}}else e.log("DELWebResourceParameterModel::_cacheResourceToResourceParameterListAssoc - missing input parameters!")},_cacheResourceToResourceParameterListUnassoc(t){if(t){if(n.parameter_list_assoc&&(t.resource&&t.resource.physicalid||!t.resourceParameterList||!t.resourceParameterList.physicalid||e.each(n.parameter_list_assoc,function(e,i){return i&&i[t.resourceParameterList.physicalid]&&(t.resource={physicalid:e}),!t.resource}),t.resource&&t.resource.physicalid&&n.parameter_list_assoc[t.resource.physicalid]&&(t.resourceParameterList&&t.resourceParameterList.physicalid?(t.resourceParameterList&&t.resourceParameterList.physicalid||!n.parameter_list_assoc[t.resource.physicalid][t.resourceParameterList.physicalid]||(t.resourceParameterList=n.parameter_list_assoc[t.resource.physicalid][t.resourceParameterList.physicalid].resourceParameterList),delete n.parameter_list_assoc[t.resource.physicalid][t.resourceParameterList.physicalid]):t.resourceParameterList&&t.resourceParameterList.physicalid&&e.each(n.parameter_list_assoc[t.resource.physicalid],function(e,i){i&&i.resourceParameterList&&i.resourceParameterList.physicalid===t.resourceParameterList.physicalid&&delete n.parameter_list_assoc[t.resource.physicalid][e]})),t.resourceParameterList&&t.resourceParameterList.physicalid&&t.resource&&t.resource.physicalid&&n.parameter_list&&n.parameter_list[t.resourceParameterList.physicalid]))for(var i=n.parameter_list[t.resourceParameterList.physicalid];i.associatedResources&&i.associatedResources.length&&i.associatedResources.indexOf(t.resource.physicalid)>=0;)i.associatedResources.splice(i.associatedResources.indexOf(t.resource.physicalid),1)}else e.log("DELWebResourceParameterModel::_cacheResourceToResourceParameterListUnassoc - missing input parameters!")},_cacheResourceParameterToResourceParameterListUnassoc(t){if(t){if(n.parameter_list)if(t.resourceParameterList&&t.resourceParameterList.physicalid||!t.properties||!t.properties.physicalid||e.each(n.parameter_list,function(e,i){return i&&i[t.properties.physicalid]&&(t.resourceParameterList={physicalid:e}),!t.resourceParameterList}),t.resourceParameterList&&t.resourceParameterList.physicalid&&t.properties&&t.properties.physicalid){if(n.parameter_list&&n.parameter_list[t.resourceParameterList.physicalid])for(var i=n.parameter_list[t.resourceParameterList.physicalid];i.associatedResourceParameters&&i.associatedResourceParameters.length&&i.associatedResourceParameters.indexOf(t.properties.physicalid)>=0;)i.associatedResourceParameters.splice(i.associatedResourceParameters.indexOf(t.properties.physicalid),1)}else t.physicalid&&n.parameter_list&&e.each(n.parameter_list,function(e,i){for(;i.associatedResourceParameters&&i.associatedResourceParameters.length&&i.associatedResourceParameters.indexOf(t.physicalid)>=0;)i.associatedResourceParameters.splice(i.associatedResourceParameters.indexOf(t.physicalid),1)})}else e.log("DELWebResourceParameterModel::_cacheResourceParameterToResourceParameterListUnassoc - missing input parameters!")},_cacheResourceParameterToResourceParameterListAssoc:function(t,i){if(t&&i){if(n.parameter_list||(n.parameter_list={}),!n.parameter_list[t])if(0===t.indexOf("[")){var a=s.getPhysicalIDForOXID(t);n.parameter_list[a]?n.parameter_list[t]=n.parameter_list[a]:(n.parameter_list[a]={},n.parameter_list[t]=n.parameter_list[a])}else n.parameter_list[t]={};n.parameter_list[t]&&i&&(i.resourceParameterList||(i.resourceParameterList={physicalid:t},0===t.indexOf("[")&&(i.resourceParameterList.OXID=t,i.resourceParameterList.physicalid=s.getPhysicalIDForOXID(t))),n.parameter_list[t].associatedResourceParameters||(n.parameter_list[t].associatedResourceParameters=[]),i.properties&&i.properties.physicalid&&n.parameter_list[t].associatedResourceParameters.push(i.properties.physicalid))}else e.log("DELWebResourceParameterModel::_cacheResourceParameterToResourceParameterListAssoc - missing input parameters!")},updateDefaultMagnitudes:function(t){var a=this;return new i(function(i,r){t&&e.Object.isPlainObject(t)?s.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var l={};t&&t.dimensionList&&(l.key="preference_DimensionsList",l.value=t.dimensionList);var c=o+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace";s.useFixtures()&&(c=o+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences?updateDefaultMagnitudes"),s.callAuthenticatedRequest(c,"json","PATCH",l).then(function(t){if(t){var o=s.commonAjaxJsonResponseOK(t,r);if(!o)return o;t.Data&&t.Data.preference_DimensionsList||(t.Data.preference_DimensionsList="ANGLEParameter;LENGTHParameter;MASSParameter;");var c=[];e.each(t.Data.preference_DimensionsList.split(";"),function(e,t){t&&c.push(t.replace("Parameter",""))}),l={filter:"dimensionName+eq+"+c.join(",")},a.getMagnitudes(l).then(function(t){t&&(s.useFixtures()&&c.length&&e.each(t,function(e){c.indexOf(e)<0&&delete t[e]}),n._dimensionsPreferred=t),i(e.clone(t))},r)}else r("invalid server response")},r)}else r("invalid 3DSpace URL")},r):r("invalid parameters")})},getDefaultMagnitudes:function(t){var a=this;return t||(t={}),new i(function(i,o){!t.blnForceRefresh&&n&&n._dimensionsPreferred&&e.Object.isPlainObject(n._dimensionsPreferred)&&!e.Object.isEmptyObject(n._dimensionsPreferred)?i(e.clone(n._dimensionsPreferred)):s.getServiceUrl({serviceName:"3DSpace"}).then(function(t){if(t&&"string"==typeof t){var l={key:"preference_DimensionsList"},c=t+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace";s.useFixtures()&&(c=t+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences"),s.callAuthenticatedRequest(c,"json","GET",l).then(function(t){if(t){var c=s.commonAjaxJsonResponseOK(t,o);if(!c)return c;t.Data&&t.Data.preference_DimensionsList||(t.Data.preference_DimensionsList="ANGLEParameter;LENGTHParameter;MASSParameter;IntegerParameter;StringParameter");var u=[];e.each(t.Data.preference_DimensionsList.split(";"),function(e,t){t&&u.push(t.replace("Parameter",""))}),l={filter:"dimensionName+eq+"+u.join(",")},a.getMagnitudes(l).then(function(t){t&&(s.useFixtures()&&u.length&&e.each(t,function(e){u.indexOf(e)<0&&delete t[e]}),n._dimensionsPreferred=t),u.indexOf("Integer")>-1&&!t.Integer&&(t.Integer={Name:"Integer",NLS:r.get("Integer")}),u.indexOf("String")>-1&&!t.String&&(t.String={Name:"String",NLS:r.get("Text")}),i(e.clone(t))},o)}else o("invalid server response")},o)}else o("invalid 3DSpace URL")},o)})},getMagnitudes:function(t){return t||(t={}),new i(function(i,a){if(n&&n._dimensions&&e.Object.isPlainObject(n._dimensions)&&!e.Object.isEmptyObject(n._dimensions)&&!t.blnForceRefresh){if(!t.filter)return void i(e.clone(n._dimensions));if(t.magnitude&&n._dimensions[t.magnitude]){var o={};return o[t.magnitude]=e.clone(n._dimensions[t.magnitude]),void i(o)}}s.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var l=o+"/resources/dictionary/dimensions";t.filter&&(l+="?$filter="+t.filter),s.callAuthenticatedRequest(l,"json","GET",{}).then(function(s){try{var o={};s.results.forEach(function(e){o[e.Name]=e}),t.filter?n._dimensions&&!e.Object.isEmptyObject(n._dimensions)&&(n._dimensions=Object.assign(n._dimensions||{},o)):n._dimensions=o,i(e.clone(o)),e.log("Dimensions loaded")}catch(t){e.log("Unexpected error when fetching dimensions"),e.log(t),a((t.message||t)+" \n"+r.get("DIMENSIONAL_ATTRIBUTES_ARE_INVALID"))}},function(t){e.log("Unable to get dimensions : "),e.log(t),a((t.message||t)+" \n"+r.get("FAILED_TO_FETCH_DIMENSIONAL_ATTRIBUTES"))},a)}else a("invalid 3DSpace URL")},a)})},getMagnitudeUnits:function(t){var a=this;return new i(function(i,r){if(t&&e.Object.isPlainObject(t))if(t.magnitude){if(n&&n._dimensions&&n._dimensions[t.magnitude]&&n._dimensions[t.magnitude].Units&&!t.blnForceRefresh){var o=!1;if(e.each(n._dimensions[t.magnitude].Units,function(e,t){return!(o=t&&t.default)}),o)return void i(n._dimensions[t.magnitude].Units.slice(0))}a.getMagnitudes({filter:"dimensionName+eq+"+t.magnitude,magnitude:t.magnitude,blnForceRefresh:t.blnForceRefresh||!1}).then(function(o){if(o&&o[t.magnitude]){if(o[t.magnitude].Units){var l=!1;if(e.each(o[t.magnitude].Units,function(e,t){return!(l=t&&t.default)}),l)return void i(o[t.magnitude].Units.slice(0))}s.getServiceUrl({serviceName:"3DSpace"}).then(function(l){if(l&&"string"==typeof l){var c={key:"preference_DisplayUnits"},u=JSON.stringify(c);if(n||(n={}),n.getMagnitudeUnits_jqXHR){if(n.getMagnitudeUnits_jqXHR[u]&&(!n.getMagnitudeUnits_jqXHR[u].readyState||4!==n.getMagnitudeUnits_jqXHR[u].readyState))return void setTimeout(function(){a.getMagnitudeUnits(t).then(i,r)},500)}else n.getMagnitudeUnits_jqXHR={};n.getMagnitudeUnits_jqXHR[u]=t;var d=l+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace";s.useFixtures()&&(d=l+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences"),s.callAuthenticatedRequest(d,"json","GET",c).then(function(a){if(n.getMagnitudeUnits_jqXHR[u]&&delete n.getMagnitudeUnits_jqXHR[u],a){var l=s.commonAjaxJsonResponseOK(a,r);if(!l)return l;a.Data&&a.Data.preference_DisplayUnits||(a.Data||(a.Data={}),n&&n._dimensions&&!e.Object.isEmptyObject(n._dimensions)?(a.Data.preference_DisplayUnits="",e.each(n._dimensions,function(e,t){t&&t.MKSUnit&&(a.Data.preference_DisplayUnits&&(a.Data.preference_DisplayUnits+=","),a.Data.preference_DisplayUnits+=(t.Name||e)+"Parameter:"+t.MKSUnit)})):a.Data.preference_DisplayUnits=t.magnitude+":"+o[t.magnitude].MKSUnit),e.each(a.Data.preference_DisplayUnits.split(","),function(i,a){if(a){var s=a.split(":"),r=t.magnitude,l=a;2===s.length&&(r=s[0].replace("Parameter",""),l=s[1]),n&&n._dimensions&&n._dimensions[r]&&n._dimensions[r].Units&&e.each(n._dimensions[r].Units,function(e,t){return!t||t.label!==l&&t.Name!==l||(t.default=!0),!(t&&t.default)}),o[r]&&o[r].Units&&e.each(o[r].Units,function(e,t){return t&&(t.label===l||t.Name&&t.Name===l)&&(t.default=!0),!(t&&t.default)})}}),i(o[t.magnitude].Units.slice(0))}else r("invalid server response")})}else r("invalid 3DSpace URL")},r)}else r("No Units Defined")},r)}else r("no magnitude provided!");else r("invalid parameters")})},updateMagnitudeUnits:function(t){var a=this,r=[],o=t.defaultUnits;return","==o.slice(-1)&&(o=o.slice(0,-1)),e.each(o.split(","),function(e,t){if(t){var i=t.split(":"),a="";2===i.length&&(a=i[0].replace("Parameter",""),r.push(a))}}),new i(function(i,o){t&&e.Object.isPlainObject(t)?s.getServiceUrl({serviceName:"3DSpace"}).then(function(l){if(l&&"string"==typeof l){var c={};t&&t.defaultUnits&&(c.key="preference_DisplayUnits",c.value=t.defaultUnits);var u=l+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace";s.useFixtures()&&(u=l+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences?updateMagnitudeUnits"),s.callAuthenticatedRequest(u,"json","PATCH",c).then(function(t){if(t){var l=s.commonAjaxJsonResponseOK(t,o);if(!l)return l;var c={};e.each(t.Data.preference_DisplayUnits.split(","),function(t,s){if(s){var l=s.split(":"),u="",d="";2===l.length&&(u=l[0].replace("Parameter",""),d=l[1]),c[l[0]]=l[1],n&&n._dimensions&&n._dimensions[u]&&n._dimensions[u].Units&&e.each(n._dimensions[u].Units,function(e,t){return t&&(t.label===d||!t.label&&t.Name===d)?t.default=!0:t&&t.default&&delete t.default,!(t&&t.default)}),r.indexOf(u)>-1&&a.getMagnitudeUnits({magnitude:u}).then(function(t){if(t){var a=!1;t&&(e.each(t,function(e,t){return!(a=t&&t.default)}),a)?i(t.slice(0)):t&&e.each(t,function(e,t){return t&&(t.label===d||t.Name&&t.Name===d)?t.default=!0:t&&t.default&&delete t.default,!(t&&t.default)})}else o("No Units Defined")})}}),i(c)}else o("invalid server response")},o)}else o("invalid 3DSpace URL")},o):o("invalid parameters")})},getOneResource:function(t){var a=this;return new i(function(i,r){if(t&&e.Object.isPlainObject(t))if(t.physicalid){"Minimum"in t&&!0!==t.Minimum?t.Minimum&&Array.isArray(t.Minimum)||(t.Minimum="False"):t.Minimum="True";var n=t.Minimum,o=["V_Name","physicalid"];t.Minimum&&!Array.isArray(t.Minimum)&&(t.Minimum.match(/true/i)||t.Minimum.match(/yes/i)||t.Minimum.match(/on/i))&&(t.Minimum=o);var l=a._FindPLMObjectInCache(t,t.Minimum);l&&!l.ReferenceOXID&&!l.ReferencePhysicalid&&n&&n.match&&(n.match(/true/i)||n.match(/yes/i)||n.match(/on/i))&&(t.Minimum=o,l=a._FindPLMObjectInCache(t,t.Minimum)),l?i(Object.assign({},l)):(t.class_name||(t.class_name="PRODUCTCFG/VPMReference"),t.Extensions||(t.Extensions="DELRmiResourceModel/Resource"),!t.fixtureTag&&s.useFixtures()&&(t.fixtureTag="getResourceForPhysicalId"),s.getReference(t).then(function(e){e&&a._cacheResource(Object.assign({},e)),i(e)},r))}else r("no id provided!");else r("invalid parameters")})},_FindPLMObjectInCache:function(t,i){var a=Object.assign({},t);if(e.each(a,function(t,i){(e.Object.isPlainObject(i)||Array.isArray(i))&&delete a[t]}),!a.OXID&&!a.physicalid&&!a.PLM_ExternalID){if(!a.id)return null;a.PLM_ExternalID=a.id}a.OXID&&!a.physicalid&&(a.physicalid=s.getPhysicalIDForOXID(a.OXID));var r=null;return e.each(["parameter_list","resource"],function(t,s){var o=n[s];if(o){if(r||!a.OXID&&!a.physicalid||!(r=o[a.physicalid||a.OXID])&&a.OXID&&(r=o[a.OXID])&&a.physicalid&&(o[a.physicalid]=o[a.OXID]),r)if(a.ForceCache?r.ForceCache=a.ForceCache:a.bForceCache&&(r.ForceCache=a.bForceCache),i&&i instanceof Array){l=r,c=i,u=!0,e.each(c,function(t,i){return i&&"string"!=typeof i&&i.dataIndex&&(i=i.dataIndex),!(u=l.hasOwnProperty(i))&&0===i.indexOf("V_")&&Object.keys&&e.each(Object.keys(l),function(e,t){return(u=t.indexOf(")."+i)>0&&0===t.indexOf("Ext("))&&(i=t),!u}),!u&&i.indexOf("__Ref_")<0&&"VPMInstance"===l.plmObjectType&&(u=l.hasOwnProperty("__Ref_"+i))&&(i="__Ref_"+i),u}),u||(r=null)}else i&&"false"!==i.toLowerCase()||r.AllAttributesRetrieved||r.ForceCache||(r=null);var l,c,u;return!r}}),r},searchForResourceParameterListData:function(t){var a=this;return new i(function(i,r){t?s.getServiceUrl({serviceName:"3DSearch"}).then(function(n){if(n&&"string"==typeof n){var o="("+a.get3DSearchString()+")";(t.search_str||t.name)&&"*"!==(t.search_str||t.name)&&(o+=" AND ("+(t.search_str||t.name)+")"),!t.tenant&&window.widget.data&&(t.tenant=window.widget.data.x3dPlatformId);var l={query:o,label:Foe.Model.Session.get("user")+"-DELWebResourceParameterModel.searchForResourceParameterListData-"+(new Date).getTime(),locale:window.widget.lang,tenant:t.platformId||t.tenant,source:["3dspace","r2vsurvey"],select_predicate:["ds6w:label","ds6w:type","ds6w:description","bo.PLMEntity.V_description","ds6w:identifier","ds6w:modified","ds6w:created","ds6wg:revision","ds6w:status","ds6w:responsible","owner","ds6w:responsibleUid","ds6wg:filesize","ds6w:project","ds6w:dataSource","ds6w:community","ds6w:repository","dcterms:title","dcterms:description","ds6w:containerUid"],with_synthesis:!1,with_synthesis_attribute:!1};t.Minimum&&$.isArray(t.Minimum)&&t.Minimum.length&&e.each(t.Minimum,function(e,t){var i=t;window.Fam&&window.Fam.Model&&window.Fam.Model.Platform&&window.Fam.Model.Platform.convertAttrToSearchPredicate&&window.Fam.Model.Platform.convertAttrToSearchPredicate&&(i=window.Fam.Model.Platform.convertAttrToSearchPredicate(t)),i&&Array.isArray(i)?i.forEach(function(e){l.select_predicate.indexOf(e)<0&&l.select_predicate.push(e)}):i&&l.select_predicate.indexOf(i)<0&&l.select_predicate.push(i)}),t.endindex&&(l.nresults="startindex"in t?t.endindex-t.startindex:t.endindex),l=window.UWA.Json.encode(l);var c=n+"/search";s.useFixtures()&&(c+="?searchForResourceParameterListData"),s.callAuthenticatedRequest(c,"json","POST",l).then(function(r){var n={},o=[];if(r&&r.results&&r.results.length){e.each(r.results,function(e,i){var r=Fam.Model.Platform.convertToModelObj(i.attributes);!r.id&&r.resourceid&&(r.id=r.resourceid),!r.name&&r["ds6w:label"]&&(r.name=r["ds6w:label"]),n[r.id]=r,s.useFixtures()&&a._cacheResourceParameterList(r,"False"===t.Minimum)}),o=Object.values(n)}i(o)},function(e){r(e)},function(e){r(e)})}else r("invalid 3DSearch URL")}):r("Invalid input parameters!")})}});if(s.useFixtures()){function c(){var e=Math.random().toString();return e.substr(e.indexOf(".")+1)}window.Configuration&&window.Configuration.fixtureDelay&&(window.can.fixture.delay=window.Configuration.fixtureDelay),window.can.fixture({type:"GET",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/getResourceParameterList.json",function(a){a.Data;var s=t.data;if("string"==typeof s&&(s=JSON.parse(s)),s&&s.disciplineFilter&&(a.Data=[],n&&n.parameter_list_assoc)){var r={};e.each(n.parameter_list_assoc,function(t,i){n.resource&&n.resource[t]&&n.resource[t].V_discipline===s.disciplineFilter&&i&&e.Object.isPlainObject(i)&&!e.Object.isEmptyObject(i)&&(r=Object.assign(r,i))}),e.Object.isEmptyObject(r)||(a.Data=Object.values(r))}i.responseText=JSON.stringify(a),t.complete(i,i.statusText)})}),window.can.fixture({type:"DELETE",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/unassociateResourceParameterList.json",function(a){a.Data;a.Data={};var r=t.data;if("string"==typeof r&&(r=JSON.parse(r)),r.target_physicalid||r.target_OXID||r.target_resource){var o=r.target_resource?r.target_resource.physicalid:r.target_physicalid||s.getPhysicalIDForOXID(r.target_OXID);if(n.parameter_list_assoc&&o&&n.parameter_list_assoc[o]){var l=null;if(r.resourceParameterListAssociationphysicalid||r.resourceParameterListAssociationQueryList)a.Data.SuccessfullyUnassociated={},delete a.Data.AlreadyUnassociated,e.each(r.resourceParameterListAssociationQueryList||[r.resourceParameterListAssociationphysicalid],function(e,t){t&&n.parameter_list_assoc[o][t]?(l=n.parameter_list_assoc[o][t],a.Data.SuccessfullyUnassociated[l.properties.physicalid]=l):(a.Data.AlreadyUnassociated||(a.Data.AlreadyUnassociated=[]),a.Data.AlreadyUnassociated.push({physicalid:t}))});else if(r.resourceParameterList||r.resourceParameterListphysicalid||r.resourceParameterListOXID||r.resourceParameterListQueryList){a.Data.SuccessfullyUnassociated={},delete a.Data.AlreadyUnassociated;var c=r.resourceParameterListQueryList||[r.resourceParameterList];c&&c.length||(c=[{physicalid:r.resourceParameterListphysicalid||s.getPhysicalIDForOXID(r.resourceParameterListOXID)}]),e.each(c,function(t,i){i&&i.physicalid&&(l=null,e.each(n.parameter_list_assoc[o],function(e,t){t.resourceParameterList&&t.resourceParameterList.physicalid===i.physicalid&&(l=n.parameter_list_assoc[o][e],a.Data.SuccessfullyUnassociated[e]=l)}),l||(a.Data.AlreadyUnassociated||(a.Data.AlreadyUnassociated=[]),a.Data.AlreadyUnassociated.push({resource:r.target_resource||{physicalid:o},resourceParameterList:r.resourceParameterList||{physicalid:resourceParameterListPhysicalid}})))})}}}i.responseText=JSON.stringify(a),t.complete(i,i.statusText)})}),window.can.fixture({type:"POST",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/associateResourceParameterList.json",function(a){a.Data;a.Data={};var r=t.data;if("string"==typeof r&&(r=JSON.parse(r)),r.target_physicalid||r.target_OXID||r.target_resource){var o=r.target_resource?r.target_resource.physicalid:r.target_physicalid||s.getPhysicalIDForOXID(r.target_OXID);if(n.parameter_list_assoc&&o&&n.parameter_list_assoc[o]){var l=null;if(r.resourceParameterList||r.resourceParameterListphysicalid||r.resourceParameterListOXID||r.resourceParameterListQueryList){a.Data.SuccessfullyAssociated={},delete a.Data.AlreadyAssociated;var c=r.resourceParameterListQueryList||[r.resourceParameterList];c&&c.length||(c=[{physicalid:r.resourceParameterListphysicalid||s.getPhysicalIDForOXID(r.resourceParameterListOXID)}]),e.each(c,function(t,i){if(i&&i.physicalid&&(l=null,e.each(n.parameter_list_assoc[o],function(e,t){return t.resourceParameterList&&t.resourceParameterList.physicalid===i.physicalid&&(a.Data.AlreadyAssociated||(a.Data.AlreadyAssociated=[]),a.Data.AlreadyAssociated.push(t),l=t),!l}),!l)){var s={physicalid:o};n.resource&&n.resource[o]&&(s=n.resource[o]),n.parameter_list&&n.parameter_list[i.physicalid]&&(i=Object.assign(i,n.parameter_list[i.physicalid])),l={resource:s,resourceParameterList:i,properties:{resourcePhysicalid:s.physicalid,V_Name:s.physicalid+"-"+i.physicalid,V_description:"",physicalid:s.physicalid+"-"+i.physicalid,rplPhysicalid:i.physicalid}},a.Data.SuccessfullyAssociated[l.properties.physicalid]=l}})}}}i.responseText=JSON.stringify(a),t.complete(i,i.statusText)})}),window.can.fixture({type:"POST",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameterList"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/createResourceParameterList.json",function(a){var s=a.Data;a.Data={};var r=t.data;if("string"==typeof r&&(r=JSON.parse(r)),r.target_physicalid||r.target_OXID||r.target_resource){a.Data.SuccessfullyAssociated=[],r.target_resource||(r.target_resource={},r.target_physicalid&&(r.target_resource.physicalid=r.target_physicalid),r.target_OXID&&(r.target_resource.OXID=r.target_OXID));var o=null;e.each(s.SuccessfullyAssociated,function(t,i){return i&&i.resource&&i.resourceParameterList&&(o=e.clone(i)),!o}),o&&(o.resource=r.target_resource,n&&n.resource&&n.resource[r.target_resource.physicalid||r.target_resource.OXID]&&(o.resource=n.resource[r.target_resource.physicalid||r.target_resource.OXID]),delete o.resourceParameterList.physicalid,delete o.resourceParameterList.OXID,delete o.resourceParameterList.PLM_ExternalID,delete o.resourceParameterList.name,delete o.resourceParameterList.V_Name,delete o.resourceParameterList.V_description,o.resourceParameterList=Object.assign(o.resourceParameterList,{physicalid:c(),V_Name:null,V_description:""}),e.each(o.resourceParameterList,function(e){r[e]&&(o.resourceParameterList[e]=r[e])}),a.Data[o.resourceParameterList.physicalid]=o.resourceParameterList,a.Data.SuccessfullyAssociated.push(o))}i.responseText=JSON.stringify(a),t.complete(i,i.statusText)})}),window.can.fixture({type:"PATCH",url:o+"/resources/DELWebInfrastructureLite/v0/resource?updateResourceParameterList"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/updateResourceParameterList.json",function(a){a.Data={ChangedAttributes:{}};var s=t.data;"string"==typeof s&&(s=JSON.parse(s)),s.attributes&&"string"==typeof s.attributes&&(s.attributes=JSON.parse(s.attributes)),e.each(s.attributes,function(e,t){(t.V_Name||"V_description"in t)&&(t.V_Name&&(a.Data.ChangedAttributes.V_Name=t.V_Name),"V_description"in t&&(a.Data.ChangedAttributes.V_description=t.V_description))}),i.responseText=JSON.stringify(a),t.complete(i,i.statusText)})}),window.can.fixture({type:"GET",url:o+"/resources/DELWebInfrastructureLite/v0/referenceFinder?getOneResourceParameterList"},"../DELWebInfrastructureUI.tst/fixtures/getResourceParameterListOne.json"),window.can.fixture({type:"GET",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameter"},"../DELWebInfrastructureUI.tst/fixtures/getResourceParametersForList.json"),window.can.fixture({type:"POST",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameter?createResourceParameter"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/createResourceParameter.json",function(a){a.Data;var s=t.data;"string"==typeof s&&(s=JSON.parse(s));var r="DELRscPrmIORangeValue_";"Integer"===s.resourceParameterExtension?r="Integer":"String"===s.resourceParameterExtension&&(r="Text");var n=null,o=null;e.each(a.Data,function(e,t){return t&&(o||(o=t),!n&&t.interfaces&&t.interfaces.length&&t.interfaces[0].length&&t.interfaces[0][0].indexOf(r)>=0&&(n=t)),!n}),!n&&o&&(n=o),a.Data={},n&&(n.physicalid=c(),delete n.OXID,n.PLM_ExternalID="rpl-fixture_"+n.physicalid,delete n.name,e.each(n,function(t){if("Integer"!==s.resourceParameterExtension&&"String"!==s.resourceParameterExtension)s[t]&&(n[t]=s[t]);else if(delete n.maxLimit,delete n.minLimit,delete n.maxValue,delete n.minValue,delete n.units,s[t]&&(n[t]=s[t]),s.V_Values){var i=JSON.parse(s.V_Values);n.V_Values=[],e.each(i,function(e,t){n.V_Values[e]=t})}}),s.resourceParameterExtension&&"Integer"!==s.resourceParameterExtension&&"String"!==s.resourceParameterExtension&&(n.interfaces=[["DELRscPrmIORangeValue_"+s.resourceParameterExtension,"DELRscPrmIOValueAbstract"]]),s.inputOutput&&(n.plmObjectTypeInternal=n.V_discipline="DELResourcePrm"+s.inputOutput.toUpperCase(),n.OXID="["+n.physicalid+","+n.plmObjectTypeInternal+",businessobject]"),a.Data[n.physicalid]=n),i.responseText=JSON.stringify(a),t.complete(i,i.statusText)})}),window.can.fixture({type:"PATCH",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameter?updateResourceParameter"},function(e){var t=window.$.get("../DELWebInfrastructureUI.tst/fixtures/updateResourceParameter.json",function(i){i.Data={ChangedAttributes:{}};var a=e.data;"string"==typeof a&&(a=JSON.parse(a)),(a.V_Name||"V_description"in a)&&(a.V_Name&&(i.Data.ChangedAttributes.V_Name=a.V_Name),"V_description"in a&&(i.Data.ChangedAttributes.V_description=a.V_description)),t.responseText=JSON.stringify(i),e.complete(t,t.statusText)})}),window.can.fixture({type:"DELETE",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameter?unassociateResourceParameterFromList"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/unassociateResourceParameterFromList.json",function(a){a.Data;a.Data={};var r=t.data;"string"==typeof r&&(r=JSON.parse(r));var o=r.resourceParameterListphysicalid,l=null;if(r.resourceParameterPhysicalid||r.resourceParameterQueryList)a.Data.SuccessfullyDeleted={},delete a.Data.AlreadyUnassociated,e.each(r.resourceParameterQueryList||[{physicalid:r.resourceParameterPhysicalid}],function(e,t){var i=t.physicalid;!r.resourceParameterListphysicalid&&i&&n.parameter&&n.parameter[i]&&n.parameter[i].rplPhysicalid&&(o=n.parameter[i].rplPhysicalid),i&&n.parameter[i]&&n.parameter_list[o]&&n.parameter_list[o].associatedResourceParameters&&n.parameter_list[o].associatedResourceParameters.indexOf(i)>=0?(l=n.parameter[i],a.Data.SuccessfullyDeleted[i]=l):(a.Data.AlreadyUnassociated||(a.Data.AlreadyUnassociated=[]),a.Data.AlreadyUnassociated.push({physicalid:i}))});else if(r.resourceParameterList||r.resourceParameterListphysicalid||r.resourceParameterListOXID||r.resourceParameterListQueryList){a.Data.SuccessfullyDeleted={},delete a.Data.AlreadyUnassociated;var c=r.resourceParameterListQueryList||(r.resourceParameterList?[r.resourceParameterList]:null);c&&c.length||(c=[{physicalid:r.resourceParameterListphysicalid||s.getPhysicalIDForOXID(r.resourceParameterListOXID)}]),e.each(c,function(t,i){i&&i.physicalid&&(l=null,e.each(n.parameter_assoc[o],function(e,t){t.resourceParameterList&&t.resourceParameterList.physicalid===i.physicalid&&(l=n.parameter_assoc[o][e],a.Data.SuccessfullyDeleted[e]=l)}),l||(a.Data.AlreadyUnassociated||(a.Data.AlreadyUnassociated=[]),a.Data.AlreadyUnassociated.push({resource:r.target_resource||{physicalid:o},resourceParameterList:r.resourceParameterList||{physicalid:resourceParameterListPhysicalid}})))})}i.responseText=JSON.stringify(a),t.complete(i,i.statusText)})}),window.can.fixture({type:"PATCH",url:o+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences?updateDefaultMagnitudes"},function(e){var t=window.$.get("../DELWebInfrastructureUI.tst/fixtures/updateDefaultMagnitudes.json",function(i){i.Data={};var a=e.data;"string"==typeof a&&(a=JSON.parse(a)),"preference_DimensionsList"===a.key&&(i.Data.preference_DimensionsList=a.value),t.responseText=JSON.stringify(i),e.complete(t,t.statusText)})}),window.can.fixture({type:"PATCH",url:o+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences?updateMagnitudeUnits"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/updateMagnitudeUnits.json",function(a){var s=a.Data.preference_DisplayUnits.split(","),r=[];e.each(s,function(e,t){if(e%2==0){var i=t.split(":");r.push(i[0])}}),a.Data={};var n=t.data;"string"==typeof n&&(n=JSON.parse(n)),"preference_DisplayUnits"===n.key&&(a.Data.preference_DisplayUnits=n.value),i.responseText=JSON.stringify(a),t.complete(i,i.statusText)})}),window.can.fixture({type:"GET",url:o+"/resources/dictionary/dimensions"},"../DELWebInfrastructureUI.tst/fixtures/getMagnitudes.json"),window.can.fixture({type:"GET",url:o+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace"},"../DELWebInfrastructureUI.tst/fixtures/getThreeDSpacePreferences.json"),window.can.fixture({type:"GET",url:o+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences"},"../DELWebInfrastructureUI.tst/fixtures/getThreeDSpacePreferences.json"),window.can.fixture({type:"POST",url:o.substr(0,o.lastIndexOf("/"))+"/federated/search?searchForResourceParameterListData"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/getResourceParameterListSearchData.json",function(a){if(n&&n.parameter_list&&!e.Object.isEmptyObject(n.parameter_list)){var s=[];e.each(a.results,function(t,i){e.each(i.attributes,function(e,t){return"resourceid"!==t.name||(s.push(t.value),!1)})});var r=a.results[0].attributes;e.each(n.parameter_list,function(t,i){if(t===i.physicalid&&!(s.indexOf(i.physicalid)>=0)){s.push(i.physicalid);var n=[];e.each(r,function(t,a){var s=Object.assign({},a),r=Fam.Model.Platform.convertSearchPredicateToAttr(s.name.replace(":snippet",""));if(r){switch(r){case"resourceid":s.value=i.physicalid||null;break;case"ds6w:identifier":s.value=i.PLM_ExternalID||null;break;case"label":s.value=i.V_Name||null;break;default:s.value=i[r]||s.value||null}n.push(s)}else e.log("DELWebResourceParameterModel::getResourceParameterListSearchData fixture- unknown attribute = "+s.name)}),a.results.push({attributes:n})}})}i.responseText=JSON.stringify(a),t.complete(i,i.statusText)})})}return l}),window.define&&define("DS/DELWebInfrastructureControls/DELWebSearchUtils",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","UWA/Promise","DS/DELWebInfrastructureControls/DELWebAjaxModel","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],function(e,t,i,a,s){"use strict";return t.singleton({getUnifiedSearchUnserializedDataFromDrop:function(t){var i=t.originalEvent||t,a=[];if(!e.is(i))return e.log("ERROR: No dropped item found"),a;for(var s,r=null,n=e.is(i.dataTransfer.types.indexOf,"function")?"indexOf":"contains",o="",l=["text/searchitems","text/plain","Text"],c=0;c<l.length&&""===o;c++){var u=i.dataTransfer.types[n](l[c]);(e.is(u,"number")&&u>=0||e.is(u,"boolean")&&!0===u)&&(o=l[c])}if(""===o)return e.log("ERROR: No data retrieved"),a;s=i.dataTransfer.getData(o);try{r=e.Json.decode(s)}catch(e){return a}return e.is(r)?e.is(r.data)?(window.widget.getUrl().contains("TSK5358265=0")||("source"in r&&"X3DSEAR_AP"!==r.source&&this.isDataStructureSameAsSearch(r)?(window.OpenAjax&&"dataSource"in r&&"index"!==r.dataSource&&OpenAjax.hub.publish("UnifiedSearch.Results.setAuthoring",{}),r.source="X3DSEAR_AP"):"source"in r||!this.isDataStructureSameAsSearch(r)||(r.source="X3DSEAR_AP")),r):(e.log("ERROR: No data retrieved"),a):(e.log("ERROR: Parsing returned null"),a)},getUnifiedSearchUnserializedItemsFromDrop:function(t){if(!t||!t.originalEvent&&!(t||t.originalEvent).dataTransfer)return e.log("DELWebSearchUtils::getUnifiedSearchUnserializedItemsFromDrop - invalid input params!"),null;var i=[],a=null;try{a=this.getUnifiedSearchUnserializedDataFromDrop(t)}catch(e){return i}return e.is(a)?"X3DSEAR_AP"!==a.source?(e.log("DELWebSearchUtils::getUnifiedSearchUnserializedItemsFromDrop - not unified search"),null):e.is(a.data)?e.is(a.data.items,"array")?(a.data.items.length>0&&(i=a.data.items),i):(e.log("ERROR: Items is not an array"),i):(e.log("ERROR: No data retrieved"),i):(e.log("ERROR: Parsing returned null"),i)},getUnifiedSearchObjectsFromDrop:function(t){var s=this;return new i(function(i,r){if(!t||!t.ev)return e.log("DELWebSearchUtils::getUnifiedSearchObjects - invalid input params!"),r("DELWebSearchUtils::getUnifiedSearchObjects - invalid input params!"),!1;var n=t.ev,o=s.getUnifiedSearchUnserializedItemsFromDrop(n);if(!o||!o.length)return o?void r("Invalid Parameters!"):void r("Unknown source type");for(var l={Minimum:"false",QueryList:[]},c={},u=0;u<o.length;u++){var d=o[u];if(d.objectId&&d.objectType&&"VPMReference"===d.objectType){var m={physicalid:d.objectId,Depth:0};l.QueryList.push(m)}else if(d.objectId){var p={name:d.displayName,type:d.objectType,objectType:d.objectType,serviceId:d.serviceId,id:d.objectId};c[d.objectId]=p}}if(l.QueryList.length>0)return a.getTree(l).then(function(t){e.each(t,function(e,t){c[e]=t}),i(c)},r);i(c)})}})}),window.define&&define("DS/DELWebInfrastructureControls/CommonControllers/confirmationDialog",["DS/DELWebInfrastructureControls/UWAUtils","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],function(e,t,i,a){"use strict";return t.inherit({name:"ConfirmationDialog",contentVisibleState:!1,publishedProperties:{title:{defaultValue:a.get("Confirm"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"}},init:function(e){e?this.options=Object.assign(this.options||{},e):this.options||(this.options={}),this._parent.apply(this,arguments)},destroy:function(){this._parent.apply(this,arguments),this._closeCallback&&this._closeCallback(),!this._createDlg&&this.options&&this.options._createDlg&&(this._createDlg=this.options._createDlg),this._createDlg&&!this._createDialogDestroyed&&(this._createDialogDestroyed=!0,this._createDlg.destroy())},_postBuildView:function(){this.elements.container.addClassName("confirm_dlg_webUX"),this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this.elements.container.addClassName("wux-ui-animation-flip-out"),this._parent();var t=this;if(!this.immersiveFrame)if(this.options.immersiveFrame)this.immersiveFrame=this.options.immersiveFrame;else{var s=window.document.getElementsByClassName("wux-windows-immersive-frame");if(s&&s.length)for(var r=0;!this.immersiveFrame&&r<s.length;++r)s[r]&&s[r].dsModel&&(this.immersiveFrame=s[r].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements._modalDiv&&this.elements._modalDiv.inject(window.widget.body),this.elements.mainDiv=e.createElement("div",{class:this.name+"-maindiv"}).inject(this.elements._contentDiv||this.elements.container),this.buttons={Ok:new i({label:a.get("Confirm"),onClick:function(e){t.buttons.Ok.elements.button.addClassName("loading"),t.buttons.Ok.disabled=!0,t.options.onConfirm()}}),Cancel:new i({onClick:function(e){t.hideDialog(),t.showCreateDialog()}})},this.elements.mainDiv.innerHTML="<div>Confirm?</div>",this._initEventHandlers()},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in")},showCreateDialog:function(e){!this._createDlg&&this.options._createDlg&&(this._createDlg=this.options._createDlg),this._createDlg.showDialog(e)},showDialog:function(e){this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in");var t=e&&e.confirmationMesssage?e.confirmationMesssage:"Confirm?";this.elements.mainDiv.innerHTML="<div>"+t+"</div>"},_initEventHandlers:function(){var e=this;this.addEventListener("close",function(t){e.hideDialog(),e.showCreateDialog()})}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebPointCloudAssociation/DELWebPointCloudAssociationModel",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","UWA/Promise","DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt","DS/DELWebInfrastructureControls/DELWebAjaxModel","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],function(e,t,i,a,s,r){"use strict";var n={},o=window.Configuration&&window.Configuration.webroot?window.Configuration.webroot:null,l=t.singleton({init:function(){n=s.getCacheObject()},get3DSearchString:function(){return"flattenedtaxonomies:types/R2V_FeatureOfInterest OR flattenedtaxonomies:types/R2V_FeatureState"},getPointCloudAssociationForResource:function(t){var a=this;return new i(function(i,r){if(t&&(t.physicalid||t.QueryList)){var o={};if(t.QueryList){var l=!0;if(n.point_cloud_assoc&&!t.blnForceRefresh?e.each(t.QueryList,function(e,t){return(l=t&&t.physicalid&&n.point_cloud_assoc[t.physicalid])&&(o[t.physicalid]=n.point_cloud_assoc[t.physicalid]),!!l}):l=!1,l)return void i(e.clone(o))}else if(n.point_cloud_assoc&&!t.blnForceRefresh&&n.point_cloud_assoc[t.physicalid]&&!e.Object.isEmptyObject(n.point_cloud_assoc[t.physicalid]))return o[t.physicalid]=n.point_cloud_assoc[t.physicalid],void i(e.clone(o));s.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var l={};if(t.physicalid)l.target_physicalid=t.physicalid;else if(t.QueryList){var c=[];e.each(t.QueryList,function(e,t){t&&(t.physicalid?c.push({physicalid:t.physicalid}):c.push(t))}),l.target_QueryList=JSON.stringify(c)}var u=o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation";s.callAuthenticatedRequest(u,"json","GET",l).then(function(o){if(o){var l=s.commonAjaxJsonResponseOK(o,r);if(!l)return l;n.point_cloud_assoc||(n.point_cloud_assoc={});var c=o.Data||{};s.useFixtures()&&n.point_cloud_assoc[t.physicalid]&&!t.blnForceRefresh?c[t.physicalid]=n.point_cloud_assoc[t.physicalid]:t.blnForceRefresh&&n.point_cloud_assoc[t.physicalid]&&delete n.point_cloud_assoc[t.physicalid],t.physicalid&&!n.point_cloud_assoc[t.physicalid]&&(n.point_cloud_assoc[t.physicalid]={});var u={};e.each(c,function(i,r){var o=null,l=null;s.useFixtures()&&!t.QueryList&&(i=t.physicalid),e.each(r,function(e,t){"VPMPointCloudRepReference"===t.plmObjectType?o=t:l=t}),a._cacheR2VAssociation(i,o,l),u[i]=n.point_cloud_assoc[i]}),i(e.clone(u))}else r("invalid server response")},r)}else r("invalid 3DSpace URL")},r)}else r("invalid parameters")})},createPointCloudAssociationForResource:function(t){var a=this;return new i(function(i,r){t&&(t.target_physicalid||t.targetResource)&&t["V_PointCloudIdentifier.serviceId"]&&t["V_PointCloudIdentifier.objectId"]?s.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var l=e.clone(t);t.physicalid&&!l.target_physicalid&&(l.target_physicalid=t.physicalid);var c=l.target_physicalid,u=o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation";s.callAuthenticatedRequest(u,"json","POST",l).then(function(t){if(t){var o=s.commonAjaxJsonResponseOK(t,r);if(!o)return o;n.point_cloud_assoc||(n.point_cloud_assoc={});var l=t.Data||{};c&&!n.point_cloud_assoc[c]&&(n.point_cloud_assoc[c]={});var u={},d=null,m=null;e.each(l,function(e,t){"VPMPointCloudRepReference"===t.plmObjectType?d=t:m=t}),a._cacheR2VAssociation(c,d,m),u[c]=n.point_cloud_assoc[c],s.publishEvent("PointCloudAssociation.created",Object.assign({},u)),i(e.clone(u))}else r("invalid server response")},r)}else r("invalid 3DSpace URL")},r):r("invalid parameters")})},getStateOrFOIInfoForR2VObjects:function(t){var a=this;return new i(function(i,s){var r=t.serviceId,n=t.ids;if(r&&"r2vsurvey"==r)if(n){var o={},l=[];if(t.blnForceRefresh?l=t.ids:e.each(t.ids,function(e,t){var i=a._getR2VFOIFromCache(t);if(i)o[t]=i;else{var s=a._getR2VStateFromCache(t);s?o[t]=s:l.push(t)}}),0!==l.length){var c={ids:l,serviceId:t.serviceId};a.fetchFOIInfo(c).then(function(s){if(e.each(s,function(e,t){o[e]=t;var i=l.indexOf(e);l.splice(i,1)}),0!==l.length){var r={ids:l,serviceId:t.serviceId};a.fetchLocationStateInfo(r).then(function(t){e.each(t,function(e,t){o[e]=t;var i=l.indexOf(e);l=l.splice(i,1)}),0!==l.length&&(o.ERROR="Could not find "+l.length+" object(s)"),i(e.clone(o))})}else i(e.clone(o))})}else i(e.clone(o))}else s("invalid ids");else s("invalid serviceId")})},fetchFOIInfo:function(t){var a=this;return new i(function(i,r){var n=t.serviceId,o=t.ids;if(n&&"r2vsurvey"==n)if(o){var l={};if(t.ids){var c=!0;if(t.blnForceRefresh?c=!1:e.each(t.ids,function(e,t){var i=a._getR2VFOIFromCache(t);i?l[t]=i:c=!1}),c)return void i(e.clone(l));s.getServiceUrl({serviceName:"r2vsurvey"}).then(function(n){if(n&&"string"==typeof n){var o={ids:t.ids},l=JSON.stringify(o),c=n+"/resources/r2v/v1/modeler/featureofinterest/fetch";s.callAuthenticatedRequest(c,"json","POST",l).then(function(t){if(t&&t.result){var s=t.result||[],n={};e.each(s,function(e,t){var i=a._cacheR2VFOI(t);n[i.id]=i}),i(e.clone(n))}else r("invalid server response")},r)}else r("invalid 3DSpace URL")},r)}}else r("invalid ids");else r("invalid serviceId")})},getLocationStatesForFOI:function(t){var a=this;return new i(function(i,r){var n=t.serviceId,o=t.id;if(n&&"r2vsurvey"==n)if(o){if(t.id){if(!t.blnForceRefresh){var l=a._getStatesForFOIFromCache(t.id);if(!e.Object.isEmptyObject(l))return void i(e.clone(l))}s.getServiceUrl({serviceName:"r2vsurvey"}).then(function(n){if(n&&"string"==typeof n){var o={},l=n+"/resources/r2v/v1/modeler/featureofinterest/"+t.id+"/featurestates";s.useFixtures()&&(l=n+"/resources/r2v/v1/modeler/featureofinterest/id/featurestates",o.id=t.id),s.callAuthenticatedRequest(l,"json","GET",o).then(function(s){if(s&&s.result){var n=s.result||[],o={};e.each(n,function(e,i){var s=a._cacheFOIStates(t.id,i);o[s.id]=s}),i(e.clone(o))}else r("invalid server response")},r)}else r("invalid 3DSpace URL")},r)}}else r("invalid id");else r("invalid serviceId")})},fetchLocationStateInfo:function(t){var a=this;return new i(function(i,r){var n=t.serviceId,o=t.ids;if(n&&"r2vsurvey"==n)if(o){var l={};if(t.ids){var c=!0;if(t.blnForceRefresh?c=!1:e.each(t.ids,function(e,t){var i=a._getR2VStateFromCache(t);i?l[t]=i:c=!1}),c)return void i(e.clone(l));s.getServiceUrl({serviceName:"r2vsurvey"}).then(function(n){if(n&&"string"==typeof n){var o={ids:t.ids},l=JSON.stringify(o),c=n+"/resources/r2v/v1/modeler/featurestate/fetch";s.callAuthenticatedRequest(c,"json","POST",l).then(function(t){if(t&&t.result){var s=t.result,n={};e.each(s,function(e,t){var i=a._cacheR2VState(t);n[i.id]=i}),i(e.clone(n))}else r("invalid server response")},r)}else r("invalid 3DSpace URL")},r)}}else r("invalid ids");else r("invalid serviceId")})},updatePointCloudAssociationForResource:function(t){var a=this;return new i(function(i,r){t&&(t.repReference_physicalid||t.RepReference)&&t["V_PointCloudIdentifier.serviceId"]&&t["V_PointCloudIdentifier.objectId"]?s.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var l=e.clone(t);t.physicalid&&!l.repReference_physicalid&&(l.repReference_physicalid=t.physicalid);var c=t.target_physicalid,u=o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation";s.callAuthenticatedRequest(u,"json","PATCH",l).then(function(t){if(t){var o=s.commonAjaxJsonResponseOK(t,r);if(!o)return o;var l=t.Data||{};n.point_cloud_assoc||(n.point_cloud_assoc={});var u={};e.each(l,function(e,t){if(n.point_cloud_assoc[c]){var i=n.point_cloud_assoc[c],s=i.repReference,r=Object.assign(s,t);c&&a._cacheR2VAssociation(c,r,i.repInstance),u[c]=n.point_cloud_assoc[c]}}),s.publishEvent("PointCloudAssociation.updated",Object.assign({},u)),i(e.clone(u))}else r("invalid server response")},r)}else r("invalid 3DSpace URL")},r):r("invalid parameters")})},deletePointCloudAssociationForResource:function(t){return new i(function(i,a){t&&(t.target_physicalid||t.targetResource)?s.getServiceUrl({serviceName:"3DSpace"}).then(function(r){if(r&&"string"==typeof r){var o=e.clone(t),l=t.target_physicalid||t.targetResource.physicalid,c=r+"/resources/DELWebInfrastructureLite/v0/R2VAssociation";s.callAuthenticatedRequest(c,"json","DELETE",o).then(function(t){if(t){var r=s.commonAjaxJsonResponseOK(t,a);if(!r)return r;var o=t.Data||{},c=[],u=o.SuccessfullyDeleted||{},d=o.FailedDelete||{},m=o.TargetReferenceWithNothingToRemove||{},p=o.RepReferenceAlreadyRemoved||{},h=!1;if(!e.Object.isEmptyObject(m)||!e.Object.isEmptyObject(p)){var f={};e.Object.isEmptyObject(m)||f.put("NoAssociationsToDeleteResource",m),e.Object.isEmptyObject(p)||f.put("NoAssociationsToDeleteRepRef",p),c.push({event:"PointCloudAssociation.deleted.error",data:f}),h=!0}if(!e.Object.isEmptyObject(d)){f={};e.Object.isEmptyObject(d)||f.put("FailedDelete",d),c.push({event:"PointCloudAssociation.deleted.error",data:f}),h=!0}if(!e.Object.isEmptyObject(u)){n.point_cloud_assoc||(n.point_cloud_assoc={}),l&&n.point_cloud_assoc[l]&&delete n.point_cloud_assoc[l];var g={};g[l]=e.clone(u),c.push({event:"PointCloudAssociation.deleted",data:g})}e.each(c,function(e,t){s.publishEvent(t.event,t.data)}),h?a(e.clone(o)):i(e.clone(o))}else a("invalid server response")},a)}else a("invalid 3DSpace URL")},a):a("invalid parameters")})},_cacheR2VAssociation:function(t,i,a){n.point_cloud_assoc||(n.point_cloud_assoc={});var s={};i&&(s.repReference=e.clone(i)),a&&(s.repInstance=e.clone(a)),n.point_cloud_assoc[t]=s},_cacheFOIStates:function(t,i){var a=this._cacheR2VState(i);return n.r2v_foi_state_assoc||(n.r2v_foi_state_assoc={}),n.r2v_foi_state_assoc[t]||(n.r2v_foi_state_assoc[t]=[]),n.r2v_foi_state_assoc[t].push(a.id),e.clone(a)},_getStatesForFOIFromCache:function(t){var i=this;if(!n.r2v_foi_state_assoc||!n.r2v_foi_state_assoc[t]||!n.r2v_State)return null;var a=n.r2v_foi_state_assoc[t],s={};return e.each(a,function(e,t){s[t]=i._getR2VStateFromCache(t)}),s},_cacheR2VFOI:function(t){n.r2v_FOI||(n.r2v_FOI={});var i=e.clone(t);return!i.id&&i.resourceid&&(i.id=i.resourceid),!i.name&&i["ds6w:label"]&&(i.name=i["ds6w:label"]),!i.description&&i.grid["ds6w:description"]&&(i.description=i.grid["ds6w:description"]),n.r2v_FOI[i.id]=e.clone(i),e.clone(i)},_getR2VFOIFromCache:function(e){return n.r2v_FOI&&n.r2v_FOI[e]?n.r2v_FOI[e]:null},_cacheR2VState:function(t){n.r2v_State||(n.r2v_State={});var i=e.clone(t);return!i.id&&i.resourceid&&(i.id=i.resourceid),!i.name&&i["ds6w:label"]&&(i.name=i["ds6w:label"]),!i.description&&i.grid["ds6w:description"]&&(i.description=i.grid["ds6w:description"]),n.r2v_State[i.id]=e.clone(i),e.clone(i)},_getR2VStateFromCache:function(e){return n.r2v_State&&n.r2v_State[e]?n.r2v_State[e]:null},searchForPointCloudData:function(t){var a=this;return new i(function(i,r){t?s.getServiceUrl({serviceName:"3DSearch"}).then(function(n){if(n&&"string"==typeof n){var o="("+a.get3DSearchString()+")";(t.search_str||t.name)&&"*"!==(t.search_str||t.name)&&(o+=" AND ("+(t.search_str||t.name)+")"),!t.tenant&&window.widget.data&&(t.tenant=window.widget.data.x3dPlatformId);var l={query:o,label:Foe.Model.Session.get("user")+"-DELWebPointCloudAssociationModel.searchForPointCloudData-"+(new Date).getTime(),locale:window.widget.lang,tenant:t.platformId||t.tenant,source:["3dspace","r2vsurvey"],select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6wg:revision","ds6w:status","ds6w:responsible","owner","ds6w:responsibleUid","ds6wg:filesize","ds6w:project","ds6w:dataSource","ds6w:community","ds6w:repository","dcterms:title","dcterms:description","ds6w:containerUid"],with_synthesis:!1,with_synthesis_attribute:!1};t.endindex&&(l.nresults="startindex"in t?t.endindex-t.startindex:t.endindex),l=window.UWA.Json.encode(l);var c=n+"/search";s.useFixtures()&&(c+="?getPointCloudSearch"),Fam.Model.Platform.callAuthenticatedRequest(c,function(t){var a={},s=[];if(t&&t.results&&t.results.length){e.each(t.results,function(e,t){var i=Fam.Model.Platform.convertToModelObj(t.attributes);!i.id&&i.resourceid&&(i.id=i.resourceid),!i.name&&i["ds6w:label"]&&(i.name=i["ds6w:label"]),a[i.id]=i}),s=Object.values(a)}i(s)},function(e){r(e)},"json","POST",l,function(e){r(e)})}else r("invalid 3DSearch URL")}):r("Invalid input parameters!")})}});if(s.useFixtures()){window.Configuration.fixtureDelay&&(window.can.fixture.delay=window.Configuration.fixtureDelay),window.can.fixture({type:"GET",url:o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/getPointCloudAssociation.json",function(a){var s={Data:{}},r=null;t&&t.data&&t.data.target_QueryList?(e.each(a.Data,function(e,t){r=t}),e.each(JSON.parse(t.data.target_QueryList),function(e,t){s.Data[t.physicalid]={},1===e&&(s.Data[t.physicalid]=r)}),a.Data=s.Data):t&&t.data&&t.data.target_physicalid&&e.each(a.Data,function(e,t){a.Data[e]={}}),i.responseText=JSON.stringify(a),t.complete(i,i.statusText)})}),window.can.fixture({type:"POST",url:o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation"},function(e){var t=window.$.get("../DELWebInfrastructureUI.tst/fixtures/createPointCloudAssociation.json",function(i){var a=JSON.stringify(i);a=(a=a.replaceAll("265E9656963D170063A09798001076C9",e.data.target_physicalid)).replaceAll("objectIdToReplace",e.data["V_PointCloudIdentifier.objectId"]),"V_Name"in e.data&&(a=a.replaceAll("VPMPointCloudRepReference00000001",e.data.V_Name)),"V_description"in e.data&&(a=a.replaceAll("testDescription",e.data.V_description)),t.responseText=a,e.complete(t,t.statusText)})}),window.can.fixture({type:"PATCH",url:o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation"},function(e){var t=window.$.get("../DELWebInfrastructureUI.tst/fixtures/updatePointCloudAssociation.json",function(i){var a=JSON.stringify(i);a=a.replaceAll("95E49656AB863C0063D1BE00001A0EF9",e.data.repReference_physicalid),"V_Name"in e.data&&(a=a.replaceAll("testName2",e.data.V_Name)),"V_description"in e.data&&(a=a.replaceAll("testDescription2",e.data.V_description)),"V_PointCloudIdentifier.objectId"in e.data&&(a=a.replaceAll("objectId2",e.data["V_PointCloudIdentifier.objectId"])),"V_PointCloudIdentifier.serviceId"in e.data&&(a=a.replaceAll("serviceId2",e.data["V_PointCloudIdentifier.serviceId"])),t.responseText=a,e.complete(t,t.statusText)})}),window.can.fixture({type:"DELETE",url:o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation"},function(e){var t=window.$.get("../DELWebInfrastructureUI.tst/fixtures/deletePointCloudAssociation.json",function(i){var a=JSON.stringify(i);a=a.replaceAll("95E49656AB863C0063D1BE00001A0EF9",e.data.repReference_physicalid),t.responseText=a,e.complete(t,t.statusText)})}),window.can.fixture({type:"POST",url:o+"/enovia/resources/r2v/v1/modeler/featurestate/fetch"},function(e){var t=window.$.get("../DELWebInfrastructureUI.tst/fixtures/fetchFeatureStates.json",function(i){t.responseText=JSON.stringify(i),e.complete(t,t.statusText)})}),window.can.fixture({type:"POST",url:o+"/enovia/resources/r2v/v1/modeler/featureofinterest/fetch"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/fetchFeatureOfInterest.json",function(a){var s=[],r=JSON.parse(t.data).ids;e.each(r,function(t,i){e.each(a.result,function(e,t){t.resourceid===i&&s.push(t)})}),a.result=s,i.responseText=JSON.stringify(a),t.complete(i,i.statusText)})}),window.can.fixture({type:"GET",url:o+"/enovia/resources/r2v/v1/modeler/featureofinterest/id/featurestates"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/fetchFeatureStates.json",function(a){var s=[];e.each(a.result,function(e,i){i.featureOfInterestId===t.data.id&&s.push(i)}),a.result=s,i.responseText=JSON.stringify(a),t.complete(i,i.statusText)})}),window.can.fixture({type:"POST",url:o.substr(0,o.lastIndexOf("/"))+"/federated/search?getPointCloudSearch"},function(e){var t=window.$.get("../DELWebInfrastructureUI.tst/fixtures/getPointCloudSearchData.json",function(i){t.responseText=JSON.stringify(i),e.complete(t,t.statusText)})})}return l}),window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterPrefDialog",["DS/DELWebInfrastructureControls/UWAUtils","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/Popup","DS/Controls/Toggle","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/Tree/TreeNodeModel","DS/CollectionView/CollectionViewStatusBar","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i,a,s,r,n,o,l,c,u,d,m,p,h,f,g,v){"use strict";return a.inherit({name:"DELWebResourceParameterPrefDialog",_defaultMagnitudes:null,_unitsDropdown:{},_changedAttributesObj:null,_dimensionList:null,publishedProperties:{title:{defaultValue:g.get("Magnitude Preferences"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max(window.widget.body.clientWidth/2,530),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:Math.max(window.widget.body.clientHeight/2,900),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:330,defaultTouchValue:330,advancedSetter:!0,type:"integer",category:"Appearance"},minHeight:{defaultValue:160,defaultTouchValue:160,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(e){e?this.options=Object.assign(this.options||{},e):this.options||(this.options={}),this._parent.apply(this,arguments)},destroy:function(){var e=this._createDlg||this.options&&this.options._createDlg;delete this._createDlg,this.options&&delete this.options._createDlg,this._parent.apply(this,arguments),e&&e.destroy&&e.destroy()},_postBuildView:function(){this._parent();var t=this;if(!this.immersiveFrame)if(this.options.immersiveFrame)this.immersiveFrame=this.options.immersiveFrame;else{var i=window.document.getElementsByClassName("wux-windows-immersive-frame");if(i&&i.length)for(var a=0;!this.immersiveFrame&&a<i.length;++a)i[a]&&i[a].dsModel&&(this.immersiveFrame=i[a].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements._modalDiv&&this.elements._modalDiv.inject(window.widget.body),this.elements.mainDiv=e.createElement("div",{class:this.name+"-maindiv"}).inject(this.elements._contentDiv||this.elements.container),this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this._createDlg||this.options._createDlg?this.elements.container.addClassName("wux-ui-animation-flip-out"):this.elements.container.addClassName("wux-ui-animation-flip-in"),this.buttons={Ok:new s({label:g.get("Apply"),onClick:function(e){t.applyClicked(e)}}),Save:new s({label:g.get("Done"),onClick:function(e){t.doneClicked(e)}}),Cancel:new s({onClick:function(e){t.hideDialog();t.showCreateDialog({blnForceRefresh:!0})}})},this.buttons.Ok.emphasize="secondary",this.elements.mainDiv.innerHTML='<div class="preferencesDlgDiv"><table><tr class="default_magnitudes mainRow"><td> Default Magnitudes </td><td class="inputField"><table><tbody><tr><td><select class="defaultMagnitudesList" name="defaultMagnitudesList" size="5" style="width:15em;"></select></td></tr><tr class="icon_toolbar"><td><div><div class="opt_DefaultMagnitudes"></div><div class="opt_DefaultMagnitudes_icons"><div style="padding-left:10px;" class="add_default_magnitude_icon"></div><div class="delete_default_magnitude_icon" style="padding-left:10px;"></div></div></div></td></tr></tbody></table></td></tr><tr class="mainRow default_unit_title"><td colspan="2" style="position:relative;">'+g.get("Default Units")+'</td></tr><tr class="default_units mainRow"><td class="inputField" colspan="2"><table><tbody class="display_units_body" colspan="2"></tbody></table></td></tr></table></div>',this._addDefaultMagnitudeIcon=new s({type:"button",allowUnsafeHTMLLabel:!0,displayStyle:"lite",disabled:!0,icon:{iconName:"plus",fontIconFamily:window.WUXManagedFontIcons.Font3DS}}).inject(this.elements.mainDiv.querySelector(".add_default_magnitude_icon")),this._deleteDefaultMagnitude=new s({type:"button",allowUnsafeHTMLLabel:!0,displayStyle:"lite",disabled:!0,icon:{iconName:"minus",fontIconFamily:window.WUXManagedFontIcons.Font3DS}}).inject(this.elements.mainDiv.querySelector(".delete_default_magnitude_icon")),this._addDefaultMagnitudeIcon.getContent().addEventListener("buttonclick",function(e){t.onAddMagnitude(e)}),this._deleteDefaultMagnitude.getContent().addEventListener("buttonclick",function(e){t.onDeleteMagnitude(e)}),this._addDefaultMagnitudesElements(),this._addDefaultUnitsTable(),this._initEventHandlers()},_addDefaultMagnitudesElements:function(){var t=this,a=e.extendElement(t.elements.mainDiv.querySelector("tr select.defaultMagnitudesList"));a.addClassName("loading"),i.getDefaultMagnitudes({blnForceRefresh:!0}).then(function(i){i||(i.INTEGER={Name:"Integer",NLS:g.get("Integer")},i.STRING={Name:"String",NLS:g.get("Text")}),i=Object.keys(i).sort().reduce(function(e,t){return e[t]=i[t],e},{}),t._defaultMagnitudes=i,e.each(i,function(e,t){a.options[a.options.length]=new Option(t.NLS,t.Name)}),e.extendElement(a).removeClassName("loading")},function(e){t._displayNotificationMessage(e)}),t.elements.mainDiv.querySelector("select.defaultMagnitudesList").addEventListener("change",function(e){var i=e.target.value;t._deleteDefaultMagnitude.disabled=!i})},onAddMagnitude:function(t){this._changedAttributesObj||(this._changedAttributesObj={});var i=this.elements._optionalMagnitudesDropdown.currentValue,a=this.elements._optionalMagnitudesDropdown.currentLabel;this._changedAttributesObj.preference_DimensionsList=this._defaultMagnitudes,this._dimensionList=this.elements._optionalMagnitudesDropdown.currentValue.trim().replaceAll("_","")+"Parameter";var s=e.extendElement(this.elements.mainDiv.querySelector(".defaultMagnitudesList"));if(this._changedAttributesObj.preference_DimensionsList&&!this._changedAttributesObj.preference_DimensionsList[i]){this._changedAttributesObj.preference_DimensionsList[i]={};var r=e.createElement("option");r.value=i,r.innerHTML=a,s.appendChild(r)}if(this.elements._optionalMagnitudesDropdown){var n=this.elements._optionalMagnitudesDropdown.elementsList,o=this._getSelectedIndex(i,n);n&&n.splice(o,1),n=n.sort(function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0}),this.elements._optionalMagnitudesDropdown&&this.elements._optionalMagnitudesDropdown.elements&&this.elements._optionalMagnitudesDropdown.elements&&(this.blnPreventSelectedIndexUpdate=!0,this.elements._optionalMagnitudesDropdown.elementsList=[],this.elements._optionalMagnitudesDropdown.placeholder=" --- "+g.get("Select")+" --- ",this.elements._optionalMagnitudesDropdown.selectedIndex=-1,this.elements._optionalMagnitudesDropdown.elementsList=n,this.blnPreventSelectedIndexUpdate=!1,this._addDefaultMagnitudeIcon.disabled=!0)}},onDeleteMagnitude:function(t){this._changedAttributesObj||(this._changedAttributesObj={});var i=e.extendElement(this.elements.mainDiv.querySelector(".defaultMagnitudesList"));if(1!==i.length){this._changedAttributesObj.preference_DimensionsList=this._defaultMagnitudes;var a=i.options[i.selectedIndex];if(a)for(var s=0;s<i.length;s++)i.options[s].value===a.value&&this._changedAttributesObj.preference_DimensionsList&&(this._deleteDefaultMagnitude.disabled=!1,delete this._changedAttributesObj.preference_DimensionsList[i.options[s].value],i.options[s].remove());if(this.elements._optionalMagnitudesDropdown){var r=this.elements._optionalMagnitudesDropdown.elementsList;this._getSelectedIndex(a.value,r)||r.push({labelItem:a.label,valueItem:a.value}),r=r.sort(function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0}),this.elements._optionalMagnitudesDropdown&&this.elements._optionalMagnitudesDropdown.elements&&this.elements._optionalMagnitudesDropdown.elements&&(this.blnPreventSelectedIndexUpdate=!0,this.elements._optionalMagnitudesDropdown.elementsList=[],this.elements._optionalMagnitudesDropdown.placeholder=" --- "+g.get("Select")+" --- ",this.elements._optionalMagnitudesDropdown.selectedIndex=-1,this.elements._optionalMagnitudesDropdown.elementsList=r,this.blnPreventSelectedIndexUpdate=!1,this._deleteDefaultMagnitude.disabled=!0)}}},_addDefaultUnitsTable:function(){var t=this,a=e.extendElement(t.elements.mainDiv.querySelector("tr table .display_units_body"));a.addClassName("loading");var s=e.extendElement(t.elements.mainDiv.querySelector("table tr .opt_DefaultMagnitudes"));i.getMagnitudes({blnForceRefresh:this.options.blnForceRefresh||!1}).then(function(r){i.getDefaultMagnitudes({blnForceRefresh:!0}).then(function(n){var u,d=[];t.elements._unitsDropdown={},(r=Object.keys(r).sort().reduce(function(e,t){return e[t]=r[t],e},{}))&&!r.INTEGER&&d.push({labelItem:g.get("Integer"),valueItem:"Integer"}),r&&!r.STRING&&d.push({labelItem:g.get("Text"),valueItem:"String"}),e.each(r,function(s,r){if(r&&r.Name&&r.NLS&&!n[r.Name]){var c={labelItem:r.NLS,valueItem:r.Name};d.push(c)}var u=a.insertRow(-1);u.classList.add("magnitudeLabelRow"),u.classList.add(r.Name+"Parameter");var m=e.createElement("td");(m=u.insertCell()).className="unitsLabel",m.innerHTML=r.NLS;var p=e.createElement("td");p=u.insertCell();var h=e.createElement("div");h.className="unitsDropdown",p.appendChild(h);var f=null,g=[];r.Units&&e.each(r.Units,function(e,t){if(t&&t.label&&t.NLSName){var i={labelItem:t.NLSName,valueItem:t.label};t&&t.default&&!0===t.default&&(i.default=!0),g.push(i)}}),(g=g.sort(function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0}))&&(f=null,e.each(g,function(e,t){return t.default&&!0===t.default&&(f=e),null===f}));var v={elementsList:g,popupSizeAdjustPolicy:l.SizeAdjustPolicyEnum.AdjustToVisibleContents,enableSearchFlag:!1,selectedIndex:f,actionOnClickFlag:!1};if(t.options.resourceParameter&&t.options.resourceParameter.units&&(v.currentValue=t.options.resourceParameter.units),g.length>1){t.elements._unitsDropdown[r.Name+"Parameter"]=new o(v).inject(h),t.elements._unitsDropdown[r.Name+"Parameter"].disabled=g.length>1,t.elements._unitsDropdown[r.Name+"Parameter"].getContent().addClassName("loading"),t.elements._unitsDropdown[r.Name+"Parameter"].name=r.Name,t.elements._unitsDropdown[r.Name+"Parameter"].getContent().addEventListener("change",function(e){t.onUnitsDropdownChange(e)});var _={magnitude:r.Name};i.getMagnitudeUnits(_).then(function(i){i&&e.each(i,function(e,i){i&&i.default&&!0===i.default?(t.elements._unitsDropdown[r.Name+"Parameter"].value=i.label,t.elements._unitsDropdown[r.Name+"Parameter"].disabled=!1):i&&!i.default&&(t.elements._unitsDropdown[r.Name+"Parameter"].disabled=!1)})})}else 1===g.length&&h.setText(g[0].labelItem)}),d=d.sort(function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0}),u={popupSizeAdjustPolicy:l.SizeAdjustPolicyEnum.AdjustToVisibleContents,elementsList:d,placeholder:" --- "+g.get("Select")+" --- ",selectedIndex:-1,enableSearchFlag:!0,actionOnClickFlag:!1},t.elements._optionalMagnitudesDropdown=new o(u).inject(s),t.elements._optionalMagnitudesDropdown.getContent().addEventListener("change",function(e){null!==t.elements._optionalMagnitudesDropdown.currentValue?t._addDefaultMagnitudeIcon.disabled=!1:t._addDefaultMagnitudeIcon.disabled=!0}),t.elements._optionalMagnitudesDropdown.addEventListener("show",function(i){if(i&&i.dsModel&&i.dsModel.elements&&i.dsModel.elements.treeListView&&i.dsModel.elements.treeListView.getRoots){var s=function(){var r=t.elements.mainDiv.querySelector("tr.default_unit_title td .wux-controls-toggle"),n=!1,o=[];if(i.dsModel.elements.popup&&i.dsModel.elements.popup.visibleFlag?o=i.dsModel.elements.treeListView.getRoots():i.dsModel._allDescendants&&(o=i.dsModel._allDescendants),e.each(o,function(e,t){if(t&&t.options&&t.options.grid&&t.options.grid.valueItem){var i=a.querySelector("tr.magnitudeLabelRow."+t.options.grid.valueItem+"Parameter");i&&(r&&r.dsModel&&r.dsModel.checkFlag?i.hidden=!1:(i.hidden=t.isHidden(),n=n||i.hidden))}}),n)if(r)r.dsModel&&r.dsModel.show();else{var l=new c({label:g.get("Show All")}).inject(t.elements.mainDiv.querySelector("tr.default_unit_title td"));(r=l.elements.container).setStyle("position","absolute").setStyle("right","1em").setStyle("bottom","0"),l.addEventListener("change",function(e){s()})}else r&&r.dsModel&&r.dsModel.checkFlag&&r.dsModel.show()};s()}}),e.extendElement(a).removeClassName("loading")})},function(e){t._displayNotificationMessage(e)})},_getSelectedIndex:function(e,t){var i=null,a=this.elements._optionalMagnitudesDropdown;return a&&a.elementsList&&$.each(a.elementsList,function(t,a){a.valueItem===e&&(i=t)}),i},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in")},showCreateDialog:function(e){!this._createDlg&&this.options._createDlg&&(this._createDlg=this.options._createDlg),this._createDlg||((e=Object.assign(e||{},this.options))._prefDialog||(e._prefDialog=this),this._createDlg=new DELWebResourceParameterDlg(e)),this._createDlg.showDialog(e)},showDialog:function(){this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in")},onUnitsDropdownChange:function(e){if(this._changedAttributesObj||(this._changedAttributesObj={}),e.target.hasClassName("loading"))e.target.removeClassName("loading");else{var t=e.target.dsModel,i=t.name+"Parameter",a=t.value,s=t.label;i&&a&&(this._changedAttributesObj.preference_DisplayUnits||(this._changedAttributesObj.preference_DisplayUnits={}),this._changedAttributesObj.preference_DisplayUnits[i]={},this._changedAttributesObj.preference_DisplayUnits[i].currentUnitValue=a,this._changedAttributesObj.preference_DisplayUnits[i].currentUnitLabel=s)}},applyClicked:function(t){var a=this,s={};if(a._changedAttributesObj&&(!a._changedAttributesObj||a._changedAttributesObj.preference_DimensionsList||a._changedAttributesObj.preference_DisplayUnits)){if(a._changedAttributesObj.preference_DimensionsList){for(var r=Object.keys(a._changedAttributesObj.preference_DimensionsList),n="",o=0;o<r.length;o++)n+=r[o]+"Parameter;";s.dimensionList=n}if(a._changedAttributesObj.preference_DisplayUnits){var l="";e.each(a._changedAttributesObj.preference_DisplayUnits,function(e,t){l+=e+":"+t.currentUnitValue+","}),s.defaultUnits=l}a.enableDisableButtons(!1),s&&s.dimensionList&&i.updateDefaultMagnitudes(s).then(function(){a._displayNotificationMessage(g.get("Updated Default Magnitudes"),{level:"success"}),a.enableDisableButtons(!0),a._changedAttributesObj={}},function(e){e||(e=g.get("Error")),a._displayNotificationMessage(e)}),s&&s.defaultUnits&&i.updateMagnitudeUnits(s).then(function(){a._displayNotificationMessage(g.get("Updated Magnitude Units"),{level:"success"}),a.enableDisableButtons(!0),a._changedAttributesObj={}},function(e){a.enableDisableButtons(!0),e||(e=g.get("Error")),a._displayNotificationMessage(e)})}},doneClicked:function(t){var a=this;if(!a._changedAttributesObj)return a.hideDialog(),t.blnForceRefresh=!0,void a.showCreateDialog(t);if(a._changedAttributesObj&&!a._changedAttributesObj.preference_DimensionsList&&!a._changedAttributesObj.preference_DisplayUnits)return a.hideDialog(),t.blnForceRefresh=!0,void a.showCreateDialog(t);if(t={},a._changedAttributesObj.preference_DimensionsList){for(var s=Object.keys(a._changedAttributesObj.preference_DimensionsList),r="",n=0;n<s.length;n++)r+=s[n]+"Parameter;";t.dimensionList=r}if(a._changedAttributesObj.preference_DisplayUnits){var o="";e.each(a._changedAttributesObj.preference_DisplayUnits,function(e,t){o+=e+":"+t.currentUnitValue+","}),t.defaultUnits=o}a.enableDisableButtons(!1),t&&t.dimensionList&&i.updateDefaultMagnitudes(t).then(function(){a._displayNotificationMessage(g.get("Updated Default Magnitudes"),{level:"success"}),a.enableDisableButtons(!0),a._changedAttributesObj={},a.hideDialog(),t.blnForceRefresh=!0,a.showCreateDialog(t)},function(e){a.enableDisableButtons(!0),e||(e=g.get("Error")),a._displayNotificationMessage(e)}),t&&t.defaultUnits&&i.updateMagnitudeUnits(t).then(function(){a._displayNotificationMessage(g.get("Updated Magnitude Units"),{level:"success"}),a.enableDisableButtons(!0),a._changedAttributesObj={},a.hideDialog(),t.blnForceRefresh=!0,a.showCreateDialog(t)},function(e){a.enableDisableButtons(!0),e||(e=g.get("Error")),a._displayNotificationMessage(e)})},_initEventHandlers:function(){var e=this;this.addEventListener("close",function(t){e.destroy()})},enableDisableButtons:function(e){if(this.buttons)for(var t in this.buttons){if("Cancel"!==t)this.buttons[t].disabled=!e}},_displayNotificationMessage:function(t,i){f._getNotificationManager||(f._getNotificationManager=f.getNotificationManager,f.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),f.getNotificationManager()||f._manager||(f.setNotificationManager(h),f.setRemoveStackOnFirstTimeoutFlag(!0),f.setStackingPolicy(31)),i||(i={}),i.message||(i.message=t),i.level||(i.level="error"),"subtitle"in i||(i.subtitle=""),"sticky"in i||(i.sticky=!1),"category"in i||(i.category=(t||"").toString()),"title"in i||(i.title=g.get(e.String.capitalize(i.level.toLowerCase()))),h.addNotif(i)}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListAssocDlg",["DS/DELWebInfrastructureControls/UWAUtils","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/DELWebInfrastructureControls/DELWebSearchUtils","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/Popup","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/Tree/TreeNodeModel","DS/CollectionView/CollectionViewStatusBar","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i,a,s,r,n,o,l,c,u,d,m,p,h,f,g,v){"use strict";return s.inherit({name:"DELWebResourceParameterListAssocDlg",publishedProperties:{title:{defaultValue:g.get("Associate Existing {0}").replace("{0}",g.get("Resource Parameter List")),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max(window.widget.body.clientWidth/2,330),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:Math.max(window.widget.body.clientHeight/5,200),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:330,defaultTouchValue:330,advancedSetter:!0,type:"integer",category:"Appearance"},minHeight:{defaultValue:160,defaultTouchValue:160,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(e){e?this.options=Object.assign(this.options||{},e):this.options||(this.options={}),this._parent.apply(this,arguments)},destroy:function(){var e=this._createDlg||this.options&&this.options._createDlg;delete this._createDlg,this.options&&(delete this.options._createDlg,this.options._dndResultsDraggingStart&&window.OpenAjax.hub.unsubscribe(this.options._dndResultsDraggingStart),this.options._dndResultsDraggingStop&&window.OpenAjax.hub.unsubscribe(this.options._dndResultsDraggingStop)),this._parent.apply(this,arguments),e&&e.destroy&&e.destroy()},_postBuildView:function(){this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this._createDlg||this.options._createDlg?this.elements.container.addClassName("wux-ui-animation-flip-out"):this.elements.container.addClassName("wux-ui-animation-flip-in"),this._parent();var t=this;if(!this.immersiveFrame)if(this.options.immersiveFrame)this.immersiveFrame=this.options.immersiveFrame;else{var i=window.document.getElementsByClassName("wux-windows-immersive-frame");if(i&&i.length)for(var a=0;!this.immersiveFrame&&a<i.length;++a)i[a]&&i[a].dsModel&&(this.immersiveFrame=i[a].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements._modalDiv&&this.elements._modalDiv.inject(window.widget.body),this.elements.mainDiv=e.createElement("div",{class:this.name+"-maindiv"}).inject(this.elements._contentDiv||this.elements.container),this.buttons={Ok:new r({label:g.get("Create New"),onClick:function(e){t.onCreateNew()}}),Save:new r({disabled:!0,onClick:function(e){t.onSave()}}),Cancel:new r({onClick:function(e){t.visibleFlag=!1,t.destroy()}})},this.buttons.Ok.emphasize="secondary",this.buttons.Ok.elements.button.setStyles({position:"absolute",left:"20px"}),this.elements.mainDiv.innerHTML='<div class="assoc_type"><table><tr><th>'+g.get("Filter on {0}").replace("{0}",g.get("Resource Type"))+'</th><td><div class="assoc_type_val loading"></div></td><td><div class="assoc_type_loading_icon"></div></td></tr></table></div><div class="assoc_header"><span class="assoc_title">'+g.get("Resource Parameter Lists in Factory")+'</span><span class="assoc_help wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-help"></span><span class="assoc_refresh wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-refresh"></span><span class="assoc_search"><span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-drag-drop"></span> '+g.get("Drag from 3DSearch to add Resource Parameter Lists")+'</span></div><div class="assoc_table loading"></div>',this._addResourceDropDown(),this._addExistingResourceParamListTable(),this._initEventHandlers()},_addResourceDropDown:function(){var a=this;t.getServiceUrl({serviceName:"3DSpace"}).then(function(s){t.getResourceDisciplines({blnCachedOk:!0,addAdditionalDisciplines:!0}).then(function(t){var r=t.Resource;t.AdditionalDisciplines&&e.each(t.AdditionalDisciplines,function(e,t){r.push(t)});var n=[{labelItem:g.get("All"),valueItem:""}];e.each(r,function(e,t){if("Pool"!==t.name&&!t.isOOTB||t.Newable&&(t.Newable.toUpperCase().contains("NEW")||t.Newable.toUpperCase().contains("ALL"))){var i=null;window.Foe&&window.Foe.Model&&window.Foe.Model.Asset&&(i=Foe.Model.Asset._getInterfaceIconPath(t)),i||(i=s+"/webapps/"+t.IconPath),n.push({labelItem:t.nlsName,valueItem:t.disciplineName||t.name,iconItem:i})}}),n=n.sort(function(e,t){return e&&t?"__OTHER__"!==e.valueItem&&t.valueItem?"__OTHER__"!==t.valueItem&&e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0}),a.elements._disciplineDropdown=new l({elementsList:n,enableSearchFlag:!1,actionOnClickFlag:!1});var o=a.elements.mainDiv.getElementsByClassName("assoc_type_val");if(o&&1===o.length&&(o=o[0]),a.elements._disciplineDropdown.inject(o),a.elements._disciplineDropdown.getContent().addEventListener("change",function(e){a.onDisciplineDropdownChange(e)}),a.options.resource){var c=Object.assign({Minimum:["V_discipline"]},a.options.resource);i.getOneResource(c).then(function(e){e&&e.V_discipline&&("ResourceArea"===e.V_discipline?a.elements._disciplineDropdown.value="Area":"ErgoHuman"===e.V_discipline?a.elements._disciplineDropdown.value="Worker":a.elements._disciplineDropdown.value=e.V_discipline)})}e.extendElement(o).removeClassName("loading")},function(e){a._displayNotificationMessage(e)})},function(e){a._displayNotificationMessage(e)})},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in")},showDialog:function(){this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in")},showCreateDialog:function(e){!this._createDlg&&this.options._createDlg&&(this._createDlg=this.options._createDlg),this._createDlg||((e=Object.assign(e||{},this.options))._assocDlg||(e._assocDlg=this),this._createDlg=new DELWebResourceParameterListDlg(e)),this._createDlg.showDialog(e)},onCreateNew:function(){this.hideDialog(),this.showCreateDialog()},onSave:function(){var t=this;if(this.options&&this.options.resource&&this.options.resource.physicalid)if(this.elements._uwaTree&&!this.elements._uwaTree.getNodesXSO().isEmpty()){var a=[];e.each(this.elements._uwaTree.getNodesXSO().get(),function(e,t){t&&t.dsModel&&t.dsModel.physicalid&&a.push({physicalid:t.dsModel.physicalid})}),i.associateResourceParameterList({resource:this.options.resource,resourceParameterList:{QueryList:a}}).then(function(e){var i=g.get("Resource Parameter List");e&&1===e.length&&e[0].resourceParameterList&&e[0].resourceParameterList.V_Name?i=e[0].resourceParameterList.V_Name:e&&e.length>1&&(i=g.get("Resource Parameter Lists")),t._displayNotificationMessage(g.get("{0} Associated").replace("{0}",i),{level:"success"}),t.destroy()},function(e){t._displayNotificationMessage(e)})}else this._displayNotificationMessage(g.get("No {0}").replace("{0}",g.get("Resource Parameter Lists")));else this._displayNotificationMessage(g.get("No {0}").replace("{0}",g.get("Resource")))},onSelectChanged:function(){this.buttons.Save.disabled=!this.elements._uwaTree||this.elements._uwaTree.getNodesXSO().isEmpty(),this.buttons.Save.disabled||!this.elements._uwaTree||this.elements._uwaTree.elements.statusBar||this.elements._uwaTree.buildStatusBar([{position:"far",type:p.STATUS.NB_SELECTED_ROWS}])},onDisciplineDropdownChange:function(t){var a=this;this._paramDisciplineListLoaded||(this._paramDisciplineListLoaded={});var s=e.extendElement(this.elements.mainDiv.querySelector(".assoc_type_loading_icon")),r=a.elements._disciplineDropdown?a.elements._disciplineDropdown.value:"";if(!a._paramDisciplineListLoaded||!a._paramDisciplineListLoaded[r]){s.addClassName("loading");var n=a.options.resource.physicalid;if(a.options.root_resource&&a.options.root_resource.physicalid&&(n=a.options.root_resource.physicalid),r)var o=i.getResourceParameterLists({addAdditionalDisciplines:!0,blnIncludeDescendants:!0,physicalid:n,V_discipline:r}).then(function(e){a.addRootNodesFromData(e),a._paramDisciplineListLoaded[r]=e,a.onDisciplineDropdownChange(t)});else{var l=[];s.addClassName("loading");var c=i.getResourceParameterLists({allCached:!0,addAdditionalDisciplines:!0}).then(function(e){a.addRootNodesFromData(e)});l.push(c);o=i.getResourceParameterLists({addAdditionalDisciplines:!0,blnIncludeDescendants:!0,physicalid:n}).then(function(e){a.addRootNodesFromData(e),a._paramDisciplineListLoaded[r]=e});l.push(o),e.Promise.all(l).then(function(){a.onDisciplineDropdownChange(t)})}}if(a.elements._uwaTree){a.elements._uwaTree.getNodesXSO().empty();var u=a.elements._uwaTree.getTreeDocument();if(u){var d=u.getRoots(),m=Object.values(a._paramDisciplineListLoaded[r]||{});if(d&&d.length)for(var p=d.length-1;p>=0;--p){var h=d[p],f=(!r||m.length>0)&&h&&h.options&&h.options.dsModel;if(f&&r&&m.length>0){var g=h.options.dsModel.resourceParameterList||h.options.dsModel;f=!1;for(var v=0;!f&&v<m.length;++v){var _=m[v];_&&_.resourceParameterList&&(f=_.resourceParameterList.physicalid===g.physicalid)}}f?h.show():h.hide()}}}a._paramDisciplineListLoaded&&a._paramDisciplineListLoaded[r]&&s.removeClassName("loading")},_addExistingResourceParamListTable:function(){var t=this;if(t.options.root_resource&&t.options.root_resource.physicalid&&(!t.options.root_resource.assocResourceParamLists||t.options.resource&&t.options.resource.physicalid&&!t.options.resource.assocResourceParamLists)){var a={QueryList:[{physicalid:t.options.root_resource.physicalid}]};t.options.resource&&t.options.resource.physicalid!==t.options.root_resource.physicalid&&a.QueryList.push({physicalid:t.options.resource.physicalid});i.getResourceParameterLists(a).then(function(i){t.options.root_resource.assocResourceParamLists={},t.options.resource&&(t.options.resource.physicalid===t.options.root_resource.physicalid?t.options.resource.assocResourceParamLists=t.options.root_resource.assocResourceParamLists:t.options.resource.assocResourceParamLists={}),e.each(i,function(i,a){a.resource?a&&a.resource&&a.resourceParameterList&&(a.resource.physicalid===t.options.root_resource.physicalid?t.options.root_resource.assocResourceParamLists[a.resourceParameterList.physicalid]=a.resourceParameterList:a.resource&&a.resource.physicalid===t.options.resource.physicalid&&(t.options.resource.assocResourceParamLists[a.resourceParameterList.physicalid]=a.resourceParameterList)):e.each(a,function(e,i){i&&i.resource&&i.resourceParameterList&&(i.resource.physicalid===t.options.root_resource.physicalid?t.options.root_resource.assocResourceParamLists[i.resourceParameterList.physicalid]=i.resourceParameterList:i.resource&&i.resource.physicalid===t.options.resource.physicalid&&(t.options.resource.assocResourceParamLists[i.resourceParameterList.physicalid]=i.resourceParameterList))})}),t._addExistingResourceParamListTable()})}else{var s=[];if(t.options.resource||t.options.root_resource){var r=Object.assign({Minimum:["V_discipline"]},t.options.resource||t.options.root_resource),n=i.getOneResource(r).then(function(e){var a=i.getResourceParameterLists({addAdditionalDisciplines:!0,blnIncludeDescendants:!0,physicalid:e.physicalid,V_discipline:e.V_discipline}).then(function(e){t.addRootNodesFromData(e)});s.push(a)});s.push(n)}e.Promise.all(s).then(function(){var i=t.elements.mainDiv.getElementsByClassName("assoc_table");i&&1===i.length&&(i=e.extendElement(i[0])),t.elements._uwaTree||i.setText(g.get("No {0}").replace("{0}",g.get("Resource Parameter Lists"))),i.removeClassName("loading")})}},addTable:function(e){var t=this;return new Promise(function(i){if(t.elements._uwaTree)i(t.elements._uwaTree);else{e||(e={});var a={cellSelection:"none",enableListSelection:!0,canMultiSelect:!0,cellDragEnabledFlag:!1,enableDragAndDrop:!1,shouldAcceptDrag:function(){return!1},shouldAcceptDrop:function(){return!1},shouldBeEditable:function(){return!1},isEditable:!1,roots:[],columns:[{text:g.get("Name"),dataIndex:"tree"},{text:g.get("Description"),dataIndex:"V_description"},{text:g.get("Revision"),dataIndex:"revision",width:"61px"}]};a.treeDocument||(a.treeDocument=new d),e.container||(e.container=t.elements.mainDiv.getElementsByClassName("assoc_table"),e.container&&1===e.container.length&&(e.container=e.container[0])),t.elements._uwaTree=new u(a).inject(e.container),t.elements._uwaTree.getNodesXSO().onChange(function(){t.onSelectChanged()}),t.elements._uwaTree.getContainingImmersiveFrame&&!t.elements._uwaTree._getContainingImmersiveFrame&&(t.elements._uwaTree._getContainingImmersiveFrame=t.elements._uwaTree.getContainingImmersiveFrame,t.elements._uwaTree.getContainingImmersiveFrame=function(){var e=t._getContainingImmersiveFrame();return e||(e=t.immersiveFrame||t.options.immersiveFrame),e}),i(t.elements._uwaTree)}})},addRootNodesFromData:function(t){if(t&&!e.Object.isEmptyObject(t)){var i=[];e.each(t,function(e,t){var a=null;a=t.resourceParameterList?{label:t.resourceParameterList.V_Name||t.resourceParameterList.name,dsModel:t.resourceParameterList,grid:{V_description:t.resourceParameterList.V_description||"",revision:t.resourceParameterList.revision||""}}:{label:t.V_Name||t.name,dsModel:t,grid:{V_description:t.V_description||"",revision:t.revision||""}},i.push(a)}),this.addRootNodesToTable(i)}},addRootNodesToTable:function(t){var i=this;return new Promise(function(a,s){if(t&&i.options&&i.options.root_resource&&i.options.root_resource.assocResourceParamLists&&(!i.options.resource||i.options.resource.assocResourceParamLists))for(var r=t.length-1;r>=0;--r){var n=t[r];!n.dsModel.physicalid&&n.dsModel.resourceParameterList&&(n.dsModel.resource&&(n.dsModelResource||(n.dsModelResource={}),n.dsModelResource[n.dsModel.resource.physicalid]=n.dsModel.resource),n.dsModel=n.dsModel.resourceParameterList),n.dsModel.physicalid&&(i.options.resource&&i.options.resource.assocResourceParamLists?i.options.resource.assocResourceParamLists[n.dsModel.physicalid]&&t.splice(r,1):i.options.root_resource.assocResourceParamLists[n.dsModel.physicalid]&&t.splice(r,1))}!t||!Array.isArray(t)||t.length<=0?a([]):i.addTable().then(function(i){var s=i.getTreeDocument(),r=[];i.prepareUpdateView(),e.each(t,function(t,i){var a=s.getRoots();if(a&&a.length){var n=!0;if(e.each(a,function(e,t){return!i.dsModel.physicalid&&i.dsModel.resourceParameterList&&(i.dsModel.resource&&(i.dsModelResource||(i.dsModelResource={}),i.dsModelResource[i.dsModel.resource.physicalid]=i.dsModel.resource),i.dsModel=i.dsModel.resourceParameterList),t&&t.dsModel&&i.dsModel&&((n=t.dsModel.physicalid!==i.dsModel.physicalid)||(i.dsModelResource&&(t.options.dsModelResource?t.options.dsModelResource=Object.assign(t.options.dsModelResource,i.dsModelResource):t.options.dsModelResource=i.dsModelResource),t.show())),n}),!n)return}var o=new m(i);o.dsModel=i.dsModel,s.addRoot(o),r.push(o)}),i.reapplySortModel(),i.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0),a(r)},s)})},_initEventHandlers:function(){var e=this,t=e.elements._modalDiv||e.elements.container||e.elements.mainDiv||window.widget.body;widget.standalone&&window.jQuery&&window.jQuery.fn&&window.jQuery.fn.droppable?(e.options._dndResultsDraggingStart=window.OpenAjax.hub.subscribe("Search.ResultsDragging.start",function(){window.jQuery(t).addClass("ds_search_result_droppable").droppable({tolerance:"pointer",drop:function(t,i){e.onDrop(t,i)},greedy:!0,over:function(t,i){e.onDragOver(t,i)}})}),e.options._dndResultsDraggingStop=window.OpenAjax.hub.subscribe("Search.ResultsDragging.stop",function(){window.jQuery(t).hasClass("ui-droppable")&&window.jQuery(t).droppable("destroy"),window.jQuery(t).removeClass("ds_search_result_droppable")})):(t.addClassName("ds_search_result_droppable"),t.addEventListener("dragover",function(t){e.onDragOver(t)}),t.addEventListener("drop",function(t){e.onDrop(t)})),this.elements.mainDiv.querySelector(".assoc_header .wux-ui-3ds-help").addEventListener("click",function(t){e.onSectionHelpClicked(t)}),this.addEventListener("close",function(t){e.destroy()})},onDragOver:function(e){e&&e.preventDefault&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault())},onDrop:function(t,s){var r=this;t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault();var n=[],o=[],l=function(t){var i={};e.each(t,function(t,a){a&&(a.physicalid?i[a.physicalid]=a:a.resourceParameterList&&a.resourceParameterList.physicalid?i[a.resourceParameterList.physicalid]=a.resourceParameterList:e.Object.isPlainObject(a)&&e.each(a,function(e,t){t.physicalid?i[t.physicalid]=t:t.resourceParameterList&&t.resourceParameterList.physicalid&&(i[t.resourceParameterList.physicalid]=t.resourceParameterList)}))}),r.addRootNodesFromData(i)};s&&s.draggable&&s.draggable.closest?(s.draggable.closest(".search_results_container").find('.ui-selected[data-physicalid]:not([data-what="DELResourceParameterListReference"])').each(function(){n.push({PLM_ExternalID:$(this).attr("data-plm_externalid"),physicalid:$(this).attr("data-physicalid")})}),s.draggable.closest(".search_results_container").find('.ui-selected[data-physicalid][data-what="DELResourceParameterListReference"]').each(function(){o.push({PLM_ExternalID:$(this).attr("data-plm_externalid"),physicalid:$(this).attr("data-physicalid"),Minimum:["physicalid","V_Name","V_description","revision"]})}),n.length>0&&i.getResourceParameterLists({QueryList:n,blnIncludeDescendants:!0}).then(l,function(e){r._displayNotificationMessage(e)}),o.length>0&&e.each(o,function(e,t){i.getOneResourceParameterList(t).then(function(e){l([e])},function(e){r._displayNotificationMessage(e)})})):a.getUnifiedSearchObjectsFromDrop({ev:t}).then(function(t){t&&!e.Object.isEmptyObject(t)&&(e.each(t,function(e,t){t.objectType=t.plmBaseObjectType||t.type,"DELResourceParameterListReference"===t.objectType?o.push(t):t.isResource?n.push(t):t.V_discipline&&"VPMReference"===t.objectType&&n.push(t)}),n.length>0&&i.getResourceParameterLists({QueryList:n,blnIncludeDescendants:!0}).then(l,function(e){r._displayNotificationMessage(e)}),o.length>0&&e.each(o,function(e,t){!t.physicalid&&t.id&&(t.physicalid=t.id),t.Minimum||(t.Minimum=["physicalid","V_Name","V_description","revision"]),i.getOneResourceParameterList(t).then(function(e){Array.isArray(e)||(e=[e]),l(e)},function(e){r._displayNotificationMessage(e)})}))},function(e){r._displayNotificationMessage(e)})},onSectionHelpClicked:function(e){e&&e.stopPropagation&&e.stopPropagation();var t=new c({target:e.target,trigger:"click"}),i=g.get("Loaded Resource Parameter Lists that are associated to Resources of the specified type are shown here.");t.setBody(i),t.show()},_displayNotificationMessage:function(t,i){f._getNotificationManager||(f._getNotificationManager=f.getNotificationManager,f.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),f.getNotificationManager()||f._manager||(f.setNotificationManager(h),f.setRemoveStackOnFirstTimeoutFlag(!0),f.setStackingPolicy(31)),i||(i={}),i.message||(t||(t=g.get("Error")),i.message=t),i.level||(i.level="error"),"subtitle"in i||(i.subtitle=""),"sticky"in i||(i.sticky=!1),"category"in i||(i.category=(t||"").toString()),"title"in i||(i.title=g.get(e.String.capitalize(i.level.toLowerCase()))),h.addNotif(i)}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListDlg",["UWA/Core","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/Editor","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListAssocDlg","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i,a,s,r,n,o,l,c,u){"use strict";return i.inherit({name:"DELWebResourceParameterListDlg",publishedProperties:{title:{defaultValue:c.get("Create New Resource Parameter List"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max(window.widget.body.clientWidth/2,330),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:Math.max(window.widget.body.clientHeight/5,200),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:330,defaultTouchValue:330,advancedSetter:!0,type:"integer",category:"Appearance"},minHeight:{defaultValue:160,defaultTouchValue:160,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(e){this._parent.apply(this,arguments),e&&(this.options=Object.assign(this.options||{},e)),this.options.resourceParameterList&&(this.elements._inputName&&(this.elements._inputName.value=this.options.resourceParameterList.V_Name),this.elements._inputDescription&&(this.elements._inputDescription.value=this.options.resourceParameterList.V_description||""),this.title=c.get("Update Resource Parameter List"),this.buttons&&(this.buttons.Ok&&this.buttons.Ok.hide(),this.buttons.Save&&(this.buttons.Save.label=c.get("Save"))))},destroy:function(){var e=this._assocDlg||this.options&&this.options._assocDlg;delete this._assocDlg,this.options&&delete this.options._assocDlg,this._parent.apply(this,arguments),e&&e.destroy&&e.destroy()},_postBuildView:function(){this._parent();var t=this;if(!this.immersiveFrame){var i=window.document.getElementsByClassName("wux-windows-immersive-frame");if(i&&i.length)for(var n=0;!this.immersiveFrame&&n<i.length;++n)i[n]&&i[n].dsModel&&(this.immersiveFrame=i[n].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements._modalDiv&&this.elements._modalDiv.inject(window.widget.body),this.elements.mainDiv=e.createElement("div",{class:this.name+"-maindiv"}).inject(this.elements._contentDiv||this.elements.container),this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this._assocDlg||this.options._assocDlg?this.elements.container.addClassName("wux-ui-animation-flip-out"):this.elements.container.addClassName("wux-ui-animation-flip-in"),this.buttons={Ok:new a({label:c.get("Associate Existing"),onClick:function(e){t.options.resourceParameterList||t.onAssociate()}}),Save:new a({label:c.get("Create"),onClick:function(e){t.options.resourceParameterList&&t.options.resourceParameterList.physicalid?t.onSave():t.onCreate()}}),Cancel:new a({onClick:function(e){t.visibleFlag=!1,t.destroy()}})},this.buttons.Ok.emphasize="secondary",this.buttons.Ok.elements.button.setStyles({position:"absolute",left:"20px"}),this.elements.mainDiv.innerHTML='<table class="'+this.name+'-table"><tr class="'+this.name+'-V_Name"><th>'+c.get("Name")+'</th><td></td></tr><tr class="'+this.name+'-V_description"><th>'+c.get("Description")+"</th><td></td></tr></table>",this.elements._inputName=new s({placeholder:c.get("required"),value:c.get("Resource Parameter List")+"-"+(new Date).getTime(),requiredFlag:!0,autoCommitFlag:!0}).inject(this.elements.mainDiv.querySelector("tr."+this.name+"-V_Name td")),this.elements._inputDescription=new r({autoCommitFlag:!0}).inject(this.elements.mainDiv.querySelector("tr."+this.name+"-V_description td")),this.options.resourceParameterList?(this.elements._inputName.value=this.options.resourceParameterList.V_Name,this.elements._inputDescription.value=this.options.resourceParameterList.V_description||""):this.elements._inputName.elements.inputField.select(),this.elements._inputName.addEventListener("change",function(e){this.value||this.dsModel&&this.dsModel.value?t.buttons.Save.disabled=!1:t.buttons.Save.disabled||(t.buttons.Save.disabled=!0)}),this.addEventListener("close",function(e){t.destroy()})},onCreate:function(){var e=this;if(this.elements._inputName&&this.elements._inputDescription)if((this.elements._inputName.value||"").trim()){var i={V_Name:this.elements._inputName.value.trim(),V_description:(this.elements._inputDescription.value||"").trim(),target_resource:this.options?this.options.resource:null};e.enableDisableButtons(!1),t.createResourceParameterList(i).then(function(t){var i=c.get("Resource Parameter List");t&&1===t.length&&t[0].V_Name&&(i=t[0].V_Name),e._displayNotificationMessage(c.get("{0} Created").replace("{0}",i),{level:"success"}),e.destroy()},function(t){e.enableDisableButtons(!0),t||(t=c.get("Error")),e._displayNotificationMessage(t)})}else this._displayNotificationMessage(c.get("Missing Name"));else this._displayNotificationMessage("incomplete dialog!")},onSave:function(){var i=this;if(this.elements._inputName&&this.elements._inputDescription)if((this.elements._inputName.value||"").trim())if(this.options.resourceParameterList&&this.options.resourceParameterList.physicalid){var a={physicalid:this.options.resourceParameterList.physicalid},s=!1;e.each({V_Name:this.elements._inputName,V_description:this.elements._inputDescription},function(e,t){t&&e in i.options.resourceParameterList&&t.value!==i.options.resourceParameterList[e]&&(s=e,a[e]=(t.value||"").trim())}),s?(i.enableDisableButtons(!1),t.updateResourceParameterList(a).then(function(){i._displayNotificationMessage(c.get("{0} Updated").replace("{0}",c.get("Resource Parameter List")),{level:"success"}),i.destroy()},function(e){i.enableDisableButtons(!0),e||(e=c.get("Error")),i._displayNotificationMessage(e)})):this._displayNotificationMessage(c.get("No changes have been made."),{level:"info"})}else this._displayNotificationMessage("Missing Resource Parameter List");else this._displayNotificationMessage(c.get("Missing Name"));else this._displayNotificationMessage("incomplete dialog!")},onAssociate:function(){this.hideDialog(),this.showAssocDialog()},enableDisableButtons:function(e){if(this.buttons)for(var t in this.buttons){if("Cancel"!==t)this.buttons[t].disabled=!e}},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in")},showDialog:function(){this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in")},showAssocDialog:function(e){!this._assocDlg&&this.options._assocDlg&&(this._assocDlg=this.options._assocDlg),this._assocDlg||((e=Object.assign(e||{},this.options))._createDlg||(e._createDlg=this),this._assocDlg=new l(e)),this._assocDlg.showDialog(e)},_displayNotificationMessage:function(t,i){o._getNotificationManager||(o._getNotificationManager=o.getNotificationManager,o.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),o.getNotificationManager()||o._manager||(o.setNotificationManager(n),o.setRemoveStackOnFirstTimeoutFlag(!0),o.setStackingPolicy(31)),i||(i={}),i.message||(i.message=t),i.level||(i.level="error"),"subtitle"in i||(i.subtitle=""),"sticky"in i||(i.sticky=!1),"category"in i||(i.category=(t||"").toString()),"title"in i||(i.title=c.get(e.String.capitalize(i.level.toLowerCase()))),n.addNotif(i)}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebPointCloudAssociation/DELWebRealWorldLocationManagerDlg",["UWA/Core","DS/DELWebInfrastructureControls/DELWebPointCloudAssociation/DELWebPointCloudAssociationModel","DS/DELWebInfrastructureControls/CommonControllers/confirmationDialog","DS/DELWebInfrastructureControls/DELWebSearchUtils","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/Editor","DS/TreeModel/TreeDocument","DS/DataGridView/DataGridView","DS/Tree/TreeNodeModel","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i,a,s,r,n,o,l,c,u,d,m,p,h){"use strict";return s.inherit({name:"DELWebRealWorldLocationManagerDlg",publishedProperties:{title:{defaultValue:p.get("Associate Real World Location Data"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max(window.widget.body.clientWidth/2,330),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:Math.max(window.widget.body.clientHeight/5,200),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:330,defaultTouchValue:330,advancedSetter:!0,type:"integer",category:"Appearance"},minHeight:{defaultValue:160,defaultTouchValue:160,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(e){if(e&&(this.options=Object.assign(this.options||{},e)),this._parent.apply(this,arguments),e.dsModel&&(e.dsModel.label||e.dsModel.V_Name)){var t=e.dsModel.label||e.dsModel.V_Name;this.title=p.replace("Associate Real World Location Data to {0}",{0:t})}e.closeCallback&&(this._closeCallback=e.closeCallback),e.droppedPointCloudIds&&(this.droppedPointCloudIds=e.droppedPointCloudIds,this.openedFromDrop=!0)},_populateRWLTable:function(t,i){var a=this;if(t&&!e.Object.isEmptyObject(t)){var s=a.elements._uwaTree;s&&a.elements._uwaTree.prepareUpdateView();var r=[],n=t,o={label:n.name||n.V_Name,dsModel:n,grid:{description:n.description||""},icons:[n.thumbnail],children:[]};(n.currentAssociation||a.options&&a.options.currentAssociation&&a.options.currentAssociation.id===n.id)&&o.icons.push("link"),r.push(o);var l=null;a._addRootNodesToTable(r).then(function(r){a.elements._uwaTree&&a.elements._uwaTree.prepareUpdateView(),e.each(r,function(s,r){if(r.dsModel.id===t.id){if(r&&r.dsModel&&r.dsModel.autoSelect&&(l=r),!r.options||!r.options.dsModel||!r.options.dsModel.id)return delete r.options.children,void r.setState({state:"noChildren"});var n=r.getChildren();e.each(i,function(t,i){if(i&&i.id&&i.name){var s=!1;if(e.each(n,function(e,i){if(s=s||i._options.dsModel.id===t,i._options.dsModel.id===t){Object.assign(i.options.dsModel,t);var a=i.getIcons()||[];a.indexOf("link")<0&&(a.push("link"),i.setIcons(a))}}),!s){var o={label:i.name,dsModel:i,icons:[i.thumbnail],grid:Object.assign({description:i.description},i)};(i.currentAssociation||a.options&&a.options.currentAssociation&&a.options.currentAssociation.id===i.id)&&o.icons.push("link");var c=r.addChild(o)}i.autoSelect&&(l=c)}else e.log("invalid objStateDateObj!")}),r.setState({state:r.hasChildren()?"expanded":"noChildren"})}}),a.elements._uwaTree&&(a.elements._uwaTree.reapplySortModel(),a.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)),s&&a.elements._uwaTree&&(a.elements._uwaTree.reapplySortModel(),a.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)),l&&($.each(a.elements._uwaTree.getNodesXSO().get(),function(e,t){a.elements._uwaTree.getNodesXSO().remove(t)}),l.select(),l.dsModel&&l.dsModel.autoSelect&&delete l.dsModel.autoSelect),a.enableDisableSaveButton()},function(e){a._displayNotificationMessage(e)})}},_addTable:function(e){var t=this;return new Promise(function(i){if(t.elements._uwaTree)i(t.elements._uwaTree);else{e||(e={});var a={treeDocument:new l({}),cellSelection:"none",rowDragEnabledFlag:!1,enableListSelection:!0,maxVisibleRowCount:4,cellDragEnabledFlag:!1,canMultiSelect:!1,columns:[{text:p.get("Title"),dataIndex:"tree",modelAttribute:"name"},{text:p.get("Description"),dataIndex:"description"}]};a.treeDocument||(a.treeDocument=new l({})),e.container||(e.container=t.elements.mainDiv.getElementsByClassName("DELWebRealWorldLocationManagerDlg-RWLTable"),e.container&&1===e.container.length&&(e.container=e.container[0])),t.elements._uwaTree=new c(a).inject(e.container),t.elements._uwaTree.rowSelection="single",t.elements._uwaTree.columnSelection="none",t.elements._uwaTree.cellSelection="none",t.elements._uwaTree.getNodesXSO().onChange(function(){t.enableDisableSaveButton()}),t.elements._uwaTree.getContainingImmersiveFrame&&!t.elements._uwaTree._getContainingImmersiveFrame&&(t.elements._uwaTree._getContainingImmersiveFrame=t.elements._uwaTree.getContainingImmersiveFrame,t.elements._uwaTree.getContainingImmersiveFrame=function(){var e=t._getContainingImmersiveFrame();return e||(e=t.immersiveFrame||t.options.immersiveFrame),e}),i(t.elements._uwaTree)}})},_addRootNodesToTable:function(t){var i=this;return new Promise(function(a,s){if(!t||!Array.isArray(t)||t.length<=0)return s(),!1;i._addTable().then(function(r){if(!r)return s(),!1;var n=r.getTreeDocument(),o=n.getRoots(),l=[],c=[];i.elements._uwaTree.prepareUpdateView(),e.each(t,function(t,i){if(o){var a=!0;if(e.each(o,function(e,t){return t&&t.options&&t.options.dsModel&&i.dsModel&&((a=t.options.dsModel.id!==i.dsModel.id)||Object.assign(t.options.dsModel,i.dsModel),c.push(t)),a}),!a)return}var s=new u(i);s.dsModel=i.dsModel,n.addRoot(s),l.push(s)}),i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0),i.resize(),c&&c.length&&e.each(c,function(e,t){l.push(t)}),a(l)},s)})},resize:function(e){var t=this.elements.mainDiv.querySelector(".DELWebRealWorldLocationManagerDlg-RWLTable");this.elements.mainDiv.querySelector(".DELWebRealWorldLocationManagerDlg-RWLTable .wux-layouts-datagridview-row");if(t){if(this.elements._uwaTree&&this.elements._uwaTree._getScroller()&&this.elements._uwaTree._getScroller().elements&&this.elements._uwaTree._getScroller().elements.container){var i=this.elements._uwaTree._getScroller().elements.container.scrollHeight;i>this.elements._uwaTree._getScroller().elements.container.clientHeight?(t.setStyle("height",i),this.elements.mainDiv.scrollHeight>this.elements.mainDiv.clientHeight&&t.setStyle("height",i-(this.elements.mainDiv.scrollHeight-this.elements.mainDiv.clientHeight))):i>100&&this.elements.mainDiv.scrollHeight>this.elements.mainDiv.clientHeight&&t.setStyle("height",Math.max(100,i-(this.elements.mainDiv.scrollHeight-this.elements.mainDiv.clientHeight)))}this.elements.mainDiv.clientHeight<t.offsetTop+120&&(this.height+=t.offsetTop-this.elements.mainDiv.clientHeight+120)}else this.elements.mainDiv.clientHeight<this.elements.mainDiv.children[0].clientHeight+20&&(this.height+=this.elements.mainDiv.children[0].clientHeight-this.elements.mainDiv.clientHeight+20)},destroy:function(){this._parent.apply(this,arguments),this._closeCallback&&this._closeCallback(),this._confDialog&&!this._confDialogDestroyed&&(this._confDialogDestroyed=!0,this._confDialog.destroy())},_postBuildView:function(){this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this.elements.container.addClassName("wux-ui-animation-flip-in"),this._parent();var t=this;if(!this.immersiveFrame){var i=window.document.getElementsByClassName("wux-windows-immersive-frame");if(i&&i.length)for(var a=0;!this.immersiveFrame&&a<i.length;++a)i[a]&&i[a].dsModel&&(this.immersiveFrame=i[a].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements._modalDiv&&this.elements._modalDiv.inject(window.widget.body),this.elements.mainDiv=e.createElement("div",{class:this.name+"-maindiv"}).inject(this.elements._contentDiv||this.elements.container),this.buttons={Ok:new r({label:p.get("Delete Existing Association"),onClick:function(e){t.onDelete()}}),Save:new r({disabled:!0,label:p.get("Associate"),onClick:function(e){t.options.associatedRepReference?t.onEditSave():t.onAssociate()}}),Cancel:new r({onClick:function(e){t.visibleFlag=!1,t.destroy()}})},this.buttons.Ok.emphasize="secondary",this.buttons.Ok.elements.button.setStyles({position:"absolute",left:"20px"}),this.buttons.Ok.hide(),this.elements.mainDiv.innerHTML='<table class="'+this.name+'-table"><tr class="'+this.name+'-V_Name"><th>'+p.get("Name")+'</th><td></td></tr><tr class="'+this.name+'-V_description"><th>'+p.get("Description")+'</th><td></td></tr></table><div class="'+this.name+'-SearchDirections"><span class="wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-drag-drop"></span><span class="'+this.name+'-SearchDirectionsText">'+p.get("Search and drop a Real World Location or Location State")+'</spin></div><div class="'+this.name+'-RWLTable"></div>',this.elements._inputName=new n({placeholder:p.get("required"),value:p.get("Real World Location")+"-"+(new Date).getTime(),requiredFlag:!0,autoCommitFlag:!0}).inject(this.elements.mainDiv.querySelector("tr."+this.name+"-V_Name td")),this.elements._inputDescription=new o({autoCommitFlag:!0}).inject(this.elements.mainDiv.querySelector("tr."+this.name+"-V_description td")),this.elements._inputName.addEventListener("change",function(e){t.enableDisableSaveButton()}),this.addEventListener("close",function(e){t.destroy()}),this.addEventListener("resize",function(e){t.resize(e)}),this.resize(),this._grabRealWorldLocationInformation(),this._initDropEventHandlers(),t.options.droppedPointCloudIds&&t.onDrop()},enableDisableSaveButton:function(){var e=null;this.elements&&this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&this.elements._uwaTree.getNodesXSO().get&&(e=this.elements._uwaTree.getNodesXSO().get()),this.elements&&this.elements._inputName&&this.elements._inputName.value&&e&&1===e.length?this.buttons.Save.disabled=!1:this.buttons.Save.disabled||(this.buttons.Save.disabled=!0)},_grabRealWorldLocationInformation:function(){var i=this;this.buttons.Save.elements.button.addClassName("loading");var a=i.options.dsModel.ReferencePhysicalid||i.options.dsModel.physicalid,s={physicalid:a,OXID:i.options.dsModel.ReferenceOXID||i.options.dsModel.OXID};t.getPointCloudAssociationForResource(s).then(function(s){if(s&&s[a]&&!e.Object.isEmptyObject(s[a])){var r=s[a].repReference;i.options||(i.options={}),i.options.associatedRepReference=r;var n=r.V_Name;i.elements._inputName.value=n;var o=r.V_description;i.elements._inputDescription.value=o;var l=i.options.dsModel.label||i.options.dsModel.V_Name;i.title=p.replace("Edit Association of Real World Location Data to {0}",{0:l}),i.buttons.Save.label=p.get("Save"),i.buttons.Ok.show();var c=r["V_PointCloudIdentifier.serviceId"],u=r["V_PointCloudIdentifier.objectId"],d={serviceId:c,ids:[u]};t.getStateOrFOIInfoForR2VObjects(d).then(function(a){var s=null,r=null,n=a[u];if(n.type.contains("FeatureState")){var o=n.featureOfInterestId,l={serviceId:c,ids:[o]};t.fetchFOIInfo(l).then(function(a){s=a[o];var n={serviceId:c,id:s.id};t.getLocationStatesForFOI(n).then(function(t){r=t,i.openedFromDrop||(r[u].autoSelect=!0),r[u].currentAssociation=!0,i.options.currentAssociation=e.clone(r[u]),i._populateRWLTable(s,r)})})}else if(n.type.contains("FeatureOfInterest")){s=n,i.openedFromDrop||(s.autoSelect=!0),s.currentAssociation=!0,i.options.currentAssociation=e.clone(s);var d={serviceId:c,id:n.id};t.getLocationStatesForFOI(d).then(function(e){r=e,i._populateRWLTable(s,r)})}else i._displayNotificationMessage("Unknown Real World Location type")})}else i.enableDisableSaveButton();i.buttons.Save.elements.button.removeClassName("loading")})},onAssociate:function(){var e=this;if(this.elements._inputName&&this.elements._inputDescription)if((this.elements._inputName.value||"").trim())if(this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&!this.elements._uwaTree.getNodesXSO().isEmpty())if(1==this.elements._uwaTree.getNodesXSO().get().length){var i=this.elements._uwaTree.getNodesXSO().get()[0],a={V_Name:this.elements._inputName.value.trim(),V_description:(this.elements._inputDescription.value||"").trim(),target_physicalid:this.options?this.options.dsModel.ReferencePhysicalid||this.options.dsModel.physicalid:null,"V_PointCloudIdentifier.objectId":i.options.dsModel?i.options.dsModel.id:null,"V_PointCloudIdentifier.serviceId":i.options.dsModel?"r2vsurvey":null};this.buttons.Save.elements.button.addClassName("loading"),this.buttons.Save.disabled=!0,t.createPointCloudAssociationForResource(a).then(function(t){var a=p.replace("'{0}' successfully associated",{0:i._options.dsModel.name});e._displayNotificationMessage(a,{level:"success"}),e.destroy()},function(t){t||(t=p.get("Error associating Real World Location data")),e._displayNotificationMessage(t)})}else this._displayNotificationMessage(p.get("Invalid Point Cloud Data Selection"));else this._displayNotificationMessage(p.get("Missing Point Cloud Data Selection"));else this._displayNotificationMessage(p.get("Missing Name"));else this._displayNotificationMessage("incomplete dialog!")},onDelete:function(){this.hideDialog(),this.showConfirmationDialog()},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in")},showDialog:function(){this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in")},showConfirmationDialog:function(e){var t=this;!this._confDialog&&this.options._confDialog&&(this._confDialog=this.options._confDialog),e=Object.assign(e||{},this.options),this._confDialog||(e._createDlg||(e._createDlg=this),e.onConfirm=function(){t.onDeleteConfirm()},this._confDialog=new i(e));var a=p.get("Point Cloud Data");t.options.currentAssociation.type.contains("FeatureOfInterest")?a=p.get("Real World Location"):t.options.currentAssociation.type.contains("FeatureState")&&(a=p.get("Location State")),e.confirmationMesssage=t.options.currentAssociation.name?p.replace("Unassociate {0} '{1}'?",{0:p.get(a),1:t.options.currentAssociation.name}):p.replace("Unassociate {0}?",{0:p.get(a)}),this._confDialog.showDialog(e)},onDeleteConfirm:function(){var e=this,i={target_physicalid:this.options?this.options.dsModel.ReferencePhysicalid||this.options.dsModel.physicalid:null,repReference_physicalid:this.options&&e.options.associatedRepReference?e.options.associatedRepReference.physicalid:null};t.deletePointCloudAssociationForResource(i).then(function(){var t=p.get("Real World Location association successfully deleted");e._displayNotificationMessage(t,{level:"success"}),e.destroy()},function(t){t||(t=p.get("Error deleting Real World Location association")),e._displayNotificationMessage(t)})},onEditSave:function(){var e=this;if(this.elements._inputName&&this.elements._inputDescription)if((this.elements._inputName.value||"").trim())if(this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&!this.elements._uwaTree.getNodesXSO().isEmpty())if(1==this.elements._uwaTree.getNodesXSO().get().length){var i=this.elements._uwaTree.getNodesXSO().get()[0],a={V_Name:this.elements._inputName.value.trim(),V_description:(this.elements._inputDescription.value||"").trim(),target_physicalid:this.options?this.options.dsModel.ReferencePhysicalid||this.options.dsModel.physicalid:null,"V_PointCloudIdentifier.objectId":i.options.dsModel?i.options.dsModel.id:null,"V_PointCloudIdentifier.serviceId":i.options.dsModel?"r2vsurvey":null,repReference_physicalid:this.options&&e.options.associatedRepReference?e.options.associatedRepReference.physicalid:null};this.buttons.Save.elements.button.addClassName("loading"),this.buttons.Save.disabled=!0,t.updatePointCloudAssociationForResource(a).then(function(t){var a=p.replace("Association to '{0}' successfully updated",{0:i._options.dsModel.name});e._displayNotificationMessage(a,{level:"success"}),e.destroy()},function(t){t||(t=p.get("Error updating Real World Location association")),e._displayNotificationMessage(t)})}else this._displayNotificationMessage(p.get("Invalid Point Cloud Data Selection"));else this._displayNotificationMessage(p.get("Missing Point Cloud Data Selection"));else this._displayNotificationMessage(p.get("Missing Name"));else this._displayNotificationMessage("incomplete dialog!")},_initDropEventHandlers:function(){var e=this,t=e.elements._modalDiv||e.elements.container||e.elements.mainDiv||window.widget.body;widget.standalone&&window.jQuery&&window.jQuery.fn&&window.jQuery.fn.droppable?(e.options._dndResultsDraggingStart=window.OpenAjax.hub.subscribe("Search.ResultsDragging.start",function(){window.jQuery(t).addClass("ds_search_result_droppable").droppable({tolerance:"pointer",drop:function(t,i){e.onDrop(t,i)},greedy:!0,over:function(t,i){e.onDragOver(t,i)}})}),e.options._dndResultsDraggingStop=window.OpenAjax.hub.subscribe("Search.ResultsDragging.stop",function(){window.jQuery(t).hasClass("ui-droppable")&&window.jQuery(t).droppable("destroy"),window.jQuery(t).removeClass("ds_search_result_droppable")})):(t.addClassName("ds_search_result_droppable"),t.addEventListener("dragover",function(t){e.onDragOver(t)}),t.addEventListener("drop",function(t){e.onDrop(t)}))},onDragOver:function(e){e&&e.stopPropagation&&e.stopPropagation(),e&&e.preventDefault&&e.preventDefault()},onDrop:function(i,s){var r=this;i&&i.stopPropagation&&i.stopPropagation(),i&&i.preventDefault&&i.preventDefault();var n=r.options.droppedPointCloudIds||[],o=function(i){e.each(i,function(i,a){var s=null,n=null;if(a&&a.type&&a.type.contains("FeatureState")){var o=a.featureOfInterestId,l=a.id,c={serviceId:"r2vsurvey",ids:[o]};t.fetchFOIInfo(c).then(function(i){var a={serviceId:"r2vsurvey",id:(s=e.clone(i[o])).id};t.getLocationStatesForFOI(a).then(function(e){(n=e)[l].autoSelect=!0,r._populateRWLTable(s,n)})})}else if(a&&a.type&&a.type.contains("FeatureOfInterest")){(s=e.clone(a)).autoSelect=!0;var u={serviceId:"r2vsurvey",id:a.id};t.getLocationStatesForFOI(u).then(function(e){n=e,r._populateRWLTable(s,n)})}else a&&a.type&&r._displayNotificationMessage("Unknown Real World Location type")})};if(n.length>0){var l=[];e.each(n,function(e,t){l.push(t.id)});var c={serviceId:"r2vsurvey",ids:l};delete r.options.droppedPointCloudIds;t.getStateOrFOIInfoForR2VObjects(c).then(o)}else if(s&&s.draggable&&s.draggable.closest){l=[];if(s.draggable.closest(".search_results_container").find(".ui-selected[data-physicalid]").each(function(){n.push({id:$(this).attr("data-physicalid")}),l.push($(this).attr("data-physicalid"))}),n.length>0)c={serviceId:"r2vsurvey",ids:l},t.getStateOrFOIInfoForR2VObjects(c).then(o)}else a.getUnifiedSearchObjectsFromDrop({ev:i}).then(function(i){if(i&&!e.Object.isEmptyObject(i)){var a=[],s=[],n=[];if(e.each(i,function(t,i){if(i.type&&(i.type.contains("FeatureOfInterest")||i.type.contains("FeatureState")))a.push(i.id);else if("VPMReference"===i.plmBaseObjectType&&i.interfaces){var r=!1;e.each(i.interfaces,function(t,i){e.each(i,function(e,t){r=r||"Resource"===t})}),r?n.push({physicalid:i.physicalid}):s.push(i)}else s.push(i)}),s.length>0&&(1===s.length?r._displayNotificationMessage("1 dropped object is not valid"):r._displayNotificationMessage(s.length+" dropped objects are not valid")),a.length>0){var l={serviceId:"r2vsurvey",ids:a};t.getStateOrFOIInfoForR2VObjects(l).then(o)}if(n){var c={QueryList:n,Minimum:"True"};t.getPointCloudAssociationForResource(c).then(function(i){var a=0,s=[],n=null;if(e.each(i,function(t,r){if(e.Object.isEmptyObject(r))a++;else{var o=i[t].repReference;s.push(o["V_PointCloudIdentifier.objectId"]),n=o["V_PointCloudIdentifier.serviceId"]}}),a&&r._displayNotificationMessage(a>1?p.replace("The {0} resources dropped do not have any real world location data associated.",{0:a}):p.get("The resource dropped does not have any real world location data associated.")),s&&s.length>0){var o={serviceId:n,ids:s};t.getStateOrFOIInfoForR2VObjects(o).then(function(i){e.each(i,function(e,i){if("ERROR"===e)return!0;var a=null,s=null;if(i&&i.type&&i.type.contains("FeatureState")){var o=i.featureOfInterestId,l={serviceId:n,ids:[o]};t.fetchFOIInfo(l).then(function(i){a=i[o];var l={serviceId:n,id:a.id};t.getLocationStatesForFOI(l).then(function(t){(s=t)[e].autoSelect=!0,r._populateRWLTable(a,s)})})}else if(i&&i.type&&i.type.contains("FeatureOfInterest")){a=i,r.openedFromDrop||(a.autoSelect=!0);var c={serviceId:n,id:i.id};t.getLocationStatesForFOI(c).then(function(e){s=e,r._populateRWLTable(a,s)})}else i&&r._displayNotificationMessage("Unknown Real World Location type")})})}})}}})},_displayNotificationMessage:function(t,i){m._getNotificationManager||(m._getNotificationManager=m.getNotificationManager,m.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),m.getNotificationManager()||m._manager||(m.setNotificationManager(d),m.setRemoveStackOnFirstTimeoutFlag(!0),m.setStackingPolicy(31)),i||(i={}),i.message||(i.message=t),i.level||(i.level="error"),"subtitle"in i||(i.subtitle=""),"sticky"in i||(i.sticky=!1),"category"in i||(i.category=(t||"").toString()),"title"in i||(i.title=p.get(e.String.capitalize(i.level.toLowerCase()))),d.addNotif(i)}})}),window.define&&define("DS/DELWebInfrastructureControls/action_bar/pointCloudAssociationCommand",["DS/Core/Core","DS/ApplicationFrame/CommandCheckHeader","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","DS/DELWebInfrastructureControls/DELWebPointCloudAssociation/DELWebRealWorldLocationManagerDlg","DS/Selection/CSOManager"],function(e,t,i,a,s,r,n,o){"use strict";var l=window.$;return t.extend({init:function(e){var t=this;this._parent(e,{}),this.onStateChange(function(){this.getState()&&t._isEnabled&&l('[data-command="'+t._id+'"]').is(":visible")&&t.launchPointCloudDialog()}),t.disable(),t.r2vSurveyServiceExists=!1,i.getServiceUrl({serviceName:"r2vsurvey"}).then(function(e){e&&(t.r2vSurveyServiceExists=!0)}),t.setXSO()},setXSO:function(e){e||this._xso||(e=o),e&&(this._xso=e,this.setXSOonChangeEvent())},setXSOonChangeEvent:function(){var e=this;e._xso&&(e._xsoTokenChangeSubscribe=e._xso.onChange(function(t){1===e._xso.get().length&&e.r2vSurveyServiceExists?e.enable():e.disable()}))},launchPointCloudDialog:function(){var e=this;if(!e._createDlg){var t=this.dialogOptions?UWA.clone(this.dialogOptions):{};if(!t.dsModel){var i=e._xso.get()[0];t.dsModel=i._options.dsModel}t.closeCallback=function(){e.setState(!1,!1),e.enable(),delete e._createDlg},e._createDlg=new n(t)}delete this.dialogOptions},_displayNotificationMessage:function(e,t){s._getNotificationManager||(s._getNotificationManager=s.getNotificationManager,s.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),s.getNotificationManager()||s._manager||(s.setNotificationManager(a),s.setRemoveStackOnFirstTimeoutFlag(!0),s.setStackingPolicy(31)),t||(t={}),t.message||(e||(e=r.get("Error")),t.message=e),t.level||(t.level="error"),"subtitle"in t||(t.subtitle=""),"sticky"in t||(t.sticky=!1),"category"in t||(t.category=(e||"").toString()),"title"in t||(t.title=r.get(UWA.String.capitalize(t.level.toLowerCase()))),a.addNotif(t)}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterDlg",["UWA/Core","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListDlg","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterPrefDialog","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/Label","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/Controls/Abstract","DS/Tree/TreeNodeModel","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i,a,s,r,n,o,l,c,u,d,m,p,h,f,g,v,_,D,b){"use strict";return a.inherit({name:"DELWebResourceParameterDlg",_uwaTree:null,_prefDialog_Done:!1,_arrList:[],publishedProperties:{title:{defaultValue:D.get("Create Parameter"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max(window.widget.body.clientWidth/2,700),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:Math.max(window.widget.body.clientHeight/3,200),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:700,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(e){e&&(this.options=Object.assign(this.options||{},e)),this.options.blnForceRefreshPreferences=!0,this._parent.apply(this,arguments),this.options.resourceParameter?(this.elements._inputName&&(this.elements._inputName.value=this.options.resourceParameter.V_Name),this.elements._inputDescription&&(this.elements._inputDescription.value=this.options.resourceParameter.V_description||""),this.title=D.get("Update Resource Parameter"),this.buttons&&(this.buttons.Ok&&this.buttons.Ok.hide(),this.buttons.Save&&(this.buttons.Save.label=D.get("Save")))):this.title=D.replace("{0} in {1}",{0:this.title,1:this.options.parentModel.V_Name})},destroy:function(){var e=this._prefDialog||this.options&&this.options._prefDialog;delete this._prefDialog,this.options&&delete this.options._prefDialog,this._parent.apply(this,arguments),e&&e.destroy&&e.destroy()},_postBuildView:function(){this._parent();var t=this;if(!this.immersiveFrame){var a=window.document.getElementsByClassName("wux-windows-immersive-frame");if(a&&a.length)for(var s=0;!this.immersiveFrame&&s<a.length;++s)a[s]&&a[s].dsModel&&(this.immersiveFrame=a[s].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements._modalDiv&&this.elements._modalDiv.inject(window.widget.body),this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this._prefDialog||this.options._prefDialog?this.elements.container.addClassName("wux-ui-animation-flip-out"):this.elements.container.addClassName("wux-ui-animation-flip-in"),this.buttons={Ok:new n({disabled:!0,label:D.get("Create"),onClick:function(e){t.onCreate(),t.enableDisableButtons(!0)}}),Save:new n({disabled:!0,label:D.get("Create and Close"),onClick:function(e){t.options.resourceParameter&&t.options.resourceParameter.physicalid?t.onSave():t.onCreate(),t.destroy()}}),Cancel:new n({onClick:function(e){t.visibleFlag=!1,t.destroy()}})},this.buttons.Ok.emphasize="secondary";var r=this.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table"),o=r.insertRow(-1);o.className=this.name+"-V_Direction";var u=e.createElement("th");u.innerHTML=D.get("Direction"),o.appendChild(u);e.createElement("td");if(o.insertCell(),t.options.resourceParameter){this.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_Direction td div")&&this.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_Direction td div").remove();var m=e.createElement("div");m.innerHTML=this.options.resourceParameter.plmObjectType&&this.options.resourceParameter.plmObjectType.indexOf("OUTPUT")>0?D.get("Output"):D.get("Input"),this.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_Direction td").appendChild(m)}else this.elements._direction=new c({type:"radio"}),this.elements._direction.addChild(new l({type:"radio",label:D.get("Input"),value:"Input",checkFlag:!0})),this.elements._direction.addChild(new l({type:"radio",label:D.get("Output"),value:"Output",checkFlag:!1})),this.elements._direction.inject(this.elements.mainDiv.querySelector("tr."+this.name+"-V_Direction td"));var p=r.insertRow(-1);p.className=this.name+"-V_ParameterType";var h=e.createElement("th");h.innerHTML=D.get("Parameter Type"),p.appendChild(h);e.createElement("td");if(p.insertCell(),t.options.resourceParameter)i.getMagnitudes().then(function(i){t.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_ParameterType td div")&&t.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_ParameterType td div").remove(),!t.options.resourceParameter.parameter_type&&t.options.resourceParameter.interfaces&&t.options.resourceParameter.interfaces.length&&e.each(t.options.resourceParameter.interfaces,function(e,i){i.indexOf("DELRscPrmIOValueAbstract")>=0&&(t.options.resourceParameter.parameter_type=i[0].replace("DELRscPrmIORangeValue_","").replace("DELRscPrmIO",""))});var a="";e.each(i,function(e,i){i.Name===t.options.resourceParameter.parameter_type&&(a=i.NLS)}),"IntegerValue"===t.options.resourceParameter.parameter_type&&""===a||"Integer"===t.options.resourceParameter.parameter_type&&""===a?a=D.get("Integer"):("TextValue"===t.options.resourceParameter.parameter_type&&""===a||"Text"===t.options.resourceParameter.parameter_type&&""===a)&&(a=D.get("Text"));var s=e.createElement("div");s.innerHTML=a||"",t.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_ParameterType td").appendChild(s)}),t.options.resourceParameter.parameter_type.indexOf("Integer")<0&&t.options.resourceParameter.parameter_type.indexOf("Text")<0&&t.options.resourceParameter.parameter_type.indexOf("String")<0?t._populateAllMagnitudesSection(t.options.resourceParameter):(t.options.resourceParameter.parameter_type.indexOf("Integer")>=0||t.options.resourceParameter.parameter_type.indexOf("Text")>=0||t.options.resourceParameter.parameter_type.indexOf("String")>=0)&&t._populateListSection(t.options.resourceParameter.V_Values);else{var f=e.extendElement(t.elements.mainDiv.querySelector("tr."+t.name+"-V_ParameterType td"));f.addClassName("loading"),i.getDefaultMagnitudes({blnForceRefresh:!0}).then(function(i){var a=[];i||(a=[{labelItem:D.get("Integer"),valueItem:"Integer"},{labelItem:D.get("Text"),valueItem:"String"}]),i&&e.each(i,function(e,t){t&&t.Name&&t.NLS&&a.push({labelItem:t.NLS,valueItem:t.Name})}),(a=a.sort(function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0})).unshift({labelItem:D.get("Select"),valueItem:""}),a.push({labelItem:" -- "+D.get("Other")+" -- ",valueItem:"__OTHER__"}),t.elements._parameterTypeDropdown=new d({elementsList:a,enableSearchFlag:!1,actionOnClickFlag:!1}).inject(f),t.elements._parameterTypeDropdown.getContent().addEventListener("change",function(e){t.onParameterTypeDropdownChange(e)}),t.enableDisableButtons(!1),t.elements._parameterSettings=new n({displayStyle:"lite",label:D.get("Parameter Type Settings"),icon:{iconName:"cog",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(f),t.elements._parameterSettings.getContent().addEventListener("buttonclick",function(){t.hideDialog(),t.showPreferencesDialog()}),f.removeClassName("loading")},function(e){e||(e=D.get("Error")),t._displayNotificationMessage(e)})}this.options.resourceParameter?(this.elements._inputName.value=this.options.resourceParameter.V_Name,this.elements._inputDescription.value=this.options.resourceParameter.V_ParameterType||""):(this.elements._inputName.value=D.get("Resource Parameter")+"-"+(new Date).getTime(),this.elements._inputName.elements.inputField.select()),this.elements._inputName.addEventListener("change",function(e){this.value||this.dsModel&&this.dsModel.value?t.buttons.Save.disabled=!1:t.buttons.Save.disabled||(t.buttons.Save.disabled=!0),t.elements._parameterTypeDropdown.currentValue||t.enableDisableButtons(!1)}),this.addEventListener("resize",function(e){t.resize(e)}),this.resize(),this.addEventListener("close",function(e){t.destroy()})},showPreferencesDialog:function(e){!this._prefDialog&&this.options._prefDialog&&(this._prefDialog=this.options._prefDialog),this._prefDialog||((e=Object.assign(e||{},this.options))._createDlg||(e._createDlg=this),this.options.blnForceRefreshPreferences&&(e.blnForceRefresh=!0,this.options.blnForceRefreshPreferences=!1),this._prefDialog=new s(e)),this._prefDialog.showDialog(e)},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in")},showDialog:function(e){e&&e.blnForceRefresh&&(this._prefDialog_Done=!0,this._updateParameterTypeDropdown()),this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in")},resize:function(e){var t=this.elements.mainDiv.querySelector(".listSectionTable");this.elements.mainDiv.querySelector(".listSectionTable .wux-layouts-datagridview-row");if(t){if(this.elements._uwaTree&&this.elements._uwaTree._getScroller()&&this.elements._uwaTree._getScroller().elements&&this.elements._uwaTree._getScroller().elements.container){var i=this.elements._uwaTree._getScroller().elements.container.scrollHeight;i>this.elements._uwaTree._getScroller().elements.container.clientHeight?(t.setStyle("height",i),this.elements.mainDiv.scrollHeight>this.elements.mainDiv.clientHeight&&t.setStyle("height",i-(this.elements.mainDiv.scrollHeight-this.elements.mainDiv.clientHeight))):i>100&&this.elements.mainDiv.scrollHeight>this.elements.mainDiv.clientHeight&&t.setStyle("height",Math.max(100,i-(this.elements.mainDiv.scrollHeight-this.elements.mainDiv.clientHeight)))}this.elements.mainDiv.clientHeight<t.offsetTop+120&&(this.height+=t.offsetTop-this.elements.mainDiv.clientHeight+120)}else this.elements.mainDiv.clientHeight<this.elements.mainDiv.children[0].clientHeight+20&&(this.height+=this.elements.mainDiv.children[0].clientHeight-this.elements.mainDiv.clientHeight+20)},onCreate:function(){var e=this;if(this.elements._inputName&&this.elements._inputDescription)if((this.elements._inputName.value||"").trim()){e.listChanged("update",{});var t={V_Name:this.elements._inputName.value.trim(),V_description:(this.elements._inputDescription.value||"").trim(),target_param_list:this.options.parentModel,resourceParameterExtension:this.elements._parameterTypeDropdown&&this.elements._parameterTypeDropdown.currentValue||"",inputOutput:this.elements._direction.value[0],units:this.elements._unitsDropdown&&this.elements._unitsDropdown.currentValue||"",minValue:"",maxValue:"",minLimit:"",maxLimit:""};"String"===t.resourceParameterExtension||"Integer"===t.resourceParameterExtension?(t.V_Values=[],e._arrList&&e._arrList.length>0&&(t.V_Values=e._arrList),delete t.units,delete t.minValue,delete t.minLimit,delete t.maxValue,delete t.maxLimit):this.elements._parameterTypeDropdown&&""!==this.elements._parameterTypeDropdown.currentValue&&(t.minLimit=this.elements._minDropdown.currentValue,"NotSet"!==t.minLimit?t.minValue=this.elements._inputMinimum.value:delete t.minValue,t.maxLimit=this.elements._maxDropdown.currentValue,"NotSet"!==t.maxLimit?t.maxValue=this.elements._inputMaximum.value:delete t.maxValue),e.enableDisableButtons(!1),i.createResourceParameter(t).then(function(t){var i=D.get("Resource Parameter");t&&1===t.length&&t[0].V_Name&&(i=t[0].V_Name),e._displayNotificationMessage(D.get("{0} Created").replace("{0}",i),{level:"success"})},function(t){e.enableDisableButtons(!0),t||(t=D.get("Error")),e._displayNotificationMessage(t)})}else this._displayNotificationMessage(D.get("Missing Name"));else this._displayNotificationMessage("incomplete dialog!")},onParameterTypeDropdownChange:function(){var t=this,a=t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties");t.elements._parameterTypeDropdown.currentValue?"__OTHER__"===t.elements._parameterTypeDropdown.currentValue?i.getMagnitudes({blnForceRefresh:!0}).then(function(i){var a=[{labelItem:D.get("Integer"),valueItem:"Integer"},{labelItem:D.get("Text"),valueItem:"String"}];i&&e.each(i,function(e,t){t&&t.Name&&t.NLS&&a.push({labelItem:t.NLS,valueItem:t.Name})}),a=a.sort(function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0}),t.elements._parameterTypeDropdown.elementsList=a,t.elements._parameterTypeDropdown.selectedIndex=-1,t.elements._parameterTypeDropdown.enableSearchFlag=!0,t.resize()},function(e){e||(e=D.get("Error")),t._displayNotificationMessage(e)}):"Integer"===t.elements._parameterTypeDropdown.currentValue||"String"===t.elements._parameterTypeDropdown.currentValue?(a&&a.remove&&t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties").remove(),t._populateListSection()):t._populateAllMagnitudesSection():a&&a.remove&&t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties").remove(),t.resize(),""===t.elements._parameterTypeDropdown.currentValue?t.enableDisableButtons(!1):""!==t.elements._parameterTypeDropdown.currentValue&&t.enableDisableButtons(!0),(this.elements._inputName.value||"").trim()||t.enableDisableButtons(!1)},_populateListSection:function(t){var i,a=this,s=a.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table");a.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties")&&a.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties").remove(),(i=a.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar"))&&(a.elements._uwaTree=null,a.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar").remove()),(n=a.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection"))&&(a.elements._uwaTree=null,a.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection").remove()),(i=s.insertRow(-1)).className=this.name+"-simpleToolbar";var r=e.createElement("td");(r=i.insertCell()).colSpan="2";var n,o=e.createElement("div");o.innerHTML='<div class="simple_toolbar_title"></div><div class="simple_toolbar_iconNew"><div class="sectionheader_button_icon wux-ui-3ds wux-ui-3ds-plus" title="'+D.get("New")+'"></div></div><div class="simple_toolbar_iconDelete"><div class="sectionheader_button_icon wux-ui-3ds wux-ui-3ds-trash" title="'+D.get("Delete")+'"></div></div>',o.className="simpleToolbar",r.appendChild(o),(n=s.insertRow(-1)).className=this.name+"-listSection";var l=e.createElement("td");(l=n.insertCell()).colSpan="2";var c=e.createElement("div");c.className="listSectionTable",l.appendChild(c),t?a.addRootNodesFromData(t):a.addRootNodesFromData(),a.elements.mainDiv.querySelector(".sectionheader_button_icon.wux-ui-3ds-plus").addEventListener("click",function(e){a.onNewDefinitionCallback(e)}),document.addEventListener("keypress",function(e){13==e.keyCode&&a.onNewDefinitionCallback(e)}),a.elements.mainDiv.querySelector(".sectionheader_button_icon.wux-ui-3ds-trash").addEventListener("click",function(e){a.onDeleteDefinitionCallback(e)}),document.addEventListener("keydown",function(e){8!=e.keyCode&&46!=e.keyCode||a.onDeleteDefinitionCallback(e)})},_updateParameterTypeDropdown:function(){var t=this;i.getDefaultMagnitudes({blnForceRefresh:!0}).then(function(i){if(t.elements._parameterTypeDropdown){var a=[];i&&e.each(i,function(e,t){t&&t.Name&&t.NLS&&a.push({labelItem:t.NLS,valueItem:t.Name})}),(a=a.sort(function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0})).unshift({labelItem:D.get("Select"),valueItem:""}),a.push({labelItem:" -- "+D.get("Other")+" -- ",valueItem:"__OTHER__"}),t.elements._parameterTypeDropdown&&t.elements._parameterTypeDropdown.elements&&t.elements._parameterTypeDropdown.elements&&(t.blnPreventSelectedIndexUpdate=!0,t.elements._parameterTypeDropdown.elementsList=[],t.elements._parameterTypeDropdown.elementsList=a,t.blnPreventSelectedIndexUpdate=!1)}},function(e){e||(e=D.get("Error")),t._displayNotificationMessage(e)})},addRootNodesFromData:function(t,i){var a=[];if(!t||!Array.isArray(t)||t.length<=0){a.push({dsModel:null,inEditMode:!0,grid:{tree:null}}),this.addRootNodesToTable(a)}else e.each(t,function(e,t){var i={label:t,dsModel:t,inEditMode:!0,grid:{tree:t}};a.push(i)}),this.addRootNodesToTable(a)},addRootNodesToTable:function(t){var i=this;return new Promise(function(a,s){!t||!Array.isArray(t)||t.length<=0?a([]):i.addTable().then(function(s){var r=s.getTreeDocument(),n=(r.getRoots(),[]);s.prepareUpdateView(),e.each(t,function(e,t){var a=new g(t);a.dsModel=t.dsModel,r.addRoot(a),i.listChanged("add",a),n.push(a)}),s.reapplySortModel(),s.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0),i.resize(),i.validateIntegerStringList(null),a(n)},s)})},addTable:function(e){var t=this;return new Promise(function(i){if(t.elements._uwaTree)i(t.elements._uwaTree);else{e||(e={});var a={treeDocument:new h({shouldAcceptDrop:function(e){return"middle"!==e.dropPosition&&e.draggedTreeNodeModel.getParent()===e.dropNode.getParent()}}),cellSelection:"none",rowDragEnabledFlag:!0,enableListSelection:!0,maxVisibleRowCount:4,cellDragEnabledFlag:!1,canMultiSelect:!0,columns:[{editableFlag:!0,sortableFlag:!1,editionPolicy:"EditionInPlace",dataIndex:"tree",typeRepresentation:"string"}]};t.elements._parameterTypeDropdown&&"Integer"===t.elements._parameterTypeDropdown.currentValue&&(a.columns[0].typeRepresentation="integer",a.columns[0].getCellSemantics=function(){return{stepValue:1}}),a.treeDocument||(a.treeDocument=new h({shouldAcceptDrop:function(e){return"middle"!==e.dropPosition&&e.draggedTreeNodeModel.getParent()===e.dropNode.getParent()}})),e.container||(e.container=t.elements.mainDiv.getElementsByClassName("listSectionTable"),e.container&&1===e.container.length&&(e.container=e.container[0])),t.elements._uwaTree=new p(a).inject(e.container),t.elements._uwaTree.layout.columnsHeader=!1,t.elements._uwaTree.rowSelection="multiple",t.elements._uwaTree.columnSelection="none",t.elements._uwaTree.cellSelection="none",t.elements._uwaTree.addEventListener("postEdit",function(e,i){t.listChanged("update",i)}),t.elements._uwaTree.addEventListener("dragend",function(e,i){t.listChanged("update")}),t.elements._uwaTree.getContainingImmersiveFrame&&!t.elements._uwaTree._getContainingImmersiveFrame&&(t.elements._uwaTree._getContainingImmersiveFrame=t.elements._uwaTree.getContainingImmersiveFrame,t.elements._uwaTree.getContainingImmersiveFrame=function(){var e=t._getContainingImmersiveFrame();return e||(e=t.immersiveFrame||t.options.immersiveFrame),e}),i(t.elements._uwaTree)}})},onNewDefinitionCallback:function(){var t=this;if(t.elements._uwaTree){t.addRootNodesToTable([{dsModel:null,inEditMode:!0,icons:[],grid:{tree:null}}],function(t){t&&t.length&&e.each(t,function(e,t){t.options.inEditMode=!0,t.updateOptions(t.options),t.select()})}),t.validateIntegerStringList(null)}else setTimeout(function(){t._addByTableRow()},250)},listChanged:function(t,i){var a=this,s=[];if(a.elements._uwaTree){var r=a.elements._uwaTree.getTreeDocument().getRoots();r&&r.length>0&&e.each(r,function(e,t){if("string"==typeof t._options.grid.tree&&t._options.grid.tree&&""!==t._options.grid.tree){if(a.elements._parameterTypeDropdown&&"Integer"===a.elements._parameterTypeDropdown.currentValue||a.options.resourceParameter&&("Integer"===a.options.resourceParameter.parameter_type||"IntegerValue"===a.options.resourceParameter.parameter_type)){if(isNaN(t._options.grid.tree))return a.enableDisableButtons(!1),a.validateIntegerStringList(!0),!1;"string"==typeof t._options.grid.tree&&(t._options.grid.tree=parseInt(t._options.grid.tree))}s[e]=t._options.grid.tree,a._arrList=s}else if("number"==typeof t._options.grid.tree){if((a.elements._parameterTypeDropdown&&"Integer"===a.elements._parameterTypeDropdown.currentValue||a.options.resourceParameter&&("Integer"===a.options.resourceParameter.parameter_type||"IntegerValue"===a.options.resourceParameter.parameter_type))&&isNaN(t._options.grid.tree))return a.enableDisableButtons(!1),a.validateIntegerStringList(!0),!1;s[e]=t._options.grid.tree,a._arrList=s}return a.validateIntegerStringList(null),!0})}},_addByTableRow:function(){var t=this;if(t.element)if(t.elements._uwaTree){t.addRootNodesToTable([{useAsyncPreExpand:!0,dsModel:null,grid:{tree:null}}],function(t){t&&t.length&&e.each(t,function(e,t){t.options.inEditMode=!0,t.updateOptions(t.options)})}),t.validateIntegerStringList(null)}else setTimeout(function(){t._addByTableRow()},250)},onDeleteDefinitionCallback:function(t){var i=this;if(t){t.stopPropagation&&t.stopPropagation();var a=(i.elements._uwaTree.getDocument?i.elements._uwaTree.getDocument():i.elements._uwaTree.getTreeDocument()).getSelectedNodes();e.each(a,function(e,t){if(t&&t.isSelected()){var a=t._getRowID();i._remove_a_row(a)}})}else steal.dev.log(i.constructor.fullName+"::onDeleteDefinitionCallback - invalid event!")},_remove_a_row:function(e){if(this.elements._uwaTree&&!isNaN(e)){var t=this.elements._uwaTree.getTreeDocument().getNthRoot(e);this.elements._uwaTree.getTreeDocument().removeRoot(t),this.listChanged("remove",t)}},_populateAllMagnitudesSection:function(){var t=this,a=t.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table");t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties")&&t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties").remove(),t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar")&&(t.elements._uwaTree=null,t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar").remove()),t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection")&&(t.elements._uwaTree=null,t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection").remove());var s=a.insertRow(-1);s.className=this.name+"-magnitudeProperties";var r=e.createElement("td");(r=s.insertCell()).colSpan="2";var n=e.createElement("table");n.className="DELWebResourceParameterDlg-magnitudesTable",n.style.width="100%",r.appendChild(n);var l=n.insertRow(-1),c=e.createElement("th");c.innerHTML="Minimum",l.appendChild(c);var u=e.createElement("th");u.innerHTML="Units",l.appendChild(u);var m=e.createElement("th");m.innerHTML="Maximum",l.appendChild(m);var p=n.insertRow(-1);e.createElement("td");p.insertCell().className="minProperties";e.createElement("td");p.insertCell().className="magnitudeUnits";e.createElement("td");p.insertCell().className="maxProperties";var f={value:D.get(" "),disabled:!0,autoCommitFlag:!0};t.options.resourceParameter&&(t.options.resourceParameter.minValue||0===t.options.resourceParameter.minValue)&&(f.value=t.options.resourceParameter.minValue,f.disabled=!1),this.elements._inputMinimum=new o(f).inject(this.elements.mainDiv.querySelector("td.minProperties")),this.elements._inputMinimum.elements.inputField.type="number",this.elements._inputMinimum.elements.inputField.step="0.01",t.elements._inputMinimum.getContent().addEventListener("change",function(e){t.validate()});var v=new h;v.addRoot(new g({label:"Not Set",icons:[],grid:{valueItem:"NotSet"}})),v.addRoot(new g({label:D.get("Inclusive"),icons:[{iconName:"lessthanorequal"}],grid:{valueItem:"Included"}})),v.addRoot(new g({label:D.get("Exclusive"),icons:[{iconName:"chevron-left"}],grid:{valueItem:"Excluded"}}));var _={elementsTree:v,enableSearchFlag:!1,actionOnClickFlag:!1};t.options.resourceParameter&&t.options.resourceParameter.minLimit&&(_.currentValue=t.options.resourceParameter.minLimit),this.elements._minDropdown=new d(_).inject(this.elements.mainDiv.querySelector("td.minProperties")),t.elements._minDropdown.getContent().addEventListener("change",function(e){t.onMinPropertiesChange(e)});var b={};b.magnitude=t.elements._parameterTypeDropdown&&t.elements._parameterTypeDropdown.currentValue||"",t.options.resourceParameter&&t.options.resourceParameter.parameter_type&&(b.magnitude=t.options.resourceParameter.parameter_type),i.getMagnitudeUnits(b).then(function(i){var a=null;t.elements.mainDiv.querySelector("td.magnitudeUnits div")&&t.elements.mainDiv.querySelector("td.magnitudeUnits div").remove();var s=[];i&&e.each(i,function(e,t){if(t&&t.Name&&t.NLSName){var i={labelItem:t.NLSName,valueItem:t.Name};t&&t.default&&!0===t.default&&(i.default=!0),s.push(i)}}),(s=s.sort(function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0}))&&(a=null,e.each(s,function(e,t){return t.default&&!0===t.default&&(a=e),null===a}));var r={elementsList:s,enableSearchFlag:!1,selectedIndex:a,actionOnClickFlag:!1};t.options.resourceParameter&&t.options.resourceParameter.units&&(r.currentValue=t.options.resourceParameter.units),t.elements._unitsDropdown=new d(r).inject(t.elements.mainDiv.querySelector("td.magnitudeUnits")),t.elements._unitsDropdown.getContent().addEventListener("change",function(e){t.onUnitsDropdownChange(e)})});var y=new h;y.addRoot(new g({label:"Not Set",grid:{valueItem:"NotSet"}})),y.addRoot(new g({label:D.get("Inclusive"),icons:[{iconName:"lessthanorequal"}],grid:{valueItem:"Included"}})),y.addRoot(new g({label:D.get("Exclusive"),icons:[{iconName:"chevron-left"}],grid:{valueItem:"Excluded"}}));var w={elementsTree:y,enableSearchFlag:!1,actionOnClickFlag:!1};t.options.resourceParameter&&t.options.resourceParameter.maxLimit&&(w.currentValue=t.options.resourceParameter.maxLimit),this.elements._maxDropdown=new d(w).inject(this.elements.mainDiv.querySelector("td.maxProperties")),t.elements._maxDropdown.getContent().addEventListener("change",function(e){t.onMaxPropertiesChange(e)});var L={value:D.get(" "),disabled:!0,autoCommitFlag:!0};t.options.resourceParameter&&(t.options.resourceParameter.maxValue||0===t.options.resourceParameter.maxValue)&&(L.value=t.options.resourceParameter.maxValue,L.disabled=!1),this.elements._inputMaximum=new o(L).inject(this.elements.mainDiv.querySelector("td.maxProperties")),this.elements._inputMaximum.elements.inputField.type="number",this.elements._inputMaximum.elements.inputField.step="0.01",t.elements._inputMaximum.getContent().addEventListener("change",function(e){t.validate()})},validate:function(){var e=0;(this.elements._parameterTypeDropdown&&!this.elements._parameterTypeDropdown.currentValue||!(this.elements._inputName.value||"").trim())&&e++;var t,i=null;t="string"==typeof this.elements._inputMinimum.value&&""!==this.elements._inputMinimum.value.trim()?parseFloat(this.elements._inputMinimum.value.trim()):"number"==typeof this.elements._inputMinimum.value?this.elements._inputMinimum.value:null,i="string"==typeof this.elements._inputMaximum.value&&""!==this.elements._inputMaximum.value.trim()?parseFloat(this.elements._inputMaximum.value.trim()):"number"==typeof this.elements._inputMaximum.value?this.elements._inputMaximum.value:null,"NotSet"!==this.elements._minDropdown.currentValue?(this.elements._inputMinimum.disabled=!1,"string"==typeof this.elements._inputMinimum.value?""!==this.elements._inputMinimum.value.trim()?(this.enableDisableButtons(!0),this.elements.mainDiv.querySelector("td.minProperties input").hasClassName("invalid-input")&&this.elements.mainDiv.querySelector("td.minProperties input").removeClassName("invalid-input")):(this.enableDisableButtons(!1),this.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),e++):this.elements._inputMinimum.value||0===this.elements._inputMinimum.value?(this.enableDisableButtons(!0),this.elements.mainDiv.querySelector("td.minProperties input").hasClassName("invalid-input")&&this.elements.mainDiv.querySelector("td.minProperties input").removeClassName("invalid-input")):(this.enableDisableButtons(!1),this.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),e++)):(this.elements._inputMinimum.disabled=!0,"NotSet"!==this.elements._maxDropdown.currentValue&&(this.elements._inputMaximum.disabled=!1,"string"==typeof this.elements._inputMaximum.value?""!==this.elements._inputMaximum.value.trim()?(this.enableDisableButtons(!0),this.elements.mainDiv.querySelector("td.maxProperties input").hasClassName("invalid-input")&&this.elements.mainDiv.querySelector("td.maxProperties input").removeClassName("invalid-input")):(this.enableDisableButtons(!1),this.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),e++):this.elements._inputMaximum.value||0===this.elements._inputMaximum.value?(this.elements.mainDiv.querySelector("td.maxProperties input").hasClassName("invalid-input")&&this.elements.mainDiv.querySelector("td.maxProperties input").removeClassName("invalid-input"),this.enableDisableButtons(!0)):(this.enableDisableButtons(!1),this.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),e++))),"NotSet"!==this.elements._maxDropdown.currentValue?(this.elements._inputMaximum.disabled=!1,"string"==typeof this.elements._inputMaximum.value?""!==this.elements._inputMaximum.value.trim()?(this.enableDisableButtons(!0),this.elements.mainDiv.querySelector("td.maxProperties input").hasClassName("invalid-input")&&this.elements.mainDiv.querySelector("td.maxProperties input").removeClassName("invalid-input")):(this.enableDisableButtons(!1),this.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),e++):this.elements._inputMaximum.value||0===this.elements._inputMaximum.value?(this.enableDisableButtons(!0),this.elements.mainDiv.querySelector("td.maxProperties input").hasClassName("invalid-input")&&this.elements.mainDiv.querySelector("td.maxProperties input").removeClassName("invalid-input")):(this.enableDisableButtons(!1),this.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),e++)):(this.elements._inputMaximum.disabled=!0,"NotSet"!==this.elements._minDropdown.currentValue&&(this.elements._inputMinimum.disabled=!1,"string"==typeof this.elements._inputMinimum.value?""!==this.elements._inputMinimum.value.trim()?(this.elements.mainDiv.querySelector("td.minProperties input").hasClassName("invalid-input")&&this.elements.mainDiv.querySelector("td.minProperties input").removeClassName("invalid-input"),this.enableDisableButtons(!0)):(this.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),this.enableDisableButtons(!1),e++):this.elements._inputMinimum.value||0===this.elements._inputMinimum.value?(this.enableDisableButtons(!0),this.elements.mainDiv.querySelector("td.minProperties input").hasClassName("invalid-input")&&this.elements.mainDiv.querySelector("td.minProperties input").removeClassName("invalid-input")):(this.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),this.enableDisableButtons(!1),e++))),"Excluded"===this.elements._maxDropdown.currentValue||"Excluded"===this.elements._minDropdown.currentValue?null!==t&&""!==t&&null!==i&&""!==i&&t>=i&&(this.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),this.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),this.enableDisableButtons(!1),e++):"Included"===this.elements._maxDropdown.currentValue&&"Included"===this.elements._minDropdown.currentValue&&null!==t&&""!==t&&null!==i&&""!==i&&t>i&&(this.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),this.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),this.enableDisableButtons(!1),e++),e>0?this.enableDisableButtons(!1):0===e&&(this.elements.mainDiv.querySelector("td.minProperties input").hasClassName("invalid-input")&&this.elements.mainDiv.querySelector("td.minProperties input").removeClassName("invalid-input"),this.elements.mainDiv.querySelector("td.maxProperties input").hasClassName("invalid-input")&&this.elements.mainDiv.querySelector("td.maxProperties input").removeClassName("invalid-input"))},validateIntegerStringList:function(t){var i=null,a=this.elements._uwaTree.getTreeDocument().getRoots();a&&a.length>0&&e.each(a,function(e,a){a&&a._options&&a._options.grid&&null!==a._options.grid.tree&&""!==a._options.grid.tree&&!t||(i=a)}),i?this.enableDisableButtons(!1):this.enableDisableButtons(!0)},onUnitsDropdownChange:function(){this.validate()},onMinPropertiesChange:function(){"NotSet"!==this.elements._minDropdown.currentValue?this.elements._inputMinimum.disabled=!1:this.elements._inputMinimum.disabled=!0,this.validate()},onMaxPropertiesChange:function(){"NotSet"!==this.elements._maxDropdown.currentValue?this.elements._inputMaximum.disabled=!1:this.elements._inputMaximum.disabled=!0,this.validate()},onSave:function(){var t=this;if(this.elements._inputName&&this.elements._inputDescription)if((this.elements._inputName.value||"").trim())if(this.options.resourceParameter&&this.options.resourceParameter.physicalid){t.listChanged("update",{});var a={physicalid:this.options.resourceParameter.physicalid},s=!1;a.attributes={},e.each({V_Name:this.elements._inputName,V_description:this.elements._inputDescription},function(e,i){i&&e in t.options.resourceParameter&&i.value!==t.options.resourceParameter[e]&&(s=e,a.attributes[e]=(i.value||"").trim())}),"Integer"!==t.options.resourceParameter.parameter_type&&"Text"!==t.options.resourceParameter.parameter_type&&"IntegerValue"!==t.options.resourceParameter.parameter_type&&"TextValue"!==t.options.resourceParameter.parameter_type?e.each({units:t.elements._unitsDropdown&&t.elements._unitsDropdown.currentValue||"",minValue:t.elements._inputMinimum&&parseFloat(t.elements._inputMinimum.value),maxValue:t.elements._inputMaximum&&parseFloat(t.elements._inputMaximum.value),minLimit:t.elements._minDropdown&&t.elements._minDropdown.currentValue||null,maxLimit:t.elements._maxDropdown&&t.elements._maxDropdown.currentValue||null},function(e,i){i&&e in t.options.resourceParameter&&i!==t.options.resourceParameter[e]?(s=e,a.attributes[e]=i||""):e in t.options.resourceParameter&&i!==t.options.resourceParameter[e]&&(s=e,a.attributes[e]=i)}):e.each({V_Values:t._arrList},function(e,i){i&&e in t.options.resourceParameter&&i!==t.options.resourceParameter[e]&&(s=e,a.attributes[e]=i||"")}),s?(t.enableDisableButtons(!1),i.updateResourceParameter(a).then(function(){t._displayNotificationMessage(D.get("{0} Updated").replace("{0}",D.get("Resource Parameter")),{level:"success"}),t.destroy()},function(e){t.enableDisableButtons(!0),e||(e=D.get("Error")),t._displayNotificationMessage(e)})):this._displayNotificationMessage(D.get("No changes have been made."),{level:"info"})}else this._displayNotificationMessage("Missing Resource Parameter");else this._displayNotificationMessage(D.get("Missing Name"));else this._displayNotificationMessage("incomplete dialog!")},enableDisableButtons:function(e){if(this.buttons)for(var t in this.buttons){if("Cancel"!==t)this.buttons[t].disabled=!e}}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterFacet",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Promise","DS/EditPropWidget/facets/Common/FacetsBase","DS/EditPropWidget/buttonsBar/ButtonsBar","DS/EditPropWidget/constants/EditPropConstants","DS/DELWebInfrastructureControls/Mask","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListDlg","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterDlg","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/Tree/TreeNodeModel","DS/Windows/Dialog","DS/Controls/Button","DS/CoreEvents/Events","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i,a,s,r,n,o,l,c,u,d,m,p,h,f,g,v,_,D){"use strict";return i.extend({_eventSubscriptionTokens:[],_listOfMagnitudes:{},_listofMagnitudeUnits:{},init:function(t){this._parent.apply(this,arguments),t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)?(this.options&&this.options.modelCache&&e.Function.isFunction(this.options.modelCache)&&(o.setCacheObject(this.options.modelCache()),delete this.options.modelCache),this.options=Object.assign(this.options,t)):this.options||(this.options={}),this.elements.container||(this.elements.container=e.createElement("div",{class:"content_section "+this.getClassNames(),styles:{height:"100%"}})),this.elements.content||(this.elements.content=e.createElement("div",{class:this.getClassNames("-content")}).inject(this.elements.container)),this._type=t.type||"resource",this._initTopBar(),this._initEventHandlers()},destroyComponent:function(){this.elements&&this.elements.TopBar&&this.elements.TopBar.container&&this.elements.TopBar.container.remove&&this.elements.TopBar.container.remove(),this.elements&&this.elements.container&&this.elements.container.remove&&this.elements.container.remove(),this._parent.apply(this,arguments),e.each(this._eventSubscriptionTokens||[],function(e,t){this.options&&this.options.modelEvents?this.options.modelEvents.unsubscribe(t):v.unsubscribe(t)}),this._eventSubscriptionTokens=[]},updateFacet:function(t){var i=this;this.addLoader();var a=i.getModel();if(!a)return!1;this.elements.TopBar.container.inject(this.elements.container.closest(".IDCardInnerBottomArea").getElementsByClassName("actionArea")[0]);var s={physicalid:a.get("objectId")};t&&t.blnForceRefresh&&(s.blnForceRefresh=!0),o.getResourceParameterLists(s).then(function(t){if(t&&!e.Object.isEmptyObject(t)){var a=i.elements._uwaTree;a&&(i.elements._uwaTree.prepareUpdateView(),i.elements._uwaTree.getTreeDocument().removeRoots());var r=[];e.each(t,function(e,t){var i=t.resourceParameterList,a={label:i.V_Name||i.name,dsModel:i,dsModelConnection:t||null,grid:{V_description:i.V_description||""},children:[]};r.push(a)}),i.addRootNodesToTable(r).then(function(t){var r=[];e.each(t,function(e,t){t.setState({state:"expanding"}),t.options&&t.options.dsModel&&t.options.dsModel.physicalid&&r.push({physicalid:t.options.dsModel.physicalid})}),o.getResourceParametersForList({QueryList:r,blnForceRefresh:s.blnForceRefresh||!1}).then(function(a){i.elements._uwaTree&&i.elements._uwaTree.prepareUpdateView(),e.each(t,function(t,s){if(!s.options||!s.options.dsModel||!s.options.dsModel.physicalid)return delete s.options.children,void s.setState({state:"noChildren"});e.each(a,function(t,r){t&&t===s.options.dsModel.physicalid&&(e.each(r,function(t,a){a&&a.physicalid&&a.V_Name?i._addResourceParameterToResourceParameterList(s,a):e.log("invalid objResParam!")}),delete a[t])}),s.setState({state:s.hasChildren()?"expanded":"noChildren"})}),i.elements._uwaTree&&(i.hideShowColumn(),i.elements._uwaTree.reapplySortModel(),i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0))},function(e){i._displayNotificationMessage(e)}),a&&i.elements._uwaTree&&(i.elements._uwaTree.reapplySortModel(),i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0))},function(e){i._displayNotificationMessage(e)})}else i.elements._uwaTree&&(i.elements._uwaTree.destroy(),delete i.elements._uwaTree),i.elements.content.innerHTML="",i.elements.content.appendText(_.get("No Associated {0}").replace("{0}",_.get("Resource Parameter Lists"))).addContent('<div class="create_helper" draggable="false"><i class="create_helper_img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-plus"></i><h5 class="create_helper_txt">'+_.get("Click New to Create a {0}").replace("{0}",_.get("Resource Parameter List"))+"</h5></div>");i.removeLoader()})},getClassNames:function(e){return"content_section-resource_parameter"+(e||"")},show:function(){return this.elements.TopBar.actionbar.show(),this._parent.apply(this,arguments)},hide:function(){return this.elements.TopBar.actionbar.hide(),this._parent.apply(this,arguments)},addLoader:function(){r.mask(this.elements.container)},removeLoader:function(){r.unmask(this.elements.container)},onAction:function(t){e.log("onAction = "+t);var i=[];switch(this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&(i=this.elements._uwaTree.getNodesXSO().get()),t){case"add":this.onCreateParameterList(i);break;case"remove":this.onRemove(i);break;case"edit":this.onEdit(i);break;case"refresh":this.updateFacet({blnForceRefresh:!0});break;default:this._displayNotificationMessage("unknown actionId = "+t)}},onCreateParameterList:function(t){if(this._dlg&&this._dlg.destroy)try{this._dlg.destroy()}catch(t){e.log("DELWebResourceParameterFacet::onCreateParameterList - _dlg.destroy = "+t.stack)}if(!t||t.length<=0){var i=this.getModel();this._dlg=new l(Object.assign({resource:{physicalid:i.get("objectId")}},this.options))}else if(1===t.length&&t[0].isRoot()){i=t[0].options.dsModel;this._dlg=new c(Object.assign({parentModel:i},this.options))}else{var a=!1,s=null;e.each(t,function(e,t){if(a=!t.isRoot()){var i=t.getParent();s?a=s===i:s=i}return a})}},onEdit:function(t){if(this._dlg&&this._dlg.destroy)try{this._dlg.destroy()}catch(t){e.log("DELWebResourceParameterFacet::onEdit - _dlg.destroy = "+t.stack)}if(t&&1===t.length)if(t[0].isRoot()){var i=this.getModel();this._dlg=new l(Object.assign({resource:{physicalid:i.get("objectId")},resourceParameterList:t[0].options.dsModel},this.options))}else{i=this.getModel();this._dlg=new c(Object.assign({resourceParameter:t[0].options.dsModel},this.options))}},onRemove:function(i){var a=this;if(this._dlg&&this._dlg.destroy)try{this._dlg.destroy()}catch(t){e.log("DELWebResourceParameterFacet::onRemove - _dlg.destroy = "+t.stack)}var s=this.getModel(),r=_.get("Do you want to unassociate the {0} {1} from {2} {3}?"),n=[],l=[],c=null;if(1===i.length?i[0].isRoot()?(n=i,r=r.replace("{0}",_.get("Resource Parameter List")).replace("{1}",i[0].options.dsModel.V_Name)):(l=i,c=i[0].getParent(),r=_.get("Do you want to delete the {0} {1} from {2} {3}?").replace("{0}",_.get("Resource Parameter")).replace("{1}",i[0].options.dsModel.V_Name)):e.each(i,function(e,t){t.isRoot()?n.push(t):(null===c?c=t.getParent():c&&c!==t.getParent()&&(c=!1),l.push(t))}),n.length&&!l.length){if(!this.options||!this.options.resource||!this.options.resource.V_Name){this.options||(this.options={});var u={physicalid:s.get("objectId"),Minimum:["V_Name"]};return void o.getOneResource(u).then(function(t){t&&Array.isArray(t)&&t.length&&(t=t[0]),t&&t.V_Name?(a.options.resource=Object.assign(a.options.resource||{physicalid:s.get("objectId")},t),a.onRemove(i)):e.log("DELWebResourceParameterFacet::onRemove - invalid resource reference!")},function(e){a._displayNotificationMessage(e)})}r=r.replace("{0}",n.length).replace("{1}",_.get("Resource Parameter Lists")).replace("{2}",_.get("Resource")).replace("{3}",this.options.resource.V_Name)}else r=!n.length&&l.length?c?i.length>1?_.replace("Do you want to delete the selected {0} from their parent {1} {2}?",{0:_.get("Resource Parameters"),1:_.get("Resource Parameter List"),2:c.getLabel()}):r.replace("{2}",_.get("Resource Parameter List")).replace("{3}",c.getLabel()):_.replace("Do you want to delete the selected {0} from their parent {1}?",{0:_.get("Resource Parameters"),1:_.get("Resource Parameter Lists")}):_.get("Do you want to unassociate the selected objects?");var d={resizableFlag:!0,modalFlag:!0,title:_.get("Unassociate {0}").replace("{0}",_.get("Resource Parameter List")),immersiveFrame:this.getImmersiveFrame(),content:'<span class="icon-main wux-ui-3ds-alert"></span>'+r,buttons:{Cancel:new g({onClick:function(e){a._dlg.destroy(),a._dlg=null}}),Save:new g({label:_.get("Unassociate"),disabled:!1,onClick:function(i){var r=this;r.disabled=!0;var c=[],u=null,d={};n.length&&(d={resource:{physicalid:s.get("objectId")},resourceParameterListQueryList:[]},e.each(n,function(t,i){if(i&&i.options&&i.options.dsModel){var a={};i.options.dsModel.physicalid?a.physicalid=i.options.dsModel.physicalid:i.options.dsModel.OXID&&(a.OXID=i.options.dsModel.OXID),e.Object.isEmptyObject(a)||d.resourceParameterListQueryList.push(a)}}),u=o.unassociateResourceParameterList(d),c.push(u)),l.length&&(d={resourceParameterListphysicalid:null,resourceParameterQueryList:[]},e.each(l,function(t,i){var a=i.getParent();if(d&&(d.resourceParameterListphysicalid=a.dsModel.physicalid),i&&i.options&&i.options.dsModel){var s={};i.options.dsModel.physicalid?s.physicalid=i.options.dsModel.physicalid:i.options.dsModel.OXID&&(s.OXID=i.options.dsModel.OXID),e.Object.isEmptyObject(s)||d.resourceParameterQueryList.push(s)}}),u=o.unassociateResourceParameterFromList(d),c.push(u)),t.all(c).then(function(){a._displayNotificationMessage(_.get("Unassociation Successful"),{level:"success"}),a._dlg.destroy(),a._dlg=null},function(e){a._displayNotificationMessage(e),r.disabled=!1})}})}};!n.length&&l.length&&(d.title=_.get("Delete {0}").replace("{0}",_.get("Resource Parameter")),d.buttons.Save.label=_.get("Delete")),a._dlg=new f(d)},onNodeSelectChange:function(){var t=this,i=[];this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&(i=this.elements._uwaTree.getNodesXSO().get());var a=t.elements.TopBar.actionbar._buttons.add;a&&a.element&&(a.element.disabled=!this.isAddHeaderEnabled(i)),i.length<=1?(e.each(["remove","edit"],function(e,s){(a=t.elements.TopBar.actionbar._buttons[s])&&a.element&&(a.element.disabled=i.length<=0)}),i&&i.length>0&&!i[0].isRoot()&&e.each(["add"],function(e,i){(a=t.elements.TopBar.actionbar._buttons[i]).element.disabled=!0})):e.each(["edit","add"],function(e,i){(a=t.elements.TopBar.actionbar._buttons[i]).element.disabled=!0})},isAddHeaderEnabled:function(t){!t&&this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&(t=this.elements._uwaTree.getNodesXSO().get());var i=!t||t.length<=0||1===t.length&&t[0].isRoot();if(!i&&t.length>0){var a=!1,s=null;e.each(t,function(e,t){if(a=!t.isRoot()){var i=t.getParent();s?a=s===i:s=i}return a}),i=a&&s}return i},_initTopBar:function(){var t=this,i=[{name:"edit",icon:s.ACTION_SWITCH,disabled:!0,text:_.get("Edit"),handler:function(){t.onAction(this.name)}},{name:"remove",icon:"trash",disabled:!0,text:_.get("Remove"),handler:function(){t.onAction(this.name)}},{name:"add",icon:"plus",text:_.get("Add"),handler:function(){t.onAction(this.name)}},{name:"refresh",icon:"refresh",text:_.get("Refresh"),handler:function(){t.onAction(this.name)}}];this.elements.TopBar={},this.elements.TopBar.container=e.createElement("div",{class:this.getClassNames("-topbar"),styles:{height:"100%"}}).inject(this.elements.content),this.elements.TopBar.actionbar=new a({}).inject(this.elements.TopBar.container),this.elements.TopBar.actionbar.setButtons(i),this.elements.TopBar.container.dsModel=this.elements.TopBar.actionbar,this.onNodeSelectChange()},_displayNotificationMessage:function(t,i){d._getNotificationManager||(d._getNotificationManager=d.getNotificationManager,d.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),d.getNotificationManager()||d._manager||(d.setNotificationManager(u),d.setRemoveStackOnFirstTimeoutFlag(!0),d.setStackingPolicy(31)),i||(i={}),i.message||(i.message=t),i.level||(i.level="error"),"subtitle"in i||(i.subtitle=""),"sticky"in i||(i.sticky=!1),"category"in i||(i.category=(t||"").toString()),"title"in i||(i.title=_.get(e.String.capitalize(i.level.toLowerCase()))),u.addNotif(i)},addTable:function(){var e=this;return new t(function(t,i){if(e.elements&&e.elements.container&&e.elements.content){if(!e.elements._uwaTree){var a={cellSelection:"none",enableListSelection:!0,canMultiSelect:!0,isEditable:!1,cellDragEnabledFlag:!0,onDragStartCell:function(t,i){return e.onDragStartCell(t,i)},onDragOverCell:function(t,i){return e.onDragOverCell(t,i)},onDragEndCell:function(e){n.publishEvent("Dragging.stop",{ev:e})},onDropCell:function(t,i){return e.onDropCell(t,i)},columns:[{text:_.get("Title"),dataIndex:"tree",modelAttribute:"V_Name",getCellTooltip:function(t){if(t.rowID<0||!t.nodeModel||!t.nodeModel.options||!t.nodeModel.options.dsModel||!t.nodeModel.options.dsModel.plmObjectType)return e.elements._uwaTree?e.elements._uwaTree.getCellDefaultTooltip(t):{shortHelp:"",updateModel:!1};var i="",a=t.nodeModel.options.dsModel.plmObjectType||t.nodeModel.options.dsModel.plmObjectTypeInternal||t.nodeModel.options.dsModel.V_discipline;if("DELResourcePrmINPUT"===a)i="("+_.get("Input")+") ";else if("DELResourcePrmOUTPUT"===a)i="("+_.get("Output")+") ";else if(e.elements._uwaTree)return e.elements._uwaTree.getCellDefaultTooltip(t);return{shortHelp:i+=t.nodeModel.getLabel(),updateModel:!1}}},{text:_.get("Description"),dataIndex:"V_description",visibleFlag:!1},{text:_.get("Parameter Type"),dataIndex:"parameter_type",visibleFlag:!1},{text:_.get("Values"),dataIndex:"V_Values",visibleFlag:!1},{text:_.get("Minimum"),dataIndex:"V_MinValue",allowUnsafeHTMLContent:!0,visibleFlag:!1,getCellTooltip:function(t){if(t.rowID<0||!t.nodeModel||!t.nodeModel.options||!t.nodeModel.options.dsModel||!t.nodeModel.options.dsModel.minLimit||"NotSet"===t.nodeModel.options.dsModel.minLimit)return e.elements._uwaTree?e.elements._uwaTree.getCellDefaultTooltip(t):{shortHelp:_.get("Minimum"),updateModel:!1};var i=t.nodeModel.options.dsModel.minValue||t.nodeModel.options.dsModel.V_MinValue||0;return{shortHelp:"Excluded"===t.nodeModel.options.dsModel.minLimit?_.replace("Greater than (Exclusive) {0}",{0:i}):_.replace("Greater than or equal to (Inclusive) {0}",{0:i}),updateModel:!1}}},{text:_.get("Maximum"),dataIndex:"V_MaxValue",allowUnsafeHTMLContent:!0,visibleFlag:!1,getCellTooltip:function(t){if(t.rowID<0||!t.nodeModel||!t.nodeModel.options||!t.nodeModel.options.dsModel||!t.nodeModel.options.dsModel.maxLimit||"NotSet"===t.nodeModel.options.dsModel.maxLimit)return e.elements._uwaTree?e.elements._uwaTree.getCellDefaultTooltip(t):{shortHelp:_.get("Maximum"),updateModel:!1};var i=t.nodeModel.options.dsModel.maxValue||t.nodeModel.options.dsModel.V_MaxValue||0;return{shortHelp:"Excluded"===t.nodeModel.options.dsModel.maxLimit?_.replace("Less than (Exclusive) {0}",{0:i}):_.replace("Less than or equal to (Inclusive) {0}",{0:i}),updateModel:!1}}}],roots:[]};a.treeDocument=new p,e.elements.content.innerHTML="",e.elements._uwaTree=new m(a).inject(e.elements.content),e.elements._uwaTree.getNodesXSO().onChange(function(){e.onNodeSelectChange.apply(e,arguments)}),e.elements._uwaTree.getContainingImmersiveFrame&&!e.elements._uwaTree._getContainingImmersiveFrame&&(e.elements._uwaTree._getContainingImmersiveFrame=e.elements._uwaTree.getContainingImmersiveFrame,e.elements._uwaTree.getContainingImmersiveFrame=function(){var e=this._getContainingImmersiveFrame();if(!e){var t=null,i=window.document.getElementsByClassName("wux-windows-immersive-frame");if(i&&i.length)for(var a=0;!t&&a<i.length;++a)i[a]&&i[a].dsModel&&(t=i[a].dsModel);t&&t.getImmersiveFrame&&(e=t.getImmersiveFrame())}return e}),e.onResize()}t(e.elements._uwaTree)}else i()})},addRootNodesToTable:function(i,a){var s=this;return new t(function(t,r){if(!i||!Array.isArray(i)||i.length<=0)return r(),!1;s.addTable().then(function(n){if(!n)return r(),!1;a&&n.getTreeDocument()&&(n.placeholder="",n.getTreeDocument().removeRoots());var o=n.getTreeDocument(),l=o.getRoots(),c=[],u=widget.getUrl()||"";u&&(u=(u=u.substr(0,u.lastIndexOf("/"))).substr(0,u.lastIndexOf("/"))),s.elements._uwaTree.prepareUpdateView(),e.each(i,function(t,i){if(l){var a=!0;if(e.each(l,function(e,t){return t&&t.options&&t.options.dsModel&&i.dsModel&&(a=t.options.dsModel.physicalid!==i.dsModel.physicalid),a}),!a)return}i.icons||(i.icons=[u+"/DELWebInfrastructureControls/assets/icons/I_PPRRscPrmList.png"]);var s=new h(i);s.dsModel=i.dsModel,o.addRoot(s),c.push(s)}),s.hideShowColumn(),s.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0),t(c)},r)})},getTreeNodeFromDsModel:function(t,i,a){if(!t)return e.log("DELWebResourceParameterFacet::getTreeNodeFromDsModel - invalid dsModel!"),null;if(i||(i=this.elements._uwaTree),!i)return e.log("DELWebResourceParameterFacet::getTreeNodeFromDsModel - invalid uwaTree!"),null;a&&e.Function.isFunction(a)||(a=function(e,t){return!(!e||!t)&&(!(!e.physicalid||!t.physicalid||e.physicalid!==t.physicalid)||!(!e.OXID||!t.OXID||e.OXID!==t.OXID))});var s=i.getTreeDocument();if(!s||!s.getAllDescendants)return e.log("DELWebResourceParameterFacet::getTreeNodeFromDsModel - invalid dataGridDocument!"),null;var r=null,n=s.getAllDescendants();return e.each(n,function(e,i){if(i&&i.options&&i.options.dsModel){var s=a(i.options.dsModel,t);!s&&i.options.dsModelConnection&&i.options.dsModelConnection.properties&&(s=a(i.options.dsModelConnection.properties,t)),s&&(r=i)}return!r}),r},getImmersiveFrame:function(){if(!this.immersiveFrame){var e=window.document.getElementsByClassName("wux-windows-immersive-frame");if(e&&e.length)for(var t=0;!this.immersiveFrame&&t<e.length;++t)e[t]&&e[t].dsModel&&(this.immersiveFrame=e[t].dsModel)}return this.immersiveFrame},onDragStartCell:function(t,i){var a=!1;if(i&&i.nodeModel&&i.nodeModel.options&&i.nodeModel.options.dsModel){t.dndInfos||(t.dndInfos=i);var s={protocol:"3DXContent",source:"X3DSEAR_AP",version:"1.1",widgetId:widget.id,data:{items:[]}},r=window.widget.getValue("pad_security_ctx")||window.widget.getValue("collabSpace");if(r&&0!==r.indexOf("ctx::"))r="ctx::"+r;else for(;r&&r.contains("ctx::ctx::");)r=r.replace("ctx::ctx::","ctx::");var o=this.elements._uwaTree.getNodesXSO().get();if(o.length>0){var l=i.nodeModel.options.dsModel.plmBaseObjectType;l||(l=i.nodeModel.isRoot()?"DELResourceParameterListReference":"DELResourcePrm");var c="Resource Parameter";"DELResourceParameterListReference"===l&&(c="Resource Parameter List"),s.data.items.push({envId:window.widget.data.x3dPlatformId||"OnPremise",serviceId:"3DSpace",contextId:r,objectId:i.nodeModel.options.dsModel.physicalid,objectType:l,displayName:i.nodeModel.options.dsModel.V_Name,displayType:c}),e.each(o,function(e,t){t&&t.options&&t.options.dsModel&&i.nodeModel.options.dsModel.physicalid!==t.options.dsModel.physicalid&&((l=t.options.dsModel.plmBaseObjectType)||(l=t.isRoot()?"DELResourceParameterListReference":"DELResourcePrm"),c="Resource Parameter","DELResourceParameterListReference"===l&&(c="Resource Parameter List"),s.data.items.push({envId:window.widget.data.x3dPlatformId||"OnPremise",serviceId:"3DSpace",contextId:r,objectId:t.options.dsModel.physicalid,objectType:l,displayName:t.options.dsModel.V_Name,displayType:c}))})}t.dataTransfer.setData("text/searchitems",window.UWA.Json.encode(s)),a=s.data.items.length>0}return a&&i.nodeModel.isRoot()&&n.publishEvent("Dragging.start",{ev:t}),a},onDragOverCell:function(t,i){var a=!1,s=null;i&&i.nodeModel&&i.nodeModel.options&&i.nodeModel.options.dsModel&&(s=i.nodeModel.isRoot()?i.nodeModel.options.dsModel.physicalid:i.nodeModel.getParent().options.dsModel.physicalid);var r=i&&(i.draggedNodes||i.droppedNodes);return r&&Array.isArray(r)&&i.nodeModel&&r.indexOf(i.nodeModel)<0&&e.each(r,function(e,t){if(t&&t.options&&t.options.dsModel&&t.options.dsModel.plmBaseObjectType){if(a=["DELResourcePrm","DELResourceParameter","DELResourcePrmAbstract","DELResourcePrmINPUT","DELResourcePrmOUTPUT"].indexOf(t.options.dsModel.plmBaseObjectType)>=0){a=t.isRoot()?s!==t.options.dsModel.physicalid:s!==t.getParent().options.dsModel.physicalid}}else a=!1;return a}),a&&t.preventDefault(),a},onDropCell:function(e,t){var i=this.onDragOverCell(e,t);if(i){var a=null;t&&t.nodeModel&&t.nodeModel.options&&t.nodeModel.options.dsModel&&(a=t.nodeModel.isRoot()?t.nodeModel.options.dsModel.physicalid:t.nodeModel.getParent().options.dsModel.physicalid),a&&this.displayCopyMoveResourceParameterDialog(e,t)}return i},hideShowColumn:function(t){var i=this;if(i.elements._uwaTree&&i.elements._uwaTree.columns){if(!t)return i._hideShowColumnAnimationFrame&&window.cancelAnimationFrame(i._hideShowColumnAnimationFrame),void(i._hideShowColumnAnimationFrame=window.requestAnimationFrame(function(){delete i._hideShowColumnAnimationFrame,i.elements._uwaTree.prepareUpdateView(),e.each(i.elements._uwaTree.columns,function(e,t){!t||!t.dataIndex||["tree","V_description"].indexOf(t.dataIndex)>=0||i.hideShowColumn(t.dataIndex)}),i.elements._uwaTree.pushUpdateView({updateCellLayout:!0},!0)}));var a=i.elements._uwaTree.getTreeDocument().getAllDescendants();if(a&&!(a.length<=0)){var s=!0;e.each(a,function(e,i){return i&&i.isVisible()&&i.options&&i.options.grid&&i.options.grid[t]&&(s=!1),s});var r=i.elements._uwaTree.getColumnOrGroup(t);!r||"visibleFlag"in r&&r.visibleFlag!==s||(i.elements._uwaTree.prepareUpdateView(),r.visibleFlag=!s,i.elements._uwaTree.invalidateLayout(),i.elements._uwaTree.pushUpdateView({updateCellLayout:!0},!0)),r.visibleFlag&&i.elements._uwaTree.sizeColumnToFit(t,{computeColumnHeader:!0})}}},displayCopyMoveResourceParameterDialog:function(i,a){var s=this;if(this._dlg&&this._dlg.destroy)try{this._dlg.destroy()}catch(i){e.log("DELWebResourceParameterFacet::displayCopyMoveResourceParameterDialog - _dlg.destroy = "+i.stack)}var r=a&&(a.draggedNodes||a.droppedNodes);if(!r||!Array.isArray(r)||!r.length)return e.log("displayCopyMoveResourceParameterDialog - invalid draggedNodes!"),!1;var n=null;if(a&&a.nodeModel&&a.nodeModel.options&&a.nodeModel.options.dsModel&&(n=a.nodeModel.isRoot()?a.nodeModel.options.dsModel.physicalid:a.nodeModel.getParent().options.dsModel.physicalid),!n)return e.log("displayCopyMoveResourceParameterDialog - invalid drop target!"),!1;var l='<span class="icon-main wux-ui-3ds-alert"></span>'+_.get("Would you like to Copy or Move these items?")+'\n<table style="margin:1em auto;text-align:left;line-height:1.2em;"><tr><td style="padding-right:.5em;font-weight:bold;">'+_.get("Copy")+":</td><td>"+_.replace("Create a new {0} under the target and leave the old one unmodified.",{0:_.get("Resource Parameter")})+'</td></tr><tr><td style="padding-right:.5em;font-weight:bold;">'+_.get("Move")+":</td><td>"+_.replace("Create a new {0} under the target and delete the old one.",{0:_.get("Resource Parameter")})+"</td></tr></table>",c={resizableFlag:!0,modalFlag:!0,title:_.get("Copy or Move Confirmation"),immersiveFrame:this.getImmersiveFrame(),content:l,buttons:{Cancel:new g({onClick:function(e){s._dlg.destroy(),s._dlg=null}}),Save:new g({label:_.get("Move"),onClick:function(t){s._dlg.buttons.Save.disabled=!0,s._dlg.buttons.Ok.disabled=!0,this&&this.tagName&&(s._dlg.buttons.Save.icon=widget.getUrl().substr(0,widget.getUrl().lastIndexOf("/"))+"/../DELWebInfrastructure/DSCommon/graphics/loading-small.gif"),s._dlg.buttons.Ok.onClick(t,function(){var t=[];e.each(r,function(e,i){i.options.dsModel.rplPhysicalid!==n&&t.push({physicalid:i.options.dsModel.physicalid})});var i=function(){s._displayNotificationMessage(_.get("Move Successful"),{level:"success"}),s._dlg.destroy(),s._dlg=null};if(t.length>0){var a={resourceParameterQueryList:t};o.unassociateResourceParameterFromList(a).then(i,function(e){s._displayNotificationMessage(e),s._dlg.buttons.Save.disabled=!1,s._dlg.buttons.Ok.disabled=!1,s._dlg.buttons.Save.icon=""})}else i()})}}),Ok:new g({label:_.get("Copy"),onClick:function(i,a,l){s._dlg.buttons.Ok.disabled=!0,s._dlg.buttons.Save.disabled=!0,this&&this.tagName&&(s._dlg.buttons.Ok.icon=widget.getUrl().substr(0,widget.getUrl().lastIndexOf("/"))+"/../DELWebInfrastructure/DSCommon/graphics/loading-small.gif");var c=[];e.each(r,function(t,i){var a=e.clone(i.options.dsModel);delete a.physicalid,delete a.rplPhysicalid,a.target_physicalid=n,c.push(o.createResourceParameter(a))}),a||(a=function(){s._displayNotificationMessage(_.get("Copy Successful"),{level:"success"}),s._dlg.destroy(),s._dlg=null}),l||(l=function(e){s._displayNotificationMessage(e),s._dlg.buttons.Ok.disabled=!1,s._dlg.buttons.Save.disabled=!1,s._dlg.buttons.Ok.icon=""}),t.all(c).then(a,l)}})}};s._dlg=new f(c),s._dlg.buttons.Save.emphasize="secondary"},_initEventHandlers:function(){var t=this;this._eventSubscriptionTokens||(this._eventSubscriptionTokens=[]),e.each(this,function(i,a){if(a&&e.Function.isFunction(a)&&i.endsWith(" subscribe")){var s=i.replace(" subscribe","").trim(),r=null;(r=t.options&&t.options.modelEvents?t.options.modelEvents.subscribe({event:s},function(e){a.apply(t,[s,e])}):v.subscribe({event:s},function(e){a.apply(t,[s,e])}))&&t._eventSubscriptionTokens.push(r)}})},_addResourceParameterToResourceParameterList:function(t,i){var a=this;if(t){if(t.options.dsModel){t.options.dsModel.children?t.options.dsModel.children&&e.Object.isPlainObject(t.options.dsModel.children)&&(t.options.dsModel.children=Object.values(t.options.dsModel.children)):t.options.dsModel.children=[];var s=t.getChildren();if(s&&s.length)for(var r=0;r<s.length;++r){var n=s[r];n&&n.options&&n.options.dsModel}null;var l="";if(i&&i.V_Values&&"string"==typeof i.V_Values){i.V_Values=JSON.parse(i.V_Values);var c;c=Object.size(i.V_Values),e.each(i.V_Values,function(e,t){t&&t.tree&&""!==t.tree?(l+=t.tree,e+1<c&&(l+=", ")):"number"==typeof t?(t=t.toString())&&""!==t&&(l+=t,e+1<c&&(l+=", ")):"string"==typeof t&&t&&""!==t&&(l+=t,e+1<c&&(l+=", "))}),i.V_Values=l}t.options.dsModel.children.push(e.clone(i)),a.elements._uwaTree.prepareUpdateView(),o.getMagnitudes().then(function(r){if(s=t.getChildren(),a._listOfMagnitudes=r,!i.parameter_type&&i.interfaces&&i.interfaces.length&&e.each(i.interfaces,function(e,t){t.indexOf("DELRscPrmIOValueAbstract")>=0&&(i.parameter_type=t[0].replace("DELRscPrmIORangeValue_","").replace("DELRscPrmIO",""))}),i.parameter_type){i.parameter_type;var n="DELResourcePrmINPUT"===i.plmBaseObjectType||"DELResourcePrmINPUT"===i.plmObjectTypeInternal?"move-to":"move-from",o={label:i.V_Name||i.name,dsModel:i,icons:[n],grid:{V_description:i.V_description||"",physicalid:i.physicalid,parameter_type:a._getParamTypeLabel(i),V_MinValue:a._getMinMaxLabelFromValue(i,!1),V_MaxValue:a._getMinMaxLabelFromValue(i,!0),V_Values:i.V_Values}};(!s||s.length<=0)&&(t.setState({state:"expanded"}),t.options.children=[]),i&&(o&&o.dsModel&&o.grid&&(o.grid=Object.assign(o.grid,o.dsModel),o.grid.parameter_type=a._getParamTypeLabel(i),o.grid.V_MinValue=a._getMinMaxLabelFromValue(i,!1),o.grid.V_MaxValue=a._getMinMaxLabelFromValue(i,!0)),t.addChild(o),"expanded"===t.getState()&&a.hideShowColumn())}a.elements._uwaTree.pushUpdateView({updateCellContent:!0},!0)})}}else steal.dev.log(a.constructor.fullName+":: - unable to locate the group in the tree!")},_getParamTypeLabel:function(t){var i=t.parameter_type,a=i;if("Text"===i||"Integer"===i||"TextValue"===i||"IntegerValue"===i)a=i.replace("Value","");else if(this._listOfMagnitudes&&this._listOfMagnitudes[i]){a=this._listOfMagnitudes[i].NLS||i;var s=t.units;s&&this._listOfMagnitudes[i].Units&&e.each(this._listOfMagnitudes[i].Units,function(e,t){return!t||t.Name!==s&&t.label!==s||(s=t.NLSName||s,!1)}),a+=" ("+s+")"}return a},_getMinMaxLabelFromValue:function(t,i){var a="";if(!t)return a;var s=0,r="NOTSET";if(i?(s=t.maxValue||t.V_MaxValue||0,r=(t.maxLimit||"NotSet").toUpperCase()):(s=t.minValue||t.V_MinValue||0,r=(t.minLimit||"NotSet").toUpperCase()),"NOTSET"===r)return a;var n=t.parameter_type,o=t.units;return o&&this._listOfMagnitudes&&this._listOfMagnitudes[n]&&this._listOfMagnitudes[n].Units&&e.each(this._listOfMagnitudes[n].Units,function(e,t){return!t||t.Name!==o&&t.label!==o||(o=t.NLSName||o,!1)}),i?(a="EXCLUDED"===r?"<":"&le;",a+=" "+s,a+=" "+o):(a=s+" "+o+" ",a+="EXCLUDED"===r?"<":"&le;"),a},_getMaxLabelFromValue:function(t,i){var a="";if(!t)return a;if(!i)return a;var s,r;s=i.maxValue||t.maxValue||0,r=(i.maxLimit||t.maxLimit).toUpperCase();var n=t.parameter_type,o=t.units;return o&&this._listOfMagnitudes&&this._listOfMagnitudes[n]&&this._listOfMagnitudes[n].Units&&e.each(this._listOfMagnitudes[n].Units,function(e,t){return!t||t.Name!==o&&t.label!==o||(o=t.NLSName||o,!1)}),"NOTSET"===r?a:(a="EXCLUDED"===r?"<":"&le;",a+=" "+s,a+=" "+o)},_getMinLabelFromValue:function(t,i){var a="";if(!t)return a;var s,r;s=i.minValue||t.minValue||0,r=(i.minLimit||t.minLimit).toUpperCase();var n=t.parameter_type,o=t.units;return o&&this._listOfMagnitudes[n].Units&&e.each(this._listOfMagnitudes[n].Units,function(e,t){return!t||t.Name!==o&&t.label!==o||(o=t.NLSName||o,!1)}),"NOTSET"===r?a:(a=s+" "+o+" ",a+="EXCLUDED"===r?"<":"&le;")},_getUpdatedParamTypeLabel:function(t,i){var a=t.parameter_type,s=a;if("Text"===a||"Integer"===a||"TextValue"===a||"IntegerValue"===a)s=a.replace("Value","");else if(this._listOfMagnitudes&&this._listOfMagnitudes[a]){s=this._listOfMagnitudes[a].NLS||a;var r=i.units;r&&this._listOfMagnitudes[a].Units&&e.each(this._listOfMagnitudes[a].Units,function(e,t){return!t||t.Name!==r&&t.label!==r||(r=t.NLSName||r,!1)}),s+=" ("+r+")"}return s},"ResourceParameterList.updated subscribe":function(t,i){if(!i&&t&&"string"!=typeof t&&(i=t,t="ResourceParameterList.updated"),i&&i.physicalid&&i.ChangedAttributes&&e.Object.isPlainObject(i.ChangedAttributes)&&!e.Object.isEmptyObject(i.ChangedAttributes)){var a=this.getTreeNodeFromDsModel(i);a&&(this.elements._uwaTree.prepareUpdateView(),a.options.grid=Object.assign(a.options.grid,i.ChangedAttributes),a.options.dsModel=Object.assign(a.options.dsModel,i.ChangedAttributes),i.ChangedAttributes.V_Name&&a.setLabel(i.ChangedAttributes.V_Name),this.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0))}else e.log("DELWebResourceParameterFacet::ResourceParameterList.updated - invalid objData")},"ResourceParameterList.associated subscribe":function(t,i){var a=this;if(!i&&t&&"string"!=typeof t&&(i=t,t="ResourceParameterList.associated"),i&&i.resourceParameterList&&i.resource&&i.resource.physicalid){var s=a.getModel();if(!s||s.get("objectId")!==i.resource.physicalid)return!1;o.getOneResourceParameterList(Object.assign({Minimum:["V_Name","V_description","physicalid"]},i.resourceParameterList)).then(function(e){var t={label:e.V_Name||e.name,dsModel:e,dsModelConnection:i||null,grid:{V_description:e.V_description||""}};a.addRootNodesToTable([t]).then(function(e){},function(e){a._displayNotificationMessage(e)})},function(e){a._displayNotificationMessage(e)})}else e.log("DELWebResourceParameterFacet::ResourceParameterList.associated - invalid objConnection")},"ResourceParameterList.unassociated subscribe":function(t,i){if(!i&&t&&"string"!=typeof t&&(i=t,t="ResourceParameterList.unassociated"),i&&(i.resourceParameterList||i.properties)&&i.resource&&i.resource.physicalid){var a=this.getModel();if(!a||a.get("objectId")!==i.resource.physicalid)return!1;var s=this.getTreeNodeFromDsModel(i.properties||i.resourceParameterList);s&&(this.elements._uwaTree.prepareUpdateView(),s.remove(),this.hideShowColumn(),this.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)),this.onNodeSelectChange()}else e.log("DELWebResourceParameterFacet::ResourceParameterList.unassociated - invalid objConnection")},"ResourceParameter.updated subscribe":function(t,i){if(!i&&t&&"string"!=typeof t&&(i=t,t="ResourceParameter.updated"),i&&i.physicalid&&i.attributes&&e.Object.isPlainObject(i.attributes)&&!e.Object.isEmptyObject(i.attributes)){var a=this.getTreeNodeFromDsModel(i);a&&(this.elements._uwaTree.prepareUpdateView(),i.attributes&&("minLimit"in i.attributes||"minValue"in i.attributes)&&(i.attributes.V_MinValue=this._getMinLabelFromValue(a.options.dsModel,i.attributes)),i.attributes&&("maxLimit"in i.attributes||"maxValue"in i.attributes)&&(i.attributes.V_MaxValue=this._getMaxLabelFromValue(a.options.dsModel,i.attributes)),i.attributes&&i.attributes.units&&(i.attributes.parameter_type=this._getUpdatedParamTypeLabel(a.options.dsModel,i.attributes)),a.options.grid=Object.assign(a.options.grid,i.attributes),a.options.dsModel=Object.assign(a.options.dsModel,i.attributes),i.attributes.V_Name&&a.setLabel(i.attributes.V_Name),this.hideShowColumn(),this.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0))}else e.log("DELWebResourceParameterFacet::ResourceParameter.updated - invalid objData")},"ResourceParameter.associated subscribe":function(t,i){var a=this;if(!i&&t&&"string"!=typeof t&&(i=t,t="ResourceParameter.associated"),i&&i.properties&&i.resourceParameterList&&i.resourceParameterList.physicalid){if(a.elements._uwaTree&&i.properties&&i.resourceParameterList){var s=a.elements._uwaTree.getTreeDocument();if(!s)return;var r=s.getRoots(),n=null,o=null,l=[];l.push(i.properties);var c=[];c.push(i.resourceParameterList),e.each(l,function(t,i){e.each(c,function(e,t){if(r&&r.length)for(var s=0;!n&&s<r.length;++s)if((o=r[s])&&o.options&&o.options.dsModel&&t.physicalid==o.options.dsModel.physicalid){n=o,a._addResourceParameterToResourceParameterList(n,i);break}})})}}else e.log("DELWebResourceParameterFacet::ResourceParameter.associated - invalid objConnection")},"ResourceParameter.unassociated subscribe":function(t,i){if(!i&&t&&"string"!=typeof t&&(i=t,t="ResourceParameter.unassociated"),i&&(i.resourceParameterList||i.properties)){var a=this.getTreeNodeFromDsModel(i.properties);a&&(this.elements._uwaTree.prepareUpdateView(),a.remove(),this.hideShowColumn(),this.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)),this.onNodeSelectChange()}else e.log("DELWebResourceParameterFacet::ResourceParameter.unassociated - invalid objConnection")}})}),define("DS/DELWebInfrastructureControls/DELWebAddExtensionsWebServices",["UWA/Core","DS/WAFData/WAFData","DS/EditPropExtensions/WebServices/WebServices","DS/DELWebInfrastructureControls/DELWebAjaxModel","i18n!DS/EditPropExtensions/assets/nls/AddExtensionsNLS"],function(e,t,i,a,s){"use strict";i.constructor.prototype.addInterfaces&&!i.constructor.prototype._addInterfaces&&(i.constructor.prototype._addInterfaces=i.constructor.prototype.addInterfaces,i.constructor.prototype.addInterfaces=function(e,t,s,r,n,o,l){i._addInterfaces(e,t,s,r,n,function(){o(),a.publishEvent("DELWebAddExtensionsWebServices.addInterfaces",s)},function(e){l(e),a.publishEvent("DELWebAddExtensionsWebServices.addInterfaces.error",{data:s,message:e})})}),i.constructor.prototype.removeInterfaces&&!i.constructor.prototype._removeInterfaces&&(i.constructor.prototype._removeInterfaces=i.constructor.prototype.removeInterfaces,i.constructor.prototype.removeInterfaces=function(e,t,s,r,n,o,l){i._removeInterfaces(e,t,s,r,n,function(){o(),a.publishEvent("DELWebAddExtensionsWebServices.removeInterfaces",s)},function(e){l(e),a.publishEvent("DELWebAddExtensionsWebServices.removeInterfaces.error",{data:s,message:e})})});var r={};return Object.assign(r,i,{getClassInterfaces:function(a,s,r,n,o,l,c,u){e.log("getClassInterfaces");var d={classes:"VPMReference"};"bus"===o?d={classes:n}:"connection"===o&&(d={relationclass:n});var m={Accept:"application/json","Content-Type":"application/json","Accept-Language":window.widget.lang};a&&(m.SecurityContext=a.SecurityContext);!this.get3DSpaceWSUrl&&i.get3DSpaceWSUrl&&(this.get3DSpaceWSUrl=i.get3DSpaceWSUrl);var p=this.get3DSpaceWSUrl(this.tenant,r,"/resources/dictionary/interfaces","displayAttributes=true&noDeprecated=true&noAbstract=true");t.authenticatedRequest(p,{method:"POST",headers:m,timeout:864e5,data:JSON.stringify(d),type:"json",onComplete:function(t){if(e.log("getClassInterfaces:onComplete"),u&&u.interfaces&&u.interfaces.length&&t&&t.results&&t.results.length&&t.results[0].interfaces&&t.results[0].interfaces.length)for(var i=0;i<t.results.length;++i)if(t.results[i].interfaces){var a=t.results[i].interfaces;t.results[i].interfaces=[];for(var s=0;s<a.length;++s){var r=a[s];r&&r.name&&u.interfaces.indexOf(r.name)>=0&&t.results[i].interfaces.push(r)}}l(t)},onFailure:function(){this.onFailureCallback(c,backendresponse)},onTimeout:function(){c("timeout")}})},getObjectInterfaces:function(a,s,r,n,o,l,c,u){e.log("getObjectInterfaces");var d={objects:n},m="/resources/dictionary/object/interfaces";"bus"===o?(d={objects:n},m="/resources/dictionary/object/interfaces"):"connection"===o&&(d={connections:n},m="/resources/dictionary/relation/interfaces");var p={Accept:"application/json","Content-Type":"application/json","Accept-Language":window.widget.lang};a&&(p.SecurityContext=a.SecurityContext),!this.get3DSpaceWSUrl&&i.get3DSpaceWSUrl&&(this.get3DSpaceWSUrl=i.get3DSpaceWSUrl);var h=this.get3DSpaceWSUrl(this.tenant,r,m,"isRoleChecked=true");t.authenticatedRequest(h,{method:"POST",headers:p,timeout:864e5,data:JSON.stringify(d),type:"json",onComplete:function(t){if(e.log("getObjectInterfaces:onComplete"),u&&u.interfaces&&u.interfaces.length&&t&&t.results&&t.results.length&&t.results[0].interfaces&&t.results[0].interfaces.length)for(var i=0;i<t.results.length;++i)if(t.results[i].interfaces){var a=t.results[i].interfaces;t.results[i].interfaces=[];for(var s=0;s<a.length;++s){var r=a[s];r&&r.name&&u.interfaces.indexOf(r.name)>=0&&t.results[i].interfaces.push(r)}}l(t)},onFailure:function(){this.onFailureCallback(c,backendresponse)},onTimeout:function(){e.log("timeout")}})},onFailureCallback:function(t,i){e.log("fail"),e.log(this);var a=t;i&&"object"==typeof i?(i.error&&i.error.Message?a=i.error.Message:i.message&&(a=i.message),e.log(i)):"object"==typeof t&&(t.message.startsWith("NetworkError:")?a=t.message.endsWith('return ResponseCode with value "0"')?s.noConnection:t.message.endsWith('return ResponseCode with value "401"')||t.message.endsWith('return ResponseCode with value "403"')?s.webServiceUnauthorized:s.webServiceError:"null"===t&&(a=s.webServiceError)),onError(a,i)}}),r}),define("DS/DELWebInfrastructureControls/DELWebAddExtensionsWidget",["UWA/Controls/Abstract","DS/DELWebInfrastructureControls/UWAUtils","DS/CoreEvents/Events","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/EditPropExtensions/UI/AddExtensionsWidget","DS/DELWebInfrastructureControls/DELWebAddExtensionsWebServices","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/EditPropExtensions/assets/nls/AddExtensionsNLS","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],function(e,t,i,a,s,r,n,o,l,c,u){"use strict";var d=function(e,t){for(var i=[],a=0;a<e.length;a++)for(var s=e[a].name,r=0;r<t.length;r++)s!==t[r].name||i.push(e[a]);return i};return s.extend({init:function(e,t,i,a,s,r,n){return this._init(e,t,i,a,s,r,n)},_init:function(i,s,o,l,m,p,h){t.log("init");var f=this,g=new e(o);for(var v in g)g[v]&&(f[v]=g[v]);this.elements.SC=l;var _=[],D=m.getTenant();this.tenant=D,this.elements.myObject=m,window.Configuration&&(this.URL=window.Configuration.webroot);var b="";if(this.metatype=m.get("metatype"),o.addOnReference&&t.Object.isPlainObject(o.addOnReference)&&o.addOnReference.plmBaseObjectType&&o.addOnReference.physicalid)b="plmBaseObjectType",this.metatype="bus";else{if(o.addOnReference&&!t.Object.isPlainObject(o.addOnReference))return void n.getInstance({physicalid:m.get("objectId")}).then(function(e){if(e&&e.PLMData){var a=null;t.each(e.PLMData,function(e,t){t&&(t.ReferencePhysicalid||t.ReferenceOXID?a||(a={physicalid:t.ReferencePhysicalid,OXID:t.ReferenceOXID}):a=t)}),a?(o.addOnReference=a,f._init(i,s,o,l,m,p,h)):f._displayNotificationMessage(u.get("Error"))}else f._displayNotificationMessage(u.get("Error"))},function(e){f._displayNotificationMessage(e)});"bus"===m.get("metatype")?b="_DS_ATTR_type":"connection"===m.get("metatype")&&(b="_DS_ATTR_label")}this.setInterfaces=function(e){if(this.interfaces=[],null!==e){var t=e.results;if(1===t.length)this.interfaces=t[0].interfaces;else if(t.length){for(var i=t[0].interfaces,a=1;a<t.length;a++)i=d(i,t[a].interfaces);this.interfaces=i}if(this.allAttachedInterfaces)for(var s=0;s<this.interfaces.length;){for(var r=0;r<this.allAttachedInterfaces.length;r++)if(this.allAttachedInterfaces[r].name===this.interfaces[s].name){this.interfaces.splice(s,1),s--;break}s++}}return this.interfaces}.bind(this),this.setAttachedInterfaces=function(e){if(this.attachedInterfaces=[],null!==e){var t=e.results;if(1===t.length)this.attachedInterfaces=t[0].interfaces;else{for(var i=t[0].interfaces,a=1;a<t.length;a++)i=d(i,t[a].interfaces);this.attachedInterfaces=i}}return this.attachedInterfaces}.bind(this),this.setAllAttachedInterfaces=function(e){if(this.allAttachedInterfaces=[],null!==e){var t=e.results;if(1===t.length)this.allAttachedInterfaces=t[0].interfaces;else for(var i=0;i<t.length;i++)for(var a=t[i].interfaces,s=0;s<a.length;s++)this.allAttachedInterfaces.push(a[s])}return this.allAttachedInterfaces}.bind(this),this.buildUI=function(){this._buildUI()}.bind(this),this._initEventHandlers();var y=null;if(o.addOnReference&&t.Object.isPlainObject(o.addOnReference)&&o.addOnReference.physicalid)y=o.addOnReference.physicalid,_[0]=o.addOnReference.plmBaseObjectType,this.setObject(y);else if(m._innerModels){var w=m._innerModels;for(var L in w)if(w[L]&&w[L].get){y=w[L].get("objectId");var P=w[L].get(b);P?_.push(P.valueDB):_[0]=m.get(b).valueDB,this.setObject(y)}}else{if(y=m.get("objectId"),b&&m.get(b)&&m.get(b).valueDB){var S=m.get(b).valueDB;S&&(_[0]="string"==typeof S?S:S[0])}this.setObject(y)}a.getServiceUrl({serviceName:"3DSpace",onComplete:function(e){e.forEach(function(e){void 0===e.url?t.log("url is undefined, skipping "+e.platformId):D===e.platformId&&(this.URL=e.url)}.bind(this)),r.getObjectInterfaces(l,this.tenant,this.URL,this.models,this.metatype,function(e){this.attachedInterfaces=this.setAttachedInterfaces(e),this.allAttachedInterfaces=this.setAllAttachedInterfaces(e),r.getClassInterfaces(l,this.tenant,this.URL,_,this.metatype,function(e){this.interfaces=this.setInterfaces(e),this.buildUI(),t.log("init:onComplete"),this.showDialog(i,p,h)}.bind(this),function(e){var t=c.failMessage+e;h(t)},o.jsonClassInterfaces)}.bind(this),function(e,t){var i=c.failMessage+e;t&&"object"==typeof t&&t.error&&"1002"===t.error.code?require({},["DS/UIKIT/SuperModal"],function(e){new e({closable:!0,className:"Modals",events:{onHide:function(){p()}}}).alert(c.roleNotAllowed)}):h(i)},o.jsonClassInterfaces)}.bind(this),onFailure:function(e){t.log(e),h(c.urlNotFound)}}),this.context=o.context},_buildUI:function(){var e=this._parent.apply(this,arguments);if(e.addClassName("DELWebAddExtensionsWidget"),this.options&&"multiSelect"in this.options&&this.autoComplete&&this.autoComplete.options&&(this.autoComplete.options.multiSelect=this.options.multiSelect,!this.options.multiSelect)){var i=this.autoComplete.name;this.autoComplete.elements.container.removeClassName(i+"-multiselect"),this.autoComplete.elements.input.addClassName(i+"-single-select"),!this.autoComplete.elements.clear&&this.autoComplete.elements.inputContainer&&(this.autoComplete.elements.clear=t.createElement("span",{class:i+"-reset fonticon fonticon-clear"}).inject(this.autoComplete.elements.inputContainer)),this.autoComplete.getSelection&&!this.autoComplete._getSelection&&(this.autoComplete._getSelection=this.autoComplete.getSelection,this.autoComplete.getSelection=function(){var e=this._getSelection();return!e&&this.selectedItems&&1===this.selectedItems.length&&(e=this.selectedItems.slice(0)),e}),this.attachedInterfaces&&this.attachedInterfaces.length>0&&(this.autoComplete.disable(),this.elements.tableExtensions&&this.elements.tableExtensions.closest&&this.elements.tableExtensions.closest(".accordion-item")&&this.elements.tableExtensions.closest(".accordion-item").addClassName("active"))}return e},showDialog:function(){if(this._parent.apply(this,arguments),this.options&&this.mySuperModal&&this.mySuperModal.modals&&this.mySuperModal.modals.current&&this.options.dialogTitle){var e=this.mySuperModal.modals.current.elements.header?this.mySuperModal.modals.current.elements.header.getElement("h4"):null;e&&e.setText(this.options.dialogTitle)}},_initEventHandlers:function(){var e=this;this._eventSubscriptionTokens||(this._eventSubscriptionTokens=[]),t.each(this,function(a,s){if(s&&t.Function.isFunction(s)&&a.endsWith(" subscribe")){var r=a.replace(" subscribe","").trim(),n=null;(n=e.options&&e.options.modelEvents?e.options.modelEvents.subscribe({event:r},function(t){s.apply(e,[r,t])}):i.subscribe({event:r},function(t){s.apply(e,[r,t])}))&&e._eventSubscriptionTokens.push(n)}})},_displayNotificationMessage:function(e,i){l._getNotificationManager||(l._getNotificationManager=l.getNotificationManager,l.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),l.getNotificationManager()||l._manager||(l.setNotificationManager(o),l.setRemoveStackOnFirstTimeoutFlag(!0),l.setStackingPolicy(31)),i||(i={}),i.message||(i.message=e),i.level||(i.level="error"),"subtitle"in i||(i.subtitle=""),"sticky"in i||(i.sticky=!1),"category"in i||(i.category=(e||"").toString()),"title"in i||(i.title=u.get(t.String.capitalize(i.level.toLowerCase()))),o.addNotif(i)},"DELWebAddExtensionsWebServices.addInterfaces subscribe":function(e,t){this._displayNotificationMessage(u.replace("{0} Associated",{0:u.get("Extension")}),{level:"success"})},"DELWebAddExtensionsWebServices.addInterfaces.error subscribe":function(e,t){this._displayNotificationMessage(c.get(failMessage)+t.message)},"DELWebAddExtensionsWebServices.removeInterfaces subscribe":function(e,t){this._displayNotificationMessage(u.get("Unassociation Successful"),{level:"success"})},"DELWebAddExtensionsWebServices.removeInterfaces.error subscribe":function(e,t){this._displayNotificationMessage(c.get(failMessage)+t.message)}})});