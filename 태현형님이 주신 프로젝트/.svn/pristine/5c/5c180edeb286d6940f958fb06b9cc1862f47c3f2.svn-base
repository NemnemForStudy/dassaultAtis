define("DS/DELWebViewerWorkInstructionController/DELImporter",["UWA/Core","DS/DELWebViewerCommon/DELCommonImporter"],function(e,t){"use strict";return function(e,n){var r,i=n.getOption("logger"),o=function(){var n={context:e.getContext(),frameWindow:e.getFrameWindow(),bDisplayNominal:!1,bDisplayInWork:!1,thumbnailListTitle:"",activateSlide:!1,displayDMUSlidePanel:!1,beforeApplySlideCB:null,afterApplySlideCB:null};return r||(r=new t(n)),r};return{importModel:function(e){i.debug("DELImporter::importModel method invoked with parameters : %o",e),o().importModel(e)},removeModel:function(){i.debug("DELImporter::removeModel method invoked"),o().removeModel()},destroy:function(){r&&(r.removeModel(),r.destroyDMUImporter()),i=r=o=null}}}}),define("DS/DELWebViewerWorkInstructionController/WorkInstructionAVPDataManager",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS"],function(e,t,n){"use strict";var r=[{name:"isVisible",type:"bool",JSONname:"DELAVPProperties.GraphicProperties.visible",defaultValue:!0},{name:"hasALeader",type:"bool",JSONname:"DELAVPProperties.HasALeader",defaultValue:!1},{name:"leaderEndType",type:"string",JSONname:"DELAVPProperties.LeaderEndType"},{name:"position",type:"Vector3",JSONname:"DELAVPProperties.LeaderBreakPoint3D",defaultValue:new n.Vector3},{name:"isFilled",type:"bool",JSONname:"DELAVPProperties.filled",defaultValue:!0},{name:"hasBorder",type:"bool",JSONname:"DELAVPProperties.border",defaultValue:!1},{name:"subViewImage",type:"ImageURL",JSONname:"DELAVPProperties.imgData.imgSrc"},{name:"imageHeight",type:"float",JSONname:"DELAVPProperties.imgData.imageBoxHeight"},{name:"imageWidth",type:"float",JSONname:"DELAVPProperties.imgData.imageBoxWidth"},{name:"fImageHeight",type:"float",JSONname:"DELAVPProperties.imgData.imageBoxHeight"},{name:"fImageWidth",type:"float",JSONname:"DELAVPProperties.imgData.imageBoxWidth"},{name:"anchorMode",type:"string",JSONname:"DELAVPProperties.AnchorMode"},{name:"zoomMode",type:"bool",JSONname:"DELAVPProperties.ZoomMode",defaultValue:!1},{name:"leaderAttachHeightRatio",type:"float",JSONname:"DELAVPProperties.LeaderAttachHeightRatio"},{name:"leaderAttachLengthRatio",type:"float",JSONname:"DELAVPProperties.LeaderAttachHeightRatio"},{name:"leaderAttachWidthRatio",type:"float",JSONname:"DELAVPProperties.LeaderAttachWidthRatio"},{name:"boxRotationAngle",type:"float",JSONname:"DELAVPProperties.BoxRotationAngle"},{name:"graphicProperties.borderRadius",type:"float",JSONname:"DELAVPProperties.BorderRadius"},{name:"graphicProperties.fillStyle.color",type:"Color",JSONname:"DELAVPProperties.GraphicProperties.FillStyle.color",defaultValue:new n.Color("#ffffff")},{name:"graphicProperties.fillStyle.opacity",type:"float",JSONname:"DELAVPProperties.GraphicProperties.FillStyle.opacity",defaultValue:1},{name:"graphicProperties.lineStyle.thickness",type:"float",JSONname:"DELAVPProperties.GraphicProperties.LineStyle.thickness",defaultValue:1},{name:"graphicProperties.lineStyle.pattern",type:"string",JSONname:"DELAVPProperties.GraphicProperties.LineStyle.pattern",defaultValue:"1"},{name:"graphicProperties.lineStyle.color",type:"Color",JSONname:"DELAVPProperties.GraphicProperties.LineStyle.color",defaultValue:new n.Color("#000000")},{name:"graphicProperties.leaderStyle.thickness",type:"float",JSONname:"DELAVPProperties.GraphicProperties.LeaderStyle.thickness",defaultValue:1},{name:"graphicProperties.leaderStyle.pattern",type:"string",JSONname:"DELAVPProperties.GraphicProperties.LeaderStyle.pattern",defaultValue:"1"},{name:"graphicProperties.leaderStyle.color",type:"Color",JSONname:"DELAVPProperties.GraphicProperties.LeaderStyle.color",defaultValue:new n.Color("#000000")},{name:"leaderPointingPoints",type:"array",JSONname:"DELAVPProperties.Leaders",defaultValue:[]},{name:"lLeaderPointingPoints",type:"ListVector3",JSONname:"DELAVPProperties.Leaders.0.AbsPointPoint3D",defaultValue:[]},{name:"vLeaderAbsPointPoint3D",type:"Vector3",JSONname:"DELAVPProperties.Leaders.0.AbsPointPoint3D",defaultValue:new n.Vector3},{name:"pointedReference",type:"string",JSONname:"DELAVPProperties.Leaders.0.PointedReference"}];return function(t){var i,o,a,s,l,u,c,d,p,f,g,m,P=t,h={},I={};return u=function(e){return"string"==typeof e?"true"===e||"false"!==e&&null:e},c=function(e){return parseFloat(e)},d=function(e){var t=e.replace(/[RGB( )]/gi,"").split(",");return(new n.Color).setRGB(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))},p=function(e){var t=e.split?e.split(" "):null;return t?new n.Vector3(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])):3===e.length?new n.Vector3(e[0],e[1],e[2]):void 0},f=function(e){var t,n=[];for(t=0;t<e.length;t++)n.push(p(e[t]));return n},g=function(e){var t,n=new Image;return(t=e&&0===e.indexOf('"')?JSON.parse(e):e)&&""!==t&&(n.src=t),n},m=function(e,t){if(null!=e&&""!==e&&null!=t&&""!==t)switch(t){case"bool":return u(e);case"float":return c(e);case"Color":return d(e);case"Vector3":return p(e);case"ListVector3":return f(e);case"ImageURL":return g(e);case"string":default:return e}},a=function(t){var n=[];return e.is(t)&&t.forEach(function(e){n.push(m(e.AbsPointPoint3D,"Vector3"))}),n},s=function(t){var n,r=I.occurrences||{},i=[];return e.is(t)&&e.Array.detect(r,function(e){e.id!==t||(n=e.path)}),n instanceof Array&&I.entities instanceof Array&&n.forEach(function(e){I.entities.forEach(function(t){e===t.id&&i.push(t.identifier)})}),i},l=function(t){var n,i,o,l={},u=function(e,t){var n=l;e.forEach(function(r,i){n.hasOwnProperty(r)||(i===e.length-1?n[r]=t:n[r]={}),n=n[r]})};return l.id=t.id,l.name=t.Name,r.forEach(function(r){if(e.is(r.JSONname))for(n=t,i=r.JSONname.split(".");0===i.length&&("leaderPointingPoints"===r.name?l[r.name]=a(m(n,r.type)):(o=r.name.split(".")).length>1?u(o,m(n,r.type)):l[r.name]=m(n,r.type)),n=n[i.shift()],e.is(n););}),l.pointedReferenceOccurencePath=s(l.pointedReference),l},i=function(e){return P.find(function(t){if("View"===t.type&&t.proxiedSlideUuid===e)return t})},o=function(t){var n,r,o=[],a=null,s=i(t),u=null;if(e.is(s)&&e.is(s.subObjects))for(u=s.subObjects,n=0;n<u.length;n+=1)for(r=0;r<P.length;r+=1)"AssociativeViewPicture"===P[r].type&&u[n]===P[r].id&&(a=l(P[r]),o.push(a));return o},I=P.find(function(t){if(e.is(t.entities))return t.entities}),P.forEach(function(t){"View"===t.type&&e.is(t.proxiedSlideUuid)&&(h[t.proxiedSlideUuid]=o(t.proxiedSlideUuid))}),{getAVPSlideData:function(e){return h[e]},destroy:function(){P=null,h={},I={}}}}}),define("DS/DELWebViewerWorkInstructionController/WorkInstructionDataManager",["DS/DELWebViewerWorkInstructionController/WorkInstructionAVPDataManager","DS/DELWebViewerBuildUpController/BuildUpSettings"],function(e,t){"use strict";return function(n,r){var i,o=r.getOption("logger"),a=n.getInstance("WorkInstructionBehaviorModelService"),s={},l=r.getOption("mappingKeys"),u=function(e,t){var n=[];return UWA.is(e)&&UWA.is(e.Model,"array")&&UWA.is(e.Model[0].WKIRelations,"array")&&e.Model[0].WKIRelations.length>0&&e.Model[0].WKIRelations.forEach(function(e){t&&e&&e.Instruction&&e.View&&(UWA.is(t.pid,"array")&&(t.pid.indexOf(e.Instruction.InstPhyID)>-1||e.Instruction.Row&&t.pid.indexOf(e.Instruction.Row.RowPhyID)>-1)?-1===n.indexOf(e.View.UUID)&&n.push(e.View.UUID):t.uuid&&e.View.UUID===t.uuid&&(n.push(UWA.is(e.Instruction.Row)?e.Instruction.Row.RowPhyID:e.Instruction.InstPhyID),UWA.is(e.Instruction.Row)&&n.push(e.Instruction.InstPhyID)))}),n};return{getStepViewJson:function(e){return new UWA.Promise(function(t,n){a.getWKIContentPromise(e,l.FILETYPES.DMUJSON).then(function(e){t({json:e})}).fail(n)})},initStepViewSettings:function(e){return new UWA.Promise(function(n,i){a.getWKIContentPromise(e,l.FILETYPES.WKIVIEWINFO).then(function(e){var a,u;e&&e[l.WKIKEYS.WKIVIEWINFO]&&e[l.WKIKEYS.WKIVIEWINFO][l.WKIKEYS.OPERATION]?(a=e[l.WKIKEYS.WKIVIEWINFO][l.WKIKEYS.OPERATION],u={},a.Views.forEach(function(e){u[e.Name]=t.getParsedBuildUpSettings([e.BuildUpSettings])}),n(s=u)):(o.error("WorkInstructionDataManager::initStepViewSettings View BuildUp Settings format is invalid, check the mapping"),i(r.getNLSValue("Error.ViewBuildUpSettingsFormatInvalid.Message")))}).fail(i)})},getLocalGraphicData:function(e,n){var r,i,a;return o.debug("WorkInstructionDataManager::getLocalGraphicData method invoked with parameters : ",n),s?(i=s[n],a=[],e&&e.forEach(function(e){var n,r=t.getGraphicProperties(i,e.category);r&&(n=UWA.merge({path:e.path},r),"OnlyAssignedResources"===i[t.getCategory(e.category)].filter&&"all"===e.category&&(n.visibility=!1),n.visibilityFree=!n.visibility,a.push(n))}),r=a):o.warn("View Settings not found"),r},getAVPSlideData:function(e){return i?i.getAVPSlideData(e):null},getLinkedViewUuids:function(e,t){return new UWA.Promise(function(n,r){a.getWKIContentPromise(e,l.FILETYPES.WKICONTENT).then(function(e){n(u(e,t))}).fail(r)})},getLinkedTextualInstIds:function(e,t){return new UWA.Promise(function(n,r){a.getWKIContentPromise(e,l.FILETYPES.WKICONTENT).then(function(e){n(u(e,{uuid:t}))}).fail(r)})},initAvpDataMananger:function(t){return new UWA.Promise(function(n,r){a.getWKIContentPromise(t,l.FILETYPES.WKICONTENT).then(function(t){UWA.is(t)&&UWA.is(t.Model)&&UWA.is(t.Model[0])&&UWA.is(t.Model[0].WKIObjects)&&(i=new e(t.Model[0].WKIObjects)),n(t)}).fail(r)})},reset:function(){i=null,s=null},destroy:function(){a&&a.destroy(),i&&i.destroy(),s=o=a=i=l=u=null}}}}),define("DS/DELWebViewerWorkInstructionController/WorkInstructionController",["UWA/Core","DS/DELWebViewerCommon/DELCommonSlideServices","DS/DELWebViewerUtils/DELWebViewerSettingsMgt","DS/DELWebViewerWorkInstructionController/WorkInstructionDataManager","DS/DELWebViewerWorkInstructionController/DELImporter"],function(e,t,n,r,i){"use strict";return function(o,a,s,l){var u,c=l.getOption("logger"),d=l.getOption("eventCollection").getViewerCtrlEventHnd(),p=new r(s,l),f=o.getInstance("BuildUpBehavior"),g=new i(a,l),m=l.getOption("mappingKeys"),P=function(){return a.getMode()===m.VIEWERMODES.WORKINSTRUCTIONS},h=function(e){var t,n;return f?t=(n=f.getCurrentBuildUpContent())?n[e]:null:c.error("BuildUpBehavior not found"),t},I=function(){return c.debug("WorkInstructionController::clean method invoked"),g.removeModel(),e.is(u)&&u.clean(),p.reset(),e.Promise.resolve()},S=function(){var r=function(n,r){var i;n&&n.data&&(a.setGraphicProperties({graphicProperties:p.getLocalGraphicData(h(m.BUILDUPKEYS.GRAPHICDATA),n.data.name)},m.SCENEGRAPHKEYS.BUILDUP),n.data.context=a.getContext(),t.applySlide(n.data),i=p.getAVPSlideData(n.data.uuid),e.is(i)&&u.applyAvpData(i),e.is(n.data.uuid)&&r&&p.getLinkedTextualInstIds(h(m.BUILDUPKEYS.PATHIDS),n.data.uuid).then(function(e){d.publish(d.events.onSelectView,{viewUUID:n.data.uuid,textualInstructionPIds:e,viewID:n.data.id})}))},i=function(e){var n={slides:t.getSlidesDefinition({context:a.getContext()}),avpData:e};u.clean(),u.display(n)},o=function(){var t;p.initStepViewSettings(h(m.BUILDUPKEYS.PATHIDS)).then(function(){return p.initAvpDataMananger(h(m.BUILDUPKEYS.PATHIDS))}).then(function(i){return new e.Promise(function(e,o){u?e(i):((t=Object.create(l)).setOption("onSlideSelectedCB",r),Object.assign(t,n.getLayout_options("wkiview_opts")),a.getComponentPromise("DELSlideView",t).then(function(t){u=t,e(i)}).fail(function(e){throw c.error("DELSlideView Component Initialization failed due to -",e),o(e),new Error(e)}))})}).then(i).fail(function(e){c.error("WorkInstructionController::addSlidePanel - Unable to create views panel due to -",e)})};c.debug("WorkInstructionController::show method invoked"),I().then(function(){return p.getStepViewJson(h(m.BUILDUPKEYS.PATHIDS))}).then(function(e){c.debug("WorkInstructionController::importStepView method invoked"),e.onModelLoadedCB=o,g.importModel(e)}).fail(function(t){e.is(u)&&u.hide(),c.error("WorkInstructionController::show unable to show the work instructions due to - ",t),d.publish(d.events.onWKIFailed,{error:t})})};return d.subscribe(d.events.onGlobalBuildUpComplete,function(){P()&&S()}),{show:S,reset:function(){c.debug("WorkInstructionController::remove method invoked"),I().then(function(){return new e.Promise(function(t){e.is(u)&&(u.reset(),u=null),t()})}).fail(function(e){c.error("WorkInstructionController::remove not able to remove work instructions due to - ",e)})},highlightLinkedViews:function(n){return c.info("WorkInstructionController::highlightLinkedViews API invoked with parameters : ",n),n&&e.is(n.pid,"string")&&(n.pid=[n.pid]),new e.Promise(function(r,i){P()&&n?p.getLinkedViewUuids(h(m.BUILDUPKEYS.PATHIDS),n).then(function(n){var i;e.is(n,"array")&&n.length>0?((i=t.getSlidesDefinition({context:a.getContext()}).find(function(e){return n.indexOf(e.uuid)>-1}))&&i.uuid&&u.activateView({viewUUID:i.uuid}),u.highlightViews(n)):(u.unHighlightViews(n),u.selectActiveView()),r()}).fail(function(e){c.error("WorkInstructionController::highlightLinkedViews not able to highlight views due to ",e),i(e)}):(c.error("WorkInstructionController :: WorkInstruction mode is not active"),i(l.getNLSValue("Error.WorkInstModeNotActive.Message")))})},getCurrentView:function(){return c.info("WorkInstructionController::getCurrentView API invoked"),new e.Promise(function(e,t){var n;u&&P()?(n=u.getActiveView())?e(n):(c.error("WorkInstructionController :: getCurrentView No active View ID found"),t(l.getNLSValue("Error.ActiveViewIDNotFound.Message"))):(c.error("WorkInstructionController :: WorkInstruction mode is not active"),t(l.getNLSValue("Error.WorkInstModeNotActive.Message")))})},setCurrentView:function(t){return c.info("WorkInstructionController::setCurrentView API invoked with parameters : ",t),new e.Promise(function(n,r){P()?t&&(e.is(t.viewUUID,"string")||e.is(t.viewID,"number"))?(u.activateView(t),n()):(c.error("WorkInstructionController :: setCurrentView Invalid input paramters"),r(l.getNLSValue("Error.InvalidInput.Message"))):(c.error("WorkInstructionController :: WorkInstruction mode is not active"),r(l.getNLSValue("Error.WorkInstModeNotActive.Message")))})},clean:I,destroy:function(){g&&g.destroy(),u&&u.destroy(),p&&p.destroy(),c=d=p=f=g=u=m=null}}}});