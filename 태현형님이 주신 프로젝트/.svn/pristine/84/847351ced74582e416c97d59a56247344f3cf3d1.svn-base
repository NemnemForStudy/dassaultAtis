define("DS/ShareWidget/ShareModel",["UWA/Controls/Abstract"],function(e){return e.extend({init:function(e){this._RightList=[],this._DataList=[],this._ObjectId=e,this._ownerId="",this._projId="",this._orgId="",this._userGrpId="",this._objectType=""},setPOV:function(e,t,n,a){this._ownerId=e,this._projId=t,this._orgId=n,this._userGrpId=a},getOwnerId:function(){return this._ownerId},getProjId:function(){return this._projId},getOrgId:function(){return this._orgId},getUserGrpId:function(){return this._userGrpId},getObjectType:function(){return this._objectType},setRightList:function(e){this._RightList=e},setDataList:function(e){this._DataList=e},setObjectId:function(e){this._ObjectId=e},setObjectType:function(e){this._objectType=e},getRightList:function(){return this._RightList},getDataList:function(){return this._DataList},getObjectId:function(){return this._ObjectId}})}),define("DS/ShareWidget/ShareController",["UWA/Controls/Abstract","UWA/Json","DS/ShareWidget/ShareModel","DS/WidgetServices/WidgetServices","DS/WAFData/WAFData","DS/WidgetServices/securityContextServices/SecurityContextServices","i18n!DS/ShareWidget/assets/nls/langAR"],function(e,t,n,a,r,i,o){var s=a.getProdLevel();return e.extend({defaultOptions:{uniqueRightList:!1,wintop:!1,serverName:"",serverUri:"",isReadOnly:!1,odtMode:!1,parent:null},init:function(e,t){s=a.getProdLevel(),this.widget=e,this.AccessRightModelList=[],this.ECToParentMap=JSON.parse("[]"),this.IdToECMap=JSON.parse("[]"),this.SelectedItemsMap=JSON.parse("[]"),this.ExistingECItemsMap=JSON.parse("[]"),this.AggrItemsMap=JSON.parse("[]"),this.ErrorExistingECAndAggrItemsMap=JSON.parse("[]"),this.SelectedItems=[],this.SelectedItemsTypeMap=JSON.parse("[]"),this.NonEmbeddedComponentList=[],this._bInitDatas=!1,this._options=t,this._parent(t),this.accessLogicalNlsMap={},this.listOfValidIDs=[],this.listOfInvalidIDs=[],this.widgetSecurityContext="";var n="";if(null!=e)if(e.hasOwnProperty("pad_security_ctx"))0!=(n=e.pad_security_ctx).indexOf("ctx::")&&(n="ctx::"+n);else if("function"==typeof e.hasPreference&&null!=e.getPreference("pad_security_ctx"))n=e.getPreference("pad_security_ctx").value;else if("function"==typeof e.hasPreference&&e.hasPreference("xPref_CREDENTIAL")){var r=e.getPreference("xPref_CREDENTIAL");void 0!==r.value&&null!==r.value&&r.hasOwnProperty("value")&&(n="ctx::"+r.value)}this.widgetSecurityContext=n},getRightList:function(e){var t=[];return 1==this.options.uniqueRightList?this.AccessRightModelList.length>0&&(t=this.AccessRightModelList[0].getRightList()):this.AccessRightModelList.every(function(n){return n.getObjectId()!=e||(t=n.getRightList(),!1)}),t},getFormattedRightList:function(e){var t=this.getRightList(e),n=[];return t.forEach(function(e,t){var a={label:e.nls,value:e.logical};n.push(a)}),n},getOwnership:function(e){var t=[];return this.AccessRightModelList.every(function(n){return n.getObjectId()!=e||(t=n.getDataList(),!1)}),t},isInherited:function(e,t){var n=this.getOwnershipFromOwner(e,t),a=!1;return null!=n&&n.hasOwnProperty("inheritedPath")&&n.inheritedPath.length>0&&(a=!0),a},getOwner:function(e,t){var n=this.getOwnershipFromOwner(e,t);return null==n?null:n.owner},getOwnershipFromOwner:function(e,t){var n=this.getOwnership(e),a=null,r=this;return n.every(function(e){return 1!=r.ownerAreSame(e.owner,t).same||(a=e,!1)}),a},getFusionOwnership:function(){var e=this,t=[];return e.options.odtMode&&this.AccessRightModelList.length>0&&(this.AccessRightModelList[0]._DataList[0]={owner:{comment:"-",person:{personID:"svc_qauser1_PRJ",personFullName:"Mr svc_qauser1",personFirstName:"Mr",personLastName:"svc_qauser1"},collabSpace:{collabSpaceID:"TestCollabSpace1"},organization:{orgID:"Company Name"}},access:{logical:"Basic"},inheritedPath:[]}),this.AccessRightModelList.forEach(function(n,a){var r=n.getDataList();if(0==a)r.forEach(function(e){t.push({ownership:e,isTrueComment:!0,inheritedPath:!0})});else{var i=[];t.forEach(function(t){element=t.ownership,r.every(function(n){if(element.access.logical==n.access.logical){var a=e.ownerAreSame(element.owner,n.owner);if(1==a.same){if(0==t.hasOwnProperty("isTrueComment")&&(t.isTrueComment=!0),0==a.sameComment&&(element.owner.comment=UWA.i18n("DifferentFromItem"),t.isTrueComment=!1),0==t.hasOwnProperty("isTrueInheritedPath")&&(t.isTrueInheritedPath=!0),1==t.isTrueInheritedPath){var r=!0;if(1==element.hasOwnProperty("inheritedPath")||1==n.hasOwnProperty("inheritedPath")?1==element.hasOwnProperty("inheritedPath")&&1==n.hasOwnProperty("inheritedPath")?((element.inheritedPath.length<=0||n.inheritedPath.length<=0)&&(t.isAllInherit=!1),r=e.inheritedPathAreSame(element.inheritedPath,n.inheritedPath)):r=!1:element.isAllInherit=!1,0==r){var o=[{inheritedFrom:{objectID:"undefined",objectTNR:UWA.i18n("DifferentFromItem")},inheritedAccess:{logical:UWA.i18n("DifferentFromItem")}}];element.inheritedPath=o}}return i.push(t),!1}}return!0})}),t=i}}),t},inheritedPathAreSame:function(e,t){var n=!0;if(e.length==t.length){var a=t.slice();e.every(function(e){var t=!1;return a.every(function(n,r){return e.inheritedFrom.objectID!=n.inheritedFrom.objectID||(a.splice(r,1),t=!0,!1)}),0!=t||(n=!1,!1)})}else n=!1;return n},ownerAreSame:function(e,t){var n=!0,a=!1;return(e.hasOwnProperty("person")||t.hasOwnProperty("person"))&&(e.hasOwnProperty("person")&&t.hasOwnProperty("person")?e.person.personID!=t.person.personID&&(n=!1):n=!1),(1==n&&e.hasOwnProperty("collabSpace")||t.hasOwnProperty("collabSpace"))&&(e.hasOwnProperty("collabSpace")&&t.hasOwnProperty("collabSpace")?e.collabSpace.collabSpaceID!=t.collabSpace.collabSpaceID&&(n=!1):n=!1),(1==n&&e.hasOwnProperty("organization")||t.hasOwnProperty("organization"))&&(e.hasOwnProperty("organization")&&t.hasOwnProperty("organization")?e.organization.orgID!=t.organization.orgID&&(n=!1):n=!1),(1==n&&e.hasOwnProperty("userGrp")||t.hasOwnProperty("userGrp"))&&(e.hasOwnProperty("userGrp")&&t.hasOwnProperty("userGrp")?e.userGrp.userGrpID!=t.userGrp.userGrpID&&(n=!1):n=!1),(1==n&&e.hasOwnProperty("group")||t.hasOwnProperty("group"))&&(e.hasOwnProperty("group")&&t.hasOwnProperty("group")?e.group.groupURI!=t.group.groupURI&&(n=!1):n=!1),(e.hasOwnProperty("comment")||t.hasOwnProperty("comment"))&&e.hasOwnProperty("comment")&&t.hasOwnProperty("comment")&&e.comment==t.comment&&(a=!0),{same:n,sameComment:a}},_accessListContainsAccess:function(e,t){var n=!1;0==e.length&&(n=!0);for(var a=0;a<e.length;a++)if(e[a].logical==t.logical){n=!0;break}return n},_accessListSame:function(e,t){if(returnedValue=!0,e.length!=t.length)returnedValue=!1;else{var n=t.slice(),a=!0;e.every(function(e){var t=!1;return n.every(function(a,r){return e.logical!=a.logical||(t=!0,n.splice(r,1),!1)}),0!=t||(a=!1,!1)}),0==a&&(returnedValue=!1)}return returnedValue},onLoad:function(){this.AccessRightModelList=[],this.widget=widget,this.AccessRightModelList=[],this.ECToParentMap=JSON.parse("[]"),this.IdToECMap=JSON.parse("[]"),this.SelectedItemsMap=JSON.parse("[]"),this.ExistingECItemsMap=JSON.parse("[]"),this.AggrItemsMap=JSON.parse("[]"),this.ErrorExistingECAndAggrItemsMap=JSON.parse("[]"),this.SelectedItems=[],this.SelectedItemsTypeMap=JSON.parse("[]"),this.NonEmbeddedComponentList=[],this._bInitDatas=!1},onRefresh:function(){var e=[];this.AccessRightModelList.forEach(function(t){e.push({objectID:t.getObjectId()})}),this.AccessRightModelList=[],this._addSelectedIdInList(e)},getCurrentSelectedItems:function(){var e=[];return this.AccessRightModelList.forEach(function(t){e.push({objectID:t.getObjectId()})}),e},isPovUserGroup:function(e,t){var n=this._getModel(e);return null!=n&&n.getUserGrpId()==t},_getModel:function(e){for(var t=0;t<this.AccessRightModelList.length;t++){var a=this.AccessRightModelList[t];if(a.getObjectId()==e)return a}var r=new n(e);return this.AccessRightModelList.push(r),r},flatten:function(e){var t=this;return e.reduce(function(e,n){return e.concat(Array.isArray(n)?t.flatten(n):n)},[])},parseResponse:function(e){let t=[];if(!UWA.is(e.collabspaces,"array"))return t;let n=[...new Set(this.flatten(e.collabspaces.map(e=>e.couples.map(e=>e.organization.name))))].length>1;return e.collabspaces.forEach(e=>{e.couples.forEach(a=>{var r=null==a.role.nls||""==a.role.nls?a.role.name:a.role.nls,i=a.role.name,o=a.organization.name,s=a.organization.title,c=e.name,l=e.title?e.title:e.name;let d=n?l+" ● "+s+" ● "+r:l+" ● "+r,h="ctx::"+i+"."+o+"."+c;t.push({displayName:d,ctx:h})})}),t.sort((e,t)=>e.displayName.localeCompare(t.displayName,void 0,{numeric:!0,sensitivity:"base"}))},_createFilterPayload:function(e,t){let n={Command:t,SecurityContexts:e.map(e=>e.ctx)};return JSON.stringify(n)},isAdminCred:function(e){let t=e.match(/(ctx::)([^.]+)/);return t.length>2&&"VPLMAdmin"===t[2]},adminFilterPatch:function(e){var t=this;return e.filter(e=>!t.isAdminCred(e))},filterCredentials:function(e,t,n,a,r){var i=this,o=i._createFilterPayload(t,n);this._post3("/resources/lifecycle/util/filterValidSCs",o,function(e){e.status&&"success"===e.status&&a(i.adminFilterPatch(e.data))},function(e){r(e)})},_loadCredentials:function(e,t,n){var a=this;this._get("/resources/modeler/pno/person",{current:"true",select:"collabspaces&select=preferredcredentials"},function(e){t(a.parseResponse(e))},function(e){n(e)})},_fillAttributesOfSelectedItems:function(e,t,n){for(var a=[],r=e.length,i=[],o=[],s=0;s<r;s++){var c="";if(null!=e[s].type&&(c=e[s].type),null!=e[s].typeDisplayName&&(c=e[s].typeDisplayName),0==s)i.push(c),o.push(e[s].physicalId);else{for(var l=!1,d=0;d<i.length;d++)if(i[d]===c){l=!0;break}0==l&&(i.push(c),o.push(e[s].physicalId))}}var h=o.length;for(d=0;d<h;d++){var p=o[d];a.push({objectID:p,type:i[d]})}var m=a;this._post2("/resources/accessRightServices/ar/isTypeSupportedToCommand",m,function(e,n){t(e,n)},function(e){n(e)})},_setValidInvalidIdList(e,t){this.listOfValidIDs=e,this.listOfInvalidIDs=t},_fillModels:function(e){for(var t=this,n=e.length,a=0;a<n;a++){var r=e[a];if(null!==r){var i=t._getModel(r.physicalId);null!=i&&(t.IdToECMap[r.physicalId]=r.v_IsEmbeddedComponent,t.SelectedItemsMap[r.physicalId]=r,t.SelectedItemsTypeMap[r.type]=r,i.setPOV(r.owner+"_PRJ",r.project,r.organization),i.setObjectType(r.type))}}if(t.SelectedItems=e.splice(0),0==t._bInitDatas){var o=[];t._bInitDatas=!0,t.AccessRightModelList.forEach(function(e){t.NonEmbeddedComponentList.push(e.getObjectId()),o.push({objectID:e.getObjectId()})}),t._getAccessListForIds(o)}},_getSecurityContext:function(e,t){var n=this;i.getInstance().getSecurityContext({onSuccess:function(t){var a="";null!=t&&null!=t.SecurityContext&&0!=(a=t.SecurityContext).indexOf("ctx::")&&(a="ctx::"+a),""!=n.widgetSecurityContext?e(n.widgetSecurityContext):e(a)},onFailure:function(e){t(e)}})},_post2:function(e,n,r,i){var s=this;datasString=t.encode({requests:n}),this._getSecurityContext(function(t){a.get3DSpaceUrlAsync({onComplete:function(n){var c=n+e,l={Accept:"application/json","Content-Type":"application/json"};l.SecurityContext=encodeURIComponent(t),l["Accept-Language"]=widget.lang;var d=a.getTenantID();d&&0!=d.length?c+="?tenant="+d:c+="?tenant=OnPremise",a.partitionedAuthenticatedRequest(c,{method:"POST",headers:l,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:o.get(""),progressBarContext:s.options.contextArea1,progressBarWaitContext:s.options.progressBarWaitContext,data:datasString,type:"json",onComplete:function(e){r(e,n)},onFailure:function(e){i(e)},onTimeout:function(){i("timeout")}})},serverUrl:s.options.serverUrl,wintop:s.options.wintop})},function(e){i(e)})},_post:function(e,t,n,r){var i=this;this._getSecurityContext(function(s){a.get3DSpaceUrlAsync({onComplete:function(c){var l=c+e,d={Accept:"application/json","Content-Type":"application/json"};d.SecurityContext=encodeURIComponent(s);var h=a.getTenantID();h&&0!=h.length?l+="?tenant="+h:l+="?tenant=OnPremise",a.partitionedAuthenticatedRequest(l,{method:"POST",headers:d,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:o.get("AR_RetrievingAttributes"),progressBarContext:i.options.contextArea1,progressBarWaitContext:i.options.progressBarWaitContext,data:UWA.Json.encode(t),type:"json",onComplete:function(e){n(e)},onFailure:function(e){r(e)},onTimeout:function(){r("timeout")}})},serverUrl:i.options.serverUrl,wintop:i.options.wintop})},function(e){r(e)})},_post3:function(e,t,n,r){var i=this;this._getSecurityContext(function(s){a.get3DSpaceUrlAsync({onComplete:function(c){var l=c+e,d={Accept:"application/json","Content-Type":"application/json"};d.SecurityContext=encodeURIComponent(s);var h=a.getTenantID();h&&0!=h.length?l+="?tenant="+h:l+="?tenant=OnPremise",a.partitionedAuthenticatedRequest(l,{method:"POST",headers:d,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:o.get(""),progressBarContext:i.options.contextArea1,progressBarWaitContext:i.options.progressBarWaitContext,data:t,type:"json",onComplete:function(e){n(e)},onFailure:function(e){r(e)},onTimeout:function(){r("timeout")}})},serverUrl:i.options.serverUrl,wintop:i.options.wintop})},function(e){r(e)})},_get:function(e,t,n,i){var o=this;this._getSecurityContext(function(i){a.get3DSpaceUrlAsync({onComplete:function(c){var l=c+e,d={Accept:"application/json","Content-Type":"application/json"};d.SecurityContext=encodeURIComponent(i);var h=a.getTenantID();h&&0!=h.length?l+="?tenant="+h:l+="?tenant=OnPremise",t.hasOwnProperty("current")&&t.hasOwnProperty("select")&&(l+="&current="+t.current+"&select="+t.select);var p="";2==s&&(p="passport"),r.authenticatedRequest(l,{type:"json",method:"GET",headers:d,proxy:p,data:"",onComplete:function(e){n(e)},onFailure:function(e,t,n){o._onFailureAvailability(e,t,n)},onTimeout:function(){o._onTimeoutAvailability(items)}})},serverUrl:o.options.serverUrl,wintop:o.options.wintop})},function(e){i(e)})},_addSelectedIdInList:function(e){var n=this;this.options.serverName,this.options.serverUri;this._getSecurityContext(function(r){a.get3DSpaceUrlAsync({onComplete:function(i){var c="",l=a.getRealPath("assets/dataRightList.json",n.widget),d="GET",h="";2==s&&(h="passport"),2==s&&(c='{ "businessObject": '+t.encode(e)+"}",l=n.options.hasOwnProperty("odtmode")&&n.options.odtmode?i+"/resources/pno/ownership/logicalaccess":0===e[0].objectID.indexOf("cid:")?i+"/resources/lifecycle/ownership/logicalaccess":i+"/resources/pno/ownership/logicalaccess",d="POST"),headers={Accept:"application/json"},headers["Content-Type"]="application/json",headers["Accept-Language"]=widget.lang,headers.SecurityContext=encodeURIComponent(r),n.RightList=[];var p=a.getTenantID();p&&0!=p.length?l+="?tenant="+p:l+="?tenant=OnPremise",a.partitionedAuthenticatedRequest(l,{type:"json",method:d,headers:headers,proxy:h,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:o.get(""),progressBarContext:n.options.contextArea1,progressBarWaitContext:n.options.progressBarWaitContext,data:c,onComplete:function(t){n._onCompleteRightList(t,e)},onFailure:function(e,t,a){n._onFailure(e,t,a)},onTimeout:function(){n._onTimeout()}})},serverUrl:n.options.serverUrl,wintop:n.options.wintop})},function(e){onError(e)})},_onFailure:function(e,t,n){var a={};a=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("UnknownError"),code:"ERROR"},this.dispatchEvent("onError",a)},_onTimeout:function(){var e={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.dispatchEvent("onError",e)},_onCompleteRightList:function(e,t){var n=this,a=e.accessList,r=null,i=[];t.forEach(function(e){var t=n._getModel(e.objectID);i.push(t)});var o=-1,s=-1;a.every(function(e,t){var a=!1;if(i.every(function(t,n){return s=n,t.getObjectId()!=e.objectID||(t.setRightList(e.access),a=!0,!1)}),1==a&&1==n.options.uniqueRightList){var c=!0;if(0==n.AccessRightModelList.length&&t>0&&o>=0?c=n._accessListSame(i[o].getRightList(),e.access):n.AccessRightModelList.length>0&&(c=n._accessListSame(n.AccessRightModelList[0].getRightList(),e.access)),0==c){for(var l=!0,d={logical:"Reader",nls:"Can Read"},h={logical:"Read",nls:"Read"},p=n._accessListContainsAccess(n.AccessRightModelList[0].getRightList(),d),m=n._accessListContainsAccess(n.AccessRightModelList[0].getRightList(),h),u=0;u<n.AccessRightModelList.length;u++)p?0==n._accessListContainsAccess(n.AccessRightModelList[u].getRightList(),d)&&(l=!1):m&&0==n._accessListContainsAccess(n.AccessRightModelList[u].getRightList(),h)&&(l=!1);return r={message:UWA.i18n("ErrorDismatchAccessList"),code:""},l?n.dispatchEvent("onWarning",r):n.dispatchEvent("onError",r),n.dispatchEvent("onDataLoaded"),!1}o=s}return!0})},_getAccessListForIds:function(e){var n=this,r=[];if(null!=n.SelectedItemsTypeMap){Object.keys(n.SelectedItemsTypeMap).map(function(e){return n.SelectedItemsTypeMap[e]}).forEach(function(e){null!=e&&r.push({objectID:e.physicalId})})}this.options.serverName,this.options.serverUri;this._getSecurityContext(function(i){a.get3DSpaceUrlAsync({onComplete:function(c){var l="",d=a.getRealPath("assets/dataRightList.json",n.widget),h="GET",p="";2==s&&(p="passport"),2==s&&(l='{ "businessObject": '+t.encode(r)+"}",d=n.options.hasOwnProperty("odtmode")&&n.options.odtmode?c+"/resources/pno/ownership/logicalaccess":r.length>0&&0===r[0].objectID.indexOf("cid:")?c+"/resources/lifecycle/ownership/logicalaccess":c+"/resources/pno/ownership/logicalaccess",h="POST"),headers={Accept:"application/json"},headers["Content-Type"]="application/json",headers["Accept-Language"]=widget.lang,headers.SecurityContext=encodeURIComponent(i),n.RightList=[];var m=a.getTenantID();m&&0!=m.length?d+="?tenant="+m:d+="?tenant=OnPremise",a.partitionedAuthenticatedRequest(d,{type:"json",method:h,headers:headers,proxy:p,cancelCallback:function(){return!1},partisionedProgressLabel:o.get(""),progressBarContext:n.options.contextArea1,progressBarWaitContext:n.options.progressBarWaitContext,data:l,timeout:864e5,onComplete:function(t){n._onCompleteGetAccessListForIds(t,e)},onFailure:function(e,t,a){n._onFailure(e,t,a)},onTimeout:function(){n._onTimeout()}})},serverUrl:n.options.serverUrl,wintop:n.options.wintop})},function(e){onError(e)})},_onCompleteGetAccessListForIds:function(e,t){var n=this,a=e.accessList,r=null,i=[],o=-1,s=-1;a.every(function(e,t){e.access.forEach(function(e){n.accessLogicalNlsMap[e.logical]=e.nls});var a=e.objectID,c=n.SelectedItemsMap[a],l=null;if(null!=c&&(l=c.type),n.AccessRightModelList.every(function(t,n){return s=n,t.getObjectType()!=l||(t.setRightList(e.access),itemFound=!0,!1)}),1==itemFound&&1==n.options.uniqueRightList){var d=!0;if(0==n.AccessRightModelList.length&&t>0&&o>=0?d=n._accessListSame(i[o].getRightList(),e.access):n.AccessRightModelList.length>0&&(d=n._accessListSame(n.AccessRightModelList[0].getRightList(),e.access)),0==d){for(var h=!0,p={logical:"Reader",nls:"Can Read"},m={logical:"Read",nls:"Read"},u=n._accessListContainsAccess(n.AccessRightModelList[0].getRightList(),p),g=n._accessListContainsAccess(n.AccessRightModelList[0].getRightList(),m),f=0;f<n.AccessRightModelList.length;f++)u?0==n._accessListContainsAccess(n.AccessRightModelList[f].getRightList(),p)&&(h=!1):g&&0==n._accessListContainsAccess(n.AccessRightModelList[f].getRightList(),m)&&(h=!1);return r={message:UWA.i18n("ErrorDismatchAccessList"),code:""},h?n.dispatchEvent("onWarning",r):n.dispatchEvent("onError",r),n.dispatchEvent("onDataLoaded"),!1}o=s}return n.dispatchEvent("onDataLoaded"),!0})},parseDataForRequest:function(e){for(var t=[],n=0;n<e.length;n++)if(null!=e[n].physicalId){e[n].physicalId,e[n].category;t.push(e[n].physicalId)}return t},_onCompleteDataList:function(e){var t=this;1==e.success?(e.ownershipVector.forEach(function(e){t.AccessRightModelList.every(function(t){return t.getObjectId()!=e.objectID||(t.setDataList(e.ownership),!1)})}),t.dispatchEvent("onDataLoaded")):e.hasOwnProperty("error")&&t.dispatchEvent("onError",e.error)},modifyDataWithSC:function(e,n,r){var i=this,o={Accept:"application/json","Content-Type":"application/json"};if(null!=r&&""!=r&&r.hasOwnProperty("SecurityContext")){0!=r.SecurityContext.indexOf("ctx::")&&"ctx::",o.SecurityContext=encodeURIComponent(r.SecurityContext);var c=i.getAggrItemList();if(e.length>0&&null!=c){var l=[],d=Object.keys(c);e.length>0&&d.forEach(function(t){var n={objectID:t,ownership:e[0].ownership};l.push(n),e.push(n)})}this.options.serverName,this.options.serverUri;for(var h=[],p=0;p<n.length;p++)h.indexOf(n[p])<0&&h.push(n[p]);a.get3DSpaceUrlAsync({onComplete:function(n){var c="POST",l="",d=a.getRealPath("assets/validModification.json",i.widget),p=t.encode({requests:h});2==s&&(l="passport");2==s&&(d=n+"/resources/accessRightServices/ar/getCompletedData",c="POST"),o["Accept-Language"]=widget.lang;var m=a.getTenantID();m&&0!=m.length?d+="?tenant="+m:d+="?tenant=OnPremise",a.partitionedAuthenticatedRequest(d,{type:"json",method:c,proxy:l,headers:o,cancelCallback:function(){return!1},data:p,timeout:36e5,onComplete:function(t){for(var n=0;n<t.results.length;n++)if(null!=t.results[n].invalidList&&t.results[n].invalidList.length>0){t.results[n].invalidList.forEach(function(t){void 0!==i.SelectedItemsMap[t]&&null!==i.SelectedItemsMap[t]&&(i.ErrorExistingECAndAggrItemsMap[t]=i.SelectedItemsMap[t]);for(var n=0;n<e.length;n++)e[n].objectID===t&&e.splice(n,1)})}else if(null!=t.results[n].validList&&t.results[n].validList.length>0){var a=[];a=t.results[n].validList,expandedOwnershipItems=[],a.forEach(function(t){null!=i.SelectedItemsMap[t]&&null!==i.SelectedItemsMap[t]||null!=i.AggrItemsMap[t]&&null!==i.AggrItemsMap[t]||e.length>0&&expandedOwnershipItems.push({objectID:t,ownership:e[0].ownership})}),expandedOwnershipItems.forEach(function(t){e.push(t)})}i.getAndAddAggregatedItemsForUpdate(e,r)},onFailure:function(e,t,n){i._onFailure(e,t,n)},onTimeout:function(){i._onTimeout()}})},serverUrl:i.options.serverUrl,wintop:i.options.wintop})}else{var m={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};i.dispatchEvent("onError",m)}},getAndAddAggregatedItemsForUpdate:function(e,t){this.commitWithSCPCS(e,t)},commitWithSCPCS:function(e,n){var r=this,i={Accept:"application/json","Content-Type":"application/json"};if(null!=n&&""!=n&&n.hasOwnProperty("SecurityContext")){0!=n.SecurityContext.indexOf("ctx::")&&"ctx::",i.SecurityContext=encodeURIComponent(n.SecurityContext);this.options.serverName,this.options.serverUri;this._getSecurityContext(function(n){a.get3DSpaceUrlAsync({onComplete:function(o){var c="",l=a.getRealPath("assets/validModification.json",r.widget);2==s&&(c="passport"),2==s&&(l=r.options.hasOwnProperty("odtmode")&&r.options.odtmode?o+"/resources/pno/ownership/update":0===e[0].objectID.indexOf("cid:")?o+"/resources/lifecycle/ownership/update":o+"/resources/pno/ownership/update");var d='{ "ownershipVector": '+t.encode(e)+"}";console.log("<<<<<<<<<<< Data to send = "+d);var h={ov:e};r.dispatchEvent("fireWintopNotif",h),i["Accept-Language"]=widget.lang,i.SecurityContext=encodeURIComponent(n);var p=a.getTenantID();p&&0!=p.length?l+="?tenant="+p:l+="?tenant=OnPremise",a.partitionedAuthenticatedRequest(l,{type:"json",method:"POST",proxy:c,headers:i,cancelCallback:function(){return!1},data:d,timeout:864e5,onComplete:function(e){!0===r._options.odtMode?null!==r.options.parent&&r.options.parent.ODTModificationComplete(e):r.dispatchEvent("onModificationComplete",e)},onFailure:function(e,t,n){r._onFailure(e,t,n)},onTimeout:function(){r._onTimeout()}})},serverUrl:r.options.serverUrl,wintop:r.options.wintop})},function(e){onError(e)})}else{var o={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(o)}},getSelectedItemList:function(){return this.SelectedItems},getErrorSelectedItemList:function(){return this.ErrorExistingECAndAggrItemsMap},getAggrItemList:function(){return this.AggrItemsMap}})}),define("DS/ShareWidget/ShareWidget",["UWA/Core","UWA/Controls/Input","DS/UIKIT/Image","UWA/Controls/Abstract","UWA/Json","DS/WAFData/WAFData","DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant","DS/ErrorWidget/ErrorWidget","DS/DataGridWidget/DataGridWidget","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WarningWidget/WarningWidget","DS/ShareWidget/ShareController","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Spinner","DS/UIKIT/Input/ButtonGroup","DS/Logger/Logger","DS/WebToWinInfra/WebToWinCom","DS/Controls/Toggle","DS/UIKIT/Input/Text","UWA/Event","DS/ReportingPanel/ReportingPanel","css!DS/ShareWidget/ShareWidget.css","i18n!DS/ShareWidget/assets/nls/langAR"],function(e,t,n,a,r,i,o,s,c,l,d,h,p,m,u,g,f,S,v,A,y,C,b,w,_,I){"use strict";UWA.debug=!0;var R=d.getProdLevel();return a.extend({defaultOptions:{className:"",ForbiddenChar:'"#$@%*,?\\<>[]|:',setValidButton:!0,setCloseButton:!0,showTopBar:!0,wintop:!1,topClassHeight:"SH_MasterContain",readOnly:"auto",displayWarningForAutoRO:!1,serverName:"",serverUri:"",activeMultisel:!0,activeComment:!1,serverUrl:""},init:function(e,t,n){if(this._parent(n),1==this.options.wintop&&(this.webToWinCom_Socket=A.createSocket({socket_id:"webinwinAccessRights_socket_"+Math.floor(1e5*Math.random()+1)}),void 0!==this.options.serverUrl&&this.options.serverUrl.length>0&&void 0!==this.options.serverUrl[0].platformId)){var a=this.options.serverUrl[0].platformId;d.setTenantID(a)}this.widgetSecurityContext={};var r="";if(null!=e){if(e.hasOwnProperty("pad_security_ctx"))0!=(r=e.pad_security_ctx).indexOf("ctx::")&&(r="ctx::"+r);else if("function"==typeof e.hasPreference&&null!=e.getPreference("pad_security_ctx"))r=e.getPreference("pad_security_ctx").value;else if("function"==typeof e.hasPreference&&e.hasPreference("xPref_CREDENTIAL")){var i=e.getPreference("xPref_CREDENTIAL");void 0!==i.value&&null!==i.value&&i.hasOwnProperty("value")&&(r="ctx::"+i.value)}r.length>0&&(this.widgetSecurityContext={SecurityContext:r})}this.isODT=!1,void 0!==typeof this.options&&null!==this.options&&this.options.hasOwnProperty("odtmode")&&(this.isODT=this.options.odtmode),R=d.getProdLevel(),this.options.activeMultisel=this.options.activeMultisel||d.isMultiSelODT(),this.options.activeComment=this.options.activeComment||d.isCommentODT(),this._initDataStructures(),this.isReadOnly=!1,this.listID=[],this.listOfIds=[],this.listOfAddedMembers=[],this.listOfPrivateProjects=[],this.listOfValidIDs=[],this.listOfInvalidIDs=[],this.arDone=!1,!0===this.options.readOnly&&(this.isReadOnly=!0),this.widget=e,this.parentWidget=t,this.SearchWidget_View=[];var o=UWA.i18n("AR_Status"),s=UWA.i18n("AR_Title"),c=UWA.i18n("AR_Sum_Type"),l=UWA.i18n("AR_Revision"),h=UWA.i18n("AR_Sum_Org"),p=UWA.i18n("AR_Sum_Collab"),m=UWA.i18n("AR_Sum_Resp"),u=UWA.i18n("AR_Result");this.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:o,dataIndex:"Status",typeRepresentation:"icon"},{text:s,dataIndex:s},{text:c,dataIndex:c},{text:l,dataIndex:l},{text:h,dataIndex:h},{text:p,dataIndex:p},{text:m,dataIndex:m},{text:u,dataIndex:u}],this.initUI()},_initDataStructures:function(){this.objectIds={},this.listOfError=[],this.SelectedItemsWithEC=[],this.ctxObjectIds=[],this.SelectedItems=[],this.dumpSection=null,this.firstInit=!0,this.arDone=!1,this._bAddUserError=!1,this.listInputErrors=[],this.listInvalidPovOwnerErrorMsg=[],this.listInvalidPovCollabSpaceErrorMsg=[],this.containsInheritedAccess=!1,this.csoTableLines=[],void 0===this.commentBox&&(this.commentBox=null),void 0===this.textArea&&(this.textArea=null)},createWebInWinSocket:function(e){return A.createSocket({socket_id:e+Math.floor(1e5*Math.random()+1)})},fireWintopCommand:function(e,t,n){var a=n+"\n",r="";if("onModificationAccessRights"===n){var i=null;t.hasOwnProperty("ov")&&(i=t.ov),i.forEach(function(e,t){if(e.hasOwnProperty("ownership")){var n=e.objectID;r=n,e.ownership.forEach(function(e,t){var n,r=e.operation,i=e.access.logical;e.owner.hasOwnProperty("person")?n=e.owner.person.personID:e.owner.hasOwnProperty("collabSpace")&&(n=e.owner.collabSpace.collabSpaceID),a=a+" "+r+" "+i+" "+n+"\n"})}})}var o={severity:"warning",ID:r,message:a},s=A.createJSONArrayMessage(n,o);s.length>0&&e.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayMessageODT",notif_parameters:s},"lf_web_in_win")},initData:function(e){this.SelectedItems=[],this._initDataStructures(),this.ShareController.onLoad(),this.addDataPCS(e),this.getPrivateProjectList()},initDatafromWin:function(e){this.initData(e)},getPrivateProjectList:function(){var e=this;h.getInstance().getSecurityContext({onSuccess:function(t){e.widgetSecurityContext.hasOwnProperty("SecurityContext")?e.getListOfPrivateCS(e.widgetSecurityContext):e.getListOfPrivateCS(t)},onFailure:function(t){e.setError(t)}})},addDataPCS:function(e){var t=this;null==e&&(e=this.SelectedItems),"auto"==this.options.readOnly?h.getInstance().getSecurityContext({onSuccess:function(n){t.widgetSecurityContext.hasOwnProperty("SecurityContext")?t._testAvailability(e,t.widgetSecurityContext):t._testAvailability(e,n)},onFailure:function(e){t.setError(e)}}):this._addDataPCS(e)},_addDataPCS:function(e){this._ManageValidButton(!1),this.hideMainErrorArea();var t=[],n=this;if(1==this.options.activeMultisel?(null!=e&&(t=e.slice()),d.removeDuplicate(t,function(e){return e.physicalId}),t.forEach(function(e){d.arrayContains(n.SelectedItems,e,function(e){return e.physicalId})<0&&n.SelectedItems.push(e)})):null!=e&&e.length>0&&(n.SelectedItems=[],n.SelectedItems.push(e[0]),t.push(e[0])),n.SelectedItems.length<=0)return 1==this.options.wintop?this.showMainErrorArea(UWA.i18n("NoItemToDisplay")):this.showMainErrorArea(UWA.i18n("NoItemSelected")),this.hideMainLoadingArea(),this.hideMainComponent(),void n.dispatchEvent("onChangeSize");this.displayLoadingArea();n.SelectedItems.length>0&&(this.options.hasOwnProperty("odtmode")&&(this.ShareController.options.odtmode=this.options.odtmode),this.ShareController._fillAttributesOfSelectedItems(n.SelectedItems,function(e,t){for(var a=0;a<e.results.length;a++)e.results[a].validList.length>0&&(n.listOfValidIDs=n.listOfValidIDs.concat(e.results[a].validList)),e.results[a].invalidList.length>0&&(n.listOfInvalidIDs=n.listOfInvalidIDs.concat(e.results[a].validList));if(0==n.listOfValidIDs.length)n.isReadOnly=!0,n.addError(UWA.i18n("ShareNotSupported")),n._updateReadOnlyDisplay();else if(n.listOfInvalidIDs.length>0){for(var r="",i=0;i<n.listOfInvalidIDs.length;i++)for(var o=0;o<n.SelectedItems.length;o++)n.listOfInvalidIDs[i]===n.SelectedItems[o].physicalId&&(null==n.SelectedItems[o].name&&null==n.SelectedItems[o].name||(r=n.SelectedItems[o].name),n.SelectedItems.splice(o,1));1==n.listOfInvalidIDs.length?0!=r.length?n.addError(UWA.i18n("ShareNotSupportedFor{0}").format(r)):n.addError(UWA.i18n("ShareNotSupportedForSomeObjects{0}").format(n.listOfInvalidIDs.length)):n.listOfInvalidIDs.length>1&&n.addError(UWA.i18n("ShareNotSupportedForSomeObjects{0}").format(n.listOfInvalidIDs.length))}n.ShareController._setValidInvalidIdList(n.listOfValidIDs,n.listOfInvalidIDs),n.ShareController._fillModels(n.SelectedItems)},function(e){}))},hideElements:function(e,t){for(var n=e.getElements(t),a=n.length,r=0;r<a;r++){n[r].hide()}},showElements:function(e,t){for(var n=e.getElements(t),a=n.length,r=0;r<a;r++){n[r].show()}},destroy:function(){this.searchWidget&&this.searchWidget.destroy(),this._parent()},addSearchBox:function(e,t){var n=this,a=n.listOfAddedMembers.length;e="  "+e;var r=UWA.createElement("span",{id:"addedItem"+a,class:"SH_AddedItemContainer"}),i=UWA.createElement("span",{class:"SH_TextForItemContainer",text:e}).inject(r);UWA.createElement("span",{id:a,class:"SH_TextForItemContainer",text:"x"}).inject(i).addEventListener("click",function(){r.setStyle("display","none"),n.DeleteUser(this.id)}),"Viewer"===t?(n.showMember_CanView.show(),r.inject(n.showMember_CanView)):"Reader"===t?(n.showMember_CanRead.show(),r.inject(n.showMember_CanRead)):"Owner"===t?(n.showMember_CanManage.show(),r.inject(n.showMember_CanManage)):"Author"===t?(n.showMember_CanEdit.show(),r.inject(n.showMember_CanEdit)):"CanAddRemoveAttachments"===t?(n.showMember_CanAddRemoveAttachment.show(),r.inject(n.showMember_CanAddRemoveAttachment)):"Read"===t?(n.showMember_Read.show(),r.inject(n.showMember_Read)):"Add"===t?(n.showMember_Add.show(),r.inject(n.showMember_Add)):"Basic"===t?(n.showMember_Basic.show(),r.inject(n.showMember_Basic)):"ReadWrite"===t?(n.showMember_ReadWrite.show(),r.inject(n.showMember_ReadWrite)):"Remove"===t?(n.showMember_Remove.show(),r.inject(n.showMember_Remove)):"AddRemove"===t?(n.showMember_AddRemove.show(),r.inject(n.showMember_AddRemove)):"Full"===t?(n.showMember_Full.show(),r.inject(n.showMember_Full)):"Leader"===t?(n.showMember_Leader.show(),r.inject(n.showMember_Leader)):"Project Member"===t?(n.showMember_Member.show(),r.inject(n.showMember_Member)):"Project Lead"===t&&(n.showMember_ProjectLead.show(),r.inject(n.showMember_ProjectLead))},getSearchInput:function(e){var t=this;return o.getSearchWidget(o.RESTRICTED,{className:"share-item-view-wrapper",id:e,ForbiddenChar:this.options.ForbiddenChar,MaxNumber:"5",MaxSize:"300",topClassHeight:this.options.topClassHeight,position:"auto",serverName:this.options.serverName,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,exttype:s.EXTTYPE_USERGRP,showEmptyCategory:!1,hint:UWA.i18n("SearchPlaceHolder"),PrivateProjectList:t.listOfPrivateProjects,events:{onValid:function(){t.AddUser(e)&&(t._ManageValidButton(!0),1==t.options.activeComment&&t.searchComment.show(),t.addSearchBox(this.searchInput.getValue(),this.options.id),t.dispatchEvent("onChangeSize")),this.searchInput.setValue("")},onUnvalid:function(){1==t.options.activeComment&&t.searchComment.hide(),t.dispatchEvent("onChangeSize")},onError:function(e){t.setError(e)}}})},initUI:function(){var e=this,t=this.container=UWA.createElement("div",{name:"SH_MasterContain","data-rec-id":"SH_MasterContain",class:"SH_MasterContain "+e.options.className});this.globalDiv=UWA.createElement("div",{class:"SH_GlobalContain","data-rec-id":"datarecGlobalContain"}).inject(t);var n="SH_ManageButtonDiv";this.options.wintop&&(n="SH_ManageButtonDivWintop"),this.ManageButtonDiv=UWA.createElement("table",{class:n,"data-rec-id":"datarecManageButtonDiv",html:{}}),e.ManageButtonRight=UWA.createElement("td",{class:"SH_ManageButtonRight","data-rec-id":"datarecManageButtonRight"}),e.ManageButtonLeft=UWA.createElement("td",{class:"SH_ManageButtonLeft","data-rec-id":"datarecManageButtonLeft"}),e.loadingArea=new f({visible:!1});var a=null;e.boutonValid=new u({attributes:{title:UWA.i18n("")},name:"TopButtonValid",value:UWA.i18n("AR_mainTile"),className:"default medium AR_buttonTop primary",disabled:!0});var r=e.boutonValid.getContent();null!=r&&r.setAttribute("data-rec-id","boutonValid"),a=new u({attributes:{title:UWA.i18n(""),"data-rec-id":"datarecButtonCancel"},name:"TopButtonCancel",value:UWA.i18n("AR_CloseOverlay"),className:"default medium AR_buttonTop"}),e.boutonValid.addEvents({onClick:function(){e._ManageValidButton(!1),e.displayLoadingArea(),e.modifyDataPCS(),a.setValue(UWA.i18n("AR_Close"))}}),a.addEvents({onClick:function(){e._ManageValidButton(!1),e.dispatchEvent("onCancel")}}),e.loadingArea.inject(e.ManageButtonRight),e.mainInterface=UWA.createElement("div",{class:"SH_MainInterface","data-rec-id":"datarecMainInterface"}).inject(this.globalDiv).hide(),0==this.isReadOnly&&1==e.options.setValidButton&&e.boutonValid.inject(e.ManageButtonRight),1==e.options.setCloseButton&&a.inject(e.ManageButtonRight),e.ManageButtonLeft.inject(this.ManageButtonDiv),e.ManageButtonRight.inject(this.ManageButtonDiv),e.options.showTopBar&&this.ManageButtonDiv.inject(e.globalDiv),e.mainInterface=UWA.createElement("div",{class:"SH_MainInterface","data-rec-id":"datarecMainInterface"}).inject(this.globalDiv).hide(),e.mainLoading=UWA.createElement("div",{class:"SH_MainLoading","data-rec-id":"datarecMainLoading"}).inject(this.globalDiv),e.mainError=UWA.createElement("div",{class:"SH_MainError","data-rec-id":"datarecMainError"}).inject(this.globalDiv).hide(),e.copyLink=new C({placeholder:"link",rows:1}),e.copyLink.inject(this.globalDiv).hide(),e.addMemberPanel=UWA.createElement("div",{class:"shareaddmember-item-view-container expanded"}).inject(e.mainLoading),e.memberPanel=UWA.createElement("div",{class:"shareaddmember-item-view-body","data-rec-id":"datarecMemberPanel"}).inject(e.addMemberPanel),e.addMemberPanel=UWA.createElement("div",{class:"share-item-view-container highlighted","data-rec-id":"c10"}).inject(e.memberPanel),e.tableAddMember=UWA.createElement("table").inject(e.addMemberPanel),e.addMEmberContainer=UWA.createElement("tbody").inject(e.tableAddMember);e.options.ForbiddenChar;this.searchIconArr=[],e.canView=UWA.createElement("tr",{class:"tr-canView"}).inject(e.addMEmberContainer),e.canViewTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canView),e.canViewLabel=UWA.createElement("span",{id:"canView-label",text:I.get("CanView")}).inject(e.canViewTD),e.canViewHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("CanViewHelp")}).inject(e.canViewTD),e.canViewLabel.setStyle("text-align","left"),e.canViewLabel.setStyle("font-family","arial"),e.canViewLabel.setStyle("font-size","12px"),e.canViewSearchTD=UWA.createElement("td").inject(e.canView),e.showMember_CanView=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.canViewSearchTD).hide(),e.searchWidget_CanView=e.getSearchInput("Viewer").inject(e.canViewSearchTD),e.searchWidget_CanView.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canRead=UWA.createElement("tr",{class:"tr-canRead"}).inject(e.addMEmberContainer),e.canReadTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canRead),e.canReadLabel=UWA.createElement("span",{id:"canRead-label",text:I.get("CanRead")}).inject(e.canReadTD),e.canReadHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("CanReadHelp")}).inject(e.canReadTD),e.canReadLabel.setStyle("text-align","left"),e.canReadLabel.setStyle("font-family","arial"),e.canReadLabel.setStyle("font-size","12px"),e.canReadSearchTD=UWA.createElement("td").inject(e.canRead),e.showMember_CanRead=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Reader"}).inject(e.canReadSearchTD).hide(),e.searchWidget_CanRead=e.getSearchInput("Reader").inject(e.canReadSearchTD),e.searchWidget_CanRead.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canEdit=UWA.createElement("tr",{class:"tr-canEdit"}).inject(e.addMEmberContainer),e.canEditTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canEdit),e.canEditLabel=UWA.createElement("span",{id:"canEdit-label",text:I.get("CanEdit")}).inject(e.canEditTD),e.canEditHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("CanEditHelp")}).inject(e.canEditTD),e.canEditLabel.setStyle("text-align","left"),e.canEditLabel.setStyle("font-family","arial"),e.canEditLabel.setStyle("font-size","12px"),e.canEditSearchTD=UWA.createElement("td").inject(e.canEdit),e.showMember_CanEdit=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Author"}).inject(e.canEditSearchTD).hide(),e.searchWidget_CanEdit=e.getSearchInput("Author").inject(e.canEditSearchTD),e.searchWidget_CanEdit.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canManage=UWA.createElement("tr",{class:"tr-canManage"}).inject(e.addMEmberContainer),e.canManageTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canManage),e.canManageLabel=UWA.createElement("span",{id:"canManage-label",text:I.get("CanManage")}).inject(e.canManageTD),e.canManageHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("CanManageHelp")}).inject(e.canManageTD),e.canManageLabel.setStyle("text-align","left"),e.canManageLabel.setStyle("font-family","arial"),e.canManageLabel.setStyle("font-size","12px"),e.canManageSearchTD=UWA.createElement("td").inject(e.canManage),e.showMember_CanManage=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Owner"}).inject(e.canManageSearchTD).hide(),e.searchWidget_CanManage=e.getSearchInput("Owner").inject(e.canManageSearchTD),e.searchWidget_CanManage.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.leader=UWA.createElement("tr",{class:"tr-leader"}).inject(e.addMEmberContainer),e.leaderTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.leader),e.leaderLabel=UWA.createElement("span",{id:"leader-label",text:I.get("Leader")}).inject(e.leaderTD),e.leaderHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("LeaderHelp")}).inject(e.leaderTD),e.leaderLabel.setStyle("text-align","left"),e.leaderLabel.setStyle("font-family","arial"),e.leaderLabel.setStyle("font-size","12px"),e.leaderSearchTD=UWA.createElement("td").inject(e.leader),e.showMember_Leader=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Leader"}).inject(e.leaderSearchTD).hide(),e.searchWidget_Leader=e.getSearchInput("Leader").inject(e.leaderSearchTD),e.searchWidget_Leader.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.projectLead=UWA.createElement("tr",{class:"tr-projectLead"}).inject(e.addMEmberContainer),e.projectLeadTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.projectLead),e.projectLeadLabel=UWA.createElement("span",{id:"projectLead-label",text:I.get("ProjectLead")}).inject(e.projectLeadTD),e.projectLeadHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("ProjectLeadHelp")}).inject(e.projectLeadTD),e.projectLeadLabel.setStyle("text-align","left"),e.projectLeadLabel.setStyle("font-family","arial"),e.projectLeadLabel.setStyle("font-size","12px"),e.projectLeadSearchTD=UWA.createElement("td").inject(e.projectLead),e.showMember_ProjectLead=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_ProjectLead"}).inject(e.projectLeadSearchTD).hide(),e.searchWidget_ProjectLead=e.getSearchInput("Project Lead").inject(e.projectLeadSearchTD),e.searchWidget_ProjectLead.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.member=UWA.createElement("tr",{class:"tr-member"}).inject(e.addMEmberContainer),e.memberTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.member),e.memberLabel=UWA.createElement("span",{id:"member-label",text:I.get("Member")}).inject(e.memberTD),e.memberHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("MemberHelp")}).inject(e.memberTD),e.memberLabel.setStyle("text-align","left"),e.memberLabel.setStyle("font-family","arial"),e.memberLabel.setStyle("font-size","12px"),e.memberSearchTD=UWA.createElement("td").inject(e.member),e.showMember_Member=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Member"}).inject(e.memberSearchTD).hide(),e.searchWidget_Member=e.getSearchInput("Project Member").inject(e.memberSearchTD),e.searchWidget_Member.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canAddRemoveAttachment=UWA.createElement("tr",{class:"tr-canAddRemoveAttachment"}).inject(e.addMEmberContainer),e.canAddRemoveAttachmentTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canAddRemoveAttachment),e.canAddRemoveAttachmentLabel=UWA.createElement("span",{id:"canAddRemoveAttachment-label",text:I.get("CanAddRemoveAttachments")}).inject(e.canAddRemoveAttachmentTD),e.canAddRemoveAttachmentHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("CanAddRemoveAttachmentHelp")}).inject(e.canAddRemoveAttachmentTD),e.canAddRemoveAttachmentLabel.setStyle("text-align","left"),e.canAddRemoveAttachmentLabel.setStyle("font-family","arial"),e.canAddRemoveAttachmentLabel.setStyle("font-size","12px"),e.canAddRemoveAttachmentSearchTD=UWA.createElement("td").inject(e.canAddRemoveAttachment),e.showMember_CanAddRemoveAttachment=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_CanAddRemoveAttachments"}).inject(e.canAddRemoveAttachmentSearchTD).hide(),e.searchWidget_CanAddRemoveAttachment=e.getSearchInput("CanAddRemoveAttachments").inject(e.canAddRemoveAttachmentSearchTD),e.searchWidget_CanAddRemoveAttachment.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.read=UWA.createElement("tr",{class:"tr-read"}).inject(e.addMEmberContainer),e.readTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.read),e.readLabel=UWA.createElement("span",{id:"read-label",text:I.get("Read")}).inject(e.readTD),e.readHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("ReadHelp")}).inject(e.readTD),e.readLabel.setStyle("text-align","left"),e.readLabel.setStyle("font-family","arial"),e.readLabel.setStyle("font-size","12px"),e.readSearchTD=UWA.createElement("td").inject(e.read),e.showMember_Read=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.readSearchTD).hide(),e.searchWidget_Read=e.getSearchInput("Read").inject(e.readSearchTD),e.searchWidget_Read.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.add=UWA.createElement("tr",{class:"tr-add"}).inject(e.addMEmberContainer),e.addTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.add),e.addLabel=UWA.createElement("span",{id:"add-label",text:I.get("Add")}).inject(e.addTD),e.addHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("AddHelp")}).inject(e.addTD),e.addLabel.setStyle("text-align","left"),e.addLabel.setStyle("font-family","arial"),e.addLabel.setStyle("font-size","12px"),e.addSearchTD=UWA.createElement("td").inject(e.add),e.showMember_Add=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.addSearchTD).hide(),e.searchWidget_Add=e.getSearchInput("Add").inject(e.addSearchTD),e.searchWidget_Add.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.basic=UWA.createElement("tr",{class:"tr-basic"}).inject(e.addMEmberContainer),e.basicTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.basic),e.basicLabel=UWA.createElement("span",{id:"basic-label",text:I.get("Basic")}).inject(e.basicTD),e.basicHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("BasicHelp")}).inject(e.basicTD),e.basicLabel.setStyle("text-align","left"),e.basicLabel.setStyle("font-family","arial"),e.basicLabel.setStyle("font-size","12px"),e.basicSearchTD=UWA.createElement("td").inject(e.basic),e.showMember_Basic=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.basicSearchTD).hide(),e.searchWidget_Basic=e.getSearchInput("Basic").inject(e.basicSearchTD),e.searchWidget_Basic.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.readWrite=UWA.createElement("tr",{class:"tr-readWrite"}).inject(e.addMEmberContainer),e.readWriteTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.readWrite),e.readWriteLabel=UWA.createElement("span",{id:"readWrite-label",text:I.get("ReadWrite")}).inject(e.readWriteTD),e.readWriteHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("ReadWriteHelp")}).inject(e.readWriteTD),e.readWriteLabel.setStyle("text-align","left"),e.readWriteLabel.setStyle("font-family","arial"),e.readWriteLabel.setStyle("font-size","12px"),e.readWriteSearchTD=UWA.createElement("td").inject(e.readWrite),e.showMember_ReadWrite=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.readWriteSearchTD).hide(),e.searchWidget_ReadWrite=e.getSearchInput("ReadWrite").inject(e.readWriteSearchTD),e.searchWidget_ReadWrite.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.remove=UWA.createElement("tr",{class:"tr-remove"}).inject(e.addMEmberContainer),e.removeTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.remove),e.removeLabel=UWA.createElement("span",{id:"remove-label",text:I.get("Remove")}).inject(e.removeTD),e.removeHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("RemoveHelp")}).inject(e.removeTD),e.removeLabel.setStyle("text-align","left"),e.removeLabel.setStyle("font-family","arial"),e.removeLabel.setStyle("font-size","12px"),e.removeSearchTD=UWA.createElement("td").inject(e.remove),e.showMember_Remove=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.removeSearchTD).hide(),e.searchWidget_Remove=e.getSearchInput("Remove").inject(e.removeSearchTD),e.searchWidget_Remove.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.addRemove=UWA.createElement("tr",{class:"tr-addRemove"}).inject(e.addMEmberContainer),e.addRemoveTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.addRemove),e.addRemoveLabel=UWA.createElement("span",{id:"addRemove-label",text:I.get("AddRemove")}).inject(e.addRemoveTD),e.addRemoveHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("addRemoveHelp")}).inject(e.addRemoveTD),e.addRemoveLabel.setStyle("text-align","left"),e.addRemoveLabel.setStyle("font-family","arial"),e.addRemoveLabel.setStyle("font-size","12px"),e.addRemoveSearchTD=UWA.createElement("td").inject(e.addRemove),e.showMember_AddRemove=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.addRemoveSearchTD).hide(),e.searchWidget_AddRemove=e.getSearchInput("AddRemove").inject(e.addRemoveSearchTD),e.searchWidget_AddRemove.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.full=UWA.createElement("tr",{class:"tr-full"}).inject(e.addMEmberContainer),e.fullTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.full),e.fullLabel=UWA.createElement("span",{id:"full-label",text:I.get("Full")}).inject(e.fullTD),e.fullHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:I.get("FullHelp")}).inject(e.fullTD),e.fullLabel.setStyle("text-align","left"),e.fullLabel.setStyle("font-family","arial"),e.fullLabel.setStyle("font-size","12px"),e.fullSearchTD=UWA.createElement("td").inject(e.full),e.showMember_Full=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.fullSearchTD).hide(),e.searchWidget_Full=e.getSearchInput("Full").inject(e.fullSearchTD),e.searchWidget_Full.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canEditSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canReadSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canViewSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canManageSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canAddRemoveAttachmentSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.readSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.addSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.basicSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.readWriteSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.removeSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.addRemoveSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.fullSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.leaderSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.memberSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.projectLeadSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canRead.hide(),e.canManage.hide(),e.canEdit.hide(),e.canView.hide(),e.leader.hide(),e.canAddRemoveAttachment.hide(),e.read.hide(),e.add.hide(),e.basic.hide(),e.readWrite.hide(),e.remove.hide(),e.addRemove.hide(),e.full.hide(),e.member.hide(),e.projectLead.hide();e.selectRightNewUser=new g({nativeSelect:!0,placeholder:!1}),e.selectRightNewUser.elements.container.setAttribute("data-rec-id","dataRecselectRightNewUserContainer"),e.selectRightNewUser.elements.content.setAttribute("data-rec-id","dataRecselectRightNewUser"),e.errorOverlay=new c(e.widget,e.container,{className:"errorComponent_AccessRight","data-rec-id":"datarecErrorComponentAccessRight"}),this.ShareController=new m(e.widget,{uniqueRightList:!this.isReadOnly,serverName:this.options.serverName,wintop:this.options.wintop,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,isReadOnly:this.isReadOnly,odtMode:this.isODT,parent:this,contextArea2:this.ManageButtonLeft,progressBarWaitContext:e.container,events:{onError:function(t){e.hideFailMainLoadingArea(),e.addError(t)},onWarning:function(t){e.addError(t)},onDataLoaded:function(){if(null!=e.container.getParent()){e.hideMainLoadingArea();var t=e.ShareController.getFormattedRightList();e.selectRightNewUser.add(t,!0),t.length>0&&(e.selectRightNewUser.setValue(t[0]),t.forEach(function(t){"Reader"===t.value?e.canRead.show():"Owner"===t.value?e.canManage.show():"Author"===t.value?e.canEdit.show():"Viewer"===t.value?e.canView.show():"Read"===t.value?e.read.show():"Add"===t.value?e.add.show():"Basic"===t.value?e.basic.show():"Read Write"===t.value?e.readWrite.show():"Remove"===t.value?e.remove.show():"Add Remove"===t.value?e.addRemove.show():"Full"===t.value?e.full.show():"CanAddRemoveAttachments"===t.value?e.canAddRemoveAttachment.show():"Leader"===t.value?e.leader.show():"Project Member"===t.value?e.member.show():"Project Lead"===t.value&&e.projectLead.show()}));var n=e.selectRightNewUser.elements.container.childNodes[0].childNodes;if(n.forEach)n.forEach(function(e,t){e.setAttribute("data-rec-id","dataRecComboRightsValue"+t)});else Array.prototype.slice.call(n).forEach(function(e,t){e.setAttribute("data-rec-id","dataRecComboRightsValue"+t)});e.searchWidget_CanView.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_CanRead.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_CanManage.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_CanEdit.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_CanAddRemoveAttachment.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Read.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Add.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Basic.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_ReadWrite.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Remove.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_AddRemove.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Full.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Leader.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Member.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_ProjectLead.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),!0===e.firstInit&&(e.dispatchEvent("onFirstBuild"),e.firstInit=!1)}},onModificationComplete:function(t){e.hideLoadingArea(),e.showErrorReporting(t,this.SelectedItems),e._ManageValidButton(!1)},fireWintopNotif:function(t){!0===e.options.wintop&&e.fireWintopCommand(e.webToWinCom_Socket,t,"onModificationAccessRights")}}}),this._ManageValidButton()},_updateReadOnlyDisplay:function(){1==this.isReadOnly?(null!=this.boutonValid&&this.boutonValid.hide(),null!=this.memberPanel&&this.memberPanel.hide(),this.hideLoadingArea(),this.ManageButtonRight.setStyle("display","block")):null!=this.boutonValid&&this.boutonValid.show()},_ManageValidButton:function(e){var t=this.createJSONArrayModif(),n=e;null!=e&&void 0!==typeof e||(n=t.length>0),n?this.boutonValid.setDisabled(!1):this.boutonValid.setDisabled(!0)},getTopBar:function(){return this.ManageButtonDiv},getNewIDItem:function(){for(var e=!0,t=this.SelectedItems.length;1==e;)t++,e=!1,this.SelectedItems.forEach(function(n){t==n.index&&(e=!0)});return t},showErrorReporting:function(e,t){var n=[];if(e&&e.ownershipVector)for(var a=e.ownershipVector.length,r=0;r<a;r++){var i=[],o=e.ownershipVector[r];if(o){var s=o.ownership,c="access right success",l=!1;0==this.isODT&&(c=UWA.i18n("accessRightSuccess"));for(var d=0;d<s.length;d++){var h=s[d];if(h.hasOwnProperty("result")){c="access right failure",0==this.isODT&&(c=h.result.message),l=!0;break}}for(var p=0;p<t.length;p++)t[p].getID()===e.ownershipVector[r].objectID&&(t[p].status=c,i.push(t[p].getID()),l?(i.push(UWA.i18n("Share_Fail_Status")),i.push("Failed")):(i.push(UWA.i18n("Share_Success_Status")),i.push("Success")),i.push(t[p].getName()),i.push(t[p].typeDisplayName),i.push(t[p].Revision),i.push(t[p].organizationTitle),i.push(t[p].collabSpaceTitle),i.push(t[p].responsibleName),i.push(c),n.push(i))}}w.launchReportingPanel(n,this.cols,null),this.dispatchEvent("onCancel")},setError:function(e){"object"==typeof e&&"1500028"===e.code&&(e.message=UWA.i18n("ErrorNotAccessRight")),this.addError(e)},addError:function(e){this.errorOverlay.displayJSONError(r.encode(e))},hideAllAreas:function(){this.hideLoadingArea(),this.hideMainComponent()},displayLoadingArea:function(){this.loadingArea.show(),this.loadingArea.elements.container.setStyle("display","flex")},hideLoadingArea:function(){this.loadingArea.hide()},displayMainInterfaceArea:function(){this.hideAllAreas(),null!=this.mainInterface&&this.mainInterface.show(),null!=this.boutonValid&&this.boutonValid.show()},hideMainComponent:function(){this.hideLoadingArea(),this.mainInterface.hide(),this.boutonValid.hide()},hideMainLoadingArea:function(){this.loadingArea.hide()},hideFailMainLoadingArea:function(){this.mainLoading.hide()},hideMainErrorArea:function(){this.mainError.hide()},showMainErrorArea:function(e){null!=e&&""!=e&&(this.clearAllMainError(),this.addMainError(e)),this.mainError.show()},addMainError:function(e){new UWA.createElement("div",{text:e}).inject(this.mainError)},clearAllMainError:function(){this.mainError.setContent("")},manageAdvancedMode:function(e){this.currentMode==this.lessButton?(this.showElements(this.mainInterface,".inherit_From"),this.showElements(this.mainInterface,".inherit_Access"),1==this.options.activeComment&&this.showElements(this.mainInterface,".Comments")):(this.hideElements(this.mainInterface,".inherit_From"),this.hideElements(this.mainInterface,".inherit_Access"),1==this.options.activeComment&&this.hideElements(this.mainInterface,".Comments")),this.resizeTable()},addErrorAfterOperation:function(e,t){t.hasOwnProperty("error")&&e.setError(t.error),t.ownershipVector.forEach(function(t,n){t.hasOwnProperty("ownership")&&t.ownership.forEach(function(t,n){t.hasOwnProperty("result")&&e.setError(t.result)})})},ownerAlreadyExist:function(e){var t=[],n=!1;return this.listOfAddedMembers.every(function(a,r){var i=a.ownership.owner;if(i.hasOwnProperty("person")||e.hasOwnProperty("person")){if(!i.hasOwnProperty("person")||!e.hasOwnProperty("person"))return!0;if(i.person.personID!=e.person.personID)return!0}if(i.hasOwnProperty("collabSpace")||e.hasOwnProperty("collabSpace")){if(!i.hasOwnProperty("collabSpace")||!e.hasOwnProperty("collabSpace"))return!0;if(i.collabSpace.collabSpaceID!=e.collabSpace.collabSpaceID)return!0}if(i.hasOwnProperty("organization")||e.hasOwnProperty("organization")){if(!i.hasOwnProperty("organization")||!e.hasOwnProperty("organization"))return!0;if(i.organization.orgID!=e.organization.orgID)return!0}if(i.hasOwnProperty("group")||e.hasOwnProperty("group")){if(!i.hasOwnProperty("group")||!e.hasOwnProperty("group"))return!0;if(i.group.groupURI!=e.group.groupURI)return!0}return(i.hasOwnProperty("comment")||e.hasOwnProperty("comment"))&&i.hasOwnProperty("comment")&&e.hasOwnProperty("comment")&&i.comment==e.comment&&(n=!0),t.push({Index:r,IsSame:n}),!0}),t},modifyDataPCS:function(){var e=this,t=e.createJSONArrayModif(),n=[],a=new Array,r=e.ShareController.getSelectedItemList(),i=e.ShareController.getErrorSelectedItemList();if(i.length!==r.length){var o=[];r.forEach(function(e){null==i[e]&&o.push(e)}),o.forEach(function(r,i){var o=new Array;r.hasOwnProperty("embeddedComp")&&!0===r.embeddedComp||(t.forEach(function(t){var n=t.operation;e.ShareController.isInherited(r.physicalId,n.owner)||o.push(n)}),a.push(r.physicalId),n.push({objectID:r.physicalId,ownership:o}))}),h.getInstance().getSecurityContext({onSuccess:function(t){e.widgetSecurityContext.hasOwnProperty("SecurityContext")?e.ShareController.modifyDataWithSC(n,a,e.widgetSecurityContext):e.ShareController.modifyDataWithSC(n,a,t)},onFailure:function(t){e.setError(t)}})}},modifyDataWithSC:function(e,t,n){var a=this,i={Accept:"application/json","Content-Type":"application/json"};if(null!=n&&""!=n&&n.hasOwnProperty("SecurityContext")){0!=n.SecurityContext.indexOf("ctx::")&&"ctx::",i.SecurityContext=encodeURIComponent(n.SecurityContext);this.options.serverName,this.options.serverUri;d.get3DSpaceUrlAsync({onComplete:function(o){var s="POST",c="",l=d.getRealPath("assets/validModification.json",a.widget),h={ownershipVector:e},p=JSON.stringify(h);I.get("AR_"),r.encode({requests:p});2==R&&(c="passport");h="";2==R&&(l=o+"/resources/accessRightServices/ar/completeInput",s="POST"),a.displayLoadingArea(),i["Accept-Language"]=widget.lang;var m=d.getTenantID();m&&0!=m.length?l+="?tenant="+m:l+="?tenant=OnPremise",d.partitionedAuthenticatedRequest(l,{type:"json",method:s,proxy:c,headers:i,partisionedProgressLabel:I.get("AR_RetrievingOwnership"),progressBarWaitContext:a.container,data:p,onComplete:function(r){a._getCompletedData(r,e,t,n)},onFailure:function(e,t,n){a._onFailure(e,t,n)},onTimeout:function(){a._onTimeout()}})},serverUrl:a.options.serverUrl,wintop:a.options.wintop})}else{var o={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(o)}},_onFailure:function(e,t,n,a,i,o){this.hideLoadingArea(),r.isJson(t)&&(t=r.decode(t));var s={};s=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("AR_ErrorModification"),code:"ERROR"},this.setError(s)},_onTimeout:function(){this.hideLoadingArea();var e={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(e)},getListOfPrivateCS:function(e){var t=this,n={Accept:"application/json","Content-Type":"application/json"};if(null!=e&&""!=e&&e.hasOwnProperty("SecurityContext")){0!=e.SecurityContext.indexOf("ctx::")&&"ctx::",n.SecurityContext=encodeURIComponent(e.SecurityContext);this.options.serverName,this.options.serverUri;d.get3DSpaceUrlAsync({onComplete:function(e){var a="",o=d.getRealPath("assets/availability.json",t.widget);2==R&&(a="passport"),2==R&&(o=e+"/resources/accessRightServices/ar/getPrivateProjectList");r.encode({requests:""});n["Accept-Language"]=widget.lang;var s=d.getTenantID();s&&0!=s.length?o+="?tenant="+s:o+="?tenant=OnPremise",i.authenticatedRequest(o,{type:"json",method:"GET",headers:n,proxy:a,data:"",onComplete:function(e){t._onCompletePrivateProjectList(e)},onFailure:function(e,n,a){t._onFailureAvailability(e,n,a)},onTimeout:function(){t._onTimeoutAvailability(items)}})},serverUrl:t.options.serverUrl,wintop:t.options.wintop})}else{var a={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(a)}},_testAvailability:function(e,t){var n=this,a={Accept:"application/json","Content-Type":"application/json"};if(null==t||""==t||!t.hasOwnProperty("SecurityContext")){var i={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};return this.setError(i),this.isReadOnly=!0,this._updateReadOnlyDisplay(),void this._addDataPCS(e)}t.SecurityContext.indexOf("ctx::"),a.SecurityContext=encodeURIComponent(t.SecurityContext);var o=[],s=e.length;s>10&&(s=10);for(var c=0;c<s;c++){var l=e[c];o.push({objectID:l.physicalId,accessRight:[{access:{physical:"changesov"}}]})}this.options.serverName,this.options.serverUri;d.get3DSpaceUrlAsync({onComplete:function(t){var i="",s="GET",c="",l=d.getRealPath("assets/availability.json",n.widget);2==R&&(c="passport"),2==R&&(l=n.options.hasOwnProperty("odtmode")&&n.options.odtmode?t+"/resources/pno/ownership/checkaccess":0===o[0].objectID.indexOf("cid:")?t+"/resources/lifecycle/ownership/checkaccess":t+"/resources/pno/ownership/checkaccess",s="POST",i='{ "boAccessRights": '+r.encode(o)+"}"),a["Accept-Language"]=widget.lang;var h=d.getTenantID();h&&0!=h.length?l+="?tenant="+h:l+="?tenant=OnPremise";d.partitionedAuthenticatedRequest(l,{type:"json",method:s,proxy:c,progressBarWaitContext:n.container,data:i,headers:a,onComplete:function(t){n.reponse=t;var a=d.getTenantID();n.ShareController._loadCredentials(a,function(r){n.ShareController.filterCredentials(a,r,"accessRight",function(a){a.length;0==a.length?(n.isReadOnly=!0,n.addError(UWA.i18n("ShareBlockedForCurrentResponsibility")),n._updateReadOnlyDisplay()):n._onCompleteAvailability(t,e)})})},onFailure:function(t,a,r){n._onFailureAvailability(t,a,r,e)},onTimeout:function(){n._onTimeoutAvailability(e)}})},serverUrl:n.options.serverUrl,wintop:n.options.wintop})},_onTimeoutAvailability:function(e){this.isReadOnly=!0,this.hideLoadingArea();var t={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(t),this._updateReadOnlyDisplay(),this._addDataPCS(e)},_onFailureAvailability:function(e,t,n,a){this.isReadOnly=!0,this.hideLoadingArea();var i={};r.isJson(t)&&(t=r.decode(t)),i=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("UnknownError"),code:"ERROR"},this.setError(i),this._updateReadOnlyDisplay(),this._addDataPCS(a)},_onCompletePrivateProjectList:function(e){e.hasOwnProperty("PrivateProjects")&&(this.listOfPrivateProjects=e.PrivateProjects.PrivateProjectList,this.searchWidget_AddRemove.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Add.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Basic.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_CanAddRemoveAttachment.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_CanEdit.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_CanManage.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_CanRead.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_CanView.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Full.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Read.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_ReadWrite.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Remove.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Leader.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Member.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_ProjectLead.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList)},_onCompleteAvailability:function(e,t){var n=this;if(1==e.success){this.isReadOnly=!1;var a=0;if(e.hasOwnProperty("boAccessRights")){var r=e.boAccessRights,i={};r.forEach(function(e){e.hasOwnProperty("accessRight")&&e.accessRight.forEach(function(r){if(r.hasOwnProperty("error")){a++;var o=r.error;o.type="warning";var s=UWA.i18n("an object");t.every(function(t){t.physicalId==e.objectID&&t.hasOwnProperty("name")&&(s=t.name)});var c="";switch(n.widgetSecurityContext.hasOwnProperty("SecurityContext")&&(c=n.widgetSecurityContext.SecurityContext.replace("ctx::","")),o.code+""){case"1501603":o.message=UWA.i18n("Bad credential for {0}").format(s);break;case"1501601":o.message=UWA.i18n("SH_PLM_SecurityDenied");break;case"1501602":o.message=UWA.i18n("NoCredentialAccess{0}").format(c)}i[e.objectID]=o.message,!0===n.options.displayWarningForAutoRO&&n.addError(o),v.warn("Access right : "+o.message)}})});var o=r.length;o==a?(n.isReadOnly=!0,1==o?null!=i[r[0].objectID]&&n.addError(i[r[0].objectID]):n.addError(UWA.i18n("ErrorNoAccessToSelectedObjects")),t.length>o&&(n.isReadOnly=!1,n.addError(UWA.i18n("ErrorNoAccessToAtLeast10")))):a>0&&n.addError(UWA.i18n("ErrorNoAccessToSomeObjects{0}").format(a))}n._updateReadOnlyDisplay(),n._addDataPCS(t)}else{if(this.isReadOnly=!0,e.hasOwnProperty("error")){var s=e.error;n.addError(s)}this.hideMainLoadingArea()}},_manageTableHeader:function(){var e=this.tableContainer.getElement(".SH_mainTableHeader");null!==e&&(this.table.allIsHidden()?e.hide():e.show())},AddUser:function(e){var t=!1;if(!d.isProgressBusy()){var n="";if("Reader"==e)n=this.searchWidget_CanRead.getNewOwner();else if("Author"==e)n=this.searchWidget_CanEdit.getNewOwner();else if("Owner"==e)n=this.searchWidget_CanManage.getNewOwner();else if("Viewer"==e)n=this.searchWidget_CanView.getNewOwner();else if("CanAddRemoveAttachments"==e)n=this.searchWidget_CanAddRemoveAttachment.getNewOwner();else if("Read"==e)n=this.searchWidget_Read.getNewOwner();else if("Add"==e)n=this.searchWidget_Add.getNewOwner();else if("Basic"==e)n=this.searchWidget_Basic.getNewOwner();else if("ReadWrite"==e){n=this.searchWidget_ReadWrite.getNewOwner();e="Read Write"}else if("Remove"==e)n=this.searchWidget_Remove.getNewOwner();else if("AddRemove"==e){n=this.searchWidget_AddRemove.getNewOwner();e="Add Remove"}else if("Full"==e)n=this.searchWidget_Full.getNewOwner();else if("Leader"==e)n=this.searchWidget_Leader.getNewOwner();else if("Project Member"==e)n=this.searchWidget_Member.getNewOwner();else if("Project Lead"==e)n=this.searchWidget_ProjectLead.getNewOwner();else""==e&&(n=this.searchWidget.getNewOwner());if(null===n||""===n)return t;n.hasOwnProperty("userGrp")&&(n.group={groupURI:n.userGrp.id,groupTitle:n.userGrp.label},delete n.userGrp);var a=e,r=!0,i=this.ownerAlreadyExist(n);if(i.length>0){var o=i[0],s=o.Index;1==o.IsSame?this.listOfAddedMembers[s].ownership.access.logical===a?r=!1:this.listOfAddedMembers[s].ownership.access.logical!=a&&(s+=1,this.container.getElement("#addedItem"+s).hide(),this.DeleteUser(s)):(s+=1,this.container.getElement("#addedItem"+s).hide(),this.DeleteUser(s))}if(r){var c={ownership:{InitRights:"",operation:"ADD",owner:n,access:{logical:a}},isTrueComment:!0,isTrueInheritedPath:!0};this.listOfAddedMembers.push(c),t=!0}return t}},DeleteUser:function(e){if(!d.isProgressBusy()){var t=parseInt(e)-1;this.listOfAddedMembers.splice(t,1),this._ManageValidButton()}},getNameUserFromOwner:function(e){var t=null,n="",a=-1;if(e.hasOwnProperty("person"))n=e.person.personLastName+" "+e.person.personFirstName,a=1;else{var r=!1;e.hasOwnProperty("organization")&&(r=!0,n=e.organization.orgID),e.hasOwnProperty("collabSpace")&&(1==r&&(n+=" / "),n+=e.collabSpace.collabSpaceID),e.hasOwnProperty("group")&&(n=e.group.groupTitle),a=2}return a>0&&(t={name:n,type:a}),t},resizeTable:function(){this.table.resizeTable()},createJSONArrayModif:function(){var e=[];if(1==this.isReadOnly)return e;for(var t=this.listOfAddedMembers.length,n=0;n<t;n++){var a=null,i=this.listOfAddedMembers[n];a=i.ownership.owner;var o=!0,s=!0;i.hasOwnProperty("isTrueComment")&&(o=i.isTrueComment),i.hasOwnProperty("isTrueInheritedPath")&&(s=i.isTrueInheritedPath);var c="";1==this.options.activeComment&&(c=this.table.getCellValue(lines[n],"Comments"));var l=i.ownership.InitRights,d="Reader";i.hasOwnProperty("ownership")&&(d=i.ownership.access.logical);var h=!1;null!=d&&""!=d||(h=!0);var p=!1;null!=l&&""!=l||(p=!0);var m=!1;if(""!=c&&c!=a.comment&&(m=!0),1==p&&0==h&&(1==m&&(a.comment=c),e.push({operation:{operation:"ADD",owner:a,access:{logical:d}},isTrueComment:!0,isTrueInheritedPath:!0,action:"ADD"})),0==p&&1==h&&e.push({operation:{operation:"REMOVE",owner:a,access:{logical:"Empty"}},isTrueComment:o,isTrueInheritedPath:s,action:"REMOVE"}),0==p&&0==h)if(1==m){var u=r.decode(r.encode(a));u.comment=c,e.push({operation:{operation:"ADD",owner:u,access:{logical:d}},isTrueComment:!0,isTrueInheritedPath:!0,action:"ADD"})}else d!=l&&e.push({operation:{operation:"ADD",owner:a,access:{logical:d}},isTrueComment:o,isTrueInheritedPath:s,action:"MODIFY"})}return e},ODTModificationComplete:function(e){this.hideLoadingArea(),1==e.success||this.addErrorAfterOperation(this,e),this._ManageValidButton(!1)},ODTGetListOfItemsInTable:function(){return this.ShareController.getSelectedItemList().length},ODTGetListOfUserItemsInTable:function(){return this.table.getAllLine().length}})});