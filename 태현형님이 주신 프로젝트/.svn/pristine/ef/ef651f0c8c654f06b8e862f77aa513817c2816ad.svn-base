define("DS/XSRCommonComponents/createform/util/TableFormGridCol",["DS/XSRCommonComponents/utils/Constants","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/LineEditor","DS/XSRCommonComponents/utils/TypeUtils","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents","css!DS/XSRCommonComponents/createform/view/TableForm.css"],function(e,t,o,l,n,i,a,s){"use strict";return class{constructor(e){this.isMBMF=e.isMBMF,this.parentTitle=e.parentTitle,this.dataCount=e.dataCount}getCols(){let e=[{dataIndex:"tree",text:s.label_Title,pinned:"left",editableFlag:!1},{dataIndex:"ContextualMenuColumn",text:s.label_Action,pinned:"left",hasCellValue:e=>!0},{dataIndex:"uomupdated",text:s.label_Quantity,width:350,typeRepresentation:"UWAObject",editableFlag:!1,allowUnsafeHTMLContent:!1,autoRowHeightFlag:!1,exportFlag:!0,visibleFlag:!0,editionPolicy:"EditionOnOver",getCellValue:this.getCellValue_uom},{dataIndex:"type",text:s.label_Type,editableFlag:!1},{dataIndex:"referenceName",text:s.label_ReferenceName,editableFlag:!0,typeRepresentation:"string",editionPolicy:"EditionOnOver",width:105,value:""},{dataIndex:"connectCM",icon:"product-made-from-part",typeRepresentation:"independantBoolean",editionPolicy:"EditionInPlace",width:40,editableFlag:!0,getCellTooltip:this.getCellTooltip_connectCM.bind(this),getCellSemantics:this.getCellSemantics_connectCM},{dataIndex:"revision",text:s.label_RevisionsExplore,editableFlag:!1,width:60},{dataIndex:"current",text:s.label_Current,editableFlag:!1,width:90}],t=[];return e.forEach(e=>{t.push(e)}),t}getToolbar(){return{entries:[{id:"delete",dataElements:{typeRepresentation:"functionIcon",icon:this.getJsonValues("delete","icon","toolbar"),tooltip:this.getJsonValues("delete","tooltip","toolbar"),position:"far",category:"separate"}},{id:"duplicate",dataElements:{typeRepresentation:"functionIcon",icon:this.getJsonValues("duplicate","icon","toolbar"),tooltip:this.getJsonValues("duplicate","tooltip","toolbar"),position:"far",category:"integrate"}}]}}getMenuItems(e,t){let o=[],l={type:"PushItem",title:s.label_Remove,icon:this.getJsonValues("delete","icon","menu"),tooltip:this.getJsonValues("delete","tooltip","menu"),action:{callback:this.deleteCallBack.bind(t)}},n={type:"PushItem",title:s.label_Duplicate,icon:this.getJsonValues("duplicate","icon","menu"),tooltip:this.getJsonValues("duplicate","tooltip","menu"),action:{callback:this.duplicateCallBack.bind(t)}};return Array.isArray(e)||(e=[e]),e.forEach(e=>{switch(e){case"delete":o.push(l);break;case"duplicate":o.push(n)}}),o}getJsonValues(e,t,o){let l={};switch(e){case"delete":switch(t){case"tooltip":"toolbar"===o||null==o?(l.title=s.label_Remove,l.shortHelp=s.text_DeleteSelected):"menu"===o&&(l=s.text_DeleteSelected);break;case"icon":l.iconName="trash",l.fontIconFamily=1}break;case"duplicate":switch(t){case"tooltip":"toolbar"===o||null==o?(l.title=s.label_Duplicate,l.shortHelp=s.text_DuplicateSelected):"menu"===o&&(l=s.text_DuplicateSelected);break;case"icon":l.iconName="duplicate",l.fontIconFamily=1}}return l}contextualEvent(e){let t=this,o=[];return e&&e.collectionView&&e.cellInfos&&o.push(...t.getMenuItems(["delete","duplicate"],e.cellInfos)),o}getCellTooltip_connectCM(e){let t=this,o=!!e.nodeModel&&e.nodeModel,l={};if(o){let e=o.options.grid;e.canConnectCM?(l.title=s.text_connectCM+" "+e.coreMaterial[0].V_Name,l.shortHelp=s.replace(s.get("text_connectCMFromTo"),{modeTitle:e.title,parentTitle:t.parentTitle})):(l.title=s.text_cannotConnectCM,l.shortHelp=e.connectCM_Msg)}else l.shortHelp=s.text_connectCMTo+t.parentTitle;return l}getCellSemantics_connectCM(e){let t=!!e.nodeModel&&e.nodeModel;return!!t&&{disabled:!t.options.grid.canConnectCM}}deleteCallBack(){let e=this.manager.getTreeDocument();e.prepareUpdate();let t=e.getNthRoot(this.rowID);e.removeRoot(t),e.pushUpdate(2)}duplicateCallBack(){let e=this.manager.getTreeDocument();e.prepareUpdate();let t=e.options.dataModelSet,l=this.nodeModel.options.grid.copy,n=o.createTreeNodeDataModel(t,{label:l.title,grid:l});this.nodeModel.getParent().addRoot(n,this.nodeModel._getLocalID()+1),e.pushUpdate(1);let i=n._getRowID();this.manager.insertRowCallback(n,i,this),this.manager.ensureNodeModelVisible(n,!0),this.manager.flashEffectOnNodeModel("ui-modified",n)}getCellValue_uom(e){console.log("calling UOM cont");var t=e.nodeModel,o=UWA.createElement("div",{class:"uom-container","data-cellInfos":e}),d=!0,r=[],c=new Map;if(t&&"EA"===t.options.grid.uomDB)d=!1,r.push(t.options.grid.uom);else{var p=Object.entries(a.getUOMUnits(t.options.grid.dimension));p&&p.forEach(function(e){r.push(e[1]),c.set(e[1],e[0])})}var u=t.options.grid.quantity,g=t.options.grid.uom,m=t.options.grid.asRequired,h=-1;null!=g&&(h=r.indexOf(g));var C=UWA.createElement("div").inject(o),b=new n({label:s.label_AsNeeded,type:"switch",checkFlag:m});b.getContent().addClassName("xsr-grid-wux-inline"),b.addEventListener("buttonclick",function(e){var o=e.dsModel.checkFlag;t.options.grid.asRequired=o,t.updateOptions({grid:t.options.grid})});var M=d?"([0-9]*[.])?[0-9]+":"[0-9]+",x=new i({placeholder:s.placeholder_Quantity,value:u,pattern:M}).inject(C),f=new l({elementsList:r,selectedIndex:h,placeholder:s.placeholder_dropdown}).inject(C);return b.inject(C),f.getContent().addClassName("xsr-grid-combobox"),x.getContent().addClassName("xsr-grid-lineeditor"),x.addEventListener("change",function(e){let o=""===e.dsModel.value?"":parseFloat(e.dsModel.value);t.options.grid.quantity=o,t.updateOptions({grid:t.options.grid})}),f.addEventListener("change",function(e){let o=e.dsModel.value;null!=o&&(t.options.grid.uom=o,t.options.grid.uomDB=c.get(o),t.updateOptions({grid:t.options.grid}))}),d||(f.destroy(),b.destroy(),x.destroy()),o}}});