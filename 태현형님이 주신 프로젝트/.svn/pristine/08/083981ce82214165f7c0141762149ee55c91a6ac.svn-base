define("DS/DELWebUiComponent/Thumbnail",["UWA/Core","UWA/Class","DS/VisuEvents/EventsManager","DS/UIKIT/Spinner","DS/Controls/Toggle","DS/WebappsUtils/WebappsUtils","css!DS/DELWebUiComponent/assets/css/Thumbnail"],function(e,t,i,n,a,o){"use strict";var s=0,r=t.extend({init:function(t){var r,l,h,c,d,u,p,g,f,m,D,v,w,b,y,S,C,_,P,T,E,A,M,W=this,U=new Image,V=h,I=c,L=!1,N=!1,x=0,k=o.getWebappsAssetUrl("DELWebUiComponent","graphics/")+"DefaultPreview.png";h="number"==typeof(t=t||{}).width?t.width:154,c="number"==typeof t.height?t.height:118,this._parent(t),s++,this.setPreview=function(e,t){e?(g=e,U.src=g,t&&E.setStyles({"background-color":t}),M()||p||(p=setInterval(function(){M()&&(clearInterval(p),p=null)},10)),E.setStyles({backgroundImage:'url("'+g+'")'}),this.hideSpinner()):this.displaySpinner()},this.setThumbnailTexts=function(i){w||(w=e.createElement("div",{class:"ThumbnailTextDiv"}).inject(v)).setStyles({width:t.icon?"calc(100% - 45px)":"calc(100% - 25px)","margin-left":t.icon?"0":"15px"}),b&&w.removeChild(b),y&&w.removeChild(y),S&&w.removeChild(S),i.title&&((b=e.createElement("p",{id:"thumbTitle"+t.id,class:"ThumbnailText ThumbnailTitle",contenteditable:!1}).inject(w)).innerText=i.title,b.title=i.title),b&&w.appendChild(b),y&&w.appendChild(y),S&&w.appendChild(S),v.setStyles({height:y||S?"100px":""})},this.setDisplayFlag=function(e,t){L=e,T.setAttribute("active-mode",e)},this.activate=function(){L=!0,T.addClassName("active"),T.setAttribute("active-mode",!0)},this.deactivate=function(){L=!1,T.removeClassName("active"),T.setAttribute("active-mode",!1)},this.select=function(){T.setAttribute("selected-mode",!0)},this.selectSecondary=function(){T.setAttribute("selected-mode","2")},this.deselect=function(){T.setAttribute("selected-mode",!1)},this.getDisplayFlag=function(){return L},this.getData=function(){return t.data},this.displaySpinner=function(){r||((r=new n({visible:!0})).inject(A),r.getContent().addClassName("ThumbnailSpinner"),A.setStyles({opacity:"1"}))},this.hideSpinner=function(){if(r){for(;A.firstChild;)A.removeChild(A.firstChild);r.destroy(),r=null}e.is(A)&&A.setStyles({opacity:"0"})},this.getThumbnailID=function(){return t.id},this.getContent=function(){return P},this.inject=function(e){return P.inject(e),this},this.clear=function(){C&&f&&i.removeEvent(C,"onPrimaryPointerClick",f),D&&i.removeEvent(P,"onPrimaryPointerClick",D),this.hideSpinner(),p&&clearInterval(p),U=D=f=null,T=E=A=v=w=b=y=S=null,C=_=null},M=function(){var e,t,i,n,a;return!(U&&(!U||U.src!==k))||(e=U.width,t=U.height,i=0===l?V-10:54,n=0===l?I-10:54,e>0&&t>0&&50!==e&&50!==t&&((e>i||t>n)&&((a=e/t)>i/n?(t=n,e=n*a):(e=i,t=i/a)),E.setStyles({"background-size":Math.round(e)+"px "+Math.round(t)+"px"}),U.src=k,!0))},this.setDisplayType=function(e){e!==l&&(V=0===(l=e)?h:285,I=0===l?c:84,1===l?(E.hasClassName("ThumbnailPreviewThumbDiv")&&E.removeClassName("ThumbnailPreviewThumbDiv"),v&&v.hasClassName("ThumbnailThumbContentDiv")&&v.removeClassName("ThumbnailThumbContentDiv"),E.addClassName("ThumbnailPreviewTileDiv"),v&&(v.addClassName("ThumbnailTileContentDiv"),v.setStyles({top:""})),S&&S.setStyles({display:""})):(E.hasClassName("ThumbnailPreviewTileDiv")&&E.removeClassName("ThumbnailPreviewTileDiv"),v&&v.hasClassName("ThumbnailTileContentDiv")&&v.removeClassName("ThumbnailTileContentDiv"),E.addClassName("ThumbnailPreviewThumbDiv"),v&&(v.addClassName("ThumbnailThumbContentDiv"),v.setStyles({top:I-33+"px",height:"100px"})),S&&S.setStyles({display:"none"})),T.setStyles({width:V+"px",height:I+"px"}),g&&(U.src=g,M()||p||(p=setInterval(function(){M()&&(clearInterval(p),p=null)},10))))},this.getDisplayType=function(){return l},this.setIsCheckableFlag=function(e){e!==u&&(u=e,C.setStyles({display:u?"":"none"}))},this.getIsCheckableFlag=function(){return u},this.setCheckFlag=function(e,i,n){u&&e!==d&&(d=e,_&&(_.checkFlag=e,!n&&t.checkFlagChangedCB&&t.checkFlagChangedCB({id:t.id,checkFlag:e,data:t.data,event:i}))),"1"===l&&T.setStyle("outline",u&&e?"4px solid #368ec4":"1px solid #e2e4e3")},this.isChecked=function(){return!!u&&d},P=e.createElement("div",{id:"thumbnailView_"+s+"_"+t.id,class:"ThumbnailThumbContainer"}),(T=e.createElement("div",{id:"thumbMainDiv"+s+"_"+t.id,class:"ThumbnailThumbMainDiv"}).inject(P)).setAttribute("active-mode","false"),e.createElement("div",{id:"thumbActive"+s+"_"+t.id,class:"thumbnail-active"}).inject(T),e.createElement("div",{id:"thumbShading"+s+"_"+t.id,class:"ThumbnailColorDiv"}).inject(T),E=e.createElement("div",{id:"thumbAppIcon"+s+"_"+t.id,class:"ThumbnailPreviewDiv"}).inject(T),A=e.createElement("div",{class:"ThumbnailDisabledDiv"}),E.appendChild(A),(t.icon||t.title||t.subtitle)&&(v=e.createElement("div",{id:"thumbContent"+s+"_"+t.id}).inject(T),t.icon&&e.createElement("img",{id:"thumbImg"+s+"_"+t.id,src:t.icon,class:"ThumbnailIcon"}).inject(v).setStyles({backgroundImage:'url("'+t.icon+'")'}),(t.title||t.subtitle||t.additionalText)&&W.setThumbnailTexts(t)),C=e.createElement("div",{id:t.id+"_checkBoxDiv"+s+"_",class:"ThumbnailCheckBoxDiv"}).inject(E),(_=new a({checkFlag:!1}).inject(C)).elements.container.addClassName("ThumbnailCheckDiv"),this.setIsCheckableFlag("boolean"==typeof t.isCheckable&&t.isCheckable),this.setCheckFlag("boolean"==typeof t.checkFlag&&t.checkFlag,null,!0),this.setDisplayFlag("boolean"==typeof t.displayFlag&&t.displayFlag),this.setPreview(t.preview,t.backgroundColor),this.setDisplayType("number"==typeof t.displayType?t.displayType:0),t.clickCB&&(D=function(e){setTimeout(function(){N||0!==x||t.clickCB({id:t.id,data:t.data,event:e}),N=!1,x>0&&x--},t.doubleClickCB?200:10)},i.addEvent(P,"onPrimaryPointerClick",D)),f=function(e){u&&(N=!0,W.setCheckFlag(!d,e.from[0].event))},i.addEvent(C,"onPrimaryPointerClick",f),m=function(){setTimeout(function(){_&&u&&(_.checkFlag=d)},0)},_.addEventListener("buttonclick",m)}});return r.THUMBNAIL=0,r.TILE=1,r}),define("DS/DELWebUiComponent/AVP/DELSubViewCell",[],function(){"use strict";return function(e,t){var i=UWA.is(e)&&UWA.is(t)?[e,t]:[0,0],n={x:0,y:0},a=0,o=0,s=null,r=null;return{getCellText:function(){return null},getCellImage:function(){return s},setCellImage:function(e){(!s||e&&e.src!==s.src)&&(s=e,r=null)},getCellImageToDisplay:function(){return r},setCellImageToDisplay:function(e){r&&(!e||e.width===r.width&&e.height===r.height&&e.src===r.src)||(r=e)},removeCellImageToDisplay:function(){r=null},getCellIndex:function(){var e={};return e.row=i[0],e.col=i[1],e},getCellPos:function(){return n},setCellPos:function(e){n=e},getCellWd:function(){return a},setCellWd:function(e){a=e},getCellHt:function(){return o},setCellHt:function(e){o=e}}}}),define("DS/DELWebUiComponent/ViewList",["UWA/Core","DS/Windows/Panel","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DataGridView/DataGridView","DS/ApplicationFrame/FrameWindowsManager","DS/Visualization/ThreeJS_DS","DS/DELWebViewerUtils/Utils","DS/Controls/ProgressBar","DS/Utilities/TouchUtils","css!DS/DELWebUiComponent/assets/css/ViewList.css"],function(e,t,i,n,a,o,s,r,l,h){"use strict";return function(c,d){var u,p,g,f,m,D=d.event,v=new e.Element("div",{id:"DEL3DViewListPanelMainContainer",html:[{tag:"div",id:"DEL3DViewListProgressBar"},{tag:"div",id:"DEL3DViewListMainContentContainer"}]}),w=new l({infiniteFlag:!0,displayStyle:"lite",emphasize:"info"}).inject(v.getElement("#DEL3DViewListProgressBar"),"top"),b=new i,y=(p=o.getFrameWindow().getImmersiveFrame(),(g=new t({id:"ViewList3D",domId:"ViewList3D",identifier:"ViewList3D",title:d.getNLSValue("Panel.ViewList3D.Title"),icon:{iconPath:r.getAssetsUrl("DEL3DViewer","icons/32/I_3DViewList_ON.png"),iconSize:{height:h.getTouchMode()?"22px":"16px",width:h.getTouchMode()?"22px":"16px"}},resizableFlag:!0,immersiveFrame:p,position:{my:"top center",at:"top center",of:p},ensureHeightDefinitionOnHierarchy:!0,verticallyStretchableFlag:!0,content:v,width:600,height:400,visibleFlag:!0})).elements.container.addClassName("del-web-viewlist-panel"),g.addEventListener("close",function(){var e,t;e=D.events.onCommandClose,t={commandId:"3DViewList",state:!1},D.publish(e,t)}),g),S=((u=new a({treeDocument:b,columns:d.columns,defaultColumnDef:{editableFlag:!1},showOutlineFlag:!0,rowSelection:"multiple",columnSelection:"none",cellSelection:"none",layoutOptions:{cellHeight:40}})).getContent().inject(v.getElement("#DEL3DViewListMainContentContainer")),u),C=function(t){var i,n;return b&&e.is(t,"array")&&t.length>0&&(n=t.map(e=>e.paths[0].toString()),i=b.search({match:function(e){var t=e.nodeModel.options.grid.path.toString();if(n.indexOf(t)>-1)return!0}})),i};return f=d.columns,m={},f&&(f.forEach(function(e){m[e.dataIndex]={filterId:"set"}}),b.setFilterModel(m)),e.is(d.readOnly)&&S.columns.forEach(e=>e.disabled=d.readOnly),{create:function(t){var i,a;t&&e.is(t,"array")&&t.length>0&&(b.removeRoots(),i=function(e){var t=[];return e.forEach(function(e){var i=e.grid.color?(new s.Color).setRGB(parseInt(e.grid.color.R)/255,parseInt(e.grid.color.G)/255,parseInt(e.grid.color.B)/255).getHexString():"";e.grid.color=i?"#"+i:"",t.push(e)}),t}(t),a=i,b.prepareUpdate(),a.forEach(function(e){var t=new n(e);b.addRoot(t)}),b.pushUpdate(),w.visibleFlag=!1)},onSelect:function(e){S.getNodesXSO().onChange(function(){var t=b.getSelectedNodes();e&&e(t)})},onShowHide:function(e){b.onNodeModelUpdate(function(t){Object.prototype.hasOwnProperty.call(t.data.attributes,"hideShow3D")&&e(t)})},unSelect:function(e){C(e).forEach(e=>e.unselect())},highlight:function(e){C(e).forEach(e=>e.highlight())},unHighlight:function(e){C(e).forEach(e=>e.unhighlight())},destroy:function(){y.destroy(),b=null}}}}),define("DS/DELWebUiComponent/AVP/DELViewMathsVector3D",[],function(){"use strict";var e;return e||(e=new function(){return{clone:function(e){var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},squaredLength:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},normalize:function(e,t){var i,n,a=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return Math.abs(a-1)<1e-6?((i=t||[0,0,0])[0]=e[0],i[1]=e[1],i[2]=e[2]):a>1e-6&&(n=Math.sqrt(a),(i=t||[0,0,0])[0]=e[0]/n,i[1]=e[1]/n,i[2]=e[2]/n),i},sub:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},subAndLength:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])},multiplyAndAdd:function(e,t,i,n){var a=n||[0,0,0];return a[0]=e[0]*t+i[0],a[1]=e[1]*t+i[1],a[2]=e[2]*t+i[2],a}}}),e}),define("DS/DELWebUiComponent/LinkFacetView",["UWA/Core","DS/Controls/Expander","css!DS/DELWebUiComponent/assets/css/LinkFacet.css"],function(e,t){"use strict";return function(i){var n,a=e.createElement("div",{class:"linkContainer"}),o=e.createElement("div",{class:"provideContainer"}),s=new t({header:"Attributes",body:a}),r=new t({header:"Mfg Item",body:o});return i.container=e.createElement("div",{id:"link-tab-container",class:"link-tab-container"}),s.inject(i.container),r.inject(i.container),n=function(t){var i=function(t,i){return e.createElement(t,i)},n=i("table",{class:"table"});return t&&e.is(t.results,"array")&&t.results.forEach(a=>{var o,s;e.is(a)&&(o=i("tr").inject(n),i("td",{class:"attrCol",html:a.nls?a.nls:""}).inject(o),"type"===a.name?(s=i("td",{class:"typeValueCol"}).inject(o),new e.Controls.Img({url:t.typeIconUrl,height:22,width:22}).inject(s),i("span",{html:a.value?a.value[0]:""}).inject(s)):i("td",{class:"valueCol",html:a.value?a.value[0]:""}).inject(o))}),n},{updateUI:function(t){e.is(t.linkInfo)&&e.is(t.provideInfo)&&(a.empty(),o.empty(),s.show(),r.show(),n(t.linkInfo).inject(a),n(t.provideInfo).inject(o))},destroy:function(){a=o=s=r=i.container=null},hide:function(){s.hide(),r.hide()}}}}),define("DS/DELWebUiComponent/ControlFactory",["UWA/Core"],function(e){"use strict";return function(t){var i={DELSlideView:"DS/DELWebUiComponent/DELSlideView",BuildUpDisplayOptions:"DS/DELWebUiComponent/BuildUpDisplayOptions","3DViewList":"DS/DELWebUiComponent/ViewList"},n=function(e){var t,n;for(n in i)if(i.hasOwnProperty(n)&&n===e){t=i[n];break}return t};return{getComponentPromise:function(){var i=Array.prototype.slice.call(arguments);return new e.Promise(function(a,o){var s=i[0],r=n(s),l=[null,t].concat(i.slice(1));e.is(r)?require([r],function(e){var t=new(Function.prototype.bind.apply(e,l));a(t)}):o("Component not found - %o",s)})},destroy:function(){i=n=null}}}}),define("DS/DELWebUiComponent/BuildUpDisplayOptions",["UWA/Core","DS/Windows/Panel","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DataGridView/DataGridView","DS/ApplicationFrame/FrameWindowsManager","DS/Visualization/ThreeJS_DS","DS/DELWebViewerUtils/Utils","DS/Utilities/TouchUtils","css!DS/DELWebUiComponent/assets/css/BuildUpDisplayOptions.css"],function(e,t,i,n,a,o,s,r,l){"use strict";return function(h,c){var d,u,p,g=c.event,f=function(e,t){g.publish(e,t)},m=new e.Element("div",{id:"DELBuildupDisplayOptionsMainContainer"}),D=(u=o.getFrameWindow().getImmersiveFrame(),(p=new t({domId:"DisplayOptionsPanel",title:c.getNLSValue("Panel.DisplayOptions.Title"),icon:{iconPath:r.getAssetsUrl("DELWebUiComponent","icons/I_DELBuildUpDisplayOptions.png"),iconSize:{height:l.getTouchMode()?"22px":"16px",width:l.getTouchMode()?"22px":"16px"}},immersiveFrame:u,ensureHeightDefinitionOnHierarchy:!0,verticallyStretchableFlag:!0,visibleFlag:!0,position:{my:"top center",at:"top center",of:u},content:m,width:472,height:230,identifier:"DisplayOptionsPanel"})).addEventListener("close",function(){f(g.events.onCommandClose,{commandId:"BuildUpDisplayOptions",state:!1})}),p),v=new i,w=((d=new a({identifier:"DELBuildupDisplayOptions",treeDocument:v,columns:c.columns,cellSelection:"none",selectionBehavior:{selectNodeModelOnCellSelection:!1},focusNextEditableCellOnTabFlag:!1,cellActivationFeedback:"none",cellPreselectionFeedback:"none",columnDragEnabledFlag:!1,showSelectionCheckBoxesFlag:!1,showRowHeaderBackgroundFlag:!0,layoutOptions:{rowsHeader:!1,columnHeaderHeight:30,cellHeight:40}})).subscribeOnceToAllCellsRendered(function(){d.sizeAllColumnsToFit({computeAllRows:!0,computeColumnHeader:!0})}),d.getContent().inject(m),d),b=function(){var t=function(e,t,i){var n,a,o={category:i,settings:{}};switch(e){case"color":o.settings[e]=(a=t.match(/.{1,2}/g),{R:parseInt(a[0],16),G:parseInt(a[1],16),B:parseInt(a[2],16)});break;case"opacity":o.settings[e]=(n=t,Math.round(255*Math.min(n,1)));break;default:o.settings[e]=t}return o},i={liveChange:function(i,n){var a;e.is(n)&&-1!==n.rowID&&i.srcElement&&i.srcElement.dsModel&&(a=i.dsModel.layout.getDataIndexFromColumnIndex(n.columnID),f(g.events.onBuildUpDisplayOptionsChange,t(a,i.srcElement.dsModel.value,n.nodeModel.options.categoryName)))}};for(let e in i)Object.prototype.hasOwnProperty.call(i,e)&&w.addEventListener(e,i[e]);v.onNodeModelUpdate(function(e){var i;e&&e.data&&e.data.attributes&&(i=Object.keys(e.data.attributes)[0],f(g.events.onBuildUpDisplayOptionsChange,t(i,e.data.attributes[i],e.data.nodeModel.options.categoryName)))})};return{create:function(t){e.is(t,"array")&&t.length>0&&(v.removeRoots(),function(e){v.prepareUpdate(),e.forEach(function(e){var t,i=e.grid.color?(new s.Color).setRGB(parseInt(e.grid.color.R)/255,parseInt(e.grid.color.G)/255,parseInt(e.grid.color.B)/255).getHexString():"";e.grid.color=i?"#"+i:"",t=new n(e),v.addRoot(t)}),v.pushUpdate()}(t),b())},destroy:function(){D&&D.destroy()}}}}),define("DS/DELWebUiComponent/facets/DataCollectMgmtUI",["UWA/Core","DS/DataGridView/DataGridView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","css!DS/DELWebUiComponent/assets/css/WKIInstructionFacet.css"],function(e,t,i,n){"use strict";return function(a){var o,s,r=a||null,l={defaultColumnDef:{editableFlag:!1},rowSelection:"single",columnSelection:"none",cellSelection:"none"},h=new i;return r&&!r.container&&(r.container=e.createElement("div",{id:"instructions-tab-container",class:"instructions-tab-container"})),{buildView:function(i){s=e.createElement("div",{id:"dc-row-container",class:"dc-row-container"}).inject(r.container),h.prepareUpdate(),e.is(i.rows,"array")&&i.rows.forEach(e=>{var t=new n(e);h.addRoot(t)}),h.pushUpdate(),(o=new t(Object.assign({},l,i,{treeDocument:h}))).getContent().inject(s),o.layout.cellHeight=40},clean:function(){r&&r.container&&r.container.empty(),s&&s.empty(),h&&h.empty()},destroy:function(){h&&(h.empty(),h=null),s&&s.destroy(),o&&o.destroy(),r&&r.container&&r.container.destroy()}}}}),define("DS/DELWebUiComponent/facets/WkiInstructionsFacetUI",["UWA/Core","css!DS/DELWebUiComponent/assets/css/WKIInstructionFacet.css"],function(e){"use strict";return function(t){var i,n=t;return n&&!n.container&&(n.container=e.createElement("div",{id:"instructions-tab-container",class:"instructions-tab-container"})),{buildView:function(t){var a,o=t.indexOf("<body>"),s=t.indexOf("</body>");a=o>-1&&s>-1?t.slice(o+6,s):t||"",(i=e.createElement("div",{id:"rich-text-container",class:"rich-text-container"})).innerHTML=a,i.inject(n.container)},clean:function(){n&&n.container&&n.container.empty(),i&&i.empty()},destroy:function(){i&&i.destroy(),n&&n.container&&n.container.destroy()}}}}),define("DS/DELWebUiComponent/AVP/DELSubViewTools",["DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Mesh/Mesh","DS/SceneGraphNodes/ArrowNode","DS/Visualization/MaterialManager","DS/DELWebUiComponent/AVP/DELViewMathsVector3D"],function(e,t,i,n,a,o){"use strict";var s,r=function i(){var s,r,l,h,c;return s=function(t){var i=(new e.Matrix4).setRotationFromQuaternion(t.clone()).elements;return{X:new e.Vector3(i[0],i[1],i[2]),Y:new e.Vector3(i[4],i[5],i[6]),Z:new e.Vector3(i[8],i[9],i[10]),Origin:new e.Vector3(i[12],i[13],i[14])}},r=function(t,i,n){var a=(new e.Projector).projectVector(i.clone(),t.viewpoints[0].getCamera()),o=Math.round((0-a.y)*(n.getContent().offsetHeight/2))+n.getContent().offsetHeight/2,s=Math.round(a.x*(n.getContent().offsetWidth/2))+n.getContent().offsetWidth/2,r=o>0&&o<n.getContent().offsetWidth&&s>0&&s<n.getContent().offsetWidth;return{top:o,left:s,bottom:n.getContent().offsetHeight-o,right:n.getContent().offsetWidth-s,inWindow:r}},l=function(t,i){var n,a,o,s,r,l=t.currentViewpoint;return 1===l.getProjectionType()?n=l.camera.top-l.camera.bottom:(a=l.getAngle()*Math.PI/180,o=l.getEyePosition(),s=(new e.Vector3).copy(i),r=(new e.Vector3).subVectors(s,o),n=2*Math.tan(.5*a)*r.length()),n/t.SCREEN_HEIGHT},h=function(e,t,i){var n,a,s={};return UWA.is(e)&&UWA.is(t)&&UWA.is(i)&&(n=o.squaredLength(i))>1e-6&&(a=o.dot(o.sub(e,t),i)/n,s.aPosition=o.multiplyAndAdd(i,a,e),s.distance=o.subAndLength(e,s.aPosition)),s},c=function(e,t,i,n){var a,o=void 0!==n?n:.001,s=!0;switch(void 0!==i?i:"float"){case"float":s=Math.abs(e-t)<o;break;case"Vector3":s=Math.abs(e.x-t.x)<o&&Math.abs(e.y-t.y)<o&&Math.abs(e.z-t.z)<o;break;case"Matrix4":for(a=0;a<16&&s;a++)s=Math.abs(e.elements[a]-t.elements[a])<o}return s},{colorToHex:function(e){var t,i,n,a,o,s,r;if(UWA.is(e)){if(e.substr&&"#"===e.substr(0,1))return e;if(void 0!==e.r&&void 0!==e.g&&void 0!==e.b)return e.r<0||e.g<0||e.b<0?null:"#"+(t=(t=Math.round(255*e.r).toString(16)).length<2?"0"+t:t)+(i=(i=Math.round(255*e.g).toString(16)).length<2?"0"+i:i)+(n=(n=Math.round(255*e.b).toString(16)).length<2?"0"+n:n);if(a=/(.*?)rgb\((\d+), *(\d+), *(\d+)\)/.exec(e),UWA.is(a))return 0===parseInt(a[2],10)&&0===parseInt(a[3],10)&&0===parseInt(a[4],10)?"#000000":(o=parseInt(a[2],10),s=parseInt(a[3],10),r=parseInt(a[4],10)|s<<8|o<<16,"#"+(0===o?"00"+r.toString(16):r.toString(16)))}return e},getViewpointInfo:function(t){var i,n,a;if(UWA.is(t))return i=(new e.Matrix4).lookAt(new e.Vector3,t.getSightDirection(),t.getUpDirection()),n=(new e.Quaternion).setFromRotationMatrix(i),a=s(n),{position:t.getEyePosition(),sight:t.getSightDirection(),right:a.X,up:t.getUpDirection(),distance:t.getTargetDistance()}},getLineFromWindowPosition:function(t,i,n){var a=new e.Vector3((i-window.pageXOffset)/t.canvas.offsetWidth*2-1,-(n-window.pageYOffset)/t.canvas.offsetHeight*2+1,.5),o=(new e.Projector).pickingRay(a.clone(),t.currentViewpoint.camera);return{position:o.ray.origin.clone(),direction:o.ray.direction.clone()}},getViewerPositionFromPoint:function(t,i){var n=(new e.Projector).projectVector(i.clone(),t.viewpoints[0].getCamera()),a=Math.round((0-n.y)*(t.canvas.offsetHeight/2))+t.canvas.offsetHeight/2,o=Math.round(n.x*(t.canvas.offsetWidth/2))+t.canvas.offsetWidth/2,s=a>0&&a<t.canvas.offsetHeight&&o>0&&o<t.canvas.offsetWidth;return{top:a,left:o,bottom:t.canvas.offsetHeight-a,right:t.canvas.offsetWidth-o,inWindow:s}},convertPixelToModel:function(e){return UWA.is(e.coords)?e.sizeInPixels*l(e.viewer,e.coords):e.sizeInPixels/(96/25.4)},convertModelToPixels:function(e){return UWA.is(e.coords)?e.sizeInMM/l(e.viewer,e.coords):e.sizeInMM*(96/25.4)},getDashPattern:function(e,t,i){var n,o,s=e;return s=parseFloat(s),i?s:(o=(n=new a).getDashPattern?n.getDashPattern(s):n._getDashPattern(s),isNaN(t)||o.forEach(function(e){t}),o)},computeLinePlaneDistance:function(e,t,i,n){var a,s,r,l,c,d={};return d.returnCode=1,UWA.is(e)&&UWA.is(t)&&UWA.is(i)&&UWA.is(n)&&(d.returnCode=0,a=o.normalize(t),s=o.normalize(n),r=o.dot(a,s),Math.abs(r)<.001?(d.angle=0,0===(l=h(e,i,s)).returnCode&&l.distance<.001?d.aPosition=o.clone(e):d.aPosition=l.aPosition):(d.angle=Math.asin(r),c=o.dot(o.sub(e,i),s)/r,d.aPosition=o.multiplyAndAdd(a,c,e))),d},modifyLeaderNode:function(e,i,a,o,s,r,l,h,d,u,p,g){var f,m,D,v,w,b,y,S={};return S.vBreak=o.clone(),S.vAttach=o.clone(),UWA.is(a)&&(S=this.computeNewPoints(e,o,s,r,p,g)),null===S.vBreak&&null===S.vAttach?f:(m=this.getDashPattern(d,null,!0),2,D={arrowWidth:l,headLength:Math.max(2*l+4,10),viewpoint:e.currentViewpoint,arrowDashType:m,arrowScale:2,color:h},v=!c(S.vBreak,s,"Vector3"),w=i.getChildByName("attach"),UWA.is(w)?UWA.is(v)?(w.updateInitialPosition(S.vBreak),w.updateFinalPosition(s),w.updateColor(h),w.setArrowWidth(l),w.setHeadSize(Math.max(2*l+4,10)),w.setHeadType(u),w.setArrowPattern(m),w.setArrowPatternScale(2),f+="(modify attach)"):(i.remove(w),f+="(delete attach)"):UWA.is(v)&&(D.initialPoint=S.vBreak.clone(),D.finalPoint=s.clone(),D.head=u,(w=new n(D)).name="attach",w.setPickable(t.NOPICKABLE),i.add(w),f+="(redraw attach)"),b=v&&!c(S.vBreak,S.vAttach,"Vector3"),y=i.getChildByName("step"),UWA.is(y)?UWA.is(b)?(y.updateInitialPosition(S.vBreak),y.updateFinalPosition(S.vAttach),y.updateColor(h),y.setArrowWidth(l),y.setHeadSize(Math.max(2*l+4,10)),y.setHeadType(0),w.setArrowPattern(m),w.setArrowPatternScale(2),f+="(modify step)"):(i.remove(y),f+="(delete step)"):UWA.is(b)&&(D.initialPoint=S.vBreak.clone(),D.finalPoint=S.vAttach.clone(),D.head=0,(y=new n(D)).name="step",y.setPickable(t.NOPICKABLE),i.add(y),f+="(redraw step)"),f)},computeNewPoints:function(t,n,a,o,s,l){var h,c,d,u,p,g,f,m,D,v,w,b,y={},S=Math.PI/180*105,C=15;return y.vBreak=n.clone(),y.vAttach=n.clone(),UWA.is(s.offsetHeight)?c=s.offsetHeight/2:UWA.is(s.style.pixelHeight)&&(c=s.style.pixelHeight/2),UWA.is(s.offsetWidth)?h=s.offsetWidth/2:UWA.is(s.style.pixelWidth)&&(h=s.style.pixelWidth/2),d=r(t,n,l),p=(u=r(t,a,l)).left-d.left,f=h+C,m=(g=u.top-d.top)>0?i.AttachmentSide.BOTTOM:i.AttachmentSide.TOP,p>0?(UWA.is(o)&&void 0!==o.width&&(f=h+(C=s.offsetWidth*o.width)),p>f&&(D=new e.Vector3(-f,0,0),v=new e.Vector3(p-f,g,0),D.angleTo(v)>S&&(m=i.AttachmentSide.RIGHT))):-p>f&&(o&&void 0!==o.width&&(f=h+(C=s.offsetWidth*o.width)),D=new e.Vector3(f,0,0),v=new e.Vector3(p+f,g,0),D.angleTo(v)>S&&(m=i.AttachmentSide.LEFT)),p<0&&(p=-p),(g=u.top-d.top)<0&&(g=-g),g<c&&p<h?(y.vBreak=null,y.vAttach=null,y):(m===i.AttachmentSide.RIGHT||m===i.AttachmentSide.LEFT?(w=h,m===i.AttachmentSide.LEFT&&(w=-w),y.vAttach=this.computeProjection(t,n,d.left+w,d.top),w=h+C,m===i.AttachmentSide.LEFT&&(w=-w),y.vBreak=this.computeProjection(t,n,d.left+w,d.top)):m!==i.AttachmentSide.TOP&&m!==i.AttachmentSide.BOTTOM||(b=c,m===i.AttachmentSide.TOP&&(b=-b),y.vAttach=this.computeProjection(t,n,d.left,d.top+b),UWA.is(o)&&void 0!==o.height?(b=c+(C=s.offsetHeight*o.height),m===i.AttachmentSide.TOP&&(b=-b),y.vBreak=this.computeProjection(t,n,d.left,d.top+b)):y.vBreak=y.vAttach.clone()),y)},computeProjection:function(t,i,n,a){var o=this.getViewpointInfo(t.currentViewpoint).sight.negate(),s=this.getLineFromWindowPosition(t,n,a),r=this.computeLinePlaneDistance(s.position.toArray(),s.direction.toArray(),i.toArray(),o.toArray());return new e.Vector3(r.aPosition[0],r.aPosition[1],r.aPosition[2])}}};return r.AttachmentSide={CENTER:0,LEFT:1,RIGHT:2,TOP:3,BOTTOM:4},UWA.is(s)||(s=new r),s}),define("DS/DELWebUiComponent/AVP/DELSubViewShapeGrid",["UWA/Core","UWA/Class","DS/DELWebUiComponent/AVP/DELSubViewCell"],function(e,t,i){"use strict";return function(){var t,n,a,o,s,r,l=1,h=1,c=[],d=[0],u=[0];return(t=e.createElement("canvas")).width=1e3,t.height=300,n=new i,c.push(n),a=function(e,t){d[e]=t},o=function(e,t){u[e]=t},s=function(e){return{width:e.getCellWd(),height:e.getCellHt(),fontHeight:0}},r=function(){var e;c=[],d=[0],u=[0],l=1,h=1,e=new i,c.push(e)},{updateGrid:function(){var t,i,n,r,c,p,g,f=0,m=0;for(t=0;t<h;t++){for(n=0,i=0;i<l;i++)r=this.getMarkUpCell(i,t),e.is(r)&&n<(c=s(r)).width&&(n=c.width);o(t,n)}for(i=0;i<l;i++){for(p=0,t=0;t<h;t++)r=this.getMarkUpCell(i,t),e.is(r)&&(c=s(r),p=Math.max(c.height,p));a(i,p)}for(t=0;t<l;t++){for(p=d[t],f=0,i=0;i<h;i++)n=u[i],r=this.getMarkUpCell(t,i),e.is(r)&&((g={}).x=f,g.y=m,r.setCellPos(g)),f+=n;m+=p}},getMarkUpCell:function(e,t){var i,n,a;if(c.length>0)for(n=0;n<c.length;n++)if((a=c[n].getCellIndex()).row===e&&a.col===t){i=c[n];break}return i},getNbofRows:function(){return l},setNbofRows:function(e){var t,n,a,o;if(e!==l&&r(),e>l)for(t=l,n=0;n<h;n++)for(a=t;a<e;a++)o=new i(a,n),c.push(o),d[a]=0;l=e},getNbofColumns:function(){return h},setNbofColumns:function(e){var t,n,a;if(e!==h&&r(),e>h)for(t=h;t<e;t++){for(n=0;n<l;n++)a=new i(n,t),c.push(a);u[t]=0}h=e},getRowHt:function(e){return d[e]},getColWd:function(e){return u[e]}}}}),define("DS/DELWebUiComponent/AVP/DELSubViewShape",["UWA/Core","UWA/Class","DS/DELWebUiComponent/AVP/DELSubViewShapeGrid","DS/DELWebUiComponent/AVP/DELSubViewTools"],function(e,t,i,n){"use strict";return function(t,a){var o;return{getMarkUpGrid:function(){return o||(o=new i),o},buildGrid:function(){var i,o,s,r,l,h,c=0;s=(i=this.getMarkUpGrid()).getMarkUpCell(0,0),o=t.subViewImage,e.is(i)&&e.is(t)&&e.is(s)&&e.is(o)&&(i.setNbofRows(1),i.setNbofColumns(1),s.setCellImage(o),c=t.imageWidth,r=t.imageHeight,e.is(c)&&e.is(r)?(l=t.position,e.is(l)?(c=n.convertModelToPixels({sizeInMM:c,viewer:a})*window.devicePixelRatio,r=n.convertModelToPixels({sizeInMM:r,viewer:a})*window.devicePixelRatio):(c*=h=a.SCREEN_HEIGHT/2,r*=h)):(c=o.naturalWidth,r=o.naturalHeight),s.setCellWd(c),s.setCellHt(r),i.updateGrid())}}}}),define("DS/DELWebUiComponent/AVP/DELSubViewShapeNode",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/CanvasNodeTexture","DS/SceneGraphNodes/CanvasNode","DS/DELWebUiComponent/AVP/DELSubViewTools","DS/DELWebUiComponent/AVP/DELSubViewShape"],function(e,t,i,n,a,o,s,r,l,h){"use strict";var c,d;return(c=t.extend({init:function(t){this._parent(),this._canvas=e.createElement("canvas"),this._canvas.width=1e3,this._canvas.height=300,this._canvasCopy=e.createElement("canvas"),this._canvasPictureToDisplay=e.createElement("canvas"),this._canvasNode=null,this._containerNode=null,this._sizeData={},this._additionalSpace=null,this._zoomMode=null,this._rotationAngle=0,this._imgToDisplay=new Image,this.avpData=t.avpData,this.delShape=new h(this.avpData,d),this._appData={anchorMode:"center",isFilled:!0,hasBorder:!1,graphicProperties:{padding:0,borderRadius:8,horizontalAlignement:"center",fontStyle:{height:12,familyName:"sans-serif",familyStyle:"normal",color:new i.Color(0)},fillStyle:{color:new i.Color(16777215),opacity:1},lineStyle:{thickness:1,pattern:"1",color:new i.Color(4013373)}},isHighlighted:!1},this.canvasNodeTexture=null},modify:function(){var e,n,s,r,l,h;if(this.avpData.position&&(this._appData.position=this.avpData.position.clone(),this.setMatrix((new i.Matrix4).setPosition(this._appData.position))),!this._compareOpts(this.avpData)||!this._canvasNode){if(e=!1,(this._appData.subViewImage&&!this.avpData.subViewImage||!this._appData.subViewImage&&this.avpData.subViewImage||this._appData.subViewImage&&this.avpData.subViewImage&&(this._appData.subViewImage.src!==this.avpData.subViewImage.src||this._appData.subViewImage.width!==this.avpData.subViewImage.width||this._appData.subViewImage.height!==this.avpData.subViewImage.height))&&(e=!0),("number"==typeof this.avpData.imageWidth&&"number"==typeof this._appData.imageWidth&&this.avpData.imageWidth!==this._appData.imageWidth||"number"==typeof this.avpData.imageHeight&&"number"==typeof this._appData.imageHeight&&this.avpData.imageHeight!==this._appData.imageHeight||e||this.avpData.imageInvertH!==this._appData.imageInvertH||this.avpData.imageInvertV!==this._appData.imageInvertV||this._rotationAngle!==this._appData.boxRotationAngle)&&(n=this.delShape?this.delShape.getMarkUpGrid():null))for(s=0;s<n.getNbofRows();s++)for(r=0;r<n.getNbofColumns();r++)n.getMarkUpCell(s,r)&&(n.getMarkUpCell(s,r).removeCellImageToDisplay(),this._imgToDisplay.src="",this._imgToDisplay.width=1,this._imgToDisplay.height=1,this._imgToDisplay.hasBeenLoaded=!1);this._mergeOpts(this.avpData),this.delShape&&this.delShape.buildGrid(),this._computeBoxSize(),this._zoomMode===this._appData.zoomMode&&this._rotationAngle===this._appData.boxRotationAngle||!this._containerNode||(this.removeChildren(),this._containerNode=null),this._containerNode?this._containerNode.removeChildren():(this._zoomMode=this._appData.zoomMode,this._rotationAngle=this._appData.boxRotationAngle?this._appData.boxRotationAngle:0,this._zoomMode?(this._containerNode=new a({type:"Spherical"}),this.addChild(this._containerNode)):this._rotationAngle?(l=new a({type:"Spherical"}),this.addChild(l),h=new o({ratio:1}),l.addChild(h),this._containerNode=new t,h.addChild(this._containerNode)):this._containerNode=this),this._additionalSpace=this._zoomMode?3:8,this._canvasNode=this._buildCanvasNode((this._zoomMode?this._sizeData.widthInMM:this._sizeData.width)+this._additionalSpace,(this._zoomMode?this._sizeData.heightInMM:this._sizeData.height)+this._additionalSpace,this._drawCallback.bind(this),this._additionalSpace),this._containerNode.addChild(this._canvasNode),this._rotationAngle&&this._containerNode.setMatrix((new i.Matrix4).makeRotationAxis(new i.Vector3(0,0,1),this._rotationAngle))}},getDimensions:function(){return{offsetWidth:this._sizeData.widthInMM>0?this._sizeData.widthInMM:1,offsetHeight:this._sizeData.heightInMM>0?this._sizeData.heightInMM:1}}})).prototype._buildCanvasNode=function(e,t,a,o){var l,h;if(this.canvasNodeTexture=new s({width:e,height:t,webGLV6Viewer:d,drawCB:a,rectangleTexture:!0,materialParams:{depthTest:!1}}),this._zoomMode||this._rotationAngle){switch(this._appData.anchorMode){case"topleft":h=new i.Vector3(-o/2,o/2-t,0);break;case"center":h=new i.Vector3(-e/2,-t/2,0)}l=new r({bottomLeftcorner:h,widthVector:new i.Vector3(e,0,0),heightVector:new i.Vector3(0,t,0),canvasNodeTexture:this.canvasNodeTexture},n)}else{switch(this._appData.anchorMode){case"topleft":h=new i.Vector2(o/2,t-o/2);break;case"center":h=new i.Vector2(e/2,t/2)}l=n.createCanvas2DNode({hotspot:h,canvasNodeTexture:this.canvasNodeTexture})}return l.rectangle.setRenderDepth(10),l.rectangle.excludeFromHighlight(!0,!0),l},c.prototype._computeBoxSize=function(){var t,i,n=null;if(this._sizeData={},e.is(this.delShape)&&(n=this.delShape.getMarkUpGrid()),e.is(n)){for(this._sizeData.height=0,this._sizeData.width=0,t=0;t<n.getNbofRows();t++)this._sizeData.height+=n.getRowHt(t);for(isNaN(this._sizeData.height)&&(this._sizeData.height=1),i=0;i<n.getNbofColumns();i++)this._sizeData.width+=n.getColWd(i);isNaN(this._sizeData.width)&&(this._sizeData.width=1)}this._sizeData.width+=2*this._appData.graphicProperties.padding,this._sizeData.height+=2*this._appData.graphicProperties.padding,this._sizeData.widthInMM=l.convertPixelToModel({sizeInPixels:this._sizeData.width,viewer:d}),this._sizeData.heightInMM=l.convertPixelToModel({sizeInPixels:this._sizeData.height,viewer:d}),this._sizeData.width=Math.round(this._sizeData.width),this._sizeData.height=Math.round(this._sizeData.height),this._sizeData.widthInMM=Math.round(this._sizeData.widthInMM),this._sizeData.heightInMM=Math.round(this._sizeData.heightInMM)},c.prototype._createRoundedRectangle=function(e,t,i,n,a){var o=this._appData.graphicProperties.borderRadius;e.beginPath(),e.moveTo(t+o,i),e.lineTo(t+n-o,i),e.arc(t+n-o,i+o,o,1.5*Math.PI,2*Math.PI),e.lineTo(t+n,i+a-o),e.arc(t+n-o,i+a-o,o,0,.5*Math.PI),e.lineTo(t+o,i+a),e.arc(t+o,i+a-o,o,.5*Math.PI,Math.PI),e.lineTo(t,i+o),e.arc(t+o,i+o,o,Math.PI,1.5*Math.PI),e.closePath()},c.prototype._drawImage=function(e,t,i,n,a,o,s,r){e.save(),e.translate(i+a/2,n+o/2),e.scale(s?-1:1,r?-1:1),e.drawImage(t,-a/2,-o/2,a,o),e.restore()},c.prototype._drawCallback=function(t,n,a,o){var s,r,h,c,u,p,g,f,m,D,v,w,b,y,S,C,_,P,T,E,A,M,W,U,V,I;if(n.scale(1/o,1/o),g=(p=n.canvas.width/(this._zoomMode?l.convertModelToPixels({sizeInMM:this._sizeData.widthInMM+this._additionalSpace,viewer:d}):this._sizeData.width+this._additionalSpace))*this._sizeData.width,v=p*this._sizeData.height,f=(n.canvas.width-g)/2,D=(n.canvas.height-v)/2,this._appData.isFilled)if(this._appData.graphicProperties.fillStyle.gradient){for("leftToRight"===this._appData.graphicProperties.fillStyle.gradient.type?m=n.createLinearGradient(f,D,n.canvas.width-f,D):"topToBottom"===this._appData.graphicProperties.fillStyle.gradient.type?m=n.createLinearGradient(f,D,f,n.canvas.height):"topLeftToBottomRight"===this._appData.graphicProperties.fillStyle.gradient.type?m=n.createLinearGradient(f,D,n.canvas.width-f,n.canvas.height):"bottomLeftToTopRight"===this._appData.graphicProperties.fillStyle.gradient.type&&(m=n.createLinearGradient(f,n.canvas.height,n.canvas.width-f,D)),w=Object.keys(this._appData.graphicProperties.fillStyle.gradient.specs),b=0;b<w.length;b++)m.addColorStop(parseFloat(w[b]),this._appData.graphicProperties.fillStyle.gradient.specs[w[b]]);n.fillStyle=m}else n.fillStyle=l.colorToHex(this._appData.graphicProperties.fillStyle.color),n.globalAlpha=this._appData.graphicProperties.fillStyle.opacity;else n.globalAlpha=0;if(this._createRoundedRectangle(n,(n.canvas.width-g)/2,(n.canvas.height-v)/2,g,v),n.fill(),n.globalAlpha=1,n.fillStyle=l.colorToHex(this._appData.graphicProperties.fontStyle.color),y=this.delShape?this.delShape.getMarkUpGrid():null,S=function(e){e.target.hasBeenLoaded=!0,e.target.removeEventListener("load",S),e.target.listenToLoadEvt=!1,this._appData&&this.canvasNodeTexture&&(this.canvasNodeTexture.requestRedraw(),d.render())},e.is(y))for(s=0;s<y.getNbofRows();s++)for(r=0;r<y.getNbofColumns();r++)if(u=y.getMarkUpCell(s,r),e.is(u))if(C=u.getCellPos(),(_=u.getCellImageToDisplay())||(_=u.getCellImage()),_)P=p*u.getCellWd(),T=p*u.getCellHt(),p*y.getRowHt(s)<T&&(T=p*y.getRowHt(s)),p*y.getColWd(r)<P&&(P=p*y.getColWd(r)),!this._zoomMode&&_.width&&_.height&&(_.width!==P||_.height!==T)&&(_.width>300||_.height>300)&&(A=!1,P===_.width&&T===_.height||(this._canvasCopy.width=_.width,this._canvasCopy.height=_.height,this._canvasCopy.getContext("2d").drawImage(_,0,0),A=!0),M=_,_=this._imgToDisplay,this._canvasPictureToDisplay.width=P,this._canvasPictureToDisplay.height=T,this._canvasPictureToDisplay.getContext("2d").drawImage(A?this._canvasCopy:M,0,0,this._canvasPictureToDisplay.width,this._canvasPictureToDisplay.height),E=this._canvasPictureToDisplay.toDataURL("image/png"),_.width=this._canvasPictureToDisplay.width,_.height=this._canvasPictureToDisplay.height,u.setCellImageToDisplay(_)),_.hasBeenLoaded||(_.listenToLoadEvt&&(_.removeEventListener("load",S.bind(this)),_.listenToLoadEvt=!1),_.addEventListener("load",S.bind(this)),_.listenToLoadEvt=!0,E&&(_.src=E)),this._drawImage(n,_,f+p*C.x+("center"===this._appData.graphicProperties.horizontalAlignement?(n.canvas.width-2*f-P)/2:0),D+p*C.y,P,T,this._appData.imageInvertH,this._appData.imageInvertV);else if((W=(c=u.getCellText())?c.getTextToDisplay():null)&&W.length)for(U=c.getFontStyle()?c.getFontStyle()+" ":"",V=c.getFontName()?c.getFontName():"sans-serif",n.font=U+p*c.getFontSize()*window.devicePixelRatio+"px "+V,I=p*this._appData.graphicProperties.padding,h=0;h<W.length;++h)n.fillText(W[h],f+p*(this._appData.graphicProperties.padding+u.size.paddingX+C.x),D+I+p*(u.size.paddingY+u.size.fontHeight+C.y)),I+=p*(2*u.size.paddingY+u.size.fontHeight);!this._appData.hasBorder&&this._appData.inEdition?(n.strokeStyle="#00C8FF",n.lineWidth=Math.max(this._appData.graphicProperties.lineStyle.thickness,4),n.stroke()):this._appData.hasBorder&&(this._appData.inEdition?(n.strokeStyle="#00C8FF",n.lineWidth=Math.max(this._appData.graphicProperties.lineStyle.thickness,4)):(n.strokeStyle=l.colorToHex(this._appData.graphicProperties.lineStyle.color?this._appData.graphicProperties.lineStyle.color:l.colorToHex(new i.Color(12775156))),n.lineWidth=this._appData.graphicProperties.lineStyle.thickness),this._appData.graphicProperties.lineStyle.pattern&&n.setLineDash(l.getDashPattern(this._appData.graphicProperties.lineStyle.pattern,2)),n.stroke()),d.render()},c.prototype._compareOpts=function(e){var t,i,n,a,o,s=function(e,t){return void 0===t||void 0===e||JSON.stringify(t)===JSON.stringify(e)},r=Object.keys(e);for(t=0;t<r.length;t++)if("graphicProperties"!==r[t]&&"breakPoint2D"!==r[t]&&"position"!==r[t]&&"pointingPoints"!==r[t]){if("subViewImage"===r[t]){if(this._appData[r[t]]&&!e[r[t]]||!this._appData[r[t]]&&e[r[t]])return!1;if(this._appData[r[t]].src!==e[r[t]].src||this._appData[r[t]].width!==e[r[t]].width||this._appData[r[t]].height!==e[r[t]].height)return!1}else if(!s(this._appData[r[t]],e[r[t]]))return!1}else if("graphicProperties"===r[t])for(i=Object.keys(e[r[t]]),n=0;n<i.length;n++)if("fontStyle"===i[n]||"fillStyle"===i[n]||"lineStyle"===i[n]){for(a=Object.keys(e[r[t]][i[n]]),o=0;o<a.length;o++)if(!s(this._appData[r[t]][i[n]][a[o]],e[r[t]][i[n]][a[o]]))return!1}else if(!s(this._appData[r[t]][i[n]],e[r[t]][i[n]]))return!1;return!0},c.prototype._mergeOpts=function(e){var t,i,n,a,o,s=function(e){return null!=e&&e.clone?e.clone():e},r=Object.keys(e);for(t=0;t<r.length;t++)if("graphicProperties"!==r[t])this._appData[r[t]]=s(e[r[t]]);else for(i=Object.keys(e[r[t]]),a=0;a<i.length;a++)if("fontStyle"===i[a]||"fillStyle"===i[a]||"lineStyle"===i[a])for(n=Object.keys(e[r[t]][i[a]]),o=0;o<n.length;o++)this._appData[r[t]][i[a]][n[o]]=s(e[r[t]][i[a]][n[o]]);else this._appData[r[t]][i[a]]=s(e[r[t]][i[a]])},function(e){return d=e.viewer,new c(e)}}),define("DS/DELWebUiComponent/AVP/DELSubViewNode3D",["UWA/Core","DS/CoreEvents/Events","DS/Visualization/Node3D","DS/Manipulators/ScreenPlaneManipulator","DS/Visualization/ThreeJS_DS","DS/DELWebUiComponent/AVP/DELSubViewShapeNode","DS/DELWebUiComponent/AVP/DELSubViewTools"],function(e,t,i,n,a,o,s){"use strict";var r,l,h,c=i.extend({init:function(e){var n,a,s;this._avpData=e||{},this._parent(),this._nPictureBoxNode=new o({viewer:r,avpData:e}),this.addChild(this._nPictureBoxNode),this._nPictureBoxNode.setPickParent(!0),this.setName(this._avpData.name),this.setNoZ(!0),this._nLeaderNode=new i,this.addChild(this._nLeaderNode),this._nLeaderNode.setPickParent(!0),n=h.getHideShowController(),a=n.getModelEvents().subscribe({event:"onHide"},function(e){this._onHideShow(e,!1)}.bind(this)),s=n.getModelEvents().subscribe({event:"onShow"},function(e){this._onHideShow(e,!0)}.bind(this)),t.subscribe({event:"/VISU/"},this.onViewerEventCB.bind(this)),t.subscribe({event:"/VISU/onSceneGraphUpdate"},function(e){"REMOVE"===e.eventType&&(n.getModelEvents().unsubscribe(a),n.getModelEvents().unsubscribe(s))})},onViewerEventCB:function(e){"@onWindowResized"!==e.eventType&&"@onViewpointChange"!==e.eventType&&"onSwapVisibleSpace"!==e.eventType||(this._updateLeaderPosition(),r.render())},update:function(){this._nPictureBoxNode.modify(),this._updateLeaderPosition(),this.setVisibility(this._avpData.isVisible),r.render()}});return c.prototype._updateLeaderPosition=function(){var t,n,o,h,c,d,u,p,g,f,m,D,v,w,b;if(!this._avpData.hasALeader)return this._nLeaderNode.setVisibility(!1),void this._nLeaderNode.setVisibilityFree(!0);if(this._nLeaderNode.setVisibility(!0),this._nLeaderNode.setVisibilityFree(!1),0===r.getVisibleSpace()&&!1===this._avpData.isVisible||1===r.getVisibleSpace()&&!0===this._avpData.isVisible){switch(t=0,this._avpData.leaderEndType){case"Arrow":t=1;break;case"Bubble":t=2}if((n=this._nPictureBoxNode.getDimensions()).offsetWidth>0&&n.offsetHeight>0&&(o=this._avpData.position.clone(),(h={offsetWidth:s.convertModelToPixels({sizeInMM:n.offsetWidth,viewer:r,coords:this._avpData.zoomMode?o:null}),offsetHeight:s.convertModelToPixels({sizeInMM:n.offsetHeight,viewer:r,coords:this._avpData.zoomMode?o:null})}).offsetWidth/=window.devicePixelRatio,h.offsetHeight/=window.devicePixelRatio,"topleft"===this._avpData.anchorMode&&(this._avpData.zoomMode?(c=r.currentViewpoint.getUpDirection().clone(),d=(new a.Vector3).crossVectors(r.currentViewpoint.getSightDirection(),c).setLength(n.offsetWidth/2),c.setLength(-n.offsetHeight/2),o.add(c),o.add(d)):(u=s.getViewerPositionFromPoint(r,o),isNaN(u.left)||isNaN(u.top)||(p=new a.Vector2(u.left+h.offsetWidth/2,u.top+h.offsetHeight/2),g=s.getLineFromWindowPosition(r,p.x,p.y),f=s.getViewpointInfo(r.currentViewpoint),m=s.computeLinePlaneDistance(g.position.toArray(),g.direction.toArray(),this._avpData.position.toArray(),f.sight.toArray()),o=new a.Vector3(m.aPosition[0],m.aPosition[1],m.aPosition[2])))),D=this._avpData.leaderPointingPoints,e.is(D)&&D.length&&(v=this._nLeaderNode.getChildren(),D.forEach(function(n,a){e.is(v[a])||(v[a]=new i("DELSubViewLeaderNode"),v[a].setPickParent(!0),this._nLeaderNode.addChild(v[a])),b={width:this._avpData.leaderAttachWidthRatio,height:this._avpData.leaderAttachLengthRatio},s.modifyLeaderNode(r,v[a],!0,o,n,b,this._avpData.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,this._avpData.graphicProperties.leaderStyle.color,this._avpData.graphicProperties.leaderStyle.pattern,t,h,l)}.bind(this)),v=this._nLeaderNode.getChildren(),D.length<v.length)))for(w=v.length-1;w>=D.length;w--)this._nLeaderNode.removeChild(v[w])}},c.prototype._onHideShow=function(t,i){var n=this;e.is(t)&&e.is(t.paths,"array")&&e.is(this._avpData.pointedReferenceOccurencePath,"array")&&t.paths.forEach(function(e){h.streamPath(e).toString().indexOf(n._avpData.pointedReferenceOccurencePath.toString())>-1&&(n._nLeaderNode.setVisibility(i),n._nPictureBoxNode.setVisibility(i))})},function(e,t,i){return h=t,r=t.getViewer(),l=i,new c(e)}}),define("DS/DELWebUiComponent/DELSlideView",["DS/WebappsUtils/WebappsUtils","DS/Windows/Panel","DS/DELWebUiComponent/Thumbnail","DS/ApplicationFrame/FrameWindowsManager","DS/Visualization/Node3D","DS/DELWebUiComponent/AVP/DELSubViewNode3D","DS/DEL3DViewer/NodeUtil"],function(e,t,i,n,a,o,s){"use strict";return function(r,l){var h,c,d,u,p,g,f,m,D,v=l.getOption("logger"),w=[],b=l||{},y=UWA.createElement("div",{id:"DELSlidePanelThumbMainDiv"}),S=r.getEnoPadviewer(),C=l.getOption("onSlideSelectedCB"),_=!1,P={id:"DELSlidesPanel",domId:"DELSlidesPanel",identifier:"DELSlidesPanel",className:"DELSlidesPanel",title:"",icon:e.getWebappsAssetUrl("DELWebUiComponent","icons/")+"I_WebSlide.png",immersiveFrame:n.getFrameWindow().getImmersiveFrame(),content:y,minWidth:188,width:188,widthStep:165,minHeight:302,height:302,heightStep:124,allowedDockAreas:WUXDockAreaEnum.RightDockArea|WUXDockAreaEnum.LeftDockArea|WUXDockAreaEnum.TopDockArea,currentDockArea:WUXDockAreaEnum.LeftDockArea,closeButtonFlag:!1,resizableFlag:!0,horizontallyStretchableFlag:!0,verticallyStretchableFlag:!0},T=b.panelOptions?UWA.merge(b.panelOptions,P):P,E={displayType:i.THUMBNAIL,displayFlag:!1,isCheckable:!1,checkFlag:!1},A=b.thumbnailOptions?UWA.merge(b.thumbnailOptions,E):E;return d=function(){return S.getViewer().getRootNode()},u=function(){var e,t=d().getChildByName("AVPNodeBag");if(UWA.is(t)&&t.children instanceof Array)for(e=t.children.length;e>-1;e-=1)t.removeChild(t.children[e])},y=T.content,p=function(){w=[],c&&(c.destroy(),c=null),UWA.is(h)&&(h.destroy(),h=null),u()},r.getEnoPadController().getRoots().filter(function(e){var t=r.getEnoPadController().isFiltered(s.getNodeID(e));return!!t&&t.hasFilter}).length>0&&(_=!0),g=function(e){var t,i,n,a,o,s,r,l,h,c,d,u,p,g;if(e&&e.width&&e.height){for(g=S.getViewer(),t=UWA.createElement("canvas"),i={data:null,width:Math.round(g.SCREEN_WIDTH*window.devicePixelRatio),height:Math.round(g.SCREEN_HEIGHT*window.devicePixelRatio)},g.renderToTarget(i,g.currentViewpoint),(n=i.width/i.height)>e.width/e.height?(t.height=e.height,t.width=t.height*n):(t.width=e.width,t.height=t.width/n),t.width*=2,t.height*=2,(a=t.getContext("2d")).clearRect(0,0,t.width,t.height),o=function(e,t,i,n,a){return a&&(t=n-t-1),i*Math.floor(t)+Math.floor(e)},s=a.getImageData(0,0,t.width,t.height),r=i.width/s.width,p=i.height/s.height,h=0;h<s.height;h++)for(c=0;c<s.width;c++)u=o(c,h,s.width,s.height,!1),d=o(r*c,p*h,i.width,i.height,!0),s.data[4*u]=i.data[4*d],s.data[4*u+1]=i.data[4*d+1],s.data[4*u+2]=i.data[4*d+2],s.data[4*u+3]=i.data[4*d+3];return i.data=null,i=null,a.putImageData(s,0,0,0,0,t.width,t.height),(l=new Image).src=t.toDataURL("image/jpeg"),l}},m=function(e){var t;UWA.is(e)&&(t=g({width:200,height:113}),e.thumbnail.setPreview(t.src))},f=function(e,t){var i;i=w.find(function(e){return e.data.uuid===t.getAttribute("sUuid")}),m(i)},_&&(D=r.getEnoPadModelEvents().subscribe({event:"onEndProgressiveLoad"},function(){var e=w.find(function(e){return e.thumbnail.getDisplayFlag()});v.debug("DELSlideView :: onEndProgressiveLoad event triggered (Graphics loading is completed)"),m(e)})),{display:function(e){var n,a=e.avpData,o=0,s=function(e){w.forEach(function(t){UWA.is(t.thumbnail)&&(t.id===e.id?(t.thumbnail.activate(),t.thumbnail.select()):(t.thumbnail.deselect(),t.thumbnail.deactivate()))}),C(e,!0)};v.debug("DELSlideView:: display function is invoked with parameters: %o",e),(c=UWA.createElement("div",{id:"DELSlideThumbnailContainer"})).inject(y),h?h.show():(v.debug("DELSlideView:: display - WUXPanel is created with options: %o",T),h=new t(T)),(n=h.immersiveFrame.getDockingElement(h.currentDockArea))&&(n.collapseDockingZoneFlag=!1),UWA.is(e.slides,"array")&&e.slides.length>0&&(e.slides.forEach(function(e){(function(e,t){var i,n,a,o=!0,s=!1;if(e.inWork)s=!1;else if(UWA.is(t)){if(UWA.is(t)&&t.Model[0].WKIObjects)for(n=t.Model[0].WKIObjects,i=0;i<n.length;i++)if("View"===n[i].type&&(o=!1,n[i].proxiedSlideUuid===e.uuid)){s=!0;break}}else s=!0;if(o&&(s=!0),UWA.is(t)&&t.Model[0].WKIRelations)for(a=t.Model[0].WKIRelations,i=0;i<a.length;i+=1)if("AssociatedInstruction"===a[i].type&&a[i].View.UUID===e.uuid){s=!0;break}return s})(e,a)&&(e.id=++o,_&&(e.onSlideActivated=f),function(e){var t,n=e.data,a={id:e.id,data:n,preview:n.preview,title:n.name,clickCB:s};UWA.merge(a,A),(t=new i(a)).inject(c),e.thumbnail=t,w.push(e),UWA.is(e.avpData)}({data:e,id:"slide"+e.id}))}),s(w[0]))},applyAvpData:function(e){var t,i=0,s=null;t=d().getChildByName("AVPNodeBag"),UWA.is(t)?u():(t=new a("AVPNodeBag"),d().addChild(t)),0!==e.length&&setTimeout(function(){if(UWA.is(e)&&e.length>0)for(i=0;i<e.length;i+=1)s=new o(e[i],S,n.getFrameWindow()),t.addChild(s),s.update()},10)},highlightViews:function(e){w.forEach(function(t){UWA.is(t&&t.thumbnail)&&(e.includes(t.data.uuid)?t.thumbnail.selectSecondary():t.thumbnail.deselect())})},unHighlightViews:function(e){w.forEach(function(t){UWA.is(t&&t.thumbnail)&&(e.includes(t.data.uuid)||UWA.is(0===e.length))&&t.thumbnail.deselect()})},activateView:function(e){var t,i;e.viewUUID?(t=e.viewUUID,i="uuid"):(t=e.viewID,i="id"),w.forEach(function(e){UWA.is(e.thumbnail)&&(t===e.data[i]?(e.thumbnail.activate(),e.thumbnail.select(),e.thumbnail.getContent().scrollIntoView(!1),C(e,!1)):(e.thumbnail.deselect(),e.thumbnail.deactivate()))})},selectActiveView:function(){var e=this.getActiveView();e&&w.forEach(function(t){UWA.is(t.thumbnail)&&e.viewUUID===t.data.uuid&&(t.thumbnail.activate(),t.thumbnail.select())})},getActiveView:function(){var e=w.find(function(e){return e.thumbnail.getDisplayFlag()});return UWA.is(e&&e.data&&e.data.uuid)?{viewUUID:e.data.uuid,viewID:e.data.id}:null},reset:function(){v.debug("DELSlideView::reset function is invoked"),p(),UWA.is(D)&&r.getEnoPadModelEvents().unsubscribe(D)},clean:p,hide:function(){UWA.is(h)&&h.hide()},destroy:function(){y&&y.destroy(),w.forEach(e=>{e&&e.thumbnail&&e.thumbnail.clear()}),u&&u(),D&&r.getEnoPadModelEvents().unsubscribe(D),w=[],v=h=b=y=c=S=null,C=_=P=T=E=A=null,d=u=p=g=f=m=D=null}}}});