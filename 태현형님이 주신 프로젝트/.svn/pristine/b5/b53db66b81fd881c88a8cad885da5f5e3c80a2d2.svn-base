define("DS/DELWKOModelBehaviors/DELWKOLinkBehavior",["UWA/Core","UWA/Promise"],function(e,t){"use strict";return{plugins:["DatabasePlugin","DicoPlugin","WebServicePlugin","AttributePlugin","ResourcePlugin","ImplementPlugin","SelectionPlugin","PlatformPlugin"],creator:function(n,r,i,a,o,s,c,u,l,g){var f=u.getScopeLinkType(),d=u.getImplementLinkType();u.getScopeLinkType(),u.getImplementLinkType();var p,m,L,y,I,P,h,v,S;return p=function(t,n,i,a){i=i||{},e.is(n,"string")&&r.info(n,a),r.notify("stopProgress",t),e.is(i.onComplete,"function")&&i.onComplete.call(null,n)},m=function(t,n,i,a,o){a=a||{},e.is(i,"string")&&(n+="\n"+i),e.is(n,"string")&&(r.warn(n,o),r.debug(n)),r.notify("stopProgress",t),e.is(a.onFailure,"function")&&a.onFailure.call(null,n)},L=function(t){return new e.Promise(function(n){var a=[],o=function(t){var n,r;-1===a.indexOf(t)&&(n=i.getInstance(t),r=t,e.is(n)&&(r=n.get("isInstanceOf"),i.needToQueryForConnections(t)&&a.push(t)),-1===a.indexOf(r)&&i.needToQueryForConnections(r)&&a.push(r))};i.isNavigateOnDemand()||n({impactedList:[],relationsLoaded:!0}),(e.is(t)?t:l.getModuleSelections(r.getId())).forEach(function(e){o(e.id),Array.isArray(e.path)&&e.path.forEach(function(e){o(e)})}),a.length>0?i.getConnectionsFromServer(a,function(t){e.is(t)&&Array.isArray(t.connections)&&t.connections.length>0&&r.notify("addConnection",[t.connections]),n({impactedList:a,result:t,relationsLoaded:!0})}):n({impactedList:a,relationsLoaded:!0})})},y=function(e){return L(e).then(function(e){var t=e.impactedList;t.length>0&&(r.notify("refreshImpacted",{impactedChildren:[],impactedObjects:t}),r.getBehavior("RefreshBehavior").onRefreshSelected({impactedChildren:[],impactedObjects:t}))})},I=function(t,n){var r,o,s,u,l,g=!0,f={};return e.is(t.fromSideRefPID)&&e.is(t.toSideRefPID)?(n.contains("inverse")?(r=t.toSideRefPID,o=t.fromSideRefPID):(r=t.fromSideRefPID,o=t.toSideRefPID),s=i.getReference(r),u=i.getReference(o)):(g=!1,l=c.getNLSValue("LinkBehavior.canCreateOutputLinkError.InsufficentInfo")),g&&(a.isAKindOf(u,"Provide")||a.isAKindOf(s,"DELLmiHeaderWorkPlanReference")||a.isAKindOf(s,"DELLmiQtyControlProcessReference")?(g=!1,l=c.getNLSValue("LinkBehavior.canCreateOutputLinkError.ObjectTypeDoesntSupport")):i.hasConnection({from:r,to:o,type:"DELLmiProductionSystemOutputCnxToMBOM"})&&(g=!1,l=c.getNLSValue("LinkBehavior.canCreateOutputLinkError.LinkAlreadyExists"))),f={canCreateLink:g},g?f.data=e.merge({type:n,IDFrom:t.fromSideRefPID,IDTo:t.toSideRefPID,displayText:c.getNLSValue(n,null,"CreateLink"),buttonIdentifier:c.getNLSValue(n,null,"CreateLink")},e.clone(t)):f.errorMessage=l,f},P=function(t,n){var r,o,s,u,l,g=!0,f={};return e.is(t.fromSideRefPID)&&e.is(t.toSideRefPID)?(o=t.fromSideRefPID,s=t.toSideRefPID,u=i.getReference(o),l=i.getReference(s)):(g=!1,r=c.getNLSValue("LinkBehavior.canCreateOriginateLinkError.InsufficentInfo")),g&&(i.hasConnection({from:o,to:s,type:"HistorizationLinkRefRef"})||i.hasConnection({from:s,to:o,type:"HistorizationLinkRefRef"})?(g=!1,r=c.getNLSValue("LinkBehavior.canCreateOriginateLinkError.LinkAlreadyExists")):(a.isAKindOf(u,"DELLmiHeaderWorkPlanReference")||a.isAKindOf(l,"DELLmiHeaderWorkPlanReference"))&&(g=!1,r=c.getNLSValue("LinkBehavior.canCreateOriginateLinkError.ObjectTypeDoesntSupport"))),f={canCreateLink:g},g?f.data=e.merge({type:n,IDFrom:o,IDTo:s,displayText:c.getNLSValue(n,null,"CreateLink"),buttonIdentifier:c.getNLSValue(n,null,"CreateLink")},e.clone(t)):f.errorMessage=r,f},h=function(t,n){var r,a,o,s=!0,u={};return e.is(t.fromSideRefPID)&&e.is(t.toSideRefPID)?(r=t.fromSideRefPID,a=t.toSideRefPID,(i.hasConnection({from:r,to:a,type:"MfgProcessAlternate"})||i.hasConnection({from:a,to:r,type:"MfgProcessAlternate"}))&&(s=!1,o=c.getNLSValue("LinkBehavior.canCreateAlternateLinkError.LinkAlreadyExists"))):(s=!1,o=c.getNLSValue("LinkBehavior.canCreateAlternateLinkError.InsufficentInfo")),u={canCreateLink:s},s?u.data=e.merge({type:n,IDFrom:r,IDTo:a,displayText:c.getNLSValue(n,null,"CreateLink"),buttonIdentifier:c.getNLSValue(n,null,"CreateLink")},e.clone(t)):u.errorMessage=o,u},v=function(e){var t;switch(e.type){case"DELLmiProductionSystemOutputCnxToMBOM":case"DELLmiProductionSystemOutputCnxToMBOM_inverse":t=I(e,e.type);break;case"MfgProcessAlternate":t=h(e,e.type);break;case"HistorizationLinkRefRef":t=P(e,e.type);break;default:t={canCreateLink:!0}}return t},S=function(n,r,a){var o,s,c,u;return o=(n=n||{}).IDFrom,s=n.IDTo,c=n.type,n.type.endsWith("_inverse")?(n.IDFrom=e.is(s,"array")?s.toString():s,n.IDTo=e.is(o,"array")?o.toString():o,n.type=n.type.replace("_inverse","")):(n.IDFrom=e.is(o,"array")?o.toString():o,n.IDTo=e.is(s,"array")?s.toString():s),new t(function(t,a){var o=e.is(n.IDFrom,"array")?n.IDFrom[n.IDFrom.length-1]:n.IDFrom,s=e.is(n.IDTo,"array")?n.IDTo[n.IDTo.length-1]:n.IDTo,l={linkType:c,target:o,source:s},g=function(t,n){e.is(n)&&(l.errorMessage=n),a(l)};(u=v(n)).canCreateLink?(r=r||{},i.createConnection({IDFrom:n.IDFrom,IDTo:n.IDTo,type:n.type},e.merge({onFailure:g,onTimeout:g,onCancel:g,onComplete:function(){t(l)}},r))):(l.errorMessage=u.errorMessage,a(l))})},{listenTo:function(){return{LoadRelations:function(e){var t;return Array.isArray(e)&&(t=e),y(t)}}},onStart:function(){},onStop:function(){},getPossibleRelationTypes:function(t){var n=r.getBehavior("ImplementBehavior"),o=r.getBehavior("ProductFlowLinkBehavior"),s=r.getBehavior("CapableResourceLinkBehaviour"),c=n.getScopeLinkType(),u=c+"_inverse",l=n.getImplementLinkType(),g=l+"_inverse",f=e.is(t.fromSideRefPID)?i.getReference(t.fromSideRefPID):null,d=e.is(t.toSideRefPID)?i.getReference(t.toSideRefPID):null,p=e.is(f)?f.get("type"):null,m=e.is(d)?d.get("type"):null,L={};return e.is(p)&&e.is(m)?(a.getPossibleRelations(p,m,"write").forEach(function(r){var i=t.fromSideAbsPath,a=t.toSideAbsPath,f=t.fromSideRefPID,d=t.toSideRefPID,p={};switch(r){case c:case u:p=n.canCreateScopeLink(t,r);break;case l:case g:p=n.canCreateImplementLink(i,a,r);break;case"ResultingProductLink":case"ResultingProductLink_inverse":p=n.canCreateResultingProductLink(f,d,r);break;case"DELLmiProductionSystemOutputCnxToMBOM":case"DELLmiProductionSystemOutputCnxToMBOM_inverse":p=I(t,r);break;case"MfgProcessAlternate":p=h(t,r);break;case"HistorizationLinkRefRef":p=P(t,r);break;case"DELAsmProcessCanUseCnx":case"DELAsmProcessCanUseCnx_inverse":p=s.canCreatePrimaryCapableRscLink(t,r);break;case"SecondaryCandidateResourceLink":case"SecondaryCandidateResourceLink_inverse":p=s.canCreateSecondaryCapableRscLink(t,r);break;case"DELLmiTimeConstraintCnx":case"DELLmiMaterialPathCnxCust":case"DELLmiExecTimeConstraintRelation":p=o.canCreateProductFlowLink(t,r);break;default:p={canCreateLink:!1}}p.canCreateLink&&(delete p.canCreateLink,p.data=e.is(p.data,"array")?p.data:[p.data],L[r]=p)}),L):(r.debug("No Types on models"),[])},isLinkPossible:function(e,t,n,r){return a.isLinkPossible(e,t,n,r)},webServiceRequest:function(e){o.webServiceRequest(e)},getConnection:function(e){return i.getConnection(e)},isExploreWebAppEnabled:function(){return!g.isCloud()},createConnectionsByType:function(e,t){var n=r.getBehavior("ImplementBehavior"),i=n.getScopeLinkType(),a=i+"_inverse",o=n.getImplementLinkType(),s=o+"_inverse",c=e.linkType,u=e.linksData;switch(c){case i:case a:n.createScopeLink(u,t);break;case o:case s:n.createImplementLink(u,t);break;default:this.createConnection(u,t)}},createConnection:function(t,n){var a,o={},s=[],u=r.getBehavior("ProductFlowLinkBehavior"),l=r.getBehavior("CapableResourceLinkBehaviour");e.is(t)&&e.is(t,"array")&&(r.notify("startProgress",o),a=r.log(c.getNLSValue("CreateLink.LogMessage")),s=t.map(function(e){var t;switch(e.type){case"DELAsmProcessCanUseCnx":case"DELAsmProcessCanUseCnx_inverse":case"SecondaryCandidateResourceLink":case"SecondaryCandidateResourceLink_inverse":t=l.createConnection(e,n);break;case"DELLmiTimeConstraintCnx":case"DELLmiMaterialPathCnxCust":case"DELLmiExecTimeConstraintRelation":t=u.createProductFlowLink(e,n);break;default:t=S(e,n)}return t}),e.Promise.allSettled(s).then(function(t){var s=0,u={},l={},g={success:u,failed:l};t.forEach(function(t,n){var i,a;"rejected"===t.state?(s++,a=l,i=t.reason,e.is(i.errorMessage,"string")&&r.debug(i.linkType+" creation failed :  "+i.errorMessage)):(a=u,i=t.value),e.is(a[i.linkType])||(a[i.linkType]={}),e.is(a[i.linkType][i.target])||(a[i.linkType][i.target]=[]),a[i.linkType][i.target].push(i.source)}),Object.keys(g).forEach(function(e){var t="success"===e,n=t?"CreateLink.Success":"CreateLink.Failure",o=g[e];Object.keys(o).forEach(function(e){var s=o[e];Object.keys(s).forEach(function(o){var u,l=s[o],g=[],f=i.getReferenceModel(o).get("V_Name");l.forEach(function(e){var t=i.getReferenceModel(e);g.push(t.get("V_Name"))}),u=c.getNLSValue(n,{linkType:c.getNLSValue(e),target:f,source:g.join(", ")}),t?r.info(u,a):(r.warn(u,a),r.debug(u))})})}),0===s?p(o,null,n,a):m(o,null,null,n,a)}))},canDeleteRelation:function(t){var n,r,o,s,c,u,l=!1;return n=this.getConnection(t),e.is(n)&&("CapableResourcesStructureLink"===(r=n.getAttribute("type"))?l=!1:"SecondaryCandidateResourceLink"===r?l=!0:(o=n.getAttribute("from"),s=i.getReferenceModel(o).get("type"),c=n.getAttribute("to"),u=i.getReferenceModel(c).get("type"),l=a.isRelationTypeConfigured(r,s,u,"write"))),l},deleteConnection:function(t,n){var a,o,s,g,L={},y=i.getConnection(t),I=y.getAttribute("type"),P=c.getNLSValue(I),h=null,v=r.getBehavior("ImplementBehavior");if(n=n||{},s=r.log(c.getNLSValue("DeleteLink.LogMessage",{linkType:P})),e.is(I)&&"PartialProductImplementLink"===I){const t=l.getSelectionsWithPaths(r.getId())[0];if(e.is(t,"array")&&t.length>0){const n=t;if(e.is(n,"array")&&n.length>0){const t=n[0].path,r=e.is(t)&&t.length>0?t:n.id;u.isPartialScoped(r)&&(e.is(r,"array")&&r.length>0?h=r:h.push(r))}if(e.is(h,"array")&&h.length>0)return v.managePartialScopeLink({implementingAbsPath:h,cmdAction:v.PartialScopeAction.DELETE_PARTIALSCOPE})}r.warn(c.getNLSValue("DeletePartialScopeLink.Failure"),s)}else r.notify("startProgress",L),a={onComplete:function(t,i){var a={};p(L,c.getNLSValue("DeleteLink.Success",{linkType:P}),n,s),e.is(t.preferred)&&(a.linkPID=t.preferred,a.state=!0,r.notify("updatePreferredLink",a)),e.is(i)?r.notify("deleteLink",[i.deletedConnections]):r.notify("deleteLink",y.toJSON())},onFailure:g=function(e,t){m(L,c.getNLSValue("DeleteLink.Failure",{linkType:P}),t,n,s)},onTimeout:g,onCancel:g},o=e.extend({},n),a=e.extend(o,a),f===I?u.deleteScopeLink(t,a):d===I?u.deleteImplementLink(t,a):i.deleteConnection(t,a)},addConnection:function(e,t){return i.addConnection(e,t)},updateLinkAttributes:function(e,t,n){var a,o,u,l,g,f,d,L=[],y={},I={},P={};for(t=t||{},n=n||{},a=0;a<t.length;a++)g=s.getNLS(t[a].attributeInfo),f=s.hasRangeDefined(t[a].attributeInfo,t[a].attributeDef)&&s.isInteger(t[a].attributeInfo),l=(d=t[a].objectToBeModified).get(t[a].dataIndex),u=t[a].newValue,f&&(l=s.getAuthorizedValueIndex(t[a].attributeInfo,t[a].attributeDef,l)),s.isDate(t[a].attributeInfo)&&(l=new Date(l).getTime()/1e3),l!==u&&(s.doesAttributeExist(d,t[a].dataIndex)?(t[a].previousValue=l,L.push(t[a])):r.warn(c.getNLSValue("TableView.AvailabilityFailure",{key:g})));if(0!==L.length){for(a=0;a<L.length;a++)y[L[a].attributeName]=L[a].newValue;o={data:y,onFailure:function(e){for(a=0;a<L.length;a++)e.set(L[a].dataIndex,L[a].previousValue);m(P,c.getNLSValue("AttributeUtil.SaveFailed"),e,n)},onComplete:function(){p(P,c.getNLSValue("AttributeUtil.SaveSucceeded"),n),r.notify("editLinkAttributes",I),r.notify("refreshImpacted")},logMessage:c.getNLSValue("AttributeUtil.EditAttributesLogMessage")},r.notify("startProgress",P),i.updateConnection(e,o)}},getConnectionsByModel:function(e,t,n){i.getConnectionsByModel(e,t,n)},getImpactedConnections:function(e,t,n){return i.getImpacted(e,t,n)},getConnectedObjects:function(t,n,a){var o,s,c,u,l=r.getBehavior("ImplementBehavior"),g=r.getBehavior("CapableResourceLinkBehaviour"),f=[];return o=i.getInstance(t),e.is(o)?(s=t,c=i.getReferenceModelFromInstance(o),u=c.get("PID")):(c=i.getReference(t),u=t),i.getImpacted(t,!1,a).forEach(function(e){var t,r=e.get("type"),i=e.get("from"),a=e.get("to");switch(r){case"ProcessImplementLink":case"PartialProcessImplementLink":case"ProcessImplementLinkOcc":f=f.concat(l.getConnectedObjects(u,s,n,e)),t=i===u?a:i;break;case"CapableResourcesStructureLink":case"DELAsmProcessCanUseCnx":case"SecondaryCandidateResourceLink":f=f.concat(g.getConnectedObjects(u,s,n,e));break;case"DELLmiProductionSystemOutputCnxToMBOM":case"MfgProcessAlternate":case"HistorizationLinkRefRef":case"DELIsSerializedFrom":t=i===u?a:i,f.push(t);break;case"DELIsSerializedFromOp":t=i===s?a:i,f.push(t);break;case"ProductImplementLink":case"ProductImplementLinkOcc":case"ResultingProductLink":case"DELLmiTimeConstraintCnx":case"DELLmiMaterialPathCnxCust":break;default:console.log("Invalid Type")}}),f},getXMLValues:function(e,t,n){return o.getXMLValues(e,t,n)},getRelations:function(t){return L(t).then(function(t){var n=t.result;return{isRelationsLoaded:t.relationsLoaded,connections:e.is(n)?n.connections:[]}})},areRelationsLoaded:function(t){var n=!0;return t=Array.isArray(t)?t:[t],i.isNavigateOnDemand()&&(n=t.some(function(t){var n,r,a,o=i.getReferenceModel(t),s=o.id===t;return e.is(o)&&(s||(a=t),r=i.getInstance(a),n=e.is(r)?o.getAdditionalInfo("queriedForConnections")&&r.getAdditionalInfo("queriedForConnections"):o.getAdditionalInfo("queriedForConnections")),n})),n},hasConnection:function(e){return i.hasConnection(e)},getLinkInfo:function(t){var n,r,i,o,u,l={NLS:null,type:null,subType:null,iconName:null};return e.is(t)&&("DELLmiTimeConstraintCnx"===(n=t.get("type"))?(i=a.getAttributeInfo("DELLmiTimeConstraintCnx.V_DependencyType"),"TRUE"===t.get("V_MaterialNeed")?r=n+"_ProductFlow":(o=t.get("V_DependencyType"),u=s.getAuthorizedValueIndex(i,null,o),r=n+"_"+s.getAuthorizedValueDB(i,u)),l.NLS=c.getNLSValue(r),l.type=n,l.subType=r,l.iconName=r):(l.NLS=c.getNLSValue(n),l.type=n,l.subType=t._attributes.kind||t._attributes.flowType,l.iconName=n)),l},getSecondaryRscLinksFromPrimaryLink:function(e){var t;return t=e.get("PID"),i.getImpacted(t,!1,{relationTypes:["SecondaryCandidateResourceLink"]})},cloneSecondaryCapableRscLinkWithFromAttr:function(t){var n=this.getConnection(t.get("from"));return e.is(n)&&(t=t.clone()).set("from",n.get("from")),t},getSecondaryResourceLinksInfo:function(t){var n,r=this,a=[],o=i.getConnection(t),s=this.getSecondaryRscLinksFromPrimaryLink(o);return n=function(t){var n=t.get("PID"),r=t.get("type"),a=t.get("V_IsPreferred"),o=t.get("from"),s=t.get("to"),c=i.getReference(o),u=i.getReference(s),l=e.is(c)?c.get("type"):null,g=e.is(u)?u.get("type"):null,f=e.is(c)?c.get("V_Name"):null,d=e.is(u)?u.get("V_Name"):null,p=e.is(t.get("ResourceUsage"))?t.get("ResourceUsage"):null,m=e.is(p)?i.getInstance(p):null;return{connPID:n,isPreferred:"DELAsmProcessCanUseCnx"===r?a:"",fromPID:o,toPID:s,fromType:l,toType:g,fromName:f,toName:d,resourceUsage:e.is(m)?m.get("PLM_ExternalID"):"",resourceUsagePID:p}},s.forEach(function(e){var t=r.cloneSecondaryCapableRscLinkWithFromAttr(e);a.push(n(t))}),a}}}}}),define("DS/DELWKOModelBehaviors/DELWKOModelBehavior",["UWA/Core","UWA/Promise","DS/DELPPWModelBehaviors/ModelBehavior"],function(e,t,n){"use strict";return{plugins:["DatabasePlugin","ResourcePlugin","AttributePlugin","WebServicePlugin","DicoPlugin","BIPlugin"],creator:function(n,r,i,a,o,s,c,u){var l,g,f,d,p,m,L;return p=function(t,n,i,a,o){var s=i||{};!0===(!e.is(s.popupMessage)||s.popupMessage)?r.info(n,a):r.log(n,a),r.notify("stopProgress",t),e.is(s.onComplete,"function")&&s.onComplete.call(null,n,i,o)},m=function(t,n,i,a,o,s){var c=a||{},u=!e.is(c.popupMessage)||c.popupMessage;e.is(i)&&e.is(i.message,"string")&&(n+="\n"+i.message),!0===u?r.warn(n,o):r.log(n,o),r.notify("stopProgress",t),e.is(c.onFailure,"function")&&c.onFailure.call(null,n,s)},l=function(n,o,s,c,u,l){var g,f,d,L,y,I,P=a.getNLSValue("DeleteObject.Success"),h=a.getNLSValue("DeleteObject.Failure"),v=a.getNLSValue("DeleteObject.PatialFailure"),S=[],C=n?"Instance":"Reference",D={};if(l=!!e.is(l)&&l,g=function(e,t){y=a.getNLSValue(C,{objectLabel:e.get(c)},"Delete","Success"),r.log(y,L),e.isInstance()&&(d=i.getReferenceModelFromInstance(e)),t(d)},f=function(t,n,i){y=a.getNLSValue(C,{objectLabel:t.get(c)},"Delete","Failure"),e.is(i)&&e.is(i.message,"string")&&(y+="\n"+i.message),r.log(y,L),n()},e.is(o,"array")&&o.length>0){if(r.notify("startProgress",D),L=r.log(a.getNLSValue("DeleteObject.LogMessage")),I=i[n?"deleteInstance":"deleteReference"],!e.is(I,"function"))return void r.debug("delete function not found on database plugin.");o.forEach(function(i){S.push(new t(function(t,a){I(i.id,{deep:!!e.is(u)&&u,onComplete:function(){g(i,t),n&&r.notify("deleteInstance",i.toJSON())},onFailure:function(e,t){f(i,a,t)}})}))}),e.Promise.allSettled(S).then(function(t){var i=!1,a=0,o=0,c=[];for(a=0;a<t.length;a++)"rejected"!==t[a].state?e.is(t[a].value)&&c.push(t[a].value):o++;0===o?(p(D,P,s,L),i=!0):o===t.length?m(D,h,null,s,L):(m(D,v,null,s,L),i=!0),i&&n&&l&&r.notify("addToAuxiliaryView",[c,{askAddToAuxConfirmation:!l}])})}},L=function(e,t){return i.isInstancePossible(e,t)},f=function(t,n){var o,s,c,u={},l={},g=!1;return n=n||{},e.is(n.securityContextOverride,"string")&&(c=n.securityContextOverride,delete n.securityContextOverride),e.is(n.silent,"boolean")&&(g=n.silent,delete n.silent),e.is(t)?e.is(t.V_Type)&&e.is(t.type)?(o=r.log(a.getNLSValue("ModelBehavior.createWorkOrderFromProcess.LogMessage",{title:t.V_Name,type:t.type})),r.notify("startProgress",u),s=i.createWorkOrderFromProcess(t,{onComplete:function(t){for(var i=null,s=t.length,c=[],g=[],f=0;f<s;f++)null!=t[f]&&("DELLmiWorkOrderReference"===t[f]._attributes.type&&(i=t[f]),void 0===t[f]._attributes.isAggregatedBy?c.push(t[f]):g.push(t[f]));var d={transactionUUID:e.is(n.transactionUUID,"string")&&n.transactionUUID.length>0?n.transactionUUID:null,referenceAttrs:c,instanceAttrs:g};n.newRef=i,p(u,a.getNLSValue("ModelBehavior.createWorkOrderFromProcess.Success",{name:i._attributes["PLMEntity.PLM_ExternalID"]}),n,o,d),r.notify("createReference",l)},onFailure:function(t,r){var i={transactionUUID:e.is(n.transactionUUID,"string")&&n.transactionUUID.length>0?n.transactionUUID:null,referenceAttrs:null,instanceAttrs:null};m(u,a.getNLSValue("ModelBehavior.createWorkOrderFromProcess.Failure"),r,n,o,i)},securityContextOverride:c,silent:g})):r.debug("Type is required to create createWorkOrderFromProcess",s):r.debug("data is empty to addReference"),s},g=function(t,n){var o,s,c,u={},l={},g=!1;return n=n||{},e.is(n.securityContextOverride,"string")&&(c=n.securityContextOverride,delete n.securityContextOverride),e.is(n.silent,"boolean")&&(g=n.silent,delete n.silent),e.is(t)?e.is(t.V_Type)&&e.is(t.type)?(o=r.log(a.getNLSValue("ModelBehavior.CreateReference.LogMessage",{title:t.V_Name,type:t.type})),r.notify("startProgress",u),s=i.createReference(t,{onComplete:function(t){var i={transactionUUID:e.is(n.transactionUUID,"string")&&n.transactionUUID.length>0?n.transactionUUID:null,referenceAttrs:t.toJSON(),instanceAttrs:null};n.newRef=t,p(u,a.getNLSValue("ModelBehavior.createWorkOrderFromProcess.Success",{name:t.get("PLM_ExternalID")}),n,o,i),r.notify("createReference",l)},onFailure:function(t,r){var i={transactionUUID:e.is(n.transactionUUID,"string")&&n.transactionUUID.length>0?n.transactionUUID:null,referenceAttrs:null,instanceAttrs:null};m(u,a.getNLSValue("ModelBehavior.createWorkOrderFromProcess.Failure"),r,n,o,i)},securityContextOverride:c,silent:g})):r.debug("Type is required to create createReference",s):r.debug("data is empty to addReference"),s},d=function(t,n){var o,s,c={},u=!0;n=n||{},e.is(n.securityContextOverride,"string")&&(s=n.securityContextOverride,delete n.securityContextOverride),e.is(t)?e.is(t.isAggregatedBy)?(e.is(t.isInstanceOf)&&(u=L(i.getReference(t.isAggregatedBy),i.getReference(t.isInstanceOf))),u?(r.notify("startProgress",c),o=r.log(a.getNLSValue("ModelBehavior.CreateInstance.LogMessage")),i.createInstance(t,{onComplete:function(t){var s=i.getReferenceModelFromInstance(t),u={transactionUUID:e.is(n.transactionUUID,"string")&&n.transactionUUID.length>0?n.transactionUUID:null,referenceAttrs:e.is(s)?s.toJSON():null,instanceAttrs:e.is(t)?t.toJSON():null};n.newInst=t,p(c,a.getNLSValue("ModelBehavior.CreateInstance.Success",{name:t.get("PLM_ExternalID")}),n,o,u),r.notify("createInstance",t.toJSON())},onFailure:function(t,r){var i={transactionUUID:e.is(n.transactionUUID,"string")&&n.transactionUUID.length>0?n.transactionUUID:null,referenceAttrs:null,instanceAttrs:null};m(c,a.getNLSValue("ModelBehavior.CreateInstance.Failure"),r,n,o,i)},securityContextOverride:s})):r.debug("Instance object cannot be created between two selected Types")):r.debug("isAggregatedBy required to create instance"):r.debug("data is empty to createInstance")},{onStart:function(){},onStop:function(){},moveInstance:function(t){var n,o,c,l=t||{},g=null,f=null,d={},L=widget.getBool("oneDelmiaAggregationMode"),y=a.getNLSValue("ModelBehavior.ReparentInstances"),I=a.getNLSValue("ModelBehavior.ReparentInstances.Success"),P=a.getNLSValue("ModelBehavior.ReparentInstances.Failure");n=function(t){var n,a={formerParentsPIDArray:g.formerInstancesParentPIDs,movedInstPIDArray:g.instancesPIDsToReparent,newParentPID:g.newParentPID,newInstPIDArray:[]},o=[],s={stackedObjects:{stackedReferences:[],stackedInstances:[],stackedConnections:[],deletedObjects:[]},silentOpt:!0,onComplete:function(t){var n,s=r.getPreferenceValue("refreshBIOnAuthoring");for(n of(s=!!e.is(s,"boolean")&&s,a.newInstPIDArray=t.instancePIDs.slice(),a.newInstPIDArray))i.manageLinearProductFlowsOnCreateInstancePID(n);r.notify("reparentInstances",a),o.length>0&&r.notify("removeInstance",[o]),s&&u.getBICmdState()&&u.computeBI(),p(d,I,l,f),r.notify("reparentEnd",g.newParentPID)}};for(n of g.instancesPIDsToReparent)i.manageLinearProductFlowsOnDeleteInstancePID(n);e.is(t.deletedObjects)&&t.deletedObjects.forEach(function(t){var n=i.getInstance(t);e.is(n)&&o.push(n)}),i.parseServerObjects(t,s)},o=function(e,t){l.popupMessage=!0,r.notify("reparentEnd",g.newParentPID),m(d,P,t,l,f)},f=r.log(y),r.notify("startProgress",d),g={oneDelmiaAggregationMode:L,instancesPIDsToReparent:e.is(l.instancesPIDsToReparent)?l.instancesPIDsToReparent:[],formerInstancesParentPIDs:e.is(l.formerInstancesParentPIDs)?l.formerInstancesParentPIDs:[],newParentPID:e.is(l.newParentPID)?l.newParentPID:"",newParentInstancesOrder:e.is(l.newParentInstancesOrder)?l.newParentInstancesOrder:[]},c={url:"dsmfg/private/V0/invoke/reparent",method:"POST",headers:s.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),onComplete:n,onFailure:o,data:e.Json.encode(g)},r.notify("reparentBegin",g.newParentPID),r.debug("Reparent instance ("+g.instancesPIDsToReparent.reduce(function(e,t,n){return e+(0===n?"":", ")+t+"#"+i.getInstance(t).get("PLM_ExternalID")},"")+"), formerly under reference ("+g.formerInstancesParentPIDs.reduce(function(e,t,n){return e+(0===n?"":", ")+t+"#"+i.getReference(t).get("V_Name")},"")+"), under new reference ("+g.newParentPID+"#"+i.getReference(g.newParentPID).get("V_Name")+")"),s.webServiceRequest(c)},moveMultipleInstances:function(n,i,o){var s=this;return new t(function(t,r){var i=e.merge({onComplete:t,onFailure:r,popupMessage:!1},n);s.moveInstance(i)}).then(function(){var e=a.getNLSValue("ModelBehavior.MoveInstances.Success",{instanceLabel:o,newParentLabel:i});return r.info(e),t.resolve(e)})},createWorkOrderFromProcess:function(t,n,i){var a,o={};if(e.is(t)){for(a in t)Object.prototype.hasOwnProperty.call(t,a)&&(o[a]=t[a]);f(o,i)}else r.debug("createWorkOrderFromProcess: No data to insert")},createRefOrInst:function(t,n,i){var a,o={};if(e.is(t)){for(a in t)Object.prototype.hasOwnProperty.call(t,a)&&(o[a]=t[a]);e.is(n,"string")?(o.isAggregatedBy=n,d(o,i)):g(o,i)}else r.debug("createRefOrInst: No data to insert")},createMultipleInstances:function(e,n,o){var s;return s=e.map(function(e){return function(e){return new t(function(t,n){const a=i.getReference(e.referencePID);d({isAggregatedBy:e.targetReferencePID,isInstanceOf:e.referencePID,skipScopeCheck:r.getPreferenceValue("skipVaidationIfScopedCheck")&&c.isAKindOf(a,"Provide")},{onComplete:t,onFailure:n,popupMessage:!1})})}(e)}),t.all(s).then(function(){var e=a.getNLSValue("ModelBehavior.CreateInstances.Success",{instanciatedReference:o,referenceName:n});return r.info(e),t.resolve(e)}).fail(function(e){return r.warn(e),t.reject(e)})},deleteReference:function(t,n){var o,s,c,u=r.getBehavior("UXFactoryBehavior"),g=a.getNLSValue("Delete.Confirmation.Title");if(e.is(u)){if(n=n||{},e.is(t,"array")&&t.length>0){for(s=a.getNLSValue("DeleteReference.Confirmation.Message"),o=0;o<t.length;o++)if(i.getInstancesFromCollection(t[o].id).length>0){c=a.getNLSValue("Confirmation.DeleteWholeStructure");break}e.is(c)?u.showConfirmation(g,s,{attributes:["V_Name"],models:t},function(r,i,a){e.is(r)&&r&&l(!1,t,n,"V_Name",a)},{check:c}):u.showConfirmation(g,s,{attributes:["V_Name"],models:t},function(r){e.is(r)&&r&&l(!1,t,n,"V_Name",!1)})}}else r.debug("uxFactoryBehavior is not available.")},deleteInstance:function(t,n){var i,o,s,c=r.getBehavior("UXFactoryBehavior"),u=a.getNLSValue("Confirmation.addRefToAuxViewPostDelete");e.is(c)?(n=n||{},i=!e.is(n.askDeleteConfirmation)||n.askDeleteConfirmation,e.is(t,"array")&&t.length>0&&(i?(e.is(n.isDetachInstance)&&n.isDetachInstance?(s=a.getNLSValue("Detach.Confirmation.Title"),o=a.getNLSValue("DetachInstance.Confirmation.Message")):(s=a.getNLSValue("Delete.Confirmation.Title"),o=a.getNLSValue("DeleteInstance.Confirmation.Message")),c.showConfirmation(s,o,{attributes:["PLM_ExternalID"],models:t},function(r,i,a){e.is(r)&&r&&l(!0,t,n,"PLM_ExternalID",!1,a)},{check:u})):l(!0,t,n,"PLM_ExternalID"))):r.debug("uxFactoryBehavior is not available.")},fetchRoot:function(e,t){return i.fetchRoot(e,t)},fetchInstancesAndTheirReferences:function(e,t){return i.fetchInstancesAndTheirReferences(e,t)},isNavigateOnDemand:function(){return i.isNavigateOnDemand()},fetchInstance:function(e,t){return i.fetchInstance(e,t)},getReference:function(e){return i.getReference(e)},removeReference:function(e,t){i.removeReference(e,t)},getInstance:function(e){return i.getInstance(e)},getReferenceModelFromInstance:function(e){return i.getReferenceModelFromInstance(e)},getAggregatingReferenceModelFromInstance:function(e){return i.getAggregatingReferenceModelFromInstance(e)},getReferenceIdFromInstance:function(e){return i.getReferenceIdFromInstance(e)},getReferenceId:function(e){var t=e;return this.isInstance(e)&&(t=i.getReferenceIdFromInstance(e)),t},getInstancesFromCollection:function(e){return i.getInstancesFromCollection(e)},needToQueryForConnections:function(e){return i.needToQueryForConnections(e)},needToQueryForChildren:function(e){return i.needToQueryForChildren(e)},getDescendantsFromServer:function(e,t,n){i.getDescendantsFromServer(e,t,n)},getConnectionsFromServer:function(e,t,n){i.getConnectionsFromServer(e,t,n)},getAllChildrenFromCollection:function(e){return i.getAllChildrenFromCollection(e)},getImpactedConnections:function(t,n,r){var a,o=[];return e.is(t,"array")&&t.forEach(function(t){a=i.getImpacted(t,n,r),e.is(a)&&e.is(a,"array")&&a.length>0&&(o=o.concat(a))}),o},getReferenceModel:function(e){return i.getReferenceModel(e)},isReference:function(t){return e.is(this.getReference(t))},isInstance:function(t){return e.is(this.getInstance(t))},updateModelAttribute:function(t,n,s,c){var u,l,g,f,d,L,y,I,P,h,v,S,C,D,k,R,b,T,A,F,O,V,N,M,E=this,w=[],B=function(t){var n=t,r=function(t){return e.is(t,"string")?o.getFormattedDate(t):o.getFormattedDate(1e3*t)};return o.isDate(C)?n=Array.isArray(t)?t.map(function(e){return r(e)}):r(t):h&&!y&&(n=o.getValueAsString(t,o.getType(C))),n};e.is(n,"array")&&(n=n[0]),n=n||{},c=c||{},e.is(n.instOrRef)&&e.is(n.dataIndex)&&e.is(n.attributeInfo)&&e.is(n.objectToBeModified)&&e.is(n.attributeName)?(k=n.attributeName,C=n.attributeInfo,D=e.is(n.attributeDef)?n.attributeDef:{},d=o.getNLS(C),R=n.objectToBeModified,S=n.dataIndex,L="instance"===n.instOrRef,y=o.hasRangeDefined(C,D),I=o.isString(C),P=o.isInteger(C),h=o.isDouble(C),v=o.isMultiValuated(C),f=R.get(S),e.is(f)&&"NULL"!==f||(f=""),y&&!v&&(I||P||h)&&(f=o.getAuthorizedValue(C,D,f)),T=function(e,t,n,i){var o,s=B(n),c=r.getBehavior("UXFactoryBehavior"),u=c.getComponent("Button"),l=c.createElement("div",{class:"confirmation-dialog-content-container",html:"<p>"+a.getNLSValue("UpdateAttributeUI.Text",{prevValue:s})+"</p>"});(o=c.create("Dialog",{title:a.getNLSValue("UpdateAttributeUI.Header",{attributeName:d}),domId:"EditAttributeUI-Dialog",content:l,resizableFlag:!0,modalFlag:!0,buttons:{No:new u({onClick:function(){n===t&&b(e,i,n),o.close()}}),Yes:new u({disabled:!1,onClick:function(){b(e,t,n),o.close()}})}})).close=function(){this.destroy(),o=null}},A=function(t){var n=!1,i=s;return e.is(t)&&(g=t.get(S),y&&!v&&(I||P)&&(g=o.getAuthorizedValue(C,D,g)),o.isDate(C)&&!o.isMultiValuated(C)?(g=(g=new Date(g).getTime()/1e3).toString(),i=s=i.toString()):h&&o.hasMagnitude(C)&&!v&&(g=parseFloat(g),i=parseFloat(i),s=i.toString()),g!==i&&(o.doesAttributeExist(t,S)?n=!0:r.warn(a.getNLSValue("TableView.AvailabilityFailure",{key:d})))),n},e.is(t,"array")?t.forEach(function(e){u=L?E.getInstance(e):E.getReference(e),A(u)&&w.push(u.id)}):A(R)&&w.push(R.id),0!==w.length&&(1===w.length?(b=function(t,n,o){var s={previous:{}},u={},g={};s[k]=n,s.previous[k]=o,l={data:s,onFailure:function(e,t){m(g,a.getNLSValue("TableView.SingleUpdateFailure",{key:d,value:B(n)}),t,c)},onComplete:function(i,s){var l=i.get(S);e.is(s)&&e.is(s.isInSync)&&!s.isInSync?(m(g,a.getNLSValue("TableView.UpdateWarning",{key:d})),T(t,n,l,o)):e.is(i._changed.modified)?(p(g,a.getNLSValue("TableView.SingleUpdateSuccess",{key:d,value:B(l)}),c),r.notify("editAttribute",u)):m(g,a.getNLSValue("TableView.SingleUpdateFailure",{key:d,value:B(n)}),s,c)},logMessage:a.getNLSValue("TableView.SingleUpdateLogMessage")},r.notify("startProgress",g),!0===L?i.updateInstance(t,l):i.updateReference(t,l)})(w[0],s,f):w.length>1&&(O=s,N={},M={},(V={keyValues:{},pids:F=w}).keyValues[k]=O,l={data:V,onFailure:function(e){m(M,a.getNLSValue("TableView.MassUpdateFailure",{key:d,value:B(O)}),e,c)},onComplete:function(e){e.length!==F.length?m(M,a.getNLSValue("TableView.UpdateWarning",{key:d})):(p(M,a.getNLSValue("TableView.MassUpdateSuccess",{key:d,value:B(O)}),c),r.notify("editAttribute",N))},logMessage:a.getNLSValue("TableView.MassUpdateLogMessage")},r.notify("startProgress",M),!0===L?i.updateInstances(S,l):i.updateReferences(S,l)))):r.debug("Required attribute information is missing to update the model attribute")},getValidChildTypes:function(e){return i.getValidChildTypes(e)},isInstancePossible:function(e,t){return L(e,t)},isMovePossible:function(t,n){var r,a=!1;return i.isWorkInstruction(n)?a=!1:n&&n.get("isAggregatedBy")!==t.id&&(r=this.getReferenceModelFromInstance(n).get("PPRTYPE"),e.is(r)&&(a=c.isReparentPossible(r))),a},isAKindOf:function(e,t){return c.isAKindOf(e,t)},getTypeHierarchy:function(e){return c.getTypeHierarchy(e)},getPPRType:function(e){return i.getPPRType(e)},getPPRTypeFromType:function(e){return c.getPPRType(e)},getParentTypes:function(e){return c.getParentTypes(e)},getReadOnlyTypes:function(){return c.getReadOnlyTypes()},isReferencesHasReadOnlyType:function(e){return c.isReferencesHasReadOnlyType(e)},getMajorRevisions:function(t,n,o){var c,u,l,g=i.getReferenceModel(t).get("V_Name");u=function(e,t,n){r.debug("jsonData: "+e+" error:"+t+" options: "+n),c=a.getNLSValue("Error.GetMajorRevisionFailure.Title",{objectName:g}),o(c)},l=function(e){n(e)},s.webServiceRequest({url:"dsmfg/private/V0/invoke/getMajorRevisions",method:"POST",data:e.Json.encode({pid:t}),onFailure:u,onTimeout:u,onCancel:u,onComplete:l})},isReadOnly:function(t,n,i,o){var c,u,l;u=function(e,t,n){r.debug("jsonData: "+e+" error:"+t+" options: "+n),o()},l=function(t){e.is(t.isReadOnly)&&t.isReadOnly&&(c=a.getNLSValue("Error.ObjNotInReadWrite.Title",{objectName:n})),i(c)},s.webServiceRequest({url:"dsmfg/private/V0/invoke/isReadOnly",method:"GET",data:{pid:t},onFailure:u,onTimeout:u,onCancel:u,onComplete:l})},isLatestRevision:function(t,n,i,o){var c,u,l;u=function(e,t,n){r.debug("jsonData: "+e+" error:"+t+" options: "+n),o()},l=function(t){e.is(t.isLatestRevision)&&!t.isLatestRevision&&(c=a.getNLSValue("Error.ObjNotLatestRevision.Title",{objectName:n})),i(c)},s.webServiceRequest({url:"dsmfg/private/V0/invoke/isLatestRevision",method:"GET",data:{pid:t},onFailure:u,onTimeout:u,onCancel:u,onComplete:l})},getWhereUsedReferences:function(e,t){i.getWhereUsedReferences(e,t)},getTenant:function(){return s.getTenant()},getSecurityContext:function(){return s.getSecurityContext()},get3DSpaceUrl:function(){return s.get3DSpaceUrl()},isEntityInstance:function(e){return c.isEntityInstance(e)},getAcceptedBaseTypesForCreation:function(){var t=[],n=c.getAcceptedBaseTypesForActions();return e.is(n)&&e.is(n.CREATION,"array")&&(t=n.CREATION),t},getFilteredInstancesFromCollection:function(e,t){return i.getFilteredInstancesFromCollection(e,t)}}}}}),define("DS/DELWKOModelBehaviors/DELWKOProductFlowBehavior",["UWA/Core","UWA/Promise"],function(e,t){"use strict";return{plugins:["DatabasePlugin","DicoPlugin","WebServicePlugin","ResourcePlugin"],creator:function(n,r,i,a,o,s){var c,u,l=["DELLmiTimeConstraintCnx","DELLmiMaterialPathCnxCust","LinearProductFlowCnx","DELLmiExecTimeConstraintRelation"];return u=function(t,n){var r,a,o;return o=t[t.length-1],!(!i.getImpacted(o,!1,{relationTypes:l}).some(function(r){return e.equals(r.get("from"),t)&&e.equals(r.get("to"),n)})&&(r=!1,(a=function(n){var o,s,c,u=n[n.length-1],g=i.getImpacted(u,!1,{relationTypes:l});for(c=0;c<g.length&&(o=g[c],!0!==r);c++)if(e.equals(o.get("from"),n)){if(e.equals(o.get("to"),t)){r=!0;break}s=o.get("to"),a(s)}})(n),!r))},c=function(t,n){var r,a,o,s,c,u,l={},g={},f=!1;if(e.is(t,"array")&&e.is(n,"array")){for(r=t.length-1;r>=0;r--){for(o=t[r],a=i.getInstance(o).get("isAggregatedBy"),s=n.length-1;s>=0;s--)if(c=n[s],e.is(g[c])?u=g[c]:(u=i.getInstance(c).get("isAggregatedBy"),g[c]=u),a===u&&o!==c){f=!0;break}if(f)break}l.fromPath=t.slice(r),l.toPath=n.slice(s)}return l},{listenTo:function(){},onStart:function(){},onStop:function(){},canCreateProductFlowLink:function(t,n){var r,o,l,g,f,d,p,m,L=!0,y={};return d=function(){var t=!1,n=g.toString(),i=f.toString();return g.length>0&&f.length>0&&0!==n.indexOf(i)&&0!==i.indexOf(n)&&(r=c(g,f),t=e.is(r)&&Array.isArray(r.fromPath)&&r.fromPath.length>0&&Array.isArray(r.toPath)&&r.toPath.length>0),t},p=function(){var t,n,o=!1;return e.is(r)&&Array.isArray(r.fromPath)&&r.fromPath.length>0&&(n=i.getInstance(r.fromPath[0]),e.is(n)&&(t=i.getReference(n.get("isAggregatedBy")),o=a.isAKindOf(t,"DELLmiHeaderWorkPlanReference"))),o},m=function(){var e;return e=i.getInstance(g[g.length-1]),"Linear"===i.getReference(e.get("isAggregatedBy")).get("V_SequencingMode")},t=t||{},e.is(t.fromSideAbsPath)&&e.is(t.toSideAbsPath)?(g=t.fromSideAbsPath,f=t.toSideAbsPath,o=s.getNLSValue(n),d()?p()?(L=!1,l=s.getNLSValue("ProductFlowLinkBehavior.canCreateProductFlowLinkError.CommonParentIsHeaderWP",{linkType:o})):m()?(L=!1,l=s.getNLSValue("ProductFlowLinkBehavior.canCreateProductFlowLinkError.ParentisInLinearSeqMode",{linkType:o})):u(r.fromPath,r.toPath)&&(L=!1,l=s.getNLSValue("ProductFlowLinkBehavior.canCreateProductFlowLinkError.ExistOrLoop",{linkType:o})):(L=!1,l=s.getNLSValue("ProductFlowLinkBehavior.canCreateProductFlowLinkError.NoCommonParent",{linkType:o}))):(L=!1,l=s.getNLSValue("ProductFlowLinkBehavior.canCreateProductFlowLinkError.InsufficentInfo")),y={canCreateLink:L},L?y.data=e.merge({type:n,fromSideOccPath:e.is(r,"object")?r.fromPath:null,toSideOccPath:e.is(r,"object")?r.toPath:null,displayText:e.is(o)?o:null,buttonIdentifier:e.is(o)?o:null},e.clone(t)):y.errorMessage=l,y},createProductFlowLink:function(n,r){var a=this;return new t(function(t,o){var s,c,u,l,g,f;n=n||{},u=a.canCreateProductFlowLink(n,n.type),l=n.fromSideOccPath[n.fromSideOccPath.length-1],g=n.toSideOccPath[n.toSideOccPath.length-1],f={linkType:n.type,target:l,source:g},u.canCreateLink?(s=function(){t(f)},c=function(t,n){e.is(n)&&(f.errorMessage=n),o(f)},i.createConnection({IDFrom:n.fromSideOccPath.toString(),IDTo:n.toSideOccPath.toString(),type:n.type},e.merge({onFailure:c,onTimeout:c,onCancel:c,onComplete:s},r||{}))):(f.errorMessage=u.errorMessage,o(f))})},getProductFlowRelationTypes:function(){return l},getProductFlowRelationTypeByPPRType:function(e){return l["OPERATION"===e?0:1]}}}}});