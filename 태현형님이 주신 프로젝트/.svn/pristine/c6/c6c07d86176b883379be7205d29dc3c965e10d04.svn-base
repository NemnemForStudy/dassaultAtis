define("DS/VCXWebCanonics/VCXAMeasurableHolder",["require","exports"],function(e,t){"use strict";return class{getMeasurables(e){return null}populateMagnets(e,t,i){var n=this.getMeasurables(i);n&&n.forEach(i=>{i.populateMagnets(e,t)})}}}),define("DS/VCXWebCanonics/VCXIMeasurableHolder",["DS/WebComponentModeler/CATWebInterface"],function(e){"use strict";return e.singleton({interfaceName:"VCXIMeasurableHolder",required:{getMeasurables:function(e){},populateMagnets:function(e,t,i){}}})}),define("DS/VCXWebCanonics/VCXMagnet",["require","exports","DS/Mesh/MeshUtils"],function(e,t,i){"use strict";class n{constructor(e){this._active=!0,this._nodes={0:null,1:null,2:null};for(let t in e)this[t]=e[t];this.from=e.d,this.measurable&&this.setDefaultProperties()}insertIntoArray(e){e[this.getType()]||(e[this.getType()]=[]),e[this.getType()].push(this)}setDefaultProperties(){this.measurable&&(this.measurableID=this.measurable.getID(),this.pathElement=this.measurable.getPathElement(),this.associatedObject=this.measurable.getHolder())}createAndGetRootDecoration(e){return this.associatedObject.GetObject()._experienceBase.getManager("VCXCanonicsManager").createAndGetRootDecoration(e,this.getType())}updateFromRay(e,t){return this}isInInfluenceSphere(e,t,i){if(this.measurable){const n=t+this.measurable.worldRadius;if(i&&e.distanceToSquared(i)<n*n)return!0;if(this.measurable.isActive()||this.measurable.forceVisible)return!0}return!1}getNode(e){return null}getCachedNode(e){if(e.createIfMissing&&!this._nodes[e.nodeType]){const t=this.getNode(e);t&&(this._nodes[e.nodeType]=t,t.setName("VCXCanonic"+this.getType()+"_"+this.measurableID+"_"+e.nodeType),this.update(e),e.nodeType===n.ENodeType.picking?this.createAndGetRootDecoration(e).add(this._nodes[e.nodeType]):t.setPickable(i.PICKTHROUGH))}return this._nodes&&this._nodes[e.nodeType]}_setNodeOptions(e){if(!e)return this;const t=this.associatedObject.GetObject()._experienceBase.getManager("VCXVisuManager");return e.setRenderPasses([t.getRenderList("VCXPre3DManipulators"),t.getRenderList("VCX3DManipulators")]),e.setFrustumCulled&&e.setFrustumCulled(!1),e.setShadow&&e.setShadow(!1,!1),e.setMirror&&e.setMirror(!1),e.exludeFromBounding&&e.exludeFromBounding(!0),e.handle=this.associatedObject,e.measurableID=this.measurableID,e.magnet=this,this}setVisibility(e,t){const i=this.getCachedNode(e);if(!i)return i;let s=t;return e.nodeType===n.ENodeType.feedbackLive&&(s=s&&this.isActive()),s?(i.parents[0]||this.createAndGetRootDecoration(e).add(i),i&&!i.isVisible()&&i.setVisibility(!0)):i&&i.isVisible()&&i.setVisibility(!1),i}update(e){const t=this.getCachedNode(e);if(t){const i=this.measurable&&this.measurable.isActive();this._visuManager||(this._visuManager=this.associatedObject.GetObject()._experienceBase.getManager("VCXVisuManager"));const s=this.associatedObject&&this.associatedObject.GetObject()._experienceBase.getManager("VCXCanonicsManager"),a=s&&s.getDefaultMaterial(e,this.getLineType(),i?30:5,t._text&&(e.nodeType!==n.ENodeType.picking||s._debugDisplay),"D"===this.measurable.from,e.iIsUnactive);a!==t.getMaterial()&&t.setMaterial(a);const r="VCXMagnet"+this.getType()+(i?"Active":"");t.setPickingPriorityId(r)}return this}isActive(){return this._active}setActive(e){return this._active!==e&&(this._active=e),this._active}getLineType(){return"Plain"}getType(){return"Basic"}}return function(e){let t;!function(e){e[e.picking=0]="picking",e[e.feedback=1]="feedback",e[e.feedbackLive=2]="feedbackLive"}(t=e.ENodeType||(e.ENodeType={}))}(n||(n={})),n}),define("DS/VCXWebCanonics/VCXCanonicsManagerEnum",["require","exports"],function(e,t){"use strict";var i;return function(e){let t;!function(e){e[e.None=0]="None",e[e.Point=1]="Point",e[e.Center=2]="Center",e[e.Axis=4]="Axis",e[e.Line=8]="Line",e[e.Circle=16]="Circle",e[e.Plane=32]="Plane",e[e.Cylinder=64]="Cylinder",e[e.Cone=128]="Cone",e[e.Object=256]="Object"}(t=e.Canonic||(e.Canonic={}))}(i||(i={})),i}),define("DS/VCXWebCanonics/VCXMeasurable",["require","exports","DS/Visualization/Node3D","DS/VCXWebCanonics/VCXMagnet"],function(e,t,i,n){"use strict";return class{constructor(e){this._type=e.type,this.from=e.d,this.forceVisible=!1}async populateMagnets(e,t){this._magnets&&this._magnets.forEach(e=>{e.insertIntoArray(t)})}doesCircleContributes(e){return!1}getType(){return this._type}getPathElement(){return this._pathElement}setPathElement(e){return this._pathElement=e,this._pathElement}getID(){return this._ID}setID(e){return this._ID=e,this._ID}getHolder(){return this._holder}setHolder(e){return this._holder=e,this._holder}getHolderMatrix(e){return this._pathElement.getWorldMatrix(e,null)}isActive(){return this._active}getNode(e){return e.createIfMissing&&!this._node&&(this._node=new i,this._magnets.forEach(t=>{let i=t.getCachedNode(e);i&&this._node.add(i)})),this._node}setActive(e,t){if(this._active!==e){this._active=e,this._magnets&&this._magnets.forEach(e=>{e.update({createIfMissing:this._active,nodeType:n.ENodeType.picking})});var i=this.getHolder().GetObject()._experienceBase.getManager("VCXCanonicsManager");let s=this.getNode({createIfMissing:this._active,nodeType:n.ENodeType.feedback}),a=this.getNode({createIfMissing:this._active,nodeType:n.ENodeType.feedbackLive});a&&a.setVisibility(this._active),this._magnets&&this._magnets.forEach(e=>{let i=this._active;e.setActive(i),e.setVisibility({createIfMissing:i,nodeType:n.ENodeType.feedback},i),e.setVisibility({createIfMissing:i&&t===e,nodeType:n.ENodeType.feedbackLive},i&&t===e),i&&(e.update({createIfMissing:i,nodeType:n.ENodeType.feedback,iIsUnactive:t!==e}),t===e&&e.update({createIfMissing:i&&t===e,nodeType:n.ENodeType.feedbackLive}))}),this._active&&i.setFeedbackNode({static:s,live:a})}return this}getSize(e){return 0}}}),define("DS/VCXWebCanonics/VCXMagnetPoint",["require","exports","DS/VCXWebSystem/VCXMeshServices","DS/VCXWebCanonics/VCXMagnet","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/Visualization/Node3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/BillBoardNode3D"],function(e,t,i,n,s,a,r,o,c,l){"use strict";return class extends n{updateFromRay(e,t){return this.point=this.position.clone(),this}isInInfluenceSphere(e,t,i){return super.isInInfluenceSphere(e,t,this.position)}update(e){if(e.nodeType===n.ENodeType.feedback)return null;var t=this.getCachedNode(e);if(e.nodeType===n.ENodeType.feedbackLive)if(this.position&&this.normal&&t){let e=r.getMatrixFromOVz(this.position,this.normal);t.setMatrix(e)}else console.warn(new Error("Error"));else if(e.nodeType===n.ENodeType.picking)if(this.position&&this.normal&&t){let e=r.getMatrixFromOVz(this.position,this.normal);t.setMatrix(e)}else console.warn(new Error("Error"));return super.update(e)}getNode(e){if(e.nodeType===n.ENodeType.feedback)return new o;if(e.nodeType===n.ENodeType.picking){let e=2;this.associatedObject&&this.associatedObject.GetObject()._experienceBase.getManager("VCXGUIManager").isTouchActivated()&&(e*=1.5);let t=i.buildLineStripSet([-.001,-.001,-.001,.001,.001,.001],[2],[0,1],null,e,null);return this._setNodeOptions(t),t}if(e.nodeType===n.ENodeType.feedbackLive){let e=s.createRectangleNode({width:1,height:1,cornerPoint:new a.Vector2(-.5,-.5),fill:!0,noEdge:!0,layerNb:1});this._setNodeOptions(e);let t=15;this.associatedObject&&this.associatedObject.GetObject()._experienceBase.getManager("VCXGUIManager").isTouchActivated()&&(t*=1.5);let i=new c({name:"fixedSizePoint",ratio:t});i.add(e);let n=new l({name:"billBoardPoint",type:"Spherical"});n.add(i),n.setBillboardType("Spherical");let r=new o("VCXCanonicPoint");return r.add(n),r._text=!0,r}return null}getType(){return"Point"}}}),define("DS/VCXWebCanonics/VCXMagnetCenter",["require","exports","DS/VCXWebCanonics/VCXMagnetPoint"],function(e,t,i){"use strict";return class extends i{getType(){return"Center"}}}),define("DS/VCXWebCanonics/VCXMagnetCircle",["require","exports","DS/VCXWebCanonics/VCXMagnet","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebCanonics/VCXMagnetPoint"],function(e,t,i,n,s,a,r){"use strict";return class extends i{constructor(e){super(e)}updateFromRay(e,t){let i=(new s.Plane).setFromNormalAndCoplanarPoint(this.axis,this.position),n=e.intersectPlane(i);return this.xAxis=n.sub(this.position).normalize(),this.feedbackPoint=this.position.clone().add(this.xAxis.clone().multiplyScalar(this.radius)),1===t.snappingBehavior?(this.point=this.position.clone(),this.normal=this.axis.clone(),this):(this.point=this.feedbackPoint.clone(),this.normal=this.xAxis.clone(),this.xAxis=(new s.Vector3).crossVectors(this.axis,this.xAxis),this)}isInInfluenceSphere(e,t,i){return super.isInInfluenceSphere(e,t,this.position)}update(e){var t=this.getCachedNode(e);if(e.nodeType===i.ENodeType.feedbackLive)if(this.feedbackPoint&&this.normal&&t){let e=a.getMatrixFromOVz(this.feedbackPoint,this.normal);t.setMatrix(e)}else console.warn(new Error("Error"));else if(this.position&&this.axis&&this.radius&&t){let e=new s.Vector3(this.radius,0,0),i=new s.Vector3(0,this.radius,0),n=new s.Vector3(0,0,1),r=(new s.Matrix4).makeBasis(e,i,n),o=a.getMatrixFromOVz(this.position,this.axis);t.setMatrix((new s.Matrix4).multiplyMatrices(o,r))}else console.warn(new Error("Error"));return super.update(e)}getNode(e){if(e.nodeType===i.ENodeType.feedbackLive)return r.prototype.getNode.call(this,e);if(this.position&&this.axis&&this.radius){var t=n.createCircleNode({radius:1,segments:96,fill:!1});return this._setNodeOptions(t),t}return console.warn(new Error("Error")),null}getType(){return"Circle"}}}),define("DS/VCXWebCanonics/VCXMeasurableSphere",["require","exports","DS/Visualization/Measurable","DS/VCXWebCanonics/VCXMeasurable","DS/VCXWebCanonics/VCXMagnetCenter","DS/VCXWebCanonics/VCXMagnetCircle","DS/VCXWebSystem/VCXMathTools","DS/Visualization/ThreeJS_DS"],function(e,t,i,n,s,a,r,o){"use strict";class c extends n{constructor(e){super(e),this._type=i.TYPESPHERE,this.center=e.center,this.radius=e.radius}static fromCircles(e){if(e&&2===e.length){let t=(new o.Vector3).subVectors(e[1].center,e[0].center).normalize();return new c({...e[0],...e[1],center:(new o.Vector3).addVectors(e[0].convergencePoint,e[1].convergencePoint).multiplyScalar(.5),radius:Math.max(e[0].convergencePointRadius,e[1].convergencePointRadius),axis:t,d:"O"})}return null}doesCircleContributes(e){const t=.001*this.radius;return this.center.distanceToSquared(e.convergencePoint)<t&&Math.abs(this.radius-e.convergencePointRadius)<t}getSize(e){return 2*this.radius}async populateMagnets(e,t){let i=this.getHolderMatrix(e),n=this.center.clone().applyMatrix4(i),o=this.radius*i.getMaxScaleOnAxis(),c=this.axis||r.getVzFromMatrix(this._pathElement.getWorldMatrix(e,null));this.worldRadius=o;let l=0;this._magnets||(this._magnets=[],this._magnets.push(new s({measurable:this,magnetID:l++})),this._magnets.push(new a({measurable:this,magnetID:l++}))),l=0;let h=this._magnets[l];h.position=n,h.radius=o,h.normal=c,l++;let d=this._magnets[l];return d.position=n,d.radius=o,d.axis=c,super.populateMagnets(e,t)}}return c}),define("DS/VCXWebCanonics/VCXMagnetAxis",["require","exports","DS/VCXWebCanonics/VCXMagnet","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebCanonics/VCXMagnetPoint"],function(e,t,i,n,s,a,r){"use strict";return class extends i{constructor(){super(...arguments),this.worldSizeScale=10}isABetterCandidate(e){if(this.point&&this.center&&this.normal&&e.center&&e.normal){let t=a.sideOperatorFromPointsNormal(this.center,this.normal,e.center,e.normal);if(this.point&&Math.abs(t)<1e-5&&new s.Ray(e.start,e.normal).distanceToPoint(this.point)<1e-5&&this.point.distanceToSquared(e.center)<this.point.distanceToSquared(this.center))return!0}return!1}isInInfluenceSphere(e,t,i){return super.isInInfluenceSphere(e,t,this.center)}updateFromRay(e,t){let i=this.start.clone().add(this.normal.clone().multiplyScalar(this.getWorldSize()*this.worldSizeScale));return this.point=new s.Vector3,e.distanceSqToSegment(this.start,i,void 0,this.point),this}getWorldSize(){let e=this.associatedObject.GetObject()._experienceBase.getManager("VCXContextManager"),t=(e?e.getRootPathElement():null).getBoundingSphere(e.getMainViewer());return 2*(t?t.radius:1e3)}update(e){let t=this.getCachedNode(e);if(e.nodeType===i.ENodeType.feedbackLive)if(this.point&&this.normal&&t){let e=a.getMatrixFromOVz(this.point,this.normal);t.setMatrix(e)}else console.warn(new Error("Error"));else if(this.start&&this.normal&&t){let e=new s.Vector3(1,0,0),i=new s.Vector3(0,1,0),n=new s.Vector3(0,0,this.getWorldSize()*this.worldSizeScale),r=(new s.Matrix4).makeBasis(e,i,n),o=a.getMatrixFromOVz(this.start,this.normal);t.setMatrix((new s.Matrix4).multiplyMatrices(o,r))}else console.warn(new Error("Error"));return super.update(e)}getNode(e){if(e.nodeType===i.ENodeType.feedbackLive)return r.prototype.getNode.call(this,e);if(this.center&&this.normal){let e=n.createLineNode({points:[new s.Vector3(0,0,0),new s.Vector3(0,0,1)]});return this._setNodeOptions(e),e}return null}getLineType(){return"Dotted"}getType(){return"Axis"}}}),define("DS/VCXWebCanonics/VCXMeasurableCone",["require","exports","DS/Visualization/Measurable","DS/VCXWebCanonics/VCXMeasurable","DS/VCXWebCanonics/VCXMagnetCenter","DS/VCXWebCanonics/VCXMagnetAxis","DS/VCXWebCanonics/VCXMagnetCircle","DS/Visualization/ThreeJS_DS"],function(e,t,i,n,s,a,r,o){"use strict";class c extends n{constructor(e){super(e),this._type=i.TYPECONE,this.axis=e.axis,this.apex=e.apex,this.semiAngle=e.semiAngle,this.extremity1=e.extremity1,this.extremity2=e.extremity2,this.center=e.center||(new o.Vector3).addVectors(this.extremity1,this.extremity2).multiplyScalar(.5)}static fromCircles(e){if(e&&2===e.length){const t=(new o.Vector3).addVectors(e[0].apex,e[1].apex).multiplyScalar(.5),i=(new o.Vector3).addVectors(e[0].center,e[1].center).multiplyScalar(.5);let n=(new o.Vector3).subVectors(i,t).normalize();i.distanceToSquared(t)<.001&&(n=n.subVectors(e[0].center,e[1].center).normalize());const s=new c({apex:t,semiAngle:.5*(e[0].semiAngle+e[1].semiAngle),center:i,extremity1:i.clone(),extremity2:i.clone(),axis:n,d:"O"});return s.considerNewExtremity(e[0].center),s.considerNewExtremity(e[1].center),s}return null}considerNewExtremity(e){if((new o.Vector3).subVectors(this.extremity1,e).normalize().dot(this.axis)<0)new o.Ray(this.apex,this.axis).closestPointToPoint(e,this.extremity1);else{(new o.Vector3).subVectors(this.extremity2,e).normalize().dot(this.axis)>0&&new o.Ray(this.apex,this.axis).closestPointToPoint(e,this.extremity2)}}doesCircleContributes(e){return this.apex.distanceToSquared(e.apex)<.001&&Math.abs(this.axis.dot(e.axis))>.999&&(this.considerNewExtremity(e.center),!0)}getSize(e){let t=this.getHolderMatrix(e),i=this.extremity1.clone().applyMatrix4(t),n=this.extremity2.clone().applyMatrix4(t),s=this.apex.clone().applyMatrix4(t),a=Math.tan(this.semiAngle),r=s.distanceTo(i)*a,o=s.distanceTo(n)*a;return 2*Math.max(r,o)}async populateMagnets(e,t){let i=this.getHolderMatrix(e),n=this.extremity1.clone().applyMatrix4(i),c=this.extremity2.clone().applyMatrix4(i),l=this.apex.clone().applyMatrix4(i),h=this.axis.clone().transformDirection(i).normalize(),d=Math.tan(this.semiAngle),u=l.distanceTo(n),p=h.clone().multiplyScalar(u).add(l),g=Math.abs(u*d),m=l.distanceTo(c),C=h.clone().multiplyScalar(m).add(l),b=Math.abs(m*d);this.worldRadius=Math.max(g,b);{let e=(new o.Vector3).addVectors(p,C).multiplyScalar(.5),t=0;this._magnets||(this._magnets=[],this._magnets.push(new a({measurable:this,magnetID:t++})),this._magnets.push(new a({measurable:this,magnetID:t++})),this._magnets.push(new s({measurable:this,magnetID:t++})),this._magnets.push(new s({measurable:this,magnetID:t++})),this._magnets.push(new s({measurable:this,magnetID:t++})),this._magnets.push(new r({measurable:this,magnetID:t++})),this._magnets.push(new r({measurable:this,magnetID:t++}))),t=0;let i=this._magnets[t];i.center=p,i.start=e,i.radius=g,i.normal=h,t++;let n=this._magnets[t];n.center=C,n.start=e,n.radius=b,n.normal=h.clone().negate(),t++;let c=this._magnets[t];c.position=p,c.radius=g,c.normal=h,t++;let l=this._magnets[t];l.position=C,l.radius=b,l.normal=h.clone().negate(),t++;let d=this._magnets[t];d.position=e,d.radius=.5*(b+g),d.normal=h.clone().negate(),t++;let u=this._magnets[t];u.position=p,u.radius=g,u.axis=h,t++;let m=this._magnets[t];m.position=C,m.radius=b,m.axis=h.clone().negate()}return super.populateMagnets(e,t)}}return c}),define("DS/VCXWebCanonics/VCXMeasurableCircle",["require","exports","DS/Visualization/Measurable","DS/VCXWebCanonics/VCXMeasurable","DS/VCXWebCanonics/VCXMagnetCenter","DS/VCXWebCanonics/VCXMagnetAxis","DS/VCXWebCanonics/VCXMagnetCircle"],function(e,t,i,n,s,a,r){"use strict";class o extends n{constructor(e){super(e),this._type=i.TYPECIRCLE,this.center=e.center,this.axis=e.axis,this.radius=e.radius}static fromCircles(e){return e&&1===e.length?new o({...e[0],d:"O"}):null}getSize(e){return 2*this.radius}async populateMagnets(e,t){{let t=this.getHolderMatrix(e),i=this.center.clone().applyMatrix4(t),n=this.radius*t.getMaxScaleOnAxis(),o=this.axis.clone().transformDirection(t).normalize();this.worldRadius=n;let c=0;this._magnets||(this._magnets=[],this._magnets.push(new s({measurable:this,magnetID:c++})),this._magnets.push(new r({measurable:this,magnetID:c++})),this._magnets.push(new a({measurable:this,magnetID:c++})),this._magnets.push(new a({measurable:this,magnetID:c++}))),c=0;let l=this._magnets[c];l.position=i,l.radius=n,l.normal=o,c++;let h=this._magnets[c];h.position=i,h.radius=n,h.axis=o,c++;let d=this._magnets[c];d.center=i,d.start=i,d.radius=n,d.normal=o,c++;let u=this._magnets[c];u.center=i,u.start=i,u.radius=n,u.normal=o.clone().negate()}return super.populateMagnets(e,t)}}return o}),define("DS/VCXWebCanonics/VCXMeasurableCylinder",["require","exports","DS/Visualization/Measurable","DS/VCXWebCanonics/VCXMeasurable","DS/VCXWebCanonics/VCXMagnetCenter","DS/VCXWebCanonics/VCXMagnetAxis","DS/VCXWebCanonics/VCXMagnetCircle","DS/Visualization/ThreeJS_DS"],function(e,t,i,n,s,a,r,o){"use strict";class c extends n{constructor(e){super(e),this._type=i.TYPECYLINDER,this.center=e.center,this.axis=e.axis,this.radius=e.radius,this.extremity1=e.extremity1,this.extremity2=e.extremity2,this.center=e.center||(new o.Vector3).addVectors(this.extremity1,this.extremity2).multiplyScalar(.5)}static fromCircles(e){if(e&&2===e.length){let t=(new o.Vector3).subVectors(e[1].center,e[0].center).normalize();return new c({...e[0],...e[1],center:(new o.Vector3).addVectors(e[0].center,e[1].center).multiplyScalar(.5),axis:t,extremity1:e[0].center,extremity2:e[1].center,d:"O"})}return null}doesCircleContributes(e){const t=.001*this.radius;return Math.abs(this.axis.dot(e.axis))>.999&&(this.extremity1.distanceToSquared(e.center)<t||this.extremity2.distanceToSquared(e.center)<t)&&Math.abs(this.radius-e.radius)<t}getSize(e){return 2*this.radius}async populateMagnets(e,t){let i=this.getHolderMatrix(e),n=this.radius*i.getMaxScaleOnAxis(),c=this.center.clone().applyMatrix4(i),l=this.extremity1.clone().applyMatrix4(i),h=this.extremity2.clone().applyMatrix4(i),d=this.axis.clone().transformDirection(i).normalize(),u=l.distanceTo(h);this.worldRadius=n;{let e=new o.Vector3(c.x+.5*u*d.x,c.y+.5*u*d.y,c.z+.5*u*d.z),t=new o.Vector3(c.x-.5*u*d.x,c.y-.5*u*d.y,c.z-.5*u*d.z),i=(new o.Vector3).addVectors(e,t).multiplyScalar(.5),l=0;this._magnets||(this._magnets=[],this._magnets.push(new a({measurable:this,magnetID:l++})),this._magnets.push(new a({measurable:this,magnetID:l++})),this._magnets.push(new s({measurable:this,magnetID:l++})),this._magnets.push(new s({measurable:this,magnetID:l++})),this._magnets.push(new s({measurable:this,magnetID:l++})),this._magnets.push(new r({measurable:this,magnetID:l++})),this._magnets.push(new r({measurable:this,magnetID:l++}))),l=0;let h=this._magnets[l];h.center=e,h.start=i,h.radius=n,h.normal=d,l++;let p=this._magnets[l];p.center=c,p.start=i,p.radius=n,p.normal=d.clone().negate(),l++;let g=this._magnets[l];g.position=e,g.radius=n,g.normal=d,l++;let m=this._magnets[l];m.position=t,m.radius=n,m.normal=d.clone().negate(),l++;let C=this._magnets[l];C.position=i,C.radius=n,C.normal=d.clone().negate(),l++;let b=this._magnets[l];b.position=e,b.radius=n,b.axis=d,l++;let M=this._magnets[l];M.position=t,M.radius=n,M.axis=d.clone().negate()}return super.populateMagnets(e,t)}}return c}),define("DS/VCXWebCanonics/VCXMeasurableTorus",["require","exports","DS/Visualization/Measurable","DS/VCXWebCanonics/VCXMeasurable","DS/VCXWebCanonics/VCXMagnetCenter","DS/VCXWebCanonics/VCXMagnetAxis","DS/VCXWebCanonics/VCXMagnetCircle","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],function(e,t,i,n,s,a,r,o,c){"use strict";class l extends n{constructor(e){super(e),this._type=i.TYPETORUS,this.center=e.center,this.axis=e.axis,this.minRadius=e.minRadius,this.maxRadius=e.maxRadius}static fromCircles(e){if(e&&2===e.length){const t=(new o.Vector3).crossVectors(e[0].axis,e[1].axis).normalize(),i=(new o.Plane).setFromNormalAndCoplanarPoint(t,e[0].center);if(Math.abs(i.distanceToPoint(e[1].center))<.001){const i=(new o.Vector3).crossVectors(t,e[0].axis).normalize(),n=(new o.Vector3).crossVectors(t,e[1].axis).normalize(),s=c.getNearestDistanceBetween2Lines(e[0].center,i,e[1].center,n);if(s.d<.001){const i=(new o.Vector3).addVectors(s.p1,s.p2).multiplyScalar(.5),n=Math.max(e[0].center.distanceTo(i),e[1].center.distanceTo(i)),a=n-Math.min(e[0].radius,e[1].radius),r=n+Math.max(e[0].radius,e[1].radius);return new l({...e[0],...e[1],center:i,minRadius:a,maxRadius:r,axis:t,d:"O"})}}}return null}doesCircleContributes(e){const t=(new o.Vector3).subVectors(e.center,this.center);return Math.abs(this.axis.dot(t))<1e-4&&Math.abs(e.axis.dot(t))<1e-4&&Math.abs(this.axis.dot(e.axis))<1e-4}getSize(e){return 2*Math.max(this.minRadius,this.maxRadius)}async populateMagnets(e,t){let i=this.getHolderMatrix(e),n=this.center.clone().applyMatrix4(i),o=this.axis.clone().transformDirection(i).normalize(),c=this.minRadius*i.getMaxScaleOnAxis(),l=this.maxRadius*i.getMaxScaleOnAxis();this.worldRadius=Math.max(c,l);let h=0;this._magnets||(this._magnets=[],this._magnets.push(new s({measurable:this,magnetID:h++})),this._magnets.push(new r({measurable:this,magnetID:h++})),this._magnets.push(new r({measurable:this,magnetID:h++})),this._magnets.push(new a({measurable:this,magnetID:h++})),this._magnets.push(new a({measurable:this,magnetID:h++}))),h=0;let d=this._magnets[h];d.position=n,d.radius=l,d.normal=o,h++;let u=this._magnets[h];u.position=n,u.radius=c,u.axis=o,h++;let p=this._magnets[h];p.position=n,p.radius=l,p.axis=o,h++;let g=this._magnets[h];g.start=n,g.center=n,g.radius=c,g.normal=o,h++;let m=this._magnets[h];return m.start=n,m.center=n,m.radius=l,m.normal=o.clone().negate(),super.populateMagnets(e,t)}}return l}),define("DS/VCXWebCanonics/VCXMagnetLine",["require","exports","DS/VCXWebSystem/VCXMeshServices","DS/VCXWebCanonics/VCXMagnet","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebCanonics/VCXMagnetPoint"],function(e,t,i,n,s,a,r){"use strict";return class extends n{updateFromRay(e,t){return this.point=new s.Vector3,e.distanceSqToSegment(this.extremity1,this.extremity2,null,this.point),this}isInInfluenceSphere(e,t,i){return!!(this.extremity1&&e.distanceToSquared(this.extremity1)<t*t||this.extremity2&&e.distanceToSquared(this.extremity2)<t*t)||super.isInInfluenceSphere(e,t,null)}update(e){var t=this.getCachedNode(e);if(e.nodeType===n.ENodeType.feedbackLive)if(this.point&&this.normal&&t){let e=a.getMatrixFromOVz(this.point,this.normal);t.setMatrix(e)}else console.warn(new Error("Error"));if(this.extremity1&&this.extremity2&&t){var i=new s.Vector3(1,0,0),r=new s.Vector3(0,1,0),o=new s.Vector3(0,0,this.extremity1.distanceTo(this.extremity2)),c=(new s.Matrix4).makeBasis(i,r,o),l=(new s.Vector3).subVectors(this.extremity2,this.extremity1),h=a.getMatrixFromOVz(this.extremity1,l);t.setMatrix((new s.Matrix4).multiplyMatrices(h,c))}else console.warn(new Error("Error"));return super.update(e)}getNode(e){if(this.extremity1&&this.extremity2){if(e.nodeType===n.ENodeType.feedbackLive)return r.prototype.getNode.call(this,e);var t=i.buildLineStripSet([0,0,0,0,0,1],[2],[0,1],null,2,null);return this._setNodeOptions(t),t}return console.warn(new Error("Error")),t}getType(){return"Line"}}}),define("DS/VCXWebCanonics/VCXMeasurableLine",["require","exports","DS/Visualization/Measurable","DS/VCXWebCanonics/VCXMeasurable","DS/VCXWebCanonics/VCXMagnetLine","DS/VCXWebCanonics/VCXMagnetPoint","DS/VCXWebCanonics/VCXMagnetCenter","DS/Visualization/ThreeJS_DS"],function(e,t,i,n,s,a,r,o){"use strict";return class extends n{constructor(e){super(e),this._type=i.TYPELINE,this.startPosition=e.startPosition,this.endPosition=e.endPosition,this.direction=(new o.Vector3).subVectors(this.endPosition,this.startPosition).normalize()}getSize(e){let t=this.getHolderMatrix(e),i=this.startPosition.clone().applyMatrix4(t),n=this.endPosition.clone().applyMatrix4(t);return i.distanceTo(n)}async populateMagnets(e,t){let i=this.getHolderMatrix(e),n=this.startPosition.clone().applyMatrix4(i),c=this.endPosition.clone().applyMatrix4(i),l=this.direction.clone().transformDirection(i),h=(new o.Vector3).addVectors(n,c).multiplyScalar(.5),d=0;this._magnets||(this._magnets=[],this._magnets.push(new s({measurable:this,magnetID:d++})),this._magnets.push(new a({measurable:this,magnetID:d++})),this._magnets.push(new a({measurable:this,magnetID:d++})),this._magnets.push(new r({measurable:this,magnetID:d++}))),d=0;let u=this._magnets[d];u.extremity1=n,u.extremity2=c,u.normal=l,d++;let p=this._magnets[d];p.position=n,p.normal=l,d++;let g=this._magnets[d];g.position=c,g.normal=l.clone().negate(),d++;let m=this._magnets[d];return m.position=h,m.normal=l,super.populateMagnets(e,t)}}}),define("DS/VCXWebCanonics/VCXMagnetPlane",["require","exports","DS/VCXWebCanonics/VCXMagnet","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/Visualization/Node3D"],function(e,t,i,n,s,a,r){"use strict";return class extends i{updateFromRay(e,t){return this.point=new s.Vector3,e.intersectPlane((new s.Plane).setFromNormalAndCoplanarPoint(this.normal,this.origin),this.point),this}isInInfluenceSphere(e,t,i){return super.isInInfluenceSphere(e,t,this.origin)}update(e){const t=this.getCachedNode(e);if(this.origin&&this.normal&&this.width&&this.height&&t){let n=this.width,r=this.height,o=this.origin;if(e.nodeType===i.ENodeType.feedbackLive){const e=(this.associatedObject&&this.associatedObject.GetObject()._experienceBase.getManager("VCXContextManager")).getMainViewer().currentViewpoint.getEyePosition().distanceTo(this.point)/20;n=e,r=e,o=this.point}const c=new s.Vector3(n,0,0),l=new s.Vector3(0,r,0),h=new s.Vector3(0,0,1),d=(new s.Matrix4).makeBasis(c,l,h),u=new s.Matrix4;u.setPosition(new s.Vector3(-.5,-.5,0));const p=a.getMatrixFromOVz(o,this.normal);t.setMatrix((new s.Matrix4).multiplyMatrices(p,(new s.Matrix4).multiplyMatrices(d,u)))}else console.warn(new Error("Error"));return super.update(e)}getNode(e){if(e.nodeType===i.ENodeType.feedback)return new r;if(this.origin&&this.normal&&this.width&&this.height){var t=n.createRectangleNode({width:1,height:1,fill:!0});return this._setNodeOptions(t),t}return console.warn(new Error("Error")),null}getType(){return"Plane"}}}),define("DS/VCXWebCanonics/VCXMeasurablePlane",["require","exports","DS/Visualization/Measurable","DS/VCXWebCanonics/VCXMeasurable","DS/VCXWebCanonics/VCXMagnetPlane"],function(e,t,i,n,s){"use strict";return class extends n{constructor(e){super(e),this._type=i.TYPEPLANE,this.normal=e.normal,this.position=e.position,this.width=e.width,this.height=e.height}getSize(e){return Math.max(this.width,this.height)}async populateMagnets(e,t){const i=this.getHolderMatrix(e),n=this.width*i.getMaxScaleOnAxis(),a=this.height*i.getMaxScaleOnAxis();this.worldRadius=.5*Math.max(n,a);let r=0;this._magnets||(this._magnets=[],this._magnets.push(new s({measurable:this,magnetID:r++}))),r=0;let o=this._magnets[r];return o.origin=this.position.clone().applyMatrix4(i),o.normal=this.normal.clone().transformDirection(i).normalize(),o.width=n,o.height=a,super.populateMagnets(e,t)}}}),define("DS/VCXWebCanonics/VCXCanonicsManagerArcBar",["DS/VCXWebGUIInfra/VCXArcBar","DS/VCXWebCanonics/VCXCanonicsManagerEnum","DS/WebappsUtils/WebappsUtils","i18n!DS/VCXWebVisualization/assets/nls/VCXWebVisualization"],function(e,t,i,n){"use strict";var s=e.extend({init:function(e){if(this.canonicsManager=e&&e.canonicsManager,this._experienceBase=this.canonicsManager&&this.canonicsManager._experienceBase,this.AvailableFilter=e&&e.availableFilter,!this.canonicsManager||!this.AvailableFilter)return null;var t=this._experienceBase.getManager("VCXContextManager").getUIFrame();if(!t)return null;var i=-10;this._experienceBase.getManager("VCXContextManager").isTouchCompliantDevice()&&(i+=25);var n=this._createButtons();return n&&n.length?this._parent({experienceBase:this._experienceBase,body:t,frmWindow:this._experienceBase.getManager("VCXContextManager").getFrameWindow(),title:"Filter Control",typeSeparator:"bubble",actionBar:this._experienceBase.getManager("VCXContextManager").getActionBar(),heightOffset:i,lJsonElement:n,heightElem:38,widthElem:38,minOpacity:.4,padding:7}):null},_createButtons:function(){var e=[],s=this.canonicsManager._canonicsMode;for(var a in t.Canonic)if(this.AvailableFilter&t.Canonic[a]){if(!a||""===a){console.log("[ARC BAR][NLS] Geometry can't be identified");continue}var r=n["Canonic."+a];if(!r||""===r){console.log("[ARC BAR][NLS] Geometry translation can't be identified from the input string");continue}var o=i.getWebappsAssetUrl("VCXWebCanonics","icons/I_VCX_Canonics_"+a+".png");if(!o||""===o){console.log("[ARC BAR][URL] Geometry icon url can't be identified from the input string");continue}var c=t.Canonic[a];if(!c){console.log("[ARC BAR][ENUM] Geometry enum can't be identified from the input string");continue}this.canonicsManager.detectableCanonics&c&&(s|=c);var l={nls:r,url:o,id:"id_Canonic_"+a,type:"element",userdata:c,check:this.canonicsManager.detectableCanonics&c,callback:e=>{var t=this.canonicsManager.detectableCanonics;t&e?t&=~e:t|=e,this.canonicsManager.detectableCanonics=t},callbackUpdate:(e,t)=>{var i=this.canonicsManager.detectableCanonics;e.check=!!(i&t);var n=this.canonicsManager._canonicsMode;e.enable=!!(n&t)}};e.push(l),this.canonicsManager._canonicsMode=s}return e}});return Object.defineProperty(s.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCanonicsManagerArcBar"}}),Object.defineProperty(s.prototype,"AvailableFilter",{enumerable:!0,get:function(){return this._AvailableFilter},set:function(e){this._AvailableFilter=e}}),Object.defineProperty(s.prototype,"ActiveFilter",{enumerable:!0,get:function(){return this._ActiveFilter},set:function(e){this._ActiveFilter=e}}),s}),define("DS/VCXWebCanonics/VCXCanonicsManager",["require","exports","DS/VCXWebSystem/VCXMeshServices","DS/Mesh/MeshUtils","DS/VCXWebVisualization/VCXInteractor","WebappsUtils/WebappsUtils","DS/VCXWebCanonics/VCXCanonicsManagerArcBar","DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Visualization/Node3D","DS/VCXWebSystem/VCXMathTools","DS/VCXWebCanonics/VCXMagnet","DS/VCXWebCanonics/VCXCanonicsManagerEnum"],function(e,t,i,n,s,a,r,o,c,l,h,d,u){"use strict";class p{constructor(){this.pixelsEpsilon=10,this.canonicMat={}}init(){this._canonicsMode=u.Canonic.None,this.detectableCanonics=u.Canonic.None,this._redoDetection=!0}clearVisu(){var e=this._experienceBase?this._experienceBase.getManager("VCXContextManager").getMainViewer():null;if(e){for(let e in this._decorationNode)this._decorationNode.hasOwnProperty(e)&&this._decorationNode[e].removeChildren();this._rootDecoration&&this._rootDecoration.removeChildren(),e.removeNode(this._rootDecoration),this._rootFeedback&&this._rootFeedback.removeChildren(),e.removeNode(this._rootFeedback),this._rootFeedbackLive&&this._rootFeedbackLive.removeChildren(),e.removeNode(this._rootFeedbackLive)}this._verticalLineNode=null,this._horizontalLineNode=null,this._rootDecoration=null,this._decorationNode=[],this._rootFeedback=null,this._rootFeedbackLive=null}clear(){delete this._detectedObject,delete this._magnets,this.detectedCanonic=null,this._redoDetection=!0,this.clearVisu()}postInitialize(){var e=this._experienceBase.getManager("VCXContextManager");e&&e.isSupported("CanonicsDetection")&&(this._WUXEventTokens={},this._WUXEventTokens.VCX_TEMPORARILY_HIDE_DECORATION=c.subscribe({event:"VCX_TEMPORARILY_HIDE_DECORATION"},e=>{if(this._rootDecoration&&this._rootDecoration.setVisibility(!1),this._peHighlightSet){var t=this._peHighlightSet.getHighlightData();t.colorEnabled=!1,t.haloEnabled=!1,t.outlineEnabled=!1,this._peHighlightSet.setHighlightData(!0,t)}}),this._WUXEventTokens.VCX_RESTORE_TEMPORARILY_HIDDEN_DECORATION=c.subscribe({event:"VCX_RESTORE_TEMPORARILY_HIDDEN_DECORATION"},e=>{if(this._rootDecoration&&this._rootDecoration.setVisibility(!0),this._peHighlightSet){var t=this._peHighlightSet.getHighlightData();t.colorEnabled=!0,t.haloEnabled=!0,t.outlineEnabled=!0,this._peHighlightSet.setHighlightData(!0,t)}}),this._WUXEventTokens.VCX_INTERACTOR_BEGIN_MANIPULATE=c.subscribe({event:"VCX_INTERACTOR_BEGIN_MANIPULATE"},e=>{if(!e||!this.detectableCanonics)return;let t=e.attachedOccurrence;t||(t=e.attachedOccurrences&&e.attachedOccurrences[0]),t&&this.activateOccurrenceMagnets(t,null)}))}unInitialize(){for(var e in this.canonicMat={},this.clear(),this._arcBar&&this._arcBar.clear(),this._arcBar=null,this._WUXEventTokens)this._WUXEventTokens.hasOwnProperty(e)&&this._WUXEventTokens[e]&&(c.unsubscribe(this._WUXEventTokens[e]),this._WUXEventTokens[e]=null)}_shouldDisplayArcBar(){var e=this._experienceBase.getManager("VCXContextManager");if(!(e&&e.isSupported("CanonicsDetection")))return 0;var t=0,i=this._experienceBase.getManager("VCXManipulatorManager");return i&&i._activeManipulables&&i._activeManipulables.forEach(e=>{if(e.GetObject().IsKindOf("VCXDressup_Spec")&&e){var i=e.getActiveInteractors();for(var n in i)if(i.hasOwnProperty(n)){var s=i[n];if(s.isManipulated())return void(t=s.canonicsDetection);s.active&&s.tag&&s.tag.Canonic&&(t|=s.canonicsDetection)}}}),t}getPreHighlightSet(){if(!this._peHighlightSet){var e=this._experienceBase.getManager("VCXContextManager").getMainViewer();this.peHighlightColor=new o.AdvancedPoliteHighlightData({polite:!0,priority:-4,colorEnabled:!0,color:new o.Color(16777215),intensity:.5,visibleAlpha:.3,occludedAlpha:.3,haloEnabled:!0,haloColor:new o.Color(16777215),lineicHaloColor:new o.Color(16777215),haloIntensity:1,haloThickness:4,outlineEnabled:!0,outlineColor:new o.Color(16777215),lineicOutlineColor:new o.Color(16777215),outlineAlpha:.3,outlineThickness:.5}),this._peHighlightSet=e.createHighlightSet(this.peHighlightColor,!1,!0,!0)}return this._peHighlightSet}getDefaultMaterial(e,t="Plain",i,n=!1,s=!0,r=!1){let c=e.nodeType===d.ENodeType.feedback||e.nodeType===d.ENodeType.feedbackLive;var l=c?2:i||3,h=t+"_"+l+"_"+e.nodeType+"_"+(n?1:0)+"_"+(s?1:0)+"_"+(r?1:0);if(!this.canonicMat[h])if(n){let e=a.getWebappsAssetUrl("VCXWebVisualization","texture"),t=new o.ImageUtils.loadTexture(e+"/VCX_Point_dot.png");t.flipY=!1,t.minFilter=o.LinearMipMapLinearFilter,this.canonicMat[h]=new o.MeshBasicMaterial({map:t,side:o.DoubleSide,alphaTest:.005,enableClipPlanes:!1,opacity:1,force:!0})}else{this.canonicMat[h]=new o.MeshBasicMaterial({side:o.DoubleSide,opacity:c?.3:this._debugDisplay?.1:0,color:"#FFFFFF",force:!0});let e=new o.Color("#E87B00");r&&(e=new o.Color("#FFFFFF")),!s&&this._debugDisplay&&(e=new o.Color("#080B99"));let i=c?this._debugDisplay?.5:r?.5:.9:this._debugDisplay?.3:0;r&&"Dotted"===t&&(i=0);let n=new o.LineBasicMaterial({dashType:t,isCPUPattern:!0});n=this._experienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({lineWidth:l,color:e,opacity:i},n),this.canonicMat[h].line=n}return this.canonicMat[h]}activateOccurrenceMagnets(e,t){this.clear(),this._magnets={},this._magnetDirty=!0,this._detectedObject=e;let i=this._detectedObject.QueryInterface("VCXIMeasurableHolder");i&&this._analyseMeasurableHolder(i,t),this._magnetDirty=!0}update(e){if(this.askDetection(),this._magnets)if(this._experienceBase.getManager("VCXVisuManager").HasViewpointMoved||this._magnetCreated){if(this._magnetDirty=!0,this._magnetCreated=!1,this._magnetDisplayed){this._magnetDisplayed=!1;for(let e in this._magnets)this._magnets.hasOwnProperty(e)&&this._decorationNode&&this._decorationNode[e]&&this._decorationNode[e].setVisibility(!1);this._experienceBase.getManager("VCXContextManager").getMainViewer().render()}}else if(this._magnetDirty){this._magnetDisplayed=!0,this._magnetDirty=!1;let t=-1;const i=this._pickInfo.globalPosition;let n=this._pickInfo&&this._pickInfo.modifiable&&this._pickInfo.modifiable.GetObject();n?this.lastPickedObject=n:n=this.lastPickedObject;for(const s in this._magnets){const a=this.detectableCanonics&u.Canonic[s];if(a){const r=this._magnets[s];r&&r.forEach(s=>{let r=!1;if(this._pickInfo&&n&&n===s.associatedObject.GetObject()){if(t<1){const n=this._experienceBase.getManager("VCXPaperManager");n&&(t=50/n.GetModelToPixelRatio(e,i))}r=s.isInInfluenceSphere(i,t,null)}s.setVisibility({createIfMissing:r,nodeType:d.ENodeType.picking},r),r&&s.update({createIfMissing:!!a,nodeType:d.ENodeType.picking})})}this._decorationNode&&this._decorationNode[s]&&this._decorationNode[s].setVisibility(a)}this._experienceBase.getManager("VCXContextManager").getMainViewer().render()}var t=this._experienceBase.getManager("VCXContextManager");t&&t.partHasMoved&&(this._redoDetection=!0),this._visuDirty&&(this._visuDirty=!1,this.detectedCanonic&&this.detectedCanonic.update({createIfMissing:!0,nodeType:d.ENodeType.feedbackLive}),this.detectedCanonic&&this.detectedCanonic.update({createIfMissing:!0,nodeType:d.ENodeType.feedback}))}snap2D(e,t,i,n){var a,r=t&&t.manipulatorType!==s.EManipulatorType.None;if(this._showVerticalLine=!1,this._showHorizontalLine=!1,n&&(n.snapX=null,n.snapY=null),!r){var c=i.viewer.currentViewpoint.project(t.manipulator.initial3dIntersectionPoint);if(n.translationVector){var l=i.viewer.currentViewpoint.project(t.manipulator.initial3dIntersectionPoint.clone().add(n.translationVector));a=(new o.Vector3).subVectors(l,c)}else a=c}let h=this.check2DSnapping(e,t,i,a);if(h&&(h.X||h.Y)){if(h.X){let e=h.X.screenCoord2[0];if(r){let t=e.x-i.mouse.xPix;Math.abs(t)<this.pixelsEpsilon&&(i.mouse.xPix=e.x,i.mouse.snapX=t,this._showVerticalLine=!0)}else{let t=h.X.screenCoord1[0],i=e.x-t.x;Math.abs(i)<this.pixelsEpsilon&&(n.snapX=i,this._showVerticalLine=!0)}}if(h.Y){let e=h.Y.screenCoord2[0];if(r){let t=e.y-i.mouse.yPix;Math.abs(t)<this.pixelsEpsilon&&(i.mouse.yPix=e.y,i.mouse.snapY=t,this._showHorizontalLine=!0)}else{let t=h.Y.screenCoord1[0],i=e.y-t.y;Math.abs(i)<this.pixelsEpsilon&&(n.snapY=i,this._showHorizontalLine=!0)}}}this._update2DLineFeedback("vertical",this._showVerticalLine,h&&h.X,i),this._update2DLineFeedback("horizontal",this._showHorizontalLine,h&&h.Y,i)}static check2DCandidate(e,t,i,n,s){var a=Math.max(Math.abs(i.x-t.x),Math.abs(n.x-t.x),Math.abs(n.x-i.x)),r=Math.max(Math.abs(i.y-t.y),Math.abs(n.y-t.y),Math.abs(n.y-i.y));return a<s&&(!e.X||a<e.X.minDistX+.01)&&(e.X&&(a<e.X.minDistX-.01?e.X=null:Math.abs(i.x-e.X.screenCoord2[0].x)<.01&&(e.X.screenCoord1.includes(t)||e.X.screenCoord1.push(t),e.X.screenCoord2.includes(i)||e.X.screenCoord2.push(i))),e.X||(e.X={minDistX:a,screenCoord1:[t],screenCoord2:[i]})),r<s&&(!e.Y||r<e.Y.minDistY+.01)&&(e.Y&&(r<e.Y.minDistY-.01?e.Y=null:Math.abs(i.y-e.Y.screenCoord2[0].y)<.01&&(e.Y.screenCoord1.includes(t)||e.Y.screenCoord1.push(t),e.Y.screenCoord2.includes(i)||e.Y.screenCoord2.push(i))),e.Y||(e.Y={minDistY:r,screenCoord1:[t],screenCoord2:[i]})),e}check2DSnapping(e,t,i,n){var a=this._experienceBase.getManager("VCXDressupManager");if(e&&e.IsKindOf("VCXMarkup_Spec")){var r=e.QueryInterface("VCXIModifiable");if(r&&1e3===r.GetPropertyValue("Collab.3D.Paper.Positioning.Type")){var c=e.QueryInterface("VCXIManipulable").getActiveInteractors(),l={};for(var d in c)if(c.hasOwnProperty(d)){var u=c[d];if(u.manipulatorType!==s.EManipulatorType.None&&u.tag&&u.tag.Snap2D){var g,m;n?((g=i.viewer.currentViewpoint.project(h.getOFromMatrix(u.initialMatrix))).add(n),m=g.clone()):((m=(g=i.viewer.currentViewpoint.project(h.getOFromMatrix(u.matrix))).clone()).x=i.mouse.xPix,m.y=i.mouse.yPix);var C=this._experienceBase.getManager("VCXPaperManager");if(C){var b=C.MMToPixel2(null,new o.Vector2(0,0));p.check2DCandidate(l,g,b,m,this.pixelsEpsilon),b=C.MMToPixel2(null,C.Size),p.check2DCandidate(l,g,b,m,this.pixelsEpsilon),b=C.MMToPixel2(null,new o.Vector2(.5*C.Size.x,.5*C.Size.y)),p.check2DCandidate(l,g,b,m,this.pixelsEpsilon)}var M=a.getDressups();for(var _ in M)if(M.hasOwnProperty(_)){var V=M[_];if(e!==V&&V.IsKindOf("VCXMarkup_Spec")){var x=V.QueryInterface("VCXIVisibility");if(x&&x.GetVisibility()){var y=this._experienceBase.getManager("VCXSelectionManager");if(y&&!y.GetComponentsFromSelection("CSO").includes(V)){var f=V.QueryInterface("VCXIModifiable");if(f&&1e3===f.GetPropertyValue("Collab.3D.Paper.Positioning.Type")){var D=V.QueryInterface("VCXIManipulable").getActiveInteractors();for(var S in D)if(D.hasOwnProperty(S)){var X=D[S];if(X.manipulatorType!==s.EManipulatorType.None&&X.tag&&X.tag.Snap2D){var w=i.viewer.currentViewpoint.project(h.getOFromMatrix(X.matrix));p.check2DCandidate(l,g,w,m,this.pixelsEpsilon)}}}}}}}}}return l}}return null}_update2DLineFeedback(e,t,s,a){if(t&&!this._lineChoice(e)){let t={createIfMissing:!0,nodeType:d.ENodeType.feedback};var r=i.buildLineStripSet([0,0,0,0,0,1],[2],[0,1],null,1,null,this.getDefaultMaterial(t,"Plain",1,!1,!1));let s=this._experienceBase.getManager("VCXVisuManager");r.setNoZ(!0),r.setPickable(n.PICKTHROUGH),r.setRenderPasses([s.getRenderList("VCXPreManipulators"),s.getRenderList("VCXManipulators")]),r.setFrustumCulled&&r.setFrustumCulled(!1),r.setShadow&&r.setShadow(!1,!1),r.setMirror&&r.setMirror(!1),r.exludeFromBounding&&r.exludeFromBounding(!0);var c=new l;c.add(r),c.name="VCXSnappingLine"+e,this.createAndGetRootDecoration(t,"VCXCanonic2DLines").add(c),"vertical"===e?this._verticalLineNode=c:"horizontal"===e&&(this._horizontalLineNode=c)}if(t&&this._lineChoice(e)&&s&&s.screenCoord2&&s.screenCoord1){for(var u=null,p=null,g=null,m=null,C=null,b=0;b<s.screenCoord2.length;b++){var M=s.screenCoord2[b];(null===g||g>M.x)&&(g=M.x),(null===u||u<M.x)&&(u=M.x),(null===m||m>M.y)&&(m=M.y),(null===p||p<M.y)&&(p=M.y),(null===C||C>M.z)&&(C=M.z)}for(b=0;b<s.screenCoord1.length;b++){M=s.screenCoord1[b];"horizontal"==e?((null===g||g>M.x)&&(g=M.x),(null===u||u<M.x)&&(u=M.x)):((null===m||m>M.y)&&(m=M.y),(null===p||p<M.y)&&(p=M.y))}var _=new o.Vector3(g,m,C),V=new o.Vector3(u,p,C);"horizontal"==e?(_.x=g-30,V.x=u+30):(_.y=m-30,V.y=p+30);var x=a.viewer.currentViewpoint.unProject(_),y=a.viewer.currentViewpoint.unProject(V),f=new o.Vector3(1,0,0),D=new o.Vector3(0,1,0),S=new o.Vector3(0,0,y.distanceTo(x)),X=(new o.Matrix4).makeBasis(f,D,S),w=(new o.Vector3).subVectors(y,x),v=h.getMatrixFromOVz(x,w);this._lineChoice(e).setMatrix((new o.Matrix4).multiplyMatrices(v,X))}this._lineChoice(e)&&this._lineChoice(e).setVisibility(t)}_analyseMeasurableHolder(e,t){if(e.QueryInterface("VCXIVisibility").GetVisibility()){var i=this._experienceBase.getManager("VCXContextManager").getMainViewer();e.populateMagnets(i,this._magnets,t),this._magnetCreated=!0}}askDetection(){if(this._debugDisplay=this._experienceBase.getManager("VCXContextManager").isSupported("VCXCanonicsDebugDisplay"),this._visuDirty=!0,this._canonicsMode=this._shouldDisplayArcBar(),this._canonicsMode){if(this._arcBar){if(this._arcBar.AvailableFilter===this._canonicsMode)return;this.clear(),this._arcBar&&this._arcBar.clear(),this._arcBar=null}this._arcBar=new r({canonicsManager:this,availableFilter:this._canonicsMode}),this._magnetDirty=!0}else this._canonicsMode=u.Canonic.None,this._arcBar&&this._arcBar.clear(),this._arcBar=null}_lineChoice(e){return"vertical"===e?this._verticalLineNode:"horizontal"===e?this._horizontalLineNode:void 0}setFeedbackNode(e){if(e&&e.static&&!this._rootFeedback){let e=this._experienceBase.getManager("VCXContextManager").getMainViewer();e&&(this._rootFeedback=new l("VCXCanonicFeedback"),e.addNode(this._rootFeedback))}if(this._rootFeedback&&this._rootFeedback.removeChildren(),e&&e.static&&this._rootFeedback.add(e.static),e&&e.live&&!this._rootFeedbackLive){let e=this._experienceBase.getManager("VCXContextManager").getMainViewer();e&&(this._rootFeedbackLive=new l("VCXCanonicFeedbackLive"),e.addNode(this._rootFeedbackLive))}this._rootFeedbackLive&&this._rootFeedbackLive.removeChildren(),e&&e.live&&this._rootFeedbackLive.add(e.live)}createAndGetRootDecoration(e,t){if(e.createIfMissing&&!this._decorationNode&&(this._decorationNode=[]),e.createIfMissing&&!this._decorationNode[t]){if(!this._rootDecoration){var i=this._experienceBase.getManager("VCXContextManager").getMainViewer();i&&(this._rootDecoration=new l("VCXCanonics"),i.addNode(this._rootDecoration))}this._decorationNode[t]=new l("VCXCanonics"+t),this._rootDecoration.add(this._decorationNode[t]),this._magnetCreated=!0}return this._decorationNode&&this._decorationNode[t]}pickCanonics(e,t,i){if(!e)return;this._pickInfo=e;var n=this.detectableCanonics&this._canonicsMode&(t&&t.canonicsDetection);if(n&&(n|=u.Canonic.Object),n===u.Canonic.None)return;this._redoDetection&&n!==u.Canonic.Object&&n!==u.Canonic.None&&(this._redoDetection=!1);var s=e.viewer;if(!s||!s.currentViewpoint)return;var a=e.modifiable?e.modifiable.QueryInterface("W3AISGNodeHolder"):null,r=a?a.getPathElement():null,c=r?r.getWorldMatrix(s):new o.Matrix4;let l;if(c||(c=new o.Matrix4),e.pathElement&&e.pathElement.getLastElement(!0).magnet){let i=e.pathElement.getLastElement(!0).magnet;l=i.updateFromRay(e.ray,t),i.isActive()||"Axis"!==i.getType()||this._magnets.Axis.forEach(e=>{l.isABetterCandidate(e)&&(e.point=l.point,l=e)})}if(e.magnet=l,!l&&n&u.Canonic.Object&&e.modifiable){this._detectedObject!==e.modifiable&&this.activateOccurrenceMagnets(e.modifiable,e.pathElement);const t=e.globalNormal&&e.globalNormal.normalize();l=new d({type:u.Canonic.Object,point:e.globalPosition,normal:t,xAxis:null,id:"SimpleObject",pathElement:e.pathElement,associatedObject:e.modifiable.GetObject()})}if(this.detectedCanonic!==l&&(this.detectedCanonic=l),this._magnetDirty=!0,this._visuDirty=!0,l&&(l.pathElement&&(e.pathElement=l.pathElement),i)){if(l.point&&(e.globalPosition=l.point.clone(),e.viewer&&e.viewer.currentViewpoint)){var h=e.viewer.currentViewpoint.project(l.point);e.smartMouse.x=Math.round(h.x),e.smartMouse.y=Math.round(h.y)}l.normal&&(e.globalNormal=l.normal.clone()),l.xAxis&&(e.globalXAxis=l.xAxis)}}getVersion(){return"4.0.2"}get detectableCanonics(){return this._canonicsButtonState}set detectableCanonics(e){"record"===this._experienceBase.odt&&this._experienceBase.getManager("VCXODTManager").LogAPI("CanonicsChangeDetectable",{detectableCanonics:e}),this._magnetDirty=!0,this._canonicsButtonState=e}get detectedCanonic(){return this._detectedCanonic}set detectedCanonic(e){let t=this._detectedCanonic&&this._detectedCanonic.measurable,i=e&&e.measurable;t===i&&this._detectedCanonic===e||(this.setFeedbackNode(null),t&&t.setActive(!1,this._detectedCanonic),i&&(this._lastActiveCanonic&&(this._lastActiveCanonic.forceVisible=!1),this._lastActiveCanonic=i,this._lastActiveCanonic.forceVisible=!0,i.setActive(!0,e)));let n=this._detectedCanonic&&this._detectedCanonic.associatedObject,s=e&&e.associatedObject;n!==s&&(this.getPreHighlightSet().clearAll(),s&&this.getPreHighlightSet().add(s.QueryInterface("W3AISGNodeHolder").getPathElement(),{highlightColor:this.peHighlightColor},!0)),this._detectedCanonic=e,this._experienceBase.getManager("VCXContextManager").getMainViewer().render()}get componentType(){return"VCXCanonicsManager"}}return p});