define("DS/ENOMadeFromUX/view/MBMFFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","DS/EditPropWidget/facets/Common/FacetsBase","DS/SpecGridView/SpecGridView","DS/XSRCommonComponents/service/CommandsService","DS/ENOMadeFromUX/utils/MBMFUtils","DS/XSRCommonComponents/utils/TypeUtils","DS/ENOMadeFromUX/service/MBMFServiceProvider","DS/ENOMadeFromUX/model/MBMFItemModel","DS/XSRCommonComponents/components/XSpecDnD/DragDropUtil","DS/XSRCommonComponents/utils/XspecEvents","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/XSRSearch","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/GridCommonActionsManager","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/XSRMask","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/service/XSpecsMenuBuilder","DS/XSRCommonComponents/service/XSpecsActionsFactory","DS/XSRCommonComponents/utils/ItemServiceProvider","DS/ENOMadeFromUX/utils/PostSearchAction","DS/ENOMadeFromUX/controller/MBMFGridCol","DS/XSRCommonComponents/createform/view/TableForm","DS/XSRCommonComponents/createform/control/BOMCreateModel","text!DS/ENOMadeFromUX/assets/MBMFConfig/MBMFToolBarCommands.json","text!DS/ENOMadeFromUX/assets/MBMFConfig/MBMFColumnConfig.json","i18n!DS/ENOMadeFromUX/assets/nls/MadeFromUX","css!DS/ENOMadeFromUX/view/MBMFFacet.css"],function(e,t,n,i,o,a,s,r,d,c,l,M,m,p,u,h,g,f,b,C,F,v,B,y,D,I,N,S,_,E){"use strict";return t.extend(n,o,{init:function(t){if(this._parent(t),this.hasTabInstance=t.hasTabInstance,this._MBMFTabContainer=t._MBMFTabContainer,this.gridColumnControl=void 0,this.elements.container||(this.elements.container=e.createElement("div",{class:"xsr-mbmf"}),this.hasTabInstance&&this._MBMFTabContainer&&this.elements.container.setStyle("height","100%")),this.appCore=this.options.appContext||this.options.appCore,this.appId=t.appId,this.appCore.contextAppId=this.appId,void 0!==widget.data&&"ENXENG_AP"===widget.data.appId&&this.appCore.localStorage.setItem(C.VALUE_QUANTITY_VIEW,!0),this.itemID=t.itemId,this.itemModel=t.itemModel,this.itemTitle=this.itemModel?this.itemModel.getLabel():"",this.itemMaturity=this.itemModel?this.itemModel.getMaturity():"",this.appId!==C.XSR_APP_ID){this.modelEvents=new m,this.appCore.specViewerModelEvents=this.modelEvents,this.appCore.basicModelEvents=this.modelEvents,p.set3DSpaceURL().then(function(){p.setSecurityContext(),p.setCSRFToken(),f.prepareRawMaterialSubtypes(),f.prepareUOMTypes(),f.preparePhysicalProductSubtypes()}).catch(function(e){console.log("Error in setting 3DSpace URL")}),this.appCore.contextManager&&this.appCore.contextManager.getXENTreeDocument()&&this.appCore.contextManager.getXENTreeDocument().getSelectedNodes()&&(this.itemModel=this.appCore.contextManager.getXENTreeDocument().getSelectedNodes(),this.itemID=this.itemModel[0].getID(),this.itemTitle=this.itemModel[0].getLabel(),this.itemMaturity=this.itemModel[0].getMaturity(),this.extApp_SC=this.appCore.contextManager.getSecurityContext().SecurityContext,p.setCSRFToken(),this.firstLoad=!0);var n={};n.modelEvents=this.modelEvents,s.initialize(n),F.initialize(n),v.setOptions(n)}else this.modelEvents=this.appCore.specViewerModelEvents?this.appCore.specViewerModelEvents:this.appCore.basicModelEvents;this.basicModelEvents=this.appCore.basicModelEvents,this.currentTabKey=C.FACET_MBMF,this._MBMFSubscriptionList=[],this._subscribeEvents(),this.preferredView=void 0===widget.getValue("grid-preferred-view-"+this.currentTabKey)?C.GRID_VIEW:widget.getValue("grid-preferred-view-"+this.currentTabKey),this.MBMFService=new c(this.extApp_SC)},_renderEmptyOrManyMsg:function(e){this.mbmfContainer&&this.mbmfContainer.empty(),this.elements.container.empty();let t=p.getTouchMode(),n=UWA.createElement("div",{class:"xsr-message-container"});"Many"==e&&n.addContent(E.Message_TooManyItems),t&&n.addClassName("xsr-mobile-font"),n.inject(this.elements.container)},_renderNoSupportMsg:function(){this.mbmfContainer&&this.mbmfContainer.empty(),this.elements.container.empty();var e=new UWA.Element("div",{class:"xsr-make-from-info"});UWA.createElement("div",{class:"xsr-blocking-icon wux-ui-3ds wux-ui-3ds-3x wux-ui-3ds-block"}).inject(e),new UWA.Element("h4",{class:"make-from-info-msg",html:E.label_NotSupported}).inject(e);e.inject(this.elements.container)},updateFacet:function(){if(this.appId!==C.XSR_APP_ID){if(this.appCore.orgContextManager&&(this.appCore.contextManager=this.appCore.orgContextManager),this.appCore.contextManager&&this.appCore.contextManager.getXENTreeDocument()&&1===this.appCore.contextManager.getXENTreeDocument().getSelectedNodes().length){if(this.itemModel=this.appCore.contextManager.getXENTreeDocument().getSelectedNodes()[0],this.itemID=this.itemModel.getID(),this.itemTitle=this.itemModel.getLabel(),this.itemMaturity=this.itemModel.getMaturity(),!("function"==typeof this.itemModel.isEngineeringItem&&this.itemModel.isEngineeringItem())||d.isRawMaterial(this.itemModel.getType()))return void this._renderNoSupportMsg()}else if(this.appCore.contextManager&&this.appCore.contextManager.getXENTreeDocument()&&this.appCore.contextManager.getXENTreeDocument().getSelectedNodes().length>1)return void this._renderEmptyOrManyMsg("Many");this.setRequriedInfo()}!this.mbmfContainer||this.mbmfContainer&&this.mbmfContainer.getChildren()&&0===this.mbmfContainer.getChildren().length?this._buildView():this.drawMBMFNodes()},loadMBMFGrid:function(){var e=this,t=JSON.parse(S),n=r.getNLSLabels(t.actions),i=JSON.parse(_);e.gridColumnControl=r.getNLSLabels(i.columns),e.gridColumnControl=new D({colsObj:e.gridColumnControl,appId:e.appId});var o={itemId:e.itemID,container:e.mbmfContainer,appCore:e.appCore,currentTabKey:e.currentTabKey,enableCrossWidgetFeature:!0,isColorized:!0,parentModel:e.itemModel,dvgOpts:{}};o.dvgOpts.rowDragEnabledFlag=!1,e.MBMFGrid=new a(o),e.MBMFGrid.setColumns(e.gridColumnControl.getColumns()),e.MBMFGrid.render(),e.MBMFGrid.setToolBarActions({actions:n}),e.MBMFGrid.toolbar.disableCommands(["removeitem"]),e.MBMFGrid.getTreeDocument().onNodeModelUpdate(t=>{if(t.data.attributes){t.data.nodeModel.options.grid;t.data.attributes.hasOwnProperty("referenceName")&&(null==t.data.attributes.referenceName&&(t.data.nodeModel.options.grid.referenceName=""),e.updateReferenceList())}}),"Released"!=e.itemMaturity&&"Obsolete"!=e.itemMaturity||e.MBMFGrid.toolbar.disableCommands(["addMBMFItem","removeitem"])},updateReferenceList:function(){let e=this.MBMFGrid.getTreeDocument().getChildren().reduce((e,t)=>(null!=t.getAttributeValue("referenceName")&&""!==t.getAttributeValue("referenceName")&&e.add(t.getAttributeValue("referenceName")),e),new Set);this.gridColumnControl.setReferenceNameList([...e])},connectMaterialCheck(e,t){(t+=this.bomGridCombos.length)>1&&(e.connectCM=!1),this.parentHasCoreMat||1!=t||1!=e.coreMaterial.length?0==e.coreMaterial.length?(e.canConnectCM=!1,e.connectCM_Msg=E.childCMMsg):(e.canConnectCM=!1,e.connectCM_Msg=E.connectMultiCMMsg):e.canConnectCM=!0},_buildView:function(){var t=this;t.elements.container.empty(),t.mbmfContainer=e.createElement("div",{class:"mbmf_container"}).inject(t.elements.container),t.hasTabInstance&&t.elements.container.inject(t._MBMFTabContainer),this.appId===C.XSR_APP_ID&&this.appCore.dndManager.enableDragAndDropOnIDCard(),this.dnd=new M({modelEvents:this.modelEvents}),this.dnd.makeDroppable(t.mbmfContainer,"insertMbmfFacets"),t.appId===C.XSR_APP_ID?(t.loadMBMFGrid(),t.drawMBMFNodes()):t.appId!==C.XSR_APP_ID&&(t.firstLoad?p.set3DSpaceURL().then(function(){p.setSecurityContext(),p.setCSRFToken(),f.prepareRawMaterialSubtypes(),f.prepareUOMTypes(),f.preparePhysicalProductSubtypes(),setTimeout(function(){t.loadMBMFGrid(),t.drawMBMFNodes(),t.firstLoad=!1},1e3)}).catch(function(e){console.log("Error in setting 3DSpace URL")}):(t.loadMBMFGrid(),t.drawMBMFNodes()))},createProdGridFields(e,t,n){let i=[];return Array.isArray(e)?(e.forEach(e=>{let o=(new N).setModel(e);o.dimensionDB&&""!=o.dimensionDB||!t.has(o.id)||(o.dimension=t.get(o.id).nlsLabel,o.dimensionDB=t.get(o.id).dbName),n.has(o.id)&&(o.coreMaterial=[n.get(o.id)]),o.isMBMF=!0,i.push(o)}),i):i},getColumnDef:function(e){return{dataIndex:e.dbName,text:e.nlsLabel,typeRepresentation:"string",editableFlag:!1,forbiddenCheck:!1,allowUnsafeHTMLContent:!1,autoRowHeightFlag:!1,exportFlag:!0,visibleFlag:!0,disabled:!0}},drawMBMFNodes:function(){this.getMBMFNodes(this.itemID),this.checkAndApplyGrouping()},getCoreMatDetails:function(e){for(var t=this,n=[],i=0;i<e.length;i++)n.push(e[i].getID());if(n&&n.length>0){var o={};o.references=n,o.with_partials=!0,(new B).fetchCoreMatDetails(o,e).then(function(n){if(n){for(var i=0;i<e.length;i++)for(const[t,s]of n.entries())if(t===e[i].getID()){var o=s.physicalid,a=(s.V_Name?s.V_Name:"")+" "+(s.revision?s.revision:"-");e[i].setCoreMat(a),e[i].setCoreMatId(o),e[i].updateOptions(e[i].options)}t.MBMFGrid.getTreeDocument().acceptChanges()}}).catch(function(e){h.displayNotification({eventID:"error",msg:e?e.message:E.Error_GetMatInfo}),b.unmaskLoader(t.mbmfContainer)})}},getMBMFNodes:function(e,t){var n=this;r.getMBMFDetails(e,void 0,n.appCore,void 0,void 0,this.extApp_SC).then(function(e){if(b.maskLoader(n.mbmfContainer,E.UpdatingLoader),e&&e.length>0){var i=[],o=new Map;n.MBMFGrid.getTreeDocument().empty(),n.MBMFGrid.getTreeDocument().acceptChanges();let d=e.reduce((e,t)=>(""!==t.ReferenceName&&e.add(t.ReferenceName),e),new Set);n.gridColumnControl.setReferenceNameList([...d]);for(var a=0;a<e.length;a++){var s=new l({ignoreselectevent:!0,fromfacet:"MBMFFacet"}).set(e[a]);s.currentTabKey=n.currentTabKey,s.appCore=n.appCore,e[a].MakeFrom_extensions.forEach(e=>{e.attributes.forEach(t=>{let n=s.getAttributeObject(t,e.dbName,e.nlsLabel);s.setAttributeToMap(n),o.set(n.dbName,n)})}),s.parentNode=n.itemModel,n._addNewNode(s,"MBMF"),i.push(s)}n.getCoreMatDetails(i);let c=7;if(o.forEach(e=>{n.MBMFGrid.addColumn(n.getColumnDef(e),c),c++}),n.MBMFGrid.getTreeDocument().acceptChanges(),n.appCore.MBMFDialog&&n.appCore.MBMFDialog.closeDialog(),t&&n.appId!==C.XSR_APP_ID){var r=[];r.push(s),n.publishMBMFUpdateEvent("add",r)}}else n.MBMFGrid.displayEmptyObjectView(),n.appId!==C.XSR_APP_ID&&(n.MBMFGrid.getTreeDocument().empty(),n.MBMFGrid.getTreeDocument().acceptChanges())}).catch(function(e){h.displayNotification({eventID:"error",msg:e?e.result.message:E.Error_Get_MBMF})}).finally(()=>b.unmaskLoader(n.mbmfContainer))},_addNewNode:function(e,t){"MBMF"===t&&this.MBMFGrid.addRootNodes(e,!1),this.MBMFGrid.getTreeDocument().acceptChanges(),this.MBMFGrid.updateGroupByIfAny(),this.hasTabInstance&&this.modelEvents.publish({event:"xsr-disable-tab",data:C.BOM_TAB})},createMBMF(e,t){let n=this;if(Array.isArray(e)&&0==e.length)return;let i=[];n.dataModelMap=new Map,e.forEach(e=>{let t=e.options.grid;n.dataModelMap.set(t.id,t);let o=t.dataToSubmit();"EA"===t.uomDB&&t.quantity>0?i.push(...Array(t.quantity).fill(o)):i.push(o)}),(new c).connectMBMFItem(i,t).then(e=>{if(!e||200!==e.statusCode)return void h.displayNotification({eventID:"error",msg:"Service failed"});let i=e.result.MadeFromConnections,o=[];i.forEach(e=>{let i=n.dataModelMap.get(e.makeFromPID);i.relationID=e.connectionPID,i.parentID=t,o.push(i.getMbmfJsonForEIM(e))}),n.modelEvents.publish({event:"add_MBMF_nodes",data:{resp:o,success:!0}}),h.displayNotification({eventID:"success",msg:E.Success_ConnectMBMF})})},async preapreComboFromGrid(){let e=this.MBMFGrid.getTreeDocument(),t=e.getVisibleChildren?e.getVisibleChildren():e.getChildren(),n=[];if(t.forEach(e=>{let t=e.getMBMFReferenceName()||"";n.push(`${e.getID()}_${t}`)}),e.getVisibleChildren&&0==t.length){let e=await(new c).getReferenceMap(parentId);e.success&&Object.keys(e.result.MadeFromConnections).forEach(t=>{e.result.MadeFromConnections[t]&&e.result.MadeFromConnections[t].forEach(e=>{n.push(`${t}_${e}`)})})}return n},_subscribeEvents:function(){var e=this;this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"xsr-load-mask"},function(e){b.maskLoader(widget.body,E.WAIT)})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"xsr-unload-mask"},function(e){b.unmaskLoader(widget.body)})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"grid-toolbar-action-click-MBMFFacet"},function(t){if(t)switch(t){case"addMBMFItem":!async function(t){const n=await u._getSearchCriteria(e.appCore.immersiveFrame,(e.appCore.immersiveFrame?e.appCore.immersiveFrame.elements.container:document.body).getElementsByClassName("fonticon-part-made-from")[0]);if("addExistingMBMF"===t){var i=e.MBMFGrid.getTreeDocument().getSelectedNodes();if(i&&i.length>0&&d.isRawMaterial(i[0].getTypeActualName()))return void r.getMsgAddNodeOnRM();if(i&&i.length>0&&i[0].getMadeFrom())return void r.getMsgAddNodeOnMBMF();let t={appCore:e.appCore,container:e.mbmfContainer,bomGrid:e.MBMFGrid,isReferenceView:!1,isTileView:!1,specModel:e.itemModel,modelEvents:e.modelEvents,isMBMF:!0,appId:e.appId},o=e.itemID?[e.itemID]:[];new y(t).triggerSearch({searchOnlyRawM:!1,query:n,excludeList:o})}}("addExistingMBMF");break;case"removeitem":!function(n){var i=e.MBMFGrid.getTreeDocument().getSelectedNodes();if(i&&i.length>0)if(e.appId===C.XSR_APP_ID&&"remove"===n)t="UPSAuthUnparent",v.launchUPSUnparent({data:i});else for(var o=function(t,n,i){(new c).disconnectMBMFItem(t.getParentId(),t.getID()).then(function(o){o&&o.success?(t.parentNodeModel&&t.parentNodeModel.getMBMFChild()&&t.parentNodeModel.setMBMFChild(null),e._removeNodes(t),n===i-1&&h.displayNotification({eventID:"success",msg:E.RemoveMBMFSuccess})):h.displayNotification({eventID:"error",msg:E.RemoveMBMFFailed})}).catch(function(e){var t="";e&&!e.success&&e.result&&(t=e.result.message),h.displayNotification({eventID:"error",msg:t})})},a=0;a<i.length;a++)o(i[a],a,i.length);else h.displayNotification({eventID:"error",msg:E.NoItemSelected})}("remove");break;case"Export":e._exportGrid();break;case"personalize":e._personalize()}})),this.platFormSubscrpition=i.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(t){t.data.authored&&t.data.authored.modified&&t.data.authored.modified.forEach(function(t){var n;UWA.is(t,"object")?n=t.physicalid:UWA.is(t,"string")&&(n=t),e.syncNodeBasedOnID(n,!0),e.MBMFService.fetchItemInfo([e.itemID]).then(function(t){let n=(new l).set(t[0]).getMaturity();"Released"!=n&&"Obsolete"!=n||e.MBMFGrid.toolbar.disableCommands(["addMBMFItem","removeitem"])})})}),this.platFormXENSubscrpition=i.subscribe("XEN/PUBLIC_EVENT/ENGINEERING_ITEM/PART_NUMBER_UPDATED",function(t){if(t&&Array.isArray(t.references))for(var n=t.references,i=0;i<n.length;i++){var o=n[i].physicalid;e.syncNodeBasedOnID(o),"success"===t.status&&e._updateNodeOnBOMTab(null,"update",{attribute:"partNumber",value:t.references[0].partNumber},o)}}),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"xsr-add-item-on-drop-MakeFrom"},async function(t){if(t.length>0){let i=t.reduce((e,t)=>(e.push(t.id),e),[]),o=await e.MBMFService.fetchItemInfo(i);if("object"==typeof o&&o.length>0){let t=[],i=[];for(let n=0;n<o.length;n++)if(i.push(o[n].physicalid),o[n].id=o[n].physicalid,o[n].madeFromPID=o[n].physicalid,d.isRawMaterial(o[n]["ds6w:type_value"])){let i=(await e.MBMFService.getUOMTypes(o[n].physicalid)).result.applicableUOMTypes[0];o[n]["ds6wg:raw_material.v_dimensiontype_value"]=i.dimension.dbName,o[n]["ds6wg:raw_material.v_dimensiontype_value"]||t.push(o[n].physicalid)}let a=[];t.forEach(e=>{let t=new Promise((t,n)=>{(new RMCommonServiceProvider).getUOMTypes(e).then(function(n){let i={};i[e]=n.result.applicableUOMTypes[0].dimension,t(i)})});a.push(t)});var n=e;let s={appCore:n.appCore,createCloseAction:function(t){n.createMBMF(t,e.itemID)}};s.bomGridCombos=await e.preapreComboFromGrid(),s.container=e.elements.container,Promise.all(a).then(async function(e){let t=new Map,a=new Map;if(e.forEach(function(e){t.set(Object.keys(e)[0],Object.values(e)[0])}),0!=i.length){let e={references:i,with_partials:!0};(a=await(new B).fetchCoreMatDetails(e))||(a=new Map)}let r=n.createProdGridFields(o,t,a);if(r&&r.length>0)for(let e=0;e<r.length;e++)r[e]._parentID=n.itemModel.getID(),r[e]._parentTitle=n.itemModel.getTitle(),r[e].parentHasCoreMat=n.itemModel.hasMadeOf?n.itemModel.hasMadeOf():r[e].parentHasCoreMat,r[e].parentHasCoreMat||1!=r.length||1!=r[e]._coreMaterial.length?0==r[e]._coreMaterial.length?(r[e].canConnectCM=!1,r[e].connectCM_Msg=E.childCMMsg):(r[e].canConnectCM=!1,r[e].connectCM_Msg=E.connectMultiCMMsg):r[e].canConnectCM=!0;n.tblFrom=new I(s).loadData(r),b.unmaskLoader(n.container)})}}})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"grid-list-remove-node-successful-MBMFFacet"},function(t){e._removeNodes(t)})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:C.UPDATE_ITEMVIEW_TOOLBOOR_COUNT},function(t){0==t?(e.MBMFGrid.toolbar.disableCommands(["removeitem"]),e.MBMFGrid.toolbar.enableCommands(["addMBMFItem"])):(e.MBMFGrid.toolbar.disableCommands(["addMBMFItem"]),e.MBMFGrid.toolbar.enableCommands(["removeitem"]))})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"xsr-slide-in-facet-destroy-updated"},function(t){e.hasTabInstance||e.destroyComponent()})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"grid_action_context_menu-MBMFFacet"},function(t){var n=e.MBMFGrid.getTreeDocument().getSelectedNodes();t.gridInstance=e.MBMFGrid;var i=e.appId===C.XSR_APP_ID?["Information","OpenSpecificationView","DeleteItem"]:["Information","OpenSpecificationView","OpenWith","ManageFiles","SetPartNumber","UPSAuthUnparent","RemoveChild","VersionExplorer","DuplicateItem","CompareWith","RelatedObjects","MaturityGraph","ActionBar_ChangeOwner","MultiOwnership","DownloadReport","DownloadDocument","Subscriptions","DeleteItem","addExisting","RegenerateReport","Close"];if(e.appId===C.XSR_APP_ID||void 0!==widget.data&&"ENXENG_AP"===widget.data.appId)if(n&&n.length>1)(0,g.getMultiActionMenu)(t,i);else if(n&&(0===n.length||1===n.length)){(0,g.getActionMenu)(t,i)}})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"grid-item-toolbar-mutiactions-list-MBMFFacet"},function(t){if(t&&(t.nodeModel=e.MBMFGrid.getTreeDocument()),t.gridInstance=e.MBMFGrid,e.appId===C.XSR_APP_ID){(0,g.getToolbarActionMenu)(t,["Information","OpenSpecificationView","DeleteItem"])}})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"grid-cell-value-update-MBMFFacet"},function(t){var n=t.newValue,i=t.oldValue,o=t.nodeModel.getID();b.maskLoader(e.mbmfContainer,E.UpdatingLoader);var a=function(t,n){"success"===t?(e.MBMFGrid.getTreeDocument().acceptChanges(),e.modelEvents.publish({event:"xsr-hide-toolbar-reset-command-"+e.currentTabKey})):e.modelEvents.publish({event:"xsr-show-toolbar-reset-command-"+e.currentTabKey}),h.displayNotification({eventID:t,msg:n}),b.unmaskLoader(e.mbmfContainer)},s=function(n,i,s){e.MBMFGrid.unselectAll(),t.nodeModel.select(),e.MBMFService.updateAndSyncAttributes(o,[{attribute:n,value:i}],t.nodeModel,s).then(function(t){e.syncInstanceModels(t),e._updateNodeOnBOMTab(t,"update",{attribute:n,value:i}),a("success",E.Notify_Updated)}).catch(function(t){b.unmaskLoader(e.mbmfContainer),a("error",E.Failure_Update)})};let c={};switch(t.dataIndex){case"ds6w:description":s(C.ITEM_DESCRIPTION,n,"bus");break;case"tree":var l=C.ITEM_V_NAME;n?s(l,n,"bus"):a("error",E.replace(E.get(E.Error_EmptyTitle),{columnName:E.label_Title}));break;case"asNeeded":c.uomType=t.nodeModel.getUOMType(),c.quantity=t.nodeModel.getQuantityMBMF(),c.asRequired=n,r.getMBMFUpdateService(c,t.nodeModel).then(function(i){i&&i.success?(t.nodeModel.setasNeeded(n),e.MBMFGrid.unselectAll(),t.nodeModel.select(),t.nodeModel.sync(),t.nodeModel.acceptChanges(),e._updateNodeOnBOMTab(t.nodeModel,"update",{attribute:"asNeeded",value:n})):(h.displayNotification({eventID:"error",msg:i.result.message}),t.nodeModel.setasNeeded(!1)),b.unmaskLoader(e.mbmfContainer)}).catch(function(t){h.displayNotification({eventID:"error",msg:t.result.message}),b.unmaskLoader(e.mbmfContainer)});break;case"quantity":c.uomType=t.nodeModel.getUOMType(),t.nodeModel.getUOMUnit()?c.quantity=n+" "+t.nodeModel.getUOMUnit():c.quantity=n+"",c.asRequired=t.nodeModel.getasNeeded(),r.getMBMFUpdateService(c,t.nodeModel).then(function(o){o&&o.success?(e.syncNodePostUpdate(t,n),t.nodeModel.setQuantityMBMF(n+" "+t.nodeModel.getUOMUnit()),e._updateNodeOnBOMTab(t.nodeModel,"update",{attribute:"quantity",value:n}),e._updateNodeOnBOMTab(t.nodeModel,"update",{attribute:"quantityMBMF",value:n+" "+t.nodeModel.getUOMUnit()})):(h.displayNotification({eventID:"error",msg:o.result.message}),e.syncNodePostUpdate(t,i)),b.unmaskLoader(e.mbmfContainer)}).catch(function(t){h.displayNotification({eventID:"error",msg:t.result.message}),b.unmaskLoader(e.mbmfContainer)});break;case"uom":c.uomType=t.nodeModel.getUOMType();var M=Object.entries(d.getUOMUnits(t.nodeModel.getUOMType()));if(M){var m=new Map;M.forEach(function(e){m.set(e[1],e[0])})}n&&(c.quantity=t.nodeModel.options.grid.quantity+" "+m.get(n)),c.asRequired=t.nodeModel.getasNeeded(),r.getMBMFUpdateService(c,t.nodeModel).then(function(o){o&&o.success?(t.nodeModel.setUnitOfMeasure(n),t.nodeModel.setQuantityUOM(m.get(n)),t.nodeModel.setQuantityMBMF(t.nodeModel.options.grid.quantity+" "+m.get(n)),e.MBMFGrid.unselectAll(),t.nodeModel.select(),t.nodeModel.sync(),t.nodeModel.acceptChanges(),e._updateNodeOnBOMTab(t.nodeModel,"update",{attribute:"uom",value:n}),e._updateNodeOnBOMTab(t.nodeModel,"update",{attribute:"quantityUOM",value:m.get(n)}),e._updateNodeOnBOMTab(t.nodeModel,"update",{attribute:"quantityMBMF",value:t.nodeModel.options.grid.quantity+" "+m.get(n)})):(h.displayNotification({eventID:"error",msg:o.result.message}),e.syncNodePostUpdate(t,i)),b.unmaskLoader(e.mbmfContainer)}).catch(function(t){h.displayNotification({eventID:"error",msg:t.result.message}),b.unmaskLoader(e.mbmfContainer)});break;case"referenceName":c.referenceName=n;let o=t.nodeModel.getAttributeValue("physicalId"),p=t.nodeModel.getAttributeValue("madeFromRelationId");0==e.MBMFGrid.getTreeDocument().getChildren().filter(e=>o===e.getAttributeValue("physicalId")&&p!==e.getAttributeValue("madeFromRelationId")).filter(e=>n===e.getAttributeValue("referenceName")).length?(t.nodeModel.options.grid.quantity>0&&(c.uomType=t.nodeModel.getUOMType(),c.quantity=t.nodeModel.getQuantityMBMF()),c.asRequired=t.nodeModel.getasNeeded(),r.getMBMFUpdateService(c,t.nodeModel).then(t=>{t&&t.success&&e.MBMFGrid.getTreeDocument().acceptChanges()}).catch(e=>{}).finally(()=>{b.unmaskLoader(e.mbmfContainer)})):(e.MBMFGrid.getTreeDocument().cancelChanges(),h.displayNotification({eventID:"error",msg:E.ERROR_UNIQUE_REFERENCE_NAME}),b.unmaskLoader(e.mbmfContainer));break;default:b.unmaskLoader(e.mbmfContainer)}})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"bom-to-MBMFFacet-commute-add-node-success"},function(t){if(t&&e.appId===C.XSR_APP_ID&&t.mbmfInfo){var n=(new l).set(t.mbmfInfo[0]);n.currentTabKey=e.currentTabKey,n.appCore=e.appCore,e._addNewNode(n,"MBMF"),e.MBMFGrid.getTreeDocument().acceptChanges(),e._removeNodes(nodeArray)}})),this._MBMFSubscriptionList.push(this.modelEvents.subscribe({event:"add_MBMF_nodes"},t=>{e.getMBMFNodes(e.itemID,!0),e.checkAndApplyGrouping()}))},syncNodePostUpdate:function(e,t){e.nodeModel.setInstanceCount(t),this.MBMFGrid.unselectAll(),e.nodeModel.select(),e.nodeModel.sync(),e.nodeModel.acceptChanges()},syncNodeBasedOnID:function(e,t){var n=this;n.MBMFGrid.getTreeDocument().getSelectedNodes().forEach(function(i){i.getID()===e&&n.MBMFService.fetchItemInfo([e]).then(function(o){o&&Array.isArray(o)?i.set(o[0]):i.set(o),n.syncInstanceModels(i),t&&n._updateNodeOnBOMTab(i,"invokeSyncNodeBasedOnID",null,e)}).catch(function(e){console.log(e)})})},syncInstanceModels:function(e){let t=this.MBMFGrid.getGridNodes();t&&UWA.is(t,"array")&&t.forEach(function(t){t.getID()===e.getID()&&t.getMBMFReferenceName()!=e.getMBMFReferenceName()&&t.syncInstances(e)}),this.MBMFGrid.getTreeDocument().acceptChanges()},_removeNodes:function(e){this.MBMFGrid.removeRootNodes(e),0==this.MBMFGrid.gridTreeDocument.model.getChildren().length&&(this.MBMFGrid.toolbar.enableCommands(["addMBMFItem"]),this.hasTabInstance&&this.modelEvents.publish({event:"xsr-enable-tab",data:C.BOM_TAB})),this._updateNodeOnBOMTab(e,"remove"),this.updateReferenceList()},_updateNodeOnBOMTab:function(e,t,n,i){var o=!0,a="";this.itemModel&&"function"==typeof this.itemModel.getKindOf&&((a=this.itemModel.getKindOf())&&a.includes(C.TYPE_3DPART)&&(o=!1));if(o&&!this.hasTabInstance&&this.appId===C.XSR_APP_ID)if("invokeSyncNodeBasedOnID"===t)this.modelEvents.publish({event:"MBMFFacet-update-node-successful",data:{nodeToBeUpdated:e,mode:t,nodeID:i}});else{if((r=this.itemModel?this.itemModel.getChildren():void 0)&&r.length>0)for(var s=0;s<r.length;s++){(e?e.getID():i)===r[s].getID()&&!0&&this.appId===C.XSR_APP_ID&&this.modelEvents.publish({event:"MBMFFacet-update-node-successful",data:{nodeToBeUpdated:r,mode:t,updateAttr:n}})}else if(this.appCore.MBMFAtRootLevel&&this.appCore.MBMFAtRootLevel.NodeAtRootLevel){var r=[];if(!this.appCore.MBMFAtRootLevel.MBMFModel&&this.appCore.MBMFAtRootLevel.NodesToBeUpdated&&this.appCore.MBMFAtRootLevel.NodesToBeUpdated.length>0){var d=this.appCore.MBMFAtRootLevel.NodesToBeUpdated;for(s=0;s<d.length;s++)e&&d[s].getID()===e.getID()&&r.push(d[s])}else this.appCore.MBMFAtRootLevel.MBMFModel&&(r=[this.appCore.MBMFAtRootLevel.MBMFModel]);this.modelEvents.publish({event:"MBMFFacet-update-node-successful",data:{nodeToBeUpdated:r,mode:t,updateAttr:n}})}}else if(this.appId!=C.XSR_APP_ID&&e){var c=[];c.push(e),this.publishMBMFUpdateEvent(t,c)}},createNodeFromId:function(e){this.MBMFGrid.getTreeDocument().getSelectedNodes();if(e)return this.getMBMFNodes(e,!0)},publishMBMFUpdateEvent:function(e,t){var n=[];if(Array.isArray(t))for(var o=0;o<t.length;o++){var a={};a.actionMode=e,a.details=t[o]._options.grid,n.push(a)}i.publish("XSR/PUBLIC_EVENT/MAKE_FROM_UPDATE",n)},_exportGrid:function(){var e=this.itemTitle+"_"+this.itemMaturity+"_"+E.label_MakeFrom_Export;this.MBMFGrid.exportGrid(e)},_personalize:function(){this.MBMFGrid.personalize()},checkAndApplyGrouping:function(){let e=this,t=e.MBMFGrid.getGroupByColumns();t?e.MBMFGrid.checkAndUpdatePersistency(t):e.MBMFGrid.setGroupByColumns(void 0)},setRequriedInfo:async function(){let e=this;e.itemModel.referenceData=await r.getReferenceList(e.itemID),e.itemModel.getReferenceNameList=function(){return e.itemModel.referenceData};let t={references:[e.itemID],with_partials:!0},n=!1,i=await(new B).fetchCoreMatDetails(t);i&&i.references&&i.references_infos&&(n=!0),e.itemModel.hasMadeOf=function(){return n}},destroyComponent:function(){this.elements.container.destroy(),this.MBMFGrid.destroy(),this.appId===C.XSR_APP_ID&&this.appCore.dndManager.enableDragAndDropOnSpecViewer(),this._MBMFSubscriptionList&&this.modelEvents.unsubscribeList(this._MBMFSubscriptionList),this.platFormSubscrpition&&i.unsubscribe(this.platFormSubscrpition),this.platFormXENSubscrpition&&i.unsubscribe(this.platFormXENSubscrpition)}})});