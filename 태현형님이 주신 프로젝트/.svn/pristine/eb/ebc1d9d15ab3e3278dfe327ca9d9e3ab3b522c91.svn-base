define("DS/ENOMadeFromUX/utils/MBMFUtils",["UWA/Core","UWA/Class","DS/ENOMadeFromUX/service/MBMFServiceProvider","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/XSRMask","DS/XSRCommonComponents/service/SpecSearchService","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/utils/ItemServiceProvider","i18n!DS/ENOMadeFromUX/assets/nls/MadeFromUX"],function(e,t,n,o,r,s,M,i,a,d){return t.singleton({getMsgAddNodeOnMBMFParent:function(e){o.displayNotification({eventID:"error",msg:d.Error_AddNodeOn_MBMFParent})},getMsgAddNodeOnRM:function(e){o.displayNotification({eventID:"error",msg:d.Error_AddNodeOn_RM})},getMsgAddNodeOnMBMF:function(e){o.displayNotification({eventID:"error",msg:d.Error_AddNodeOn_MBMF})},getMBMFUpdateService:function(e,t){var r=t.getParentId(),s=t.getID();return e.madeFromPID=s,t.options.grid.madeFromRelationId&&(e.connectionId=t.options.grid.madeFromRelationId),new Promise(function(t,M){(new n).updateMBMFInfo(e,r,s).then(function(e){return e&&e.success&&o.displayNotification({eventID:"success",msg:e?e.result.message:d.Success_UpdateMBMF}),t(e)}).catch(function(e){return t(e)})})},getMBMFDetails:function(e,t,r,s,i,a){var c=this;return c.MBMFService=new n(a),new Promise(function(n,r){c.MBMFService.getMBMFInfo(e).then(function(o){if(o&&o.success&&200===o.statusCode){if(!(o.result.MadeFromConnections&&o.result.MadeFromConnections.length>0))return n(null);for(var r=[],s=new Map,i=0;i<o.result.MadeFromConnections.length;i++){var a=o.result.MadeFromConnections[i];r.push(a.madeFromProductID),s.set(a.madeFromRelationId,a)}var d=M.removeDuplicatesFromArr(r);n(c.postMBMFInfo(d,s,t,e))}}).catch(function(e){var t;t=e&&e.result?e.result.message:d.Error_Get_MBMF,o.displayNotification({eventID:"error",msg:t})})})},postMBMFInfo:function(e,t,n,r){let s=this;return new Promise((a,c)=>{s.MBMFService.fetchItemInfo(e,!0).then(function(e){if(e&&e.length>0){let c=[];for(var o=0;o<e.length;o++){var s=e[o];for(let e of t.values())if(e.madeFromProductID===s.resourceid){MBMFInfo=Object.assign(e,s);var d=MBMFInfo.madeFromProductType.dbName;MBMFInfo.asRequired?MBMFInfo.asNeeded=MBMFInfo.asRequired:i.isRawMaterial(d)&&(MBMFInfo.asNeeded=!1),MBMFInfo.madeFrom=!0,n&&(MBMFInfo.UOMUnitsDBNLSMap=n),MBMFInfo["ds6w:created"]=M.getformatedDate(MBMFInfo["ds6w:created"]),MBMFInfo["ds6w:modified"]=M.getformatedDate(MBMFInfo["ds6w:modified"]),MBMFInfo["ds6w:responsible"]=MBMFInfo["ds6w:responsible"],MBMFInfo.quantity=MBMFInfo.quantity,MBMFInfo.quantityMBMF=MBMFInfo.quantityUOM?MBMFInfo.quantity+" "+MBMFInfo.quantityUOM.dbName:"",MBMFInfo["ds6w:cadMaster"]=MBMFInfo["ds6w:cadMaster"],MBMFInfo["ds6w:status"]=MBMFInfo["ds6w:status"],MBMFInfo.parentid=r,c.push(MBMFInfo)}}return a(c)}}).catch(function(e){o.displayNotification({eventID:"error",msg:e?e.result.message:d.Error_Get_MBMF})})})},getNLSLabels:function(e){var t=e;if(t)for(var n=0;n<t.length;n++)t[n].text=t[n].text&&d[t[n].text]?d[t[n].text]:t[n].text;return t},async getReferenceList(e){let t=await(new n).getReferenceMap(e),o=new Set;return t.success&&Object.keys(t.result.MadeFromConnections).forEach(e=>{t.result.MadeFromConnections[e]&&t.result.MadeFromConnections[e].forEach(e=>{o.add(e)})}),Array.from(o)}})});