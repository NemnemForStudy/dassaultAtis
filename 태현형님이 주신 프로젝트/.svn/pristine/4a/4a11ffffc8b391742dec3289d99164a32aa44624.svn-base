/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationCommands/CAT3DAnnotationOpenFavoriteCtxCmd",["DS/StateCommandEngine/StateCommand","DS/Visualization/PathElement","DS/StateCommandEngine/PathElementAgent","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/PADUtils/PADContext","DS/CAT3DAnnotationFavoriteCtx/CAT3DAnnotationFavoriteCtxManager","DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils"],function(e,t,n,i,r,o,a,l){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0}),this.setRepeatMode(!1);var s,c,u,g=function(e){if(!e||!e.externalPath||!e.externalPath.length||"RootBag"!==e.externalPath[0].name)return!1;for(var n=e.externalPath.length-1;n>=0;--n){var i=e.externalPath[n];if(l.isPLMNode(i))return!!l.is3DLeaf(i)&&new t(e.externalPath.slice(0,n+1))}},d=function(e){setTimeout(function(){if(s&&s.object3D&&1===s.object3D.length){r.empty();var t=a.giveFavoriteContextManager({context:o.get()});u=t.manageFavoriteContext({path:g(s.object3D[0].pathElement),onComplete:function(){u=null,e()}}).cancel}},0)};this.buildGraph=function(){var e=o.get();e.getViewer().setDefaultPicking(!1),c=!0,u=null,s=new n({agentId:"CATFavoriteContextSelAgt",frameWindow:e.getFrameWindow(),engWithPSOHSO:!0,withPSO:!0,withHSO:!0,valuedFromCSO:!0,saveToCSO:!1,pickingMode:"rep",prePickingMode:"rep",pickingFilter:g,prePickingFilter:g});var t=this.createInitialState("InitState"),i=this.getFinalState();this.addTransition({iInitialState:t,iFinalState:i,iEvent:s,iAction:d}),this.addTransition({iInitialState:t,iFinalState:i,iCondition:function(){var t=l.getRoots(e);if(t&&1===t.length&&t[0]&&l.is3DLeaf(t[0])){var n=e.getRootBagPath();return n.addElement(t[0]),s.object3D.push({pathElement:n}),!0}},iAction:d})},this.execute=function(){c&&(i.empty(),r.empty())},this.endExecute=function(){o.get().getViewer().setDefaultPicking(!0),u&&u()}}})}),define("DS/CAT3DAnnotationCommands/CAT3DAnnotationWidgetDefaultCmd",["DS/ApplicationFrame/Command","DS/CATRelatedDataLauncher/CATRelatedDataController","DS/CAT3DAnnotationController/CAT3DAnnotationController","DS/CAT3DAnnotationUtils/CAT3DAnnotationStorageController","DS/PADUtils/PADContext","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils"],function(e,t,n,i,r,o,a,l){"use strict";return e.extend({init:function(e){var s=e||{};this._parent(s,{mode:"exclusive",isAsynchronous:!0}),this.setRepeatMode(!1);var c=r.get(),u=this,g=t.giveDataLauncherController({context:c}),d=a.getSelectionManager({context:c});d.setActiveState(!0);var f,A=o.getPreferenceManager({context:c.getFrameWindow()});let p=null,h={},b=!1,C="Perspective",S=!1,v="selectParentReference",D={activated:c.getViewer().picking.activated,trapSelection:c.getViewer().picking.trapSelection,trapGPU:c.getViewer().picking.trapGPU},m={activated:c.getViewer().pPicking.activated};A.setUnitsPreferencesDisplayFlag(!0),A.setDisplayPreferencesDisplayFlag(!0),A.set3DSelectionPreferencesDisplayFlag(!0),i.initPrefManager({context:c.getFrameWindow()}).then(()=>{c&&(A&&(p=A.subscribe("com.ds.mep:onPrefUpdate",function(e){let t=JSON.parse(e[1].preferences);for(let e=0;e<t.repositories.length;e++)for(let n=0;n<t.repositories[e].preferences.length;n++)"SelectParentReferenceOr3DShape"===t.repositories[e].preferences[n].name?(h.selectParentReferenceOr3DShape=t.repositories[e].preferences[n].value,v=h.selectParentReferenceOr3DShape):"Select3DGeometry"===t.repositories[e].preferences[n].name?(h.select3DGeometry="true"===t.repositories[e].preferences[n].value,S=h.select3DGeometry):"ProjectionType"===t.repositories[e].preferences[n].name?(h.projectionType=t.repositories[e].preferences[n].value,C=h.projectionType):"Gravity"===t.repositories[e].preferences[n].name&&(h.gravity="true"===t.repositories[e].preferences[n].value,b=h.gravity);if(c&&c.getViewer()&&c.getViewer().currentViewpoint&&c.getViewer().currentViewpoint.control){let e=h.gravity?h.gravity:b;c.getViewer().currentViewpoint.getControl().setRotationRolling(!e),c.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!e)}if(c&&c.getViewer()&&c.getViewer().currentViewpoint&&c.getViewer().currentViewpoint.setProjectionType("Perspective"===(h.projectionType?h.projectionType:C)?0:1),d){let e=h.select3DGeometry?h.select3DGeometry:S;d.setPicking(e?0:1)}if(d){let e=h.selectParentReferenceOr3DShape?h.selectParentReferenceOr3DShape:v;d.selectParentReference("select3DShape"!==e)}})),l.readPreferences([{Repository:"VisualizationRepository",PreferenceNames:["Gravity"]},{Repository:"FrameGeneral",PreferenceNames:["ProjectionType"]},{Repository:"SelectionRepository",PreferenceNames:["Select3DGeometry","SelectParentReferenceOr3DShape"]}]).then(e=>{if(!c)return;let t=e.repositories;for(let e=0;e<t.length;e++)if("VisualizationRepository"===t[e].name)b="true"===t[e].preferences[0].value;else if("FrameGeneral"===t[e].name)C=t[e].preferences[0].value;else if("SelectionRepository"===t[e].name){let n=t[e].preferences;for(let e=0;e<n.length;e++)"Select3DGeometry"===n[e].name?S="true"===n[e].value:"SelectParentReferenceOr3DShape"===n[e].name&&(v=n[e].value)}"boolean"==typeof b&&(c.getViewer().currentViewpoint.getControl().setRotationRolling(!b),c.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!b)),"Perspective"!==C&&"Parallel"!==C||c.getViewer().currentViewpoint.setProjectionType("Perspective"===C?0:1),d&&d.setPicking(S?0:1),d&&d.selectParentReference("select3DShape"!==v)}).catch(e=>{"boolean"==typeof b&&(c.getViewer().currentViewpoint.getControl().setRotationRolling(!b),c.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!b)),"Perspective"!==C&&"Parallel"!==C||c.getViewer().currentViewpoint.setProjectionType("Perspective"===C?0:1),d&&d.setPicking(S?0:1),d&&d.selectParentReference("select3DShape"!==v),window.console.warn("Could not get server value, default value set instead.",e)}),require([s.annotControllerLib||"DS/CAT3DAnnotationExpController/CAT3DAnnotExpControllerInstance"],function(e){var t=new e({ctxViewer:c});if(t.setActiveState(!0),n.registerAnnotationController({annotController:t,context:c}),A){var r=i.getPreferenceDefinitions({attributePrefs:void 0!==s.annotControllerLib});f=r[0].id,A.addPreferences(r),A.setPreferredPreferenceContainersOrder([f,"MeasurePreferences"])}}),c.getViewer().setPicking({activated:!0,trapSelection:!0,trapGPU:!0}),c.getViewer().setPrePicking({activated:!0}))}),this.beginExecute=function(){g&&g.setActiveState(!0)},this.endExecute=function(){g&&g.setActiveState(!1)},this.pauseExecute=function(){g&&g.setActiveState(!1)},this.resumeExecute=function(){g&&g.setActiveState(!0)};var P=this._destroy;this._destroy=function(){P.call(u),n.unreferenceAnnotationController({context:c}),A&&(A.removePreferences([f]),p&&(A.unsubscribe(p),p=null)),a.unreferenceSelectionManager({context:c}),c.getViewer().setPicking(D),c.getViewer().setPrePicking(m),f=A=null,i.cleanPrefManager(),o.unreferencePreferenceManager({context:c.getFrameWindow()}),u=c=g=null}}})}),define("DS/CAT3DAnnotationCommands/controllers/CAT3DAnnotationFilterController",["UWA/Class","DS/CoreEvents/ModelEvents","DS/CAT3DAnnotationPanels/CAT3DAnnotationFilterPanel","DS/CATWebUXComponents/CATWebUXPanel","DS/ApplicationFrame/CommandsManager","DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils","DS/CAT3DAnnotationController/CAT3DAnnotationController","DS/CAT3DAnnotationUtils/CAT3DAnnotationUtilsOptions","DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader","DS/CAT3DAnnotationUtils/CAT3DAnnotationStorageController"],function(e,t,n,i,r,o,a,l,s,c){"use strict";var u=e.extend({init:function(e){var u=e||{};this._parent(u);var g,d,f,A,p,h,b=l.getOption("CAT3DANN_FILTER_PANEL_VER1")?1:2,C=!1,S=!1,v=this,D=u.ctxViewer,m=200,P=!1,F=[],T=[],y=[],w={},V={},x={},R={},k=0,L=new t,E=!0,M=!1,O=0,W=0,U=150,I=0,_=!0,j=!1,B=!1,N=!1,G=function(e,t){return L.publish({event:e,data:t,context:this})},X=function(e){!j&&_&&C&&!B&&!N&&g.getActiveState()&&(e&&(M=e),O&&(clearTimeout(O),O=0),O=setTimeout(function(){v._internalRefresh(),U=150,O=0},U))},z=c.subscribe("onPreferenceModified",function(e){var t;if(-1!==e.preference.indexOf("CATWebUXMePreferences_SemanticAttribute_")){var n,i=e.preference.substring(e.preference.indexOf("e_")+2,e.preference.length),r=v.getAttributeTypesFiltered();for(t=0;t<T.length;t++)if(T[t].name===i){T[t].filteredByPref=!e.value,n=!0;break}n||T.push({name:i,filteredByPref:!e.value,filtered:!1});var o=v.getAttributeTypesFiltered();X();var a=o.length!==r.length;if(!a)for(t=0;t<o.length;t++)if(-1===r.indexOf(o[t])){a=!0;break}a&&G("onAttributesVisibilityModified",{attributesFiltered:o})}}),H=function(){for(var e=c.getPreference("3DAnnotAttributesOrderedList"),t=e.length-1;t>=0;t--)c.getPreference("CATWebUXMePreferences_SemanticAttribute_"+e[t])&&e.splice(t,1);return e},q=function(e){if(F&&F.length&&F[e[0]]){var t=F[e[0]];if(1===e.length)return t.path;if(t.children&&t.children[e[1]]){var n=t.children[e[1]];if(2===e.length)return n.path;if(n.path){var i=n.path.getChildrenPathes();if(i&&i.length&&i[e[2]]){var r=i[e[2]];if(3===e.length)return r;var o=i[e[2]].getChildrenPathes();if(o&&o.length&&o[e[3]])return o[e[3]]}}}}},J=function(e){C&&(W+=!0===e?1:-1,I&&(clearTimeout(I),I=0),A&&(A.setEnableFlag(W>=0),W<0&&(I=setTimeout(function(){C&&A&&A.setEnableFlag(!0),W=0},2e4))))},K=function(e){O&&(clearTimeout(O),O=0),A&&(m=A.getWidth(),A.clean(),A=null),f&&f.cleanPanel(e)},Q=function(){if(sessionStorage)if("true"===sessionStorage.getItem("CAT3DAnnotFilterExpFlag_"+widget.id))sessionStorage.setItem("CAT3DAnnotFilterExpFlag_"+widget.id,"false"),A.setWidth(200);else{var e=parseFloat(sessionStorage.getItem("CAT3DAnnotFilterWidth_"+widget.id));e&&200!==e&&(sessionStorage.setItem("CAT3DAnnotFilterExpFlag_"+widget.id,"true"),A.setWidth(e))}},Y=function(e){var t=q(e[0].idPath);y.push(o.getNodeID(t.getLastElement(!0))),d.loadFTAModel({path:t,loadChildren:!0}),A&&A.isSmallWidth()&&f&&"AnnotSetAll"===f.getCurrentAnnotationSetSection()&&A.collapsePanel()},Z=function(e){j=!0;for(var t=0;t<e.length;t++){var n=q(e[t].idPath);n&&n.getLastElement(!0).setVisibility(e[t].visuFlag)}A&&A.isSmallWidth()&&f&&"AnnotSetAll"===f.getCurrentAnnotationSetSection()&&A.collapsePanel(),D.getViewer().render(),j=!1},$=function(e){var t,n=!1,i=v.getAttributeTypesFiltered();for(t=0;t<e.length;t++){for(var r=null,o=0;o<T.length;o++)if(T[o].name===e[t].name){r=o;break}null!==r?T[r].filtered=!e[t].visuFlag:T.push({name:e[t].name,filtered:!e[t].visuFlag,filteredByPref:!1})}var a=v.getAttributeTypesFiltered();if(!(n=a.length!==i.length))for(t=0;t<a.length;t++)if(-1===i.indexOf(a[t])){n=!0;break}n&&G("onAttributesVisibilityModified",{attributesFiltered:a})};function ee(){if(f){var e=!1;D.getRootBagPath().getChildrenPathes().some(function(t){return D.getController().isLargeDataStructure(o.getNodeID(t.getLastElement(!0)))&&(e=!0),e}),f.setOptionsAvailableFlag({AnnotSetAll:!e})}}for(var te=function(e){if(f){if(e)for(var t=0;t<F.length;t++)for(var n=0;n<F[t].children.length;n++){var i=F[t].children[n].path.getLastElement(!0).toJSON();Object.assign(F[t].children[n],i)}f.updatePanel({model:F,attrTypesFilteredByPref:H(),attrTypesOrderedList:c.getPreference("3DAnnotAttributesOrderedList")})}},ne=H(),ie=0;ie<ne.length;ie++)T.push({name:ne[ie],filteredByPref:!0,filtered:!1});this._internalRefresh=function(){C&&v&&"function"==typeof p&&(M?(F.splice(0,F.length),A||function(){if(K(),f||(f=new n({style:{version:b,semanticUI:"3DAnnotationInsight"===g.getAnnotationControllerType()}}),(R={}).onFilterPanelResized=f.subscribe("onFilterPanelResized",Q),R.onAnnotationSetsLoadingRequired=f.subscribe("onAnnotationSetsLoadingRequired",Y),R.onAnnotationsVisibilityModified=f.subscribe("onAnnotationsVisibilityModified",Z),R.onAttributesVisibilityModified=f.subscribe("onAttributesVisibilityModified",$)),A)f.buildPanel(F);else{var e;"true"===sessionStorage.getItem("CAT3DAnnotFilterExpFlag_"+widget.id)&&(e=parseFloat(sessionStorage.getItem("CAT3DAnnotFilterWidth_"+widget.id))),e||(e=void 0!==m?m:200),m=e;var t={id:"CAT3DAnnotFilterPanel",className:"CAT3DAnnotFilterSidePanel",showTitleFlag:!1,icon:"fonticon fonticon-annotationFilter CAT3DAnnotFilterIcon",frameWindow:D.getFrameWindow(),immersiveFrame:D.getFrameWindow().getImmersiveFrame(),closeButtonFlag:!1,viewerFrame:D.getFrameWindow().getViewerFrame(),content:f.buildPanel({model:F,attrTypesFilteredByPref:H(),attrTypesOrderedList:c.getPreference("3DAnnotAttributesOrderedList")}),minHeight:330,minWidth:200,width:e,allowedDockAreas:WUXDockAreaEnum.RightDockArea|WUXDockAreaEnum.LeftDockArea,currentDockArea:WUXDockAreaEnum.RightDockArea,onPanelResizedCB:function(e){e.currentDockArea!==WUXDockAreaEnum.RightDockArea&&e.currentDockArea!==WUXDockAreaEnum.LeftDockArea||(m=e.width,e.widthModifiedInteractively&&(sessionStorage.setItem("CAT3DAnnotFilterExpFlag_"+widget.id,"true"),sessionStorage.setItem("CAT3DAnnotFilterWidth_"+widget.id,e.width)))}};A=new i(t)}ee(),A&&F&&A.setPanelVisibilityFlag(E&&0!==F.length),A.setEnableFlag(W>=0)}(),p(function(e){if(C){for(var t,n=(F=e).length-1;n>=0;n--)t=o.getNodeID(F[n].path.getLastElement(!0)),F[n].hasBeenEntirelyLoaded=-1!==y.indexOf(t),F[n].hasBeenEntirelyLoaded&&0===F[n].children.length&&F.splice(n,1);te(!1),A.setPanelVisibilityFlag(E&&0!==F.length),F.length&&A.setEnableFlag(W>=0)}})):(te(!0),A&&F&&A.setPanelVisibilityFlag(E&&0!==F.length)))},this.setActiveState=function(e){if(C=e,g&&d){var t;if(p||(p=g.onAdditionalInfosRequired({controller:"AnnotFilter"}).getJSONModel),W=0,C){if(!P){var n=function(){_=!0,X(!0)};B=!(g.getActiveState()&&d.getActiveState());var i=function(){g.getActiveState()&&d.getActiveState()?(B=!1,X(!0)):(K(),B=!0)};w.onLoadingComplete=D.subscribe({event:"onLoadingComplete"},n),w.onLoadingFailure=D.subscribe({event:"onLoadingFailure"},n),w.onLoadingCanceled=D.subscribe({event:"onLoadingCanceled"},n),w.onRootAdded=D.subscribe({event:"onRootAdded"},ee),w.onRootRemoved=D.subscribe({event:"onRootRemoved"},function(){_=!0,U=0,X(!0)}),V.onAnnotControllerActiveStateChanged=g.subscribe("onAnnotControllerActiveStateChanged",i),V.onAnnotationsLinkedDataSolved=g.subscribe("onAnnotationsLinkedDataSolved",function(e){!0===e.succeeded&&X()}),x.onAnnotModelLoaderActiveStateChanged=d.subscribe("onAnnotModelLoaderActiveStateChanged",i),x.onAnnotationVisibilityModifiedToken=d.subscribe("onAnnotationVisibilityModified",function(e){X("tpsAnnotationSet"===e.node.getAnnotationClassType())}),x.onAnnotationSetLoadingFailedToken=d.subscribe("onAnnotationSetLoadingFailed",function(){_=!0,J(!0),X(!0)}),x.onAnnotationSetLoadedToken=d.subscribe("onAnnotationSetLoaded",function(){_=!0,J(!0),X(!0)}),x.onAnnotationSetPartiallyLoaded=d.subscribe("onAnnotationSetPartiallyLoaded",function(){_=!0,J(!0),X(!0)}),x.onAnnotationSetRemovedToken=d.subscribe("onAnnotationSetRemoved",function(){_=!0,X(!0)}),x.onAnnotationSetBeginLoadToken=d.subscribe("onAnnotationSetBeginLoad",function(){_=!1,J(!1)}),x.onAnnotationSetLoadingCanceledToken=d.subscribe("onAnnotationSetLoadingCanceled",function(){_=!0,J(!0),X(!0)}),x.onNoAnnotationSetLoadedToken=d.subscribe("onNoAnnotationSetLoaded",function(e){e&&e.loadingAlreadyStarted&&(_=!0,J(!0)),X(!0)}),V.onViewOrCaptureDisplayedToken=g.subscribe("onViewOrCaptureDisplayed",function(){_=!0,X()}),x.onVisuModificationToken=d.subscribe("onAnnotationParentVisibilityModified",function(){X(!0)}),k=D.getViewer().onSwapVisibleSpace?D.getViewer().onSwapVisibleSpace(function(){N=0===D.getViewer().getVisibleSpace(),1===D.getViewer().getVisibleSpace()?X(!0):K()}):null,N=0===D.getViewer().getVisibleSpace(),ne=H();var r=!1;for(t=0;t<ne.length;t++){for(var o=!1,l=0;l<T.length;l++)if(T[l].name===ne[t]){o=!0,T[l].filteredByPref=!0;break}o||T.push({name:ne[t],filteredByPref:!0,filtered:!1})}for(var c=0;c<T.length;c++)T[c].filtered&&(T[c].filtered=!1,r=!0);r&&G("onAttributesVisibilityModified",{attributesFiltered:v.getAttributeTypesFiltered()}),P=!0}var u=_;_=!0,X(!0),_=u}else{var b;if(f){for(b=Object.keys(R),t=0;t<b.length;t++)f.unsubscribe(R[b[t]]);f.cleanPanel(),f=null}if(R={},A&&(A.clean(),A=null),P){for(b=Object.keys(w),t=0;t<b.length;t++)D.unsubscribe(w[b[t]]);for(b=Object.keys(V),t=0;t<b.length;t++)g.unsubscribe(V[b[t]]);for(b=Object.keys(x),t=0;t<b.length;t++)d.unsubscribe(x[b[t]]);k&&D.getViewer()&&D.getViewer().unsubscribe(k),k=0,w={},V={},x={},K(!0),P=!1}O&&(clearTimeout(O),O=0),I&&(clearTimeout(I),I=0),F.splice(0,F.length),_=!0}G("onAnnotationFilterActiveStateModified",{state:C})}else h||(h=setInterval(function(){d=s.giveAnnotationModelLoader({context:D}),(g=a.giveAnnotationController({context:D}))&&d&&(clearInterval(h),h=null,v.setActiveState(C))},100))},this.getActiveState=function(){return C},this.setControllerEnableFlag=function(e){var t=r.getCommandCheckHeader("CAT3DAnnotationFilterHdr",D.getCommandContext());t&&(e?t.enable():t.disable()),S?(v.setActiveState(!0),S=!1):e||C&&(v.setActiveState(!1),S=!0,p=g=d=null)},this.setPanelVisibilityFlag=function(e){E=e,A&&F&&A.setPanelVisibilityFlag(E&&0!==F.length)},this.getPanelVisibilityFlag=function(){return E},this.clearController=function(){v.setActiveState(!1),h&&clearInterval(h),z&&c.unsubscribe(z),z=0,g=d=F=y=null,h=null,p=null,L=D=v=T=null},this.getAttributeTypesFiltered=function(){for(var e=[],t=0;t<T.length;t++)(T[t].filteredByPref||T[t].filtered)&&e.push(T[t].name);return e},this.subscribe=function(e,t){if(e&&t)return L.subscribe({event:e},t)},this.unsubscribe=function(e){L&&e&&L.unsubscribe(e)}}}),g=[];return e.singleton({init:function(){},give3DAnnotFilterController:function(e){if(e&&e.context)for(var t=0;t<g.length;t++)if(g[t].context===e.context)return g[t].filterController},get3DAnnotFilterController:function(e){var t;if(e&&e.context&&!(t=this.give3DAnnotFilterController(e))){var n=new u({ctxViewer:e.context});t=Object.freeze({setActiveState:function(e){n&&n.setActiveState(e)},getActiveState:function(){return n?n.getActiveState():null},clearController:function(){n&&(n.clearController(),n=null)},getAttributeTypesFiltered:function(){return n?n.getAttributeTypesFiltered():null},setControllerEnableFlag:function(e){if(n)return n.setControllerEnableFlag(e)},setPanelVisibilityFlag:function(e){n&&n.setPanelVisibilityFlag(e)},getPanelVisibilityFlag:function(){return n?n.getPanelVisibilityFlag():null},subscribe:function(e,t){return n?n.subscribe(e,t):null},unsubscribe:function(e){n&&n.unsubscribe(e)}}),g.push({context:e.context,filterController:t})}return t},unreference3DAnnotFilterController:function(e){if(e&&e.context)for(var t=0;t<g.length;t++)if(g[t].context===e.context){g[t].filterController.clearController(),g.splice(t,1);break}}})}),define("DS/CAT3DAnnotationCommands/CAT3DAnnotationCommands",[],function(){}),define("DS/CAT3DAnnotationCommands/CAT3DAnnotationFilterCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext","DS/CAT3DAnnotationCommands/controllers/CAT3DAnnotationFilterController"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{});var i=this,r=t.get(),o=n.get3DAnnotFilterController({context:r}),a=this.onStateChange(function(){o.setActiveState(i.getState()),localStorage.setItem("CAT3DAnnotationFilterCmd",i.getState()?"true":"false")}),l=this._destroy;this._destroy=function(){r&&n.unreference3DAnnotFilterController({context:r}),i._modelEvents.unsubscribe(a),l.call(i)},this.setState("false"!==localStorage.getItem("CAT3DAnnotationFilterCmd"),!0)},_destroy:function(){this._parent()}})});