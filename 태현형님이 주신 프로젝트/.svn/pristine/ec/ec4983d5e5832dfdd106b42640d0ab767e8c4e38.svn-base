define("DS/DMUReviewPersistence/DMUReviewMaturityChangeCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/DMUBaseExperience/DMUContextManager","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting"],function(e,t,n,i){"use strict";return t.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var t,a=this,r=e.frameWindow||this.getFrameWindow();this.beginExecute=function(){var e=n.getReviewContext({viewer:r.getViewer()}).getValidation();if(e){var o=n.getEventsController({viewer:r.getViewer()});require(["DS/MaturityWidget/MaturityWidget"].concat([]),function(n){t&&t.dialog&&t.dialog.destroy(),(t=new n({externalSettings:i.getOption("platform_services")})).addEvent("onMaturityCanceled",function(){a.end()}),t.addEvent("onMaturityTransitionEnd",function(t){if(t&&t.data&&t.data.length>0){for(var n=0;n<t.data.length;n++)if(t.data[n]&&t.data[n].physicalid===e.getPlmID()&&t.data[n].tostate){e.setCurrentState(t.data[n].tostate),o&&o.fireEvent("onReviewObjectAttributesModified",{object:e,attr:[{currentState:t.data[n].tostate}]});break}a.end()}else a.end()}),i.getServerContext({onComplete:function(n){t.executeCmd([{physicalid:e.getPlmID(),tenant:i.getTenant()}],{context:{getSecurityContext:()=>({SecurityContext:n})}},()=>{})},onFailure:function(){}})})}else a.end()},this.endExecute=function(){t=null}}})}),define("DS/DMUReviewPersistence/EXPValHighlightContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter"],function(e){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e){var t=[];if(e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())}),1===t.length&&(-1!==t.indexOf("DMUValidationExposedPresentation")||-1!==t.indexOf("DMUValidationCheck"))){var n=[];return e[0].getParent().isReadOnly()||(n=this.getContextualMenuCommandList()),n}return[]},getContextualMenuCommandList:function(){return[{line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})}})}),define("DS/DMUReviewPersistence/EXPValHighlightsContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/ApplicationFrame/CommandsManager","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],function(e,t,n,i){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e,a){var r=[],o=i.get();if(e&&e.length&&e.forEach(function(e){-1===r.indexOf(e.getType())&&r.push(e.getType())}),1===r.length&&-1!==r.indexOf("Highlights")){var l=[];e[0].isReadOnly()||l.unshift({line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}),-1!==r.indexOf("Highlights")&&l.unshift({line:1,name:"DMUHideShowThumbnailStr",hdr_list:["DMUHideShowThumbnailHdr"]}),l.unshift({line:1,name:"DMUExpandAllStr",hdr_list:["DMUExpandAllHdr"]}),l.unshift({line:1,name:"DMUCollapseAllStr",hdr_list:["DMUCollapseAllHdr"]});var s=n.getReviewContext({viewer:a});if(!s)return;var d=n.getContextViewer({reviewContext:s});if(!d)return;var c=t.getCommand("DMUDeleteHdr",d.getCommandContext());if(c&&c.enable(),1===o.length&&c)c.disable();else for(let e=0;e<o.length;e++)o[e].pathElement.getLastElement().getDMUType&&"DMUValidationCheck"!==o[e].pathElement.getLastElement().getDMUType()||c&&c.disable();return l}return[]},getContextualMenuCommandList:function(){return[]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})}})}),define("DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices",["UWA/Utils","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUPlayMarkup/DMUMarkup","DS/DMUBaseWebValidation/EXPValMarkup","DS/DMUBaseWebValidation/EXPValValidation","DS/DMUBaseWebValidation/EXPValContext","DS/DMUBaseWebValidation/EXPValValidated","DS/DMUBaseWebValidation/EXPValCheck","DS/DMUBaseWebValidation/EXPValHighlight","DS/DMUBaseReview/DMULinksManager","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUBaseExperience/DMUModelServices","DS/DMUBaseExperience/EXPUtils","DS/DMUValidationPersistence/DMUValidationPersistenceServices","DS/DMUPlaySlide/DMUSlide","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/DMUReadPersistence/DMULoadingContextController","DS/DMUPersistence/DMUAuthPersistenceUtils","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Visualization/Node3D","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r,o,l,s,d,c,u,g,m,p,v,h,f,C,D,w,M,x,S,I){"use strict";var R=0,U=async function(n){if(!(n&&n.mkpData&&n.validation&&n.reviewCtx&&n.ctxViewer))return;var r=n.ctxViewer.getViewer(),o=n.ctxViewer.getFrameWindow(),l=new a(n.ctxViewer.getViewer(),n.validation);n.validation.addMarkup(l);var s={children:[],id:n.mkpData.pId,instanceId:n.mkpData.markupRefInst.pId,name:n.mkpData.name,type:"Markup",treeOrder:"4.3333",webMarkup:"true",owner:n.mkpData.owner};l.setFromJson(s);var d={children:[],id:n.mkpData.markupRepRef.pId,instanceId:n.mkpData.markupRepInst.pId,name:"Review "+n.mkpData.name,type:"ReviewMarkup",treeOrder:"4.3334",webMarkup:"true",owner:n.mkpData.markupRepRef.owner};l.addChild(d);var g=t.getReviewContext({context:n.ctxViewer}).getTransientReviewBag(),m=null,p={entities:null,occurrences:null};g&&(m=g.getAttribute("oLinksManager")),m&&m.exportLinksManagerData(p),g=new i(n.ctxViewer.getViewer(),n.reviewCtx);let C,M=l.getChildren();M&&M.length&&(M[0].setMarkupContent(g),g.setMarkupOwner(M[0]),m=new c(n.ctxViewer.getViewer(),g),n.validation.setCurrentMarkup(M[0]),n.validation.fireEvent("onDMUObjectInitialized",{dmuObject:M[0]})),(p.entities&&p.entities.length>0||p.occurrences&&p.occurrences.length>0)&&m.importLinksManagerData(p),g.setAttributes([{name:"oLinksManager",value:m},{name:"sName",value:n.mkpData.markupName}]),u.setSlidePreferences({context:o,preferences:{panelTitle:n.validation.getName()}});try{C="true"===(await S.readPreferences([{Repository:"DMURepository",PreferenceNames:["CreateFirstSlide"]}])).repositories[0].preferences[0].value}catch(e){C=!0,window.console.warn("Could not get server value, default value set instead.",e)}if(C&&n.ctxViewer.getRootBagPath().getChildrenPathes().length){var x=new v(n.ctxViewer.getViewer(),n.reviewCtx.getCurrentSessionMarkup());x.setAttributes([{name:"sID",value:g.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sOwner",value:h.getUserLogin()},{name:"fCreationDate",value:Date.now()}]),x.updateEnvironmentOverload({target:n.reviewCtx.getEnvironment(),state:n.reviewCtx.getEnvironment().getEnvironmentInfo()}),g.addSlide(x);var R=null,U=f.giveDMUApplicativeContextManager({context:t.getContextViewer({viewer:r})});if(U)for(var b,y,k=U?U.getApplicativeControllers():[],E=0;E<k.length;E++){y=k[E].getApplicativeContainerID();var V=U.getVerifiedApplicativeContainerState(y);V&&(x.setSlideApplicativeContext(y,V),null,(b=k[E].getCurrentAppContainerStateTitle())&&(R?R+=" - ":R="",R+=b)),x.setSlideApplicativeContext(y,V)}R&&!R.length&&(R=null),x.setAttribute("sName",g.computeNewName({object:x,prefix:R||I.createReview.slideTitle,noSuffixIfPossible:null!==R,separator:null!==R?"parenthesis":null})),n.validation.fireEvent("onDMUObjectInitialized",{dmuObject:x}),n.validation.updateVisibleMarkups(),await D.copyTransientMarkersAndOverloads(g,x,n.ctxViewer,n.duplicatedEntity,n.hiddenElts);var P=w.giveDMUSlidesController({context:o});P&&P.setActiveSlide(x,{duration:0})}return{sessionMarkup:g,markup:l}},b=function(e){var n=t.getEventsController({viewer:e.iCtxViewer.getViewer()});"add"===e.mode?e.highlight.addAssociatedCheck(e.check.getPlmID()):"remove"===e.mode&&e.highlight.removeAssociatedCheck(e.check.getPlmID()),n.fireEvent("onUpdateImpactedChecksList",{highlight:e.highlight,check:e.check,mode:e.mode})},y=function(e){var n=t.getReviewContext({context:e.iCtxViewer}),i=new s(e.iCtxViewer.getViewer(),n.getValidation());i.setFromJson({type:e.type,name:e.name,id:e.id,state:e.state,description:e.description,owner:e.owner,children:""!==e.requirementDocId?[{id:e.requirementDocId,type:"Requirement",name:e.requirementName}]:[]}),n.getValidation().addCheck(i),n.getValidation().fireEvent("onDMUObjectInitialized",{dmuObject:i})},k={createReview:async function(e){if(!e||!e._ctxViewer)return;var i=e._ctxViewer,a=i.getViewer(),s=t.getReviewContext({context:i});s||(s=await n.createReviewContext({context:i}));let d=void 0!==e._rootData?e._rootData.valueItem:void 0;p.createReviewInDataBase({viewer:i,reviewName:e._reviewName,reviewPLMexternalID:e._reviewPLMexternalID,parentID:d,reviewDescription:e._reviewDescription?e._reviewDescription:"",createMarkup:e._createMarkup,markupName:e._markupName,markupPLMexternalID:e._markupPLMexternalID,markupDescription:e._markupDescription,contextAsValidated:e._contextAsValidated,serviceID:d&&i.getController().getRootStats(d)&&i.getController().getRootStats(d).serviceId?i.getController().getRootStats(d).serviceId:"",onReviewCreationCompleted:async function(n){let d=t.getEventsController({viewer:i.getViewer()}),c=C.getLoadingContextController({context:i});if(!i.getRootBagPath().getChildrenPathes().length){d&&d.fireEvent("reviewNoContextModeOn");let e=d.addEvent("onLoadedReviewContext",t=>{d.removeEvent(e),["DXF","DWG","PDF"].some(e=>{e===t.rootType&&(s.getValidation().getMarkups().length||new Promise(function(e){let t;k.generateName({sListTypeName:[{sTypeName:"DMUValidationReviewReference"}],onGenerateNameCompleted:function(n){t=n.listNames[0].title,e(t)},ononGenerateNameFailed:function(){t=I.createReviewMarkup.defaultMarkupName,e(t)}})}).then(function(e){k.createReviewMarkup({ctxViewer:i,validation:s.getValidation(),mkpName:e,duplicatedEntity:[],hiddenElts:[],onMarkupCreationCompleted:function(e){d&&d.fireEvent("onDMUMarkupCreationSucceeded",{dmuObject:e.sessionMarkup})},onMarkupCreationFailed:function(){}})}))})}),t=i.subscribe({event:"onRootAdded"},function(e){let n;if(e.path)"Document"===(n=M.getNodeType(e.path.getLastElement(!0)))&&(n=c.getLoadMarkupCtxType()?c.getLoadMarkupCtxType():n);else{let e=i.getRootBagPath().externalPath[0].path.getChildrenPathes().length,t=i.getRootBagPath().externalPath[0].path.getChildrenPathes()[e-1];n=M.getNodeType(t.getLastElement(!0))}d.fireEvent("reviewNoContextModeOff",{rootType:n}),i.unsubscribe(t)})}if(n){let d,m;c&&(d=c.getTempObjectInformations(),m=c.getLoadedR2VInformations());var u={contextId:e._rootData?e._rootData.valueItem:null,reviewId:n.pId,valCtxId:n.Context?n.Context.pId:null,validatedID:n.Validated.pId,validatedPath:n.Validated.path?n.Validated.path:void 0,reviewName:n.validationName,modifiable:!0,editionMode:e._editionMode,reviewDescription:n.description?n.description:"",status:n.status,currentState:n.currentState,reviewType:"DMUValidationValidation",owner:n.owner,tempObjectInfo:d,loadedR2VInfo:m},g=function(e,n,i,a){var s=new r(e,i);s.setFromJson({id:n.reviewId,name:n.reviewName,status:n.status,currentState:n.currentState,type:n.reviewType,owner:n.owner}),i.setValidation(s),i.setReviewCtxInformation(n),s.setNode(new x("DMUReviewBag"));let d=C.giveLoadingContextController({context:t.getContextViewer({viewer:e})});if(d&&["PDF","Requirement","Requirement Specification"].includes(d.getLoadMarkupCtxType())&&s.enableMultipleMarkupVisibility(!0),n.valCtxId){var c=new o(e,s);c.setFromJson({id:n.valCtxId,type:"DMUValidationContext"}),a&&c.addJsonContext({id:a.valueItem,name:a.labelItem,type:a.type}),s.setContext(c)}var u=new l(e,s);if(u.setFromJson({id:n.validatedID,type:"ValValidated"}),s.setValidated(u),n.validatedPath)if("R2V_FeatureState"===i.getValidation().getContext().getJsonContextTypes()[0])n.loadedR2VInfo.forEach(e=>{e.id===n.validatedPath&&(i.getValidation().getValidated().addPathElement({instanceName:e.info[0]["ds6w:label"],referenceName:e.info[0]["ds6w:label"],PathElements:[n.validatedPath]}),s.fireEvent("onDMUObjectInitialized",{dmuObject:s,editionMode:n.editionMode}))});else{var g=t.getContextViewer({viewer:e}).getController(),m=[n.validatedPath];g.getAttributes({ids:m,attributes:["ds6w:label","type_icon_url"],callbacks:{onComplete:function(e){i.getValidation().getValidated().addPathElement({instanceName:e[n.validatedPath]["ds6w:label"],referenceName:e[n.validatedPath]["ds6w:label"],PathElements:[n.validatedPath]}),s.fireEvent("onDMUObjectInitialized",{dmuObject:s,editionMode:n.editionMode})},onFailure:function(){i.getValidation().getValidated().addPathElement({instanceName:n.tempObjectInfo.title,referenceName:n.tempObjectInfo.title,PathElements:[n.validatedPath]}),s.fireEvent("onDMUObjectInitialized",{dmuObject:s,editionMode:n.editionMode})}}})}else s.fireEvent("onDMUObjectInitialized",{dmuObject:s,editionMode:n.editionMode});return s}(a,u,s,e._rootData);e._createMarkup?n.markup?(await U({mkpData:n.markup,validation:g,reviewCtx:s,ctxViewer:i,duplicatedEntity:e._dmuEltsDuplicated,hiddenElts:e.hiddenElts}),e.onReviewCreationComplete({validation:g})):e.onReviewCreationFailed():e.onReviewCreationComplete()}else e.onReviewCreationFailed()},onReviewCreationFailed:e.onReviewCreationFailed})},updateValidatedObjectsList:function(e){p.saveValidatedObject({serviceId:e.serviceId,validatedObjects:e.validatedObjects,validatedId:e.validatedId,onSaveValidatedObjectsCompleted:function(){!function(e){var n=e.ctxViewer,i=t.getContextViewer({viewer:n}).getController();const a=t.getReviewContext({viewer:e.ctxViewer});var r=[e.instanceIds,e.referenceIds];const o=n=>{var i=t.getEventsController({viewer:e.ctxViewer}),r=[],o=[];let l=null,s=a.getValidation().getContext()?a.getValidation().getContext().getJsonContextTypes()[0]:null;if(s&&(l=s.parentType?s.parentType:s.type?s.type:s),"remove"===e.updateMode){for(let t=0;t<e.validatedToAdd.length;t++)a.getValidation().getValidated().removePathElement(e.validatedToAdd[t],e.fullPathRefs[t]);i.fireEvent("onValidatedSaved",e),["Requirement Specification","Requirement","Document","DesignSight","R2V_FeatureState"].includes(l)&&a.getValidation().removeValidatedNode(e.referenceIds[0])}else{for(let t=0;t<e.validatedToAdd.length;t++)a.getValidation().getValidated().addPathElement({instanceName:n[e.instanceIds[t]]["ds6w:label"],referenceName:n[e.referenceIds[t]]["ds6w:label"],PathElements:e.validatedToAdd[t]}),r.push(n[e.referenceIds[t]].type_icon_url),o.push(n[e.instanceIds[t]]["ds6w:label"]),["Requirement Specification","Requirement","Document","DesignSight","R2V_FeatureState"].includes(l)&&a.getValidation().addValidatedNode({docInfo:{validatedId:e.validatedId,validatedPaths:e.validatedToAdd[t],validatedName:n[e.validatedToAdd[t]]["ds6w:label"]}});e.onReviewCtxUpdateOrDropValidated?i.fireEvent("onReviewCtxUpdateOrDropValidated",{validatedId:e.validatedId,validatedNames:o,validatedPaths:e.validatedToAdd,validatedIcons:r}):i.fireEvent("onDMUValidatedCreated",{validatedId:e.validatedId,validatedNames:o,validatedPaths:e.validatedToAdd,validatedIcons:r})}};if(a)if("R2V_FeatureState"===a.getValidation().getContext().getJsonContextTypes()[0]){const e=C.getLoadingContextController({context:t.getContextViewer({viewer:n})}).getLoadedR2VInformations(),i=e[0].id,a=e[0].info[0].icon;o({[i]:{"ds6w:label":e[0].info[0]["ds6w:label"],"ds6w:type":"R2V_FeatureState",physicalid:i,type_icon_url:a}})}else i.getAttributes({ids:r,attributes:["ds6w:label","type_icon_url"],callbacks:{onComplete:o,onFailure:function(){return null}}})}(e)},onSaveValidatedObjectsFailed:e.onSaveValidatedObjectsFailed})},addCheck:function(e){p.addCheck({validationId:e.validation.getPlmID(),requirementDocId:e.requirementDocId,checkName:e.checkName,description:e.description,checkState:e.checkState,onCheckCreationCompleted:function(t){t.error||y({type:"DMUValidationCheck",name:t.name,id:t.pId,state:t.checkState,description:t.description,owner:t.owner,requirementName:e.requirementName,requirementDocId:e.requirementDocId,iCtxViewer:e.iCtxViewer})},onCheckCreationFailed:e.onCheckCreationFailed})},addChecks:function(e){p.addChecks({listObjects:e.checkList,onCheckCreationCompleted:function(t){t.checkObjects&&t.checkObjects.forEach(t=>{y({type:"DMUValidationCheck",name:t.name,id:t.pId,state:t.checkState,description:t.description,owner:t.owner,requirementName:t.name,requirementDocId:t.requirementDocId,iCtxViewer:e.iCtxViewer})})},onCheckCreationFailed:e.onCheckCreationFailed})},setCheckRequirement:function(e){p.setCheckRequirement({checkId:e.checkId,requirementId:e.requirementId,removeReq:e.removeReq,onSetCheckRequirementComplete:function(){e.onSetCheckRequirementComplete(e)},onSetCheckRequirementFailed:e.onSetCheckRequirementFailed})},setImpactedCheck:function(e){p.setImpactedCheck({checkId:e.check.getPlmID(),highlightId:e.highlight.getPlmID(),onSetImpactedCheckComplete:function(){e.mode="add",b(e),e.onSetImpactedCheckComplete()},onSetImpactedCheckFailed:e.onSetImpactedCheckFailed})},removeImpactedCheck:function(e){p.removeImpactedCheck({checkId:e.check.getPlmID(),highlightId:e.highlight.getPlmID(),onRemoveImpactedCheckComplete:function(){e.mode="remove",b(e),e.onRemoveImpactedCheckComplete()},onRemoveImpactedCheckFailed:e.onRemoveImpactedCheckFailed})},updateSessionCheckAttributes:function(e){p.updateAttributes({objectsToModify:[{sObjectId:e.objectId,sListOfAttributesToModify:e.attributesList}],onAttributesSaveCompleted:function(n){n.modifiedObjects&&1===n.modifiedObjects.length?(n.modifiedObjects[0].iCtxViewer=e.ctxViewer,function(e){var n,i=t.getReviewContext({context:e.iCtxViewer}).getValidation().getChecks();for(n=0;n<i.length;n++)i[n].getPlmID()===e.pId&&(e.iCheckState&&i[n].setStatus(e.iCheckState),e.sDescription&&i[n].setDescription(e.sDescription),e.sName&&i[n].setName(e.sName))}(n.modifiedObjects[0]),e.onSaveCompleted()):e.onSaveFailed()},onAttributesSaveFailed:e.onSaveFailed})},addHighlight:function(e){var t=[];e.markupRepRef&&(e.markupRepRef.getParent&&e.markupRepRef.getParent()&&e.markupRepRef.getParent().getInstancePlmID&&t.push(e.markupRepRef.getParent().getInstancePlmID()),e.markupRepRef.getInstancePlmID&&(t.push(e.markupRepRef.getInstancePlmID()),t.push(e.markupRepRef.getPlmID()))),p.addHighlight({validationId:e.validation.getPlmID(),markupRepRefPathIds:t,slideId:e.slide.getAttribute("sUuid"),highlightName:e.highlightName,description:e.description,onHighlightCreationCompleted:function(t){!function(e){if(e&&e.validation&&e.iCtxViewer&&e.highlightData){var t=new d(e.iCtxViewer.getViewer(),e.validation);t.setFromJson({type:"DMUValidationExposedPresentation",name:e.highlightData.name,id:e.highlightData.pId,slideId:e.highlightData.slideId,repRefMarkupId:e.highlightData.markupRepRefId,description:e.highlightData.description,rating:e.highlightData.presentationRating,associatedCheck:[],owner:e.highlightData.owner}),e.validation.addHighlight(t),e.validation.fireEvent("onDMUObjectInitialized",{dmuObject:t,slideObject:e.slideObj})}}({iCtxViewer:e.iCtxViewer,validation:e.validation,highlightData:t,slideObj:e.slide}),e.onHighlightCreationCompleted()},onHighlightCreationFailed:e.onHighlightCreationFailed})},addReply:function(e){var n=t.getContextViewer({viewer:e.viewer}),a=t.getReviewContext({context:n});p.addReply({markupRefId:e.markupRef.getPlmID(),name:e.name,description:e.description,onReplyCreationCompleted:function(t){var r=function(e){if(!(e&&e.validation&&e.replyData&&e.viewer&&e.markupRef&&e.reviewCtx))return;var t,n={children:[],id:e.replyData.pId,instanceId:e.replyData.markupRefInst.pId,name:e.replyData.name,type:"Reply",treeOrder:"4.3333",webMarkup:"true",owner:e.replyData.owner};e.markupRef.addChild(n);let a=e.markupRef.getChildren();var r=a&&a.length?a[a.length-1]:null;if(r){var o={children:[],id:e.replyData.markupRepRef.pId,instanceId:e.replyData.markupRepInst.pId,name:"Review "+e.replyData.name,type:"ReviewMarkup",treeOrder:"4.3334",webMarkup:"true",owner:e.replyData.owner};r.addChild(o);var l=(a=r.getChildren())&&a.length?a[0]:null;if(l){let n=null,a=null,o={entities:null,occurrences:null};(a=e.reviewCtx.getCurrentSessionMarkup())&&"DMUMarkup"===a.getType()&&(n=a.getAttribute("oLinksManager")),n&&n.exportLinksManagerData(o),a=new i(e.viewer,e.reviewCtx),l.setMarkupContent(a),a.setMarkupOwner(l),n=new c(e.viewer,a),(o.entities&&o.entities.length>0||o.occurrences&&o.occurrences.length>0)&&n.importLinksManagerData(o),a.setAttributes([{name:"oLinksManager",value:n},{name:"sName",value:e.replyData.name}]),t={replyRef:r,replyRepRef:l}}}return t}({ctxViewer:n,replyData:t,markupRef:e.markupRef,reviewCtx:a,validation:e.validation,viewer:e.viewer});e.validation.fireEvent("onDMUObjectInitialized",{dmuObject:r.replyRepRef}),e.onReplyCreationCompleted(r)},onReplyCreationFailed:e.onReplyCreationFailed})},deleteObject:function(e){p.deleteObject({objectIds:e.objectIds,onObjectDeletionCompleted:function(){var n=e.ctxViewer,i=[],a=[],r=t.getReviewContext({context:n}),o=t.getEventsController({viewer:n.getViewer()});if("validationObject"===e.type)for(let t=0;t<e.objectIds.length;t++){var l=r.getValidation().getChecks(),s=r.getValidation().getHighlights();for(let n=0;n<l.length;n++)l[n].getPlmID()===e.objectIds[t]&&(a.push(e.objectIds[t]),r.getValidation().removeCheck(e.objectIds[t]));for(let n=0;n<s.length;n++)s[n].getPlmID()===e.objectIds[t]&&(i.push(e.objectIds[t]),r.getValidation().removeHighlight(e.objectIds[t]))}i.length&&o.fireEvent("onDMUHighlightRemoveRequested",i),a.length?o.fireEvent("onDMUCheckRemoveRequested",a):"Markup"===e.type&&r.getValidation().removeMarkup(e.objectId),e.onDeleteCompleted&&e.onDeleteCompleted()},onObjectDeletionFailed:e.onDeleteFailed})},createReviewMarkup:async function(e){if(e.ctxViewer&&e.validation){var i=t.getReviewContext({context:e.ctxViewer});i||(i=await n.createReviewContext({context:e.ctxViewer})),p.addMarkup({mkpName:e.mkpName,markupPLMexternalID:e.markupPLMexternalID,validationId:e.validation.getPlmID(),onMarkupCreationCompleted:async function(t){let n=await U({mkpData:t,validation:e.validation,reviewCtx:i,ctxViewer:e.ctxViewer,duplicatedEntity:e.duplicatedEntity,hiddenElts:e.hiddenElts});e.onMarkupCreationCompleted&&e.onMarkupCreationCompleted(n)},onMarkupCreationFailed:e.onMarkupCreationFailed})}},saveReviewMarkup:function(e){e&&e.frmWindow&&m.isPersistenceAllowed({onPersistenceAllowed:async function(){var n=function(){R--};R++;var i=0,a=null,r=t.getReviewContext({viewer:e.frmWindow.getViewer()});let o=r?r.getValidation():null,l=o?o.getRepRef(e.markupRepRefId):null,s=l?l.getMarkupContent():null;if(s)if(s.isDirty()){var d;if(i=1,!e.superType||"SIMItfSimulation"!==e.superType&&"Document"!==e.superType){d={Version:"1.0",Model:[]};let e=await g.getObjectDefinition(s);d.Model.push(e)}else{d={Version:"1.0",Contexts:[],Model:[]};let t=await g.getObjectDefinition(s);d.Model.push(t),d.Contexts.push({superType:e.superType,documentType:e.documentType,listData:e.listData,loadingInfos:e.loadingInfos,documentVersionInfos:e.documentVersionInfos})}a=JSON.stringify(d)}else i=2;1===i&&a?p.saveReviewMarkup({markupRepRefId:e.markupRepRefId,jsonContent:a,onSaveReviewMarkupCompleted:function(){s.setDirtyFlag(!1),e.onSaveCompleted(),n()},onSaveReviewMarkupFailed:function(t){e.onSaveFailed(t),n()}}):(e.onSaveFailed&&e.onSaveFailed(2===i?"NoSaveNeeded":"error"),n())},onPersistenceNotAllowed:function(){e.onSaveFailed&&e.onSaveFailed("error")}})},updateAttributes:function(e){var n=[];e.objectsToModify&&e.objectsToModify.length>0&&e.objectsToModify.forEach(function(e){var t=e.objectId;t||(t=e.object.getPlmID()),n.push({sObjectId:t,sListOfAttributesToModify:e.attributesList})}),p.updateAttributes({objectsToModify:n,onAttributesSaveCompleted:function(n){!function(e){var n;e.ctxViewer&&e.ctxViewer.getViewer&&(n=t.getEventsController({viewer:e.ctxViewer.getViewer()})),e.objects&&e.updateInfos&&e.updateInfos.length>0&&e.updateInfos.forEach(function(t){for(var i,a=[],r=0;r<e.objects.length;r++)if(e.objects[r]&&e.objects[r].object&&e.objects[r].object.getPlmID()===t.pId){i=e.objects[r].object;break}i&&(t.sValidationState?(i.setStatus(t.sValidationState),a.push({sValidationState:t.sValidationState})):t.sAlias&&(i.setName(t.sAlias),a.push({sAlias:t.sAlias})),n&&n.fireEvent("onReviewObjectAttributesModified",{object:i,attr:a}))})}({objects:e.objectsToModify,ctxViewer:e.ctxViewer,updateInfos:n.modifiedObjects}),e.onAttributesSaveCompleted(n)},onAttributesSaveFailed:e.onSaveFailed})},updateReviewContext:function(e){p.updateReviewContext({validationId:e.validation.getPlmID(),contextId:e.contextId,serviceID:e.ctxViewer.getController().getRootStats(e.contextId)&&e.ctxViewer.getController().getRootStats(e.contextId).serviceId?e.ctxViewer.getController().getRootStats(e.contextId).serviceId:"",onUpdateReviewContextCompleted:function(n){!function(e){if(e&&e.updateInfos&&e.validation&&e.root){var n;e.ctxViewer&&e.ctxViewer.getViewer&&(n=t.getEventsController({viewer:e.ctxViewer.getViewer()}));var i=e.validation.getContext();!i&&e.updateInfos.Context&&((i=new o(e.ctxViewer,e.validation)).setFromJson({id:e.updateInfos.Context.pId,type:"DMUValidationContext"}),e.validation.setContext(i)),i&&(i.addJsonContext({id:e.updateInfos.rootContextId,name:e.root.label,type:e.root.type}),n&&n.fireEvent("onReviewCtxLoaded",{name:e.root.label,icon:e.root.icon,id:e.contextId}))}}({validation:e.validation,root:e.rootData,updateInfos:n,contextId:e.contextId,ctxViewer:e.ctxViewer}),e.onUpdateReviewContextCompleted()},onUpdateReviewContextFailed:e.onUpdateReviewContextFailed})},generateName:function(e){p.generateName({sListTypeName:e.sListTypeName,onGenerateNameCompleted:e.onGenerateNameCompleted,ononGenerateNameFailed:e.ononGenerateNameFailed})},isProcessing:function(){return R>0}};return k}),define("DS/DMUReviewPersistence/DMUReviewPersistence",[],function(){}),define("DS/DMUReviewPersistence/EXPValCheckContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter"],function(e){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e){var t=[];if(e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())}),1===t.length&&(-1!==t.indexOf("DMUValidationExposedPresentation")||-1!==t.indexOf("DMUValidationCheck"))){var n=[];return e[0].getParent().isReadOnly()||(n=this.getContextualMenuCommandList()),n}return[]},getContextualMenuCommandList:function(){return[{line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})}})}),define("DS/DMUReviewPersistence/DMUReviewGenerateTICCmd",["DS/DMUBaseExperience/DMUContextManager","DS/ApplicationFrame/FrameWindowsManager","DS/CATWebUXTIC/CATWebUXTICCmdAdapt","UWA/Core","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence","DS/Selection/CSOManager","DS/DMUMeasurable/DMUToolsSceneGraph"],function(e,t,n,i,a,r,o,l,s){"use strict";return n.extend({init:function(n){var d=e.getContextViewer({viewer:t.getFrameWindow(n.context).getViewer()});n.pad3DViewer=d,this._parent(n);var c=this;function u(){var e=[];return l.get().forEach(function(t){for(var n=0;t.pathElement,n<t.pathElement.getLength();n++){var i=t.pathElement.getElement(n);i&&"function"==typeof i.getDMUType&&"DMUValidationExposedPresentation"===i.getDMUType()&&e.push(i)}}),e}function g(t){return new Promise(function(n){var g=e.getReviewContext({context:d}),m={reportedAgainst:[],contexts:[],assignees:[],attachments:[]},p=g.getValidation();if(p){if(!p.getPlmID())return void t.onFailure("No Review is available");m.onComplete=function(t){e.getEventsController({viewer:d.getViewer()}).fireEvent("onTICCreationComplete",t)},m.onCancel=function(){e.getEventsController({viewer:d.getViewer()}).fireEvent("onTICCreationCancel")};var v=function(e){var t=[];if(l.get().forEach(function(e){var n=e.pathElement;if(n){for(;n&&!s.isReference(n.getLastElement());)n=n.getParentPath();if(n){var i=n.getLastElement(),a=s.getNodeID(i);t||(t=[]),-1===t.indexOf(a)&&t.push(a)}}}),!t.length)for(var n=e.getValidated().getPathElements(),i=0;i<n.length;i++)n[i]&&n[i].pathElement.length&&t.push(n[i].pathElement[n[i].pathElement.length-1]);return t}(p),h={ids:p.getContext().getJsonContextIDs(),type:p.getContext().getJsonContextTypes()[0]};c.getContext(h).then(e=>{if(e){m.reportedAgainst=0===v.length?e:v,m.contexts=e;var l=[];m.reportedAgainst.length&&(l=m.reportedAgainst.slice()),l.push(p.getPlmID()),function(e){return new Promise(function(t){d.getController().getAttributes({ids:e,attributes:["owner","ds6w:description"],callbacks:{onComplete:e=>t(e),onFailure:()=>t}})})}(l).then(function(e){m.title=function(e){var t=u();return t.length>0?t[0].getOwner().getName():e.getName()}(p),m.attachments=function(e){var t=[],n=u();if(n.length>0)for(var i=0;i<n.length;i++)t.push(n[i].getOwner().getPlmID());else t.push(e.getPlmID());return t}(p);var l=u();l.length>0&&l[0].getOwner()&&l[0].getOwner().getDescription?(m.description=l[0].getOwner().getDescription(),m.description||(m.description=p.getContext().getJsonContextNames()[0])):(e&&e[p.getPlmID()]&&(m.description=e[p.getPlmID()]["ds6w:description"]),m.description||(m.description=p.getContext().getJsonContextNames()[0]));for(var s=0;s<m.reportedAgainst.length;s++)e&&e[m.reportedAgainst[s]].owner&&-1===m.assignees.indexOf(e[m.reportedAgainst[s]].owner)&&m.assignees.push(e[m.reportedAgainst[s]].owner);if(p.getHighlights().length)if(l.length)n(m);else{var c=i.createElement("div"),g="Issue"===t.cmdType?o.issueOnReview:o.caOnReview;i.createElement("label",{text:g,styles:{"margin-bottom":"0px",padding:"10px 0px"}}).inject(c);var v=new a({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:"Issue"===t.cmdType?o.issueTitle:o.caTitle,immersiveFrame:d.getFrameWindow().getImmersiveFrame(),content:c,closeButtonFlag:!0,buttons:{Ok:new r({label:o.yes,onClick:function(){v.destroy(),n(m)}}),Cancel:new r({label:o.no,emphasize:"primary",onClick:function(){v.destroy(),n()}})}});v.addEventListener("close",function(){v.destroy(),n()})}else n(m)})}})}})}this.getParameters=function(e){g(e).then(function(t){t?e.onComplete(t):e.onCancel()})},this._destroy=function(){var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)}}})}),define("DS/DMUReviewPersistence/EXPValChecksContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/ApplicationFrame/CommandsManager","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],function(e,t,n,i){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e,a){var r=[],o=i.get();if(e&&e.length&&e.forEach(function(e){-1===r.indexOf(e.getType())&&r.push(e.getType())}),1===r.length&&-1!==r.indexOf("Checks")){var l=[];e[0].isReadOnly()||l.unshift({line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}),l.unshift({line:1,name:"DMUExpandAllStr",hdr_list:["DMUExpandAllHdr"]}),l.unshift({line:1,name:"DMUCollapseAllStr",hdr_list:["DMUCollapseAllHdr"]});var s=n.getReviewContext({viewer:a});if(!s)return;var d=n.getContextViewer({reviewContext:s});if(!d)return;var c=t.getCommand("DMUDeleteHdr",d.getCommandContext());if(c&&c.enable(),1===o.length&&c)c.disable();else for(let e=0;e<o.length;e++)o[e].pathElement.getLastElement().getDMUType&&"DMUValidationExposedPresentation"!==o[e].pathElement.getLastElement().getDMUType()||c&&c.disable();return l}return[]},getContextualMenuCommandList:function(){return[]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})}})}),define("DS/DMUReviewPersistence/DMUReviewStatusChangeCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/CATWebUXCVS/CATWebUXCVSComponent","DS/DMUBaseExperience/DMUContextManager","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting","DS/CATWebUXComponents/CATWebUXNotification","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r,o,l){"use strict";return t.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var t,n=this,s=null,d=e.frameWindow||this.getFrameWindow();this.beginExecute=function(){var e=a.getReviewContext({viewer:d.getViewer()}).getValidation(),c=function(){(t=new o).build({type:"error",autoHide:!0,message:l.valStateChange.error,body:d.getUIFrame()}),n.end()};r.getServerContext({onComplete:function(t){s=new i({title:e.getName(),physicalId:e.getPlmID(),current:e.getStatus(),parent:d.getImmersiveFrame(),platformSettings:r.getOption("platform_services"),tenant:r.getTenant(),securityContext:{getSecurityContext:()=>({SecurityContext:t})},onChangeValidationStateCompleted:function(t){if(t){var i=[];e.setStatus(t.sValidationState),i.push({sValidationState:t.sValidationState});var r=a.getEventsController({viewer:d.getViewer()});r&&r.fireEvent("onReviewObjectAttributesModified",{object:e,attr:i}),n.end()}else c()},onChangeValidationStateClose:function(){n.end()},onChangeValidationStateFailure:function(){c()}})},onFailure:function(){c()}})},this.endExecute=function(){t&&t.destroy(),s&&s.clean()}}})}),define("DS/DMUReviewPersistence/DMUSetImpactedCheckCmd",["DS/ApplicationFrame/Command","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/CATWebUXComponents/CATWebUXNotification","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var o=e.frameWindow||this.getFrameWindow(),l=o.getViewer(),s=null,d=this,c=null,u=null,g=null;this.beginExecute=function(){(u=new a).build({body:o.getUIFrame(),type:"info",notificationType:"HelpNotification",message:r.setImpactedCheck.selectCheck}),s=n.onAdd(function(){var e=n.get();if(e.length>0){var s=e[e.length-1].pathElement.getLastElement();s.getDMUType&&s.getOwner&&"DMUValidationCheck"===s.getDMUType()&&function(e){var n=t.getContextViewer({viewer:l}),s=c.getAssociatedCheck();for(let i=0;i<s.length;i++)if(s[i]===e.getPlmID())return(g=new a).build({type:"error",autoHide:!0,message:r.setImpactedCheck.duplicateError,body:o.getUIFrame()}),t.getEventsController({viewer:n.getViewer()}).fireEvent("onImpCheckFailed"),void d.cancelExecute();i.setImpactedCheck({iCtxViewer:n,check:e,highlight:c,onSetImpactedCheckComplete:function(){d.end()},onSetImpactedCheckFailed:function(){(g=new a).build({type:"error",autoHide:!0,message:r.setImpactedCheck.error,body:o.getUIFrame()}),t.getEventsController({viewer:n.getViewer()}).fireEvent("onImpCheckFailed"),d.end()}})}(s.getOwner())}})},this.cancelExecute=function(){this.end()},this.endExecute=function(){n.unsubscribe(s),u&&u.destroy(),g&&g.destroy()},this.setHighlightObject=function(e){c=e}}})}),define("DS/DMUReviewPersistence/DMUCreateReviewMarkupCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/Controls/LineEditor","DS/Controls/Editor","DS/Windows/Dialog","DS/Controls/Button","DS/Utilities/TouchUtils","DS/DMUControls/DMUInfoModalDiv","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUPersistence/DMUAuthPersistenceUtils","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence","css!DS/DMUReviewPersistence/DMUReviewPersistence.css"],function(e,t,n,i,a,r,o,l,s,d,c,u,g,m){"use strict";return t.extend({init:function(t){t.mode="shared",t.repeatMode=!1,t.isAsynchronous=!0,this._parent(t);var p,v,h,f,C,D,w,M,x,S=this,I=t.frameWindow||this.getFrameWindow(),R=I.getViewer();let U,b,y=[],k=[];function E(e){h&&c.createReviewMarkup({ctxViewer:h,validation:e.val,mkpName:D,markupPLMexternalID:M,duplicatedEntity:y,hiddenElts:k,onMarkupCreationCompleted:function(e){x&&(x.destroy(),x=null);let t=i.giveEventsController({viewer:R});t&&t.fireEvent("onDMUMarkupCreationSucceeded",{dmuObject:e.sessionMarkup}),S.end()},onMarkupCreationFailed:function(e){!function(){v||(v=new n),v.build({type:"error",autoHide:!0,message:m.createReviewMarkup.errorMessage,body:I.getUIFrame()});var e=i.giveEventsController({viewer:R});e&&e.fireEvent("onDMUMarkupCreationFailed"),S.end()}()}})}i.setAuthoringFeatureTypes("Markup"),this.beginExecute=function(){new Promise(function(e){c.generateName({sListTypeName:[{sTypeName:"DMUValidationReviewReference"}],onGenerateNameCompleted:function(t){D=t.listNames[0].title,M=t.listNames[0].name,e(D)},ononGenerateNameFailed:function(){D=m.createReviewMarkup.defaultMarkupName,e(D)}})}).then(async function(t){try{let e=(await g.readPreferences([{Repository:"DMURepository",PreferenceNames:["CreateFirstSlide","DisplayMarkupCreationDialog"]}])).repositories[0].preferences;for(let t=0;t<e.length;t++)"CreateFirstSlide"===e[t].name?U="true"===e[t].value:"DisplayMarkupCreationDialog"===e[t].name&&(b="true"===e[t].value)}catch(e){U=!0,b=!0,window.console.warn("Could not get server value, default value set instead.",e)}if(D=t,h=i.getContextViewer({viewer:R})){var n=i.getReviewContext({context:h});if(n){var c=function(){p&&p.destroy(),async function(){(x=new d).display({modal:!0,frmWindow:I,type:"load",message:m.createReviewMarkup.loadingMessage}),k.length=0;let e="",t=n.getReviewCtxInformation();if(t&&t.contextId&&(e=t.contextId),U){let t=await u.getTransientMarkersAndOverloads(n,h,e);k=t.overloads,y=t.markers}E({val:n.getValidation()})}()};if(b){var v,M,V,P=e.createElement("div",{class:"DMUCreateMarkupPanelMainDiv"}),F=function(){var t=""===f.value;v.disabled=t,v.disabled||(D=f.value,w=C.value),M.innerHTML="",V.innerHTML="";var n=e.createElement("span",{class:"wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-required wux-ui-3ds-lg"});n.setStyles({color:"#E87B00",display:"inline-block","font-weight":"bold"}),t&&n.inject(M),M.setStyle("display",""!==M.innerHTML?"":"none"),V.setStyle("display",""!==V.innerHTML?"":"none")},T=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection NoMarkupCreate"}).inject(P),A=e.createElement("div").inject(T),N=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(A);N.setStyles({marginRight:"5px"}),(M=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(A)).setStyles({color:"#E87B00",display:"none","font-weight":"bold","font-style":"italic"}),N.innerHTML=m.createReviewMarkup.nameLabel,(f=new a({placeholder:m.createReviewMarkup.namePlaceholder,value:D,selectAllOnFocus:!0,autoCommitFlag:!0}).inject(T)).elements.container.setStyles({width:"100%"}),f.elements.container.childNodes[0].setStyles({width:"100%"}),f.addEventListener("change",F);var L=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(P),O=e.createElement("div").inject(L),j=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(O);(V=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(O)).setStyles({color:"red",display:"none","font-weight":"normal","font-style":"italic"}),j.innerHTML=m.createReviewMarkup.descriptionLabel,(C=new r({nbRows:5,newLineMode:"shiftEnter",placeholder:m.createReviewMarkup.descriptionPlaceholder,value:w,selectAllOnFocus:!0,autoCommitFlag:!0}).inject(L)).elements.container.setStyles({width:"100%"}),C.elements.container.childNodes[0].setStyles({width:"100%"}),C.addEventListener("change",F),(v=new l({emphasize:"primary",label:m.createReviewMarkup.createMarkupButton,onClick:c})).getContent().addClassName("reviewMarkupCreationButton");var _=new l({label:m.createReviewMarkup.cancelButton,onClick:function(){var e=i.giveEventsController({viewer:R});e&&e.fireEvent("onDMUMarkupCreationCancelled"),S.end()}});(p=new o({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:m.createReviewMarkup.panelTitle,resizableFlag:!0,immersiveFrame:I.getImmersiveFrame(),position:s.getTouchMode()?{my:"center bottom"}:void 0,buttons:{Ok:v,Cancel:_},width:400,content:P})).addEventListener("close",function(){S.end()})}else c()}else S.end()}else S.end()})};var V=this.endExecute;this.endExecute=function(){D=null,w=null,x&&(x.destroy(),x=null),v&&v.destroy(),p&&p.destroy(),v=p=null,f=C=void 0,D=w=void 0,V()},this.setDefaultInfo=function(e){D=e.title,w=e.description}}})}),define("DS/DMUReviewPersistence/DMUUpdateValidatedListCmd",["DS/ApplicationFrame/Command","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Visualization/PathElement","DS/DMUMeasurable/DMUToolsSceneGraph","DS/CATWebUXComponents/CATWebUXNotifBar","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUBaseExperience/EXPToolsContext","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r,o,l,s,d,c){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0;var u,g,m,p=null,v=null,h=this;this._parent(e);var f=e.frameWindow||this.getFrameWindow();this.contextIsAPart=function(){var e=n.getReviewContext({viewer:f.getViewer()}),t=n.getContextViewer({viewer:f.getViewer()}).getController(),i=!0;let a=e.getValidation().getContext().getJsonContextTypes()[0];if("VPMReference"!==(d.getParentType(a)?d.getParentType(a):a))i=!1;else{var o=e.getValidation().getContext().getJsonContexts()[0].id,l=[],s=t.getNode({id:o});l.push(s);var c=new r(l);if(i=c,c.externalPath.length)for(var u=c.externalPath[0].getChildren(),g=0;g<u.length;g++)u[g].userData&&"VPMInstance"===u[g].userData.type&&(i=!1)}return i},this._isValidatedDuplicated=function(e){var t=n.getReviewContext({viewer:f.getViewer()}).getValidation().getValidated().getPathElements();for(let n=0;n<t.length;n++)if(o.getIdPath(e).equals(t[n].pathElement))return!0;return!1},this.getLastInstance=function(e){return e.getLength()>1?o.isInstance(e.getLastElement(!0))&&!o.isRepInstance(e.getLastElement(!0))?e.clone():this.getLastInstance(e.getParentPath()):new r},this._createNewValidated=function(e){var i=n.getReviewContext({viewer:f.getViewer()}),a=i.getValidation().getValidated().getPathElements(),r=e.validatedPath,o=[],l=[];let s=this.options.arguments[0].Value;var d=function(e){var t=[];if(e)if(e.length>1)for(var n=1;n<e.length-1;)t.push(e[n]),n+=2;else 1===e.length&&t.push(e[0]);return t},u=-1;for(let n=0;n<a.length;n++){for(let i=0;i<e.validatedPath.length;i++)(e.refFullPath[i].equals(a[n].pathElement)||e.validatedPath[i].equals(a[n].pathElement))&&("add"===s&&(m||(m=new t),m.build({type:"information",autoHide:!0,message:c.updateValidatedListCmd.ValidatedExist,body:f.getUIFrame()})),u=n);u!==n?o.push(d(a[n].pathElement)):a.length&&a[n]&&l.push(a[n].instanceName?a[n].instanceName:void 0),u=-1}if("add"===s)for(let e=0;e<r.length;e++)o.push(d(r[e]));return{validatedObjects:o,validatedId:i.getValidation().getValidated().getPlmID()?i.getValidation().getValidated().getPlmID():null,instanceNames:l}},this.beginExecute=function(){g=f.getViewer();var e=[],t=h.contextIsAPart(),m=[],C=[],D=[],w=[],M=[],x=function(){let l,c=i.get(),u=n.getReviewContext({viewer:f.getViewer()}),p=u.getValidation().getContext().getJsonContextTypes()[0],v=d.getParentType(p)?d.getParentType(p):p;if(["Requirement Specification","Requirement","Document","DesignSight","R2V_FeatureState"].includes(v)){let e=u.getValidation().getValidated().getPathElements(),t=[];e.length>0&&e.forEach(e=>{t.push(e.pathElement)}),c.forEach(e=>{e.pathElement.getLastElement().getDocInfo?(w.push(e.pathElement.getLastElement().getDocInfo().validatedPaths[0]),M.push(e.pathElement.getLastElement().getDocInfo().validatedPaths[0]),t.forEach((n,i)=>{n[0]===e.pathElement.getLastElement().getDocInfo().validatedPaths[0]&&t.splice(i)}),C=e.pathElement.getLastElement().getDocInfo().validatedPaths,m.push(e.pathElement.getLastElement().getDocInfo().validatedPaths)):e.pathElement.getLastElement().getModelIdentification&&(w.push(e.pathElement.getLastElement().getModelIdentification()),M.push(e.pathElement.getLastElement().getModelIdentification()),t.forEach((n,i)=>{n[0]===e.pathElement.getLastElement().getModelIdentification()&&(C.push(n),t.splice(i))}))}),l={validatedObjects:t,validatedId:u.getValidation().getValidated().getPlmID(),instanceNames:""}}else{let s=h.options.arguments[0].Value;if(c.length>0&&"RootBag"===c[0].pathElement.externalPath[0].name&&"remove"===s&&c[0].pathElement.externalPath.shift(),c.length>0)for(let n=0;n<c.length;n++){if(c[n].pathElement&&m.push(o.getIdPath(c[n].pathElement)),t&&t.externalPath&&t.externalPath.length)e.push(t);else{e.push(function(e){var t=null;if(e){t=new r;for(var n=1;n<e.getLength();n++){var i=e.getElement(n);if(o.isRepInstance(i))break;t.addElement(i)}}return t}(c[n].pathElement))}"add"!==s||h._isValidatedDuplicated(e[n])?"remove"===s&&(e[n].externalPath&&C.push(o.getIdPath(e[n])),D.push(o.getLastReference(e[n]).getLastElement()),w.push(D[n]?D[n].getModelIdentification():C[n][0]),h.getLastInstance(e[n]).getLastElement()?M.push(h.getLastInstance(e[n]).getLastElement().getModelIdentification()):M.push(w[n])):(e[n].externalPath&&C.push(o.getIdPath(e[n])),D.push(o.getLastReference(e[n]).getLastElement()),w.push(D[D.length-1]?D[D.length-1].getModelIdentification():C[C.length-1][0]),h.getLastInstance(e[n]).getLastElement()?M.push(h.getLastInstance(e[n]).getLastElement().getModelIdentification()):M.push(w[w.length-1]))}if(C.length&&C[0].length&&m.length&&m[0].length)l=h._createNewValidated({validatedPath:C,refFullPath:m});else{var x=n.getEventsController({viewer:f.getViewer()});i.empty(),a.empty(),x.fireEvent("onValidatedObjCancelRequested"),h.endExecute()}}var S=h.options.arguments[0].Value;l&&s.updateValidatedObjectsList({fullPathRefs:m,validatedObjects:l.validatedObjects,validatedId:l.validatedId,validatedToAdd:C,referenceIds:w,instanceIds:M,instanceNames:l.instanceNames,updateMode:S,ctxViewer:g,onSaveValidatedObjectsFailed:function(){}}),h.end()};let S=c.updateValidatedListCmd.SelectMsg?c.updateValidatedListCmd.SelectMsg:"Select the Validated Object(s) to add",I=c.updateValidatedListCmd.OkBtn?c.updateValidatedListCmd.OkBtn:"OK",R=c.updateValidatedListCmd.CancelBtn?c.updateValidatedListCmd.CancelBtn:"OK";(u=new l({className:"R3VAddValidatedCmdDlg"}).inject(f.getUIFrame())).add({msgType:"primary",message:S,closable:!1,buttons:[{className:"primary",label:I,onClick:x},{className:"default",label:R,onClick:function(){var e=n.getEventsController({viewer:f.getViewer()});i.empty(),a.empty(),e.fireEvent("onValidatedObjCancelRequested"),h.end()}}]}),0===i.get().length&&(u.elements.container.getElementsByClassName("btn btn-sm btn-primary")[0].disabled=!0),"add"===this.options.arguments[0].Value?(p=i.onAdd(function(){u.elements.container.getElementsByClassName("btn btn-sm btn-primary")[0].disabled=!1,u.show()}),v=i.onRemove(function(){0===i.get().length&&(u.elements.container.getElementsByClassName("btn btn-sm btn-primary")[0].disabled=!0)})):x()},this.endExecute=function(){i.unsubscribe(p),i.unsubscribe(v),u&&u.destroy()}}})}),define("DS/DMUReviewPersistence/DMUAddCheckCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUControls/DMUInfoModalDiv","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r,o,l,s){"use strict";return t.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var t,a,r=this,o=e.frameWindow||this.getFrameWindow(),d=o.getViewer();this._createNewCheck=function(e){var c=i.getReviewContext({viewer:o.getViewer()});t=i.giveEventsController({viewer:d}),l.addCheck({iCtxViewer:i.getContextViewer({viewer:d}),validation:c.getValidation(),requirementDocId:"",checkName:e||"",description:"",checkState:1,onSaveCheckFailed:function(){a||(a=new n),a.build({type:"error",autoHide:!0,message:s.createCheck.errorMessage,body:o.getUIFrame()}),t&&t.fireEvent("onCheckCreationFailed"),r.end()}}),r.end()},this.beginExecute=function(){r._createNewCheck()}}})}),define("DS/DMUReviewPersistence/DMUCreateReviewCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Controls/Editor","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Tab","DS/Utilities/TouchUtils","DS/DMUControls/DMUInfoModalDiv","DS/Visualization/PathElement","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUReadPersistence/DMULoadingContextController","DS/DMUPersistence/DMUAuthPersistenceUtils","DS/DMUPersistence/DMUAuthPersistenceServices","DS/DMUBaseExperience/EXPToolsContext","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence","css!DS/DMUReviewPersistence/DMUReviewPersistence.css"],function(e,t,n,i,a,r,o,l,s,d,c,u,g,m,p,v,h,f,C,D,w){"use strict";return t.extend({init:function(t){t.mode="shared",t.repeatMode=!1,t.isAsynchronous=!0,this._parent(t);var M,x,S,I,R,U,b,y,k,E,V,P=this,F="DMUDesignValidation"===t.arguments[0].Value,T=t.frameWindow||this.getFrameWindow(),A=T.getViewer(),N=[],L=[],O=[],j=[];let _,B,W,H=null;function q(e){var t;x||(x=new n),t="errorShape"===e?w.createReview.errorShape:w.createReview.errorMessage,x.build({type:"error",autoHide:!0,message:t,body:T.getUIFrame()});let a=i.giveEventsController({viewer:A});a&&a.fireEvent("onDMUReviewCreationFailed"),P.end()}function X(e){var t="",n=i.getContextViewer({viewer:A}).getController();return N.forEach(function(i){if(i.valueItem===e){switch(C.getParentType(i.type)?C.getParentType(i.type):i.type){case"ENOStrRefinementSpecification":t="NGFilter";break;case"Requirement":t="Requirement";break;case"Requirement Specification":t="Requirement Specification";break;case"Document":t="Document";break;case"Drawing":t="Drawing";break;case"SIMItfSimulation":t="ITF";break;case"PLMPIMMetricReference":t="ISR";break;case"DIFSheet":t="DIFSheet";break;case"DesignSight":t="DesignSight";break;case"R2V_FeatureState":t="R2V_FeatureState";break;default:var a=[],r=n.getNode({id:e});a.push(r);var o=new m(a);if(l.isRepReference(o.getLastElement(!0)))t="RepRef";else if(l.isReference(o.getLastElement(!0))){t="Product";var s=o.externalPath[0].getChildren();if(s.length>0){t="Part";for(let e=0;e<s.length;e++)if(!l.isRepInstance(s[e])){t="Product";break}}}}}}),t}function G(){let e=i.giveEventsController({viewer:A}),t=i.getReviewContext({context:S});if(t&&t.getValidation()?i.removeReviewContext({viewer:A}):t&&t.removeInternalDataModel(),e.fireEvent("onDMURemoveSessionReview"),!S)return;var n=I?I.value:N.length?N[0].valueItem:void 0,a=null;I?N.forEach(function(e){e.valueItem===I.value&&(a=e)}):a=N[0]?N[0]:void 0;var r="false";let o;n&&(o=X(n),["Part","Document","Requirement","DIFSheet","Drawing","R2V_FeatureState"].includes(o)&&(r="true"));let s="Document"===o||_;p.createReview({_ctxViewer:S,_reviewName:R,_reviewPLMexternalID:E,_rootData:a,_reviewDescription:b,_createMarkup:s,_markupName:U,_markupPLMexternalID:k,_markupDescription:y,_contextAsValidated:r,_parentID:n,_dmuEltsDuplicated:O,hiddenElts:j,_editionMode:F,onReviewCreationComplete:function(){if("R2V_FeatureState"===o&&(S.toggleSOITimelinesUsability(!1),e&&e.fireEvent("onR2VReviewCreationSuccess")),V&&(V.destroy(),V=null),e&&e.fireEvent("onDMUReviewCreationSucceeded"),"ITF"===o||"ISR"===o){t=i.getReviewContext({context:S});let e=S.getRootBagPath().getChildrenPathes(),n=l.getNodeID(e[0].getLastElement(!0)),a="add";p.updateValidatedObjectsList({fullPathRefs:[[n]],validatedObjects:[[n]],validatedId:t.getValidation().getValidated().getPlmID()?t.getValidation().getValidated().getPlmID():null,validatedToAdd:[[n]],referenceIds:[n],instanceIds:[n],instanceNames:[],updateMode:a,ctxViewer:S.getViewer(),onReviewCtxUpdateOrDropValidated:!0,onSaveValidatedObjectsFailed:function(){}})}P.end()},onReviewCreationFailed:q})}async function J(){var t;try{let e=(await D.readPreferences([{Repository:"DMURepository",PreferenceNames:["CreateFirstSlide","AutomaticMarkupCreationDialog","DisplayReviewCreationDialog"]}])).repositories[0].preferences;for(let t=0;t<e.length;t++)"CreateFirstSlide"===e[t].name?B="true"===e[t].value:"AutomaticMarkupCreationDialog"===e[t].name?_="true"===e[t].value:"DisplayReviewCreationDialog"===e[t].name&&(W="true"===e[t].value)}catch(e){B=!0,_=!0,W=!0,window.console.warn("Could not get server value, default value set instead.",e)}var n=_?[{sTypeName:"DMUValidationValidation"},{sTypeName:"DMUValidationReviewReference"}]:[{sTypeName:"DMUValidationValidation"}];R||new Promise(function(e){p.generateName({sListTypeName:n,onGenerateNameCompleted:function(t){R=t.listNames[0].title,E=t.listNames[0].name,_&&(U=t.listNames[1].title,k=t.listNames[1].name),e()},ononGenerateNameFailed:function(){R=L.length?w.createReview.defaultReviewName+"_"+L[0]:w.createReview.defaultReviewName,e()}})}).then(function(){var n,l=i.getReviewContext({context:S}),m=function(){M&&M.destroy(),async function(){(V=new g).display({modal:!0,frmWindow:T,type:"load",message:w.createReview.loadingMessage});var e=I?I.value:N.length?N[0].valueItem:void 0;if(_&&B){let t=await h.getTransientMarkersAndOverloads(l,S,e);j=t.overloads,O=t.markers}if(l)if(l.getValidation()){var t=l?l.getValidation():null,n=t?t.getCurrentMarkup():null;n?p.saveReviewMarkup({markupRepRefId:n.getRepRef().getPlmID(),frmWindow:T,onSaveCompleted:G,onSaveFailed:e=>{"NoSaveNeeded"===e&&G()}}):G()}else G();else G()}()},v=function(i,s){var d,c,u,g,m,p,v;N.length>1&&"review"===s&&(m=_?e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(i):e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection NoMarkupCreate"}).inject(i),e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(m).innerText=w.createReviewMarkup.multipleRootsLabel,I=new a({elementsList:N,selectedIndex:0,enableSearchFlag:!0,actionOnClickFlag:!1}).inject(m),_?m.setStyles({paddingTop:"10px",paddingBottom:"0px"}):m.setStyles({paddingBottom:"10px"}),I.elements.container.setStyles({width:"100%"}),I.elements.container.setStyles({width:"calc(100% - 3px)"}));var h,f=function(){var i,a="review"===s;i=a?""===d.value:""===c.value,n.disabled=i,n.disabled||(a?(R=d.value,b=u.value):(U=c.value,y=g.value)),p.innerHTML="",v.innerHTML="";var r=e.createElement("span",{class:"wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-required wux-ui-3ds-lg"});r.setStyles({color:"#E87B00",display:"inline-block","font-weight":"bold"}),i?(r.inject(p),t&&(t.tabBar.buttonGroup.getButton(t.value[0]).icon={iconName:"required",fontIconFamily:WUXManagedFontIcons.Font3DS},t.tabBar.buttonGroup.getButton(t.value[0]).elements.button.getChildren()[0].getChildren()[0].setStyles({color:"#E87B00","font-weight":"bold"}))):t&&(t.tabBar.buttonGroup.getButton(t.value[0]).icon={iconName:"doc",fontIconFamily:WUXManagedFontIcons.Font3DS}),p.setStyle("display",""!==p.innerHTML?"":"none"),v.setStyle("display",""!==v.innerHTML?"":"none")},C=function(e){var t=new r({placeholder:w.createReview.namePlaceholder,value:e,selectAllOnFocus:!0,autoCommitFlag:!0});return t.elements.container.setStyles({width:"100%"}),t.elements.container.childNodes[0].setStyles({width:"100%"}),t._myInput.maxLength=100,t.addEventListener("change",f),t},D=function(e){var t=new o({nbRows:5,newLineMode:"shiftEnter",placeholder:w.createReview.descriptionPlaceholder,value:e,selectAllOnFocus:!0,autoCommitFlag:!0});return t.elements.container.setStyles({width:"100%"}),t.elements.container.childNodes[0].setStyles({width:"100%"}),t.addEventListener("change",f),t};_?(h=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(i)).setStyles({paddingTop:"10px"}):h=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection NoMarkupCreate"}).inject(i);var M=e.createElement("div").inject(h),x=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(M);x.setStyles({marginRight:"5px"}),(p=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(M)).setStyles({color:"#E87B00",display:"none","font-weight":"bold","font-style":"italic"}),x.innerHTML=w.createReview.nameLabel,"review"===s?(d=C(R)).inject(h):(c=C(U)).inject(h);var S=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(i),k=e.createElement("div").inject(S),E=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(k);if((v=e.createElement("p",{class:"DMUCreateMarkupPanelLabel"}).inject(k)).setStyles({color:"red",display:"none","font-weight":"normal","font-style":"italic"}),E.innerHTML=w.createReview.descriptionLabel,"review"===s?(u=D(b)).inject(S):(g=D(y)).inject(S),l&&l.getValidation()){var V=e.createElement("p",{class:"DMUCreateMarkupPanelLabel"}).inject(i);V.innerHTML=w.createReview.warningMessage,V.setStyles({color:"#e87b00","font-weight":"normal","font-style":"italic",margin:"0","margin-top":"10px"})}};if(W||N.length>1||l&&l.getCurrentSessionMarkup()){var f=e.createElement("div",{class:"DMUCreateReviewPanelMainDiv"});if(_){var C=e.createElement("div",{class:"DMUCreateReviewTab"}).inject(f);(t=new c({displayStyle:"strip"})).inject(C);var D=e.createElement("div",{class:"DMUCreateReviewPanelReviewTab"}),x=e.createElement("div",{class:"DMUCreateMarkupPanelReviewTab"});v(D,"review"),v(x,"markup"),t.add({label:w.createReview.labelReview,content:D,icon:{iconName:"review",fontIconFamily:WUXManagedFontIcons.Font3DS}}),t.add({label:w.createReview.labelMarkup,content:x,icon:{iconName:"markup-review",fontIconFamily:WUXManagedFontIcons.Font3DS}}),t.value=[0],t.tabBar.centeredFlag=!1}else v(f,"review");(n=new d({emphasize:"primary",label:w.createReview.createreviewButton,onClick:m})).getContent().addClassName("reviewCreationButton");var k=new d({label:w.createReview.cancelButton,onClick:function(){var e=i.giveEventsController({viewer:A});e&&e.fireEvent("onDMUMarkupCreationCancelled"),P.end()}});M=new s({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:w.createReview.panelTitle,resizableFlag:!0,immersiveFrame:T.getImmersiveFrame(),position:u.getTouchMode()?{my:"center bottom"}:void 0,buttons:{Ok:n,Cancel:k},width:400,content:f}),l&&l.getValidation()&&(n.emphasize="medium-attention",n.icon={iconName:"warning",fontIconFamily:WUXManagedFontIcons.font3DS}),M.addEventListener("close",function(){P.end()})}else m()})}i.setAuthoringFeatureTypes("Check"),i.setAuthoringFeatureTypes("Highlight"),this.beginExecute=function(){var e;if(S=i.getContextViewer({viewer:A})){var t=f.getPossibleRootContexts(S),n=[];for(e=0;e<t.length;e++){var a=S.getController().isFiltered(l.getNodeID(t[e].getLastElement(!0)));if(S.getApplicativeData&&S.getApplicativeData().getLoadedItfData&&S.getApplicativeData().getLoadedItfData().data.length){S.getApplicativeData().getLoadedItfData().data.forEach(function(e){n.push({rootID:e.isrID,type:"ISR"})});break}if(a.filterId)n.push({rootID:a.filterId,type:"ENOStrRefinementSpecification"});else if(""!==l.getNodeID(t[e].getLastElement(!0))){const i=l.getNodeID(t[e].getLastElement(!0));n.push({rootID:l.getNodeID(t[e].getLastElement(!0)),type:S.getController().getRootStats(i)&&"r2vsurvey"===S.getController().getRootStats(i).serviceId?"R2V_FeatureState":l.getNodeType(t[e].getLastElement(!0))})}}n.length?new Promise(function(e){var t=0;n.forEach(function(i){if("R2V_FeatureState"===i.type){H||(H=v.getLoadingContextController({context:S})),H.getLoadedR2VInformations().forEach(a=>{a.id===i.rootID&&(t++,N.push({labelItem:a.info[0]["ds6w:label"],iconItem:a.info[0].icon,valueItem:i.rootID,type:i.type}),t===n.length&&e())})}else S.getController().getAttributes({ids:[i.rootID],attributes:["ds6w:label","ds6wg:revision","type_icon_url","ds6w:type"],callbacks:{onComplete:function(n){var a,r,o,l;(t++,n[i.rootID]&&(r=n[i.rootID].type_icon_url,a=n[i.rootID]["ds6w:label"],l=n[i.rootID]["ds6w:type"],o=C.getParentType(n[i.rootID]["ds6w:type"])?C.getParentType(n[i.rootID]["ds6w:type"]):l,n[i.rootID]["ds6wg:revision"]&&(a+=" "+n[i.rootID]["ds6wg:revision"]),L.push(a),N.push({labelItem:a,iconItem:r,valueItem:i.rootID,type:o})),i)?"RepRef"===X(i.rootID)?q("errorShape"):e():q()},onFailure:function(){t++;[{type:"ENOStrRefinementSpecification",label:"Filter"},{type:"Document",label:"Document"},{type:"SIMItfSimulation",label:"Iterference Simulation"},{type:"PLMPIMMetricReference",label:"Iterference Metric"},{type:"DesignSight",label:"Physics Simulation"},{type:"Requirement",label:"Requirement"},{type:"Requirement Specification",label:"Requirement Specification"},{type:"R2V_FeatureState",label:"R2V_FeatureState"}].some(n=>{if(i.type===n.type)return L.push(n.label),N.push({labelItem:n.label+t,valueItem:i.rootID,type:i.type}),e(),!0})}}})})}).then(function(){J()}):J()}else P.end()};var z=this.endExecute;this.endExecute=function(){R=null,b=null,y=null,H=null,V&&(V.destroy(),V=null),N=[],L=[],x&&x.destroy(),M&&M.destroy(),x=M=null,I=void 0,R=b=y=void 0,z()}}})}),define("DS/DMUReviewPersistence/DMUAddHighlightCmd",["DS/ApplicationFrame/Command","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUCommentsController","DS/Selection/CSOManager","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r,o){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var l,s,d=this,c=e.frameWindow||this.getFrameWindow(),u=c.getViewer(),g=null,m=null;function p(){s||(s=new t),s.build({type:"error",autoHide:!0,message:o.createHighlight.errorMessage,body:c.getUIFrame()}),l&&l.fireEvent("onHighlightCreationFailed"),d.end()}this._createNewHighlight=function(e,t,i){var a=n.getReviewContext({viewer:c.getViewer()}).getValidation();e&&e.getParent()?(l=n.giveEventsController({viewer:u}),r.addHighlight({iCtxViewer:n.getContextViewer({viewer:u}),validation:a,markupRepRef:t,slide:e,onHighlightCreationCompleted:function(){d.end()},onHighlightCreationFailed:function(){p(),d.end()}})):(!1===i&&p(),d.end())},this.beginExecute=function(){var e,r=n.getReviewContext({viewer:c.getViewer()}).getValidation();if(r.getCurrentMarkup()){var l=null,s="ReviewMarkup"===r.getCurrentMarkup().getValType()?r.getCurrentMarkup():r.getCurrentMarkup().getRepRef(),u=i.giveDMUCommentsController({context:c});u?(e=a.get()).length&&"DMUComment"===e[0].pathElement.getLastElement().getDMUType()?((l=u.getDMUObjectFromPathElement(e[0].pathElement))&&l.getParent&&l.getParent()&&l.getParent().getMarkupOwner&&(s=l.getParent().getMarkupOwner()),d._createNewHighlight(l,s,!0)):((m=new t).build({body:c.getUIFrame(),type:"info",notificationType:"HelpNotification",message:o.createHighlight.selectHighlight}),g=a.onAdd(function(){(e=a.get()).length>0&&e.length&&"DMUComment"===e[0].pathElement.getLastElement().getDMUType()&&((l=u.getDMUObjectFromPathElement(e[0].pathElement))&&l.getParent&&l.getParent()&&l.getParent().getMarkupOwner&&(s=l.getParent().getMarkupOwner()),d._createNewHighlight(l,s,!0))})):(l=s.getMarkupContent().getSlides().length>0?s.getMarkupContent().getCurrentSlide():null,d._createNewHighlight(l,s,!1))}else p(),d.end()},this.cancelExecute=function(){this.end()},this.endExecute=function(){a.unsubscribe(g),m&&m.destroy()}}})}),define("DS/DMUReviewPersistence/DMUReviewDeleteCmd",["DS/ApplicationFrame/Command","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var o,l=this,s=e.frameWindow||this.getFrameWindow(),d=s.getViewer();function c(){o||(o=new t),o.build({type:"error",autoHide:!0,message:r.createCheck.errorMessage,body:s.getUIFrame()});var e=n.giveEventsController({viewer:d});e&&e.fireEvent("onCheckDeletionFailed"),l.end()}this.beginExecute=function(){var e=i.get(),t=n.getContextViewer({viewer:d}),r=e[0].pathElement.getLastElement().getOwner(),o=r.getPlmID(),s=r.getType();a.deleteObject({ctxViewer:t,objectId:o,type:s,onSaveFailed:c}),l.end()}}})});