define("DS/DELWebPPRController/columnviews/BuildUp",["DS/DELWebComponentManager/DELWebComponentManager","i18n!DS/DELWebPPRController/assets/nls/DELWebPPR.json","css!DS/DELWebPPRController/assets/css/PPR2DStructure.css"],function(e,t){"use strict";return{dataIndex:"buildUp",sortableFlag:!1,editableFlag:!0,isDraggable:!1,isExportable:!1,groupableFlag:!1,displayType:"BuildUp",editionPolicy:"EditionInPlace",typeRepresentation:"functionIcon",alignment:"center",visibleFlag:!0,disabled:!0,width:30,height:"40px",pinned:"right",getCellTooltip:function(e,n){var o=n.nodeModel;return-1===n.rowID?{shortHelp:t.get("PROCESS.BuildUp.description"),updateModel:!1}:o.getAttributeValue("buildUp")===o.ENUM_BUILDUP.LOADING?{shortHelp:t.get("PROCESS.BuildUp.Loading.description"),updateModel:!1}:{shortHelp:"",updateModel:!1}},getCellClassName:function(e,t){var n="";return 0===t.rowID&&(n="del-buildup"),n},getCellSemantics:function(t,n){var o=n.nodeModel,i={};switch(o.getAttributeValue("buildUp")){case o.ENUM_BUILDUP.ACTIVATE:i.icon=e.getComponent("Utils").getAssetsUrl("DELWebPPRController","icons/22/I_DELProductBuildUp_ON.png");break;case o.ENUM_BUILDUP.DEACTIVATE:i.icon=e.getComponent("Utils").getAssetsUrl("DELWebPPRController","icons/22/I_DELProductBuildUp_OFF.png");break;case o.ENUM_BUILDUP.LOADING:i.icon={iconName:"reload wux-ui-3ds-spin",fontIconFamily:1}}return i}}}),define("DS/DELWebPPRController/ProcessToolbarConfig",["DS/DELWebComponentManager/DELWebComponentManager","i18n!DS/DELWebPPRController/assets/nls/DELWebPPR.json"],function(e,t){"use strict";return{getToolbarDefination:function(n){let o={entries:[{id:"PERTView",dataElements:{typeRepresentation:"PERTview",value:!1,onNodeUpdate:{module:"DS/DELWebPPRController/ToolbarHandler",func:"onNodeUpdate",argument:{identifier:"PERTView"}},position:"far",category:"1"}},{id:"SwitchMode",dataElements:{typeRepresentation:"switchMode",value:!UWA.is(n.SwitchMode)||n.SwitchMode,onNodeUpdate:{module:"DS/DELWebPPRController/ToolbarHandler",func:"onNodeUpdate",argument:{identifier:"SwitchMode"}},disabled:!0,position:"far",category:"2"}},{id:"GraphicSelector",dataElements:{typeRepresentation:"graphicSelector",value:UWA.is(n.GraphicSelector)?n.GraphicSelector:"showMfgItemGraphics",onNodeUpdate:{module:"DS/DELWebPPRController/ToolbarHandler",func:"onNodeUpdate",argument:{identifier:"GraphicSelector"}},readOnly:!1,position:"far",category:"3"}}],typeRepresentations:{graphicSelector:{stdTemplate:"editSelector",semantics:{possibleValues:[{value:"showMfgItemGraphics",icon:{iconPath:e.getComponent("Utils").getAssetsUrl("DELWebPPRController","icons/32/I_DELShowMfgItemGraphics.png")},description:t.get("Toolbar.ShowMfgItem.ToolTip")},{value:"showResourceGraphics",icon:{iconPath:e.getComponent("Utils").getAssetsUrl("DELWebPPRController","icons/32/I_DELShowResourceGraphics.png")},description:t.get("Toolbar.ShowResource.ToolTip")}]}},switchMode:{stdTemplate:"toggleIcon",semantics:{possibleValues:[{value:"true",icon:{iconPath:e.getComponent("Utils").getAssetsUrl("DELWebPPRController","icons/22/I_DELSwitchToProductBuildUp.png")},tooltip:{shortHelp:t.get("Toolbar.SwitchToProductBuildUp.ToolTip.shortHelp")}},{value:"false",icon:{iconPath:e.getComponent("Utils").getAssetsUrl("DELWebPPRController","icons/22/I_DELSwitchToWKIView.png")},tooltip:{shortHelp:t.get("Toolbar.SwitchToWKIView.ToolTip.shortHelp")}}]}},PERTview:{stdTemplate:"toggleIcon",semantics:{possibleValues:[{value:"true",icon:{iconPath:e.getComponent("Utils").getAssetsUrl("DELWebPPRController","icons/32/I_DEL_ProductFlow.png"),className:"del-toolbarcommand-active"},tooltip:{shortHelp:t.get("Toolbar.PERTView.ToolTip")}},{value:"false",icon:{iconPath:e.getComponent("Utils").getAssetsUrl("DELWebPPRController","icons/32/I_DEL_ProductFlow.png")},tooltip:{shortHelp:t.get("Toolbar.PERTView.ToolTip")}}]}}}};return JSON.stringify(o)}}}),define("DS/DELWebPPRController/ToolbarHandler",["DS/DELWebComponentManager/DELWebComponentManager"],function(e){"use strict";let t={onNodeUpdate:function(t){let n,o=t.context.nodeModel,i=o.getAttributeValue("data");!0!==o.options.disabled&&(n={data:{previousValue:o.previousValue,value:i},origin:"DELWebPPRToolbar"},e.getComponent("ModelEvents").publish({event:`on${t.identifier}Change`,data:n}),i!==o.previousValue&&(o.previousValue=i))}};return t}),define("DS/DELWebPPRController/ToolbarController",["UWA/Class","DS/DELWebComponentManager/DELWebComponentManager","css!DS/DELWebPPRController/assets/css/toolbar.css"],function(e,t){"use strict";return e.extend({init:function(){this._eventTokens=[],this.toolbar=null,this._parent()},_subscribeEvents:function(e){let n=t.getComponent("ModelEvents");e&&e.forEach(e=>{this._eventTokens.push(n.subscribe(e.eventName,e.callback))})},_unsubscribeEvents:function(){let e=t.getComponent("ModelEvents");this._eventTokens.forEach(t=>{e.unsubscribe(t)}),this._eventTokens=[]},buildToolbar:function(e,n,o){this._subscribeEvents(o),this.toolbar=t.getComponent(e).setToolbar(n)},getValue:function(e){let t,n=this.toolbar.getNodeModelByID(e);return n&&(t=n.getAttributeValue("data")),t},isEnabled:function(e){let t=!1,n=this.toolbar.getNodeModelByID(e);return n&&(t=!n.options.disabled),t},destroyToolbar:function(){this._unsubscribeEvents(),this.toolbar&&(this.toolbar.destroy(),this.toolbar=null)}})}),define("DS/DELWebPPRController/columnviews/PositionMatrix",["DS/Handlebars/Handlebars","text!DS/DELWebPPRController/assets/templates/positionMatrixTooltip.html","i18n!DS/DELWebPPRController/assets/nls/DELWebPPR.json","css!DS/DELWebPPRController/assets/css/positionmatrix.css"],function(e,t,n){"use strict";var o=e.compile(t);return{editableFlag:!0,typeRepresentation:"functionIcon",alignment:"center",getCellSemantics:function(e,t){return{icon:t.nodeModel.options.grid[e]?{iconName:"part-position wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"}:""}},getCellTooltip:function(e,t){var i,r,a,l,s,c,u;return-1===t.rowID?i={shortHelp:n.get("PositionMatrix.description"),updateModel:!1}:t&&t.nodeModel&&t.nodeModel.options&&t.nodeModel.options.grid&&t.nodeModel.options.grid[e]&&(r=(a=t.nodeModel.options.grid[e])?(l=6,c=a.split(","),u={className:s,x1:Number(c[0]).toFixed(l).toString(10).substring(0,l+3),x2:Number(c[1]).toFixed(l).toString(10).substring(0,l+3),x3:Number(c[2]).toFixed(l).toString(10).substring(0,l+3),y1:Number(c[3]).toFixed(l).toString(10).substring(0,l+3),y2:Number(c[4]).toFixed(l).toString(10).substring(0,l+3),y3:Number(c[5]).toFixed(l).toString(10).substring(0,l+3),z1:Number(c[6]).toFixed(l).toString(10).substring(0,l+3),z2:Number(c[7]).toFixed(l).toString(10).substring(0,l+3),z3:Number(c[8]).toFixed(l).toString(10).substring(0,l+3),t1:Number(c[9]).toFixed(l).toString(10).substring(0,l+3),t2:Number(c[10]).toFixed(l).toString(10).substring(0,l+3),t3:Number(c[11]).toFixed(l).toString(10).substring(0,l+3)},o(u)):"<span>"+a+"</span>",i={title:n.get("PositionMatrix.Title"),shortHelp:r,allowUnsafeHTMLShortHelp:!0,wrapThreshold:315,updateModel:!1}),i},width:"100px",height:"40px"}}),define("DS/DELWebPPRController/DELWebPPRModel",["UWA/Core","DS/DELWebComponentManager/DELWebComponentManager","DS/DELWebComponentManager/DELWebTypesUtil","text!DS/DELWebPPRController/assets/json/ProcessExpandConfig.json"],function(e,t,n,o){"use strict";return function(){var i="resourceid",r="ds6w:label",a="ds6w:status",l="ds6w:type",s="icon",c="Path",u="ds6w:globalType",d="ds6w:Instance",g="VPMRepInstance",p="IPML.IconName",f=JSON.parse(o),m=null,h=function(){return t.getComponent("Utils").get3DSpaceUrl()},b=function(e,t,n){var o=n.split(".");"reference"===o[1]?e.push(o[0]):"instance"===o[1]&&t.push(o[0])},P=function(t,o){var f={references:{},instances:{},paths:[]},P=[],C=[],E=o.ColumnConfig,S=!(!o.pprType||o.pprType!==n.PPRTYPES.RESOURCE);return E.Label&&b(C,P,E.Label.dataIndex),e.is(E.Columns,"array")&&E.Columns.forEach(function(e){b(C,P,e.dataIndex)}),e.is(t,"array")&&t.forEach(e=>{e[c]?f.paths.push(e[c]):e[u]===d||e[l]===g?(f.instances[e[i]]={instanceId:e[i],grid:{}},P.forEach(t=>{f.instances[e[i]].grid[t+".instance"]=e[t]?e[t]:""})):(f.references[e[i]]={referenceId:e[i],label:e[r],grid:{hideShow3D:1},type:e[l],icons:S?[function(e){return null===m&&(m=h()+"/snresources/images/icons/small/"),e?m+e+".png":""}(e[p])]:[e[s]]},C.forEach(function(t){f.references[e[i]].grid[t+".reference"]=t===a?e[t]?e[t].split(".")[1]:"":e[t]}))}),f},C=function(n){return new e.Promise(function(o,i){let r=t.getComponent("Utils");r.markStart("v2Expand"),r.executeRequestPromise(h()+"/cvservlet/progressiveexpand/v2?output_format=cvjson",{method:"POST",payload:n}).then(function(t){t&&e.is(t.errors,"array")&&t.errors.length>0?i(t.errors):(r.markEnd("v2Expand","V2 Expand completed in"),o(t))}).fail(function(e){i(e)})})};return{getProcessExpandData:function(n){var o,i=t.getComponent("Utils");return n&&n.id?(i.markStart("processExpand"),o=new e.Promise(function(o,r){i.executeRequestPromise(h()+"/resources/v1/modeler/dsprcs/invoke/dsprcs:expand",{method:"POST",payload:function(n){var o,i=f.payload,r=f.references,a=f.instances;return i.id=n.id?n.id:"",e.is(n.ColumnConfig)&&(n.ColumnConfig.Label&&r.forEach(function(e){b(i.dynamicMask["dsprcs:"+e],[],n.ColumnConfig.Label.dataIndex)}),e.is(n.ColumnConfig.Columns,"array")&&n.ColumnConfig.Columns.forEach(function(e){r.forEach(function(t){b(i.dynamicMask["dsprcs:"+t],[],e.dataIndex)}),a.forEach(function(t){b([],i.dynamicMask["dsprcs:"+t],e.dataIndex)})})),n.filter&&(i.config_filter=t.getComponent("Utils").getValue(n.filter,"config_filter"),(o=t.getComponent("Utils").getValue(n.filter,"config_filter_id"))&&(i.config_filter_id=o.physical_id)),n.mfgItemId&&(i.parameters.mfgItemId=n.mfgItemId),i}(n)}).then(function(e){i.markEnd("processExpand","Advanced process expand completed in"),o(e)}).fail(r)})):o=e.Promise.reject("Invalid Input Provided"),o},getExpandData:function(n){var o,i=t.getComponent("Utils");return n&&n.id?(i.markStart("pprV2Expand"),o=new e.Promise(function(t,o){C(function(t){var n={batch:{expands:[{label:"PPRExpand",root:{physical_id:t.id},filter:function(){let n=[],o=[],i=function(t){let n;t&&t.length>0&&(n=e.is(t[0],"string")?[t]:t,o=o.concat(n.map(e=>({physical_id_path:e}))))};return(t=t||{}).filter&&n.push(t.filter),i(t.pathFilter),i(t.predecessors),o.length>0&&n.push({prefix_filter:{prefix_path:o}}),0===n.length&&n.push({all:1}),{and:{filters:n}}}()}]},outputs:{select_object:["physicalid","ds6w:type","ds6w:globalType","IPML.IconName"],select_relation:["physicalid","ds6w:type","ds6w:globalType"],format:"entity_relation_occurrence",hits:{predefined_computation:["icons"]}}};return t.ColumnConfig&&(t.ColumnConfig.Label&&b(n.outputs.select_object,n.outputs.select_relation,t.ColumnConfig.Label.dataIndex),e.is(t.ColumnConfig.Columns,"array")&&t.ColumnConfig.Columns.forEach(function(e){b(n.outputs.select_object,n.outputs.select_relation,e.dataIndex)})),t.model&&Object.keys(t.model).forEach(function(e){t.model[e]&&(n.batch.expands[0][e]=t.model[e])}),n}(n)).then(function(e){t(P(e.results,n)),i.markEnd("pprV2Expand","PPR Model expand completed in")}).fail(o)})):o=e.Promise.reject("Invalid Input Provided"),o}}}}),define("DS/DELWebPPRController/columnviews/Responsible",["i18n!DS/DELWebPPRController/assets/nls/DELWebPPR.json"],function(e){"use strict";return{kind:"user",minWidth:200,height:"40px",editableFlag:!1,typeRepresentation:"user",customisation:{exportable:{lock:!1,value:!0}},getCellTooltip:function(t,n){let o;return-1===n.rowID?o={shortHelp:e.get("Owner.description"),updateModel:!1}:n&&n.nodeModel&&n.nodeModel.options&&n.nodeModel.options.grid&&n.nodeModel.options.grid[t]&&(o={shortHelp:n.nodeModel.getReferenceValue(t)}),o},getCellValue:function(e,t){if(t&&t.nodeModel&&t.nodeModel.options&&t.nodeModel.options.grid&&t.nodeModel.options.grid[e]){return{icon:{iconName:"topbar-user",fontIconFamily:1},label:t.nodeModel?t.nodeModel.options.grid[e]:""}}return""},getCellValueForExport:function(e,t){return t&&t.nodeModel?t.nodeModel.options.grid[e]:""}}}),define("DS/DELWebPPRController/DELWebPPRItemModel",["UWA/Core","UWA/Class","DS/Tree/TreeDocument","DS/DELWebPPRNavigator/DELWebPPRNode","DS/DELWebComponentManager/DELWebComponentManager"],function(e,t,n,o,i){"use strict";return t.extend({init:function(){var e=this;this._model=new n,this._model.onPostExpand(function(t){var n=t.data.nodeModel;n&&(e._computePreSelect(e._getNodes(n,"isPreSelected"),!0),e._computeHighlight(e._getNodes(n,"isHighlighted"),!0))}),this._model.onPostCollapse(function(t){var n=t.data.nodeModel;n&&(e._computePreSelect(e._getNodes(n,"isPreSelected"),!0),e._computeHighlight(e._getNodes(n,"isHighlighted"),!0))})},_getNodes:function(e,t){return e.search({match:function(e){if(e.nodeModel.getAttributeValue(t))return!0}})},_getBadgeOptions:function(){return{bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}}},_createRoot:function(e,t,n){var i;return e&&t&&(i=new o(t[e])).updateOptions({badges:n?this._getBadgeOptions():null,filter:n}),i},_getNode:function(t,n,o){var i,r,a=[],l=null;if(t)for(a.push(t);a.length>0;){if(!(n!==(i=a.pop()).getReferenceId()||o&&o!==i.getInstanceId())){l=i;break}if(!(e.is(n)||o&&o!==i.getInstanceId())){l=i;break}r=i.getChildren(!0),Array.isArray(r)&&a.push(...r)}return l},_getChildNode:function(e,t,n){let o,i;return e&&(i=e.getChildren())&&(o=i.find(function(e){return t===e.getReferenceId()&&(!n||n===e.getInstanceId())})),o},_createTree:function(t,n,r){var a=this,l=i.getComponent("Utils"),s=function(i){var r,l=t;for(let t=2,s=i.length;t<s;t+=2){let s=i[t],c=i[t-1],u=a._getChildNode(l,s,c);u?l=u:(r=new o(e.clone(e.extend(n.references[s],n.instances[c],!0))),l.addChild(r),l=r)}};n&&Array.isArray(n.paths)&&n.references&&n.instances&&l.processInChunk(n.paths,200,200,function(e,t){e.forEach(s),t&&r()})},getNodeFromPath:function(t){var n,o,i=this._model.getRoots();return e.is(t,"array")&&t.length>0&&i.length>0&&(n=i.find(function(e){return e&&e.options.referenceId===t[0]}),t.forEach((e,i)=>{if(i>0&&i%2==0){if(!(o=this._getNode(n,e,t[i-1])))return;n=o}})),n},_computePreSelect:function(e,t){e.forEach(function(e){for(var n=e,o=t;n;)n.isVisible()?(o!==n.isPreSelected()&&(o?n.preSelect():n.unPreSelect()),n.isRoot()?n=null:(n=n.getParent(),o&&(o=!o))):(!o&&n.isPreSelected()&&n.unPreSelect(),n=n.getParent())})},_computeHighlight:function(e,t){e.forEach(function(e){for(var n=e,o=t;n;)n.isVisible()?(o!==n.isHighlighted()&&(o?n.highlight():n.unhighlight()),n.isRoot()?n=null:(n=n.getParent(),o&&(o=!o))):(!o&&n.isHighlighted()&&n.unhighlight(),n=n.getParent())})},_getParentNodes:function(e){var t,n=[];if(e)for(t=e;t;)n.unshift(t),t=t.isRoot()?null:t.getParent();return n},loadData:function(e){var t,n=this;e&&(t=this._createRoot(e.id,e.references,e.filter),this._model.prepareUpdate(),this._model.addRoot(t),this._createTree(t,e,function(){n._model.pushUpdate(),e.onComplete()}))},getModel:function(){return this._model},getSelectedPaths:function(){return this._model.getSelectedNodes().map(function(e){return e.getRirPath()})},preSelect:function(e,t){var n=this.getNodeFromPath(e);n&&(t?n.setAttribute("isPreSelected",!0):n.removeAttribute("isPreSelected"),this._computePreSelect([n],t))},getPathFromId:function(e,t){var n=this._getNode(this._model.getRoots()?this._model.getRoots()[0]:{},e,t);return n?n.getRirPath():[]},getNodeFromID:function(e,t){return this._getNode(this._model.getRoots()?this._model.getRoots()[0]:{},e,t)},highlight:function(e,t){var n=this.getNodeFromPath(e);n&&(t?n.setAttribute("isHighlighted",!0):n.removeAttribute("isHighlighted"),this._computeHighlight([n],t))},empty:function(){this._model.empty()}})}),define("DS/DELWebPPRController/columnviews/ConfigurationColumns",[],function(){"use strict";const e="string",t="configLoading";return{Effectivity:{dataIndex:"Effectivity",width:"auto",minWidth:"100",visibleFlag:!1,sortableFlag:!1,groupableFlag:!1,editionPolicy:"EditionOnClick",editableFlag:!1},VariantEffectivity:{dataIndex:"VariantEffectivity",width:"auto",minWidth:"200",visibleFlag:!1,sortableFlag:!1,groupableFlag:!1,editionPolicy:"EditionOnClick",editableFlag:!1},EvolutionEffectivity:{dataIndex:"EvolutionEffectivity",width:"auto",minWidth:"200",visibleFlag:!1,sortableFlag:!1,groupableFlag:!1,editionPolicy:"EditionOnClick",editableFlag:!1},CurrentEvolutionEffectivity:{dataIndex:"CurrentEvolutionEffectivity",width:"auto",minWidth:"200",visibleFlag:!1,sortableFlag:!1,groupableFlag:!1,editionPolicy:"EditionOnClick",editableFlag:!1},ProjectedEvolutionEffectivity:{dataIndex:"ProjectedEvolutionEffectivity",width:"auto",minWidth:"200",visibleFlag:!1,sortableFlag:!1,groupableFlag:!1,editionPolicy:"EditionOnClick",editableFlag:!1},ConfigurationContext:{dataIndex:"ConfigurationContext",width:"auto",minWidth:"150",visibleFlag:!1,sortableFlag:!1,groupableFlag:!1,editionPolicy:"EditionOnClick",editableFlag:!1},getCellTypeRepresentation:function(n){var o,i=t;return UWA.owns(n,"nodeModel")&&(o=n.nodeModel,UWA.is(o)&&(i=UWA.is(n.cellModel,"string")&&0===n.cellModel.length?!!UWA.is(o.options.areCfgColumnsFilled,"boolean")&&o.options.areCfgColumnsFilled?e:t:e)),i},hasCellValue:function(){return!0},getCellValue:function(e,t){var n,o=null;return UWA.owns(t,"nodeModel")&&(n=t.nodeModel.options.grid[e],o=UWA.is(n,"string")?n.trim():n),UWA.is(o)?o:""}}}),define("DS/DELWebPPRController/DELWebDictionaryService",["DS/Logger/Logger","DS/DELWebComponentManager/DELWebComponentManager"],function(e,t){"use strict";return function(){var n=e.getLogger("DELWebDictionaryService"),o={attributes:[],dimenstions:[]};const i={initialize:function(e){var i=t.getComponent("Utils");return new UWA.Promise((t,n)=>{e&&e.length>0?i.executeRequestPromise(`${i.get3DSpaceUrl()}/resources/dictionary/properties`,{method:"POST",payload:e}).then(t).catch(n):n("No attributes found")}).then(function(e){return o.attributes=e,e}).then(function(e){var t=[];return e&&e.length>0&&e.forEach(e=>{e&&e.info&&e.info.forEach(e=>{let n=e?e.Magnitude:null;n&&function(e){t.includes(e)||t.push(e)}(n)})}),t}).then(function(e){let t=UWA.Promise.resolve();return e&&e.length>0&&(t=i.executeRequestPromise(`${i.get3DSpaceUrl()}/resources/dictionary/dimensions?${function(e){return`$filter=dimensionName+eq+${e.join(",")}`}(e)}`,{method:"GET"})),t}).then(function(e){o.dimensions=e?e.results:[]}).fail(e=>{n.debug(e),n.error("Failed to fetch dictionary attributes/dimension due to ",e.toString())})},getAttributes:function(){var e=o&&o.attributes?o.attributes:[];return 0===e.length&&n.warn("Initialize dictionary service before user/attributes not found"),e},getAttributeInfo:function(e,t){let n,o=i.getAttributes().find(t=>t.type===e);return o&&o.info&&(n=o.info.find(e=>e.Name===t)),n},getAuthorizedValues:function(e){let t=[];return e&&"Yes"===e.HasRangeDefined&&(t=e.AuthorizedValues),t},getDimension:function(e){var t;return o&&o.dimensions&&(t=o.dimensions.find(t=>t.Name===e)),t},getUnit:function(e,t){let n,o=i.getDimension(e);return o&&(t=t||o.MKSUnit,n=o.Units?o.Units.find(e=>e.Name===t):null),n},empty:function(){o={attributes:[],dimensions:[]}}};return i}}),define("DS/DELWebPPRController/DELWebPPRProcessModel",["UWA/Core","DS/Tree/TreeDocument","DS/DELWebPPRNavigator/DELWebPPRNode","DS/Logger/Logger","DS/DELWebPPRController/DELWebPPRItemModel","text!DS/DELWebPPRController/assets/json/ProcessExpandConfig.json"],function(e,t,n,o,i,r){"use strict";var a=JSON.parse(r),l=a.ENUMS,s=a.occurrences,c=a.references,u=a.instances,d=a.buildUpNotRequiredForTypes;return i.extend({init:function(){this._parent(),this._logger=o.getLogger("DELWebPPRProcessModel")},_createProcessTree:function(t){var o,i,r=[],a=[],{response:g,filter:p}=t||{},f=g.member[0],m=e.is(t.installPath,"array")&&t.installPath.length>0?t.installPath:null,h=m?m[m.length-1]:"",b=m?m.slice(0,-1):[],P=function(e){return m&&Array.isArray(e)&&e.length>0&&h===e[0]&&(e=b.concat(e)),e},C=function(e){var t=e.id?e.id:"",n={grid:{buildUp:-1===d.indexOf(e[l.Type])?0:""},referenceId:t,label:e[l.Title]?e[l.Title]:"",type:e[l.Type]?e[l.Type]:"",icons:e[l.Icon]?[e[l.Icon]]:[]};return Object.keys(e).forEach(t=>{-1!==r.indexOf(t)&&(n.grid[t+".reference"]=e[t])}),function(e,t){t.consumedMfgItems=[],t.consumedCapableResource=[],e[l.ItemSpecification]&&e[l.ItemSpecification].totalItems>0&&e[l.ItemSpecification].member.forEach(function(e){t.consumedMfgItems.push(P([e.itemRef]))}),e[l.CapableResources]&&e[l.CapableResources].totalItems>0&&e[l.CapableResources].member.forEach(function(e){t.consumedCapableResource.push(e.resource?e.resource:"")}),e[l.PrimaryCapableResource]&&e[l.PrimaryCapableResource].totalItems>0&&e[l.PrimaryCapableResource].member.forEach(function(e){t.consumedCapableResource.push(e.resource?e.resource:"")}),e[l.SecondaryCapableResource]&&e[l.SecondaryCapableResource].totalItems>0&&e[l.SecondaryCapableResource].member.forEach(function(e){t.consumedCapableResource.push(e.resource?e.resource:"")})}(e,n),n},E=function(t){var n={path:t.id?t.id.split("/"):[],grid:{}};return u.forEach(function(o){t[l[o]]&&e.extend(n,function(e){var t={grid:{},instanceId:e.id};return Object.keys(e).forEach(n=>{-1!==a.indexOf(n)&&(t.grid[n+".instance"]=e[n])}),t}(t[l[o]]),!0)}),c.forEach(function(o){t[l[o]]&&e.extend(n,C(t[l[o]]),!0)}),t[l.ItemSpecificationOcc]&&t[l.ItemSpecificationOcc].totalItems>0&&(n.consumedMfgItems=[],t[l.ItemSpecificationOcc].member.forEach(function(e){n.consumedMfgItems.push(P(e.itemOcc))})),n},S=function(e,t,n){var o=n.split(".");"reference"===o[1]?e.push(o[0]):"instance"===o[1]&&t.push(o[0])},v=t&&t.compOptions?t.compOptions:null;e.is(v)&&(v.ColumnConfig.Label&&S(r,a,v.ColumnConfig.Label.dataIndex),e.is(v.ColumnConfig.Columns,"array")&&v.ColumnConfig.Columns.forEach(function(e){S(r,a,e.dataIndex)})),f?((o=C(f)).grid.buildUp=-1,i=new n(e.merge(o,{badges:p?this._getBadgeOptions({filter:p}):null})),this._model.addRoot(i),this._model.prepareUpdate(),function e(t,o){var i=function(o){var i=E(o),r=new n(i);t.addChild(r),e(r,o)};o[l.MfgProcess]&&o[l.MfgProcess][l.MfgOperationOcc]&&o[l.MfgProcess][l.MfgOperationOcc].totalItems>0&&o[l.MfgProcess][l.MfgOperationOcc][l.Member].forEach(e=>{i(e)}),s.forEach(function(e){o[l[e]]&&o[l[e]].totalItems>0&&o[l[e]][l.Member].forEach(e=>{i(e)})})}(i,f),this._model.pushUpdate()):this._logger.error("Process data not found")},loadData:function(e){this._createProcessTree(e)}})}),define("DS/DELWebPPRController/DELWebCfgColumnManager",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/Logger/Logger","DS/DELWebPPRController/columnviews/ConfigurationColumns"],function(e,t,n,o,i){"use strict";return t.extend({checkCfgColumnsAvailability:function(){const e=["DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns","DS/CfgWebAppEffectivityUX/scripts/CfgConfigurationContextColumn"];var t=this;return t._additionalColumnsAMD=[],new n(function(o,i){require(e,function(){var e=[];Array.prototype.slice.call(arguments).forEach(o=>{e.push(new n(function(e){o.isAdditionalColumnsAvailable(function(n){!0===n&&t._additionalColumnsAMD.push(o),e()})}))}),n.all(e).then(o).fail(i)})})},updateAttributes:function(t){var i=this,r=[],a=t.collectionView,l=[],s={pids:[],relids:[],pairs:{}},c=[];this._treeDocument=a.getTreeDocument(),e.is(this._additionalColumnsAMD,"array")&&this._additionalColumnsAMD.length>0&&this._areCfgColumnsVisible(a)&&t.startNodeIndex>=0&&t.endNodeIndex>=0&&e.is(a.model,"array")&&(r=a.model.slice(t.startNodeIndex,t.endNodeIndex+1)).length>0&&(l=r.filter(t=>!(e.is(t.options.areCfgColumnsFilled,"boolean")&&t.options.areCfgColumnsFilled))).length>0&&(this._updateCfgColumnsFilledFlag(l,!1),l.forEach(e=>{e.getReferenceId()&&-1===s.pids.indexOf(e.getReferenceId())&&s.pids.push(e.getReferenceId()),e.getInstanceId()&&s.relids.push(e.getInstanceId())}),this._additionalColumnsAMD.forEach(t=>{c.push(new n(function(n){t.updateAttributes(s,function(t){var o=e.is(t,"string")?JSON.parse(t):t;n(o)})}))}),n.all(c).then(function(t){var n=t.reduce((t,n)=>e.extend(t,n,!0),{});i._updateCfgColAttributes(n,l),i._updateCfgColumnsFilledFlag(l,!0)}).fail(function(e){o.error("Failed to get configuration columns info : ",e)}))},getCfgColumnsConfig:function(){var e=[],t={};return this._additionalColumnsAMD.forEach(t=>{e.push(...t.getManagedColumnNames())}),e.forEach(e=>{i[e]&&(t[e]=i[e],t[e].getCellTypeRepresentation=i.getCellTypeRepresentation,t[e].hasCellValue=i.hasCellValue,t[e].getCellValue=i.getCellValue)}),t},_areCfgColumnsVisible:function(e){var t=[];return this._additionalColumnsAMD.forEach(e=>{t.push(...e.getManagedColumnNames())}),t.some(function(t){return e.getColumnOrGroup(t)&&!0===e.getColumnOrGroup(t).visibleFlag})},_updateCfgColumnsFilledFlag:function(e,t){if(this._treeDocument){this._treeDocument.prepareUpdate();for(let n of e)n.updateOptions({areCfgColumnsFilled:t});this._treeDocument.pushUpdate()}},_updateCfgColAttributes:function(t,n){var o=this,i=function(e){o._treeDocument&&(o._treeDocument.prepareUpdate(),Object.keys(e).forEach(t=>{(function(e){return n.filter(t=>((e,t)=>e===t.getReferenceId())(e,t)||((e,t)=>!t.isRoot()&&e===t.getInstanceId())(e,t))})(t).forEach(n=>{n.updateOptions({grid:e[t]})})}),o._treeDocument.pushUpdate())};e.is(t.pids,"object")&&i(t.pids),e.is(t.relids,"object")&&i(t.relids)}})}),define("DS/DELWebPPRController/ProcessToolbarController",["DS/DELWebComponentManager/DELWebTypesUtil","DS/DELWebComponentManager/DELWebComponentManager","DS/DELWebPPRController/ToolbarController","DS/DELWebPPRController/ProcessToolbarConfig","DS/DELWebCommonControls/DELWebPanel","DS/ApplicationFrame/FrameWindowsManager","DS/DELPPWProductFlowFacet/facets/ProductFlowSequenceFacet","i18n!DS/DELWebPPRController/assets/nls/DELWebPPR.json"],(e,t,n,o,i,r,a,l)=>{"use strict";const s="defaultViewerMode",c="roots",u="PERTView",d="SwitchMode",g="GraphicSelector",p="WorkInstructions",f="showResourceGraphics",m="showMfgItemGraphics",h="ProcessToolbarControlle",b="loadData",P="setMode",C="onHide",E="onShow",S="onReframe",v="notifyRootVisibilityChange",D={true:"WorkInstructions",false:"BuildUp"};return n.extend({init:function(n){let o=this,s=function(e){return e&&e.origin!==name&&UWA.is(e.data)},p=function(){let t=n.getPPRPanels(),i=function(n){if(t[e.PPRTYPES.MBOM].visibleFlag||t[e.PPRTYPES.MBOM].show(),t[e.PPRTYPES.RESOURCE].visibleFlag||t[e.PPRTYPES.RESOURCE].show(),UWA.is(n,"boolean")){let o=t[e.PPRTYPES.MBOM].immersiveFrame.getDockingElement(t[e.PPRTYPES.MBOM].currentDockArea);o&&(o.collapseDockingZoneFlag=n)}};o.isEnabled(d)?!0===o.getValue(d)?(t[e.PPRTYPES.MBOM].hide(),t[e.PPRTYPES.RESOURCE].hide()):i(!0):i()},R=function(e,t){s(t)&&(o.toolbar.prepareUpdateView(),o.toolbar.updateNodeModel(g,{disabled:e}),o.toolbar.updateNodeModel(d,{disabled:!e}),o.toolbar.pushUpdateView(),p())};this._eventHandlers=[{eventName:{event:"activateBuildup"},callback:R.bind(this,!0)},{eventName:{event:"deactivateBuildup"},callback:R.bind(this,!1)},{eventName:{event:"onGraphicSelectorChange"},callback:function(n){var o=t.getComponent(e.PPRTYPES.RESOURCE),i=t.getComponent(e.PPRTYPES.MBOM),r=t.getComponent("ModelEvents"),a=function(e,t){let n={data:{id:e,visibility:t},origin:h};r.publish({event:v,data:n})},l=function(e){let t={data:{path:[e]},origin:h};r.publish({event:C,data:t}),a(e,!1)},c=function(e){let t={data:{path:[e]},origin:h};r.publish({event:E,data:t}),a(e,!0),r.publish({event:S,data:t})};if(s(n)&&o&&i){let e=n.data.value;e===f?(i.getRootsInfo().forEach(e=>{l(e.id)}),o.getRootsInfo().forEach(e=>{(t.getComponent("Viewer").getVisualizedRoots()||[]).find(t=>t.id===e.id)||function(e){let t={data:{id:e.id},origin:h};r.publish({event:b,data:t})}(e),c(e.id)})):e===m&&(o.getRootsInfo().forEach(e=>{l(e.id)}),i.getRootsInfo().forEach(e=>{c(e.id)}))}}},{eventName:{event:"onSwitchModeChange"},callback:function(e){let n=t.getComponent("ModelEvents");if(s(e)&&e.data.value!==e.data.previousValue){let t={data:{mode:D[e.data.value]},origin:h};p(),n.publish({event:P,data:t})}}},{eventName:{event:"onPERTViewChange"},callback:function(d){let g,p=n.getPPRPanels();if(s(d))if((g=p[e.PPRTYPES.PROCESS].immersiveFrame.getDockingElement(p[e.PPRTYPES.PROCESS].currentDockArea))&&(g.collapseDockingZoneFlag=d.data.value),d.data.value){let e,n=UWA.createElement("div",{class:"del-pertview-container"}),s=t.getComponent("SessionModel").get(c);p[u]=new i({identifier:u,domId:u,title:l.get("PROCESS.PERTView.title"),immersiveFrame:r.getFrameWindow().getImmersiveFrame(),content:n,resizableFlag:!0,verticallyStretchableFlag:!0,horizontallyStretchableFlag:!0,width:300,height:300}),(e=new a({})).inject(n),e.updateFacet({objectId:s[0].id,filterQuery:s[0].withFilter?t.getComponent("Utils").getValue(s[0].filter,"config_filter"):null}),p[u].addEventListener("close",function(){delete p[u],o.toolbar.updateNodeModel(u,{grid:{data:!1}})})}else p[u]&&(p[u].destroy(),delete p[u])}}],this._parent()},buildToolbar:function(){this._parent(e.PPRTYPES.PROCESS,o.getToolbarDefination({[d]:widget.getValue(s)===p}),this._eventHandlers)},isWorkInstructionsEnabled:function(){return this.isEnabled(d)&&!0===this.getValue(d)}})}),define("DS/DELWebPPRController/DELWebColumnManager",["UWA/Core","UWA/Class","DS/DELWebPPRController/DELWebCfgColumnManager","DS/DELWebPPRController/DELWebDictionaryService","DS/DELWebPPRController/columnviews/PositionMatrix","DS/DELWebPPRController/columnviews/Responsible","DS/DELWebPPRController/columnviews/BuildUp","UWA/Class/Promise","text!DS/DELWebPPRController/assets/json/AttributeColumnMapping.json","css!DS/DELWebPPRController/assets/css/maturity.css"],function(e,t,n,o,i,r,a,l,s){"use strict";const c="dicoType",u={Title:{dataIndex:"tree",pinned:"left",editionPolicy:"EditionOnOver",width:"250px",height:"40px",getCellKPIColor:function(e){if(!e.isHeader&&e.nodeModel&&e.nodeModel.options.grid.biColor)return e.nodeModel.options.grid.biColor}},InstanceLabel:{icon:"flow-cascade",typeRepresentation:"string",width:"150px",height:"40px"},PositionMatrix:i,Revision:{typeRepresentation:"string",width:"60px",height:"40px",alignment:"center"},Description:{typeRepresentation:"string",width:"100px",height:"40px",alignment:"center"},Owner:r,Maturity:{kind:"string",width:80,height:"40px",editableFlag:!1,typeRepresentation:"tag",className:"lc-maturity-state",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},ds6w:"ds6w:status",visibleFlag:!0,getCellClassName:function(e,t){return t&&t.nodeModel&&t.nodeModel.options&&t.nodeModel.options.grid&&t.nodeModel.options.grid[e]}},HideShow3D:{dataIndex:"hideShow3D",sortableFlag:!1,alignment:"center",width:30,height:"40px",pinned:"right"},BuildUp:a,Menu:{width:"45px",completed:!0,dataIndex:"ContextualMenuColumn",typeRepresentation:"chevronMenuIcon",pinned:"right",editableFlag:!1,sortableFlag:!1,groupableFlag:!1,resizableFlag:!1,selectableFlag:!1,printableFlag:!1,alignment:"center",getCellValue:function(){return{}}}};var d={typeRepresentation:"string",alignment:"left"},g=t.extend(n,{name:"ColumnManager",init:function(){this.dictionaryService=new o,this.attributeConfig=JSON.parse(s)},destroy:function(){this.empty(),this.dictionaryService=this.attributeConfig=null},createColumnConfiguration:function(e){var t,n,o=this;return e=e||{},l.all([this.checkCfgColumnsAvailability(),this.dictionaryService.initialize((t=e.columnConfig,n={},(Array.isArray(t)?t.map(e=>e.Columns):[]).forEach(e=>{e.forEach(e=>{let t=e.dataIndex||"",i=o.getAttributeName(t);n[e[c]]?n[e[c]].push(i):n[e[c]]=[i]})}),Object.keys(n).map(e=>({type:e,attributes:n[e]}))))]).then(function(){return Object.assign(u,o.getCfgColumnsConfig()),l.resolve()})},getColumnConfiguration:function(e){return e&&u[e.name]?Object.assign({},u[e.name],e.columnProperties?e.columnProperties:{}):this.getColumnConfig(e)},empty:function(){this.dictionaryService.empty()},getAttributeName:function(e){return e?e.split(".").slice(0,-1).join("."):null},getColumnConfig:function(e){let t,n=this,o=e?this.dictionaryService.getAttributeInfo(e.dicoType,this.getAttributeName(e.dataIndex)):null,i=e&&e.columnProperties?e.columnProperties:{};return o&&o.Type&&(t=d,(t=Object.assign({},t,this.attributeConfig[o.Type],{text:o.NLS},i)).semantics=Object.assign({},function(e){let t,o,i={},r=function(e){Object.assign(i,e)};return e&&(t=n.dictionaryService.getUnit(e.Magnitude),o=n.dictionaryService.getAuthorizedValues(e),t&&r({units:t.NLSName}),o&&o.length>0&&r({possibleValues:o.map((e,t)=>({value:t+1,label:e.NLS}))})),i}(o),t.semantics)),t}});return e.namespace("DS/DELWebPPRController/DELWebColumnManager",g)}),define("DS/DELWebPPRController/DELWebPPRController",["UWA/Core","UWA/Class/Promise","DS/DELWebComponentManager/DELWebComponentManager","DS/DELWebComponentManager/DELWebTypesUtil","DS/DELWebPPRController/DELWebPPRModel","DS/DELWebPPRController/DELWebPPRItemModel","DS/DELWebPPRController/DELWebPPRProcessModel","DS/DELWebPPRController/ProcessToolbarController","DS/Logger/Logger","DS/DELWebPPRController/DELWebColumnManager","DS/ApplicationFrame/CommandsManager","DS/Utilities/Dom","DS/DELWebComponentManager/XSOManager","DS/DELWebCommonControls/DELWebPanel","DS/ApplicationFrame/FrameWindowsManager","DS/Utilities/TouchUtils","i18n!DS/DELWebPPRController/assets/nls/DELWebPPR"],function(e,t,n,o,i,r,a,l,s,c,u,d,g,p,f,m,h){"use strict";return function(b){const P="DELWebPPRController",C={value:!1,set state(e){this.value=e}};var E={configLoading:{stdTemplate:"functionIcon",semantics:{className:"relationRefresh",icon:{iconName:"reload wux-ui-3ds-spin",fontIconFamily:1}}}},S=["expandAll","collapseAll","reframe","showAll","showOnly"],v="scopedMfg",D="resource",R="dsprcs:MfgProcessOcc",M="dsprcs:CapableResources";const y="buildUp";var T,I,U,L,w,W,A,x,N,O,F,_={},k=s.getLogger("DELWebPPRController"),V=new r,B=new r,H=new r,Y=new a,j=new i,z=new c,G={},X={},q=function(e){e&&Object.values(o.PPRTYPES).forEach(t=>{let o=n.isInitialized(t)?n.getComponent(t):null;e({name:t,component:o})})},$=function(t){return t&&t.origin!==P&&e.is(t.data)},K=function(e,t){var o={data:t,origin:P};n.getComponent("ModelEvents").publish({event:e,data:o})},J=function(t){$(t)&&e.is(t.data.node)&&K("onReframe",{path:t.data.node.getRirPath()})},Q=function(t){var o,i,r=[],a=[],l=n.getComponent("SessionModel");$(t)&&e.is(t.data.node)&&(o=t.data.node.getRirPath(),l.get("roots").forEach(function(e){e.id!==o[o.length-1]?(r.push(e),a.push(e.pprType)):i=e.pprType}),l.set("roots",r),-1===a.indexOf(i)&&(X[i].destroy(),delete G[i]),K("onRemoveRoot",{pids:t.data.node.getRirPath()}))},Z=function(t){const n=1,o=2;var i,r;$(t)&&e.is(t.data.node)&&(r=(i=t.data.node).getAttributeValue("hideShow3D"),K(r===n||r===o?"onShow":"onHide",{path:i.getRirPath()}))},ee=function(e,t){var i,r;e&&((i=e.getAttributeValue(y))!==e.ENUM_BUILDUP.ACTIVATE&&i!==e.ENUM_BUILDUP.DEACTIVATE||(r=i===e.ENUM_BUILDUP.ACTIVATE?e.ENUM_BUILDUP.DEACTIVATE:e.ENUM_BUILDUP.ACTIVATE,N&&N.setAttribute(y,e.ENUM_BUILDUP.DEACTIVATE),e.setAttribute(y,r),function(e,t){(!N||N.getRirPath().toString()!==e.getRirPath().toString()&&t)&&(N=e)}(e,r),function(e){let t=e.getAttributeValue(y)===e.ENUM_BUILDUP.ACTIVATE;[o.PPRTYPES.MBOM,o.PPRTYPES.RESOURCE].forEach(e=>{var o=n.getComponent(e);o.updateColumn("hideShow3D",{visibleFlag:!t,disabled:t}),o.updateContextualMenu([{name:"showAll",state:t?"disabled":"enabled"},{name:"showOnly",state:t?"disabled":"enabled"}]),t&&o.reset3DVisibility()})}(e),t&&t(e)))},te=function(e){if($(e)){let t=e.data;t.dataIndex===y&&0!==t.cell.rowID&&ee(t.cell.nodeModel,function(e){K(e.getAttributeValue(y)?"activateBuildup":"deactivateBuildup",{path:e.getRirPath()})})}},ne=function(){let t,i;return{updateState:function(r){e.is(r.isProcessLoaded,"boolean")&&(t=r.isProcessLoaded),e.is(r.is2DStructureLoaded,"boolean")&&(i=r.is2DStructureLoaded),e.is(t,"boolean")&&i&&(function(e){var t,n=Y.getModel();n&&(t=n.getRoots())&&t.length>0&&t.forEach(t=>{t.updateOptions({grid:e})})}({[y]:""}),I.publishEvent(o.PPRTYPES.PROCESS,"updateColumn",{dataIndex:y,options:{visibleFlag:t,disabled:!t}}),t||n.getComponent("Utils").displayNotification({level:"warning",message:h.get("BuildupComputation.Error.Message")}),t=i=null)},reset:function(){t=i=null}}}(),oe=function(e){$(e)&&ne.updateState({isProcessLoaded:!0})},ie=function(e){$(e)&&ne.updateState({isProcessLoaded:!1})},re=function(e){var t;$(e)&&(t=n.getComponent("SessionModel").get("roots"))&&1===t.length&&t[0].pprType===o.PPRTYPES.PROCESS&&ne.updateState({isProcessLoaded:e.data.isRefreshed})},ae=function(e){if($(e)){C.state=!0;let t=L.PROCESS.getNodeFromPath(e.data.path);t&&t.getAttributeValue(y)===t.ENUM_BUILDUP.DEACTIVATE&&ee(t)}},le=function(e){if($(e)){C.state=!1;let t=L.PROCESS.getNodeFromPath(e.data.path);t&&t.getAttributeValue(y)===t.ENUM_BUILDUP.ACTIVATE&&ee(t)}},se=function(e){$(e)&&z.updateAttributes(e.data)},ce=function(t){$(t)&&e.is(t.data.nodesToShow,"array")&&K("onShow",{path:t.data.nodesToShow.map(e=>e.getRirPath())})},ue=function(t){$(t)&&(e.is(t.data.nodesToShow,"array")&&K("onShow",{path:t.data.nodesToShow.map(e=>e.getRirPath())}),e.is(t.data.nodesToHide,"array")&&K("onHide",{path:t.data.nodesToHide.map(e=>e.getRirPath())}))},de=function(t,o){return new e.Promise(function(i,r){X[t]=new p(function(e,t){let o=u.getCommandCheckHeader("ToggleDataGridView"),i={identifier:e+"View",domId:e+"View",icon:{iconPath:n.getComponent("Utils").getAssetsUrl("DELWeb3DOpersReviewApp","icons/22/"+_[e].icon),iconSize:{height:m.getTouchMode()?"22px":"16px",width:m.getTouchMode()?"22px":"16px"}},immersiveFrame:f.getFrameWindow().getImmersiveFrame(),currentDockArea:WUXDockAreaEnum[_[e].dockArea],visibleFlag:!o||o.getState(),resizableFlag:!0,verticallyStretchableFlag:!0,closeButtonFlag:!1,width:400,height:400,ensureHeightDefinitionOnHierarchy:!0,progressBarOptions:{enable:!0,infiniteFlag:!0,displayStyle:"lite",emphasize:"info"}};return Object.assign(i,t)}(t,o)),n.initialize(t,{container:X[t].getContentContainer(),treeDocument:L[t].getModel(),columns:function(t){var o,i=b.get(t)?b.get(t).options:{},r=[];return i&&i.ColumnConfig&&(i.ColumnConfig.Label&&r.push(e.clone(i.ColumnConfig.Label)),e.is(i.ColumnConfig.Columns,"array")&&i.ColumnConfig.Columns.forEach(function(t){r.push(e.clone(t))}),i.ColumnConfig.showHideShow3D&&r.push({name:"HideShow3D",icon:n.getComponent("Utils").getAssetsUrl("DELWeb3DOpersReviewApp","icons/32/I_3DColumn.png")}),i.ColumnConfig.activateBuildUp&&r.push({name:"BuildUp",icon:n.getComponent("Utils").getAssetsUrl("DELWeb3DOpersReviewApp","icons/32/I_3DColumn.png")}),i.ColumnConfig.showMenu&&r.push({name:"Menu"})),o=[],r.forEach(function(e){var n=e.name,i=z.getColumnConfiguration(e);i&&(i.text=i.text?i.text:h.get(t+"."+n),i.description=h.get(t+"."+n+".description")?h.get(t+"."+n+".description"):"",i.dataIndex||(i.dataIndex=e.dataIndex),e.dicoType&&(i.dicoType=e.dicoType),e.icon&&(i.icon=e.icon),i.getCellClassName?i.getCellClassName=i.getCellClassName.bind(null,e.dataIndex):i.getCellClassName=function(e,t){var n="";return t.nodeModel&&!0===t.nodeModel.options.isBeingCut&&(n="del-ppr-component-dgv-cutNode"),n}.bind(null,e.dataIndex),i.getCellSemantics&&(i.getCellSemantics=i.getCellSemantics.bind(null,e.dataIndex)),i.getCellTooltip&&(i.getCellTooltip=i.getCellTooltip.bind(null,e.dataIndex)),i.getCellValue&&(i.getCellValue=i.getCellValue.bind(null,e.dataIndex)),i.getCellValueForExport&&(i.getCellValueForExport=i.getCellValueForExport.bind(null,e.dataIndex)),o.push(i))}),o}(t),contextualMenu:o&&o.contextualMenu?o.contextualMenu:b.get(t).options.contextualMenu?b.get(t).options.contextualMenu:[]}).then(function(){n.getComponent(t).registerTypeRepresentations(E),I.subscribeEvents(t),i()}).fail(r)})},ge=function(e){return e?e.occurrence&&e.occurrence.length>0?e.occurrence[0]:e.id:null},pe=function(e,t){k.error(t),X[e]&&X[e].displayProgressBar(!1),n.getComponent("Utils").displayNotification({level:"error",message:h.get(`Error.${e}.Failed.Message`)})},fe=function(t){var i,r,a=n.getComponent("Utils");return a.markStart("processTree"),U||(U=new l(T)),U.destroyToolbar(),U.buildToolbar(),t&&t.id?(X[o.PPRTYPES.PROCESS].displayProgressBar(!0),i=j.getProcessExpandData({id:ge(t),ColumnConfig:_[o.PPRTYPES.PROCESS].ColumnConfig,filter:t.filter,mfgItemId:t[v]?t[v].id:null}).then(function(n){let i=t[v]?t[v].occurrence:null;if(t.occurrence&&t.occurrence.length>0){let o={};!function t(n,o,i){let r,a;if(n.member){let l=n.member.findIndex(e=>o.includes(e.id));l>=0&&(i.totalItems=1,i.member=[],e.extend(i.member,[n.member[l]],!0),r=n.member[l][R],a=i.member[0][R],r&&t(r,o,a))}}(n,t.occurrence.join("/"),o),n=o}var r;(r=n)&&r.member[0]&&t[D]&&(r.member[0][M]={totalItems:1,member:[{resource:t[D].id}]}),Y.loadData({response:n,filter:t.filter,installPath:i,compOptions:_[o.PPRTYPES.PROCESS]}),X[o.PPRTYPES.PROCESS].displayProgressBar(!1),a.markEnd("processTree","Process Tree created in")}).fail(function(e){pe(o.PPRTYPES.PROCESS,e)})):(r="Invalid input to load Process structure",k.error(r),i=e.Promise.reject(r)),i},me=function(t,o){var i,r,a=_[t],l=n.getComponent("Utils"),s=[];return o?(i=e.is(o,"array")?o:[o],l.markStart("load2DStructure"),i.forEach(function(n){X[t]&&X[t].displayProgressBar(!0),s.push(j.getExpandData({id:ge(n),model:a.model,ColumnConfig:a.ColumnConfig,filter:n.filter,pathFilter:n.occurrence,predecessors:n.predecessors,pprType:n.pprType}).then(function(n){let i=Object.assign(n,o,{id:ge(o)});return new e.Promise(function(e){i.onComplete=function(){l.markEnd("load2DStructure","Tree structure created in"),X[t]&&X[t].displayProgressBar(!1),e()},L[t].loadData(i)})}).fail(function(e){pe(t,e)}))}),r=e.Promise.all(s)):k.warn("no object to load"),r||e.Promise.resolve()},he=function(){var t=g.getHSO().get(),n=[];e.is(t,"array")&&t.forEach(e=>{e.getReferenceType&&o.isWKIType(e.getReferenceType())&&(Y.highlight(e.getRirPath(),!1),n.push(e))}),n.forEach(function(e){g.getHSO().remove(e)})},be=function(t){var n;$(t)&&(n=t.data,[Y,V,B,H].forEach(e=>{e.getModel().unselectAll()}),he(),n&&e.is(n.textualInstructionPIds,"array")&&n.textualInstructionPIds.forEach(e=>{var t=Y.getNodeFromID(null,e);t&&(g.getHSO().add(t),Y.highlight(t.getRirPath(),!0))}))},Pe=function(e,t){$(t)&&([Y,V,B,H].forEach(e=>{e.getModel().unselectAll()}),[V,B,H].forEach(n=>{n.highlight(t.data.path[0],e.state)}),he())},Ce=function(e,t){$(t)&&[V,B].forEach(n=>{n.preSelect(t.data.path[0],e.state)})},Ee=function(t){var n,i;if(t&&t.origin!==P)switch(t.origin){case o.PPRTYPES.MBOM:case o.PPRTYPES.PRODUCT:case o.PPRTYPES.RESOURCE:n=t.data.node,i=e.is(n)&&-1!==n.rowID&&!n.nodeModel.isSelected()?{path:n.nodeModel.getRirPath(),clear:!0}:{path:[],clear:!0},K("onPreHighlight",i)}},Se=(W=null,A=[],x=n.getComponent("ModelEvents"),{subscribeEvents:function(e){w=n.getComponent(e).getModelEvents(),W=w.subscribe({event:"onPPRHover"},Ee),A.push(x.subscribe({event:"onPreHighlight"},Ce.bind(null,{state:!0}))),A.push(x.subscribe({event:"onUnPreHighlight"},Ce.bind(null,{state:!1})))},unsubscribeEvents:function(){w&&W&&w.unsubscribe(W),A.forEach(e=>{n.getComponent("ModelEvents").unsubscribe(e)}),W=null,A=[]}}),ve=function(e,t){G[e]?G[e].then(function(){me(e,t)}):(Se.subscribeEvents(e),G[e]=de(e).then(function(){me(e,t).then(()=>{K("onLoad2DStructureComplete",{data:t})}),function(e,t){let n,o=t,i=Object.keys(X).filter(n=>n!==t&&X[n].currentDockArea===e);if(i.length>0)for(n=i.length-1;n>=0;n--)X[i[n]].attachToWindow(X[o],WUXSnapAreaEnum.InsideArea,"before"),o=i[n]}(WUXDockAreaEnum.LeftDockArea,e)}))},De=function(){var i=[],r=n.getComponent("SessionModel").get("roots");C.state=!1,r&&e.is(r,"array")&&r.length>0&&([Y,B,V,H].forEach(e=>{e.empty()}),r.forEach(function(e){switch(e.pprType){case o.PPRTYPES.PROCESS:i.push(fe(e)),e[v]?i.push(me(o.PPRTYPES.MBOM,e[v])):n.getComponent("Utils").displayNotification({level:"warning",message:h.get("ScopedMfgNotFound.Error.Message")}),i.push(me(o.PPRTYPES.RESOURCE,e[D])),t.all(i).then(function(){ne.updateState({is2DStructureLoaded:!0})});break;default:me(e.pprType,e)}}))},Re=function(e){let t,i,r=n.getComponent("SessionModel"),a=r.get("roots");a&&e&&e.data&&e.data.filterRootIds&&1===e.data.filterRootIds.length&&(t=!0!==e.data.empty?e.data.CVQueryV2.filter:null,i=e.data.filterRootIds[0],a.forEach(function(e){if(e.pprType===o.PPRTYPES.PROCESS){if(e.filter=t,e[v]){let n=e[v];n&&(n.filter=t)}}else e.id===i&&(e.filter=t)}),r.set("roots",a),De())},Me=function(){Se.unsubscribeEvents(),[Y,B,V,H].forEach(e=>{e.empty()}),q(e=>{I.unsubscribeEvents(e.name),e&&e.component&&e.component.clean()}),U&&U.destroyToolbar(),Object.keys(X).forEach(e=>X[e].destroy()),X={},ne.reset(),G={},C.state=!1},ye=function(e){var t,n,i,r=[],a=Y.getModel().getSelectedNodes(),l=[];if($(e)&&e.data.node)switch(t=e.data.node,n=t.isSelected(),he(),e.origin){case o.PPRTYPES.MBOM:case o.PPRTYPES.PRODUCT:case o.PPRTYPES.RESOURCE:n&&(Y.getModel().unselectAll(),C.value||(e.origin===o.PPRTYPES.MBOM?H.getModel().unselectAll():V.getModel().unselectAll())),K(n?"onHighlight":"onUnHighlight",{path:t.getRirPath()});break;case o.PPRTYPES.PROCESS:n&&[V,B,H].forEach(e=>{e.getModel().unselectAll()}),(i=t.getConsumedItems()).MfgItems.length>0&&i.MfgItems.forEach(e=>{V.highlight(e,n),r.push(e)}),i.Resources.length>0&&i.Resources.forEach(e=>{var t=H.getPathFromId(e);H.highlight(t,n),r.push(t)}),a.forEach(e=>{e.getReferenceType&&o.isWKIType(e.getReferenceType())&&l.push(e.getInstanceId())}),U.isWorkInstructionsEnabled()&&K("highlightLinkedViews",{pid:l}),K(n?"onHighlight":"onUnHighlight",{path:r})}},Te=function(e){let t=[];$(e)&&(t=X[o.PPRTYPES.PROCESS]&&U.isWorkInstructionsEnabled()?[o.PPRTYPES.PROCESS]:Object.keys(X)).forEach(t=>{e.data.state?X[t].show():X[t].hide()})},Ie=function(e){$(e)&&e.data.path&&q(t=>{var o;t&&t.component&&L[t.name].getNodeFromPath&&(o=L[t.name].getNodeFromPath(e.data.path))&&n.getComponent(t.name).focus(o,!1,!0)})},Ue=function(t){var o,i;$(t)&&(i=t.data,e.is(i.tagColors,"array")&&i.tagColors.length>0&&(o=i.tagColors[0].predicate,q(e=>{var i,r=[];e&&e.component&&(((i=L[e.name].getModel())?i.getAllDescendants():[]).forEach(e=>{-1===r.indexOf(e.getReferenceId())&&r.push(e.getReferenceId())}),n.getComponent("Utils").getAttributeForIds(r,[o]).then(function(n){e.component.biColorize(t.data,n)}).fail(function(e){k.error(e)}))})))},Le=function(){q(e=>{e&&e.component&&e.component.biUnColorize()})},we=()=>u.getCommandCheckHeader("ToggleDataGridView"),We=function(){let e=we();e&&e.disable(),Me()},Ae=function(e){let i=we();i&&i.enable(),function(e){var i,r=n.getComponent("Utils");if($(e)){let a=[],l=[];switch((i=e?e.data:{}).pprType){case o.PPRTYPES.PROCESS:r.markStart("pprProcessOpen"),de(o.PPRTYPES.PROCESS).then(function(){l.push(fe(i))}),a.push(de(o.PPRTYPES.MBOM,{currentDockArea:WUXDockAreaEnum.RightDockArea,contextualMenu:S})),a.push(de(o.PPRTYPES.RESOURCE,{currentDockArea:WUXDockAreaEnum.RightDockArea,contextualMenu:S})),t.all(a).then(function(){X[o.PPRTYPES.MBOM]&&X[o.PPRTYPES.RESOURCE]&&X[o.PPRTYPES.MBOM].attachToWindow(X[o.PPRTYPES.RESOURCE],WUXSnapAreaEnum.InsideArea,"before"),i[v]?l.push(me(o.PPRTYPES.MBOM,i[v])):n.getComponent("Utils").displayNotification({level:"warning",message:h.get("ScopedMfgNotFound.Error.Message")}),l.push(me(o.PPRTYPES.RESOURCE,i[D])),t.all(l).then(function(){ne.updateState({is2DStructureLoaded:!0}),K("onLoad2DStructureComplete",{data:i})}),r.markEnd("pprProcessOpen","PPR Process Opened in ")});break;default:ve(i.pprType,i)}}}(e)},xe=()=>{let e=we();e&&e.setState(!1)},Ne=()=>{let e=we();e&&e.setState(!0)},Oe=function(){var e=n.getComponent("ModelEvents"),t=[{eventName:{event:"load2DStructure"},callback:Ae},{eventName:{event:"remove2DStructure"},callback:We},{eventName:{event:"hide2DStructure"},callback:xe},{eventName:{event:"show2DStructure"},callback:Ne},{eventName:{event:"onHighlight"},callback:Pe.bind(null,{state:!0})},{eventName:{event:"onUnHighlight"},callback:Pe.bind(null,{state:!1})},{eventName:{event:"onSelectView"},callback:be},{eventName:{event:"onHome"},callback:Me},{eventName:{event:"empty"},callback:Me},{eventName:{event:"onRefresh"},callback:De},{eventName:{event:"onApplyNGFilter"},callback:Re},{eventName:{event:"onToggleDataGridview"},callback:Te},{eventName:{event:"onFocus"},callback:Ie},{eventName:{event:"onBIColorize"},callback:Ue},{eventName:{event:"onBIUnColorize"},callback:Le},{eventName:{event:"onBuildUpActivated"},callback:ae},{eventName:{event:"onBuildUpDeactivated"},callback:le},{eventName:{event:"onProcessLoadCompleted"},callback:oe},{eventName:{event:"onProcessLoadFailed"},callback:ie},{eventName:{event:"onViewerRefreshed"},callback:re},{eventName:{event:"onViewerRefreshFailed"},callback:re}],o=[];return{subscribeEvents:function(){t.forEach(function(t){o.push(e.subscribe(t.eventName,t.callback))})},unsubscribeEvents:function(){o.forEach(t=>{e.unsubscribe(t)}),o=[]}}}();return O=[{eventName:{event:"onShowAll"},callback:ce},{eventName:{event:"onShowOnly"},callback:ue},{eventName:{event:"onReframe"},callback:J},{eventName:{event:"onSelectionChange"},callback:ye},{eventName:{event:"onHideShow3DStateChange"},callback:Z},{eventName:{event:"onCellClick"},callback:te},{eventName:{event:"onDelayedModelDataRequest"},callback:se},{eventName:{event:"onRemoveRoot"},callback:Q}],F={},I={publishEvent:function(e,t,o){n.getComponent(e).getModelEvents().publish({event:t,data:o})},subscribeEvents:function(e){var t=n.getComponent(e).getModelEvents();F[e]=[],O.forEach(function(n){F[e].push(t.subscribe(n.eventName,n.callback))})},unsubscribeEvents:function(t){var o=n.getComponent(t).getModelEvents();F[t]&&e.is(F[t],"array")&&(F[t].forEach(e=>{o.unsubscribe(e)}),F[t]=[])}},L={PROCESS:Y,MBOM:V,PRODUCT:B,RESOURCE:H},Object.keys(o.PPRTYPES).forEach(e=>{_[e]=b.get(e).options}),T={initialize:async function(e){var t,n,o=e?e.map(e=>b.get(e).options.ColumnConfig):null;try{Oe.subscribeEvents(),[Y,V,B,H].forEach(e=>{e.getModel().getXSO().onPreAdd(function(e){d.isCurrentlyCalledFromUIInteraction()&&K("onPreAddSelect",e)}),e.getModel().getXSO().onPostAdd(function(e){d.isCurrentlyCalledFromUIInteraction()&&g.getCSO().add(e)}),e.getModel().getXSO().onPostRemove(function(e){g.getCSO().remove(e)})}),await z.createColumnConfiguration({columnConfig:o}),K("onPPRReady")}catch(e){t="failed to initialize PPR",n=(n=e)||new Error(t),k.error(t,n.toString())}},getPPRPanels:function(){return X},empty:async function(){Me()},destroy:function(){Object.values(o.PPRTYPES).forEach(e=>{var t=n.getComponent(e);t&&t.destroy()}),Oe.unsubscribeEvents()}}}});