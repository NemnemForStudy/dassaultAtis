define("DS/DELWebCommonCmds/DELWeb3DFilterCmd",["DS/PlatformAPI/PlatformAPI","DS/ENONextGenFilterCmd/commands/ENONextGenFilterCmd","DS/DELWebComponentManager/DELWebComponentManager","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/Selection/CSOManager","DS/Logger/Logger","DS/Controls/ModalContainer","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/DELWebCommonCmds/assets/nls/DELWeb3DFilterCmd"],function(e,t,n,o,i,r,l,s,a,d,c){"use strict";return t.extend({name:"DELWeb3DFilterCmd",_roots:[],_modelTokens:[],initProxy:function(){var t=this,i=r.getLogger("DELWeb3DFilterCmd"),p=n.getComponent("Utils");this._modelTokens.push(n.getComponent("ModelEvents").subscribe({event:"onOpenFilter"},function(o={}){var r=o.data||[],m=[],g=function(){m.forEach(t=>{e.unsubscribe(t)}),m=[]};UWA.is(r,"array")&&r.length>0&&(m.push(e.subscribe("Frame3DXInfra.Close",function(e){var t,o,m,u,b;e&&e.NGFUXId===p.getSharedAppId()&&(g(),u=document.getElementsByClassName("wux-controls-modalContainer"),m=(b=function(e){o.removeEventListener("close",m),o.destroy(),l.removeModal(widget.body),n.getComponent("ModelEvents").publish({event:"onFilterCancel",data:{data:{result:e,filterData:r},origin:"DELWeb3DFilterCmd"}})}).bind(b,!1),UWA.is(u,"array"),u.length>0?((t=new s({})).inject(u[0]),(o=new a({immersiveFrame:t,title:c.get("Dialog.Title"),content:c.get("Dialog.FilterCancelled.Message"),buttons:{Ok:new d({onClick:b.bind(b,!0)}),Cancel:new d({onClick:b.bind(b,!1)})}})).addEventListener("close",m)):i.error("App Overlay container not found, so dialog cannot be created"))})),m.push(e.subscribe("onApplyNGFilter/"+p.getSharedAppId(),function(e){e&&!e.empty&&(g(),l.removeModal(widget.body))})),function(){let e=!1,n=r.find(e=>e.filterSpec||e.publicFilterSpec);if(n){e=!0;let o={rootID:n.id,rootAlias:n.label,applyFilter:1,displayFilter:0,forceUpdate:0,serviceId:"3DSpace"};n.filterSpec?t._BIProxy.setFilterSpecification({...o,...n.filterSpec}):n.publicFilterSpec&&t._BIProxy.setPublicFilterSpecification({...o,...n.publicFilterSpec})}return e}()||(t.setRoots(r.map(e=>({id:e.id,filtered:!1}))),t.execute()),l.createModal(widget.body,document.createElement("span")))})),this._BIProxy=new o({tenant:p.getPlatformId(),processingMode:"appProcessing",ExpandSynthesisON:!0,colorize:!0,widgetId:p.getWidgetId(),volumeFilterAvailable:!0,NGFUXId:p.getSharedAppId(),appId:p.getAppId(),synthesis_priority:2,shareFilterSpec:!0,selectionFilterAvailable:!1,attributeFilterAvailable:!1})},getProxy:function(){return this._BIProxy},getAppParams:function(){var e=n.getComponent("Utils");return{widgetId:e.getWidgetId(),appId:e.getAppId(),NGFUXId:e.getSharedAppId(),shareFilterspec:!0}},shareFilterSpec:function(e){this._BIProxy.shareFilterSpec(e)},getRoots:function(){return this._roots},getSelection:function(){return{path:[]}},setRoots:function(e){this._roots=e},getSelectorManager:function(){return i},cleanProxy:function(){if(this._BIProxy&&this._BIProxy.cleanProxy(),this._BIProxy=null,this._modelTokens.length>0){let e=n.getComponent("ModelEvents");this._modelTokens.forEach(t=>{e.unsubscribe(t)})}this._roots=[],this._modelTokens=[]}})});