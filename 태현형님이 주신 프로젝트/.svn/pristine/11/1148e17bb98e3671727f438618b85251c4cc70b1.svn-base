define("DS/DELWKOComponentsUI/DELWKOSearchFilter",["DS/TreeModel/BaseFilter"],function(e){"use strict";return e.inherit({publishedProperties:{},isDataFiltered:function(e){var t=e.getAttributeValue("label");if(this.filterModel&&this.filterModel.text&&t){return!(-1!==t.toLowerCase().indexOf(this.filterModel.text.toLowerCase()))}return!this.filterModel||""!==this.filterModel.ip_text},isEmpty:function(){return void 0===this.filterModel.ip_text}})}),define("DS/DELWKOComponentsUI/DELWKOSearchButton",["UWA/Class","UWA/Core","DS/Controls/Editor","DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant"],function(e,t,o,n,i){"use strict";return e.extend({init:function(){this.userTextEditor=n.getSearchWidget(n.FULL,{className:"search",ForbiddenChar:"",MaxNumber:"5",MaxSize:"300",wintop:!1,hint:"slip",showEmptyCategory:!1,type:i.TYPE_PROJECT,urlService:"/resources/v1/modeler/dsprcs/dsprcs:MfgProcess/search",events:{onValid:function(){console.log("coucou")}}})}})}),define("DS/DELWKOComponentsUI/DELWKOSearchUI",["UWA/Class","UWA/Core","UWA/Utils/InterCom","DS/Controls/Button","i18n!DS/DELWKOComponentsUI/assets/nls/DELWKOAutoCompleteUI"],function(e,t,o,n,i){"use strict";return e.extend({_type:null,init:function(e){this._type=e.name.substring(0,e.name.indexOf(".")),this._precondition=e.precondition,this._parent(),this.socketName="search_socket"+(new Date).getTime(),this.socket=new o.Socket(this.socketName,{dispatchRetryInterval:5}),this.socket.subscribeServer("SearchComServer"),this.socket.addListener("Selected_Objects_search",e.callback)},buildUI:function(){var e=this,t=new n({label:" ",icon:{iconName:"search",fontIconFamily:WUXManagedFontIcons.Font3DS,onClick:function(t){e.activate(i.searchTitle,[e._type],null)}}});return t.addEventListener("buttonclick",function(){e.activate(i.searchTitle,[e._type],null)}),t},getOptions:function(e,o,n){var i=this,r={};return r.title=e,r.mode="furtive",r.app_socket_id=this.socketName,r.widget_id=widget.id,r.default_with_precond=!0,r.show_precond=!1,r.source=["3dspace"],r.default_search_criteria="",r.precond="",r.multiSel=!1,r.role="",r.select_result_max_idcard=!1,t.is(n)&&n.forEach(function(e){""!==r.default_search_criteria&&(r.default_search_criteria+=" OR "),r.default_search_criteria+=e}),t.is(o)&&(o.forEach(function(e){""!==r.precond&&(r.precond+=" OR "),null!=i._precondition?r.precond+="flattenedtaxonomies:types/"+e+" "+i._precondition:r.precond+="flattenedtaxonomies:types/"+e}),r.precond="("+r.precond+")"),r},register:function(e){var t=this;e=null!==e?e:this.options(),this.socket.dispatchEvent("RegisterContext",e),this.socket.addListener("onCloseTransient",function(){t.socket.removeListener("onCloseTransient"),t.unRegister()})},unRegister:function(e){var t={widget_id:widget.id};this.socket.dispatchEvent("unregisterSearchContext",t),this.socket.dispatchEvent("UnregisterContext",t)},destroy:function(e){this.unRegister(),this.socket.unsubscribeServer("SearchComServer"),this.socket.removeListener("Selected_Objects_search",this.listener),this.socket.disconnect()},activate:function(e,t,o){var n=this.getOptions(e,t,o);this.register(n),this.socket.dispatchEvent("InContextSearch",n)}})}),define("DS/DELWKOComponentsUI/DELWKOAutoCompleteUI",["UWA/Class","UWA/Core","DS/Core/Events","DS/WUXAutoComplete/AutoComplete","DS/DELPPWWebServices/WebserviceUtils","DS/Tree/TreeNodeModel","DS/Tree/TreeDocument","DS/DELWKOComponentsUI/DELWKOSearchFilter","DS/DELPPWResourceServices/ResourceUtils","i18n!DS/DELWKOComponentsUI/assets/nls/DELWKOAutoCompleteUI"],function(e,t,o,n,i,r,s,l,a,d){"use strict";return e.extend({_model:null,_mapScoped:new Map,_mapScopedInv:new Map,_items:[],_addNode:!0,_currentlyremovingCSO:[],_currentlyaddingCSO:[],init:function(e,t){var i=this;i._core=e,i._model=new s,i._options=t,i._items=[],i.autoComplete=new n({placeholder:d.searchPlaceHolder,elementsTree:i._model,multiSearchMode:!1}),i.autoComplete.fieldType=t.fieldType,o.subscribe({event:"DELWKOComponentsUI/DELWKOAutoCompleteUI/onPostAdd"},function(e){if(void 0!==e&&0!==e.length&&(e.name!==i._options.name&&(null==i._currentlyremovingCSO||!0!==i._currentlyremovingCSO[e.name])&&null!=(p=Array.from(i._mapScoped.keys()))&&p.length>0)){for(var t=null,o=!1,n=0;n<p.length&&!o;n++)p[n]===e.options.value&&(t=new Map(i._mapScoped),o=!0);if(!o){p=Array.from(i._mapScopedInv.keys());for(n=0;n<p.length&&!o;n++)p[n]===e.options.value&&(t=new Map(i._mapScopedInv),o=!0)}if(o){i._currentlyaddingCSO[e.name]=!0;var r=t.get(e.options.value).length;if(1===r){for(var l=-1,a=i._model.getChildren().length,d=0;d<a;d++)t.get(e.options.value).includes(i._model.getChildren()[d].options.data.id)&&(l=d);a=i._model.getChildren().length;i._model&&l>=0&&!i._model.getXSO().get().includes(i._model.getChildren()[l])&&i._model.getXSO().add(i._model.getChildren()[l])}else{var c=!1,u=i._items.length,p=i._mapScoped.get(e.options.value);for(d=0;d<r;d++)for(n=0;n<u&&!c;n++)i._mapScoped.get(e.options.value)[d]===i._items[n].options.data.id&&(t=new Map(i._mapScoped),c=!0);if(c){i._model=new s,i._model.prepareUpdate();for(u=i._items.length,p=t.get(e.options.value),d=0;d<r;d++)for(n=0;n<u;n++)t.get(e.options.value)[d]===i._items[n].options.data.id&&i._model.addRoot(i._items[n]);i._model.pushUpdate(),i.autoComplete.elementsTree=i._model}}setTimeout(function(){i._currentlyaddingCSO[e.name]=!1},500)}}}),o.subscribe({event:"DELWKOComponentsUI/DELWKOAutoCompleteUI/onRemove"},function(e){if(void 0!==e&&0!==e.length&&!(null!=i._currentlyaddingCSO&&!0===i._currentlyaddingCSO[e.name]||e.name===i._options.name||null!=i._currentlyremovingCSO&&!0===i._currentlyremovingCSO[e.name])){var t=i._mapScoped.get(e.options.data.id);if(void 0===t&&(t=i._mapScopedInv.get(e.options.data.id)),null!=t&&t.length>0){for(var o=!1,n=i._items.length,r=0;r<n&&!o;r++)for(var l=0;l<t.length&&!o;l++)t[l]===i._items[r].options.data.id&&(o=!0);if(o){i._model=new s,i._model.prepareUpdate();for(r=0;r<i._items.length;r++)i._model.addRoot(i._items[r]);i._model.pushUpdate(),i.autoComplete.elementsTree=i._model,i._currentlyremovingCSO[e.name]=!0,setTimeout(function(){i._currentlyremovingCSO[e.name]=!1,i._model.getXSO().onPostAdd(function(e){i.onPostAdd(e)}),i._model.getXSO().onRemove(function(e){i.onRemove(e)})},1e3)}}}}),i._model.getXSO().onPostAdd(function(e){i.onPostAdd(e)}),i._model.getXSO().onRemove(function(e){i.onRemove(e)})},onPostAdd:function(e){var t={};null!=(t=e[0])&&(t.name=this._options.name),o.publish({event:"DELWKOComponentsUI/DELWKOAutoCompleteUI/onPostAdd",data:t})},onRemove:function(e){var t={};null!=(t=e)&&(t.name=this._options.name),o.publish({event:"DELWKOComponentsUI/DELWKOAutoCompleteUI/onRemove",data:t})},buildAutoComplete:function(){var e=this,o=i.getHeaders(),n=e._options.url,r={url:i.get3DSpaceUrl()+n,method:"GET",headers:o,onComplete:function(o){var n=[];n.push(e.getMfgProductionPlanningCnx(o)),t.Promise.all(n).then(function(t){e._model.prepareUpdate();for(var o=[],n=0;n<t.length;n++)for(var i=t[n],r=i.length,s=0;s<r;s++)o.push(i[s].options.data.id),e._model.addRoot(i[s]);e._model.pushUpdate(),e.autoComplete.elementsTree=e._model}).catch(t=>e.autoComplete)},onFailure:e.onFailure.bind(e)};return o.Accept="application/json",i.webServiceRequest(r),e.autoComplete},getMfgProductionPlanningCnx:function(e){var o=this;return new Promise(function(n,s){var l=new Map;if(null!=e){for(var d=[],c=e.member,u=c.length,p=0;p<u;p++)d.push(c[p].id);if(d.length>0){var m={label:"getMfgProductionPlanning",tenant:"",input_physical_ids:d,attributes:[],version:3,primitives:[{navigate_from_sr:{id:1}}],patterns:{mfgProductionPlanning:[{id:1}]},patternTypeFilters:{mfgProductionPlanning:{typesToReturn:["MfgProductionPlanning"]}}},h={url:i.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+i.getSecurityContext(),data:t.Json.encode(m),method:"POST",headers:i.getHeaders({isJsonOnly:!0}),onComplete:function(s){for(var d=[],c=s.result,u=c.length,p=0;p<u;p++){var m=c[p].outputs;if(null!=m&&Object.keys(m).length>0){var h=m.mfgProductionPlanning;if(null!=h)for(var g=h.length,_=0;_<g;_++){d.push(h[_].physicalid);var f=l.get(h[_].physicalid);void 0===f&&(f=[],l.set(h[_].physicalid,f)),f.push(c[p].input_object.physicalid)}}}if(d.length>0){var v={label:"getMfgItemOrMfgProcess",tenant:"",input_physical_ids:d,attributes:[],version:3,primitives:[{navigate_to_sr:{id:1,filter:{role:["51"],semantics:["5"]}},navigate_from_rel:{id:2}}],patterns:{mfgItems:[{id:1}],mfgProcess:[{id:2}]},attributes:["ds6w:label","physicalid","type_icon_url","ds6w:type","current","type"]},S={url:i.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+i.getSecurityContext(),data:t.Json.encode(v),method:"POST",headers:i.getHeaders({isJsonOnly:!0}),onComplete:function(t){for(var i=[],s=t.result,d=s.length,c=0;c<d;c++){var u=s[c].outputs;if(null!=u&&Object.keys(u).length>0){var p=u.mfgItems,m=u.mfgProcess;l.forEach(function(e,t){if(t===s[c].input_object.physicalid){for(var n=0;n<m.length;n++)if("RELEASED"==m[n].current){var i=[];null!=o._mapScoped.get(m[n].physicalid)&&(i=o._mapScoped.get(m[n].physicalid));for(var r=0;r<p.length;r++)i.includes(p[r].physicalid)||i.push(p[r].physicalid);o._mapScoped.set(m[n].physicalid,i)}for(n=0;n<p.length;n++){var l=[];null!=o._mapScopedInv.get(p[n].physicalid)&&(l=o._mapScopedInv.get(p[n].physicalid));for(r=0;r<m.length;r++)l.includes(m[r].physicalid)||l.push(m[r].physicalid);o._mapScopedInv.set(p[n].physicalid,l)}}})}}for(var h=e.member,g=h.length,_=0;_<g;_++)if(o._mapScoped.get(h[_].id)||o._mapScopedInv.get(h[_].id)){var f="";null!=o._mapScoped.get(h[_].id)&&(f=a.getIconURLFromKey("Scope"));var v=new r({label:h[_].title+" "+h[_].revision,data:h[_],value:h[_].id,icon:a.getIconURLFromKey(h[_].type),badges:{bottomLeft:f},grid:{badges:{bottomLeft:f},value:h[_].id,label:h[_].title}});i.push(v),o._items.push(v)}n(i)}};i.webServiceRequest(S)}else{var C=[],y=e.member,b=y.length;for(p=0;p<b;p++){var U=new r({label:y[p].title+" "+y[p].revision,data:y[p],value:y[p].id,icon:a.getIconURLFromKey(y[p].type),grid:{value:y[p].id,label:y[p].title}});o._items.push(U),C.push(U)}n(C)}},onFailure:function(e){o._core.getLogger().debug(this.name,a.getNLSValue("DELWKOAutoCompleteUI.IndexError")),s()}};i.webServiceRequest(h)}else s()}})},onFailure:function(e){t.is(e)&&t.Json.isJson(e)&&t.Json.decode(e);console.log(this.name,"Failed: %o",e),this._core.getLogger().debug(this.name,a.getNLSValue("DELWKOAutoCompleteUI.IndexError"))}})}),define("DS/DELWKOComponentsUI/DELWKOAutoCompleteSearchUI",["UWA/Class","UWA/Core","DS/DELWKOComponentsUI/DELWKOAutoCompleteUI","DS/DELWKOComponentsUI/DELWKOSearchUI","DS/Tree/TreeNodeModel","DS/DELPPWResourceServices/ResourceUtils"],function(e,t,o,n,i,r){"use strict";return e.extend({_autocomplete:null,_autocompleteUI:null,_searchbutton:null,_searchbuttonUI:null,init:function(){},buildUI:function(e,i){var r=t.createElement("div",{class:"AutoCompleteSearchUI"});return r.setStyles({display:"flex","align-items":"baseline","flex-flow":"row",width:"100%"}),i.divContent=r,this._autocomplete=new o(e,i),this._autocompleteUI=this._autocomplete.buildAutoComplete(),this._autocompleteUI.inject(r),i.callback=this.searchCallBack.bind(this),i.type=i.dicoType,this._searchbutton=new n(i),this._searchbuttonUI=this._searchbutton.buildUI(),this._searchbuttonUI.inject(r),r},getAutoComplete:function(){return this._autocomplete.autoComplete},searchCallBack:function(e){if(e.length>0){var t=e[0],o=-1,n=this._autocomplete._model,s=n.getChildren(),l=s.length;if(0===l)new i({label:t["ds6w:label"]+" "+t["ds6wg:revision"],data:t,value:t.id,icon:r.getIconURLFromKey(t["ds6w:type_value"]),grid:{value:t.id,label:t["ds6w:label"]+" "+t["ds6wg:revision"]}});else{for(var a=0;a<l&&o<0;a++){var d=s[a];null!=d&&d.options.label===t["ds6w:label_value"]+" "+t["ds6wg:revision"]&&(o=a)}o>-1&&n.getXSO().add(s[o])}}}})});