define("DS/DELWebViewerBuildUpController/BuildUpSettings",["UWA/Core"],function(e){"use strict";var t,r=function(){var t="Color",r="resource",n="all",i="all_onlyassignedresources",o="capableresource";return{getParsedBuildUpSettings:function(r){var n,i,o,a={};if(e.is(r,"array")&&r.length>0&&e.is(r[0],"object"))for(i in(n=r[0]).DisplayOptions)n.DisplayOptions.hasOwnProperty(i)&&(o=i.toLowerCase(),e.is(a[o],"object")||(a[o]={}),a[o].visibility="TRUE"===n.DisplayOptions[i].IsDisplayed,a[o].opacity="TRUE"===n.DisplayOptions[i].WithTransparency?Number(n.DisplayOptions[i].TransparencyCoefficient):255,a[o].color="TRUE"===n.DisplayOptions[i].WithColor&&"TRUE"===n.ColorOptions.WithColor?n.ColorOptions[t+i]:null,a[o].withColor="TRUE"===n.DisplayOptions[i].WithColor,a[o].filter=n.DisplayOptions[i].Filter?n.DisplayOptions[i].Filter:null);return a},getGraphicProperties:function(t,a){var s;return e.is(t,"object")&&a&&(s=a===n||a===i||a===o?t[r]:t[a]),s},getCategory:function(e){return e&&e===n||e===i||e===o?r:e}}};return e.is(t)||(t=new r),t}),define("DS/DELWebViewerBuildUpController/BuildUpCommandsBehavior",["UWA/Core","DS/DELWebViewerBuildUpController/BuildUpSettings"],function(e,t){"use strict";return function(r,n,i){var o={},a=n.getInstance("BuildUpBehaviorModelService"),s=i.getOption("mappingKeys"),u=s.GRAPHICPROPERTIES,l=i.getOption("eventCollection").getViewerCtrlEventHnd(),p=function(e){var t;return o&&e&&(t=!o.clear&&!(!e.withColor||!e.color)),t},c=function(e){r.setGraphicProperties({graphicProperties:e},s.SCENEGRAPHKEYS.BUILDUP).then(function(){r.render()})},d=function(r){var n=a.get(s.BUILDUPKEYS.BUILDUPSETTINGS),i=a.get("currentBuildupContent");r&&e.is(r.state,"boolean")&&n&&i&&(e.extend(o,{clear:r.state}),i.graphicData.forEach(function(e){var r,i,o=e.category;o&&(r=t.getGraphicProperties(n,o),i=p(r),e[u.COLOR]=i&&r&&r[u.COLOR]?r[u.COLOR]:null)}),c(i.graphicData))},g=function(r){var n,i,o=r&&r.category?r.category:"",l=r&&r.settings?r.settings:"",d=a.get(s.BUILDUPKEYS.BUILDUPSETTINGS),g=a.get("currentBuildupContent"),U=e.is(a.get("3DViewListHiddenPaths"),"array")?a.get("3DViewListHiddenPaths"):[];r&&o&&l&&e.is(g.graphicData,"array")&&g.graphicData.length>0&&d&&(n=t.getGraphicProperties(d,o),e.extend(n,l),g.graphicData.forEach(function(t){var r;t.category===o&&n&&(i=!(U.indexOf(t[s.BUILDUPKEYS.PATH].toString())>-1)&&(e.is(n[u.VISIBILITY],"boolean")?n[u.VISIBILITY]:""),r=p(n),t[u.VISIBILITY]=i,t[u.VISIBILITYFREE]=!i,t[u.COLOR]=r&&n[u.COLOR]?n[u.COLOR]:null,t[u.OPACITY]=e.is(n[u.OPACITY],"number")?n[u.OPACITY]:null)}),c(g.graphicData),a.set(s.BUILDUPKEYS.BUILDUPSETTINGS,d))};return function(){var e={onShowBuildupColorChange:d,onBuildUpDisplayOptionsChange:g};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&l.subscribe(l.events[t],e[t])}(),{getColorState:p,reset:function(){o={}}}}}),define("DS/DELWebViewerBuildUpController/BuildUpHelper",["UWA/Core","DS/DELWebViewerBuildUpController/BuildUpSettings","DS/DELWebViewerUtils/Utils","text!DS/DELWebViewerBuildUpController/assets/json/GlobalBuildupSettings.json"],function(e,t,r,n){"use strict";return function(r,i,o){var a=o.getOption("logger"),s=i.getInstance("BuildUpBehaviorModelService"),u=[],l=o.getOption("mappingKeys"),p=l.GRAPHICPROPERTIES;return{fetchBuildUpSettings:function(r){return r&&r.processId?new e.Promise(function(i,u){var p;o.getOption("dynamicBuildUp")?(p=JSON.parse(n),s.set(l.BUILDUPKEYS.BUILDUPSETTINGS,p),i(p)):s.getBuildUpSettings(r).then(function(r){e.is(r,"array")&&r.length>0?(p=t.getParsedBuildUpSettings(r),s.set(l.BUILDUPKEYS.BUILDUPSETTINGS,p),i(p)):(a.error("Published BuildUp Settings not Found."),u(o.getNLSValue("Error.BuildUpSettingsNotFound.Message")))}).fail(function(e){u(e)})}):e.Promise.reject(o.getNLSValue("Error.ProcessIdNotFound.Message"))},set:s.set,getBuildUpData:function(t){return a.info("getBuildUpData method invoked with parameters : %o",t),t&&e.is(t.path,"array")&&t.path.length>0?s.getBuildUp(t):e.Promise.reject(o.getNLSValue("Error.StepPathInvalid.Message"))},getBuildUpSettings:function(){return s.get(l.BUILDUPKEYS.BUILDUPSETTINGS)},reset:function(){u=[],r&&r.reset(),s.reset()},destroy:function(){u=[],s&&s.destroy(),a=s=l=p=null},getData:function(n){var i,c=this,d=[],g=[],U=[],S=[],P=function(n){var i,o,a,u={},d=e.is(s.get("3DViewListHiddenPaths"),"array")?s.get("3DViewListHiddenPaths"):[],g=n[l.BUILDUPKEYS.CATEGORY]?n[l.BUILDUPKEYS.CATEGORY].toLowerCase():"";return g?(i=t.getGraphicProperties(c.getBuildUpSettings(),g),u[l.BUILDUPKEYS.PATH]=n[l.BUILDUPKEYS.PATH],i&&(a=!(d.indexOf(n[l.BUILDUPKEYS.PATH].toString())>-1)&&(e.is(i[p.VISIBILITY],"boolean")?i[p.VISIBILITY]:""),o=!r||r.getColorState(i),u[p.VISIBILITY]=a,u[p.VISIBILITYFREE]=!a,u[p.COLOR]=o&&i[p.COLOR]?i[p.COLOR]:"",u[p.OPACITY]=i[p.OPACITY]?i[p.OPACITY]:""),u[l.BUILDUPKEYS.POSITION]=n[l.BUILDUPKEYS.POSITION]?n[l.BUILDUPKEYS.POSITION]:"",u[l.BUILDUPKEYS.CATEGORY]=g):u=n,u};return a.info("getData method invoked with parameters : %o",n),e.is(n,"array")&&n.length>0&&(0===u.length&&(u=s.getMFGAndResourcePaths()),i=[],n.forEach(function(e){i.push(P(e))}),d=i,U=function(){var e=s.get("process"),t=[];return e.installPath&&e.predecessors&&e.predecessors.length>0&&e.predecessors.forEach(function(e){t.push(P({path:e,category:"previousfromprevioussystem",position:""}))}),t}(),g=function(e){var t=[];return o.getOption("dynamicBuildUp")||u.forEach(function(r){var n={};e.find(function(e){var t=e[l.BUILDUPKEYS.PATH].toString();return r.indexOf(t)>-1||t.indexOf(r)>-1})||(n[l.BUILDUPKEYS.PATH]=r.split(","),n[p.VISIBILITY]=!1,n[p.VISIBILITYFREE]=!0,t.push(n))}),t}(d=d.concat(U)),S=function(){var e=[];return s.get("buildupContext").forEach(function(t){e.push(P(t))}),e}()),d.concat(g,S)},isObjectAvailable:s.isObjectAvailable}}}),define("DS/DELWebViewerBuildUpController/BuildUpController",["UWA/Core","DS/DELWebViewerBuildUpController/BuildUpHelper","DS/DELWebViewerBuildUpController/BuildUpCommandsBehavior"],function(e,t,r){"use strict";return function(n,i,o,a){var s,u=a.getOption("logger"),l=i.getToolBar(),p=l?new r(i,o,a):null,c=new t(p,o,a),d=a.getOption("eventCollection").getViewerCtrlEventHnd(),g=a.getOption("mappingKeys"),U=function(t){l&&e.is(t,"boolean")&&(t?l.show():l.hide())};return{getBuildUpSettings:function(t){return new e.Promise(function(r,n){if(!e.is(t.processId,"string"))return u.error("Invalid Process Id provided."),void n(a.getNLSValue("Error.ProcessIdNotFound.Message"));c.fetchBuildUpSettings({processId:t.processId}).then(function(){r()}).fail(function(e){n(e)})})},applyBuildUp:function(t){var r=function(){return new e.Promise(function(r,n){var i;e.is(t.path,"array")?r(t.path):(i=a.getNLSValue("Error.StepPathInvalid.Message"),u.error(i),n(i))})},n=function(e){return c.getBuildUpData({path:e})},o=function(r){return new e.Promise(function(n,o){var l=c.getData(r);e.is(l,"array")&&l.length>0?([g.SCENEGRAPHKEYS.BUILDUP,g.SCENEGRAPHKEYS.SETGRAPHICPROPERTIES,g.SCENEGRAPHKEYS.SETPROCESS].forEach(i.removeSceneGraphOverrideSet),i.setGraphicProperties({graphicProperties:l},g.SCENEGRAPHKEYS.BUILDUP).then(function(){i.render(),U(!0),s={pathIds:t.path,graphicData:l},c.set("currentBuildupContent",s),d.publish(d.events.onGlobalBuildUpComplete,s),n(r)}).fail(o)):(u.error("BuildUp Graphic data not found"),o(a.getNLSValue("Error.GraphicDataNotFound.Message")))})},l=function(e){var t=[];c.isObjectAvailable(g.BUILDUPKEYS.BUILDUPDEFKEYS.PLANNINGOBJECTS)&&(e.forEach(function(e){e.type!==g.BUILDUPKEYS.BUILDUPDEFKEYS.PLANNINGOBJECTS||i.isRegistered(e[g.BUILDUPKEYS.PATH])||t.push({path:e[g.BUILDUPKEYS.PATH]})}),t.length>0&&i.addRoots({objects:t},!0,!1))};return new e.Promise(function(t,i){U(!1),new e.Promise(function(t,r){var n;e.is(c.getBuildUpSettings(),"object")?t():(n=a.getNLSValue("Error.BuildUpSettingsNotFound.Message"),u.error(n),r(n))}).then(r).then(n).then(o).then(l).then(t).fail(function(e){i(e)})})},applyCurrentBuildUp:function(){s&&s.graphicData?i.setGraphicProperties({graphicProperties:s.graphicData},g.SCENEGRAPHKEYS.BUILDUP).then(i.render).fail(function(e){u.error(e)}):u.error("Current Operation data not found.")},getCurrentBuildUpContent:function(){return e.clone(s,!0)},isBuildUpApplied:function(){return e.is(s)},removeBuildUp:function(){s=null,i.removeSceneGraphOverrideSet(g.SCENEGRAPHKEYS.BUILDUP),i.render(),U(!1),d.publish(d.events.onGlobalBuildUpRemoved,{})},reset:function(){s=null,c.reset(),U(!1),i.removeSceneGraphOverrideSet(g.SCENEGRAPHKEYS.BUILDUP)},destroy:function(){[c].forEach(e=>{e&&e.destroy()}),g&&i.removeSceneGraphOverrideSet(g.SCENEGRAPHKEYS.BUILDUP),u=s=c=d=g=null},getPartPosition:function(t){var r=function(e){return c.getBuildUpData({path:e})},n=function(r){return new e.Promise(function(e,n){var i=r.filter(function(e){var r=e[g.BUILDUPKEYS.PATH];return!(!(r&&r.length>1)||(t.part.path?r.toString().replace(/\s/g,"")!==t.part.path.toString().replace(/\s/g,""):!t.part.id||r[r.length-1]!==t.part.id&&r[r.length-2]!==t.part.id))});i&&i.length>0?e(i):n(a.getNLSValue("Error.PartNotFound.Message"))})},i=function(e){return e.map(function(e){return{path:e.path,position:e.position}})};return u.debug("BuildUpController::getPartPosition event received with parameters :",t),new e.Promise(function(s,l){new e.Promise(function(e,r){t&&t.operation?t.operation.path?e(t.operation.path):o.getOperationPath(t.operation.id).then(e).fail(r):r(a.getNLSValue("Error.InvalidInput.Message"))}).then(r).then(n).then(i).then(s).fail(function(e){u.error("BuildUpController::getPartPosition failed due to ",e),l(e)})})}}}});